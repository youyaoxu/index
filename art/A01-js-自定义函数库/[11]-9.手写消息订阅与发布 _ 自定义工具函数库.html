<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"","children":[{"content":"<a href=\"#_9-1-api%E8%AF%B4%E6%98%8E\">#</a> 9.1.API&#x8bf4;&#x660e;","children":[{"content":"1. PubSub: &#x5305;&#x542b;&#x6240;&#x6709;&#x529f;&#x80fd;&#x7684;&#x8ba2;&#x9605;/&#x53d1;&#x5e03;&#x6d88;&#x606f;&#x7684;&#x7ba1;&#x7406;&#x8005;","children":[],"payload":{"tag":"li","lines":"3,4","listIndex":1}},{"content":"2. PubSub.subscribe(msg, subscriber): &#x8ba2;&#x9605;&#x6d88;&#x606f;: &#x6307;&#x5b9a;&#x6d88;&#x606f;&#x540d;&#x548c;&#x8ba2;&#x9605;&#x8005;&#x56de;&#x8c03;&#x51fd;&#x6570;","children":[],"payload":{"tag":"li","lines":"4,5","listIndex":2}},{"content":"3. PubSub.publish(msg, data): &#x5f02;&#x6b65;&#x53d1;&#x5e03;&#x6d88;&#x606f;: &#x6307;&#x5b9a;&#x6d88;&#x606f;&#x540d;&#x548c;&#x6570;&#x636e;","children":[],"payload":{"tag":"li","lines":"5,6","listIndex":3}},{"content":"4. PubSub.publishSync(msg, data): &#x540c;&#x6b65;&#x53d1;&#x5e03;&#x6d88;&#x606f;: &#x6307;&#x5b9a;&#x6d88;&#x606f;&#x540d;&#x548c;&#x6570;&#x636e;","children":[],"payload":{"tag":"li","lines":"6,7","listIndex":4}},{"content":"5. PubSub.unsubscribe(flag): &#x53d6;&#x6d88;&#x8ba2;&#x9605;: &#x6839;&#x636e;&#x6807;&#x8bc6;&#x53d6;&#x6d88;&#x67d0;&#x4e2a;&#x6216;&#x67d0;&#x4e9b;&#x6d88;&#x606f;&#x7684;&#x8ba2;&#x9605;","children":[],"payload":{"tag":"li","lines":"7,9","listIndex":5}}],"payload":{"tag":"h2","lines":"0,2"}},{"content":"<a href=\"#_9-2-%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0\">#</a> 9.2.&#x7f16;&#x7801;&#x5b9e;&#x73b0;","children":[{"content":"<pre data-lines=\"12,108\"><code data-lines=\"12,108\"><span class=\"hljs-comment\">/* \n&#x81ea;&#x5b9a;&#x4e49;&#x6d88;&#x606f;&#x8ba2;&#x9605;&#x4e0e;&#x53d1;&#x5e03;\n*/</span>\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">PubSub</span> = {}\n<span class=\"hljs-comment\">/* \n  {\n    add: {\n      token1: callback1, \n      token2: callback2\n    },\n    update: {\n      token3: callback3\n    }\n  }\n*/</span>\n<span class=\"hljs-keyword\">let</span> callbacksObj = {} <span class=\"hljs-comment\">// &#x4fdd;&#x5b58;&#x6240;&#x6709;&#x56de;&#x8c03;&#x7684;&#x5bb9;&#x5668;</span>\n<span class=\"hljs-keyword\">let</span> id = <span class=\"hljs-number\">0</span> <span class=\"hljs-comment\">// &#x7528;&#x4e8e;&#x751f;&#x6210;token&#x7684;&#x6807;&#x8bb0;</span>\n\n<span class=\"hljs-comment\">// 1. &#x8ba2;&#x9605;&#x6d88;&#x606f;</span>\n<span class=\"hljs-title class_\">PubSub</span>.<span class=\"hljs-property\">subscribe</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">msgName, callback</span>) {\n\n  <span class=\"hljs-comment\">// &#x786e;&#x5b9a;token</span>\n  <span class=\"hljs-keyword\">const</span> token = <span class=\"hljs-string\">&apos;token_&apos;</span> + ++id\n  <span class=\"hljs-comment\">// &#x53d6;&#x51fa;&#x5f53;&#x524d;&#x6d88;&#x606f;&#x5bf9;&#x5e94;&#x7684;callbacks</span>\n  <span class=\"hljs-keyword\">const</span> callbacks = callbacksObj[msgName]\n  <span class=\"hljs-keyword\">if</span> (!callbacks) {\n    callbacksObj[msgName] = {\n      [token]: callback\n    }\n  } <span class=\"hljs-keyword\">else</span> {\n    callbacks[token] = callback\n  }\n  <span class=\"hljs-comment\">// &#x8fd4;&#x56de;token</span>\n  <span class=\"hljs-keyword\">return</span> token\n}\n\n<span class=\"hljs-comment\">// 2. &#x53d1;&#x5e03;&#x5f02;&#x6b65;&#x7684;&#x6d88;&#x606f;</span>\n<span class=\"hljs-title class_\">PubSub</span>.<span class=\"hljs-property\">publish</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">msgName, data</span>) {\n  <span class=\"hljs-comment\">// &#x53d6;&#x51fa;&#x5f53;&#x524d;&#x6d88;&#x606f;&#x5bf9;&#x5e94;&#x7684;callbacks</span>\n  <span class=\"hljs-keyword\">let</span> callbacks = callbacksObj[msgName]\n  <span class=\"hljs-comment\">// &#x5982;&#x679c;&#x6709;&#x503c;</span>\n  <span class=\"hljs-keyword\">if</span> (callbacks) {\n    <span class=\"hljs-comment\">// callbacks = Object.assign({}, callbacks)</span>\n    <span class=\"hljs-comment\">// &#x542f;&#x52a8;&#x5b9a;&#x65f6;&#x5668;, &#x5f02;&#x6b65;&#x6267;&#x884c;&#x6240;&#x6709;&#x7684;&#x56de;&#x8c03;&#x51fd;&#x6570;</span>\n    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> {\n      <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">values</span>(callbacks).<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">callback</span> =&gt;</span> {\n        <span class=\"hljs-title function_\">callback</span>(data)\n      })\n    }, <span class=\"hljs-number\">0</span>)\n  }\n}\n\n<span class=\"hljs-comment\">// 3. &#x53d1;&#x5e03;&#x540c;&#x6b65;&#x7684;&#x6d88;&#x606f;</span>\n<span class=\"hljs-title class_\">PubSub</span>.<span class=\"hljs-property\">publishSync</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">msgName, data</span>) {\n  <span class=\"hljs-comment\">// &#x53d6;&#x51fa;&#x5f53;&#x524d;&#x6d88;&#x606f;&#x5bf9;&#x5e94;&#x7684;callbacks</span>\n  <span class=\"hljs-keyword\">const</span> callbacks = callbacksObj[msgName]\n  <span class=\"hljs-comment\">// &#x5982;&#x679c;&#x6709;&#x503c;</span>\n  <span class=\"hljs-keyword\">if</span> (callbacks) {\n    <span class=\"hljs-comment\">// &#x7acb;&#x5373;&#x540c;&#x6b65;&#x6267;&#x884c;&#x6240;&#x6709;&#x7684;&#x56de;&#x8c03;&#x51fd;&#x6570;</span>\n    <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">values</span>(callbacks).<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">callback</span> =&gt;</span> {\n      <span class=\"hljs-title function_\">callback</span>(data)\n    })\n  }\n}\n\n<span class=\"hljs-comment\">/*\n4. &#x53d6;&#x6d88;&#x6d88;&#x606f;&#x8ba2;&#x9605;\n  1). &#x6ca1;&#x6709;&#x4f20;&#x503c;, flag&#x4e3a;undefined\n  2). &#x4f20;&#x5165;token&#x5b57;&#x7b26;&#x4e32;\n  3). msgName&#x5b57;&#x7b26;&#x4e32;\n*/</span>\n<span class=\"hljs-title class_\">PubSub</span>.<span class=\"hljs-property\">unsubscribe</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">flag</span>) {\n  <span class=\"hljs-comment\">// &#x5982;&#x679c;flag&#x6ca1;&#x6709;&#x6307;&#x5b9a;&#x6216;&#x8005;&#x4e3a;null, &#x53d6;&#x6d88;&#x6240;&#x6709;</span>\n  <span class=\"hljs-keyword\">if</span> (flag === <span class=\"hljs-literal\">undefined</span>) {\n    callbacksObj = {}\n  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> flag === <span class=\"hljs-string\">&apos;string&apos;</span>) {\n    <span class=\"hljs-keyword\">if</span> (flag.<span class=\"hljs-title function_\">indexOf</span>(<span class=\"hljs-string\">&apos;token_&apos;</span>) === <span class=\"hljs-number\">0</span>) { <span class=\"hljs-comment\">// flag&#x662f;token</span>\n      <span class=\"hljs-comment\">// &#x627e;&#x5230;flag&#x5bf9;&#x5e94;&#x7684;callbacks</span>\n      <span class=\"hljs-keyword\">const</span> callbacks = <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">values</span>(callbacksObj).<span class=\"hljs-title function_\">find</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">callbacks</span> =&gt;</span> callbacks.<span class=\"hljs-title function_\">hasOwnProperty</span>(flag))\n      <span class=\"hljs-comment\">// &#x5982;&#x679c;&#x5b58;&#x5728;, &#x5220;&#x9664;&#x5bf9;&#x5e94;&#x7684;&#x5c5e;&#x6027;</span>\n      <span class=\"hljs-keyword\">if</span> (callbacks) {\n        <span class=\"hljs-keyword\">delete</span> callbacks[flag]\n      }\n    } <span class=\"hljs-keyword\">else</span> { <span class=\"hljs-comment\">// flag&#x662f;msgName</span>\n      <span class=\"hljs-keyword\">delete</span> callbacksObj[flag]\n    }\n\n  } <span class=\"hljs-keyword\">else</span> {\n    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">&apos;&#x5982;&#x679c;&#x4f20;&#x5165;&#x53c2;&#x6570;, &#x5fc5;&#x987b;&#x662f;&#x5b57;&#x7b26;&#x4e32;&#x7c7b;&#x578b;&apos;</span>)\n  }\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title class_\">PubSub</span> \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"12,108"}}],"payload":{"tag":"h2","lines":"9,11"}},{"content":"<a href=\"#_9-3-%E6%B5%8B%E8%AF%95\">#</a> 9.3.&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"112,148\"><code data-lines=\"112,148\"><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-keyword\">html</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">&quot;en&quot;</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">charset</span>=<span class=\"hljs-string\">&quot;UTF-8&quot;</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>&#x624b;&#x5199;&#x6d88;&#x606f;&#x8ba2;&#x9605;&#x4e0e;&#x53d1;&#x5e03;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;../dist/atguigu-utils.js&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"> <span class=\"hljs-keyword\">const</span> { <span class=\"hljs-title class_\">PubSub</span> } = aUtils\n  <span class=\"hljs-comment\">// &#x8ba2;&#x9605;&#x6d88;&#x606f;</span>\n  <span class=\"hljs-title class_\">PubSub</span>.<span class=\"hljs-title function_\">subscribe</span>(<span class=\"hljs-string\">&apos;add&apos;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =&gt;</span> {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;add()...&apos;</span>, data)\n  })\n  <span class=\"hljs-title class_\">PubSub</span>.<span class=\"hljs-title function_\">subscribe</span>(<span class=\"hljs-string\">&apos;add&apos;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =&gt;</span> {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;add2()...&apos;</span>, data)\n  })\n  <span class=\"hljs-keyword\">const</span> token = <span class=\"hljs-title class_\">PubSub</span>.<span class=\"hljs-title function_\">subscribe</span>(<span class=\"hljs-string\">&apos;add&apos;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =&gt;</span> {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;add3()...&apos;</span>, data)\n  })\n  <span class=\"hljs-title class_\">PubSub</span>.<span class=\"hljs-title function_\">subscribe</span>(<span class=\"hljs-string\">&apos;update&apos;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =&gt;</span> {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;update()...&apos;</span>, data)\n  })\n\n  <span class=\"hljs-comment\">// PubSub.unsubscribe(token)</span>\n  <span class=\"hljs-comment\">// PubSub.unsubscribe(&apos;add&apos;)</span>\n  <span class=\"hljs-comment\">// PubSub.unsubscribe()</span>\n\n  <span class=\"hljs-title class_\">PubSub</span>.<span class=\"hljs-title function_\">publish</span>(<span class=\"hljs-string\">&apos;add&apos;</span>, <span class=\"hljs-number\">12</span>)\n  <span class=\"hljs-comment\">// PubSub.publish(&apos;update&apos;, 13)</span>\n  <span class=\"hljs-title class_\">PubSub</span>.<span class=\"hljs-title function_\">publishSync</span>(<span class=\"hljs-string\">&apos;update&apos;</span>, <span class=\"hljs-number\">12</span>)\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;----&apos;</span>) </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span> \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"112,148"}}],"payload":{"tag":"h2","lines":"109,111"}}]},{})</script>
</body>
</html>
