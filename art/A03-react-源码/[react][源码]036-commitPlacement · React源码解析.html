<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"commitPlacement","children":[{"content":"&#x8ba4;&#x8bc6;","children":[{"content":"<pre data-lines=\"4,5\"><code>&#x6302;&#x8f7d;&#x8282;&#x70b9;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4,5"}}],"payload":{"tag":"h3","lines":"2,3"}},{"content":"getHostParentFiber","children":[{"content":"<pre data-lines=\"8,28\"><code data-lines=\"8,28\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getHostParentFiber</span>(fiber: Fiber): Fiber {\n  let parent = fiber.<span class=\"hljs-keyword\">return</span>\n  <span class=\"hljs-type\">while</span> (parent !== null) {\n    <span class=\"hljs-keyword\">if</span> (parent) {\n      <span class=\"hljs-keyword\">return</span> parent\n    }\n    parent = parent.<span class=\"hljs-keyword\">return</span>\n  }\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">isHostParent</span>(fiber: Fiber): boolean {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-type\">(</span>\n    fiber.tag === HostComponent ||\n    fiber.tag === HostRoot ||\n    fiber.tag === HostPortal\n  )\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"8,28"}},{"content":"<pre data-lines=\"29,36\"><code>&#x5982;&#x4e0a;&#xff0c;&#x5c31;&#x662f;&#x4ece;&#x7236;&#x94fe;&#x4e0a;&#x627e;&#x5230;&#x7b2c;&#x4e00;&#x4e2a;&#x5177;&#x6709;`container`&#x7684;&#x8282;&#x70b9;&#x6216;&#x8005;&#x662f;`HostComponent`\n\n* * *\n\n&#x6839;&#x636e;&#x627e;&#x5230;&#x7684;`parent`&#x8bbe;&#x7f6e;&#x53d8;&#x91cf;\n\n&#x5982;&#x679c;`parent`&#x9700;&#x8981;&#x91cd;&#x65b0;&#x8bbe;&#x7f6e;`text`&#x8c03;&#x7528;`resetTextContent`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"29,36"}}],"payload":{"tag":"h3","lines":"6,7"}},{"content":"getHostSibling","children":[{"content":"<pre data-lines=\"39,72\"><code data-lines=\"39,72\">function getHostSibling(fiber: Fiber): ?Instance {\n  let node: Fiber = fiber\n  siblings: <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n    \n    <span class=\"hljs-keyword\">while</span> (node.sibling === <span class=\"hljs-literal\">null</span>) {\n      <span class=\"hljs-keyword\">if</span> (node.<span class=\"hljs-keyword\">return</span> === <span class=\"hljs-literal\">null</span> || isHostParent(node.<span class=\"hljs-keyword\">return</span>)) {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>\n      }\n      node = node.<span class=\"hljs-keyword\">return</span>\n    }\n    node.sibling.<span class=\"hljs-keyword\">return</span> = node.<span class=\"hljs-keyword\">return</span>\n    node = node.sibling\n    <span class=\"hljs-keyword\">while</span> (node.tag !== HostComponent &amp;&amp; node.tag !== HostText) {\n      <span class=\"hljs-keyword\">if</span> (node.effectTag &amp; Placement) {\n        \n        <span class=\"hljs-keyword\">continue</span> siblings\n      }\n      <span class=\"hljs-keyword\">if</span> (node.child === <span class=\"hljs-literal\">null</span> || node.tag === HostPortal) {\n        <span class=\"hljs-keyword\">continue</span> siblings\n      } <span class=\"hljs-keyword\">else</span> {\n        node.child.<span class=\"hljs-keyword\">return</span> = node\n        node = node.child\n      }\n    }\n    <span class=\"hljs-keyword\">if</span> (!(node.effectTag &amp; Placement)) {\n      \n      <span class=\"hljs-keyword\">return</span> node.stateNode\n    }\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"39,72"}},{"content":"<pre data-lines=\"73,91\"><code>&#x8fd9;&#x4e2a;&#x65b9;&#x6cd5;&#x7528;&#x6765;&#x627e;&#x5230;**&#x5f53;&#x524d;&#x8981;&#x6267;&#x884c;&#x63d2;&#x5165;&#x7684;&#x8282;&#x70b9;&#x7684;&#x73b0;&#x6709;&#x7684;&#x7b2c;&#x4e00;&#x4e2a;&#x53f3;&#x4fa7;&#x8282;&#x70b9;&#xff0c;&#x5982;&#x679c;&#x8fd9;&#x4e2a;&#x65b9;&#x6cd5;&#x8fd4;&#x56de;`null`&#xff0c;&#x5219;&#x4f1a;&#x76f4;&#x63a5;&#x8c03;&#x7528;`parent.appendChild`**\n\n&#x8fd9;&#x91cc;&#x4e3b;&#x8981;&#x8003;&#x8651;&#x7684;&#x95ee;&#x9898;&#x662f;`parent.appendChild`&#x662f;&#x63d2;&#x5165;&#x5230;&#x6700;&#x540e;&#x7684;&#xff0c;&#x800c;&#x5bf9;&#x4e8e; React &#x7684;&#x8282;&#x70b9;&#x64cd;&#x4f5c;&#xff0c;&#x5f88;&#x53ef;&#x80fd;&#x63d2;&#x5165;&#x7684;&#x8282;&#x70b9;&#x662f;&#x5728;&#x4e2d;&#x95f4;&#x3002;&#x5bf9;&#x4e8e;&#x7b2c;&#x4e00;&#x6b21;&#x6e32;&#x67d3;&#xff0c;&#x56e0;&#x4e3a;&#x6240;&#x6709;`HostComponent`&#x90fd;&#x662f;&#x9700;&#x8981;&#x63d2;&#x5165;&#x7684;&#xff0c;&#x6240;&#x4ee5;&#x6309;&#x7167;&#x987a;&#x5e8f;`appendChild`&#x6ca1;&#x6709;&#x95ee;&#x9898;&#xff0c;**&#x6240;&#x4ee5; React &#x628a;&#x8fd9;&#x4e00;&#x6b65;&#x653e;&#x5728;`completeWork`&#x5c31;&#x505a;&#x4e86;**&#x3002;&#x4f46;&#x662f;&#x5bf9;&#x4e8e;&#x540e;&#x7eed;&#x66f4;&#x65b0;&#x8fd9;&#x4e2a;&#x662f;&#x4e0d;&#x786e;&#x5b9a;&#x7684;&#xff0c;&#x6240;&#x4ee5;&#x8981;&#x627e;&#x5230;&#x6574;&#x68f5;&#x6811;&#x4e2d;&#x6240;&#x6709;`HostComponent`&#x7684;&#x6811;&#x7ed3;&#x6784;&#x4e2d;&#x7684;&#x53f3;&#x4fa7;&#x8282;&#x70b9;&#x3002;\n\n&#x8fd9;&#x4e2a;&#x8282;&#x70b9;&#x53ef;&#x80fd;&#x5b58;&#x5728;&#x4e8e;&#xff1a;\n\n*   &#x7236;&#x94fe;&#x4e2d;&#x4efb;&#x4e00;&#x8282;&#x70b9;&#x7684;&#x53f3;&#x4fa7;&#x8282;&#x70b9;&#x7684;&#x5b50;&#x6811;&#x4e2d;&#x7684;&#x7b2c;&#x4e00;&#x4e2a;`HostComponent`\n*   &#x4ed6;&#x7684;&#x53f3;&#x4fa7;&#x5144;&#x5f1f;&#x8282;&#x70b9;&#x6216;&#x8005;&#x5b50;&#x6811;&#x4e2d;&#x7684;&#x7b2c;&#x4e00;&#x4e2a;`HostComponent`\n\n&#x8fd9;&#x4e2a;&#x7b97;&#x6cd5;&#x5c31;&#x662f;&#x7528;&#x6765;&#x5b9e;&#x73b0;&#x8fd9;&#x4e2a;&#x641c;&#x7d22;&#x8fc7;&#x7a0b;\n\n* * *\n\n&#x63a5;&#x4e0b;&#x53bb;&#x5c31;&#x662f;&#x5bf9;&#x4e0d;&#x540c;&#x7684;&#x60c5;&#x51b5;&#x6267;&#x884c;&#x4e0d;&#x540c;&#x7684;&#x63d2;&#x5165;&#x64cd;&#x4f5c;\n\n&#x5bf9;&#x4e8e;`HostPortal`&#x4e0d;&#x9700;&#x8981;&#x64cd;&#x4f5c;&#xff0c;&#x56e0;&#x4e3a;&#x8fd9;&#x5176;&#x5b9e;&#x662f;&#x4ed6;&#x7684;&#x5b50;&#x8282;&#x70b9;&#x63d2;&#x5165;&#x5230;`HostPortal.containerInfo`&#x7684;&#x8fc7;&#x7a0b;&#x3002;\n\n&#x540c;&#x65f6;&#x8fd9;&#x662f;&#x4e2a;&#x5faa;&#x73af;&#xff0c;&#x8fd9;&#x4e2a;&#x8ddf;&#x5728;`completeWork`&#x91cc;`appendAllChindren`&#x4e00;&#x6837;&#xff0c;&#x8981;&#x628a;&#x5f53;&#x524d;&#x7ec4;&#x4ef6;&#x7684;&#x7b2c;&#x4e00;&#x5c42;&#x5b50;&#x8282;&#x70b9;&#x6267;&#x884c;&#x63d2;&#x5165;&#xff0c;&#x6bd4;&#x5982;&#x5f53;&#x524d;&#x7ec4;&#x4ef6;&#x5982;&#x679c;&#x662f;&#x4e00;&#x4e2a;&#x8fd4;&#x56de;&#x6570;&#x7ec4;&#x7684;`ClassComponent`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"73,91"}},{"content":"<pre data-lines=\"92,175\"><code data-lines=\"92,175\">function commitPlacement(finishedWork: Fiber): void {\n  <span class=\"hljs-keyword\">if</span> (!supportsMutation) {\n    <span class=\"hljs-keyword\">return</span>\n  }\n\n  \n  <span class=\"hljs-keyword\">const</span> parentFiber = getHostParentFiber(finishedWork)\n\n  \n  let parent\n  let isContainer\n\n  switch (parentFiber.tag) {\n    case HostComponent:\n      parent = parentFiber.stateNode\n      isContainer = <span class=\"hljs-literal\">false</span>\n      <span class=\"hljs-keyword\">break</span>\n    case HostRoot:\n      parent = parentFiber.stateNode.containerInfo\n      isContainer = <span class=\"hljs-literal\">true</span>\n      <span class=\"hljs-keyword\">break</span>\n    case HostPortal:\n      parent = parentFiber.stateNode.containerInfo\n      isContainer = <span class=\"hljs-literal\">true</span>\n      <span class=\"hljs-keyword\">break</span>\n    default:\n      invariant(\n        <span class=\"hljs-literal\">false</span>,\n        <span class=\"hljs-string\">&apos;Invalid host parent fiber. This error is likely caused by a bug &apos;</span> +\n          <span class=\"hljs-string\">&apos;in React. Please file an issue.&apos;</span>,\n      )\n  }\n  <span class=\"hljs-keyword\">if</span> (parentFiber.effectTag &amp; ContentReset) {\n    \n    resetTextContent(parent)\n    \n    parentFiber.effectTag &amp;= ~ContentReset\n  }\n\n  <span class=\"hljs-keyword\">const</span> before = getHostSibling(finishedWork)\n  \n  \n  let node: Fiber = finishedWork\n  <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n    <span class=\"hljs-keyword\">if</span> (node.tag === HostComponent || node.tag === HostText) {\n      <span class=\"hljs-keyword\">if</span> (before) {\n        <span class=\"hljs-keyword\">if</span> (isContainer) {\n          insertInContainerBefore(parent, node.stateNode, before)\n        } <span class=\"hljs-keyword\">else</span> {\n          insertBefore(parent, node.stateNode, before)\n        }\n      } <span class=\"hljs-keyword\">else</span> {\n        <span class=\"hljs-keyword\">if</span> (isContainer) {\n          appendChildToContainer(parent, node.stateNode)\n        } <span class=\"hljs-keyword\">else</span> {\n          appendChild(parent, node.stateNode)\n        }\n      }\n    } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (node.tag === HostPortal) {\n      \n      \n      \n    } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (node.child !== <span class=\"hljs-literal\">null</span>) {\n      node.child.<span class=\"hljs-keyword\">return</span> = node\n      node = node.child\n      <span class=\"hljs-keyword\">continue</span>\n    }\n    <span class=\"hljs-keyword\">if</span> (node === finishedWork) {\n      <span class=\"hljs-keyword\">return</span>\n    }\n    <span class=\"hljs-keyword\">while</span> (node.sibling === <span class=\"hljs-literal\">null</span>) {\n      <span class=\"hljs-keyword\">if</span> (node.<span class=\"hljs-keyword\">return</span> === <span class=\"hljs-literal\">null</span> || node.<span class=\"hljs-keyword\">return</span> === finishedWork) {\n        <span class=\"hljs-keyword\">return</span>\n      }\n      node = node.<span class=\"hljs-keyword\">return</span>\n    }\n    node.sibling.<span class=\"hljs-keyword\">return</span> = node.<span class=\"hljs-keyword\">return</span>\n    node = node.sibling\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"92,175"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"176,177"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"180,181"}}],"payload":{"tag":"h3","lines":"37,38"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
