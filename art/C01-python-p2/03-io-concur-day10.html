<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"03-io-concur-day10","children":[{"content":"IO-CONCUR","children":[{"content":"&#x524d;&#x60c5;&#x56de;&#x987e;","children":[{"content":"<pre data-lines=\"8,60\"><code data-lines=\"8,60\">\n<span class=\"hljs-bullet\">1.</span> &#x7f51;&#x7edc;&#x5e76;&#x53d1;&#x6a21;&#x578b;\n\n   &#x591a;&#x8fdb;&#x7a0b;&#x5e76;&#x53d1;  fork()\n   &#x591a;&#x7ebf;&#x7a0b;&#x5e76;&#x53d1;  Thread()\n\n<span class=\"hljs-bullet\">2.</span> ftp&#x6587;&#x4ef6;&#x670d;&#x52a1;\n\n=============================================\nIO&#x591a;&#x8def;&#x590d;&#x7528;&#x65b9;&#x6cd5;&#x5bf9;&#x6bd4;\n\nselect :  windows  linux   unix\n<span class=\"hljs-code\">          &#x6700;&#x591a;&#x540c;&#x65f6;&#x76d1;&#x63a7;1024&#x4e2a;IO\n          &#x6548;&#x7387;&#x4e00;&#x822c;\n</span>\n\npoll :   linux  unix\n<span class=\"hljs-code\">         IO&#x76d1;&#x63a7;&#x6570;&#x91cf;&#x65e0;&#x9650;&#x5236;\n         &#x6548;&#x7387;&#x4e00;&#x822c;&#x57fa;&#x672c;&#x540c;select\n</span>\n\nepoll:   Linux\n<span class=\"hljs-code\">         IO&#x76d1;&#x63a7;&#x6570;&#x91cf;&#x65e0;&#x9650;&#x5236;\n         &#x6548;&#x7387;&#x9ad8;\n</span>\n&#x7ec3;&#x4e60;&#xff1a; &#x4f7f;&#x7528;IO&#x591a;&#x8def;&#x590d;&#x7528;&#x5b8c;&#x6210;&#x65e5;&#x5fd7;&#x586b;&#x5199;&#x7cfb;&#x7edf;\n\n  &#x5ba2;&#x6237;&#x7aef;&#x8fd0;&#x884c;&#x9519;&#x8bef;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4f1a;&#x5c06;&#x9519;&#x8bef;&#x4fe1;&#x606f;&#x53d1;&#x9001;&#x7ed9;&#x670d;&#x52a1;&#x7aef;\n &#xff08;&#x4f7f;&#x7528;tcp&#x5ba2;&#x6237;&#x7aef;&#x6a21;&#x62df;&#xff0c;&#x4e0d;&#x5b9a;&#x65f6;&#x7ed9;&#x670d;&#x52a1;&#x7aef;&#x53d1;&#x9001;&#x4fe1;&#x606f;&#xff0c;&#x8868;&#x793a;&#x9519;&#x8bef;&#x4fe1;&#x606f;&#xff09;\n\n  &#x670d;&#x52a1;&#x7aef;&#x7ef4;&#x62a4;&#x4eba;&#x5458;&#x4e5f;&#x53ef;&#x4ee5;&#x624b;&#x52a8;&#x7684;&#x6dfb;&#x52a0;&#x9519;&#x8bef;&#x65e5;&#x5fd7;&#xff0c;&#x7531;&#x7ec8;&#x7aef;&#x8f93;&#x5165;&#x5185;&#x5bb9;&#xff0c;\n  &#x5199;&#x5165;&#x65e5;&#x5fd7;    io&#x5bf9;&#x8c61;&#xff1a; sys.stdin\n\n  &#x65e5;&#x5fd7;&#x5185;&#x5bb9;&#x5305;&#x542b;&#x65f6;&#x95f4;&#x548c;&#x9519;&#x8bef;&#x4fe1;&#x606f;   &#x65e5;&#x5fd7;&#x540d;&#x5b57; test.log\n\n\nIO&#x591a;&#x8def;&#x590d;&#x7528;&#x548c;&#x591a;&#x8fdb;&#x7a0b;&#x591a;&#x7ebf;&#x7a0b;&#x5e76;&#x53d1;\n\n<span class=\"hljs-bullet\">*</span> IO &#x591a;&#x590d;&#x7528;&#x53ea;&#x662f;&#x5904;&#x7406;IO&#x884c;&#x4e3a;\n<span class=\"hljs-bullet\">*</span> IO &#x591a;&#x8def;&#x590d;&#x7528;&#x53ea;&#x662f;&#x4e00;&#x4e2a;&#x5355;&#x7ebf;&#x7a0b;&#x7a0b;&#x5e8f;\n<span class=\"hljs-bullet\">*</span> &#x5927;&#x4efb;&#x52a1;&#x591a;&#x8fdb;&#x7a0b;&#x591a;&#x7ebf;&#x5e76;&#x53d1;&#xff0c;IO&#x91cf;&#x5927;&#x7684;&#x4efb;&#x52a1;&#x53ef;&#x80fd;&#x4f7f;&#x7528;&#x591a;&#x8def;&#x590d;&#x7528;\n\n&#x4f5c;&#x4e1a;&#xff1a; &#x603b;&#x7ed3;&#x6838;&#x5fc3;&#x7f16;&#x7a0b;&#x90e8;&#x5206;&#x5185;&#x5bb9;\n\n<span class=\"hljs-code\">      IO   &#xff1a; &#x6587;&#x4ef6;   &#x7f51;&#x7edc;\n</span>\n<span class=\"hljs-code\">      &#x8fdb;&#x7a0b;&#x7ebf;&#x7a0b; &#xff1a; &#x8fdb;&#x7a0b;  &#x7ebf;&#x7a0b;\n</span>\n<span class=\"hljs-code\">      &#x5e76;&#x53d1; &#xff1a;  &#x591a;&#x8fdb;&#x7a0b;   &#x591a;&#x7ebf;&#x7a0b;   IO&#x591a;&#x8def;&#x590d;&#x7528;\n</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"8,60"}}],"payload":{"tag":"h5","lines":"6,7"}},{"content":"&#x793a;&#x4f8b;","children":[{"content":"<pre data-lines=\"63,102\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nblock_io.py\n&#x975e;&#x963b;&#x585e;IO\n&quot;&quot;&quot;</span>\n\n<span class=\"hljs-keyword\">from</span> socket <span class=\"hljs-keyword\">import</span> *\n<span class=\"hljs-keyword\">from</span> time <span class=\"hljs-keyword\">import</span> ctime,sleep\n\nf = <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&apos;test.log&apos;</span>,<span class=\"hljs-string\">&apos;a&apos;</span>) <span class=\"hljs-comment\"># &#x5199;&#x8fd0;&#x884c;&#x65e5;&#x5fd7;</span>\n\n<span class=\"hljs-comment\"># TCP&#x5957;&#x63a5;&#x5b57;</span>\ns = socket()\ns.bind((<span class=\"hljs-string\">&apos;127.0.0.1&apos;</span>,<span class=\"hljs-number\">8888</span>))\ns.listen(<span class=\"hljs-number\">3</span>)\n\n<span class=\"hljs-comment\"># &#x8bbe;&#x7f6e;&#x5957;&#x63a5;&#x5b57;&#x975e;&#x963b;&#x585e;</span>\n<span class=\"hljs-comment\"># s.setblocking(False)</span>\n\n<span class=\"hljs-comment\"># &#x8d85;&#x65f6;&#x65f6;&#x95f4;</span>\ns.settimeout(<span class=\"hljs-number\">2</span>)\n\n<span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n    <span class=\"hljs-keyword\">try</span>:\n        c,addr = s.accept()\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Connect from&quot;</span>,addr)\n    <span class=\"hljs-keyword\">except</span> BlockingIOError <span class=\"hljs-keyword\">as</span> e:\n        f.write(<span class=\"hljs-string\">&apos;%s : %s\\n&apos;</span>%(ctime(),e))\n        f.flush()\n        sleep(<span class=\"hljs-number\">3</span>)\n    <span class=\"hljs-keyword\">except</span> timeout <span class=\"hljs-keyword\">as</span> e:\n        f.write(<span class=\"hljs-string\">&apos;%s : %s\\n&apos;</span> % (ctime(), e))\n        f.flush()\n    <span class=\"hljs-keyword\">else</span>:\n        data = c.recv(<span class=\"hljs-number\">1024</span>)\n\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"63,102"}},{"content":"<pre data-lines=\"103,156\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nepoll_server.py\nepoll&#x65b9;&#x6cd5; server\n&#x91cd;&#x70b9;&#x4ee3;&#x7801;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> socket <span class=\"hljs-keyword\">import</span> *\n<span class=\"hljs-keyword\">from</span> select <span class=\"hljs-keyword\">import</span> *\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x76d1;&#x542c;&#x5957;&#x63a5;&#x5b57;</span>\ns = socket()\ns.setsockopt(SOL_SOCKET,SO_REUSEADDR,<span class=\"hljs-number\">1</span>)\ns.bind((<span class=\"hljs-string\">&apos;0.0.0.0&apos;</span>,<span class=\"hljs-number\">8888</span>))\ns.listen(<span class=\"hljs-number\">3</span>)\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;epoll&#x5bf9;&#x8c61;</span>\nep = epoll()\n\n<span class=\"hljs-comment\"># &#x67e5;&#x627e;&#x5b57;&#x5178;&#xff0c;&#x7528;&#x4e8e;&#x901a;&#x8fc7;&#x6587;&#x4ef6;&#x63cf;&#x8ff0;&#x7b26;&#x67e5;&#x627e;&#x5bf9;&#x8c61;</span>\n<span class=\"hljs-comment\"># &#x65f6;&#x523b;&#x4e0e;&#x5173;&#x6ce8;&#x7684;IO&#x4fdd;&#x6301;&#x4e00;&#x76f4;</span>\n<span class=\"hljs-built_in\">map</span> = {s.fileno():s}\nep.register(s,EPOLLIN) <span class=\"hljs-comment\"># &#x5173;&#x6ce8;s</span>\n\n<span class=\"hljs-comment\">#&#x5faa;&#x73af;&#x76d1;&#x63a7;&#xff29;&#xff2f;</span>\n<span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n    <span class=\"hljs-comment\"># [(fd,event),()]</span>\n    events = ep.poll() <span class=\"hljs-comment\">#&#x3000;&#x5c06;&#x5173;&#x6ce8;&#xff29;&#xff2f;&#x63d0;&#x4ea4;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x76d1;&#x63a7;</span>\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x4f60;&#x6709;&#x4e00;&#x4e2a;IO&#x9700;&#x8981;&#x5904;&#x7406;&#x54e6;&quot;</span>)\n    <span class=\"hljs-keyword\">for</span> fd,event <span class=\"hljs-keyword\">in</span> events:\n        <span class=\"hljs-comment\"># &#x533a;&#x5206;IO</span>\n        <span class=\"hljs-keyword\">if</span> fd == s.fileno():\n            c,addr = <span class=\"hljs-built_in\">map</span>[fd].accept()\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Connect from&quot;</span>,addr)\n            ep.register(c,EPOLLIN|EPOLLPRI|EPOLLET) <span class=\"hljs-comment\"># &#x6dfb;&#x52a0;&#x5173;&#x6ce8;</span>\n            <span class=\"hljs-built_in\">map</span>[c.fileno()] = c <span class=\"hljs-comment\"># &#x7ef4;&#x62a4;&#x5b57;&#x5178;</span>\n        <span class=\"hljs-keyword\">elif</span> event &amp; EPOLLIN:\n            <span class=\"hljs-comment\"># &#x786e;&#x4fdd;epollin&#x5c31;&#x7eea;&#x6267;&#x884c;&#x8fd9;&#x4e00;&#x6bb5;</span>\n            data = <span class=\"hljs-built_in\">map</span>[fd].recv(<span class=\"hljs-number\">1024</span>).decode()\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> data:\n                ep.unregister(fd) <span class=\"hljs-comment\"># &#x53d6;&#x6d88;&#x5173;&#x6ce8;</span>\n                <span class=\"hljs-built_in\">map</span>[fd].close()\n                <span class=\"hljs-keyword\">del</span> <span class=\"hljs-built_in\">map</span>[fd]\n                <span class=\"hljs-keyword\">continue</span>\n            <span class=\"hljs-built_in\">print</span>(data)\n            ep.unregister(fd)\n            ep.register(fd, POLLOUT)\n            <span class=\"hljs-comment\"># map[fd].send(b&apos;OK&apos;)</span>\n        <span class=\"hljs-keyword\">elif</span> event &amp; POLLOUT:\n            <span class=\"hljs-built_in\">map</span>[fd].send(<span class=\"hljs-string\">b&apos;OK&apos;</span>)\n            ep.unregister(fd) <span class=\"hljs-comment\"># &#x5148;&#x53d6;&#x6d88;&#x5173;&#x6ce8;&#x624d;&#x80fd;&#x518d;&#x91cd;&#x65b0;&#x6ce8;&#x518c;</span>\n            ep.register(fd, POLLIN)\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"103,156"}},{"content":"<pre data-lines=\"157,210\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nexercise_1.py\n\n&#x4f7f;&#x7528;IO&#x591a;&#x8def;&#x590d;&#x7528;&#x5b8c;&#x6210;&#x65e5;&#x5fd7;&#x586b;&#x5199;&#x7cfb;&#x7edf;\n\n  &#x5ba2;&#x6237;&#x7aef;&#x8fd0;&#x884c;&#x9519;&#x8bef;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4f1a;&#x5c06;&#x9519;&#x8bef;&#x4fe1;&#x606f;&#x53d1;&#x9001;&#x7ed9;&#x670d;&#x52a1;&#x7aef;\n &#xff08;&#x4f7f;&#x7528;tcp&#x5ba2;&#x6237;&#x7aef;&#x6a21;&#x62df;&#xff0c;&#x4e0d;&#x5b9a;&#x65f6;&#x7ed9;&#x670d;&#x52a1;&#x7aef;&#x53d1;&#x9001;&#x4fe1;&#x606f;&#xff0c;&#x8868;&#x793a;&#x9519;&#x8bef;&#x4fe1;&#x606f;&#xff09;\n\n  &#x670d;&#x52a1;&#x7aef;&#x7ef4;&#x62a4;&#x4eba;&#x5458;&#x4e5f;&#x53ef;&#x4ee5;&#x624b;&#x52a8;&#x7684;&#x6dfb;&#x52a0;&#x9519;&#x8bef;&#x65e5;&#x5fd7;&#xff0c;&#x7531;&#x7ec8;&#x7aef;&#x8f93;&#x5165;&#x5185;&#x5bb9;&#xff0c;\n  &#x5199;&#x5165;&#x65e5;&#x5fd7;    io&#x5bf9;&#x8c61;&#xff1a; sys.stdin\n\n  &#x65e5;&#x5fd7;&#x5185;&#x5bb9;&#x5305;&#x542b;&#x65f6;&#x95f4;&#x548c;&#x9519;&#x8bef;&#x4fe1;&#x606f;   &#x65e5;&#x5fd7;&#x540d;&#x5b57; test.log\n&quot;&quot;&quot;</span>\n\n<span class=\"hljs-keyword\">from</span> socket <span class=\"hljs-keyword\">import</span> *\n<span class=\"hljs-keyword\">from</span> select <span class=\"hljs-keyword\">import</span> select\n<span class=\"hljs-keyword\">import</span> sys\n<span class=\"hljs-keyword\">import</span> time\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x76d1;&#x542c;&#x5957;&#x63a5;&#x5b57;</span>\ns = socket()\ns.setsockopt(SOL_SOCKET,SO_REUSEADDR,<span class=\"hljs-number\">1</span>)\ns.bind((<span class=\"hljs-string\">&apos;127.0.0.1&apos;</span>,<span class=\"hljs-number\">8888</span>))\ns.listen(<span class=\"hljs-number\">3</span>)\n\nf = <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&apos;test.log&apos;</span>,<span class=\"hljs-string\">&apos;a&apos;</span>) <span class=\"hljs-comment\"># &#x65e5;&#x5fd7;</span>\n\n<span class=\"hljs-comment\"># &#x8bbe;&#x7f6e;&#x5173;&#x6ce8;&#x5217;&#x8868;</span>\nrlist = [s,sys.stdin]\nwlist = []\nxlist = []\n\n<span class=\"hljs-comment\"># &#x5faa;&#x73af;&#x76d1;&#x63a7;IO</span>\n<span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n    rs,ws,xs = select(rlist,wlist,xlist)\n    <span class=\"hljs-keyword\">for</span> r <span class=\"hljs-keyword\">in</span> rs:\n        <span class=\"hljs-keyword\">if</span> r <span class=\"hljs-keyword\">is</span> s:\n            c, addr = r.accept()\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Connect from&quot;</span>, addr)\n            rlist.append(c) <span class=\"hljs-comment\"># &#x589e;&#x52a0;&#x65b0;&#x7684;IO</span>\n        <span class=\"hljs-keyword\">elif</span> r <span class=\"hljs-keyword\">is</span> sys.stdin:\n            data = r.readline()\n            msg = <span class=\"hljs-string\">&quot;%s : %s&quot;</span>%(time.ctime(),data)\n            f.write(msg)\n            f.flush()\n        <span class=\"hljs-keyword\">else</span>:\n            data = r.recv(<span class=\"hljs-number\">1024</span>).decode()\n            msg = <span class=\"hljs-string\">&quot;%s : %s\\n&quot;</span>%(time.ctime(),data)\n            f.write(msg)\n            f.flush()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"157,210"}},{"content":"<pre data-lines=\"211,263\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nexercise_1_1.py\n\nepoll&#x65b9;&#x6cd5; server\n&#x91cd;&#x70b9;&#x4ee3;&#x7801;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> socket <span class=\"hljs-keyword\">import</span> *\n<span class=\"hljs-keyword\">from</span> select <span class=\"hljs-keyword\">import</span> *\n<span class=\"hljs-keyword\">import</span> sys\n<span class=\"hljs-keyword\">import</span> time\n\nf = <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&apos;test.log&apos;</span>,<span class=\"hljs-string\">&apos;a&apos;</span>) <span class=\"hljs-comment\"># &#x65e5;&#x5fd7;</span>\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x76d1;&#x542c;&#x5957;&#x63a5;&#x5b57;</span>\ns = socket()\ns.setsockopt(SOL_SOCKET,SO_REUSEADDR,<span class=\"hljs-number\">1</span>)\ns.bind((<span class=\"hljs-string\">&apos;0.0.0.0&apos;</span>,<span class=\"hljs-number\">8888</span>))\ns.listen(<span class=\"hljs-number\">3</span>)\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;epoll&#x5bf9;&#x8c61;</span>\nep = epoll()\n\n<span class=\"hljs-comment\"># &#x67e5;&#x627e;&#x5b57;&#x5178;&#xff0c;&#x7528;&#x4e8e;&#x901a;&#x8fc7;&#x6587;&#x4ef6;&#x63cf;&#x8ff0;&#x7b26;&#x67e5;&#x627e;&#x5bf9;&#x8c61;</span>\n<span class=\"hljs-comment\"># &#x65f6;&#x523b;&#x4e0e;&#x5173;&#x6ce8;&#x7684;IO&#x4fdd;&#x6301;&#x4e00;&#x76f4;</span>\n<span class=\"hljs-built_in\">map</span> = {s.fileno():s,sys.stdin.fileno():sys.stdin}\nep.register(s,EPOLLIN) <span class=\"hljs-comment\"># &#x5173;&#x6ce8;s</span>\nep.register(sys.stdin,EPOLLIN) <span class=\"hljs-comment\"># &#x5173;&#x6ce8;s</span>\n\n<span class=\"hljs-comment\">#&#x5faa;&#x73af;&#x76d1;&#x63a7;&#xff29;&#xff2f;</span>\n<span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n    events = ep.poll() <span class=\"hljs-comment\">#&#x3000;&#x5c06;&#x5173;&#x6ce8;&#xff29;&#xff2f;&#x63d0;&#x4ea4;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x76d1;&#x63a7;</span>\n    <span class=\"hljs-keyword\">for</span> fd,event <span class=\"hljs-keyword\">in</span> events:\n        <span class=\"hljs-comment\"># &#x533a;&#x5206;IO</span>\n        <span class=\"hljs-keyword\">if</span> fd == s.fileno():\n            c,addr = <span class=\"hljs-built_in\">map</span>[fd].accept()\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Connect from&quot;</span>,addr)\n            ep.register(c,EPOLLIN) <span class=\"hljs-comment\"># &#x6dfb;&#x52a0;&#x5173;&#x6ce8;</span>\n            <span class=\"hljs-built_in\">map</span>[c.fileno()] = c <span class=\"hljs-comment\"># &#x7ef4;&#x62a4;&#x5b57;&#x5178;</span>\n        <span class=\"hljs-keyword\">elif</span> fd == sys.stdin.fileno():\n            data = <span class=\"hljs-built_in\">map</span>[fd].readline()\n            msg = <span class=\"hljs-string\">&quot;%s : %s&quot;</span> % (time.ctime(), data)\n            f.write(msg)\n            f.flush()\n        <span class=\"hljs-keyword\">elif</span> event &amp; EPOLLIN:\n            <span class=\"hljs-comment\"># &#x786e;&#x4fdd;epollin&#x5c31;&#x7eea;&#x6267;&#x884c;&#x8fd9;&#x4e00;&#x6bb5;</span>\n            data = <span class=\"hljs-built_in\">map</span>[fd].recv(<span class=\"hljs-number\">1024</span>).decode()\n            msg = <span class=\"hljs-string\">&quot;%s : %s\\n&quot;</span> % (time.ctime(), data)\n            f.write(msg)\n            f.flush()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"211,263"}},{"content":"<pre data-lines=\"264,315\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\npoll_server.py\n\npoll&#x65b9;&#x6cd5; server\n&#x91cd;&#x70b9;&#x4ee3;&#x7801;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> socket <span class=\"hljs-keyword\">import</span> *\n<span class=\"hljs-keyword\">from</span> select <span class=\"hljs-keyword\">import</span> *\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x76d1;&#x542c;&#x5957;&#x63a5;&#x5b57;</span>\ns = socket()\ns.setsockopt(SOL_SOCKET,SO_REUSEADDR,<span class=\"hljs-number\">1</span>)\ns.bind((<span class=\"hljs-string\">&apos;0.0.0.0&apos;</span>,<span class=\"hljs-number\">8888</span>))\ns.listen(<span class=\"hljs-number\">3</span>)\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;poll&#x5bf9;&#x8c61;</span>\np = poll()\n\n<span class=\"hljs-comment\"># &#x67e5;&#x627e;&#x5b57;&#x5178;&#xff0c;&#x7528;&#x4e8e;&#x901a;&#x8fc7;&#x6587;&#x4ef6;&#x63cf;&#x8ff0;&#x7b26;&#x67e5;&#x627e;&#x5bf9;&#x8c61;</span>\n<span class=\"hljs-comment\"># &#x65f6;&#x523b;&#x4e0e;&#x5173;&#x6ce8;&#x7684;IO&#x4fdd;&#x6301;&#x4e00;&#x76f4;</span>\n<span class=\"hljs-built_in\">map</span> = {s.fileno():s}\np.register(s,POLLIN) <span class=\"hljs-comment\"># &#x5173;&#x6ce8;s</span>\n\n<span class=\"hljs-comment\">#&#x5faa;&#x73af;&#x76d1;&#x63a7;&#xff29;&#xff2f;</span>\n<span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n    <span class=\"hljs-comment\"># [(fd,event),()]</span>\n    events = p.poll() <span class=\"hljs-comment\">#&#x3000;&#x5c06;&#x5173;&#x6ce8;&#xff29;&#xff2f;&#x63d0;&#x4ea4;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x76d1;&#x63a7;</span>\n    <span class=\"hljs-keyword\">for</span> fd,event <span class=\"hljs-keyword\">in</span> events:\n        <span class=\"hljs-comment\"># &#x533a;&#x5206;IO</span>\n        <span class=\"hljs-keyword\">if</span> fd == s.fileno():\n            c,addr = <span class=\"hljs-built_in\">map</span>[fd].accept()\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Connect from&quot;</span>,addr)\n            p.register(c,POLLIN|POLLPRI) <span class=\"hljs-comment\"># &#x6dfb;&#x52a0;&#x5173;&#x6ce8;</span>\n            <span class=\"hljs-built_in\">map</span>[c.fileno()] = c <span class=\"hljs-comment\"># &#x7ef4;&#x62a4;&#x5b57;&#x5178;</span>\n        <span class=\"hljs-keyword\">elif</span> event &amp; POLLIN:\n            <span class=\"hljs-comment\"># &#x786e;&#x4fdd;pollin&#x5c31;&#x7eea;&#x6267;&#x884c;&#x8fd9;&#x4e00;&#x6bb5;</span>\n            data = <span class=\"hljs-built_in\">map</span>[fd].recv(<span class=\"hljs-number\">1024</span>).decode()\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> data:\n                p.unregister(fd) <span class=\"hljs-comment\"># &#x53d6;&#x6d88;&#x5173;&#x6ce8;</span>\n                <span class=\"hljs-built_in\">map</span>[fd].close()\n                <span class=\"hljs-keyword\">del</span> <span class=\"hljs-built_in\">map</span>[fd]\n                <span class=\"hljs-keyword\">continue</span>\n            <span class=\"hljs-built_in\">print</span>(data)\n            p.register(fd,POLLOUT)\n            <span class=\"hljs-built_in\">map</span>[fd].send(<span class=\"hljs-string\">b&apos;OK&apos;</span>)\n        <span class=\"hljs-comment\"># elif event &amp; POLLOUT:</span>\n        <span class=\"hljs-comment\">#     map[fd].send(b&apos;OK&apos;)</span>\n        <span class=\"hljs-comment\">#     p.register(fd, POLLIN)</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"264,315"}},{"content":"<pre data-lines=\"316,363\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nselect _server.py\n\nselect tcp &#x5e76;&#x53d1;&#x670d;&#x52a1;\n&#x91cd;&#x70b9;&#x4ee3;&#x7801;\n&quot;&quot;&quot;</span>\n\n<span class=\"hljs-keyword\">from</span> socket <span class=\"hljs-keyword\">import</span> *\n<span class=\"hljs-keyword\">from</span> select <span class=\"hljs-keyword\">import</span> select\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x76d1;&#x542c;&#x5957;&#x63a5;&#x5b57;</span>\ns = socket()\ns.setsockopt(SOL_SOCKET,SO_REUSEADDR,<span class=\"hljs-number\">1</span>)\ns.bind((<span class=\"hljs-string\">&apos;0.0.0.0&apos;</span>,<span class=\"hljs-number\">8888</span>))\ns.listen(<span class=\"hljs-number\">3</span>)\n\n<span class=\"hljs-comment\"># &#x8bbe;&#x7f6e;&#x5173;&#x6ce8;&#x5217;&#x8868;</span>\nrlist = [s]\nwlist = []\nxlist = []\n\n<span class=\"hljs-comment\"># &#x5faa;&#x73af;&#x76d1;&#x63a7;IO</span>\n<span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n    rs,ws,xs = select(rlist,wlist,xlist)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;rlist:&quot;</span>,rs)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;wlist:&quot;</span>,ws)\n    <span class=\"hljs-keyword\">for</span> r <span class=\"hljs-keyword\">in</span> rs:\n        <span class=\"hljs-keyword\">if</span> r <span class=\"hljs-keyword\">is</span> s:\n            c, addr = r.accept()\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Connect from&quot;</span>, addr)\n            rlist.append(c) <span class=\"hljs-comment\"># &#x589e;&#x52a0;&#x65b0;&#x7684;IO</span>\n        <span class=\"hljs-keyword\">else</span>:\n            data = r.recv(<span class=\"hljs-number\">1024</span>).decode()\n            <span class=\"hljs-comment\"># &#x5ba2;&#x6237;&#x7aef;&#x9000;&#x51fa;</span>\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> data:\n                rlist.remove(r) <span class=\"hljs-comment\"># &#x4e0d;&#x518d;&#x5173;&#x6ce8;&#x8fd9;&#x4e2a;IO</span>\n                r.close()\n                <span class=\"hljs-keyword\">continue</span>\n            <span class=\"hljs-built_in\">print</span>(data)\n            <span class=\"hljs-comment\"># r.send(b&apos;OK&apos;)</span>\n            wlist.append(r)\n\n    <span class=\"hljs-keyword\">for</span> w <span class=\"hljs-keyword\">in</span> ws:\n        w.send(<span class=\"hljs-string\">b&apos;OK&apos;</span>)\n        wlist.remove(w) <span class=\"hljs-comment\"># &#x53d1;&#x5b8c;&#x6d88;&#x606f;&#x8981;&#x5220;&#x9664;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"316,363"}},{"content":"<pre data-lines=\"364,411\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nselect_server.py\n\nselect tcp &#x5e76;&#x53d1;&#x670d;&#x52a1;\n&#x91cd;&#x70b9;&#x4ee3;&#x7801;\n&quot;&quot;&quot;</span>\n\n<span class=\"hljs-keyword\">from</span> socket <span class=\"hljs-keyword\">import</span> *\n<span class=\"hljs-keyword\">from</span> select <span class=\"hljs-keyword\">import</span> select\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x76d1;&#x542c;&#x5957;&#x63a5;&#x5b57;</span>\ns = socket()\ns.setsockopt(SOL_SOCKET,SO_REUSEADDR,<span class=\"hljs-number\">1</span>)\ns.bind((<span class=\"hljs-string\">&apos;0.0.0.0&apos;</span>,<span class=\"hljs-number\">8888</span>))\ns.listen(<span class=\"hljs-number\">3</span>)\n\n<span class=\"hljs-comment\"># &#x8bbe;&#x7f6e;&#x5173;&#x6ce8;&#x5217;&#x8868;</span>\nrlist = [s]\nwlist = []\nxlist = []\n\n<span class=\"hljs-comment\"># &#x5faa;&#x73af;&#x76d1;&#x63a7;IO</span>\n<span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n    rs,ws,xs = select(rlist,wlist,xlist)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;rlist:&quot;</span>,rs)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;wlist:&quot;</span>,ws)\n    <span class=\"hljs-keyword\">for</span> r <span class=\"hljs-keyword\">in</span> rs:\n        <span class=\"hljs-keyword\">if</span> r <span class=\"hljs-keyword\">is</span> s:\n            c, addr = r.accept()\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Connect from&quot;</span>, addr)\n            rlist.append(c) <span class=\"hljs-comment\"># &#x589e;&#x52a0;&#x65b0;&#x7684;IO</span>\n        <span class=\"hljs-keyword\">else</span>:\n            data = r.recv(<span class=\"hljs-number\">1024</span>).decode()\n            <span class=\"hljs-comment\"># &#x5ba2;&#x6237;&#x7aef;&#x9000;&#x51fa;</span>\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> data:\n                rlist.remove(r) <span class=\"hljs-comment\"># &#x4e0d;&#x518d;&#x5173;&#x6ce8;&#x8fd9;&#x4e2a;IO</span>\n                r.close()\n                <span class=\"hljs-keyword\">continue</span>\n            <span class=\"hljs-built_in\">print</span>(data)\n            <span class=\"hljs-comment\"># r.send(b&apos;OK&apos;)</span>\n            wlist.append(r)\n\n    <span class=\"hljs-keyword\">for</span> w <span class=\"hljs-keyword\">in</span> ws:\n        w.send(<span class=\"hljs-string\">b&apos;OK&apos;</span>)\n        wlist.remove(w) <span class=\"hljs-comment\"># &#x53d1;&#x5b8c;&#x6d88;&#x606f;&#x8981;&#x5220;&#x9664;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"364,411"}},{"content":"<pre data-lines=\"412,437\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nselect_test.py\n\nselect &#x51fd;&#x6570;&#x793a;&#x4f8b;\n&quot;&quot;&quot;</span>\n\n<span class=\"hljs-keyword\">from</span> select <span class=\"hljs-keyword\">import</span> select\n<span class=\"hljs-keyword\">from</span> socket <span class=\"hljs-keyword\">import</span> *\n\ns1 = socket()\ns1.bind((<span class=\"hljs-string\">&apos;0.0.0.0&apos;</span>,<span class=\"hljs-number\">8888</span>))\ns1.listen(<span class=\"hljs-number\">3</span>)\n\ns2 = socket(AF_INET,SOCK_DGRAM)\ns2.bind((<span class=\"hljs-string\">&apos;0.0.0.0&apos;</span>,<span class=\"hljs-number\">8889</span>))\n\nf = <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&apos;test.log&apos;</span>,<span class=\"hljs-string\">&apos;r+&apos;</span>)\n\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x76d1;&#x63a7;IO&quot;</span>)\nrs,ws,xs = select([s1,s2,f],[s2],[])\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;rlist:&quot;</span>,rs)\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;wlist:&quot;</span>,ws)\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;xlist:&quot;</span>,xs)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"412,437"}},{"content":"<pre data-lines=\"438,464\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\ntcp_client.py\n\ntcp&#x5ba2;&#x6237;&#x7aef;&#x6d41;&#x7a0b;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> socket <span class=\"hljs-keyword\">import</span> *\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">import</span> random\n\n<span class=\"hljs-comment\"># &#x9ed8;&#x8ba4;&#x60c5;&#x51b5;&#x5c31;&#x662f;tcp&#x5957;&#x63a5;&#x5b57;</span>\nsockfd = socket()\n\n<span class=\"hljs-comment\"># &#x8fde;&#x63a5;&#x670d;&#x52a1;&#x5668;</span>\nserver_addr = (<span class=\"hljs-string\">&apos;127.0.0.1&apos;</span>,<span class=\"hljs-number\">8888</span>)\nsockfd.connect(server_addr)\n\n<span class=\"hljs-comment\"># &#x53d1;&#x6536;&#x6d88;&#x606f;</span>\n<span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n    time.sleep(random.randint(<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">8</span>))\n    msg = <span class=\"hljs-string\">&quot;&#x5ba2;&#x6237;&#x7aef;&#x9519;&#x8bef;&quot;</span>\n    sockfd.send(msg.encode()) <span class=\"hljs-comment\"># &#x8981;&#x53d1;&#x9001;&#x5b57;&#x8282;&#x4e32;</span>\n\n\nsockfd.close()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"438,464"}}],"payload":{"tag":"h5","lines":"61,62"}}],"payload":{"tag":"h3","lines":"2,3"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
