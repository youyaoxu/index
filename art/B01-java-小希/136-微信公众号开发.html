<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"&#x5fae;&#x4fe1;&#x516c;&#x4f17;&#x53f7;&#x5f00;&#x53d1;","children":[{"content":"&#x8ba4;&#x8bc6;","children":[{"content":"<pre data-lines=\"5,9\"><code>&gt; *   &#x5fae;&#x4fe1;&#x5b98;&#x65b9;&#x6587;&#x6863;&#xff1a;https://developers.weixin.qq.com/doc/\n&gt; *   &#x63a5;&#x53e3;&#x6d4b;&#x8bd5;&#x5e10;&#x53f7;&#xff1a;https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login\n&gt; *   &#x514d;&#x8d39;&#x5185;&#x7f51;&#x7a7f;&#x900f;&#xff1a;https://hsk.oray.com/\n&gt; *   &#x6587;&#x6863;&#x914d;&#x5957;&#x8d44;&#x6599;&#xff1a;https://pan.baidu.com/s/1V-rLHApAPpICFFStwANpFw&#xff0c;&#x63d0;&#x53d6;&#x7801;&#xff1a;4fea\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5,9"}}],"payload":{"tag":"h2","lines":"2,4"}},{"content":"1.1&#x3001;&#x5f00;&#x53d1;&#x5de5;&#x5177;","children":[{"content":"<pre data-lines=\"13,17\"><code>*   IntelliJ IDEA 2021.1\n*   Maven 3.6.3\n*   Java 1.8.0\\_291\n*   &#x82b1;&#x751f;&#x58f3; 8.1.0.39177\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"13,17"}}],"payload":{"tag":"h2","lines":"10,12"}},{"content":"1.2&#x3001;&#x521b;&#x5efa;&#x5de5;&#x7a0b;","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b0d257ac75bc581fce9c9f115bf32928.png\" alt>","children":[],"payload":{"tag":"img","lines":"21,22"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/4dcede2d0b3cc41211369ab102556680.png\" alt>","children":[],"payload":{"tag":"img","lines":"23,24"}}],"payload":{"tag":"h2","lines":"18,20"}},{"content":"1.3&#x3001;&#x6dfb;&#x52a0;&#x4f9d;&#x8d56;","children":[{"content":"<pre data-lines=\"28,61\"><code class=\"language-xml\">\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.commons<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>commons-lang3<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.12.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>commons-codec<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>commons-codec<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.15<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>commons-beanutils<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>commons-beanutils<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.9.4<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>dom4j<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>dom4j<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.6.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>fastjson<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.2.76<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"28,61"}}],"payload":{"tag":"h2","lines":"25,27"}},{"content":"1.4&#x3001;&#x6dfb;&#x52a0;&#x6a21;&#x677f;","children":[{"content":"<pre data-lines=\"65,81\"><code class=\"language-java\"><span class=\"hljs-meta\">@SpringBootApplication</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">WcoaApiDemoApplication</span> {\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        SpringApplication.run(WcoaApiDemoApplication.class, args);\n    }\n\n    <span class=\"hljs-meta\">@Bean</span>\n    <span class=\"hljs-keyword\">public</span> RestTemplate <span class=\"hljs-title function_\">restTemplate</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RestTemplate</span>();\n    }\n\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"65,81"}}],"payload":{"tag":"h2","lines":"62,64"}},{"content":"1.5&#x3001;&#x6d4b;&#x8bd5;&#x63a5;&#x53e3;","children":[{"content":"<pre data-lines=\"85,86\"><code>io.caochenlei.wcoa.api.demo.controller.HelloController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"85,86"}},{"content":"<pre data-lines=\"87,97\"><code class=\"language-java\"><span class=\"hljs-meta\">@RestController</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">HelloController</span> {\n    <span class=\"hljs-meta\">@GetMapping(&quot;/hello&quot;)</span>\n    <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">hello</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;Hello,World!&quot;</span>;\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"87,97"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/3e9d781bdaec9878bb008358ac26a15b.png\" alt>","children":[],"payload":{"tag":"img","lines":"98,99"}}],"payload":{"tag":"h2","lines":"82,84"}},{"content":"1.6&#x3001;&#x5185;&#x7f51;&#x7a7f;&#x900f;","children":[{"content":"<pre data-lines=\"103,104\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://console.hsk.oray.com/forward\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"103,104"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1dd0a9f397afab3d3a70c0a66ea63fc6.png\" alt>","children":[],"payload":{"tag":"img","lines":"105,106"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/24d4380bc9435b2d3ca25b731031e964.png\" alt>","children":[],"payload":{"tag":"img","lines":"107,108"}}],"payload":{"tag":"h2","lines":"100,102"}},{"content":"1.7&#x3001;&#x63a5;&#x5165;&#x6307;&#x5357;","children":[{"content":"<pre data-lines=\"112,115\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;      https://developers.weixin.qq.com/doc/offiaccount/Basic\\_Information/Access\\_Overview.html\n\nio.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"112,115"}},{"content":"<pre data-lines=\"116,142\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-meta\">@RestController</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">WcoaController</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">token</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;caochenlei521&quot;</span>;\n\n    <span class=\"hljs-meta\">@GetMapping(&quot;/wechat&quot;)</span>\n    <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">access</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;signature&quot;)</span> String signature,\n                         <span class=\"hljs-meta\">@RequestParam(&quot;timestamp&quot;)</span> String timestamp,\n                         <span class=\"hljs-meta\">@RequestParam(&quot;nonce&quot;)</span> String nonce,\n                         <span class=\"hljs-meta\">@RequestParam(&quot;echostr&quot;)</span> String echostr)</span> {\n        String[] params = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>[]{token, timestamp, nonce};\n        Arrays.sort(params);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">joinParams</span> <span class=\"hljs-operator\">=</span> StringUtils.join(params);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">sha1Params</span> <span class=\"hljs-operator\">=</span> DigestUtils.sha1Hex(joinParams);\n        <span class=\"hljs-keyword\">if</span> (sha1Params.equals(signature)) {\n            log.info(<span class=\"hljs-string\">&quot;&#x63a5;&#x5165;&#x5fae;&#x4fe1;&#x516c;&#x4f17;&#x5e73;&#x53f0;&#x6210;&#x529f;&#xff01;&quot;</span>);\n            <span class=\"hljs-keyword\">return</span> echostr;\n        } <span class=\"hljs-keyword\">else</span> {\n            log.info(<span class=\"hljs-string\">&quot;&#x63a5;&#x5165;&#x5fae;&#x4fe1;&#x516c;&#x4f17;&#x5e73;&#x53f0;&#x5931;&#x8d25;&#xff01;&quot;</span>);\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;illegal&quot;</span>;\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"116,142"}},{"content":"<pre data-lines=\"143,144\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"143,144"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/80b180a1553e44d1c19da33aa1066755.png\" alt>","children":[],"payload":{"tag":"img","lines":"145,146"}}],"payload":{"tag":"h2","lines":"109,111"}},{"content":"2.1&#x3001;&#x83b7;&#x53d6; AccessToken &#x4ee4;&#x724c;","children":[{"content":"<pre data-lines=\"150,153\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://developers.weixin.qq.com/doc/offiaccount/Basic\\_Information/Get\\_access\\_token.html\n\nio.caochenlei.wcoa.api.demo.domain.AccessToken\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"150,153"}},{"content":"<pre data-lines=\"154,173\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AccessToken</span> {\n    <span class=\"hljs-meta\">@JsonProperty(&quot;access_token&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String accessToken;\n    <span class=\"hljs-meta\">@JsonProperty(&quot;expires_in&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> Long expiresIn;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">setExpiresIn</span><span class=\"hljs-params\">(Long expiresIn)</span> {\n        <span class=\"hljs-built_in\">this</span>.expiresIn = System.currentTimeMillis() + expiresIn * <span class=\"hljs-number\">1000</span>;\n    }\n\n    <span class=\"hljs-meta\">@JsonIgnore</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">isExpired</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> System.currentTimeMillis() &gt; expiresIn;\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"154,173"}},{"content":"<pre data-lines=\"174,175\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"174,175"}},{"content":"<pre data-lines=\"176,195\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">APP_ID</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;wxafdce898abdebe78&quot;</span>;\n<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">APP_SECRET</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;45add7100b5cf5a9b8de655d5308d976&quot;</span>;\n<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">GET_ACCESS_TOKEN</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=APPID&amp;secret=APPSECRET&quot;</span>.replace(<span class=\"hljs-string\">&quot;APPID&quot;</span>, APP_ID).replace(<span class=\"hljs-string\">&quot;APPSECRET&quot;</span>, APP_SECRET);\n\n<span class=\"hljs-meta\">@Autowired</span>\n<span class=\"hljs-keyword\">private</span> RestTemplate restTemplate;\n<span class=\"hljs-keyword\">private</span> AccessToken accessToken;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/getAccessToken&quot;)</span>\n<span class=\"hljs-keyword\">public</span> AccessToken <span class=\"hljs-title function_\">getAccessToken</span><span class=\"hljs-params\">()</span> {\n    <span class=\"hljs-keyword\">if</span> (accessToken == <span class=\"hljs-literal\">null</span> || accessToken.isExpired()) {\n        accessToken = restTemplate.getForObject(GET_ACCESS_TOKEN, AccessToken.class);\n        log.info(<span class=\"hljs-string\">&quot;&#x83b7;&#x53d6;AccessToken&#x6210;&#x529f;!&quot;</span>);\n    }\n    <span class=\"hljs-keyword\">return</span> accessToken;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"176,195"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/6dc4257f0148a811e6d34eb2670d4897.png\" alt>","children":[],"payload":{"tag":"img","lines":"196,197"}}],"payload":{"tag":"h2","lines":"147,149"}},{"content":"2.2&#x3001;&#x83b7;&#x53d6;&#x5fae;&#x4fe1;API&#x63a5;&#x53e3;IP&#x5730;&#x5740;","children":[{"content":"<pre data-lines=\"201,204\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://developers.weixin.qq.com/doc/offiaccount/Basic\\_Information/Get\\_the\\_WeChat\\_server\\_IP\\_address.html\n\nio.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"201,204"}},{"content":"<pre data-lines=\"205,215\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">GET_API_DOMAIN_IP</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/cgi-bin/get_api_domain_ip?access_token=ACCESS_TOKEN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/getApiDomainIp&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">getApiDomainIp</span><span class=\"hljs-params\">()</span> {\n    <span class=\"hljs-type\">AccessToken</span> <span class=\"hljs-variable\">accessToken</span> <span class=\"hljs-operator\">=</span> getAccessToken();\n    <span class=\"hljs-keyword\">return</span> restTemplate.getForObject(GET_API_DOMAIN_IP.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken.getAccessToken()), String.class);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"205,215"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1ba587e4c2e97ad3d83eeeea3d827362.png\" alt>","children":[],"payload":{"tag":"img","lines":"216,217"}}],"payload":{"tag":"h2","lines":"198,200"}},{"content":"2.3&#x3001;&#x83b7;&#x53d6;&#x5fae;&#x4fe1;API&#x56de;&#x8c03;IP&#x5730;&#x5740;","children":[{"content":"<pre data-lines=\"221,224\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://developers.weixin.qq.com/doc/offiaccount/Basic\\_Information/Get\\_the\\_WeChat\\_server\\_IP\\_address.html\n\nio.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"221,224"}},{"content":"<pre data-lines=\"225,235\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">GET_API_CALLBACK_IP</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/cgi-bin/getcallbackip?access_token=ACCESS_TOKEN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/getApiCallbackIp&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">getApiCallbackIp</span><span class=\"hljs-params\">()</span> {\n    <span class=\"hljs-type\">AccessToken</span> <span class=\"hljs-variable\">accessToken</span> <span class=\"hljs-operator\">=</span> getAccessToken();\n    <span class=\"hljs-keyword\">return</span> restTemplate.getForObject(GET_API_CALLBACK_IP.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken.getAccessToken()), String.class);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"225,235"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/9b57b7bf62589af217a7931cd32f67a5.png\" alt>","children":[],"payload":{"tag":"img","lines":"236,237"}}],"payload":{"tag":"h2","lines":"218,220"}},{"content":"3.1&#x3001;&#x63a5;&#x6536;&#x666e;&#x901a;&#x6d88;&#x606f;","children":[{"content":"<pre data-lines=\"241,242\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://developers.weixin.qq.com/doc/offiaccount/Message\\_Management/Receiving\\_standard\\_messages.html\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"241,242"}},{"content":"<pre data-lines=\"245,246\"><code>io.caochenlei.wcoa.api.demo.domain.msg.BaseMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"245,246"}},{"content":"<pre data-lines=\"247,258\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BaseMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String toUserName;\n    <span class=\"hljs-keyword\">private</span> String fromUserName;\n    <span class=\"hljs-keyword\">private</span> Long createTime;\n    <span class=\"hljs-keyword\">private</span> String msgType;\n    <span class=\"hljs-keyword\">private</span> String msgId;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"247,258"}},{"content":"<pre data-lines=\"259,260\"><code>io.caochenlei.wcoa.api.demo.domain.msg.TextMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"259,260"}},{"content":"<pre data-lines=\"261,269\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TextMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String content;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"261,269"}},{"content":"<pre data-lines=\"270,271\"><code>io.caochenlei.wcoa.api.demo.domain.msg.ImageMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"270,271"}},{"content":"<pre data-lines=\"272,281\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ImageMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String picUrl;\n    <span class=\"hljs-keyword\">private</span> String mediaId;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"272,281"}},{"content":"<pre data-lines=\"282,283\"><code>io.caochenlei.wcoa.api.demo.domain.msg.VoiceMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"282,283"}},{"content":"<pre data-lines=\"284,293\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">VoiceMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String mediaId;\n    <span class=\"hljs-keyword\">private</span> String format;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"284,293"}},{"content":"<pre data-lines=\"294,295\"><code>io.caochenlei.wcoa.api.demo.domain.msg.VideoMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"294,295"}},{"content":"<pre data-lines=\"296,305\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">VideoMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String mediaId;\n    <span class=\"hljs-keyword\">private</span> String thumbMediaId;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"296,305"}},{"content":"<pre data-lines=\"306,307\"><code>io.caochenlei.wcoa.api.demo.domain.msg.LocationMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"306,307"}},{"content":"<pre data-lines=\"308,319\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">LocationMessage</span>  <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String location_X;\n    <span class=\"hljs-keyword\">private</span> String location_Y;\n    <span class=\"hljs-keyword\">private</span> Long scale;\n    <span class=\"hljs-keyword\">private</span> String label;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"308,319"}},{"content":"<pre data-lines=\"320,321\"><code>io.caochenlei.wcoa.api.demo.domain.msg.LinkMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"320,321"}},{"content":"<pre data-lines=\"322,332\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">LinkMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseMessage</span>{\n    <span class=\"hljs-keyword\">private</span> String title;\n    <span class=\"hljs-keyword\">private</span> String description;\n    <span class=\"hljs-keyword\">private</span> String url;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"322,332"}},{"content":"<pre data-lines=\"333,334\"><code>io.caochenlei.wcoa.api.demo.domain.msg.FileMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"333,334"}},{"content":"<pre data-lines=\"335,347\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">FileMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseMessage</span>{\n    <span class=\"hljs-keyword\">private</span> String title;\n    <span class=\"hljs-keyword\">private</span> String description;\n    <span class=\"hljs-keyword\">private</span> String fileKey;\n    <span class=\"hljs-keyword\">private</span> String fileMd5;\n    <span class=\"hljs-keyword\">private</span> String fileTotalLen;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"335,347"}},{"content":"<pre data-lines=\"348,349\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"348,349"}},{"content":"<pre data-lines=\"350,484\"><code class=\"language-java\"><span class=\"hljs-meta\">@PostMapping(value = &quot;/wechat&quot;, produces = &quot;application/xml;charset=UTF-8&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">notification</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestBody</span> String body)</span> {\n    <span class=\"hljs-keyword\">try</span> {\n        Map&lt;String, String&gt; parse = parseXmlToMap(body);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">msgType</span> <span class=\"hljs-operator\">=</span> parse.get(<span class=\"hljs-string\">&quot;msgType&quot;</span>);\n        <span class=\"hljs-keyword\">switch</span> (msgType) {\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;text&quot;</span>:\n                <span class=\"hljs-type\">TextMessage</span> <span class=\"hljs-variable\">textMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TextMessage</span>();\n                BeanUtils.populate(textMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, textMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;image&quot;</span>:\n                <span class=\"hljs-type\">ImageMessage</span> <span class=\"hljs-variable\">imageMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ImageMessage</span>();\n                BeanUtils.populate(imageMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, imageMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;voice&quot;</span>:\n                <span class=\"hljs-type\">VoiceMessage</span> <span class=\"hljs-variable\">voiceMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">VoiceMessage</span>();\n                BeanUtils.populate(voiceMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, voiceMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;video&quot;</span>:\n                <span class=\"hljs-type\">VideoMessage</span> <span class=\"hljs-variable\">videoMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">VideoMessage</span>();\n                BeanUtils.populate(videoMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, videoMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;location&quot;</span>:\n                <span class=\"hljs-type\">LocationMessage</span> <span class=\"hljs-variable\">locationMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LocationMessage</span>();\n                BeanUtils.populate(locationMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, locationMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;link&quot;</span>:\n                <span class=\"hljs-type\">LinkMessage</span> <span class=\"hljs-variable\">linkMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LinkMessage</span>();\n                BeanUtils.populate(linkMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, linkMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;file&quot;</span>:\n                <span class=\"hljs-type\">FileMessage</span> <span class=\"hljs-variable\">fileMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FileMessage</span>();\n                BeanUtils.populate(fileMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, fileMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;event&quot;</span>:\n                eventHandle(parse);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">default</span>:\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, <span class=\"hljs-string\">&quot;&#x672a;&#x77e5;&#x6d88;&#x606f;!&quot;</span>);\n        }\n    } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n        e.printStackTrace();\n    }\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;error&quot;</span>;\n}\n\n\n<span class=\"hljs-keyword\">private</span> String <span class=\"hljs-title function_\">eventHandle</span><span class=\"hljs-params\">(Map&lt;String, String&gt; parse)</span> {\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;error&quot;</span>;\n}\n\n\n<span class=\"hljs-keyword\">private</span> Map&lt;String, String&gt; <span class=\"hljs-title function_\">parseXmlToMap</span><span class=\"hljs-params\">(String body)</span> {\n    Map&lt;String, String&gt; map = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    <span class=\"hljs-keyword\">try</span> {\n        <span class=\"hljs-type\">Document</span> <span class=\"hljs-variable\">document</span> <span class=\"hljs-operator\">=</span> DocumentHelper.parseText(body);\n        <span class=\"hljs-type\">Element</span> <span class=\"hljs-variable\">root</span> <span class=\"hljs-operator\">=</span> document.getRootElement();\n        List&lt;Element&gt; elements = root.elements();\n        <span class=\"hljs-keyword\">for</span> (Element element : elements) {\n            <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">key</span> <span class=\"hljs-operator\">=</span> element.getName();\n            <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">val</span> <span class=\"hljs-operator\">=</span> element.getStringValue();\n            map.put(StringUtils.uncapitalize(key), val);\n        }\n    } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n        e.printStackTrace();\n    }\n    <span class=\"hljs-keyword\">return</span> map;\n}\n\n\n<span class=\"hljs-keyword\">private</span> String <span class=\"hljs-title function_\">parseObjToXml</span><span class=\"hljs-params\">(Object obj)</span> {\n    <span class=\"hljs-keyword\">try</span> {\n        <span class=\"hljs-type\">Element</span> <span class=\"hljs-variable\">root</span> <span class=\"hljs-operator\">=</span> recursionParse(obj);\n        root.setName(<span class=\"hljs-string\">&quot;xml&quot;</span>);\n        <span class=\"hljs-type\">StringWriter</span> <span class=\"hljs-variable\">sw</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringWriter</span>();\n        <span class=\"hljs-type\">XMLWriter</span> <span class=\"hljs-variable\">xw</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">XMLWriter</span>(sw);\n        xw.write(root.getDocument());\n        xw.flush();\n        xw.close();\n        <span class=\"hljs-keyword\">return</span> sw.toString();\n    } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n        e.printStackTrace();\n    }\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;\n}\n\n<span class=\"hljs-keyword\">private</span> Element <span class=\"hljs-title function_\">recursionParse</span><span class=\"hljs-params\">(Object obj)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n    \n    Class&lt;?&gt; clazz = obj.getClass();\n    List&lt;Field&gt; fields = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayList</span>&lt;&gt;();\n    <span class=\"hljs-keyword\">while</span> (clazz != <span class=\"hljs-literal\">null</span>) {\n        fields.addAll(Arrays.asList(clazz.getDeclaredFields()));\n        clazz = clazz.getSuperclass();\n    }\n    \n    <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">clazzName</span> <span class=\"hljs-operator\">=</span> obj.getClass().getName();\n    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">index</span> <span class=\"hljs-operator\">=</span> clazzName.lastIndexOf(<span class=\"hljs-string\">&quot;.&quot;</span>);\n    clazzName = clazzName.substring(index + <span class=\"hljs-number\">1</span>);\n    \n    <span class=\"hljs-type\">Document</span> <span class=\"hljs-variable\">document</span> <span class=\"hljs-operator\">=</span> DocumentHelper.createDocument();\n    <span class=\"hljs-type\">Element</span> <span class=\"hljs-variable\">root</span> <span class=\"hljs-operator\">=</span> document.addElement(clazzName);\n    <span class=\"hljs-keyword\">for</span> (Field field : fields) {\n        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">&quot;serialVersionUID&quot;</span>.equals(field.getName())) <span class=\"hljs-keyword\">continue</span>;\n        field.setAccessible(<span class=\"hljs-literal\">true</span>);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">fieldName</span> <span class=\"hljs-operator\">=</span> StringUtils.capitalize(field.getName());\n        <span class=\"hljs-type\">Object</span> <span class=\"hljs-variable\">fieldValue</span> <span class=\"hljs-operator\">=</span> field.get(obj);\n        <span class=\"hljs-keyword\">if</span> (field.getType().getName().contains(<span class=\"hljs-string\">&quot;java.util.List&quot;</span>)) {\n            List&lt;Item&gt; items = (List&lt;Item&gt;) fieldValue;\n            <span class=\"hljs-keyword\">for</span> (Item item : items) {\n                <span class=\"hljs-type\">Element</span> <span class=\"hljs-variable\">itemRoot</span> <span class=\"hljs-operator\">=</span> recursionParse(item);\n                itemRoot.setName(<span class=\"hljs-string\">&quot;item&quot;</span>);\n                root.add(itemRoot);\n            }\n        } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (!field.getType().getName().contains(<span class=\"hljs-string\">&quot;java.lang&quot;</span>)) {\n            root.add(recursionParse(fieldValue));\n        } <span class=\"hljs-keyword\">else</span> {\n            <span class=\"hljs-keyword\">if</span> (fieldValue != <span class=\"hljs-literal\">null</span>) {\n                root.addElement(fieldName).setText(String.valueOf(fieldValue));\n            }\n        }\n    }\n    <span class=\"hljs-keyword\">return</span> root;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"350,484"}}],"payload":{"tag":"h2","lines":"238,240"}},{"content":"3.2&#x3001;&#x63a5;&#x6536;&#x4e8b;&#x4ef6;&#x63a8;&#x9001;","children":[{"content":"<pre data-lines=\"488,493\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;:https://developers.weixin.qq.com/doc/offiaccount/Message\\_Management/Receiving\\_event\\_pushes.html\n\n**&#x5b9a;&#x4e49;&#x63a5;&#x6536;&#x4e8b;&#x4ef6;&#x7c7b;&#x578b;**\n\nio.caochenlei.wcoa.api.demo.domain.event.BaseEventMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"488,493"}},{"content":"<pre data-lines=\"494,502\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BaseEventMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String event;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"494,502"}},{"content":"<pre data-lines=\"503,504\"><code>io.caochenlei.wcoa.api.demo.domain.event.LocationEventMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"503,504"}},{"content":"<pre data-lines=\"505,515\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">LocationEventMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseEventMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String latitude;\n    <span class=\"hljs-keyword\">private</span> String longitude;\n    <span class=\"hljs-keyword\">private</span> String precision;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"505,515"}},{"content":"<pre data-lines=\"516,517\"><code>io.caochenlei.wcoa.api.demo.domain.event.ClickEventMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"516,517"}},{"content":"<pre data-lines=\"518,526\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ClickEventMessage</span>  <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseEventMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String eventKey;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"518,526"}},{"content":"<pre data-lines=\"527,528\"><code>io.caochenlei.wcoa.api.demo.domain.event.ViewEventMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"527,528"}},{"content":"<pre data-lines=\"529,537\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ViewEventMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseEventMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String eventKey;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"529,537"}},{"content":"<pre data-lines=\"538,539\"><code>io.caochenlei.wcoa.api.demo.domain.event.TicketEventMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"538,539"}},{"content":"<pre data-lines=\"540,549\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TicketEventMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseEventMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String eventKey;\n    <span class=\"hljs-keyword\">private</span> String ticket;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"540,549"}},{"content":"<pre data-lines=\"550,551\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"550,551"}},{"content":"<pre data-lines=\"552,610\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> String <span class=\"hljs-title function_\">eventHandle</span><span class=\"hljs-params\">(Map&lt;String, String&gt; parse)</span> {\n    <span class=\"hljs-keyword\">try</span> {\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">event</span> <span class=\"hljs-operator\">=</span> parse.get(<span class=\"hljs-string\">&quot;event&quot;</span>);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">eventKey</span> <span class=\"hljs-operator\">=</span> parse.get(<span class=\"hljs-string\">&quot;eventKey&quot;</span>);\n        <span class=\"hljs-keyword\">if</span> (eventKey == <span class=\"hljs-literal\">null</span> || eventKey.equals(<span class=\"hljs-string\">&quot;&quot;</span>)) {\n            <span class=\"hljs-keyword\">switch</span> (event) {\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;subscribe&quot;</span>:<span class=\"hljs-comment\">//&#x8ba2;&#x9605;&#x4e8b;&#x4ef6;</span>\n                    <span class=\"hljs-type\">BaseEventMessage</span> <span class=\"hljs-variable\">subEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BaseEventMessage</span>();\n                    BeanUtils.populate(subEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;subscribe={}&quot;</span>, subEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;unsubscribe&quot;</span>:<span class=\"hljs-comment\">//&#x53d6;&#x6d88;&#x8ba2;&#x9605;</span>\n                    <span class=\"hljs-type\">BaseEventMessage</span> <span class=\"hljs-variable\">unSubEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BaseEventMessage</span>();\n                    BeanUtils.populate(unSubEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;unsubscribe={}&quot;</span>, unSubEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;LOCATION&quot;</span>:<span class=\"hljs-comment\">//&#x4e0a;&#x62a5;&#x4f4d;&#x7f6e;</span>\n                    <span class=\"hljs-type\">LocationEventMessage</span> <span class=\"hljs-variable\">locationEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LocationEventMessage</span>();\n                    BeanUtils.populate(locationEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, locationEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">default</span>:\n                    log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, <span class=\"hljs-string\">&quot;&#x672a;&#x77e5;&#x4e8b;&#x4ef6;!&quot;</span>);\n            }\n        } <span class=\"hljs-keyword\">else</span> {\n            <span class=\"hljs-keyword\">switch</span> (event) {\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;subscribe&quot;</span>:<span class=\"hljs-comment\">//&#x5982;&#x679c;&#x7528;&#x6237;&#x8fd8;&#x672a;&#x5173;&#x6ce8;&#x516c;&#x4f17;&#x53f7;&#xff0c;&#x5219;&#x7528;&#x6237;&#x53ef;&#x4ee5;&#x5173;&#x6ce8;&#x516c;&#x4f17;&#x53f7;&#xff0c;&#x5173;&#x6ce8;&#x540e;&#x5fae;&#x4fe1;&#x4f1a;&#x5c06;&#x5e26;&#x573a;&#x666f;&#x503c;&#x5173;&#x6ce8;&#x4e8b;&#x4ef6;&#x63a8;&#x9001;&#x7ed9;&#x5f00;&#x53d1;&#x8005;&#x3002;</span>\n                    <span class=\"hljs-type\">TicketEventMessage</span> <span class=\"hljs-variable\">subsTicketEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TicketEventMessage</span>();\n                    BeanUtils.populate(subsTicketEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;subs={}&quot;</span>, subsTicketEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;SCAN&quot;</span>:<span class=\"hljs-comment\">//&#x5982;&#x679c;&#x7528;&#x6237;&#x5df2;&#x7ecf;&#x5173;&#x6ce8;&#x516c;&#x4f17;&#x53f7;&#xff0c;&#x5728;&#x7528;&#x6237;&#x626b;&#x63cf;&#x540e;&#x4f1a;&#x81ea;&#x52a8;&#x8fdb;&#x5165;&#x4f1a;&#x8bdd;&#xff0c;&#x5fae;&#x4fe1;&#x4e5f;&#x4f1a;&#x5c06;&#x5e26;&#x573a;&#x666f;&#x503c;&#x626b;&#x63cf;&#x4e8b;&#x4ef6;&#x63a8;&#x9001;&#x7ed9;&#x5f00;&#x53d1;&#x8005;&#x3002;</span>\n                    <span class=\"hljs-type\">TicketEventMessage</span> <span class=\"hljs-variable\">scanTicketEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TicketEventMessage</span>();\n                    BeanUtils.populate(scanTicketEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;scan={}&quot;</span>, scanTicketEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;CLICK&quot;</span>:<span class=\"hljs-comment\">//&#x83dc;&#x5355;&#x6309;&#x94ae;</span>\n                    <span class=\"hljs-type\">ClickEventMessage</span> <span class=\"hljs-variable\">clickEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ClickEventMessage</span>();\n                    BeanUtils.populate(clickEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, clickEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;VIEW&quot;</span>:<span class=\"hljs-comment\">//&#x83dc;&#x5355;&#x94fe;&#x63a5;</span>\n                    <span class=\"hljs-type\">ViewEventMessage</span> <span class=\"hljs-variable\">viewEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ViewEventMessage</span>();\n                    BeanUtils.populate(viewEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, viewEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">default</span>:\n                    log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, <span class=\"hljs-string\">&quot;&#x672a;&#x77e5;&#x4e8b;&#x4ef6;!&quot;</span>);\n            }\n        }\n    } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n        e.printStackTrace();\n    }\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;error&quot;</span>;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"552,610"}},{"content":"<pre data-lines=\"611,614\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://developers.weixin.qq.com/doc/offiaccount/Account\\_Management/Generating\\_a\\_Parametric\\_QR\\_Code.html\n\nio.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"611,614"}},{"content":"<pre data-lines=\"615,641\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">QRCODE_CREATE</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=ACCESS_TOKEN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/qrcodeCreate&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">qrcodeCreate</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(value = &quot;action_name&quot;, required = true)</span> String actionName,\n                           <span class=\"hljs-meta\">@RequestParam(value = &quot;scene_id&quot;, required = false)</span> String sceneId,\n                           <span class=\"hljs-meta\">@RequestParam(value = &quot;scene_str&quot;, required = false)</span> String sceneStr)</span> {\n    <span class=\"hljs-type\">AccessToken</span> <span class=\"hljs-variable\">accessToken</span> <span class=\"hljs-operator\">=</span> getAccessToken();\n    Map&lt;String, Object&gt; actionInfo = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    <span class=\"hljs-keyword\">if</span> (sceneId != <span class=\"hljs-literal\">null</span>) actionInfo.put(<span class=\"hljs-string\">&quot;scene&quot;</span>, Collections.singletonMap(<span class=\"hljs-string\">&quot;scene_id&quot;</span>, sceneId));\n    <span class=\"hljs-keyword\">if</span> (sceneStr != <span class=\"hljs-literal\">null</span>) actionInfo.put(<span class=\"hljs-string\">&quot;scene&quot;</span>, Collections.singletonMap(<span class=\"hljs-string\">&quot;scene_str&quot;</span>, sceneStr));\n    Map&lt;String, Object&gt; params = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    params.put(<span class=\"hljs-string\">&quot;expire_seconds&quot;</span>, <span class=\"hljs-string\">&quot;2592000&quot;</span>);\n    params.put(<span class=\"hljs-string\">&quot;action_name&quot;</span>, actionName);\n    params.put(<span class=\"hljs-string\">&quot;action_info&quot;</span>, actionInfo);\n    <span class=\"hljs-keyword\">return</span> restTemplate.postForObject(QRCODE_CREATE.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken.getAccessToken()), params, String.class);\n}\n\n<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">QRCODE_URL</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=TICKET&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(value = &quot;/wechat/qrcodeUrl&quot;)</span>\n<span class=\"hljs-keyword\">public</span> Map&lt;String, String&gt; <span class=\"hljs-title function_\">qrcodeUrl</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;ticket&quot;)</span> String ticket)</span> {\n    <span class=\"hljs-keyword\">return</span> Collections.singletonMap(<span class=\"hljs-string\">&quot;qrcode_url&quot;</span>, QRCODE_URL.replace(<span class=\"hljs-string\">&quot;TICKET&quot;</span>, ticket));\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"615,641"}}],"payload":{"tag":"h2","lines":"485,487"}},{"content":"4.1&#x3001;&#x751f;&#x6210;&#x5e26;&#x53c2;&#x6570;&#x4e8c;&#x7ef4;&#x7801;&#xff08;&#x4e34;&#x65f6;&#xff09;","children":[{"content":"<pre data-lines=\"645,648\"><code>**&#x6d4b;&#x8bd5;&#x7c7b;&#x578b;&#xff1a;&#x4e34;&#x65f6;&#x7684;&#x6574;&#x578b;&#x53c2;&#x6570;&#x503c;**\n\n&#x6d4b;&#x8bd5;&#x5730;&#x5740;&#xff1a;http://caochenlei.cn/wechat/qrcodeCreate?action\\_name=QR\\_SCENE&amp;scene\\_id=123\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"645,648"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/5dde6a725ca1761085c0228f252a3af1.png\" alt>","children":[],"payload":{"tag":"img","lines":"649,650"}},{"content":"<pre data-lines=\"651,652\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;http://caochenlei.cn/wechat/qrcodeUrl?ticket=gQFQ8TwAAAAAAAAAAS5odHRwOi8vd2VpeGluLnFxLmNvbS9xLzAyZ0FSUk10S2FjUEcxM1VUNk54MVgAAgT4qt5gAwQAjScA\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"651,652"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/aac7249d9898e39870b71eec02dee1c2.png\" alt>","children":[],"payload":{"tag":"img","lines":"653,654"}},{"content":"<pre data-lines=\"655,658\"><code>**&#x6d4b;&#x8bd5;&#x7c7b;&#x578b;&#xff1a;&#x4e34;&#x65f6;&#x7684;&#x5b57;&#x7b26;&#x4e32;&#x53c2;&#x6570;&#x503c;**\n\n&#x6d4b;&#x8bd5;&#x5730;&#x5740;&#xff1a;http://caochenlei.cn/wechat/qrcodeCreate?action\\_name=QR\\_STR\\_SCENE&amp;scene\\_str=abc\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"655,658"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/9095aa1699a1ac8d91c81122944cb8f0.png\" alt>","children":[],"payload":{"tag":"img","lines":"659,660"}},{"content":"<pre data-lines=\"661,662\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;http://caochenlei.cn/wechat/qrcodeUrl?ticket=gQG28DwAAAAAAAAAAS5odHRwOi8vd2VpeGluLnFxLmNvbS9xLzAyX3Q2dE4zS2FjUEcxMWhVNmh4Y0kAAgRRq95gAwQAjScA\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"661,662"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/d5da4feb2397a23f8c6eead1aa20b0c6.png\" alt>","children":[],"payload":{"tag":"img","lines":"663,664"}}],"payload":{"tag":"h2","lines":"642,644"}},{"content":"4.2&#x3001;&#x751f;&#x6210;&#x5e26;&#x53c2;&#x6570;&#x4e8c;&#x7ef4;&#x7801;&#xff08;&#x6c38;&#x4e45;&#xff09;","children":[{"content":"<pre data-lines=\"668,671\"><code>**&#x6d4b;&#x8bd5;&#x7c7b;&#x578b;&#xff1a;&#x6c38;&#x4e45;&#x7684;&#x6574;&#x578b;&#x53c2;&#x6570;&#x503c;**\n\n&#x6d4b;&#x8bd5;&#x5730;&#x5740;&#xff1a;http://caochenlei.cn/wechat/qrcodeCreate?action\\_name=QR\\_LIMIT\\_SCENE&amp;scene\\_id=123\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"668,671"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/dbd8cedf92bdc1b5f83692e68d129117.png\" alt>","children":[],"payload":{"tag":"img","lines":"672,673"}},{"content":"<pre data-lines=\"674,675\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;http://caochenlei.cn/wechat/qrcodeUrl?ticket=gQEA8jwAAAAAAAAAAS5odHRwOi8vd2VpeGluLnFxLmNvbS9xLzAyS1YyQk5ZS2FjUEcxMDAwME0wM0IAAgQEot5gAwQAAAAA\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"674,675"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/4f94bbd9267e0ff9a127c25f0f2528f4.png\" alt>","children":[],"payload":{"tag":"img","lines":"676,677"}},{"content":"<pre data-lines=\"678,681\"><code>**&#x6d4b;&#x8bd5;&#x7c7b;&#x578b;&#xff1a;&#x6c38;&#x4e45;&#x7684;&#x5b57;&#x7b26;&#x4e32;&#x53c2;&#x6570;&#x503c;**\n\n&#x6d4b;&#x8bd5;&#x5730;&#x5740;&#xff1a;http://caochenlei.cn/wechat/qrcodeCreate?action\\_name=QR\\_LIMIT\\_STR\\_SCENE&amp;scene\\_str=abc\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"678,681"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/56196861e8a99214e6a48955fe7d000f.png\" alt>","children":[],"payload":{"tag":"img","lines":"682,683"}},{"content":"<pre data-lines=\"684,685\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;http://caochenlei.cn/wechat/qrcodeUrl?ticket=gQGn8TwAAAAAAAAAAS5odHRwOi8vd2VpeGluLnFxLmNvbS9xLzAyWGVSZU00S2FjUEcxMDAwME0wN0cAAgQbot5gAwQAAAAA\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"684,685"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1958077cec309382e933fdd128823c5f.png\" alt>","children":[],"payload":{"tag":"img","lines":"686,687"}},{"content":"<pre data-lines=\"688,691\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://developers.weixin.qq.com/doc/offiaccount/Custom\\_Menus/Creating\\_Custom-Defined\\_Menu.html\n\n**&#x5b9a;&#x4e49;&#x83dc;&#x5355;&#x6309;&#x94ae;&#x7c7b;&#x578b;**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"688,691"}},{"content":"<pre data-lines=\"694,704\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@NoArgsConstructor</span>\n<span class=\"hljs-meta\">@AllArgsConstructor</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BaseButton</span> {\n    <span class=\"hljs-keyword\">private</span> String type;\n    <span class=\"hljs-keyword\">private</span> String name;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"694,704"}},{"content":"<pre data-lines=\"705,706\"><code>io.caochenlei.wcoa.api.demo.domain.btn.ClickButton\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"705,706"}},{"content":"<pre data-lines=\"707,721\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@NoArgsConstructor</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ClickButton</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseButton</span> {\n    <span class=\"hljs-keyword\">private</span> String key;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">ClickButton</span><span class=\"hljs-params\">(String name, String key)</span> {\n        <span class=\"hljs-built_in\">super</span>(<span class=\"hljs-string\">&quot;click&quot;</span>, name);\n        <span class=\"hljs-built_in\">this</span>.key = key;\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"707,721"}},{"content":"<pre data-lines=\"722,723\"><code>io.caochenlei.wcoa.api.demo.domain.btn.ViewButton\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"722,723"}},{"content":"<pre data-lines=\"724,738\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@NoArgsConstructor</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ViewButton</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseButton</span> {\n    <span class=\"hljs-keyword\">private</span> String url;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">ViewButton</span><span class=\"hljs-params\">(String name, String url)</span> {\n        <span class=\"hljs-built_in\">super</span>(<span class=\"hljs-string\">&quot;view&quot;</span>, name);\n        <span class=\"hljs-built_in\">this</span>.url = url;\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"724,738"}},{"content":"<pre data-lines=\"739,740\"><code>io.caochenlei.wcoa.api.demo.domain.btn.SubButton\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"739,740"}},{"content":"<pre data-lines=\"741,755\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@NoArgsConstructor</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SubButton</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseButton</span> {\n    <span class=\"hljs-keyword\">private</span> List&lt;BaseButton&gt; sub_button;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">SubButton</span><span class=\"hljs-params\">(String name)</span> {\n        <span class=\"hljs-built_in\">super</span>(<span class=\"hljs-string\">&quot;sub&quot;</span>, name);\n        <span class=\"hljs-built_in\">this</span>.sub_button = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayList</span>&lt;&gt;();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"741,755"}},{"content":"<pre data-lines=\"756,757\"><code>io.caochenlei.wcoa.api.demo.domain.btn.Button\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"756,757"}},{"content":"<pre data-lines=\"758,765\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Button</span> {\n    <span class=\"hljs-keyword\">private</span> List&lt;BaseButton&gt; button = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayList</span>&lt;&gt;();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"758,765"}},{"content":"<pre data-lines=\"766,767\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"766,767"}},{"content":"<pre data-lines=\"768,784\"><code class=\"language-java\"><span class=\"hljs-meta\">@GetMapping(&quot;/wechat/menuCreate&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">menuCreate</span><span class=\"hljs-params\">()</span> {\n    <span class=\"hljs-type\">AccessToken</span> <span class=\"hljs-variable\">accessToken</span> <span class=\"hljs-operator\">=</span> getAccessToken();\n    <span class=\"hljs-type\">Button</span> <span class=\"hljs-variable\">button</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Button</span>();\n    button.getButton().add(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ClickButton</span>(<span class=\"hljs-string\">&quot;&#x83dc;&#x5355;&#x4e00;&quot;</span>, <span class=\"hljs-string\">&quot;btn1&quot;</span>));\n    button.getButton().add(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ViewButton</span>(<span class=\"hljs-string\">&quot;&#x83dc;&#x5355;&#x4e8c;&quot;</span>, <span class=\"hljs-string\">&quot;https://www.baidu.com&quot;</span>));\n    <span class=\"hljs-type\">SubButton</span> <span class=\"hljs-variable\">subButton</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SubButton</span>(<span class=\"hljs-string\">&quot;&#x83dc;&#x5355;&#x4e09;&quot;</span>);\n    subButton.getSub_button().add(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ClickButton</span>(<span class=\"hljs-string\">&quot;&#x5b50;&#x6309;&#x94ae;1&quot;</span>, <span class=\"hljs-string\">&quot;subBtn1&quot;</span>));\n    subButton.getSub_button().add(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ClickButton</span>(<span class=\"hljs-string\">&quot;&#x5b50;&#x6309;&#x94ae;2&quot;</span>, <span class=\"hljs-string\">&quot;subBtn2&quot;</span>));\n    subButton.getSub_button().add(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ClickButton</span>(<span class=\"hljs-string\">&quot;&#x5b50;&#x6309;&#x94ae;3&quot;</span>, <span class=\"hljs-string\">&quot;subBtn3&quot;</span>));\n    button.getButton().add(subButton);\n    <span class=\"hljs-keyword\">return</span> restTemplate.postForObject(MENU_CREATE.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken.getAccessToken()), button, String.class);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"768,784"}}],"payload":{"tag":"h2","lines":"665,667"}},{"content":"6.1&#x3001;&#x53d1;&#x9001;&#x666e;&#x901a;&#x6d88;&#x606f;","children":[{"content":"<pre data-lines=\"788,793\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://developers.weixin.qq.com/doc/offiaccount/Message\\_Management/Passive\\_user\\_reply\\_message.html\n\n**&#x5b9a;&#x4e49;&#x56de;&#x590d;&#x6d88;&#x606f;&#x7c7b;&#x578b;**\n\nio.caochenlei.wcoa.api.demo.domain.reply.BaseReplyMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"788,793"}},{"content":"<pre data-lines=\"794,804\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BaseReplyMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String toUserName;\n    <span class=\"hljs-keyword\">private</span> String fromUserName;\n    <span class=\"hljs-keyword\">private</span> Long createTime;\n    <span class=\"hljs-keyword\">private</span> String msgType;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"794,804"}},{"content":"<pre data-lines=\"805,806\"><code>io.caochenlei.wcoa.api.demo.domain.reply.TextReplyMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"805,806"}},{"content":"<pre data-lines=\"807,815\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TextReplyMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseReplyMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String content;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"807,815"}},{"content":"<pre data-lines=\"816,817\"><code>io.caochenlei.wcoa.api.demo.domain.reply.ImageReplyMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"816,817"}},{"content":"<pre data-lines=\"818,826\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ImageReplyMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseReplyMessage</span> {\n    <span class=\"hljs-keyword\">private</span> Image image;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"818,826"}},{"content":"<pre data-lines=\"827,828\"><code>io.caochenlei.wcoa.api.demo.domain.reply.Image\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"827,828"}},{"content":"<pre data-lines=\"829,836\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Image</span> {\n    <span class=\"hljs-keyword\">private</span> String mediaId;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"829,836"}},{"content":"<pre data-lines=\"837,838\"><code>io.caochenlei.wcoa.api.demo.domain.reply.VoiceReplyMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"837,838"}},{"content":"<pre data-lines=\"839,847\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">VoiceReplyMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseReplyMessage</span> {\n    <span class=\"hljs-keyword\">private</span> Voice voice;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"839,847"}},{"content":"<pre data-lines=\"848,849\"><code>io.caochenlei.wcoa.api.demo.domain.reply.Voice\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"848,849"}},{"content":"<pre data-lines=\"850,857\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Voice</span> {\n    <span class=\"hljs-keyword\">private</span> String mediaId;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"850,857"}},{"content":"<pre data-lines=\"858,859\"><code>io.caochenlei.wcoa.api.demo.domain.reply.VideoReplyMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"858,859"}},{"content":"<pre data-lines=\"860,868\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">VideoReplyMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseReplyMessage</span> {\n    <span class=\"hljs-keyword\">private</span> Video video;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"860,868"}},{"content":"<pre data-lines=\"869,870\"><code>io.caochenlei.wcoa.api.demo.domain.reply.Video\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"869,870"}},{"content":"<pre data-lines=\"871,880\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Video</span> {\n    <span class=\"hljs-keyword\">private</span> String mediaId;\n    <span class=\"hljs-keyword\">private</span> String title;\n    <span class=\"hljs-keyword\">private</span> String description;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"871,880"}},{"content":"<pre data-lines=\"881,882\"><code>io.caochenlei.wcoa.api.demo.domain.reply.MusicReplyMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"881,882"}},{"content":"<pre data-lines=\"883,891\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MusicReplyMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseReplyMessage</span> {\n    <span class=\"hljs-keyword\">private</span> Music music;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"883,891"}},{"content":"<pre data-lines=\"892,893\"><code>io.caochenlei.wcoa.api.demo.domain.reply.Music\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"892,893"}},{"content":"<pre data-lines=\"894,905\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Music</span> {\n    <span class=\"hljs-keyword\">private</span> String title;\n    <span class=\"hljs-keyword\">private</span> String description;\n    <span class=\"hljs-keyword\">private</span> String musicUrl;\n    <span class=\"hljs-keyword\">private</span> String mQMusicUrl;\n    <span class=\"hljs-keyword\">private</span> String thumbMediaId;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"894,905"}},{"content":"<pre data-lines=\"906,907\"><code>io.caochenlei.wcoa.api.demo.domain.reply.NewsReplyMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"906,907"}},{"content":"<pre data-lines=\"908,917\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">NewsReplyMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseReplyMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String articleCount;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">Articles</span> <span class=\"hljs-variable\">articles</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Articles</span>();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"908,917"}},{"content":"<pre data-lines=\"918,919\"><code>io.caochenlei.wcoa.api.demo.domain.reply.Articles\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"918,919"}},{"content":"<pre data-lines=\"920,927\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Articles</span> {\n    <span class=\"hljs-keyword\">private</span> List&lt;Item&gt; items = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayList</span>&lt;&gt;();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"920,927"}},{"content":"<pre data-lines=\"928,929\"><code>io.caochenlei.wcoa.api.demo.domain.reply.Item\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"928,929"}},{"content":"<pre data-lines=\"930,940\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Item</span> {\n    <span class=\"hljs-keyword\">private</span> String title;\n    <span class=\"hljs-keyword\">private</span> String description;\n    <span class=\"hljs-keyword\">private</span> String picUrl;\n    <span class=\"hljs-keyword\">private</span> String url;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"930,940"}},{"content":"<pre data-lines=\"941,944\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaController\n\n&#xff08;&#x8fd9;&#x91cc;&#x4ee5;&#x56de;&#x590d;&#x6587;&#x672c;&#x6d88;&#x606f;&#x4e3a;&#x4f8b;&#xff0c;&#x5176;&#x4f59;&#x683c;&#x5f0f;&#x53c2;&#x8003;&#x6b64;&#x6848;&#x4f8b;&#x5373;&#x53ef;&#xff09;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"941,944"}},{"content":"<pre data-lines=\"945,1008\"><code class=\"language-java\"><span class=\"hljs-meta\">@PostMapping(value = &quot;/wechat&quot;, produces = &quot;application/xml;charset=UTF-8&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">notification</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestBody</span> String body)</span> {\n    <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">reply</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;error&quot;</span>;\n    <span class=\"hljs-keyword\">try</span> {\n        Map&lt;String, String&gt; parse = parseXmlToMap(body);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">msgType</span> <span class=\"hljs-operator\">=</span> parse.get(<span class=\"hljs-string\">&quot;msgType&quot;</span>);\n        <span class=\"hljs-keyword\">switch</span> (msgType) {\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;text&quot;</span>:\n                <span class=\"hljs-type\">TextMessage</span> <span class=\"hljs-variable\">textMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TextMessage</span>();\n                BeanUtils.populate(textMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, textMessage);\n                <span class=\"hljs-type\">TextReplyMessage</span> <span class=\"hljs-variable\">textReplyMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TextReplyMessage</span>();\n                textReplyMessage.setToUserName(textMessage.getFromUserName());\n                textReplyMessage.setFromUserName(textMessage.getToUserName());\n                textReplyMessage.setCreateTime(System.nanoTime());\n                textReplyMessage.setMsgType(<span class=\"hljs-string\">&quot;text&quot;</span>);\n                textReplyMessage.setContent(<span class=\"hljs-string\">&quot;&#x4f60;&#x597d;&#xff0c;&#x7528;&#x6237;&#xff01;&quot;</span>);\n                reply = parseObjToXml(textReplyMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;image&quot;</span>:\n                <span class=\"hljs-type\">ImageMessage</span> <span class=\"hljs-variable\">imageMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ImageMessage</span>();\n                BeanUtils.populate(imageMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, imageMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;voice&quot;</span>:\n                <span class=\"hljs-type\">VoiceMessage</span> <span class=\"hljs-variable\">voiceMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">VoiceMessage</span>();\n                BeanUtils.populate(voiceMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, voiceMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;video&quot;</span>:\n                <span class=\"hljs-type\">VideoMessage</span> <span class=\"hljs-variable\">videoMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">VideoMessage</span>();\n                BeanUtils.populate(videoMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, videoMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;location&quot;</span>:\n                <span class=\"hljs-type\">LocationMessage</span> <span class=\"hljs-variable\">locationMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LocationMessage</span>();\n                BeanUtils.populate(locationMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, locationMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;link&quot;</span>:\n                <span class=\"hljs-type\">LinkMessage</span> <span class=\"hljs-variable\">linkMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LinkMessage</span>();\n                BeanUtils.populate(linkMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, linkMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;file&quot;</span>:\n                <span class=\"hljs-type\">FileMessage</span> <span class=\"hljs-variable\">fileMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FileMessage</span>();\n                BeanUtils.populate(fileMessage, parse);\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, fileMessage);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;event&quot;</span>:\n                eventHandle(parse);\n                <span class=\"hljs-keyword\">break</span>;\n            <span class=\"hljs-keyword\">default</span>:\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, <span class=\"hljs-string\">&quot;&#x672a;&#x77e5;&#x6d88;&#x606f;!&quot;</span>);\n        }\n    } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n        e.printStackTrace();\n    }\n    <span class=\"hljs-keyword\">return</span> reply;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"945,1008"}}],"payload":{"tag":"h2","lines":"785,787"}},{"content":"6.2&#x3001;&#x53d1;&#x9001;&#x6a21;&#x677f;&#x6d88;&#x606f;","children":[{"content":"6.2.1&#x3001;&#x8bbe;&#x7f6e;&#x6240;&#x5c5e;&#x884c;&#x4e1a;","children":[{"content":"<pre data-lines=\"1016,1017\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1016,1017"}},{"content":"<pre data-lines=\"1018,1031\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">SET_INDUSTRY</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/cgi-bin/template/api_set_industry?access_token=ACCESS_TOKEN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/setIndustry&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">setIndustry</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;industry_id1&quot;)</span> String industryId1, <span class=\"hljs-meta\">@RequestParam(&quot;industry_id2&quot;)</span> String industryId2)</span> {\n    <span class=\"hljs-type\">AccessToken</span> <span class=\"hljs-variable\">accessToken</span> <span class=\"hljs-operator\">=</span> getAccessToken();\n    Map&lt;String, String&gt; params = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    params.put(<span class=\"hljs-string\">&quot;industry_id1&quot;</span>, industryId1);\n    params.put(<span class=\"hljs-string\">&quot;industry_id2&quot;</span>, industryId2);\n    <span class=\"hljs-keyword\">return</span> restTemplate.postForObject(SET_INDUSTRY.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken.getAccessToken()), params, String.class);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1018,1031"}},{"content":"<pre data-lines=\"1032,1033\"><code>&#x6d4b;&#x8bd5;&#x5730;&#x5740;&#xff1a;http://caochenlei.cn/wechat/setIndustry?industry\\_id1=1&amp;industry\\_id2=4\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1032,1033"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/65617d37a332d020f51581c35142e387.png\" alt>","children":[],"payload":{"tag":"img","lines":"1034,1035"}}],"payload":{"tag":"h3","lines":"1014,1015"}},{"content":"6.2.2&#x3001;&#x83b7;&#x53d6;&#x6240;&#x5c5e;&#x884c;&#x4e1a;","children":[{"content":"<pre data-lines=\"1038,1039\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1038,1039"}},{"content":"<pre data-lines=\"1040,1050\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">GET_INDUSTRY</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/cgi-bin/template/get_industry?access_token=ACCESS_TOKEN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/getIndustry&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">getIndustry</span><span class=\"hljs-params\">()</span> {\n    <span class=\"hljs-type\">AccessToken</span> <span class=\"hljs-variable\">accessToken</span> <span class=\"hljs-operator\">=</span> getAccessToken();\n    <span class=\"hljs-keyword\">return</span> restTemplate.getForObject(GET_INDUSTRY.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken.getAccessToken()), String.class);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1040,1050"}},{"content":"<pre data-lines=\"1051,1052\"><code>&#x6d4b;&#x8bd5;&#x5730;&#x5740;&#xff1a;http://caochenlei.cn/wechat/getIndustry\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1051,1052"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/12161e8390690c37e9bf519ac9769590.png\" alt>","children":[],"payload":{"tag":"img","lines":"1053,1054"}}],"payload":{"tag":"h3","lines":"1036,1037"}},{"content":"6.2.3&#x3001;&#x8bbe;&#x7f6e;&#x6d88;&#x606f;&#x6a21;&#x677f;&#xff08;&#x624b;&#x52a8;&#xff09;","children":[{"content":"<pre data-lines=\"1057,1058\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1057,1058"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b5194d98f1869c4ec597007e6d0094bb.png\" alt>","children":[],"payload":{"tag":"img","lines":"1059,1060"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/442629fac2917ab1d229682256157e09.png\" alt>","children":[],"payload":{"tag":"img","lines":"1061,1062"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/40d12e0393929fe24651bcae296b9441.png\" alt>","children":[],"payload":{"tag":"img","lines":"1063,1064"}}],"payload":{"tag":"h3","lines":"1055,1056"}},{"content":"6.2.4&#x3001;&#x8bbe;&#x7f6e;&#x6d88;&#x606f;&#x6a21;&#x677f;&#xff08;&#x4ee3;&#x7801;&#xff09;","children":[{"content":"<pre data-lines=\"1067,1068\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1067,1068"}},{"content":"<pre data-lines=\"1069,1081\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">ADD_TEMPLATE</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/cgi-bin/template/api_add_template?access_token=ACCESS_TOKEN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/addTemplate&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">addTemplate</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;template_id_short&quot;)</span> String templateIdShort)</span> {\n    <span class=\"hljs-type\">AccessToken</span> <span class=\"hljs-variable\">accessToken</span> <span class=\"hljs-operator\">=</span> getAccessToken();\n    Map&lt;String, String&gt; params = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    params.put(<span class=\"hljs-string\">&quot;template_id_short&quot;</span>, templateIdShort);\n    <span class=\"hljs-keyword\">return</span> restTemplate.postForObject(ADD_TEMPLATE.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken.getAccessToken()), params, String.class);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1069,1081"}}],"payload":{"tag":"h3","lines":"1065,1066"}},{"content":"6.2.5&#x3001;&#x83b7;&#x5f97;&#x6a21;&#x677f;&#x5217;&#x8868;","children":[{"content":"<pre data-lines=\"1084,1085\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1084,1085"}},{"content":"<pre data-lines=\"1086,1096\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">GET_ALL_PRIVATE_TEMPLATE</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/cgi-bin/template/get_all_private_template?access_token=ACCESS_TOKEN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/getAllPrivateTemplate&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">getAllPrivateTemplate</span><span class=\"hljs-params\">()</span> {\n    <span class=\"hljs-type\">AccessToken</span> <span class=\"hljs-variable\">accessToken</span> <span class=\"hljs-operator\">=</span> getAccessToken();\n    <span class=\"hljs-keyword\">return</span> restTemplate.getForObject(GET_ALL_PRIVATE_TEMPLATE.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken.getAccessToken()), String.class);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1086,1096"}}],"payload":{"tag":"h3","lines":"1082,1083"}},{"content":"6.2.6&#x3001;&#x5220;&#x9664;&#x6d88;&#x606f;&#x6a21;&#x677f;","children":[{"content":"<pre data-lines=\"1099,1100\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1099,1100"}},{"content":"<pre data-lines=\"1101,1113\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">DEL_PRIVATE_TEMPLATE</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/cgi-bin/template/del_private_template?access_token=ACCESS_TOKEN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/delPrivateTemplate&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">delPrivateTemplate</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;template_id&quot;)</span> String templateId)</span> {\n    <span class=\"hljs-type\">AccessToken</span> <span class=\"hljs-variable\">accessToken</span> <span class=\"hljs-operator\">=</span> getAccessToken();\n    Map&lt;String, String&gt; params = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    params.put(<span class=\"hljs-string\">&quot;template_id&quot;</span>, templateId);\n    <span class=\"hljs-keyword\">return</span> restTemplate.postForObject(DEL_PRIVATE_TEMPLATE.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken.getAccessToken()), params, String.class);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1101,1113"}}],"payload":{"tag":"h3","lines":"1097,1098"}},{"content":"6.2.7&#x3001;&#x53d1;&#x9001;&#x6a21;&#x677f;&#x6d88;&#x606f;","children":[{"content":"<pre data-lines=\"1116,1117\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1116,1117"}},{"content":"<pre data-lines=\"1118,1153\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">SEND_TEMPLATE</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=ACCESS_TOKEN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/sendBuySuccessTemplate&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">sendBuySuccessTemplate</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;touser&quot;)</span> String touser)</span> {\n    <span class=\"hljs-type\">AccessToken</span> <span class=\"hljs-variable\">accessToken</span> <span class=\"hljs-operator\">=</span> getAccessToken();\n    Map&lt;String, Object&gt; params = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    params.put(<span class=\"hljs-string\">&quot;touser&quot;</span>, touser);\n    params.put(<span class=\"hljs-string\">&quot;template_id&quot;</span>, <span class=\"hljs-string\">&quot;BdKiRYGsQ0eHbkRh3dp9hvlbbJwGsnuSvVqjxt7Zvg4&quot;</span>);\n    Map&lt;String, Map&lt;String, String&gt;&gt; data = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    Map&lt;String, String&gt; dataValue1 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    dataValue1.put(<span class=\"hljs-string\">&quot;value&quot;</span>, <span class=\"hljs-string\">&quot;&#x606d;&#x559c;&#x4f60;&#x8d2d;&#x4e70;&#x6210;&#x529f;&#xff01;&quot;</span>);\n    dataValue1.put(<span class=\"hljs-string\">&quot;color&quot;</span>, <span class=\"hljs-string\">&quot;#173177&quot;</span>);\n    data.put(<span class=\"hljs-string\">&quot;first&quot;</span>, dataValue1);\n    Map&lt;String, String&gt; dataValue2 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    dataValue2.put(<span class=\"hljs-string\">&quot;value&quot;</span>, <span class=\"hljs-string\">&quot;&#x5de7;&#x514b;&#x529b;&quot;</span>);\n    dataValue2.put(<span class=\"hljs-string\">&quot;color&quot;</span>, <span class=\"hljs-string\">&quot;#173177&quot;</span>);\n    data.put(<span class=\"hljs-string\">&quot;keyword1&quot;</span>, dataValue2);\n    Map&lt;String, String&gt; dataValue3 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    dataValue3.put(<span class=\"hljs-string\">&quot;value&quot;</span>, <span class=\"hljs-string\">&quot;39.8&#x5143;&quot;</span>);\n    dataValue3.put(<span class=\"hljs-string\">&quot;color&quot;</span>, <span class=\"hljs-string\">&quot;#173177&quot;</span>);\n    data.put(<span class=\"hljs-string\">&quot;keyword2&quot;</span>, dataValue3);\n    Map&lt;String, String&gt; dataValue4 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    dataValue4.put(<span class=\"hljs-string\">&quot;value&quot;</span>, <span class=\"hljs-string\">&quot;2014&#x5e74;9&#x6708;22&#x65e5;&quot;</span>);\n    dataValue4.put(<span class=\"hljs-string\">&quot;color&quot;</span>, <span class=\"hljs-string\">&quot;#173177&quot;</span>);\n    data.put(<span class=\"hljs-string\">&quot;keyword3&quot;</span>, dataValue4);\n    Map&lt;String, String&gt; dataValue5 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    dataValue5.put(<span class=\"hljs-string\">&quot;value&quot;</span>, <span class=\"hljs-string\">&quot;&#x6b22;&#x8fce;&#x518d;&#x6b21;&#x8d2d;&#x4e70;&#xff01;&quot;</span>);\n    dataValue5.put(<span class=\"hljs-string\">&quot;color&quot;</span>, <span class=\"hljs-string\">&quot;#173177&quot;</span>);\n    data.put(<span class=\"hljs-string\">&quot;remark&quot;</span>, dataValue5);\n    params.put(<span class=\"hljs-string\">&quot;data&quot;</span>, data);\n    <span class=\"hljs-keyword\">return</span> restTemplate.postForObject(SEND_TEMPLATE.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken.getAccessToken()), params, String.class);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1118,1153"}}],"payload":{"tag":"h3","lines":"1114,1115"}},{"content":"6.2.8&#x3001;&#x63a5;&#x6536;&#x56de;&#x8c03;&#x4e8b;&#x4ef6;","children":[{"content":"<pre data-lines=\"1156,1159\"><code>**&#x5b9a;&#x4e49;&#x56de;&#x590d;&#x6d88;&#x606f;&#x7c7b;&#x578b;**\n\nio.caochenlei.wcoa.api.demo.domain.event.TemplateEventMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1156,1159"}},{"content":"<pre data-lines=\"1160,1169\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TemplateEventMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">BaseEventMessage</span> {\n    <span class=\"hljs-keyword\">private</span> String msgID;\n    <span class=\"hljs-keyword\">private</span> String status;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1160,1169"}},{"content":"<pre data-lines=\"1170,1171\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1170,1171"}},{"content":"<pre data-lines=\"1172,1235\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> String <span class=\"hljs-title function_\">eventHandle</span><span class=\"hljs-params\">(Map&lt;String, String&gt; parse)</span> {\n    <span class=\"hljs-keyword\">try</span> {\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">event</span> <span class=\"hljs-operator\">=</span> parse.get(<span class=\"hljs-string\">&quot;event&quot;</span>);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">eventKey</span> <span class=\"hljs-operator\">=</span> parse.get(<span class=\"hljs-string\">&quot;eventKey&quot;</span>);\n        <span class=\"hljs-keyword\">if</span> (eventKey == <span class=\"hljs-literal\">null</span> || eventKey.equals(<span class=\"hljs-string\">&quot;&quot;</span>)) {\n            <span class=\"hljs-keyword\">switch</span> (event) {\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;subscribe&quot;</span>:<span class=\"hljs-comment\">//&#x8ba2;&#x9605;&#x4e8b;&#x4ef6;</span>\n                    <span class=\"hljs-type\">BaseEventMessage</span> <span class=\"hljs-variable\">subEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BaseEventMessage</span>();\n                    BeanUtils.populate(subEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;subscribe={}&quot;</span>, subEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;unsubscribe&quot;</span>:<span class=\"hljs-comment\">//&#x53d6;&#x6d88;&#x8ba2;&#x9605;</span>\n                    <span class=\"hljs-type\">BaseEventMessage</span> <span class=\"hljs-variable\">unSubEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BaseEventMessage</span>();\n                    BeanUtils.populate(unSubEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;unsubscribe={}&quot;</span>, unSubEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;LOCATION&quot;</span>:<span class=\"hljs-comment\">//&#x4e0a;&#x62a5;&#x4f4d;&#x7f6e;</span>\n                    <span class=\"hljs-type\">LocationEventMessage</span> <span class=\"hljs-variable\">locationEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LocationEventMessage</span>();\n                    BeanUtils.populate(locationEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, locationEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;TEMPLATESENDJOBFINISH&quot;</span>:<span class=\"hljs-comment\">//&#x6a21;&#x677f;&#x6d88;&#x606f;</span>\n                    <span class=\"hljs-type\">TemplateEventMessage</span> <span class=\"hljs-variable\">templateEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TemplateEventMessage</span>();\n                    BeanUtils.populate(templateEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, templateEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">default</span>:\n                    log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, <span class=\"hljs-string\">&quot;&#x672a;&#x77e5;&#x4e8b;&#x4ef6;!&quot;</span>);\n            }\n        } <span class=\"hljs-keyword\">else</span> {\n            <span class=\"hljs-keyword\">switch</span> (event) {\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;subscribe&quot;</span>:<span class=\"hljs-comment\">//&#x5982;&#x679c;&#x7528;&#x6237;&#x8fd8;&#x672a;&#x5173;&#x6ce8;&#x516c;&#x4f17;&#x53f7;&#xff0c;&#x5219;&#x7528;&#x6237;&#x53ef;&#x4ee5;&#x5173;&#x6ce8;&#x516c;&#x4f17;&#x53f7;&#xff0c;&#x5173;&#x6ce8;&#x540e;&#x5fae;&#x4fe1;&#x4f1a;&#x5c06;&#x5e26;&#x573a;&#x666f;&#x503c;&#x5173;&#x6ce8;&#x4e8b;&#x4ef6;&#x63a8;&#x9001;&#x7ed9;&#x5f00;&#x53d1;&#x8005;&#x3002;</span>\n                    <span class=\"hljs-type\">TicketEventMessage</span> <span class=\"hljs-variable\">subsTicketEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TicketEventMessage</span>();\n                    BeanUtils.populate(subsTicketEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;subs={}&quot;</span>, subsTicketEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;SCAN&quot;</span>:<span class=\"hljs-comment\">//&#x5982;&#x679c;&#x7528;&#x6237;&#x5df2;&#x7ecf;&#x5173;&#x6ce8;&#x516c;&#x4f17;&#x53f7;&#xff0c;&#x5728;&#x7528;&#x6237;&#x626b;&#x63cf;&#x540e;&#x4f1a;&#x81ea;&#x52a8;&#x8fdb;&#x5165;&#x4f1a;&#x8bdd;&#xff0c;&#x5fae;&#x4fe1;&#x4e5f;&#x4f1a;&#x5c06;&#x5e26;&#x573a;&#x666f;&#x503c;&#x626b;&#x63cf;&#x4e8b;&#x4ef6;&#x63a8;&#x9001;&#x7ed9;&#x5f00;&#x53d1;&#x8005;&#x3002;</span>\n                    <span class=\"hljs-type\">TicketEventMessage</span> <span class=\"hljs-variable\">scanTicketEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TicketEventMessage</span>();\n                    BeanUtils.populate(scanTicketEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;scan={}&quot;</span>, scanTicketEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;CLICK&quot;</span>:<span class=\"hljs-comment\">//&#x83dc;&#x5355;&#x6309;&#x94ae;</span>\n                    <span class=\"hljs-type\">ClickEventMessage</span> <span class=\"hljs-variable\">clickEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ClickEventMessage</span>();\n                    BeanUtils.populate(clickEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, clickEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;VIEW&quot;</span>:<span class=\"hljs-comment\">//&#x83dc;&#x5355;&#x94fe;&#x63a5;</span>\n                    <span class=\"hljs-type\">ViewEventMessage</span> <span class=\"hljs-variable\">viewEventMessage</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ViewEventMessage</span>();\n                    BeanUtils.populate(viewEventMessage, parse);\n                    log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, viewEventMessage);\n                    <span class=\"hljs-keyword\">break</span>;\n                <span class=\"hljs-keyword\">default</span>:\n                    log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, <span class=\"hljs-string\">&quot;&#x672a;&#x77e5;&#x4e8b;&#x4ef6;!&quot;</span>);\n            }\n        }\n    } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n        e.printStackTrace();\n    }\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;error&quot;</span>;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1172,1235"}}],"payload":{"tag":"h3","lines":"1154,1155"}}],"payload":{"tag":"h2","lines":"1009,1011"}},{"content":"7.1&#x3001;&#x83b7;&#x53d6;&#x7528;&#x6237;&#x5217;&#x8868;","children":[{"content":"<pre data-lines=\"1239,1242\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://developers.weixin.qq.com/doc/offiaccount/User\\_Management/Getting\\_a\\_User\\_List.html\n\nio.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1239,1242"}},{"content":"<pre data-lines=\"1243,1257\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">GET_USER_LIST</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/cgi-bin/user/get?access_token=ACCESS_TOKEN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/getUserList&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">getUserList</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(value = &quot;next_openid&quot;, required = false)</span> String nextOpenid)</span> {\n    <span class=\"hljs-type\">AccessToken</span> <span class=\"hljs-variable\">accessToken</span> <span class=\"hljs-operator\">=</span> getAccessToken();\n    Map&lt;String, Object&gt; params = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    <span class=\"hljs-keyword\">if</span> (nextOpenid != <span class=\"hljs-literal\">null</span>) {\n        params.put(<span class=\"hljs-string\">&quot;next_openid&quot;</span>, nextOpenid);\n    }\n    <span class=\"hljs-keyword\">return</span> restTemplate.postForObject(GET_USER_LIST.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken.getAccessToken()), params, String.class);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1243,1257"}},{"content":"<pre data-lines=\"1258,1259\"><code>&#x6d4b;&#x8bd5;&#x5730;&#x5740;&#xff1a;http://caochenlei.cn/wechat/getUserList\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1258,1259"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/2400bedf70fdb0d1fb748c0239003c05.png\" alt>","children":[],"payload":{"tag":"img","lines":"1260,1261"}}],"payload":{"tag":"h2","lines":"1236,1238"}},{"content":"7.2&#x3001;&#x83b7;&#x53d6;&#x7528;&#x6237;&#x57fa;&#x672c;&#x4fe1;&#x606f;","children":[{"content":"<pre data-lines=\"1265,1268\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://developers.weixin.qq.com/doc/offiaccount/User\\_Management/Get\\_users\\_basic\\_information\\_UnionID.html#UinonId\n\nio.caochenlei.wcoa.api.demo.controller.WcoaController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1265,1268"}},{"content":"<pre data-lines=\"1269,1281\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">GET_USER_INFO</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/cgi-bin/user/info?access_token=ACCESS_TOKEN&amp;openid=OPENID&amp;lang=zh_CN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/getUserInfo&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">getUserInfo</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;openid&quot;)</span> String openid)</span> {\n    <span class=\"hljs-type\">AccessToken</span> <span class=\"hljs-variable\">accessToken</span> <span class=\"hljs-operator\">=</span> getAccessToken();\n    <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">getUserInfoUrl</span> <span class=\"hljs-operator\">=</span> GET_USER_INFO.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken.getAccessToken());\n    getUserInfoUrl = getUserInfoUrl.replace(<span class=\"hljs-string\">&quot;OPENID&quot;</span>, openid);\n    <span class=\"hljs-keyword\">return</span> restTemplate.getForObject(getUserInfoUrl, String.class);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1269,1281"}},{"content":"<pre data-lines=\"1282,1283\"><code>&#x6d4b;&#x8bd5;&#x5730;&#x5740;&#xff1a;http://caochenlei.cn/wechat/getUserInfo?openid=oLsoz6o6u1jqwMr7cLKfKwlOjZzY\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1282,1283"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/cb257a22a0fcfd4c2f8baf8daeec4039.png\" alt>","children":[],"payload":{"tag":"img","lines":"1284,1285"}},{"content":"<pre data-lines=\"1286,1287\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://developers.weixin.qq.com/doc/offiaccount/OA\\_Web\\_Apps/Wechat\\_webpage\\_authorization.html\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1286,1287"}}],"payload":{"tag":"h2","lines":"1262,1264"}},{"content":"8.1&#x3001;&#x751f;&#x6210;&#x767b;&#x5f55;&#x9875;&#x9762;","children":[{"content":"<pre data-lines=\"1291,1292\"><code>&#x8bbf;&#x95ee;&#x5730;&#x5740;&#xff1a;https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1291,1292"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/69ff10166a726debd7217907f75a2c63.png\" alt>","children":[],"payload":{"tag":"img","lines":"1293,1294"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/540abca3a1ad6e1b29a022b99d74cc15.png\" alt>","children":[],"payload":{"tag":"img","lines":"1295,1296"}},{"content":"<pre data-lines=\"1297,1298\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaWebController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1297,1298"}},{"content":"<pre data-lines=\"1299,1320\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-meta\">@RestController</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">WcoaWebController</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">APP_ID</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;wxafdce898abdebe78&quot;</span>;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">APP_SECRET</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;45add7100b5cf5a9b8de655d5308d976&quot;</span>;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">APP_REDIRECT_URI</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;http://caochenlei.cn/wechat/web/login&quot;</span>;\n\n    <span class=\"hljs-meta\">@GetMapping(value = &quot;/wechat/web/create&quot;, produces = {MediaType.TEXT_HTML_VALUE})</span>\n    <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">create</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-type\">StringBuilder</span> <span class=\"hljs-variable\">url</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringBuilder</span>(<span class=\"hljs-string\">&quot;https://open.weixin.qq.com/connect/oauth2/authorize&quot;</span>);\n        url.append(<span class=\"hljs-string\">&quot;?appid=&quot;</span>).append(APP_ID);\n        url.append(<span class=\"hljs-string\">&quot;&amp;redirect_uri=&quot;</span>).append(APP_REDIRECT_URI);\n        url.append(<span class=\"hljs-string\">&quot;&amp;response_type=&quot;</span>).append(<span class=\"hljs-string\">&quot;code&quot;</span>);\n        url.append(<span class=\"hljs-string\">&quot;&amp;scope=&quot;</span>).append(<span class=\"hljs-string\">&quot;snsapi_userinfo&quot;</span>);\n        url.append(<span class=\"hljs-string\">&quot;#wechat_redirect&quot;</span>);\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;&lt;html&gt;&lt;body&gt;&lt;h1 align=&apos;center&apos;&gt;&lt;a href=&apos;&quot;</span> + url + <span class=\"hljs-string\">&quot;&apos;&gt;&#x70b9;&#x51fb;&#x767b;&#x5f55;&lt;/a&gt;&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>;\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1299,1320"}}],"payload":{"tag":"h2","lines":"1288,1290"}},{"content":"8.2&#x3001;&#x7528;&#x6237;&#x767b;&#x5f55;&#x6388;&#x6743;","children":[{"content":"<pre data-lines=\"1324,1325\"><code>io.caochenlei.wcoa.api.demo.domain.AccessTokenWeb\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1324,1325"}},{"content":"<pre data-lines=\"1326,1342\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AccessTokenWeb</span> {\n    <span class=\"hljs-meta\">@JsonProperty(&quot;access_token&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String accessToken;\n    <span class=\"hljs-meta\">@JsonProperty(&quot;expires_in&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> Long expiresIn;\n    <span class=\"hljs-meta\">@JsonProperty(&quot;refresh_token&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String refreshToken;\n    <span class=\"hljs-meta\">@JsonProperty(&quot;openid&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String openId;\n    <span class=\"hljs-meta\">@JsonProperty(&quot;scope&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String scope;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1326,1342"}},{"content":"<pre data-lines=\"1343,1344\"><code>io.caochenlei.wcoa.api.demo.domain.User\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1343,1344"}},{"content":"<pre data-lines=\"1345,1367\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">User</span> {\n    <span class=\"hljs-meta\">@JsonProperty(&quot;openid&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String openId;\n    <span class=\"hljs-meta\">@JsonProperty(&quot;nickname&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String nickname;\n    <span class=\"hljs-meta\">@JsonProperty(&quot;sex&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String sex;\n    <span class=\"hljs-meta\">@JsonProperty(&quot;province&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String province;\n    <span class=\"hljs-meta\">@JsonProperty(&quot;city&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String city;\n    <span class=\"hljs-meta\">@JsonProperty(&quot;headimgurl&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String headImgUrl;\n    <span class=\"hljs-meta\">@JsonProperty(&quot;privilege&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String privilege;\n    <span class=\"hljs-meta\">@JsonProperty(&quot;unionid&quot;)</span>\n    <span class=\"hljs-keyword\">private</span> String unionId;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1345,1367"}},{"content":"<pre data-lines=\"1368,1369\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaWebController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1368,1369"}},{"content":"<pre data-lines=\"1370,1398\"><code class=\"language-java\"><span class=\"hljs-meta\">@Autowired</span>\n<span class=\"hljs-keyword\">private</span> RestTemplate restTemplate;\n<span class=\"hljs-keyword\">private</span> AccessTokenWeb accessTokenWeb;\n\n<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">GET_ACCESS_TOKEN_WEB</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=APPSECRET&amp;code=CODE&amp;grant_type=authorization_code&quot;</span>;\n<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">GET_USER_INFO</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/sns/userinfo?access_token=ACCESS_TOKEN&amp;openid=OPENID&amp;lang=zh_CN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/web/login&quot;)</span>\n<span class=\"hljs-keyword\">public</span> Map&lt;String, Object&gt; <span class=\"hljs-title function_\">login</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;code&quot;)</span> String code)</span> {\n    \n    log.info(<span class=\"hljs-string\">&quot;code={}&quot;</span>, code);\n    <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">respObject</span> <span class=\"hljs-operator\">=</span> restTemplate.getForObject(GET_ACCESS_TOKEN_WEB.replace(<span class=\"hljs-string\">&quot;APPID&quot;</span>, APP_ID).replace(<span class=\"hljs-string\">&quot;APPSECRET&quot;</span>, APP_SECRET).replace(<span class=\"hljs-string\">&quot;CODE&quot;</span>, code), String.class);\n    accessTokenWeb = JSONObject.parseObject(respObject, AccessTokenWeb.class);\n    log.info(<span class=\"hljs-string\">&quot;accessTokenWeb={}&quot;</span>, accessTokenWeb);\n    \n    respObject = restTemplate.getForObject(GET_USER_INFO.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessTokenWeb.getAccessToken()).replace(<span class=\"hljs-string\">&quot;OPENID&quot;</span>, accessTokenWeb.getOpenId()), String.class);\n    respObject = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>(respObject.getBytes(StandardCharsets.ISO_8859_1), StandardCharsets.UTF_8);\n    <span class=\"hljs-type\">User</span> <span class=\"hljs-variable\">user</span> <span class=\"hljs-operator\">=</span> JSONObject.parseObject(respObject, User.class);\n    log.info(<span class=\"hljs-string\">&quot;user={}&quot;</span>, user);\n    \n    Map&lt;String, Object&gt; resp = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashMap</span>&lt;&gt;();\n    resp.put(<span class=\"hljs-string\">&quot;accessTokenWeb&quot;</span>, accessTokenWeb);\n    resp.put(<span class=\"hljs-string\">&quot;user&quot;</span>, user);\n    <span class=\"hljs-keyword\">return</span> resp;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1370,1398"}}],"payload":{"tag":"h2","lines":"1321,1323"}},{"content":"8.3&#x3001;&#x5237;&#x65b0;ACCESS_TOKEN","children":[{"content":"<pre data-lines=\"1402,1403\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaWebController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1402,1403"}},{"content":"<pre data-lines=\"1404,1415\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">REFRESH_TOKEN</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=APPID&amp;grant_type=refresh_token&amp;refresh_token=REFRESH_TOKEN&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/refreshToken&quot;)</span>\n<span class=\"hljs-keyword\">public</span> AccessTokenWeb <span class=\"hljs-title function_\">refreshToken</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;refresh_token&quot;)</span> String refreshToken)</span> {\n    <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">respObject</span> <span class=\"hljs-operator\">=</span> restTemplate.getForObject(REFRESH_TOKEN.replace(<span class=\"hljs-string\">&quot;APPID&quot;</span>, APP_ID).replace(<span class=\"hljs-string\">&quot;REFRESH_TOKEN&quot;</span>, refreshToken), String.class);\n    accessTokenWeb = JSONObject.parseObject(respObject, AccessTokenWeb.class);\n    <span class=\"hljs-keyword\">return</span> accessTokenWeb;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1404,1415"}}],"payload":{"tag":"h2","lines":"1399,1401"}},{"content":"8.4&#x3001;&#x68c0;&#x9a8c;ACCESS_TOKEN","children":[{"content":"<pre data-lines=\"1419,1420\"><code>io.caochenlei.wcoa.api.demo.controller.WcoaWebController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1419,1420"}},{"content":"<pre data-lines=\"1421,1430\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">CHECK_TOKEN</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;https://api.weixin.qq.com/sns/auth?access_token=ACCESS_TOKEN&amp;openid=OPENID&quot;</span>;\n\n<span class=\"hljs-meta\">@GetMapping(&quot;/wechat/checkToken&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">checkToken</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;access_token&quot;)</span> String accessToken, <span class=\"hljs-meta\">@RequestParam(&quot;openid&quot;)</span> String openId)</span> {\n    <span class=\"hljs-keyword\">return</span> restTemplate.getForObject(CHECK_TOKEN.replace(<span class=\"hljs-string\">&quot;ACCESS_TOKEN&quot;</span>, accessToken).replace(<span class=\"hljs-string\">&quot;OPENID&quot;</span>, openId), String.class);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1421,1430"}}],"payload":{"tag":"h2","lines":"1416,1418"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
