<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"&#x7f51;&#x7edc;&#x7f16;&#x7a0b;&#x5b66;&#x4e60;","children":[{"content":"1.1&#x3001;&#x73af;&#x5883;&#x51c6;&#x5907;","children":[{"content":"","children":[{"content":"IDEA&#xff1a;2021.1","children":[],"payload":{"tag":"li","lines":"7,8"}},{"content":"Maven&#xff1a;3.6.3","children":[],"payload":{"tag":"li","lines":"8,9"}},{"content":"JDK&#xff1a;1.8.0_291","children":[],"payload":{"tag":"li","lines":"9,11"}}],"payload":{"tag":"ul","lines":"7,11"}},{"content":"","children":[{"content":"\n<p data-lines=\"13,14\">&#x9879;&#x76ee;&#x7c7b;&#x578b;&#xff1a;<code>Maven&#x9879;&#x76ee;</code></p>","children":[],"payload":{"tag":"li","lines":"13,15"}},{"content":"\n<p data-lines=\"15,16\">&#x9879;&#x76ee;&#x540d;&#x79f0;&#xff1a;<code>netty-demo</code></p>","children":[],"payload":{"tag":"li","lines":"15,17"}},{"content":"\n<p data-lines=\"17,18\">&#x9879;&#x76ee;&#x5305;&#x540d;&#xff1a;<code>io.github.caochenlei</code></p>","children":[],"payload":{"tag":"li","lines":"17,19"}},{"content":"\n<p data-lines=\"19,20\">&#x9879;&#x76ee;&#x4f9d;&#x8d56;&#xff1a;<code>pom.xml</code></p>\n<pre data-lines=\"21,68\"><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencies</span>&gt;</span>\n    \n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.netty<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>netty-all<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.1.65.Final<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n    \n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.projectlombok<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>lombok<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.18.20<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n    \n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>ch.qos.logback<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>logback-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.2.3<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n    \n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>ch.qos.logback<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>logback-classic<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.2.3<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n    \n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.code.gson<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>gson<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.8.7<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n    \n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>19.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n    \n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.protobuf<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>protobuf-java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.17.2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencies</span>&gt;</span>\n\n</code></pre>","children":[],"payload":{"tag":"li","lines":"19,69"}},{"content":"\n<p data-lines=\"69,70\">&#x65e5;&#x5fd7;&#x914d;&#x7f6e;&#xff1a;<code>src/main/resources/logback.xml</code></p>\n<pre data-lines=\"71,95\"><code class=\"language-xml\"><span class=\"hljs-meta\">&lt;?xml version=<span class=\"hljs-string\">&quot;1.0&quot;</span> encoding=<span class=\"hljs-string\">&quot;UTF-8&quot;</span>?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">configuration</span> <span class=\"hljs-attr\">scan</span>=<span class=\"hljs-string\">&quot;true&quot;</span> <span class=\"hljs-attr\">scanPeriod</span>=<span class=\"hljs-string\">&quot;3 seconds&quot;</span> <span class=\"hljs-attr\">debug</span>=<span class=\"hljs-string\">&quot;false&quot;</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">appender</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;STDOUT&quot;</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">encoder</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">pattern</span>&gt;</span>%date{HH:mm:ss} [%-5level] [%thread] %logger{17} - %m%n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">pattern</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">encoder</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">appender</span>&gt;</span>\n\n    \n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">logger</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;io.github.caochenlei&quot;</span> <span class=\"hljs-attr\">level</span>=<span class=\"hljs-string\">&quot;DEBUG&quot;</span> <span class=\"hljs-attr\">additivity</span>=<span class=\"hljs-string\">&quot;false&quot;</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">appender-ref</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;STDOUT&quot;</span>/&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">logger</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">logger</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;io.netty.handler.logging.LoggingHandler&quot;</span> <span class=\"hljs-attr\">level</span>=<span class=\"hljs-string\">&quot;DEBUG&quot;</span> <span class=\"hljs-attr\">additivity</span>=<span class=\"hljs-string\">&quot;false&quot;</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">appender-ref</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;STDOUT&quot;</span>/&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">logger</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">root</span> <span class=\"hljs-attr\">level</span>=<span class=\"hljs-string\">&quot;ERROR&quot;</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">appender-ref</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;STDOUT&quot;</span>/&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">root</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">configuration</span>&gt;</span>\n\n</code></pre>","children":[],"payload":{"tag":"li","lines":"69,97"}}],"payload":{"tag":"ul","lines":"13,97"}}],"payload":{"tag":"h2","lines":"2,4"}},{"content":"1.2&#x3001;NIO&#x4ecb;&#x7ecd;","children":[{"content":"<pre data-lines=\"100,111\"><code>**&#x540c;&#x6b65;&#x4e0e;&#x5f02;&#x6b65;&#xff1a;** \n\n&#x540c;&#x6b65;&#xff08;Synchronous&#xff09;&#x548c;&#x5f02;&#x6b65;&#xff08;Asynchronous&#xff09;&#x5173;&#x6ce8;&#x7684;&#x662f;&#x6d88;&#x606f;&#x901a;&#x4fe1;&#x673a;&#x5236;&#x3002;&#x540c;&#x6b65;&#xff0c;&#x5c31;&#x662f;&#x8c03;&#x7528;&#x67d0;&#x4e2a;&#x4e1c;&#x897f;&#x65f6;&#xff0c;&#x8c03;&#x7528;&#x65b9;&#x5f97;&#x7b49;&#x5f85;&#x8fd9;&#x4e2a;&#x8c03;&#x7528;&#x8fd4;&#x56de;&#x7ed3;&#x679c;&#x624d;&#x80fd;&#x7ee7;&#x7eed;&#x5f80;&#x540e;&#x6267;&#x884c;&#x3002;&#x5f02;&#x6b65;&#xff0c;&#x548c;&#x540c;&#x6b65;&#x76f8;&#x53cd;&#xff0c;&#x8c03;&#x7528;&#x65b9;&#x4e0d;&#x4f1a;&#x7acb;&#x523b;&#x5f97;&#x5230;&#x7ed3;&#x679c;&#xff0c;&#x800c;&#x662f;&#x5728;&#x8c03;&#x7528;&#x53d1;&#x51fa;&#x540e;&#x8c03;&#x7528;&#x8005;&#x53ef;&#x4ee5;&#x7ee7;&#x7eed;&#x6267;&#x884c;&#x540e;&#x7eed;&#x64cd;&#x4f5c;&#xff0c;&#x88ab;&#x8c03;&#x7528;&#x8005;&#x901a;&#x8fc7;&#x72b6;&#x6001;&#x6765;&#x901a;&#x77e5;&#x8c03;&#x7528;&#x8005;&#xff0c;&#x6216;&#x8005;&#x901a;&#x8fc7;&#x56de;&#x6389;&#x51fd;&#x6570;&#x6765;&#x5904;&#x7406;&#x8fd9;&#x4e2a;&#x8c03;&#x7528;&#x3002;\n\n**&#x963b;&#x585e;&#x4e0e;&#x975e;&#x963b;&#x585e;&#xff1a;** \n\n&#x963b;&#x585e;&#xff08;Blocking&#xff09;&#x548c;&#x975e;&#x963b;&#x585e;&#xff08;Non-Blocking&#xff09;&#x5173;&#x6ce8;&#x7684;&#x662f;&#x8c03;&#x7528;&#x8005;&#x5728;&#x7b49;&#x5f85;&#x8c03;&#x7528;&#x7ed3;&#x679c;&#xff08;&#x6d88;&#x606f;&#xff0c;&#x8fd4;&#x56de;&#x503c;&#xff09;&#x65f6;&#x7684;&#x72b6;&#x6001;&#x3002;&#x963b;&#x585e;&#x65f6;&#xff0c;&#x5728;&#x8c03;&#x7528;&#x7ed3;&#x679c;&#x8fd4;&#x56de;&#x524d;&#xff0c;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x4f1a;&#x88ab;&#x6302;&#x8d77;&#xff0c;&#x5e76;&#x5728;&#x5f97;&#x5230;&#x7ed3;&#x679c;&#x4e4b;&#x540e;&#x8fd4;&#x56de;&#x3002;&#x975e;&#x963b;&#x585e;&#x65f6;&#xff0c;&#x5982;&#x679c;&#x4e0d;&#x80fd;&#x7acb;&#x523b;&#x5f97;&#x5230;&#x7ed3;&#x679c;&#xff0c;&#x5219;&#x8be5;&#x8c03;&#x7528;&#x8005;&#x4e0d;&#x4f1a;&#x963b;&#x585e;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x3002;&#x56e0;&#x6b64;&#x5bf9;&#x5e94;&#x975e;&#x963b;&#x585e;&#x7684;&#x60c5;&#x51b5;&#xff0c;&#x8c03;&#x7528;&#x8005;&#x9700;&#x8981;&#x5b9a;&#x65f6;&#x8f6e;&#x8be2;&#x67e5;&#x770b;&#x5904;&#x7406;&#x72b6;&#x6001;&#x3002;\n\n**&#x4ec0;&#x4e48;&#x662f;NIO&#xff1f;**\n\nNIO&#xff08;JDK1.4&#xff09;&#x6a21;&#x578b;&#x662f;&#x4e00;&#x79cd;&#x540c;&#x6b65;&#x975e;&#x963b;&#x585e;IO&#xff0c;&#x4e3b;&#x8981;&#x6709;&#x4e09;&#x5927;&#x6838;&#x5fc3;&#x90e8;&#x5206;&#xff1a;Channel&#xff08;&#x901a;&#x9053;&#xff09;&#xff0c;Buffer&#xff08;&#x7f13;&#x51b2;&#x533a;&#xff09;&#xff0c;Selector&#xff08;&#x591a;&#x8def;&#x590d;&#x7528;&#x5668;&#xff09;&#x3002;&#x4f20;&#x7edf;IO&#x57fa;&#x4e8e;&#x5b57;&#x8282;&#x6d41;&#x548c;&#x5b57;&#x7b26;&#x6d41;&#x8fdb;&#x884c;&#x64cd;&#x4f5c;&#xff0c;&#x800c;NIO&#x57fa;&#x4e8e;Channel&#x548c;Buffer&#x8fdb;&#x884c;&#x64cd;&#x4f5c;&#xff0c;&#x6570;&#x636e;&#x603b;&#x662f;&#x4ece;&#x901a;&#x9053;&#x8bfb;&#x53d6;&#x5230;&#x7f13;&#x51b2;&#x533a;&#x4e2d;&#xff0c;&#x6216;&#x8005;&#x4ece;&#x7f13;&#x51b2;&#x533a;&#x5199;&#x5165;&#x5230;&#x901a;&#x9053;&#x4e2d;&#x3002;Selector&#x7528;&#x4e8e;&#x76d1;&#x542c;&#x591a;&#x4e2a;&#x901a;&#x9053;&#x7684;&#x4e8b;&#x4ef6;&#xff08;&#x6bd4;&#x5982;&#xff1a;&#x8fde;&#x63a5;&#x6253;&#x5f00;&#xff0c;&#x6570;&#x636e;&#x5230;&#x8fbe;&#xff09;&#x3002;&#x56e0;&#x6b64;&#xff0c;&#x5355;&#x4e2a;&#x7ebf;&#x7a0b;&#x53ef;&#x4ee5;&#x76d1;&#x542c;&#x591a;&#x4e2a;&#x6570;&#x636e;&#x901a;&#x9053;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"100,111"}}],"payload":{"tag":"h2","lines":"97,99"}},{"content":"1.3&#x3001;&#x4e09;&#x5927;&#x7ec4;&#x4ef6;","children":[{"content":"1.3.1&#x3001;Channel &amp; Buffer","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/a050488ea4ac65676a211a2b2afe6fe8.png\" alt>","children":[],"payload":{"tag":"img","lines":"117,118"}},{"content":"<pre data-lines=\"119,138\"><code>channel &#x6709;&#x4e00;&#x70b9;&#x7c7b;&#x4f3c;&#x4e8e; stream&#xff0c;&#x5b83;&#x5c31;&#x662f;&#x8bfb;&#x5199;&#x6570;&#x636e;&#x7684;**&#x53cc;&#x5411;&#x901a;&#x9053;**&#xff0c;&#x53ef;&#x4ee5;&#x4ece; channel &#x5c06;&#x6570;&#x636e;&#x8bfb;&#x5165; buffer&#xff0c;&#x4e5f;&#x53ef;&#x4ee5;&#x5c06; buffer &#x7684;&#x6570;&#x636e;&#x5199;&#x5165; channel&#xff0c;&#x800c;&#x4e4b;&#x524d;&#x7684; stream &#x8981;&#x4e48;&#x662f;&#x8f93;&#x5165;&#xff0c;&#x8981;&#x4e48;&#x662f;&#x8f93;&#x51fa;&#xff0c;channel &#x6bd4; stream &#x66f4;&#x4e3a;&#x5e95;&#x5c42;&#xff0c;&#x5e38;&#x89c1;&#x7684; channel &#x6709;&#xff1a;\n\n*   FileChannel\n*   DatagramChannel\n*   SocketChannel\n*   ServerSocketChannel\n\nbuffer &#x5219;&#x7528;&#x6765;&#x7f13;&#x51b2;&#x8bfb;&#x5199;&#x6570;&#x636e;&#xff0c;&#x5e38;&#x89c1;&#x7684; buffer &#x6709;&#xff1a;\n\n*   ByteBuffer\n    *   MappedByteBuffer\n    *   DirectByteBuffer\n    *   HeapByteBuffer\n*   ShortBuffer\n*   IntBuffer\n*   LongBuffer\n*   FloatBuffer\n*   DoubleBuffer\n*   CharBuffer\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"119,138"}}],"payload":{"tag":"h3","lines":"115,116"}},{"content":"1.3.2&#x3001;Selector","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/4ceb784196ae7e17a69265f2d6ae37a1.png\" alt>","children":[],"payload":{"tag":"img","lines":"141,142"}},{"content":"<pre data-lines=\"143,144\"><code>selector &#x7684;&#x4f5c;&#x7528;&#x5c31;&#x662f;&#x914d;&#x5408;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x6765;&#x7ba1;&#x7406;&#x591a;&#x4e2a; channel&#xff0c;&#x83b7;&#x53d6;&#x8fd9;&#x4e9b; channel &#x4e0a;&#x53d1;&#x751f;&#x7684;&#x4e8b;&#x4ef6;&#xff0c;&#x8fd9;&#x4e9b; channel &#x5de5;&#x4f5c;&#x5728;&#x975e;&#x963b;&#x585e;&#x6a21;&#x5f0f;&#x4e0b;&#xff0c;&#x4e0d;&#x4f1a;&#x8ba9;&#x7ebf;&#x7a0b;&#x540a;&#x6b7b;&#x5728;&#x4e00;&#x4e2a; channel &#x4e0a;&#x3002;&#x9002;&#x5408;&#x8fde;&#x63a5;&#x6570;&#x7279;&#x522b;&#x591a;&#xff0c;&#x4f46;&#x6d41;&#x91cf;&#x4f4e;&#x7684;&#x573a;&#x666f;&#xff08;low traffic&#xff09;&#x3002;&#x8c03;&#x7528; selector &#x7684; select() &#x4f1a;&#x963b;&#x585e;&#x76f4;&#x5230; channel &#x53d1;&#x751f;&#x4e86;&#x8bfb;&#x5199;&#x5c31;&#x7eea;&#x4e8b;&#x4ef6;&#xff0c;&#x8fd9;&#x4e9b;&#x4e8b;&#x4ef6;&#x53d1;&#x751f;&#xff0c;select &#x65b9;&#x6cd5;&#x5c31;&#x4f1a;&#x8fd4;&#x56de;&#x8fd9;&#x4e9b;&#x4e8b;&#x4ef6;&#x4ea4;&#x7ed9; thread &#x6765;&#x5904;&#x7406;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"143,144"}}],"payload":{"tag":"h3","lines":"139,140"}}],"payload":{"tag":"h2","lines":"112,114"}},{"content":"1.4&#x3001;ByteBuffer","children":[{"content":"1.4.1&#x3001;ByteBuffer &#x6b63;&#x786e;&#x4f7f;&#x7528;","children":[{"content":"<pre data-lines=\"150,167\"><code>**&#x51c6;&#x5907;&#x6587;&#x672c;&#xff1a;** \n\n*   &#x5728;&#x9879;&#x76ee; `netty-demo` &#x53f3;&#x952e;&#xff0c;&#x65b0;&#x5efa;&#x4e00;&#x4e2a; `data.txt`&#xff0c;&#x5185;&#x5bb9;&#x4e3a; `1234567890abcd`\n\n**&#x5efa;&#x6d4b;&#x8bd5;&#x5305;&#xff1a;** \n\n*   `io.github.caochenlei.nio`\n\n**&#x4f7f;&#x7528;&#x6b65;&#x9aa4;&#xff1a;** \n\n1.  &#x5411; buffer &#x5199;&#x5165;&#x6570;&#x636e;&#xff0c;&#x4f8b;&#x5982;&#x8c03;&#x7528; channel.read(buffer)\n2.  &#x8c03;&#x7528; flip() &#x5207;&#x6362;&#x81f3;**&#x8bfb;&#x6a21;&#x5f0f;**\n3.  &#x4ece; buffer &#x8bfb;&#x53d6;&#x6570;&#x636e;&#xff0c;&#x4f8b;&#x5982;&#x8c03;&#x7528; buffer.get()\n4.  &#x8c03;&#x7528; clear() &#x6216; compact() &#x5207;&#x6362;&#x81f3;**&#x5199;&#x6a21;&#x5f0f;**\n5.  &#x91cd;&#x590d; 1~4 &#x6b65;&#x9aa4;\n\n**&#x4ee3;&#x7801;&#x6f14;&#x793a;&#xff1a;** \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"150,167"}},{"content":"<pre data-lines=\"168,186\"><code class=\"language-java\"><span class=\"hljs-keyword\">try</span> (<span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FileInputStream</span>(<span class=\"hljs-string\">&quot;data.txt&quot;</span>).getChannel()) {\n    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">10</span>);\n    <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">len</span> <span class=\"hljs-operator\">=</span> channel.read(buffer);\n        <span class=\"hljs-keyword\">if</span> (len == -<span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">break</span>;\n        buffer.flip();\n        <span class=\"hljs-keyword\">while</span> (buffer.hasRemaining()) {\n            <span class=\"hljs-type\">byte</span> <span class=\"hljs-variable\">b</span> <span class=\"hljs-operator\">=</span> buffer.get();\n            log.debug(<span class=\"hljs-string\">&quot;&#x5b9e;&#x9645;&#x5b57;&#x8282; {}&quot;</span>, (<span class=\"hljs-type\">char</span>) b);\n        }\n        buffer.clear();\n    }\n} <span class=\"hljs-keyword\">catch</span> (IOException e) {\n    e.printStackTrace();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"168,186"}},{"content":"<pre data-lines=\"187,188\"><code>**&#x8fd0;&#x884c;&#x6548;&#x679c;&#xff1a;** \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"187,188"}},{"content":"<pre data-lines=\"189,206\"><code class=\"language-java\">20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; 1\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; 2\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; 3\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; 4\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; 5\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; 6\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; 7\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; 8\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; 9\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; 0\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; a\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; b\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; c\n20:24:24 [DEBUG] [main] i.g.c.n.TestByteBuffer - &#x5b9e;&#x9645;&#x5b57;&#x8282; d\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"189,206"}}],"payload":{"tag":"h3","lines":"148,149"}},{"content":"1.4.2&#x3001;ByteBuffer &#x5185;&#x90e8;&#x7ed3;&#x6784;","children":[{"content":"<pre data-lines=\"209,216\"><code>ByteBuffer &#x6709;&#x4ee5;&#x4e0b;&#x91cd;&#x8981;&#x5c5e;&#x6027;&#xff1a;\n\n*   capacity\n*   position\n*   limit\n\n&#x4e00;&#x5f00;&#x59cb;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"209,216"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/83746a4cc51250129ac0e4b99ba13998.png\" alt>","children":[],"payload":{"tag":"img","lines":"217,218"}},{"content":"<pre data-lines=\"219,220\"><code>&#x5199;&#x6a21;&#x5f0f;&#x4e0b;&#xff0c;position &#x662f;&#x5199;&#x5165;&#x4f4d;&#x7f6e;&#xff0c;limit &#x7b49;&#x4e8e;&#x5bb9;&#x91cf;&#xff0c;&#x4e0b;&#x56fe;&#x8868;&#x793a;&#x5199;&#x5165;&#x4e86; 4 &#x4e2a;&#x5b57;&#x8282;&#x540e;&#x7684;&#x72b6;&#x6001;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"219,220"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/8a0c01a3dbac518ca88b43a4eb51d659.png\" alt>","children":[],"payload":{"tag":"img","lines":"221,222"}},{"content":"<pre data-lines=\"223,224\"><code>flip &#x52a8;&#x4f5c;&#x53d1;&#x751f;&#x540e;&#xff0c;position &#x5207;&#x6362;&#x4e3a;&#x8bfb;&#x53d6;&#x4f4d;&#x7f6e;&#xff0c;limit &#x5207;&#x6362;&#x4e3a;&#x8bfb;&#x53d6;&#x9650;&#x5236;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"223,224"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/467d45af407856b5736ab957d5a402f6.png\" alt>","children":[],"payload":{"tag":"img","lines":"225,226"}},{"content":"<pre data-lines=\"227,228\"><code>&#x8bfb;&#x53d6; 4 &#x4e2a;&#x5b57;&#x8282;&#x540e;&#xff0c;&#x72b6;&#x6001;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"227,228"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/2ca5d2e76d41a90eee5f727e82dfb4a9.png\" alt>","children":[],"payload":{"tag":"img","lines":"229,230"}},{"content":"<pre data-lines=\"231,232\"><code>clear &#x52a8;&#x4f5c;&#x53d1;&#x751f;&#x540e;&#xff0c;&#x72b6;&#x6001;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"231,232"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/19ea3a51cf57dd6d9b3e096fb3b8781e.png\" alt>","children":[],"payload":{"tag":"img","lines":"233,234"}},{"content":"<pre data-lines=\"235,236\"><code>compact &#x65b9;&#x6cd5;&#xff0c;&#x662f;&#x628a;&#x672a;&#x8bfb;&#x5b8c;&#x7684;&#x90e8;&#x5206;&#x5411;&#x524d;&#x538b;&#x7f29;&#xff0c;&#x7136;&#x540e;&#x5207;&#x6362;&#x81f3;&#x5199;&#x6a21;&#x5f0f;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"235,236"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/52b755aa0fe8b8bac7caea81df69d819.png\" alt>","children":[],"payload":{"tag":"img","lines":"237,238"}}],"payload":{"tag":"h3","lines":"207,208"}},{"content":"1.4.3&#x3001;ByteBuffer &#x8c03;&#x8bd5;&#x5de5;&#x5177;","children":[{"content":"<pre data-lines=\"241,412\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ByteBufferUtil</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">char</span>[] BYTE2CHAR = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">char</span>[<span class=\"hljs-number\">256</span>];\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">char</span>[] HEXDUMP_TABLE = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">char</span>[<span class=\"hljs-number\">256</span> * <span class=\"hljs-number\">4</span>];\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String[] HEXPADDING = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>[<span class=\"hljs-number\">16</span>];\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String[] HEXDUMP_ROWPREFIXES = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>[<span class=\"hljs-number\">65536</span> &gt;&gt;&gt; <span class=\"hljs-number\">4</span>];\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String[] BYTE2HEX = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>[<span class=\"hljs-number\">256</span>];\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String[] BYTEPADDING = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>[<span class=\"hljs-number\">16</span>];\n\n    <span class=\"hljs-keyword\">static</span> {\n        <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">char</span>[] DIGITS = <span class=\"hljs-string\">&quot;0123456789abcdef&quot;</span>.toCharArray();\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">256</span>; i++) {\n            HEXDUMP_TABLE[i &lt;&lt; <span class=\"hljs-number\">1</span>] = DIGITS[i &gt;&gt;&gt; <span class=\"hljs-number\">4</span> &amp; <span class=\"hljs-number\">0x0F</span>];\n            HEXDUMP_TABLE[(i &lt;&lt; <span class=\"hljs-number\">1</span>) + <span class=\"hljs-number\">1</span>] = DIGITS[i &amp; <span class=\"hljs-number\">0x0F</span>];\n        }\n\n        <span class=\"hljs-type\">int</span> i;\n\n        \n        <span class=\"hljs-keyword\">for</span> (i = <span class=\"hljs-number\">0</span>; i &lt; HEXPADDING.length; i++) {\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">padding</span> <span class=\"hljs-operator\">=</span> HEXPADDING.length - i;\n            <span class=\"hljs-type\">StringBuilder</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringBuilder</span>(padding * <span class=\"hljs-number\">3</span>);\n            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; j &lt; padding; j++) {\n                buf.append(<span class=\"hljs-string\">&quot;   &quot;</span>);\n            }\n            HEXPADDING[i] = buf.toString();\n        }\n\n        \n        <span class=\"hljs-keyword\">for</span> (i = <span class=\"hljs-number\">0</span>; i &lt; HEXDUMP_ROWPREFIXES.length; i++) {\n            <span class=\"hljs-type\">StringBuilder</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringBuilder</span>(<span class=\"hljs-number\">12</span>);\n            buf.append(NEWLINE);\n            buf.append(Long.toHexString(i &lt;&lt; <span class=\"hljs-number\">4</span> &amp; <span class=\"hljs-number\">0xFFFFFFFFL</span> | <span class=\"hljs-number\">0x100000000L</span>));\n            buf.setCharAt(buf.length() - <span class=\"hljs-number\">9</span>, <span class=\"hljs-string\">&apos;|&apos;</span>);\n            buf.append(<span class=\"hljs-string\">&apos;|&apos;</span>);\n            HEXDUMP_ROWPREFIXES[i] = buf.toString();\n        }\n\n        \n        <span class=\"hljs-keyword\">for</span> (i = <span class=\"hljs-number\">0</span>; i &lt; BYTE2HEX.length; i++) {\n            BYTE2HEX[i] = <span class=\"hljs-string\">&apos; &apos;</span> + StringUtil.byteToHexStringPadded(i);\n        }\n\n        \n        <span class=\"hljs-keyword\">for</span> (i = <span class=\"hljs-number\">0</span>; i &lt; BYTEPADDING.length; i++) {\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">padding</span> <span class=\"hljs-operator\">=</span> BYTEPADDING.length - i;\n            <span class=\"hljs-type\">StringBuilder</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringBuilder</span>(padding);\n            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; j &lt; padding; j++) {\n                buf.append(<span class=\"hljs-string\">&apos; &apos;</span>);\n            }\n            BYTEPADDING[i] = buf.toString();\n        }\n\n        \n        <span class=\"hljs-keyword\">for</span> (i = <span class=\"hljs-number\">0</span>; i &lt; BYTE2CHAR.length; i++) {\n            <span class=\"hljs-keyword\">if</span> (i &lt;= <span class=\"hljs-number\">0x1f</span> || i &gt;= <span class=\"hljs-number\">0x7f</span>) {\n                BYTE2CHAR[i] = <span class=\"hljs-string\">&apos;.&apos;</span>;\n            } <span class=\"hljs-keyword\">else</span> {\n                BYTE2CHAR[i] = (<span class=\"hljs-type\">char</span>) i;\n            }\n        }\n    }\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">debugAll</span><span class=\"hljs-params\">(ByteBuffer buffer)</span> {\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">oldlimit</span> <span class=\"hljs-operator\">=</span> buffer.limit();\n        buffer.limit(buffer.capacity());\n        <span class=\"hljs-type\">StringBuilder</span> <span class=\"hljs-variable\">origin</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringBuilder</span>(<span class=\"hljs-number\">256</span>);\n        appendPrettyHexDump(origin, buffer, <span class=\"hljs-number\">0</span>, buffer.capacity());\n        System.out.println(<span class=\"hljs-string\">&quot;+--------+-------------------- all ------------------------+----------------+&quot;</span>);\n        System.out.printf(<span class=\"hljs-string\">&quot;position: [%d], limit: [%d]\\n&quot;</span>, buffer.position(), oldlimit);\n        System.out.println(origin);\n        buffer.limit(oldlimit);\n    }\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">debugRead</span><span class=\"hljs-params\">(ByteBuffer buffer)</span> {\n        <span class=\"hljs-type\">StringBuilder</span> <span class=\"hljs-variable\">builder</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringBuilder</span>(<span class=\"hljs-number\">256</span>);\n        appendPrettyHexDump(builder, buffer, buffer.position(), buffer.limit() - buffer.position());\n        System.out.println(<span class=\"hljs-string\">&quot;+--------+-------------------- read -----------------------+----------------+&quot;</span>);\n        System.out.printf(<span class=\"hljs-string\">&quot;position: [%d], limit: [%d]\\n&quot;</span>, buffer.position(), buffer.limit());\n        System.out.println(builder);\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">10</span>);\n        buffer.put(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">97</span>, <span class=\"hljs-number\">98</span>, <span class=\"hljs-number\">99</span>, <span class=\"hljs-number\">100</span>});\n        debugAll(buffer);\n    }\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">appendPrettyHexDump</span><span class=\"hljs-params\">(StringBuilder dump, ByteBuffer buf, <span class=\"hljs-type\">int</span> offset, <span class=\"hljs-type\">int</span> length)</span> {\n        <span class=\"hljs-keyword\">if</span> (isOutOfBounds(offset, length, buf.capacity())) {\n            <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">IndexOutOfBoundsException</span>(\n                    <span class=\"hljs-string\">&quot;expected: &quot;</span> + <span class=\"hljs-string\">&quot;0 &lt;= offset(&quot;</span> + offset + <span class=\"hljs-string\">&quot;) &lt;= offset + length(&quot;</span> + length\n                            + <span class=\"hljs-string\">&quot;) &lt;= &quot;</span> + <span class=\"hljs-string\">&quot;buf.capacity(&quot;</span> + buf.capacity() + <span class=\"hljs-string\">&apos;)&apos;</span>);\n        }\n        <span class=\"hljs-keyword\">if</span> (length == <span class=\"hljs-number\">0</span>) {\n            <span class=\"hljs-keyword\">return</span>;\n        }\n        dump.append(\n                <span class=\"hljs-string\">&quot;         +-------------------------------------------------+&quot;</span> +\n                        NEWLINE + <span class=\"hljs-string\">&quot;         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |&quot;</span> +\n                        NEWLINE + <span class=\"hljs-string\">&quot;+--------+-------------------------------------------------+----------------+&quot;</span>);\n\n        <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">startIndex</span> <span class=\"hljs-operator\">=</span> offset;\n        <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">fullRows</span> <span class=\"hljs-operator\">=</span> length &gt;&gt;&gt; <span class=\"hljs-number\">4</span>;\n        <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">remainder</span> <span class=\"hljs-operator\">=</span> length &amp; <span class=\"hljs-number\">0xF</span>;\n\n        \n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">row</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; row &lt; fullRows; row++) {\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">rowStartIndex</span> <span class=\"hljs-operator\">=</span> (row &lt;&lt; <span class=\"hljs-number\">4</span>) + startIndex;\n\n            \n            appendHexDumpRowPrefix(dump, row, rowStartIndex);\n\n            \n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">rowEndIndex</span> <span class=\"hljs-operator\">=</span> rowStartIndex + <span class=\"hljs-number\">16</span>;\n            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> rowStartIndex; j &lt; rowEndIndex; j++) {\n                dump.append(BYTE2HEX[getUnsignedByte(buf, j)]);\n            }\n            dump.append(<span class=\"hljs-string\">&quot; |&quot;</span>);\n\n            \n            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> rowStartIndex; j &lt; rowEndIndex; j++) {\n                dump.append(BYTE2CHAR[getUnsignedByte(buf, j)]);\n            }\n            dump.append(<span class=\"hljs-string\">&apos;|&apos;</span>);\n        }\n\n        \n        <span class=\"hljs-keyword\">if</span> (remainder != <span class=\"hljs-number\">0</span>) {\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">rowStartIndex</span> <span class=\"hljs-operator\">=</span> (fullRows &lt;&lt; <span class=\"hljs-number\">4</span>) + startIndex;\n            appendHexDumpRowPrefix(dump, fullRows, rowStartIndex);\n\n            \n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">rowEndIndex</span> <span class=\"hljs-operator\">=</span> rowStartIndex + remainder;\n            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> rowStartIndex; j &lt; rowEndIndex; j++) {\n                dump.append(BYTE2HEX[getUnsignedByte(buf, j)]);\n            }\n            dump.append(HEXPADDING[remainder]);\n            dump.append(<span class=\"hljs-string\">&quot; |&quot;</span>);\n\n            \n            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> rowStartIndex; j &lt; rowEndIndex; j++) {\n                dump.append(BYTE2CHAR[getUnsignedByte(buf, j)]);\n            }\n            dump.append(BYTEPADDING[remainder]);\n            dump.append(<span class=\"hljs-string\">&apos;|&apos;</span>);\n        }\n\n        dump.append(NEWLINE +\n                <span class=\"hljs-string\">&quot;+--------+-------------------------------------------------+----------------+&quot;</span>);\n    }\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">appendHexDumpRowPrefix</span><span class=\"hljs-params\">(StringBuilder dump, <span class=\"hljs-type\">int</span> row, <span class=\"hljs-type\">int</span> rowStartIndex)</span> {\n        <span class=\"hljs-keyword\">if</span> (row &lt; HEXDUMP_ROWPREFIXES.length) {\n            dump.append(HEXDUMP_ROWPREFIXES[row]);\n        } <span class=\"hljs-keyword\">else</span> {\n            dump.append(NEWLINE);\n            dump.append(Long.toHexString(rowStartIndex &amp; <span class=\"hljs-number\">0xFFFFFFFFL</span> | <span class=\"hljs-number\">0x100000000L</span>));\n            dump.setCharAt(dump.length() - <span class=\"hljs-number\">9</span>, <span class=\"hljs-string\">&apos;|&apos;</span>);\n            dump.append(<span class=\"hljs-string\">&apos;|&apos;</span>);\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">short</span> <span class=\"hljs-title function_\">getUnsignedByte</span><span class=\"hljs-params\">(ByteBuffer buffer, <span class=\"hljs-type\">int</span> index)</span> {\n        <span class=\"hljs-keyword\">return</span> (<span class=\"hljs-type\">short</span>) (buffer.get(index) &amp; <span class=\"hljs-number\">0xFF</span>);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"241,412"}}],"payload":{"tag":"h3","lines":"239,240"}},{"content":"1.4.4&#x3001;ByteBuffer &#x5e38;&#x7528;&#x65b9;&#x6cd5;","children":[{"content":"1.4.4.1&#x3001;ByteBuffer&#x5206;&#x914d;&#x7a7a;&#x95f4;","children":[{"content":"<pre data-lines=\"417,418\"><code>&#x53ef;&#x4ee5;&#x4f7f;&#x7528; allocate &#x65b9;&#x6cd5;&#x4e3a; ByteBuffer &#x5206;&#x914d;&#x7a7a;&#x95f4;&#xff0c;&#x5176;&#x5b83; buffer &#x7c7b;&#x4e5f;&#x6709;&#x8be5;&#x65b9;&#x6cd5;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"417,418"}},{"content":"<pre data-lines=\"419,423\"><code class=\"language-java\"><span class=\"hljs-type\">Bytebuffer</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">16</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"419,423"}},{"content":"<pre data-lines=\"424,426\"><code>*   ByteBuffer.allocate(16).getClass()&#xff1a;class java.nio.HeapByteBuffer&#xff0c;java &#x5806;&#x5185;&#x5b58;&#xff0c;&#x8bfb;&#x5199;&#x6548;&#x7387;&#x4f4e;&#xff0c;&#x53d7;&#x5230; GC &#x7684;&#x5f71;&#x54cd;&#xff0c;&#x5206;&#x914d;&#x7684;&#x6548;&#x7387;&#x9ad8;\n*   ByteBuffer.allocateDirect(16).getClass()&#xff1a;class java.nio.DirectByteBuffer&#xff0c;&#x76f4;&#x63a5;&#x5185;&#x5b58;&#xff0c;&#x8bfb;&#x5199;&#x6548;&#x7387;&#x9ad8;&#xff0c;&#x4e0d;&#x53d7; GC &#x5f71;&#x54cd;&#xff0c;&#x5206;&#x914d;&#x7684;&#x6548;&#x7387;&#x4f4e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"424,426"}}],"payload":{"tag":"h4","lines":"415,416"}},{"content":"1.4.4.2&#x3001;&#x5411; buffer &#x5199;&#x5165;&#x6570;&#x636e;","children":[{"content":"<pre data-lines=\"429,432\"><code>&#x6709;&#x4e24;&#x79cd;&#x529e;&#x6cd5;&#xff1a;\n\n*   &#x8c03;&#x7528; channel &#x7684; read &#x65b9;&#x6cd5;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"429,432"}},{"content":"<pre data-lines=\"433,437\"><code class=\"language-java\"><span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">readBytes</span> <span class=\"hljs-operator\">=</span> channel.read(buf);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"433,437"}},{"content":"<pre data-lines=\"438,439\"><code>*   &#x8c03;&#x7528; buffer &#x81ea;&#x5df1;&#x7684; put &#x65b9;&#x6cd5;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"438,439"}},{"content":"<pre data-lines=\"440,444\"><code class=\"language-java\">buf.put((<span class=\"hljs-type\">byte</span>)<span class=\"hljs-number\">127</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"440,444"}}],"payload":{"tag":"h4","lines":"427,428"}},{"content":"1.4.4.3&#x3001;&#x4ece; buffer &#x8bfb;&#x53d6;&#x6570;&#x636e;","children":[{"content":"<pre data-lines=\"447,450\"><code>&#x6709;&#x4e24;&#x79cd;&#x529e;&#x6cd5;&#xff1a;\n\n*   &#x8c03;&#x7528; channel &#x7684; write &#x65b9;&#x6cd5;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"447,450"}},{"content":"<pre data-lines=\"451,455\"><code class=\"language-java\"><span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">writeBytes</span> <span class=\"hljs-operator\">=</span> channel.write(buf);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"451,455"}},{"content":"<pre data-lines=\"456,457\"><code>*   &#x8c03;&#x7528; buffer &#x81ea;&#x5df1;&#x7684; get &#x65b9;&#x6cd5;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"456,457"}},{"content":"<pre data-lines=\"458,462\"><code class=\"language-java\"><span class=\"hljs-type\">byte</span> <span class=\"hljs-variable\">b</span> <span class=\"hljs-operator\">=</span> buf.get();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"458,462"}},{"content":"<pre data-lines=\"463,467\"><code>get &#x65b9;&#x6cd5;&#x4f1a;&#x8ba9; position &#x8bfb;&#x6307;&#x9488;&#x5411;&#x540e;&#x8d70;&#xff0c;&#x5982;&#x679c;&#x60f3;&#x91cd;&#x590d;&#x8bfb;&#x53d6;&#x6570;&#x636e;\n\n*   &#x53ef;&#x4ee5;&#x8c03;&#x7528; rewind &#x65b9;&#x6cd5;&#x5c06; position &#x91cd;&#x65b0;&#x7f6e;&#x4e3a; 0\n*   &#x6216;&#x8005;&#x8c03;&#x7528; get(int i) &#x65b9;&#x6cd5;&#x83b7;&#x53d6;&#x7d22;&#x5f15; i &#x7684;&#x5185;&#x5bb9;&#xff0c;&#x5b83;&#x4e0d;&#x4f1a;&#x79fb;&#x52a8;&#x8bfb;&#x6307;&#x9488;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"463,467"}}],"payload":{"tag":"h4","lines":"445,446"}},{"content":"1.4.4.4&#x3001;mark &#x548c; reset&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"470,471\"><code>mark &#x662f;&#x5728;&#x8bfb;&#x53d6;&#x65f6;&#xff0c;&#x505a;&#x4e00;&#x4e2a;&#x6807;&#x8bb0;&#xff0c;&#x5373;&#x4f7f; position &#x6539;&#x53d8;&#xff0c;&#x53ea;&#x8981;&#x8c03;&#x7528; reset &#x5c31;&#x80fd;&#x56de;&#x5230; mark &#x7684;&#x4f4d;&#x7f6e;&#xff0c;&#x4f46;&#x662f;&#xff0c;rewind &#x548c; flip &#x90fd;&#x4f1a;&#x6e05;&#x9664; mark &#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"470,471"}}],"payload":{"tag":"h4","lines":"468,469"}},{"content":"1.4.4.5&#x3001;&#x5b57;&#x7b26;&#x4e32;&#x4e0e; ByteBuffer &#x4e92;&#x8f6c;","children":[{"content":"<pre data-lines=\"474,475\"><code>**&#x7b2c;&#x4e00;&#x79cd;&#x65b9;&#x5f0f;&#xff1a;** \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"474,475"}},{"content":"<pre data-lines=\"476,483\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> StandardCharsets.UTF_8.encode(<span class=\"hljs-string\">&quot;abc123&quot;</span>);\ndebugAll(buffer);\n<span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">string</span> <span class=\"hljs-operator\">=</span> StandardCharsets.UTF_8.decode(buffer).toString();\nSystem.out.println(string);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"476,483"}},{"content":"<pre data-lines=\"484,495\"><code class=\"language-java\">+--------+-------------------- all ------------------------+----------------+\nposition: [0], limit: [6]\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 61 62 63 31 32 33                               |abc123          |\n+--------+-------------------------------------------------+----------------+\nabc123\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"484,495"}},{"content":"<pre data-lines=\"496,497\"><code>**&#x7b2c;&#x4e8c;&#x79cd;&#x65b9;&#x5f0f;&#xff1a;** \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"496,497"}},{"content":"<pre data-lines=\"498,505\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> Charset.forName(<span class=\"hljs-string\">&quot;utf-8&quot;</span>).encode(<span class=\"hljs-string\">&quot;abc123&quot;</span>);\ndebugAll(buffer);\n<span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">string</span> <span class=\"hljs-operator\">=</span> Charset.forName(<span class=\"hljs-string\">&quot;utf-8&quot;</span>).decode(buffer).toString();\nSystem.out.println(string);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"498,505"}},{"content":"<pre data-lines=\"506,517\"><code class=\"language-java\">+--------+-------------------- all ------------------------+----------------+\nposition: [0], limit: [6]\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 61 62 63 31 32 33                               |abc123          |\n+--------+-------------------------------------------------+----------------+\nabc123\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"506,517"}}],"payload":{"tag":"h4","lines":"472,473"}}],"payload":{"tag":"h3","lines":"413,414"}},{"content":"1.4.5&#x3001;Scattering Reads","children":[{"content":"<pre data-lines=\"520,523\"><code>&#x5728;&#x9879;&#x76ee; `netty-demo` &#x53f3;&#x952e;&#xff0c;&#x65b0;&#x5efa;&#x4e00;&#x4e2a; `words.txt`&#xff0c;&#x5185;&#x5bb9;&#x4e3a; `onetwothree`\n\n&#x4f7f;&#x7528;&#x5982;&#x4e0b;&#x65b9;&#x5f0f;&#x8bfb;&#x53d6;&#xff0c;&#x53ef;&#x4ee5;&#x5c06;&#x6570;&#x636e;&#x586b;&#x5145;&#x81f3;&#x591a;&#x4e2a; buffer\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"520,523"}},{"content":"<pre data-lines=\"524,541\"><code class=\"language-java\"><span class=\"hljs-keyword\">try</span> (<span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RandomAccessFile</span>(<span class=\"hljs-string\">&quot;words.txt&quot;</span>, <span class=\"hljs-string\">&quot;r&quot;</span>).getChannel()) {\n    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">b1</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">3</span>);\n    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">b2</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">3</span>);\n    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">b3</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">5</span>);\n    channel.read(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ByteBuffer</span>[]{b1, b2, b3});\n    b1.flip();\n    b2.flip();\n    b3.flip();\n    debugAll(b1);\n    debugAll(b2);\n    debugAll(b3);\n} <span class=\"hljs-keyword\">catch</span> (IOException e) {\n    e.printStackTrace();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"524,541"}},{"content":"<pre data-lines=\"542,566\"><code class=\"language-java\">+--------+-------------------- all ------------------------+----------------+\nposition: [0], limit: [3]\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 6f 6e 65                                        |one             |\n+--------+-------------------------------------------------+----------------+\n+--------+-------------------- all ------------------------+----------------+\nposition: [0], limit: [3]\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 74 77 6f                                        |two             |\n+--------+-------------------------------------------------+----------------+\n+--------+-------------------- all ------------------------+----------------+\nposition: [0], limit: [5]\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 74 68 72 65 65                                  |three           |\n+--------+-------------------------------------------------+----------------+\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"542,566"}}],"payload":{"tag":"h3","lines":"518,519"}},{"content":"1.4.6&#x3001;Gathering Writes","children":[{"content":"<pre data-lines=\"569,570\"><code>&#x4f7f;&#x7528;&#x5982;&#x4e0b;&#x65b9;&#x5f0f;&#x5199;&#x5165;&#xff0c;&#x53ef;&#x4ee5;&#x5c06;&#x591a;&#x4e2a; buffer &#x7684;&#x6570;&#x636e;&#x586b;&#x5145;&#x81f3; channel\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"569,570"}},{"content":"<pre data-lines=\"571,582\"><code class=\"language-java\"><span class=\"hljs-keyword\">try</span> (<span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RandomAccessFile</span>(<span class=\"hljs-string\">&quot;words.txt&quot;</span>, <span class=\"hljs-string\">&quot;rw&quot;</span>).getChannel()) {\n    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">b1</span> <span class=\"hljs-operator\">=</span> StandardCharsets.UTF_8.encode(<span class=\"hljs-string\">&quot;hello&quot;</span>);\n    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">b2</span> <span class=\"hljs-operator\">=</span> StandardCharsets.UTF_8.encode(<span class=\"hljs-string\">&quot;world&quot;</span>);\n    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">b3</span> <span class=\"hljs-operator\">=</span> StandardCharsets.UTF_8.encode(<span class=\"hljs-string\">&quot;&#x4f60;&#x597d;&quot;</span>);\n    channel.write(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ByteBuffer</span>[]{b1, b2, b3});\n} <span class=\"hljs-keyword\">catch</span> (IOException e) {\n    e.printStackTrace();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"571,582"}},{"content":"<pre data-lines=\"583,588\"><code class=\"language-java\">words.txt&#x5185;&#x5bb9;&#x5982;&#x4e0b;&#xff1a;\nhelloworld&#x4f60;&#x597d;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"583,588"}}],"payload":{"tag":"h3","lines":"567,568"}},{"content":"1.4.7&#x3001;ByteBuffer &#x5b9e;&#x6218;&#x6f14;&#x7ec3;","children":[{"content":"<pre data-lines=\"591,605\"><code>&#x7f51;&#x7edc;&#x4e0a;&#x6709;&#x591a;&#x6761;&#x6570;&#x636e;&#x53d1;&#x9001;&#x7ed9;&#x670d;&#x52a1;&#x7aef;&#xff0c;&#x6570;&#x636e;&#x4e4b;&#x95f4;&#x4f7f;&#x7528; \\\\n &#x8fdb;&#x884c;&#x5206;&#x9694;&#x3002;\n\n&#x4f46;&#x7531;&#x4e8e;&#x67d0;&#x79cd;&#x539f;&#x56e0;&#x8fd9;&#x4e9b;&#x6570;&#x636e;&#x5728;&#x63a5;&#x6536;&#x65f6;&#xff0c;&#x88ab;&#x8fdb;&#x884c;&#x4e86;&#x91cd;&#x65b0;&#x7ec4;&#x5408;&#xff0c;&#x4f8b;&#x5982;&#x539f;&#x59cb;&#x6570;&#x636e;&#x6709;3&#x6761;&#x4e3a;&#xff1a;\n\n*   `Hello,world\\n`\n*   `I&apos;m zhangsan\\n`\n*   `How are you?\\n`\n\n&#x53d8;&#x6210;&#x4e86;&#x4e0b;&#x9762;&#x7684;&#x4e24;&#x4e2a; byteBuffer (&#x9ecf;&#x5305;&#xff0c;&#x534a;&#x5305;)\n\n*   `Hello,world\\nI&apos;m zhangsan\\nHo`\n*   `w are you?\\n`\n\n&#x73b0;&#x5728;&#x8981;&#x6c42;&#x4f60;&#x7f16;&#x5199;&#x7a0b;&#x5e8f;&#xff0c;&#x5c06;&#x9519;&#x4e71;&#x7684;&#x6570;&#x636e;&#x6062;&#x590d;&#x6210;&#x539f;&#x59cb;&#x7684;&#x6309; \\\\n &#x5206;&#x9694;&#x7684;&#x6570;&#x636e;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"591,605"}},{"content":"<pre data-lines=\"606,634\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestByteBufferExam</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">source</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">32</span>);\n        source.put(<span class=\"hljs-string\">&quot;Hello,world\\nI&apos;m zhangsan\\nHo&quot;</span>.getBytes());\n        split(source);\n        source.put(<span class=\"hljs-string\">&quot;w are you?\\n&quot;</span>.getBytes());\n        split(source);\n    }\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">split</span><span class=\"hljs-params\">(ByteBuffer source)</span> {\n        source.flip();\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; source.limit(); i++) {\n            <span class=\"hljs-keyword\">if</span> (source.get(i) == <span class=\"hljs-string\">&apos;\\n&apos;</span>) {\n                <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">length</span> <span class=\"hljs-operator\">=</span> i + <span class=\"hljs-number\">1</span> - source.position();\n                <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">target</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(length);\n                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; j &lt; length; j++) {\n                    target.put(source.get());\n                }\n                debugAll(target);\n            }\n        }\n        source.compact();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"606,634"}},{"content":"<pre data-lines=\"635,659\"><code class=\"language-java\">+--------+-------------------- all ------------------------+----------------+\nposition: [12], limit: [12]\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 48 65 6c 6c 6f 2c 77 6f 72 6c 64 0a             |Hello,world.    |\n+--------+-------------------------------------------------+----------------+\n+--------+-------------------- all ------------------------+----------------+\nposition: [13], limit: [13]\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 49 27 6d 20 7a 68 61 6e 67 73 61 6e 0a          |I&apos;m zhangsan.   |\n+--------+-------------------------------------------------+----------------+\n+--------+-------------------- all ------------------------+----------------+\nposition: [13], limit: [13]\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 48 6f 77 20 61 72 65 20 79 6f 75 3f 0a          |How are you?.   |\n+--------+-------------------------------------------------+----------------+\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"635,659"}}],"payload":{"tag":"h3","lines":"589,590"}}],"payload":{"tag":"h2","lines":"145,147"}},{"content":"1.5&#x3001;&#x6587;&#x4ef6;&#x7f16;&#x7a0b;","children":[{"content":"1.5.1&#x3001;FileChannel","children":[{"content":"1.5.1.1&#x3001;FileChannel &#x5de5;&#x4f5c;&#x6a21;&#x5f0f;","children":[{"content":"<pre data-lines=\"667,668\"><code>FileChannel &#x53ea;&#x80fd;&#x5de5;&#x4f5c;&#x5728;&#x963b;&#x585e;&#x6a21;&#x5f0f;&#x4e0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"667,668"}}],"payload":{"tag":"h4","lines":"665,666"}},{"content":"1.5.1.2&#x3001;FileChannel &#x83b7;&#x53d6;&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"671,676\"><code>&#x4e0d;&#x80fd;&#x76f4;&#x63a5;&#x6253;&#x5f00; FileChannel&#xff0c;&#x5fc5;&#x987b;&#x901a;&#x8fc7; FileInputStream&#x3001;FileOutputStream &#x6216;&#x8005; RandomAccessFile &#x6765;&#x83b7;&#x53d6; FileChannel&#xff0c;&#x5b83;&#x4eec;&#x90fd;&#x6709; getChannel &#x65b9;&#x6cd5;&#x3002;\n\n*   &#x901a;&#x8fc7; FileInputStream &#x83b7;&#x53d6;&#x7684; channel &#x53ea;&#x80fd;&#x8bfb;\n*   &#x901a;&#x8fc7; FileOutputStream &#x83b7;&#x53d6;&#x7684; channel &#x53ea;&#x80fd;&#x5199;\n*   &#x901a;&#x8fc7; RandomAccessFile &#x662f;&#x5426;&#x80fd;&#x8bfb;&#x5199;&#x6839;&#x636e;&#x6784;&#x9020; RandomAccessFile &#x65f6;&#x7684;&#x8bfb;&#x5199;&#x6a21;&#x5f0f;&#x51b3;&#x5b9a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"671,676"}}],"payload":{"tag":"h4","lines":"669,670"}},{"content":"1.5.1.3&#x3001;FileChannel &#x8bfb;&#x53d6;&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"679,680\"><code>&#x4f1a;&#x4ece; channel &#x8bfb;&#x53d6;&#x6570;&#x636e;&#x586b;&#x5145; ByteBuffer&#xff0c;&#x8fd4;&#x56de;&#x503c;&#x8868;&#x793a;&#x8bfb;&#x5230;&#x4e86;&#x591a;&#x5c11;&#x5b57;&#x8282;&#xff0c;-1 &#x8868;&#x793a;&#x5230;&#x8fbe;&#x4e86;&#x6587;&#x4ef6;&#x7684;&#x672b;&#x5c3e;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"679,680"}},{"content":"<pre data-lines=\"681,685\"><code class=\"language-java\"><span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">readBytes</span> <span class=\"hljs-operator\">=</span> channel.read(buffer);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"681,685"}}],"payload":{"tag":"h4","lines":"677,678"}},{"content":"1.5.1.4&#x3001;FileChannel &#x5199;&#x5165;&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"688,689\"><code>&#x5199;&#x5165;&#x7684;&#x6b63;&#x786e;&#x59ff;&#x52bf;&#x5982;&#x4e0b;&#xff0c;&#x5728; while &#x4e2d;&#x8c03;&#x7528; channel.write &#x662f;&#x56e0;&#x4e3a; write &#x65b9;&#x6cd5;&#x5e76;&#x4e0d;&#x80fd;&#x4fdd;&#x8bc1;&#x4e00;&#x6b21;&#x5c06; buffer &#x4e2d;&#x7684;&#x5185;&#x5bb9;&#x5168;&#x90e8;&#x5199;&#x5165; channel&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"688,689"}},{"content":"<pre data-lines=\"690,700\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ...;\nbuffer.put(...); \nbuffer.flip();   \n\n<span class=\"hljs-keyword\">while</span>(buffer.hasRemaining()) {\n    channel.write(buffer);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"690,700"}}],"payload":{"tag":"h4","lines":"686,687"}},{"content":"1.5.1.5&#x3001;FileChannel &#x5173;&#x95ed;&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"703,704\"><code>channel &#x5fc5;&#x987b;&#x5173;&#x95ed;&#xff0c;&#x4e0d;&#x8fc7;&#x8c03;&#x7528;&#x4e86; FileInputStream&#x3001;FileOutputStream &#x6216;&#x8005; RandomAccessFile &#x7684; close &#x65b9;&#x6cd5;&#x4f1a;&#x95f4;&#x63a5;&#x5730;&#x8c03;&#x7528; channel &#x7684; close &#x65b9;&#x6cd5;&#x3002;&#x6216;&#x8005;&#x4f7f;&#x7528; try &#x4ee3;&#x7801;&#x5757;&#x81ea;&#x52a8;&#x91ca;&#x653e;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"703,704"}},{"content":"<pre data-lines=\"705,713\"><code class=\"language-java\"><span class=\"hljs-keyword\">try</span> (<span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FileInputStream</span>(<span class=\"hljs-string\">&quot;data.txt&quot;</span>).getChannel()) {\n\n} <span class=\"hljs-keyword\">catch</span> (IOException e) {\n    e.printStackTrace();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"705,713"}}],"payload":{"tag":"h4","lines":"701,702"}},{"content":"1.5.1.6&#x3001;FileChannel &#x4f4d;&#x7f6e;&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"716,717\"><code>&#x83b7;&#x53d6;&#x5f53;&#x524d;&#x4f4d;&#x7f6e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"716,717"}},{"content":"<pre data-lines=\"718,722\"><code class=\"language-java\"><span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">pos</span> <span class=\"hljs-operator\">=</span> channel.position();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"718,722"}},{"content":"<pre data-lines=\"723,724\"><code>&#x8bbe;&#x7f6e;&#x5f53;&#x524d;&#x4f4d;&#x7f6e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"723,724"}},{"content":"<pre data-lines=\"725,730\"><code class=\"language-java\"><span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">newPos</span> <span class=\"hljs-operator\">=</span> ...;\nchannel.position(newPos);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"725,730"}},{"content":"<pre data-lines=\"731,735\"><code>&#x8bbe;&#x7f6e;&#x5f53;&#x524d;&#x4f4d;&#x7f6e;&#x65f6;&#xff0c;&#x5982;&#x679c;&#x8bbe;&#x7f6e;&#x4e3a;&#x6587;&#x4ef6;&#x7684;&#x672b;&#x5c3e;\n\n*   &#x8fd9;&#x65f6;&#x8bfb;&#x53d6;&#x4f1a;&#x8fd4;&#x56de; -1\n*   &#x8fd9;&#x65f6;&#x5199;&#x5165;&#xff0c;&#x4f1a;&#x8ffd;&#x52a0;&#x5185;&#x5bb9;&#xff0c;&#x4f46;&#x8981;&#x6ce8;&#x610f;&#x5982;&#x679c; position &#x8d85;&#x8fc7;&#x4e86;&#x6587;&#x4ef6;&#x672b;&#x5c3e;&#xff0c;&#x518d;&#x5199;&#x5165;&#x65f6;&#x5728;&#x65b0;&#x5185;&#x5bb9;&#x548c;&#x539f;&#x672b;&#x5c3e;&#x4e4b;&#x95f4;&#x4f1a;&#x6709;&#x7a7a;&#x6d1e;&#xff08;00&#xff09;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"731,735"}}],"payload":{"tag":"h4","lines":"714,715"}},{"content":"1.5.1.6&#x3001;FileChannel &#x5927;&#x5c0f;&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"738,739\"><code>&#x4f7f;&#x7528; size &#x65b9;&#x6cd5;&#x83b7;&#x53d6;&#x6587;&#x4ef6;&#x7684;&#x5927;&#x5c0f;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"738,739"}}],"payload":{"tag":"h4","lines":"736,737"}},{"content":"1.5.1.7&#x3001;FileChannel &#x5f3a;&#x5236;&#x5199;&#x5165;","children":[{"content":"<pre data-lines=\"742,743\"><code>&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x51fa;&#x4e8e;&#x6027;&#x80fd;&#x7684;&#x8003;&#x8651;&#xff0c;&#x4f1a;&#x5c06;&#x6570;&#x636e;&#x7f13;&#x5b58;&#xff0c;&#x4e0d;&#x662f;&#x7acb;&#x523b;&#x5199;&#x5165;&#x78c1;&#x76d8;&#x3002;&#x53ef;&#x4ee5;&#x8c03;&#x7528; force(true) &#x65b9;&#x6cd5;&#x5c06;&#x6587;&#x4ef6;&#x5185;&#x5bb9;&#x548c;&#x5143;&#x6570;&#x636e;&#xff08;&#x6587;&#x4ef6;&#x7684;&#x6743;&#x9650;&#x7b49;&#x4fe1;&#x606f;&#xff09;&#x7acb;&#x523b;&#x5199;&#x5165;&#x78c1;&#x76d8;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"742,743"}}],"payload":{"tag":"h4","lines":"740,741"}},{"content":"1.5.1.8&#x3001;FileChannel &#x6587;&#x4ef6;&#x62f7;&#x8d1d;","children":[{"content":"<pre data-lines=\"746,761\"><code class=\"language-java\"><span class=\"hljs-keyword\">try</span> (\n    <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">from</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FileInputStream</span>(<span class=\"hljs-string\">&quot;data.txt&quot;</span>).getChannel();\n    <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">to</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FileOutputStream</span>(<span class=\"hljs-string\">&quot;to.txt&quot;</span>).getChannel();\n) {\n    <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">size</span> <span class=\"hljs-operator\">=</span> from.size();\n    \n    <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">remain</span> <span class=\"hljs-operator\">=</span> size; remain &gt; <span class=\"hljs-number\">0</span>; ) {\n        remain -= from.transferTo((size - remain), remain, to);\n    }\n} <span class=\"hljs-keyword\">catch</span> (IOException e) {\n    e.printStackTrace();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"746,761"}}],"payload":{"tag":"h4","lines":"744,745"}}],"payload":{"tag":"h3","lines":"663,664"}},{"content":"1.5.2&#x3001;Path","children":[{"content":"<pre data-lines=\"764,768\"><code>jdk7 &#x5f15;&#x5165;&#x4e86; Path &#x548c; Paths &#x7c7b;\n\n*   Path &#x7528;&#x6765;&#x8868;&#x793a;&#x6587;&#x4ef6;&#x8def;&#x5f84;\n*   Paths &#x662f;&#x5de5;&#x5177;&#x7c7b;&#xff0c;&#x7528;&#x6765;&#x83b7;&#x53d6; Path &#x5b9e;&#x4f8b;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"764,768"}},{"content":"<pre data-lines=\"769,779\"><code class=\"language-java\"><span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">source</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;1.txt&quot;</span>); \t\t\t\t\t\n\n<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">source</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\1.txt&quot;</span>); \t\t\t\t\n\n<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">source</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:/1.txt&quot;</span>); \t\t\t\t\n\n<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">projects</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\data&quot;</span>, <span class=\"hljs-string\">&quot;projects&quot;</span>); \t\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"769,779"}},{"content":"<pre data-lines=\"780,784\"><code>*   `.` &#x4ee3;&#x8868;&#x4e86;&#x5f53;&#x524d;&#x8def;&#x5f84;\n*   `..` &#x4ee3;&#x8868;&#x4e86;&#x4e0a;&#x4e00;&#x7ea7;&#x8def;&#x5f84;\n\n&#x4f8b;&#x5982;&#xff0c;&#x76ee;&#x5f55;&#x7ed3;&#x6784;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"780,784"}},{"content":"<pre data-lines=\"785,793\"><code data-lines=\"785,793\">d<span class=\"hljs-punctuation\">:</span>\n\t<span class=\"hljs-string\">|- data</span>\n\t\t<span class=\"hljs-string\">|- projects</span>\n\t\t\t<span class=\"hljs-string\">|- a</span>\n\t\t\t<span class=\"hljs-string\">|- b</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"785,793"}},{"content":"<pre data-lines=\"794,795\"><code>&#x4ee3;&#x7801;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"794,795"}},{"content":"<pre data-lines=\"796,802\"><code class=\"language-java\"><span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\data\\\\projects\\\\a\\\\..\\\\b&quot;</span>);\nSystem.out.println(path);\t\t\t\t\nSystem.out.println(path.normalize()); \t\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"796,802"}},{"content":"<pre data-lines=\"803,804\"><code>&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"803,804"}},{"content":"<pre data-lines=\"805,810\"><code data-lines=\"805,810\">d:\\<span class=\"hljs-meta\">data</span>\\projects\\a\\..\\<span class=\"hljs-keyword\">b</span>\nd:\\<span class=\"hljs-meta\">data</span>\\projects\\<span class=\"hljs-keyword\">b</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"805,810"}}],"payload":{"tag":"h3","lines":"762,763"}},{"content":"1.5.3&#x3001;Files","children":[{"content":"1.5.3.1&#x3001;Files &#x68c0;&#x67e5;&#x662f;&#x5426;&#x5b58;&#x5728;","children":[{"content":"<pre data-lines=\"815,820\"><code class=\"language-java\"><span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;data.txt&quot;</span>);\nSystem.out.println(Files.exists(path));\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"815,820"}}],"payload":{"tag":"h4","lines":"813,814"}},{"content":"1.5.3.2&#x3001;Files &#x521b;&#x5efa;&#x4e00;&#x7ea7;&#x76ee;&#x5f55;","children":[{"content":"<pre data-lines=\"823,828\"><code class=\"language-java\"><span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;helloword&quot;</span>);\nFiles.createDirectory(path);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"823,828"}},{"content":"<pre data-lines=\"829,831\"><code>*   &#x5982;&#x679c;&#x76ee;&#x5f55;&#x5df2;&#x5b58;&#x5728;&#xff0c;&#x4f1a;&#x629b;&#x5f02;&#x5e38; FileAlreadyExistsException\n*   &#x4e0d;&#x80fd;&#x4e00;&#x6b21;&#x521b;&#x5efa;&#x591a;&#x7ea7;&#x76ee;&#x5f55;&#xff0c;&#x5426;&#x5219;&#x4f1a;&#x629b;&#x5f02;&#x5e38; NoSuchFileException\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"829,831"}}],"payload":{"tag":"h4","lines":"821,822"}},{"content":"1.5.3.3&#x3001;Files &#x521b;&#x5efa;&#x591a;&#x7ea7;&#x76ee;&#x5f55;","children":[{"content":"<pre data-lines=\"834,839\"><code class=\"language-java\"><span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;helloword/hello/world&quot;</span>);\nFiles.createDirectories(path);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"834,839"}}],"payload":{"tag":"h4","lines":"832,833"}},{"content":"1.5.3.4&#x3001;Files &#x62f7;&#x8d1d;&#x6587;&#x4ef6;&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"842,848\"><code class=\"language-java\"><span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">source</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;helloword/source.txt&quot;</span>);\n<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">target</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;helloword/target.txt&quot;</span>);\nFiles.copy(source, target);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"842,848"}},{"content":"<pre data-lines=\"849,852\"><code>*   &#x5982;&#x679c;&#x6587;&#x4ef6;&#x5df2;&#x5b58;&#x5728;&#xff0c;&#x4f1a;&#x629b;&#x5f02;&#x5e38; FileAlreadyExistsException\n\n&#x5982;&#x679c;&#x5e0c;&#x671b;&#x7528; source &#x8986;&#x76d6;&#x6389; target&#xff0c;&#x9700;&#x8981;&#x7528; StandardCopyOption &#x6765;&#x63a7;&#x5236;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"849,852"}},{"content":"<pre data-lines=\"853,857\"><code class=\"language-java\">Files.copy(source, target, StandardCopyOption.REPLACE_EXISTING);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"853,857"}}],"payload":{"tag":"h4","lines":"840,841"}},{"content":"1.5.3.5&#x3001;Files &#x79fb;&#x52a8;&#x6587;&#x4ef6;&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"860,866\"><code class=\"language-java\"><span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">source</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;helloword/source.txt&quot;</span>);\n<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">target</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;helloword/target.txt&quot;</span>);\nFiles.move(source, target, StandardCopyOption.ATOMIC_MOVE);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"860,866"}},{"content":"<pre data-lines=\"867,868\"><code>*   StandardCopyOption.ATOMIC\\_MOVE &#x4fdd;&#x8bc1;&#x6587;&#x4ef6;&#x79fb;&#x52a8;&#x7684;&#x539f;&#x5b50;&#x6027;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"867,868"}}],"payload":{"tag":"h4","lines":"858,859"}},{"content":"1.5.3.6&#x3001;Files &#x5220;&#x9664;&#x6587;&#x4ef6;&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"871,876\"><code class=\"language-java\"><span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">target</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;helloword/target.txt&quot;</span>);\nFiles.delete(target);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"871,876"}},{"content":"<pre data-lines=\"877,878\"><code>*   &#x5982;&#x679c;&#x6587;&#x4ef6;&#x4e0d;&#x5b58;&#x5728;&#xff0c;&#x4f1a;&#x629b;&#x5f02;&#x5e38; NoSuchFileException\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"877,878"}}],"payload":{"tag":"h4","lines":"869,870"}},{"content":"1.5.3.7&#x3001;Files &#x5220;&#x9664;&#x4e3a;&#x7a7a;&#x76ee;&#x5f55;","children":[{"content":"<pre data-lines=\"881,886\"><code class=\"language-java\"><span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">target</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;helloword/hello/world&quot;</span>);\nFiles.delete(target);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"881,886"}},{"content":"<pre data-lines=\"887,888\"><code>*   &#x5982;&#x679c;&#x76ee;&#x5f55;&#x8fd8;&#x6709;&#x5185;&#x5bb9;&#xff0c;&#x4f1a;&#x629b;&#x5f02;&#x5e38; DirectoryNotEmptyException\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"887,888"}}],"payload":{"tag":"h4","lines":"879,880"}},{"content":"1.5.3.8&#x3001;Files &#x5220;&#x9664;&#x975e;&#x7a7a;&#x76ee;&#x5f55;","children":[{"content":"<pre data-lines=\"891,907\"><code class=\"language-java\">Files.walkFileTree(Paths.get(<span class=\"hljs-string\">&quot;d:\\\\a&quot;</span>), <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SimpleFileVisitor</span>&lt;Path&gt;() {\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> FileVisitResult <span class=\"hljs-title function_\">visitFile</span><span class=\"hljs-params\">(Path file, BasicFileAttributes attrs)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        Files.delete(file);\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">super</span>.visitFile(file, attrs);\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> FileVisitResult <span class=\"hljs-title function_\">postVisitDirectory</span><span class=\"hljs-params\">(Path dir, IOException exc)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        Files.delete(dir);\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">super</span>.postVisitDirectory(dir, exc);\n    }\n});\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"891,907"}}],"payload":{"tag":"h4","lines":"889,890"}},{"content":"1.5.3.9&#x3001;Files &#x904d;&#x5386;&#x6307;&#x5b9a;&#x76ee;&#x5f55;","children":[{"content":"<pre data-lines=\"910,926\"><code class=\"language-java\">Files.walkFileTree(Paths.get(<span class=\"hljs-string\">&quot;d:\\\\a&quot;</span>), <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SimpleFileVisitor</span>&lt;Path&gt;() {\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> FileVisitResult <span class=\"hljs-title function_\">preVisitDirectory</span><span class=\"hljs-params\">(Path dir, BasicFileAttributes attrs)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        System.out.println(dir);\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">super</span>.preVisitDirectory(dir, attrs);\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> FileVisitResult <span class=\"hljs-title function_\">visitFile</span><span class=\"hljs-params\">(Path file, BasicFileAttributes attrs)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        System.out.println(<span class=\"hljs-string\">&quot;\\t&quot;</span> + file);\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">super</span>.visitFile(file, attrs);\n    }\n});\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"910,926"}}],"payload":{"tag":"h4","lines":"908,909"}},{"content":"1.5.3.10&#x3001;Files &#x62f7;&#x8d1d;&#x591a;&#x7ea7;&#x76ee;&#x5f55;","children":[{"content":"<pre data-lines=\"929,949\"><code class=\"language-java\"><span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">source</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;d:\\\\a&quot;</span>;\n<span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">target</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;d:\\\\b&quot;</span>;\nFiles.walk(Paths.get(source)).forEach(path -&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">targetName</span> <span class=\"hljs-operator\">=</span> path.toString().replace(source, target);\n        \n        <span class=\"hljs-keyword\">if</span> (Files.isDirectory(path)) {\n            Files.createDirectory(Paths.get(targetName));\n        }\n        \n        <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (Files.isRegularFile(path)) {\n            Files.copy(path, Paths.get(targetName));\n        }\n    } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n        e.printStackTrace();\n    }\n});\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"929,949"}}],"payload":{"tag":"h4","lines":"927,928"}}],"payload":{"tag":"h3","lines":"811,812"}}],"payload":{"tag":"h2","lines":"660,662"}},{"content":"1.6&#x3001;&#x7f51;&#x7edc;&#x7f16;&#x7a0b;","children":[{"content":"1.6.1&#x3001;&#x963b;&#x585e; vs &#x975e;&#x963b;&#x585e;","children":[{"content":"<pre data-lines=\"955,968\"><code>&#x963b;&#x585e;\n\n&#x963b;&#x585e;&#x6a21;&#x5f0f;&#x4e0b;&#xff0c;&#x76f8;&#x5173;&#x65b9;&#x6cd5;&#x90fd;&#x4f1a;&#x5bfc;&#x81f4;&#x7ebf;&#x7a0b;&#x6682;&#x505c;&#x3002;&#x6682;&#x505c;&#x671f;&#x95f4;&#x4e0d;&#x4f1a;&#x5360;&#x7528; cpu&#xff0c;&#x4f46;&#x7ebf;&#x7a0b;&#x76f8;&#x5f53;&#x4e8e;&#x95f2;&#x7f6e;&#x3002;&#x5355;&#x7ebf;&#x7a0b;&#x4e0b;&#xff0c;&#x963b;&#x585e;&#x65b9;&#x6cd5;&#x4e4b;&#x95f4;&#x76f8;&#x4e92;&#x5f71;&#x54cd;&#xff0c;&#x51e0;&#x4e4e;&#x4e0d;&#x80fd;&#x6b63;&#x5e38;&#x5de5;&#x4f5c;&#xff0c;&#x9700;&#x8981;&#x591a;&#x7ebf;&#x7a0b;&#x652f;&#x6301;&#xff0c;&#x4f46;&#x591a;&#x7ebf;&#x7a0b;&#x4e0b;&#xff0c;&#x6709;&#x65b0;&#x7684;&#x95ee;&#x9898;&#xff0c;&#x4f53;&#x73b0;&#x5728;&#x4ee5;&#x4e0b;&#x65b9;&#x9762;&#x3002;32 &#x4f4d; jvm &#x4e00;&#x4e2a;&#x7ebf;&#x7a0b; 320k&#xff0c;64 &#x4f4d; jvm &#x4e00;&#x4e2a;&#x7ebf;&#x7a0b; 1024k&#xff0c;&#x5982;&#x679c;&#x8fde;&#x63a5;&#x6570;&#x8fc7;&#x591a;&#xff0c;&#x5fc5;&#x7136;&#x5bfc;&#x81f4; OOM&#xff0c;&#x5e76;&#x4e14;&#x7ebf;&#x7a0b;&#x592a;&#x591a;&#xff0c;&#x53cd;&#x800c;&#x4f1a;&#x56e0;&#x4e3a;&#x9891;&#x7e41;&#x4e0a;&#x4e0b;&#x6587;&#x5207;&#x6362;&#x5bfc;&#x81f4;&#x6027;&#x80fd;&#x964d;&#x4f4e;&#x3002;&#x53ef;&#x4ee5;&#x91c7;&#x7528;&#x7ebf;&#x7a0b;&#x6c60;&#x6280;&#x672f;&#x6765;&#x51cf;&#x5c11;&#x7ebf;&#x7a0b;&#x6570;&#x548c;&#x7ebf;&#x7a0b;&#x4e0a;&#x4e0b;&#x6587;&#x5207;&#x6362;&#xff0c;&#x4f46;&#x6cbb;&#x6807;&#x4e0d;&#x6cbb;&#x672c;&#xff0c;&#x5982;&#x679c;&#x6709;&#x5f88;&#x591a;&#x8fde;&#x63a5;&#x5efa;&#x7acb;&#xff0c;&#x4f46;&#x957f;&#x65f6;&#x95f4; inactive&#xff0c;&#x4f1a;&#x963b;&#x585e;&#x7ebf;&#x7a0b;&#x6c60;&#x4e2d;&#x6240;&#x6709;&#x7ebf;&#x7a0b;&#xff0c;&#x56e0;&#x6b64;&#x4e0d;&#x9002;&#x5408;&#x957f;&#x8fde;&#x63a5;&#xff0c;&#x53ea;&#x9002;&#x5408;&#x77ed;&#x8fde;&#x63a5;&#x3002;\n\n*   ServerSocketChannel.accept &#x4f1a;&#x5728;&#x6ca1;&#x6709;&#x8fde;&#x63a5;&#x5efa;&#x7acb;&#x65f6;&#x8ba9;&#x7ebf;&#x7a0b;&#x6682;&#x505c;&#x3002;\n*   SocketChannel.read &#x4f1a;&#x5728;&#x6ca1;&#x6709;&#x6570;&#x636e;&#x53ef;&#x8bfb;&#x65f6;&#x8ba9;&#x7ebf;&#x7a0b;&#x6682;&#x505c;&#x3002;\n\n&#x975e;&#x963b;&#x585e;\n\n&#x975e;&#x963b;&#x585e;&#x6a21;&#x5f0f;&#x4e0b;&#xff0c;&#x76f8;&#x5173;&#x65b9;&#x6cd5;&#x90fd;&#x4f1a;&#x4e0d;&#x4f1a;&#x8ba9;&#x7ebf;&#x7a0b;&#x6682;&#x505c;&#x3002;&#x4f46;&#x975e;&#x963b;&#x585e;&#x6a21;&#x5f0f;&#x4e0b;&#xff0c;&#x5373;&#x4f7f;&#x6ca1;&#x6709;&#x8fde;&#x63a5;&#x5efa;&#x7acb;&#xff0c;&#x548c;&#x53ef;&#x8bfb;&#x6570;&#x636e;&#xff0c;&#x7ebf;&#x7a0b;&#x4ecd;&#x7136;&#x5728;&#x4e0d;&#x65ad;&#x8fd0;&#x884c;&#xff0c;&#x767d;&#x767d;&#x6d6a;&#x8d39;&#x4e86; cpu&#x3002;&#x5199;&#x6570;&#x636e;&#x65f6;&#xff0c;&#x7ebf;&#x7a0b;&#x53ea;&#x662f;&#x7b49;&#x5f85;&#x6570;&#x636e;&#x5199;&#x5165; Channel &#x5373;&#x53ef;&#xff0c;&#x65e0;&#x9700;&#x7b49; Channel &#x901a;&#x8fc7;&#x7f51;&#x7edc;&#x628a;&#x6570;&#x636e;&#x53d1;&#x9001;&#x51fa;&#x53bb;&#x3002;\n\n*   ServerSocketChannel.accept &#x5728;&#x6ca1;&#x6709;&#x8fde;&#x63a5;&#x5efa;&#x7acb;&#x65f6;&#xff0c;&#x4f1a;&#x8fd4;&#x56de; null&#xff0c;&#x7ee7;&#x7eed;&#x8fd0;&#x884c;&#x3002;\n*   SocketChannel.read &#x5728;&#x6ca1;&#x6709;&#x6570;&#x636e;&#x53ef;&#x8bfb;&#x65f6;&#xff0c;&#x4f1a;&#x8fd4;&#x56de; 0&#xff0c;&#x4f46;&#x7ebf;&#x7a0b;&#x4e0d;&#x5fc5;&#x963b;&#x585e;&#xff0c;&#x53ef;&#x4ee5;&#x53bb;&#x6267;&#x884c;&#x5176;&#x5b83; SocketChannel &#x7684; read &#x6216;&#x662f;&#x53bb;&#x6267;&#x884c; ServerSocketChannel.accept&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"955,968"}}],"payload":{"tag":"h3","lines":"953,954"}},{"content":"1.6.2&#x3001;Selector","children":[{"content":"1.6.2.1&#x3001;Selector &#x4ecb;&#x7ecd;","children":[{"content":"<pre data-lines=\"973,978\"><code>&#x5355;&#x7ebf;&#x7a0b;&#x53ef;&#x4ee5;&#x914d;&#x5408; Selector &#x5b8c;&#x6210;&#x5bf9;&#x591a;&#x4e2a; Channel &#x53ef;&#x8bfb;&#x5199;&#x4e8b;&#x4ef6;&#x7684;&#x76d1;&#x63a7;&#xff0c;&#x8fd9;&#x79f0;&#x4e4b;&#x4e3a;&#x591a;&#x8def;&#x590d;&#x7528;&#x3002;&#x591a;&#x8def;&#x590d;&#x7528;&#x4ec5;&#x9488;&#x5bf9;&#x7f51;&#x7edc; IO&#x3001;&#x666e;&#x901a;&#x6587;&#x4ef6; IO &#x6ca1;&#x6cd5;&#x5229;&#x7528;&#x591a;&#x8def;&#x590d;&#x7528;&#x3002;&#x5982;&#x679c;&#x4e0d;&#x7528; Selector &#x7684;&#x975e;&#x963b;&#x585e;&#x6a21;&#x5f0f;&#xff0c;&#x7ebf;&#x7a0b;&#x5927;&#x90e8;&#x5206;&#x65f6;&#x95f4;&#x90fd;&#x5728;&#x505a;&#x65e0;&#x7528;&#x529f;&#xff0c;&#x800c; Selector &#x80fd;&#x591f;&#x4fdd;&#x8bc1;&#xff1a;\n\n*   &#x6709;&#x53ef;&#x8fde;&#x63a5;&#x4e8b;&#x4ef6;&#x65f6;&#x624d;&#x53bb;&#x8fde;&#x63a5;\n*   &#x6709;&#x53ef;&#x8bfb;&#x4e8b;&#x4ef6;&#x624d;&#x53bb;&#x8bfb;&#x53d6;&#xff0c;&#x9650;&#x4e8e;&#x7f51;&#x7edc;&#x4f20;&#x8f93;&#x80fd;&#x529b;&#xff0c;Channel &#x672a;&#x5fc5;&#x65f6;&#x65f6;&#x53ef;&#x8bfb;&#xff0c;&#x4e00;&#x65e6; Channel &#x53ef;&#x8bfb;&#xff0c;&#x4f1a;&#x89e6;&#x53d1; Selector &#x7684;&#x53ef;&#x8bfb;&#x4e8b;&#x4ef6;\n*   &#x6709;&#x53ef;&#x5199;&#x4e8b;&#x4ef6;&#x624d;&#x53bb;&#x5199;&#x5165;&#xff0c;&#x9650;&#x4e8e;&#x7f51;&#x7edc;&#x4f20;&#x8f93;&#x80fd;&#x529b;&#xff0c;Channel &#x672a;&#x5fc5;&#x65f6;&#x65f6;&#x53ef;&#x5199;&#xff0c;&#x4e00;&#x65e6; Channel &#x53ef;&#x5199;&#xff0c;&#x4f1a;&#x89e6;&#x53d1; Selector &#x7684;&#x53ef;&#x5199;&#x4e8b;&#x4ef6;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"973,978"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/4a1a0cfa564848147077f5b0745cdc44.png\" alt>","children":[],"payload":{"tag":"img","lines":"979,980"}},{"content":"<pre data-lines=\"981,982\"><code>&#x4f7f;&#x7528; Selector &#x7684;&#x597d;&#x5904;&#x5c31;&#x662f;&#xff0c;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x914d;&#x5408; Selector &#x5c31;&#x53ef;&#x4ee5;&#x76d1;&#x63a7;&#x591a;&#x4e2a; Channel &#x7684;&#x4e8b;&#x4ef6;&#xff0c;&#x4e8b;&#x4ef6;&#x53d1;&#x751f;&#x7ebf;&#x7a0b;&#x624d;&#x53bb;&#x5904;&#x7406;&#x3002;&#x907f;&#x514d;&#x975e;&#x963b;&#x585e;&#x6a21;&#x5f0f;&#x4e0b;&#x6240;&#x505a;&#x65e0;&#x7528;&#x529f;&#xff0c;&#x8ba9;&#x8fd9;&#x4e2a;&#x7ebf;&#x7a0b;&#x80fd;&#x591f;&#x88ab;&#x5145;&#x5206;&#x5229;&#x7528;&#xff0c;&#x8282;&#x7ea6;&#x4e86;&#x7ebf;&#x7a0b;&#x7684;&#x6570;&#x91cf;&#xff0c;&#x51cf;&#x5c11;&#x4e86;&#x7ebf;&#x7a0b;&#x4e0a;&#x4e0b;&#x6587;&#x5207;&#x6362;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"981,982"}}],"payload":{"tag":"h4","lines":"971,972"}},{"content":"1.6.2.2&#x3001;Selector &#x521b;&#x5efa;","children":[{"content":"<pre data-lines=\"985,989\"><code class=\"language-java\"><span class=\"hljs-type\">Selector</span> <span class=\"hljs-variable\">selector</span> <span class=\"hljs-operator\">=</span> Selector.open();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"985,989"}}],"payload":{"tag":"h4","lines":"983,984"}},{"content":"1.6.2.3&#x3001;&#x7ed1;&#x5b9a; Channel &#x4e8b;&#x4ef6;","children":[{"content":"<pre data-lines=\"992,993\"><code>&#x7ed1;&#x5b9a; Channel &#x4e8b;&#x4ef6;&#x4e5f;&#x79f0;&#x4e4b;&#x4e3a;&#x6ce8;&#x518c;&#x4e8b;&#x4ef6;&#xff0c;&#x7ed1;&#x5b9a;&#x7684;&#x4e8b;&#x4ef6; Selector &#x624d;&#x4f1a;&#x5173;&#x5fc3;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"992,993"}},{"content":"<pre data-lines=\"994,999\"><code class=\"language-java\">channel.configureBlocking(<span class=\"hljs-literal\">false</span>);\n<span class=\"hljs-type\">SelectionKey</span> <span class=\"hljs-variable\">key</span> <span class=\"hljs-operator\">=</span> channel.register(selector, &#x7ed1;&#x5b9a;&#x4e8b;&#x4ef6;);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"994,999"}},{"content":"<pre data-lines=\"1000,1006\"><code>*   Channel &#x5fc5;&#x987b;&#x5de5;&#x4f5c;&#x5728;&#x975e;&#x963b;&#x585e;&#x6a21;&#x5f0f;&#xff0c;FileChannel &#x6ca1;&#x6709;&#x975e;&#x963b;&#x585e;&#x6a21;&#x5f0f;&#xff0c;&#x56e0;&#x6b64;&#x4e0d;&#x80fd;&#x914d;&#x5408; Selector &#x4e00;&#x8d77;&#x4f7f;&#x7528;\n*   &#x7ed1;&#x5b9a;&#x7684;&#x4e8b;&#x4ef6;&#x7c7b;&#x578b;&#x53ef;&#x4ee5;&#x6709;&#xff1a;\n    *   connect - &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#x65f6;&#x89e6;&#x53d1;\n    *   accept - &#x670d;&#x52a1;&#x5668;&#x7aef;&#x6210;&#x529f;&#x63a5;&#x53d7;&#x8fde;&#x63a5;&#x65f6;&#x89e6;&#x53d1;\n    *   read - &#x6570;&#x636e;&#x53ef;&#x8bfb;&#x5165;&#x65f6;&#x89e6;&#x53d1;&#xff0c;&#x6709;&#x56e0;&#x4e3a;&#x63a5;&#x6536;&#x80fd;&#x529b;&#x5f31;&#xff0c;&#x6570;&#x636e;&#x6682;&#x4e0d;&#x80fd;&#x8bfb;&#x5165;&#x7684;&#x60c5;&#x51b5;\n    *   write - &#x6570;&#x636e;&#x53ef;&#x5199;&#x51fa;&#x65f6;&#x89e6;&#x53d1;&#xff0c;&#x6709;&#x56e0;&#x4e3a;&#x53d1;&#x9001;&#x80fd;&#x529b;&#x5f31;&#xff0c;&#x6570;&#x636e;&#x6682;&#x4e0d;&#x80fd;&#x5199;&#x51fa;&#x7684;&#x60c5;&#x51b5;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1000,1006"}}],"payload":{"tag":"h4","lines":"990,991"}},{"content":"1.6.2.4&#x3001;&#x76d1;&#x542c; Channel &#x4e8b;&#x4ef6;","children":[{"content":"<pre data-lines=\"1009,1012\"><code>&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x4e0b;&#x9762;&#x4e09;&#x79cd;&#x65b9;&#x6cd5;&#x6765;&#x76d1;&#x542c;&#x662f;&#x5426;&#x6709;&#x4e8b;&#x4ef6;&#x53d1;&#x751f;&#xff0c;&#x65b9;&#x6cd5;&#x7684;&#x8fd4;&#x56de;&#x503c;&#x4ee3;&#x8868;&#x6709;&#x591a;&#x5c11; channel &#x53d1;&#x751f;&#x4e86;&#x4e8b;&#x4ef6;&#x3002;\n\n&#x65b9;&#x6cd5;1&#xff0c;&#x963b;&#x585e;&#x76f4;&#x5230;&#x7ed1;&#x5b9a;&#x4e8b;&#x4ef6;&#x53d1;&#x751f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1009,1012"}},{"content":"<pre data-lines=\"1013,1017\"><code class=\"language-java\"><span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">count</span> <span class=\"hljs-operator\">=</span> selector.select();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1013,1017"}},{"content":"<pre data-lines=\"1018,1019\"><code>&#x65b9;&#x6cd5;2&#xff0c;&#x963b;&#x585e;&#x76f4;&#x5230;&#x7ed1;&#x5b9a;&#x4e8b;&#x4ef6;&#x53d1;&#x751f;&#xff0c;&#x6216;&#x662f;&#x8d85;&#x65f6;&#xff08;&#x65f6;&#x95f4;&#x5355;&#x4f4d;&#x4e3a; ms&#xff09;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1018,1019"}},{"content":"<pre data-lines=\"1020,1024\"><code class=\"language-java\"><span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">count</span> <span class=\"hljs-operator\">=</span> selector.select(<span class=\"hljs-type\">long</span> timeout);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1020,1024"}},{"content":"<pre data-lines=\"1025,1026\"><code>&#x65b9;&#x6cd5;3&#xff0c;&#x4e0d;&#x4f1a;&#x963b;&#x585e;&#xff0c;&#x4e5f;&#x5c31;&#x662f;&#x4e0d;&#x7ba1;&#x6709;&#x6ca1;&#x6709;&#x4e8b;&#x4ef6;&#xff0c;&#x7acb;&#x523b;&#x8fd4;&#x56de;&#xff0c;&#x81ea;&#x5df1;&#x6839;&#x636e;&#x8fd4;&#x56de;&#x503c;&#x68c0;&#x67e5;&#x662f;&#x5426;&#x6709;&#x4e8b;&#x4ef6;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1025,1026"}},{"content":"<pre data-lines=\"1027,1031\"><code class=\"language-java\"><span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">count</span> <span class=\"hljs-operator\">=</span> selector.selectNow();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1027,1031"}},{"content":"<pre data-lines=\"1032,1042\"><code>**select &#x4f55;&#x65f6;&#x4e0d;&#x963b;&#x585e;&#xff1f;**\n\n*   &#x4e8b;&#x4ef6;&#x53d1;&#x751f;&#x65f6;\n    *   &#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x8d77;&#x8fde;&#x63a5;&#x8bf7;&#x6c42;&#xff0c;&#x4f1a;&#x89e6;&#x53d1; accept &#x4e8b;&#x4ef6;\n    *   &#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x9001;&#x6570;&#x636e;&#x3001;&#x5ba2;&#x6237;&#x7aef;&#x6b63;&#x5e38;&#x3001;&#x5f02;&#x5e38;&#x5173;&#x95ed;&#x65f6;&#xff0c;&#x90fd;&#x4f1a;&#x89e6;&#x53d1; read &#x4e8b;&#x4ef6;&#xff0c;&#x5982;&#x679c;&#x53d1;&#x9001;&#x7684;&#x6570;&#x636e;&#x5927;&#x4e8e; buffer &#x7f13;&#x51b2;&#x533a;&#xff0c;&#x4f1a;&#x89e6;&#x53d1;&#x591a;&#x6b21;&#x8bfb;&#x53d6;&#x4e8b;&#x4ef6;\n    *   channel &#x53ef;&#x5199;&#xff0c;&#x4f1a;&#x89e6;&#x53d1; write &#x4e8b;&#x4ef6;\n    *   &#x5728; linux &#x4e0b; nio bug &#x53d1;&#x751f;&#x65f6;\n*   &#x8c03;&#x7528; selector.wakeup()\n*   &#x8c03;&#x7528; selector.close()\n*   selector &#x6240;&#x5728;&#x7ebf;&#x7a0b; interrupt\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1032,1042"}}],"payload":{"tag":"h4","lines":"1007,1008"}}],"payload":{"tag":"h3","lines":"969,970"}},{"content":"1.6.3&#x3001;&#x5355;&#x7ebf;&#x7a0b;&#x901a;&#x4fe1;","children":[{"content":"1.6.3.1&#x3001;&#x670d;&#x52a1;&#x5668;","children":[{"content":"<pre data-lines=\"1047,1091\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Server</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        <span class=\"hljs-type\">Selector</span> <span class=\"hljs-variable\">selector</span> <span class=\"hljs-operator\">=</span> Selector.open();\n        <span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">ssc</span> <span class=\"hljs-operator\">=</span> ServerSocketChannel.open();\n        ssc.configureBlocking(<span class=\"hljs-literal\">false</span>);\n        ssc.register(selector, SelectionKey.OP_ACCEPT);\n        ssc.bind(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-number\">8080</span>));\n        log.debug(<span class=\"hljs-string\">&quot;&#x670d;&#x52a1;&#x5668;&#x542f;&#x52a8;&#x6210;&#x529f;&#xff01;&quot;</span>);\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n            selector.select();\n            Iterator&lt;SelectionKey&gt; selectionKeyIterator = selector.selectedKeys().iterator();\n            <span class=\"hljs-keyword\">while</span> (selectionKeyIterator.hasNext()) {\n                <span class=\"hljs-type\">SelectionKey</span> <span class=\"hljs-variable\">selectionKey</span> <span class=\"hljs-operator\">=</span> selectionKeyIterator.next();\n                \n                <span class=\"hljs-keyword\">if</span> (selectionKey.isAcceptable()) {\n                    <span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> (ServerSocketChannel) selectionKey.channel();\n                    <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">acceptChannel</span> <span class=\"hljs-operator\">=</span> channel.accept();\n                    acceptChannel.configureBlocking(<span class=\"hljs-literal\">false</span>);\n                    acceptChannel.register(selector, SelectionKey.OP_READ);\n                    log.debug(<span class=\"hljs-string\">&quot;&#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;&quot;</span>);\n                } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (selectionKey.isReadable()) {\n                    <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> (SocketChannel) selectionKey.channel();\n                    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">16</span>);\n                    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">read</span> <span class=\"hljs-operator\">=</span> channel.read(buffer);\n                    <span class=\"hljs-keyword\">if</span> (read == -<span class=\"hljs-number\">1</span>) {\n                        selectionKey.cancel();\n                        log.debug(<span class=\"hljs-string\">&quot;&#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;&quot;</span>);\n                    } <span class=\"hljs-keyword\">else</span> {\n                        buffer.flip();\n                        log.debug(<span class=\"hljs-string\">&quot;&#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x6765;&#x6570;&#x636e;&#xff1a;{}&quot;</span>, StandardCharsets.UTF_8.decode(buffer));\n                        selectionKey.interestOps(selectionKey.interestOps() + SelectionKey.OP_WRITE);\n                        channel.write(StandardCharsets.UTF_8.encode(<span class=\"hljs-string\">&quot;Hi&quot;</span>));\n                        selectionKey.interestOps(selectionKey.interestOps() - SelectionKey.OP_WRITE);\n                    }\n                }\n                selectionKeyIterator.remove();\n            }\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1047,1091"}},{"content":"<pre data-lines=\"1092,1097\"><code>&gt; &#x6ce8;&#x610f;&#xff1a;\n&gt; \n&gt; *   &#x4e8b;&#x4ef6;&#x53d1;&#x751f;&#x540e;&#xff0c;&#x8981;&#x4e48;&#x5904;&#x7406;&#xff0c;&#x8981;&#x4e48;&#x53d6;&#x6d88;&#xff08;cancel&#xff09;&#xff0c;&#x4e0d;&#x80fd;&#x4ec0;&#x4e48;&#x90fd;&#x4e0d;&#x505a;&#xff0c;&#x5426;&#x5219;&#x4e0b;&#x6b21;&#x8be5;&#x4e8b;&#x4ef6;&#x4ecd;&#x4f1a;&#x89e6;&#x53d1;&#xff01;\n&gt; *   select &#x5728;&#x4e8b;&#x4ef6;&#x53d1;&#x751f;&#x540e;&#xff0c;&#x5c31;&#x4f1a;&#x5c06;&#x76f8;&#x5173;&#x7684; selectionKey &#x653e;&#x5165; selectedKeys &#x96c6;&#x5408;&#xff0c;&#x4f46;&#x4e0d;&#x4f1a;&#x5728;&#x5904;&#x7406;&#x5b8c;&#x540e;&#x4ece; selectedKeys &#x96c6;&#x5408;&#x4e2d;&#x79fb;&#x9664;&#xff0c;&#x9700;&#x8981;&#x6211;&#x4eec;&#x81ea;&#x5df1;&#x7f16;&#x7801;&#x5220;&#x9664;&#x3002;\n&gt; *   cancel &#x4f1a;&#x53d6;&#x6d88;&#x6ce8;&#x518c;&#x5728; selector &#x4e0a;&#x7684; channel&#xff0c;&#x5e76;&#x4ece; keys &#x96c6;&#x5408;&#x4e2d;&#x5220;&#x9664; key &#x540e;&#x7eed;&#x4e0d;&#x4f1a;&#x518d;&#x76d1;&#x542c;&#x4e8b;&#x4ef6;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1092,1097"}}],"payload":{"tag":"h4","lines":"1045,1046"}},{"content":"1.6.3.2&#x3001;&#x5ba2;&#x6237;&#x7aef;","children":[{"content":"<pre data-lines=\"1100,1120\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Client</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> SocketChannel.open();\n        channel.connect(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">8080</span>));\n        channel.write(StandardCharsets.UTF_8.encode(<span class=\"hljs-string\">&quot;Hello&quot;</span>));\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">16</span>);\n        <span class=\"hljs-type\">StringBuffer</span> <span class=\"hljs-variable\">sb</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringBuffer</span>();\n        channel.read(buffer);\n        buffer.flip();\n        <span class=\"hljs-keyword\">while</span> (buffer.hasRemaining()) {\n            sb.append((<span class=\"hljs-type\">char</span>) buffer.get());\n        }\n        log.debug(<span class=\"hljs-string\">&quot;&#x670d;&#x52a1;&#x5668;&#x8fd4;&#x56de;&#x6570;&#x636e;&#xff1a;{}&quot;</span>, sb);\n        channel.close();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1100,1120"}}],"payload":{"tag":"h4","lines":"1098,1099"}},{"content":"1.6.3.3&#x3001;&#x63a7;&#x5236;&#x53f0;","children":[{"content":"<pre data-lines=\"1123,1124\"><code>Server\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1123,1124"}},{"content":"<pre data-lines=\"1125,1132\"><code class=\"language-java\">21:35:25 [DEBUG] [main] i.g.c.nio.Server - &#x670d;&#x52a1;&#x5668;&#x542f;&#x52a8;&#x6210;&#x529f;&#xff01;\n21:35:30 [DEBUG] [main] i.g.c.nio.Server - &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;\n21:35:30 [DEBUG] [main] i.g.c.nio.Server - &#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x6765;&#x6570;&#x636e;&#xff1a;Hello\n21:35:30 [DEBUG] [main] i.g.c.nio.Server - &#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1125,1132"}},{"content":"<pre data-lines=\"1133,1134\"><code>Client\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1133,1134"}},{"content":"<pre data-lines=\"1135,1139\"><code class=\"language-java\">21:36:27 [DEBUG] [main] i.g.c.nio.Client - &#x670d;&#x52a1;&#x5668;&#x8fd4;&#x56de;&#x6570;&#x636e;&#xff1a;Hi\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1135,1139"}}],"payload":{"tag":"h4","lines":"1121,1122"}}],"payload":{"tag":"h3","lines":"1043,1044"}},{"content":"1.6.4&#x3001;&#x5b58;&#x5728;&#x7684;&#x95ee;&#x9898;","children":[{"content":"1.6.4.1&#x3001;&#x5982;&#x4f55;&#x5904;&#x7406;&#x6d88;&#x606f;&#x8fb9;&#x754c;","children":[{"content":"","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/3693916d0d5eb6cd206e0cb2fb64519c.png\" alt>","children":[],"payload":{"tag":"img","lines":"1146,1147"}},{"content":"<pre data-lines=\"1148,1153\"><code>*   &#x4e00;&#x79cd;&#x601d;&#x8def;&#x662f;&#x56fa;&#x5b9a;&#x6d88;&#x606f;&#x957f;&#x5ea6;&#xff0c;&#x6570;&#x636e;&#x5305;&#x5927;&#x5c0f;&#x4e00;&#x6837;&#xff0c;&#x670d;&#x52a1;&#x5668;&#x6309;&#x9884;&#x5b9a;&#x957f;&#x5ea6;&#x8bfb;&#x53d6;&#xff0c;&#x7f3a;&#x70b9;&#x662f;&#x6d6a;&#x8d39;&#x5e26;&#x5bbd;\n*   &#x53e6;&#x4e00;&#x79cd;&#x601d;&#x8def;&#x662f;&#x6309;&#x5206;&#x9694;&#x7b26;&#x62c6;&#x5206;&#xff0c;&#x7f3a;&#x70b9;&#x662f;&#x6548;&#x7387;&#x4f4e;\n*   TLV &#x683c;&#x5f0f;&#xff0c;&#x5373; Type &#x7c7b;&#x578b;&#x3001;Length &#x957f;&#x5ea6;&#x3001;Value &#x6570;&#x636e;&#xff0c;&#x7c7b;&#x578b;&#x548c;&#x957f;&#x5ea6;&#x5df2;&#x77e5;&#x7684;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;&#x5c31;&#x53ef;&#x4ee5;&#x65b9;&#x4fbf;&#x83b7;&#x53d6;&#x6d88;&#x606f;&#x5927;&#x5c0f;&#xff0c;&#x5206;&#x914d;&#x5408;&#x9002;&#x7684; buffer&#xff0c;&#x7f3a;&#x70b9;&#x662f; buffer &#x9700;&#x8981;&#x63d0;&#x524d;&#x5206;&#x914d;&#xff0c;&#x5982;&#x679c;&#x5185;&#x5bb9;&#x8fc7;&#x5927;&#xff0c;&#x5219;&#x5f71;&#x54cd; server &#x541e;&#x5410;&#x91cf;\n    *   Http 1.1 &#x662f; TLV &#x683c;&#x5f0f;\n    *   Http 2.0 &#x662f; LTV &#x683c;&#x5f0f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1148,1153"}}],"payload":{"tag":"h5","lines":"1144,1145"}},{"content":"1.6.4.1.1&#x3001;&#x670d;&#x52a1;&#x5668;","children":[{"content":"<pre data-lines=\"1156,1227\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ExpansionServer</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        <span class=\"hljs-type\">Selector</span> <span class=\"hljs-variable\">selector</span> <span class=\"hljs-operator\">=</span> Selector.open();\n        <span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">ssc</span> <span class=\"hljs-operator\">=</span> ServerSocketChannel.open();\n        ssc.configureBlocking(<span class=\"hljs-literal\">false</span>);\n        ssc.register(selector, SelectionKey.OP_ACCEPT);\n        ssc.bind(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-number\">8080</span>));\n        log.debug(<span class=\"hljs-string\">&quot;&#x670d;&#x52a1;&#x5668;&#x542f;&#x52a8;&#x6210;&#x529f;&#xff01;&quot;</span>);\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n            selector.select();\n            Iterator&lt;SelectionKey&gt; selectionKeyIterator = selector.selectedKeys().iterator();\n            <span class=\"hljs-keyword\">while</span> (selectionKeyIterator.hasNext()) {\n                <span class=\"hljs-type\">SelectionKey</span> <span class=\"hljs-variable\">selectionKey</span> <span class=\"hljs-operator\">=</span> selectionKeyIterator.next();\n                \n                <span class=\"hljs-keyword\">if</span> (selectionKey.isAcceptable()) {\n                    <span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> (ServerSocketChannel) selectionKey.channel();\n                    <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">acceptChannel</span> <span class=\"hljs-operator\">=</span> channel.accept();\n                    acceptChannel.configureBlocking(<span class=\"hljs-literal\">false</span>);\n                    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">4</span>);\n                    acceptChannel.register(selector, SelectionKey.OP_READ, buffer);\n                    log.debug(<span class=\"hljs-string\">&quot;&#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;&quot;</span>);\n                } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (selectionKey.isReadable()) {\n                    <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> (SocketChannel) selectionKey.channel();\n                    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> (ByteBuffer) selectionKey.attachment();\n                    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">read</span> <span class=\"hljs-operator\">=</span> channel.read(buffer);\n                    <span class=\"hljs-keyword\">if</span> (read == -<span class=\"hljs-number\">1</span>) {\n                        selectionKey.cancel();\n                        log.debug(<span class=\"hljs-string\">&quot;&#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;&quot;</span>);\n                    } <span class=\"hljs-keyword\">else</span> {\n                        \n                        split(buffer);\n                        \n                        <span class=\"hljs-keyword\">if</span> (buffer.position() == buffer.limit()) {\n                            <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">newBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(buffer.capacity() * <span class=\"hljs-number\">2</span>);\n                            buffer.flip();\n                            newBuffer.put(buffer);\n                            selectionKey.attach(newBuffer);\n                        }\n                        \n                        <span class=\"hljs-keyword\">if</span> (!buffer.hasRemaining()) {\n                            selectionKey.interestOps(selectionKey.interestOps()+SelectionKey.OP_WRITE);\n                            channel.write(StandardCharsets.UTF_8.encode(<span class=\"hljs-string\">&quot;Hi&quot;</span>));\n                            selectionKey.interestOps(selectionKey.interestOps()-SelectionKey.OP_WRITE);\n                        }\n                    }\n                }\n                selectionKeyIterator.remove();\n            }\n        }\n    }\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">split</span><span class=\"hljs-params\">(ByteBuffer source)</span> {\n        source.flip();\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; source.limit(); i++) {\n            <span class=\"hljs-keyword\">if</span> (source.get(i) == <span class=\"hljs-string\">&apos;\\n&apos;</span>) {\n                <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">length</span> <span class=\"hljs-operator\">=</span> i + <span class=\"hljs-number\">1</span> - source.position();\n                <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">target</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(length);\n                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; j &lt; length; j++) {\n                    target.put(source.get());\n                }\n                target.flip();\n                log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, StandardCharsets.UTF_8.decode(target));\n            }\n        }\n        source.compact();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1156,1227"}}],"payload":{"tag":"h5","lines":"1154,1155"}},{"content":"1.6.4.1.2&#x3001;&#x5ba2;&#x6237;&#x7aef;","children":[{"content":"<pre data-lines=\"1230,1251\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ExpansionClient</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> SocketChannel.open();\n        channel.connect(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">8080</span>));\n        channel.write(StandardCharsets.UTF_8.encode(<span class=\"hljs-string\">&quot;Hello,world\\nI&apos;m zhangsan\\nHo&quot;</span>));\n        channel.write(StandardCharsets.UTF_8.encode(<span class=\"hljs-string\">&quot;w are you?\\n&quot;</span>));\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">16</span>);\n        <span class=\"hljs-type\">StringBuffer</span> <span class=\"hljs-variable\">sb</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringBuffer</span>();\n        channel.read(buffer);\n        buffer.flip();\n        <span class=\"hljs-keyword\">while</span> (buffer.hasRemaining()) {\n            sb.append((<span class=\"hljs-type\">char</span>) buffer.get());\n        }\n        log.debug(<span class=\"hljs-string\">&quot;&#x670d;&#x52a1;&#x5668;&#x8fd4;&#x56de;&#x6570;&#x636e;&#xff1a;{}&quot;</span>, sb);\n        channel.close();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1230,1251"}}],"payload":{"tag":"h5","lines":"1228,1229"}},{"content":"1.6.4.1.3&#x3001;&#x63a7;&#x5236;&#x53f0;","children":[{"content":"<pre data-lines=\"1254,1255\"><code>ExpansionServer\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1254,1255"}},{"content":"<pre data-lines=\"1256,1268\"><code class=\"language-java\">22:05:18 [DEBUG] [main] i.g.c.n.ExpansionServer - &#x670d;&#x52a1;&#x5668;&#x542f;&#x52a8;&#x6210;&#x529f;&#xff01;\n22:05:37 [DEBUG] [main] i.g.c.n.ExpansionServer - &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;\n22:05:37 [DEBUG] [main] i.g.c.n.ExpansionServer - Hello,world\n\n22:05:37 [DEBUG] [main] i.g.c.n.ExpansionServer - I&apos;m zhangsan\n\n22:05:37 [DEBUG] [main] i.g.c.n.ExpansionServer - How are you?\n\n22:05:37 [DEBUG] [main] i.g.c.n.ExpansionServer - &#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1256,1268"}},{"content":"<pre data-lines=\"1269,1270\"><code>ExpansionClient\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1269,1270"}},{"content":"<pre data-lines=\"1271,1275\"><code class=\"language-java\">22:05:37 [DEBUG] [main] i.g.c.n.ExpansionClient - &#x670d;&#x52a1;&#x5668;&#x8fd4;&#x56de;&#x6570;&#x636e;&#xff1a;Hi\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1271,1275"}}],"payload":{"tag":"h5","lines":"1252,1253"}}],"payload":{"tag":"h4","lines":"1142,1143"}},{"content":"1.6.4.2&#x3001;&#x6570;&#x636e;&#x65e0;&#x6cd5;&#x4e00;&#x6b21;&#x8fd4;&#x56de;","children":[{"content":"<pre data-lines=\"1279,1284\"><code>*   &#x975e;&#x963b;&#x585e;&#x6a21;&#x5f0f;&#x4e0b;&#xff0c;&#x65e0;&#x6cd5;&#x4fdd;&#x8bc1;&#x628a; buffer &#x4e2d;&#x6240;&#x6709;&#x6570;&#x636e;&#x90fd;&#x5199;&#x5165; channel&#xff0c;&#x56e0;&#x6b64;&#x9700;&#x8981;&#x8ffd;&#x8e2a; write &#x65b9;&#x6cd5;&#x7684;&#x8fd4;&#x56de;&#x503c;&#xff08;&#x4ee3;&#x8868;&#x5b9e;&#x9645;&#x5199;&#x5165;&#x5b57;&#x8282;&#x6570;&#xff09;\n*   &#x7528; selector &#x76d1;&#x542c;&#x6240;&#x6709; channel &#x7684;&#x53ef;&#x5199;&#x4e8b;&#x4ef6;&#xff0c;&#x6bcf;&#x4e2a; channel &#x90fd;&#x9700;&#x8981;&#x4e00;&#x4e2a; selectionKey &#x6765;&#x8ddf;&#x8e2a; buffer&#xff0c;&#x4f46;&#x8fd9;&#x6837;&#x53c8;&#x4f1a;&#x5bfc;&#x81f4;&#x5360;&#x7528;&#x5185;&#x5b58;&#x8fc7;&#x591a;&#xff0c;&#x5c31;&#x6709;&#x4e24;&#x9636;&#x6bb5;&#x7b56;&#x7565;\n    *   &#x5f53;&#x6d88;&#x606f;&#x5904;&#x7406;&#x5668;&#x7b2c;&#x4e00;&#x6b21;&#x5199;&#x5165;&#x6d88;&#x606f;&#x65f6;&#xff0c;&#x624d;&#x5c06; channel &#x6ce8;&#x518c;&#x5230; selector &#x4e0a;\n    *   selector &#x68c0;&#x67e5; channel &#x4e0a;&#x7684;&#x53ef;&#x5199;&#x4e8b;&#x4ef6;&#xff0c;&#x5982;&#x679c;&#x6240;&#x6709;&#x7684;&#x6570;&#x636e;&#x5199;&#x5b8c;&#x4e86;&#xff0c;&#x5c31;&#x53d6;&#x6d88; channel &#x7684;&#x6ce8;&#x518c;\n    *   &#x5982;&#x679c;&#x4e0d;&#x53d6;&#x6d88;&#xff0c;&#x4f1a;&#x6bcf;&#x6b21;&#x53ef;&#x5199;&#x5747;&#x4f1a;&#x89e6;&#x53d1; write &#x4e8b;&#x4ef6;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1279,1284"}},{"content":"1.6.4.2.1&#x3001;&#x670d;&#x52a1;&#x7aef;","children":[{"content":"<pre data-lines=\"1287,1342\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">WriteServer</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        <span class=\"hljs-type\">Selector</span> <span class=\"hljs-variable\">selector</span> <span class=\"hljs-operator\">=</span> Selector.open();\n        <span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">ssc</span> <span class=\"hljs-operator\">=</span> ServerSocketChannel.open();\n        ssc.configureBlocking(<span class=\"hljs-literal\">false</span>);\n        ssc.register(selector, SelectionKey.OP_ACCEPT);\n        ssc.bind(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-number\">8080</span>));\n        log.debug(<span class=\"hljs-string\">&quot;&#x670d;&#x52a1;&#x5668;&#x542f;&#x52a8;&#x6210;&#x529f;&#xff01;&quot;</span>);\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n            selector.select();\n            Iterator&lt;SelectionKey&gt; selectionKeyIterator = selector.selectedKeys().iterator();\n            <span class=\"hljs-keyword\">while</span> (selectionKeyIterator.hasNext()) {\n                <span class=\"hljs-type\">SelectionKey</span> <span class=\"hljs-variable\">selectionKey</span> <span class=\"hljs-operator\">=</span> selectionKeyIterator.next();\n                \n                <span class=\"hljs-keyword\">if</span> (selectionKey.isAcceptable()) {\n                    <span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> (ServerSocketChannel) selectionKey.channel();\n                    <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">acceptChannel</span> <span class=\"hljs-operator\">=</span> channel.accept();\n                    acceptChannel.configureBlocking(<span class=\"hljs-literal\">false</span>);\n                    <span class=\"hljs-type\">SelectionKey</span> <span class=\"hljs-variable\">sckey</span> <span class=\"hljs-operator\">=</span> acceptChannel.register(selector, SelectionKey.OP_READ);\n                    \n                    <span class=\"hljs-type\">StringBuilder</span> <span class=\"hljs-variable\">sb</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringBuilder</span>();\n                    <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">10000000</span>; i++) {\n                        sb.append(<span class=\"hljs-string\">&quot;0&quot;</span>);\n                    }\n                    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> StandardCharsets.UTF_8.encode(sb.toString());\n                    \n                    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">write</span> <span class=\"hljs-operator\">=</span> acceptChannel.write(buffer);\n                    log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, write);\n                    \n                    <span class=\"hljs-keyword\">if</span> (buffer.hasRemaining()) {\n                        \n                        sckey.interestOps(sckey.interestOps() + SelectionKey.OP_WRITE);\n                        \n                        sckey.attach(buffer);\n                    }\n                } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (selectionKey.isWritable()) {\n                    <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> (SocketChannel) selectionKey.channel();\n                    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> (ByteBuffer) selectionKey.attachment();\n                    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">write</span> <span class=\"hljs-operator\">=</span> channel.write(buffer);\n                    log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, write);\n                    \n                    <span class=\"hljs-keyword\">if</span> (!buffer.hasRemaining()) {\n                        selectionKey.attach(<span class=\"hljs-literal\">null</span>);\n                        selectionKey.interestOps(selectionKey.interestOps() - SelectionKey.OP_WRITE);\n                    }\n                }\n                selectionKeyIterator.remove();\n            }\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1287,1342"}}],"payload":{"tag":"h5","lines":"1285,1286"}},{"content":"1.6.4.2.2&#x3001;&#x5ba2;&#x6237;&#x7aef;","children":[{"content":"<pre data-lines=\"1345,1362\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">WriteClient</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">sc</span> <span class=\"hljs-operator\">=</span> SocketChannel.open();\n        sc.connect(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">8080</span>));\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">count</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n            <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span> * <span class=\"hljs-number\">1024</span>);\n            count += sc.read(buffer);\n            log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, count);\n            buffer.clear();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1345,1362"}}],"payload":{"tag":"h5","lines":"1343,1344"}},{"content":"1.6.4.2.3&#x3001;&#x63a7;&#x5236;&#x53f0;","children":[{"content":"<pre data-lines=\"1365,1366\"><code>WriteServer\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1365,1366"}},{"content":"<pre data-lines=\"1367,1374\"><code class=\"language-java\">22:35:59 [DEBUG] [main] i.g.c.n.WriteServer - &#x670d;&#x52a1;&#x5668;&#x542f;&#x52a8;&#x6210;&#x529f;&#xff01;\n22:36:06 [DEBUG] [main] i.g.c.n.WriteServer - 3014633\n22:36:06 [DEBUG] [main] i.g.c.n.WriteServer - 3014633\n22:36:06 [DEBUG] [main] i.g.c.n.WriteServer - 3970734\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1367,1374"}},{"content":"<pre data-lines=\"1375,1376\"><code>WriteClient\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1375,1376"}},{"content":"<pre data-lines=\"1377,1392\"><code class=\"language-java\">...\n...\n...\n22:36:06 [DEBUG] [main] i.g.c.n.WriteClient - 8978242\n22:36:06 [DEBUG] [main] i.g.c.n.WriteClient - 9109313\n22:36:06 [DEBUG] [main] i.g.c.n.WriteClient - 9240384\n22:36:06 [DEBUG] [main] i.g.c.n.WriteClient - 9371455\n22:36:06 [DEBUG] [main] i.g.c.n.WriteClient - 9502526\n22:36:06 [DEBUG] [main] i.g.c.n.WriteClient - 9633597\n22:36:06 [DEBUG] [main] i.g.c.n.WriteClient - 9764668\n22:36:06 [DEBUG] [main] i.g.c.n.WriteClient - 9895739\n22:36:06 [DEBUG] [main] i.g.c.n.WriteClient - 10000000\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1377,1392"}}],"payload":{"tag":"h5","lines":"1363,1364"}}],"payload":{"tag":"h4","lines":"1276,1277"}}],"payload":{"tag":"h3","lines":"1140,1141"}},{"content":"1.6.5&#x3001;&#x591a;&#x7ebf;&#x7a0b;&#x901a;&#x4fe1;","children":[{"content":"1.6.5.1&#x3001;&#x670d;&#x52a1;&#x5668;","children":[{"content":"<pre data-lines=\"1397,1398\"><code>&#x73b0;&#x5728;&#x90fd;&#x662f;&#x591a;&#x6838; cpu&#xff0c;&#x8bbe;&#x8ba1;&#x65f6;&#x8981;&#x5145;&#x5206;&#x8003;&#x8651;&#x522b;&#x8ba9; cpu &#x7684;&#x529b;&#x91cf;&#x88ab;&#x767d;&#x767d;&#x6d6a;&#x8d39;&#xff0c;&#x524d;&#x9762;&#x7684;&#x4ee3;&#x7801;&#x53ea;&#x6709;&#x4e00;&#x4e2a;&#x9009;&#x62e9;&#x5668;&#xff0c;&#x6ca1;&#x6709;&#x5145;&#x5206;&#x5229;&#x7528;&#x591a;&#x6838; cpu&#xff0c;&#x5982;&#x4f55;&#x6539;&#x8fdb;&#x5462;&#xff1f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1397,1398"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1da8b8aaaee5bba5486a9a700bbf96cd.png\" alt>","children":[],"payload":{"tag":"img","lines":"1399,1400"}},{"content":"<pre data-lines=\"1401,1412\"><code>*   Boss&#xff1a;&#x53ea;&#x5173;&#x6ce8; Accept &#x8fde;&#x63a5;&#xff0c;&#x4ed6;&#x4e0d;&#x8d1f;&#x8d23;&#x8bfb;&#x5199;\n*   Worker&#xff1a;Worker&#x8d1f;&#x8d23;&#x5177;&#x4f53;&#x7684;&#x8bfb;&#x5199;&#x64cd;&#x4f5c;\n\n&#x6211;&#x4eec;&#x5206;&#x4e3a;&#x4e24;&#x7ec4;&#x9009;&#x62e9;&#x5668;&#xff1a;\n\n*   &#x5355;&#x7ebf;&#x7a0b;&#x914d;&#x4e00;&#x4e2a;&#x9009;&#x62e9;&#x5668;&#xff0c;&#x4e13;&#x95e8;&#x5904;&#x7406; accept &#x4e8b;&#x4ef6;\n*   &#x521b;&#x5efa; cpu &#x6838;&#x5fc3;&#x6570;&#x7684;&#x7ebf;&#x7a0b;&#xff0c;&#x6bcf;&#x4e2a;&#x7ebf;&#x7a0b;&#x914d;&#x4e00;&#x4e2a;&#x9009;&#x62e9;&#x5668;&#xff0c;&#x8f6e;&#x6d41;&#x5904;&#x7406; read &#x4e8b;&#x4ef6;\n\n&#x5982;&#x4f55;&#x62ff;&#x5230; cpu &#x4e2a;&#x6570;&#xff1f;\n\nRuntime.getRuntime().availableProcessors()&#x53ef;&#x4ee5;&#x62ff;&#x5230; cpu &#x6838;&#x5fc3;&#x6570;&#xff0c;&#x5982;&#x679c;&#x5de5;&#x4f5c;&#x5728; docker &#x5bb9;&#x5668;&#x4e0b;&#xff0c;&#x56e0;&#x4e3a;&#x5bb9;&#x5668;&#x4e0d;&#x662f;&#x7269;&#x7406;&#x9694;&#x79bb;&#x7684;&#xff0c;&#x4f1a;&#x62ff;&#x5230;&#x7269;&#x7406; cpu &#x4e2a;&#x6570;&#xff0c;&#x800c;&#x4e0d;&#x662f;&#x5bb9;&#x5668;&#x7533;&#x8bf7;&#x65f6;&#x7684;&#x4e2a;&#x6570;&#xff0c;&#x8fd9;&#x4e2a;&#x95ee;&#x9898;&#x76f4;&#x5230; jdk 10 &#x624d;&#x4fee;&#x590d;&#xff0c;&#x4f7f;&#x7528; jvm &#x53c2;&#x6570; UseContainerSupport &#x914d;&#x7f6e;&#xff0c; &#x9ed8;&#x8ba4;&#x5f00;&#x542f;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1401,1412"}},{"content":"<pre data-lines=\"1413,1502\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MultiThreadServer</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        Thread.currentThread().setName(<span class=\"hljs-string\">&quot;boss&quot;</span>);\n        <span class=\"hljs-type\">Selector</span> <span class=\"hljs-variable\">boss</span> <span class=\"hljs-operator\">=</span> Selector.open();\n        <span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">ssc</span> <span class=\"hljs-operator\">=</span> ServerSocketChannel.open();\n        ssc.configureBlocking(<span class=\"hljs-literal\">false</span>);\n        ssc.register(boss, SelectionKey.OP_ACCEPT);\n        ssc.bind(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-number\">8080</span>));\n        log.debug(<span class=\"hljs-string\">&quot;&#x670d;&#x52a1;&#x5668;&#x542f;&#x52a8;&#x6210;&#x529f;&#xff01;&quot;</span>);\n        \n        Worker[] workers = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Worker</span>[Runtime.getRuntime().availableProcessors()];\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; workers.length; i++) {\n            workers[i] = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Worker</span>(<span class=\"hljs-string\">&quot;worker-&quot;</span> + i);\n        }\n        <span class=\"hljs-type\">AtomicInteger</span> <span class=\"hljs-variable\">index</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AtomicInteger</span>();\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n            boss.select();\n            Iterator&lt;SelectionKey&gt; selectionKeyIterator = boss.selectedKeys().iterator();\n            <span class=\"hljs-keyword\">while</span> (selectionKeyIterator.hasNext()) {\n                <span class=\"hljs-type\">SelectionKey</span> <span class=\"hljs-variable\">selectionKey</span> <span class=\"hljs-operator\">=</span> selectionKeyIterator.next();\n                selectionKeyIterator.remove();\n                <span class=\"hljs-keyword\">if</span> (selectionKey.isAcceptable()) {\n                    <span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> (ServerSocketChannel) selectionKey.channel();\n                    <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">acceptChannel</span> <span class=\"hljs-operator\">=</span> channel.accept();\n                    acceptChannel.configureBlocking(<span class=\"hljs-literal\">false</span>);\n                    log.debug(<span class=\"hljs-string\">&quot;&#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;&quot;</span>);\n                    \n                    log.debug(<span class=\"hljs-string\">&quot;before register...{}&quot;</span>, acceptChannel.getRemoteAddress());\n                    workers[index.getAndIncrement() % workers.length].register(acceptChannel);\n                    log.debug(<span class=\"hljs-string\">&quot;after register...{}&quot;</span>, acceptChannel.getRemoteAddress());\n                }\n            }\n        }\n    }\n\n    <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Worker</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">Runnable</span> {\n        <span class=\"hljs-keyword\">private</span> Thread thread;\n        <span class=\"hljs-keyword\">private</span> Selector selector;\n        <span class=\"hljs-keyword\">private</span> String name;\n        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">volatile</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-variable\">start</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">false</span>;\n\n        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">Worker</span><span class=\"hljs-params\">(String name)</span> {\n            <span class=\"hljs-built_in\">this</span>.name = name;\n        }\n\n        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">register</span><span class=\"hljs-params\">(SocketChannel sc)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n            <span class=\"hljs-keyword\">if</span> (!start) {\n                selector = Selector.open();\n                thread = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(<span class=\"hljs-built_in\">this</span>, name);\n                thread.start();\n                start = <span class=\"hljs-literal\">true</span>;\n            }\n            selector.wakeup();\n            sc.register(selector, SelectionKey.OP_READ);\n        }\n\n        <span class=\"hljs-meta\">@SneakyThrows</span>\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">run</span><span class=\"hljs-params\">()</span> {\n            <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n                selector.select();\n                Iterator&lt;SelectionKey&gt; selectionKeyIterator = selector.selectedKeys().iterator();\n                <span class=\"hljs-keyword\">while</span> (selectionKeyIterator.hasNext()) {\n                    <span class=\"hljs-type\">SelectionKey</span> <span class=\"hljs-variable\">selectionKey</span> <span class=\"hljs-operator\">=</span> selectionKeyIterator.next();\n                    selectionKeyIterator.remove();\n                    <span class=\"hljs-keyword\">if</span> (selectionKey.isReadable()) {\n                        <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> (SocketChannel) selectionKey.channel();\n                        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">16</span>);\n                        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">read</span> <span class=\"hljs-operator\">=</span> channel.read(buffer);\n                        <span class=\"hljs-keyword\">if</span> (read == -<span class=\"hljs-number\">1</span>) {\n                            selectionKey.cancel();\n                            log.debug(<span class=\"hljs-string\">&quot;&#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;&quot;</span>);\n                        } <span class=\"hljs-keyword\">else</span> {\n                            buffer.flip();\n                            log.debug(<span class=\"hljs-string\">&quot;&#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x6765;&#x6570;&#x636e;&#xff1a;{}&quot;</span>, StandardCharsets.UTF_8.decode(buffer));\n                            selectionKey.interestOps(selectionKey.interestOps()+SelectionKey.OP_WRITE);\n                            channel.write(StandardCharsets.UTF_8.encode(<span class=\"hljs-string\">&quot;Hi&quot;</span>));\n                            selectionKey.interestOps(selectionKey.interestOps()-SelectionKey.OP_WRITE);\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1413,1502"}}],"payload":{"tag":"h4","lines":"1395,1396"}},{"content":"1.6.5.2&#x3001;&#x5ba2;&#x6237;&#x7aef;","children":[{"content":"<pre data-lines=\"1505,1525\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Client</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> SocketChannel.open();\n        channel.connect(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">8080</span>));\n        channel.write(StandardCharsets.UTF_8.encode(<span class=\"hljs-string\">&quot;Hello&quot;</span>));\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">16</span>);\n        <span class=\"hljs-type\">StringBuffer</span> <span class=\"hljs-variable\">sb</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringBuffer</span>();\n        channel.read(buffer);\n        buffer.flip();\n        <span class=\"hljs-keyword\">while</span> (buffer.hasRemaining()) {\n            sb.append((<span class=\"hljs-type\">char</span>) buffer.get());\n        }\n        log.debug(<span class=\"hljs-string\">&quot;&#x670d;&#x52a1;&#x5668;&#x8fd4;&#x56de;&#x6570;&#x636e;&#xff1a;{}&quot;</span>, sb);\n        channel.close();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1505,1525"}}],"payload":{"tag":"h4","lines":"1503,1504"}},{"content":"1.6.5.3&#x3001;&#x63a7;&#x5236;&#x53f0;","children":[{"content":"<pre data-lines=\"1528,1529\"><code>MultiThreadServer\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1528,1529"}},{"content":"<pre data-lines=\"1530,1574\"><code class=\"language-java\">17:28:23 [DEBUG] [boss] i.g.c.n.MultiThreadServer - &#x670d;&#x52a1;&#x5668;&#x542f;&#x52a8;&#x6210;&#x529f;&#xff01;\n17:29:40 [DEBUG] [boss] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;\n17:29:40 [DEBUG] [boss] i.g.c.n.MultiThreadServer - before register.../127.0.0.1:58891\n17:29:40 [DEBUG] [boss] i.g.c.n.MultiThreadServer - after register.../127.0.0.1:58891\n17:29:40 [DEBUG] [worker-0] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x6765;&#x6570;&#x636e;&#xff1a;Hello\n17:29:40 [DEBUG] [worker-0] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;\n17:29:43 [DEBUG] [boss] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;\n17:29:43 [DEBUG] [boss] i.g.c.n.MultiThreadServer - before register.../127.0.0.1:58901\n17:29:43 [DEBUG] [boss] i.g.c.n.MultiThreadServer - after register.../127.0.0.1:58901\n17:29:43 [DEBUG] [worker-1] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x6765;&#x6570;&#x636e;&#xff1a;Hello\n17:29:43 [DEBUG] [worker-1] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;\n17:30:46 [DEBUG] [boss] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;\n17:30:46 [DEBUG] [boss] i.g.c.n.MultiThreadServer - before register.../127.0.0.1:64141\n17:30:46 [DEBUG] [boss] i.g.c.n.MultiThreadServer - after register.../127.0.0.1:64141\n17:30:46 [DEBUG] [worker-2] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x6765;&#x6570;&#x636e;&#xff1a;Hello\n17:30:46 [DEBUG] [worker-2] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;\n17:31:10 [DEBUG] [boss] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;\n17:31:10 [DEBUG] [boss] i.g.c.n.MultiThreadServer - before register.../127.0.0.1:50833\n17:31:10 [DEBUG] [boss] i.g.c.n.MultiThreadServer - after register.../127.0.0.1:50833\n17:31:10 [DEBUG] [worker-3] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x6765;&#x6570;&#x636e;&#xff1a;Hello\n17:31:10 [DEBUG] [worker-3] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;\n17:31:13 [DEBUG] [boss] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;\n17:31:13 [DEBUG] [boss] i.g.c.n.MultiThreadServer - before register.../127.0.0.1:50842\n17:31:13 [DEBUG] [boss] i.g.c.n.MultiThreadServer - after register.../127.0.0.1:50842\n17:31:13 [DEBUG] [worker-0] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x6765;&#x6570;&#x636e;&#xff1a;Hello\n17:31:13 [DEBUG] [worker-0] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;\n17:31:18 [DEBUG] [boss] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;\n17:31:18 [DEBUG] [boss] i.g.c.n.MultiThreadServer - before register.../127.0.0.1:50850\n17:31:18 [DEBUG] [boss] i.g.c.n.MultiThreadServer - after register.../127.0.0.1:50850\n17:31:18 [DEBUG] [worker-1] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x6765;&#x6570;&#x636e;&#xff1a;Hello\n17:31:18 [DEBUG] [worker-1] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;\n17:31:23 [DEBUG] [boss] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;\n17:31:23 [DEBUG] [boss] i.g.c.n.MultiThreadServer - before register.../127.0.0.1:50858\n17:31:23 [DEBUG] [boss] i.g.c.n.MultiThreadServer - after register.../127.0.0.1:50858\n17:31:23 [DEBUG] [worker-2] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x6765;&#x6570;&#x636e;&#xff1a;Hello\n17:31:23 [DEBUG] [worker-2] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;\n17:31:47 [DEBUG] [boss] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6210;&#x529f;&#xff01;\n17:31:47 [DEBUG] [boss] i.g.c.n.MultiThreadServer - before register.../127.0.0.1:56421\n17:31:47 [DEBUG] [boss] i.g.c.n.MultiThreadServer - after register.../127.0.0.1:56421\n17:31:47 [DEBUG] [worker-3] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x6765;&#x6570;&#x636e;&#xff1a;Hello\n17:31:47 [DEBUG] [worker-3] i.g.c.n.MultiThreadServer - &#x5ba2;&#x6237;&#x7aef;&#x65ad;&#x5f00;&#x8fde;&#x63a5;&#xff01;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1530,1574"}},{"content":"<pre data-lines=\"1575,1578\"><code>Client\n\n&#x591a;&#x6b21;&#x8fd0;&#x884c;&#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x670d;&#x52a1;&#x5668;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1575,1578"}},{"content":"<pre data-lines=\"1579,1583\"><code class=\"language-java\">17:29:43 [DEBUG] [main] i.g.c.nio.Client - &#x670d;&#x52a1;&#x5668;&#x8fd4;&#x56de;&#x6570;&#x636e;&#xff1a;Hi\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1579,1583"}}],"payload":{"tag":"h4","lines":"1526,1527"}}],"payload":{"tag":"h3","lines":"1393,1394"}}],"payload":{"tag":"h2","lines":"950,952"}},{"content":"2.1&#x3001;Netty&#x4ecb;&#x7ecd;","children":[{"content":"<pre data-lines=\"1587,1609\"><code>Netty &#x662f;&#x4e00;&#x4e2a;&#x5f02;&#x6b65;&#x7684;&#x3001;&#x57fa;&#x4e8e;&#x4e8b;&#x4ef6;&#x9a71;&#x52a8;&#x7684;&#x7f51;&#x7edc;&#x5e94;&#x7528;&#x6846;&#x67b6;&#xff0c;&#x7528;&#x4e8e;&#x5feb;&#x901f;&#x5f00;&#x53d1;&#x53ef;&#x7ef4;&#x62a4;&#x3001;&#x9ad8;&#x6027;&#x80fd;&#x7684;&#x7f51;&#x7edc;&#x670d;&#x52a1;&#x5668;&#x548c;&#x5ba2;&#x6237;&#x7aef;&#x3002;\n\nNetty &#x5728; Java &#x7f51;&#x7edc;&#x5e94;&#x7528;&#x6846;&#x67b6;&#x4e2d;&#x7684;&#x5730;&#x4f4d;&#x5c31;&#x597d;&#x6bd4; Spring &#x6846;&#x67b6;&#x5728; JavaEE &#x5f00;&#x53d1;&#x4e2d;&#x7684;&#x5730;&#x4f4d;&#x3002;\n\nNetty &#x4f7f;&#x7528;&#x4ea7;&#x54c1;&#xff1a;\n\n*   Cassandra - nosql &#x6570;&#x636e;&#x5e93;\n*   Spark - &#x5927;&#x6570;&#x636e;&#x5206;&#x5e03;&#x5f0f;&#x8ba1;&#x7b97;&#x6846;&#x67b6;\n*   Hadoop - &#x5927;&#x6570;&#x636e;&#x5206;&#x5e03;&#x5f0f;&#x5b58;&#x50a8;&#x6846;&#x67b6;\n*   RocketMQ - ali &#x5f00;&#x6e90;&#x7684;&#x6d88;&#x606f;&#x961f;&#x5217;\n*   ElasticSearch - &#x641c;&#x7d22;&#x5f15;&#x64ce;\n*   gRPC - rpc &#x6846;&#x67b6;\n*   Dubbo - rpc &#x6846;&#x67b6;\n*   Spring 5.x - flux api &#x5b8c;&#x5168;&#x629b;&#x5f03;&#x4e86; tomcat &#xff0c;&#x4f7f;&#x7528; netty &#x4f5c;&#x4e3a;&#x670d;&#x52a1;&#x5668;&#x7aef;\n*   Zookeeper - &#x5206;&#x5e03;&#x5f0f;&#x534f;&#x8c03;&#x6846;&#x67b6;\n\nNetty &#x7248;&#x672c;&#x53d1;&#x5c55;&#xff1a;\n\n*   2.x 2004\n*   3.x 2008\n*   4.x 2013\n*   5.x &#x5df2;&#x5e9f;&#x5f03;&#xff08;&#x6ca1;&#x6709;&#x660e;&#x663e;&#x7684;&#x6027;&#x80fd;&#x63d0;&#x5347;&#xff0c;&#x7ef4;&#x62a4;&#x6210;&#x672c;&#x9ad8;&#xff09;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1587,1609"}}],"payload":{"tag":"h2","lines":"1584,1586"}},{"content":"2.2&#x3001;&#x5feb;&#x901f;&#x5165;&#x95e8;","children":[{"content":"2.2.1&#x3001;&#x670d;&#x52a1;&#x7aef;","children":[{"content":"<pre data-lines=\"1625,1626\"><code>HelloServer\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1625,1626"}},{"content":"<pre data-lines=\"1627,1646\"><code class=\"language-java\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>())\n    .channel(NioServerSocketChannel.class)\n    .childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringDecoder</span>());\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SimpleChannelInboundHandler</span>&lt;String&gt;() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead0</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, String msg)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n                    System.out.println(msg);\n                }\n            });\n        }\n    })\n    .bind(<span class=\"hljs-number\">8080</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1627,1646"}},{"content":"<pre data-lines=\"1647,1662\"><code>&#x4ee3;&#x7801;&#x89e3;&#x8bfb;\n\n*   1 &#x5904;&#xff0c;&#x521b;&#x5efa; NioEventLoopGroup&#xff0c;&#x53ef;&#x4ee5;&#x7b80;&#x5355;&#x7406;&#x89e3;&#x4e3a; `&#x7ebf;&#x7a0b;&#x6c60; + Selector` &#x540e;&#x9762;&#x4f1a;&#x8be6;&#x7ec6;&#x5c55;&#x5f00;\n    \n*   2 &#x5904;&#xff0c;&#x9009;&#x62e9;&#x670d;&#x52a1; Scoket &#x5b9e;&#x73b0;&#x7c7b;&#xff0c;&#x5176;&#x4e2d; NioServerSocketChannel &#x8868;&#x793a;&#x57fa;&#x4e8e; NIO &#x7684;&#x670d;&#x52a1;&#x5668;&#x7aef;&#x5b9e;&#x73b0;&#xff0c;&#x5176;&#x5b83;&#x5b9e;&#x73b0;&#x8fd8;&#x6709;\n    \n    ![](https://img-blog.csdnimg.cn/img_convert/b4afd79f06b5591f423d47220e3ef295.png)\n    \n*   3 &#x5904;&#xff0c;&#x4e3a;&#x5565;&#x65b9;&#x6cd5;&#x53eb; childHandler&#xff0c;&#x662f;&#x63a5;&#x4e0b;&#x6765;&#x6dfb;&#x52a0;&#x7684;&#x5904;&#x7406;&#x5668;&#x90fd;&#x662f;&#x7ed9; SocketChannel &#x7528;&#x7684;&#xff0c;&#x800c;&#x4e0d;&#x662f;&#x7ed9; ServerSocketChannel&#x3002;ChannelInitializer &#x5904;&#x7406;&#x5668;&#xff08;&#x4ec5;&#x6267;&#x884c;&#x4e00;&#x6b21;&#xff09;&#xff0c;&#x5b83;&#x7684;&#x4f5c;&#x7528;&#x662f;&#x5f85;&#x5ba2;&#x6237;&#x7aef; SocketChannel &#x5efa;&#x7acb;&#x8fde;&#x63a5;&#x540e;&#xff0c;&#x6267;&#x884c; initChannel &#x4ee5;&#x4fbf;&#x6dfb;&#x52a0;&#x66f4;&#x591a;&#x7684;&#x5904;&#x7406;&#x5668;\n    \n*   4 &#x5904;&#xff0c;ServerSocketChannel &#x7ed1;&#x5b9a;&#x7684;&#x76d1;&#x542c;&#x7aef;&#x53e3;\n    \n*   5 &#x5904;&#xff0c;SocketChannel &#x7684;&#x5904;&#x7406;&#x5668;&#xff0c;&#x89e3;&#x7801; ByteBuf =&gt; String\n    \n*   6 &#x5904;&#xff0c;SocketChannel &#x7684;&#x4e1a;&#x52a1;&#x5904;&#x7406;&#x5668;&#xff0c;&#x4f7f;&#x7528;&#x4e0a;&#x4e00;&#x4e2a;&#x5904;&#x7406;&#x5668;&#x7684;&#x5904;&#x7406;&#x7ed3;&#x679c;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1647,1662"}}],"payload":{"tag":"h3","lines":"1623,1624"}},{"content":"2.2.2&#x3001;&#x5ba2;&#x6237;&#x7aef;","children":[{"content":"<pre data-lines=\"1668,1684\"><code class=\"language-java\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>())\n    .channel(NioSocketChannel.class)\n    .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;Channel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(Channel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>());\n        }\n    })\n    .connect(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">8080</span>)\n    .sync()\n    .channel()\n    .writeAndFlush(<span class=\"hljs-string\">&quot;Hello,Server&quot;</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1668,1684"}},{"content":"<pre data-lines=\"1685,1706\"><code>&#x4ee3;&#x7801;&#x89e3;&#x8bfb;\n\n*   1 &#x5904;&#xff0c;&#x521b;&#x5efa; NioEventLoopGroup&#xff0c;&#x540c; Server\n    \n*   2 &#x5904;&#xff0c;&#x9009;&#x62e9;&#x5ba2;&#x6237; Socket &#x5b9e;&#x73b0;&#x7c7b;&#xff0c;NioSocketChannel &#x8868;&#x793a;&#x57fa;&#x4e8e; NIO &#x7684;&#x5ba2;&#x6237;&#x7aef;&#x5b9e;&#x73b0;&#xff0c;&#x5176;&#x5b83;&#x5b9e;&#x73b0;&#x8fd8;&#x6709;\n    \n    ![](https://img-blog.csdnimg.cn/img_convert/0f9f600fd36868c374eb026c245dc202.png)\n    \n*   3 &#x5904;&#xff0c;&#x6dfb;&#x52a0; SocketChannel &#x7684;&#x5904;&#x7406;&#x5668;&#xff0c;ChannelInitializer &#x5904;&#x7406;&#x5668;&#xff08;&#x4ec5;&#x6267;&#x884c;&#x4e00;&#x6b21;&#xff09;&#xff0c;&#x5b83;&#x7684;&#x4f5c;&#x7528;&#x662f;&#x5f85;&#x5ba2;&#x6237;&#x7aef; SocketChannel &#x5efa;&#x7acb;&#x8fde;&#x63a5;&#x540e;&#xff0c;&#x6267;&#x884c; initChannel &#x4ee5;&#x4fbf;&#x6dfb;&#x52a0;&#x66f4;&#x591a;&#x7684;&#x5904;&#x7406;&#x5668;\n    \n*   4 &#x5904;&#xff0c;&#x6307;&#x5b9a;&#x8981;&#x8fde;&#x63a5;&#x7684;&#x670d;&#x52a1;&#x5668;&#x548c;&#x7aef;&#x53e3;\n    \n*   5 &#x5904;&#xff0c;Netty &#x4e2d;&#x5f88;&#x591a;&#x65b9;&#x6cd5;&#x90fd;&#x662f;&#x5f02;&#x6b65;&#x7684;&#xff0c;&#x5982; connect&#xff0c;&#x8fd9;&#x65f6;&#x9700;&#x8981;&#x4f7f;&#x7528; sync &#x65b9;&#x6cd5;&#x7b49;&#x5f85; connect &#x5efa;&#x7acb;&#x8fde;&#x63a5;&#x5b8c;&#x6bd5;\n    \n*   6 &#x5904;&#xff0c;&#x83b7;&#x53d6; channel &#x5bf9;&#x8c61;&#xff0c;&#x5b83;&#x5373;&#x4e3a;&#x901a;&#x9053;&#x62bd;&#x8c61;&#xff0c;&#x53ef;&#x4ee5;&#x8fdb;&#x884c;&#x6570;&#x636e;&#x8bfb;&#x5199;&#x64cd;&#x4f5c;\n    \n*   7 &#x5904;&#xff0c;&#x5199;&#x5165;&#x6d88;&#x606f;&#x5e76;&#x6e05;&#x7a7a;&#x7f13;&#x51b2;&#x533a;\n    \n*   8 &#x5904;&#xff0c;&#x6d88;&#x606f;&#x4f1a;&#x7ecf;&#x8fc7;&#x901a;&#x9053; handler &#x5904;&#x7406;&#xff0c;&#x8fd9;&#x91cc;&#x662f;&#x5c06; String =&gt; ByteBuf &#x53d1;&#x51fa;\n    \n*   &#x6570;&#x636e;&#x7ecf;&#x8fc7;&#x7f51;&#x7edc;&#x4f20;&#x8f93;&#xff0c;&#x5230;&#x8fbe;&#x670d;&#x52a1;&#x5668;&#x7aef;&#xff0c;&#x670d;&#x52a1;&#x5668;&#x7aef; 5 &#x548c; 6 &#x5904;&#x7684; handler &#x5148;&#x540e;&#x88ab;&#x89e6;&#x53d1;&#xff0c;&#x8d70;&#x5b8c;&#x4e00;&#x4e2a;&#x6d41;&#x7a0b;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1685,1706"}}],"payload":{"tag":"h3","lines":"1664,1665"}},{"content":"2.2.3&#x3001;&#x63a7;&#x5236;&#x53f0;","children":[{"content":"<pre data-lines=\"1710,1711\"><code>HelloServer\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1710,1711"}},{"content":"<pre data-lines=\"1712,1716\"><code class=\"language-java\">HelloServer\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1712,1716"}}],"payload":{"tag":"h3","lines":"1708,1709"}},{"content":"2.2.4&#x3001;&#x6d41;&#x7a0b;&#x56fe;","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/6986200508112bacf162ad935dde9857.png\" alt>","children":[],"payload":{"tag":"img","lines":"1719,1720"}}],"payload":{"tag":"h3","lines":"1717,1718"}}],"payload":{"tag":"h2","lines":"1610,1612"}},{"content":"2.3&#x3001;&#x5e38;&#x7528;&#x7ec4;&#x4ef6;","children":[{"content":"2.3.1&#x3001;EventLoop &amp; EventLoopGroup","children":[{"content":"2.3.1.1&#x3001;&#x4e24;&#x5bf9;&#x8c61;&#x4ecb;&#x7ecd;","children":[{"content":"<pre data-lines=\"1728,1742\"><code>&#x4e8b;&#x4ef6;&#x5faa;&#x73af;&#x5bf9;&#x8c61;&#xff1a;EventLoop &#x672c;&#x8d28;&#x662f;&#x4e00;&#x4e2a;&#x5355;&#x7ebf;&#x7a0b;&#x6267;&#x884c;&#x5668;&#xff08;&#x540c;&#x65f6;&#x7ef4;&#x62a4;&#x4e86;&#x4e00;&#x4e2a; Selector&#xff09;&#xff0c;&#x91cc;&#x9762;&#x6709; run &#x65b9;&#x6cd5;&#x5904;&#x7406; Channel &#x4e0a;&#x6e90;&#x6e90;&#x4e0d;&#x65ad;&#x7684; io &#x4e8b;&#x4ef6;&#x3002;&#x5b83;&#x7684;&#x7ee7;&#x627f;&#x5173;&#x7cfb;&#x6bd4;&#x8f83;&#x590d;&#x6742;&#xff1a;\n\n*   &#x4e00;&#x6761;&#x7ebf;&#x662f;&#x7ee7;&#x627f;&#x81ea; j.u.c.ScheduledExecutorService &#x56e0;&#x6b64;&#x5305;&#x542b;&#x4e86;&#x7ebf;&#x7a0b;&#x6c60;&#x4e2d;&#x6240;&#x6709;&#x7684;&#x65b9;&#x6cd5;\n*   &#x53e6;&#x4e00;&#x6761;&#x7ebf;&#x662f;&#x7ee7;&#x627f;&#x81ea; netty &#x81ea;&#x5df1;&#x7684; OrderedEventExecutor&#xff0c;\n    *   &#x63d0;&#x4f9b;&#x4e86; boolean inEventLoop(Thread thread) &#x65b9;&#x6cd5;&#x5224;&#x65ad;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x662f;&#x5426;&#x5c5e;&#x4e8e;&#x6b64; EventLoop\n    *   &#x63d0;&#x4f9b;&#x4e86; parent &#x65b9;&#x6cd5;&#x6765;&#x770b;&#x770b;&#x81ea;&#x5df1;&#x5c5e;&#x4e8e;&#x54ea;&#x4e2a; EventLoopGroup\n\n&#x4e8b;&#x4ef6;&#x5faa;&#x73af;&#x7ec4;&#x5bf9;&#x8c61;&#xff1a;EventLoopGroup &#x662f;&#x4e00;&#x7ec4; EventLoop&#xff0c;Channel &#x4e00;&#x822c;&#x4f1a;&#x8c03;&#x7528; EventLoopGroup &#x7684; register &#x65b9;&#x6cd5;&#x6765;&#x7ed1;&#x5b9a;&#x5176;&#x4e2d;&#x4e00;&#x4e2a; EventLoop&#xff0c;&#x540e;&#x7eed;&#x8fd9;&#x4e2a; Channel &#x4e0a;&#x7684; io &#x4e8b;&#x4ef6;&#x90fd;&#x7531;&#x6b64; EventLoop &#x6765;&#x5904;&#x7406;&#xff08;&#x4fdd;&#x8bc1;&#x4e86; io &#x4e8b;&#x4ef6;&#x5904;&#x7406;&#x65f6;&#x7684;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;&#xff09;\n\n*   &#x7ee7;&#x627f;&#x81ea; netty &#x81ea;&#x5df1;&#x7684; EventExecutorGroup\n    *   &#x5b9e;&#x73b0;&#x4e86; Iterable &#x63a5;&#x53e3;&#x63d0;&#x4f9b;&#x904d;&#x5386; EventLoop &#x7684;&#x80fd;&#x529b;\n    *   &#x53e6;&#x6709; next &#x65b9;&#x6cd5;&#x83b7;&#x53d6;&#x96c6;&#x5408;&#x4e2d;&#x4e0b;&#x4e00;&#x4e2a; EventLoop\n\n&#x4ee5;&#x4e00;&#x4e2a;&#x7b80;&#x5355;&#x7684;&#x5b9e;&#x73b0;&#x4e3a;&#x4f8b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1728,1742"}},{"content":"<pre data-lines=\"1743,1751\"><code class=\"language-java\">\n<span class=\"hljs-type\">DefaultEventLoopGroup</span> <span class=\"hljs-variable\">group</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoopGroup</span>(<span class=\"hljs-number\">2</span>);\nSystem.out.println(group.next());\nSystem.out.println(group.next());\nSystem.out.println(group.next());\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1743,1751"}},{"content":"<pre data-lines=\"1752,1753\"><code>&#x8f93;&#x51fa;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1752,1753"}},{"content":"<pre data-lines=\"1754,1760\"><code data-lines=\"1754,1760\">io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.channel</span>.DefaultEventLoop@<span class=\"hljs-number\">60</span>f82f98\nio<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.channel</span>.DefaultEventLoop@<span class=\"hljs-number\">35</span>f983a6\nio<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.channel</span>.DefaultEventLoop@<span class=\"hljs-number\">60</span>f82f98\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1754,1760"}},{"content":"<pre data-lines=\"1761,1762\"><code>&#x4e5f;&#x53ef;&#x4ee5;&#x7528;&#x589e;&#x5f3a; for &#x5faa;&#x73af;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1761,1762"}},{"content":"<pre data-lines=\"1763,1770\"><code class=\"language-java\"><span class=\"hljs-type\">DefaultEventLoopGroup</span> <span class=\"hljs-variable\">group</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoopGroup</span>(<span class=\"hljs-number\">2</span>);\n<span class=\"hljs-keyword\">for</span> (EventExecutor eventLoop : group) {\n    System.out.println(eventLoop);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1763,1770"}},{"content":"<pre data-lines=\"1771,1772\"><code>&#x8f93;&#x51fa;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1771,1772"}},{"content":"<pre data-lines=\"1773,1778\"><code data-lines=\"1773,1778\">io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.channel</span>.DefaultEventLoop@<span class=\"hljs-number\">60</span>f82f98\nio<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.channel</span>.DefaultEventLoop@<span class=\"hljs-number\">35</span>f983a6\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1773,1778"}},{"content":"<pre data-lines=\"1779,1780\"><code>&gt; &#x6ce8;&#x610f;&#xff1a;&#x4f18;&#x96c5;&#x5173;&#x95ed; `shutdownGracefully` &#x65b9;&#x6cd5;&#x3002;&#x8be5;&#x65b9;&#x6cd5;&#x4f1a;&#x9996;&#x5148;&#x5207;&#x6362; `EventLoopGroup` &#x5230;&#x5173;&#x95ed;&#x72b6;&#x6001;&#x4ece;&#x800c;&#x62d2;&#x7edd;&#x65b0;&#x7684;&#x4efb;&#x52a1;&#x7684;&#x52a0;&#x5165;&#xff0c;&#x7136;&#x540e;&#x5728;&#x4efb;&#x52a1;&#x961f;&#x5217;&#x7684;&#x4efb;&#x52a1;&#x90fd;&#x5904;&#x7406;&#x5b8c;&#x6210;&#x540e;&#xff0c;&#x505c;&#x6b62;&#x7ebf;&#x7a0b;&#x7684;&#x8fd0;&#x884c;&#x3002;&#x4ece;&#x800c;&#x786e;&#x4fdd;&#x6574;&#x4f53;&#x5e94;&#x7528;&#x662f;&#x5728;&#x6b63;&#x5e38;&#x6709;&#x5e8f;&#x7684;&#x72b6;&#x6001;&#x4e0b;&#x9000;&#x51fa;&#x7684;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1779,1780"}}],"payload":{"tag":"h4","lines":"1726,1727"}},{"content":"2.3.1.2&#x3001;&#x5904;&#x7406; io &#x4e8b;&#x4ef6;&#xff08;&#x4e24;&#x4e2a;nio worker&#xff09;","children":[{"content":"<pre data-lines=\"1783,1784\"><code>&#x670d;&#x52a1;&#x7aef;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1783,1784"}},{"content":"<pre data-lines=\"1785,1804\"><code class=\"language-java\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">1</span>), <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">2</span>))\n    .channel(NioServerSocketChannel.class)\n    .childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringDecoder</span>());\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> {\n                    log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, msg);\n                }\n            });\n        }\n    })\n    .bind(<span class=\"hljs-number\">8080</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1785,1804"}},{"content":"<pre data-lines=\"1805,1806\"><code>&#x5ba2;&#x6237;&#x7aef;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1805,1806"}},{"content":"<pre data-lines=\"1807,1827\"><code class=\"language-java\"><span class=\"hljs-type\">Channel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>())\n    .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>());\n        }\n    })\n    .channel(NioSocketChannel.class).connect(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">8080</span>)\n    .sync()\n    .channel();\n\nchannel.writeAndFlush(<span class=\"hljs-string\">&quot;zhangsan&quot;</span>);\nThread.sleep(<span class=\"hljs-number\">2000</span>);\nchannel.writeAndFlush(<span class=\"hljs-string\">&quot;lisi&quot;</span>);\nThread.sleep(<span class=\"hljs-number\">2000</span>);\nchannel.writeAndFlush(<span class=\"hljs-string\">&quot;wangwu&quot;</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1807,1827"}},{"content":"<pre data-lines=\"1828,1831\"><code>&#x63a7;&#x5236;&#x53f0;&#xff1a;\n\nNioEventLoopServer1\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1828,1831"}},{"content":"<pre data-lines=\"1832,1844\"><code class=\"language-java\">22:02:54 [DEBUG] [nioEventLoopGroup-3-1] i.g.c.n.NioEventLoopServer1 - zhangsan\n22:02:56 [DEBUG] [nioEventLoopGroup-3-1] i.g.c.n.NioEventLoopServer1 - lisi\n22:02:58 [DEBUG] [nioEventLoopGroup-3-1] i.g.c.n.NioEventLoopServer1 - wangwu\n22:03:24 [DEBUG] [nioEventLoopGroup-3-2] i.g.c.n.NioEventLoopServer1 - zhangsan\n22:03:26 [DEBUG] [nioEventLoopGroup-3-2] i.g.c.n.NioEventLoopServer1 - lisi\n22:03:28 [DEBUG] [nioEventLoopGroup-3-2] i.g.c.n.NioEventLoopServer1 - wangwu\n22:03:34 [DEBUG] [nioEventLoopGroup-3-1] i.g.c.n.NioEventLoopServer1 - zhangsan\n22:03:36 [DEBUG] [nioEventLoopGroup-3-1] i.g.c.n.NioEventLoopServer1 - lisi\n22:03:38 [DEBUG] [nioEventLoopGroup-3-1] i.g.c.n.NioEventLoopServer1 - wangwu\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1832,1844"}},{"content":"<pre data-lines=\"1845,1850\"><code>NioEventLoopClient\n\n&#x5f00;&#x542f;&#x591a;&#x4e2a; NioEventLoopClient &#x5e76;&#x884c;&#x6267;&#x884c;&#x3002;\n\n&#x53ef;&#x4ee5;&#x770b;&#x5230;&#x4e24;&#x4e2a;&#x5de5;&#x4eba;&#x8f6e;&#x6d41;&#x5904;&#x7406; channel&#xff0c;&#x4f46;&#x5de5;&#x4eba;&#x4e0e; channel &#x4e4b;&#x95f4;&#x8fdb;&#x884c;&#x4e86;&#x7ed1;&#x5b9a;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1845,1850"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/bebd9d4743d7843d6806535b4b0bbcd3.png\" alt>","children":[],"payload":{"tag":"img","lines":"1851,1852"}}],"payload":{"tag":"h4","lines":"1781,1782"}},{"content":"2.3.1.3&#x3001;&#x5904;&#x7406; io &#x4e8b;&#x4ef6;&#xff08;&#x4e24;&#x4e2a;&#x975e;nio worker&#xff09;","children":[{"content":"<pre data-lines=\"1855,1856\"><code>&#x670d;&#x52a1;&#x7aef;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1855,1856"}},{"content":"<pre data-lines=\"1857,1878\"><code class=\"language-java\"><span class=\"hljs-type\">DefaultEventLoopGroup</span> <span class=\"hljs-variable\">normalWorkers</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoopGroup</span>(<span class=\"hljs-number\">2</span>);\n\n<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">1</span>), <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">2</span>))\n    .channel(NioServerSocketChannel.class)\n    .childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringDecoder</span>());\n            ch.pipeline().addLast(normalWorkers, <span class=\"hljs-string\">&quot;myhandler&quot;</span>, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> {\n                    log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, msg);\n                }\n            });\n        }\n    })\n    .bind(<span class=\"hljs-number\">8080</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1857,1878"}},{"content":"<pre data-lines=\"1879,1880\"><code>&#x5ba2;&#x6237;&#x7aef;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1879,1880"}},{"content":"<pre data-lines=\"1881,1901\"><code class=\"language-java\"><span class=\"hljs-type\">Channel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>())\n    .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>());\n        }\n    })\n    .channel(NioSocketChannel.class).connect(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">8080</span>)\n    .sync()\n    .channel();\n\nchannel.writeAndFlush(<span class=\"hljs-string\">&quot;zhangsan&quot;</span>);\nThread.sleep(<span class=\"hljs-number\">2000</span>);\nchannel.writeAndFlush(<span class=\"hljs-string\">&quot;lisi&quot;</span>);\nThread.sleep(<span class=\"hljs-number\">2000</span>);\nchannel.writeAndFlush(<span class=\"hljs-string\">&quot;wangwu&quot;</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1881,1901"}},{"content":"<pre data-lines=\"1902,1903\"><code>&#x63a7;&#x5236;&#x53f0;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1902,1903"}},{"content":"<pre data-lines=\"1906,1918\"><code class=\"language-java\">22:25:27 [DEBUG] [defaultEventLoopGroup-2-1] i.g.c.n.NioEventLoopServer2 - zhangsan\n22:25:29 [DEBUG] [defaultEventLoopGroup-2-1] i.g.c.n.NioEventLoopServer2 - lisi\n22:25:31 [DEBUG] [defaultEventLoopGroup-2-1] i.g.c.n.NioEventLoopServer2 - wangwu\n22:25:37 [DEBUG] [defaultEventLoopGroup-2-2] i.g.c.n.NioEventLoopServer2 - zhangsan\n22:25:39 [DEBUG] [defaultEventLoopGroup-2-2] i.g.c.n.NioEventLoopServer2 - lisi\n22:25:41 [DEBUG] [defaultEventLoopGroup-2-2] i.g.c.n.NioEventLoopServer2 - wangwu\n22:25:48 [DEBUG] [defaultEventLoopGroup-2-1] i.g.c.n.NioEventLoopServer2 - zhangsan\n22:25:50 [DEBUG] [defaultEventLoopGroup-2-1] i.g.c.n.NioEventLoopServer2 - lisi\n22:25:52 [DEBUG] [defaultEventLoopGroup-2-1] i.g.c.n.NioEventLoopServer2 - wangwu\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1906,1918"}},{"content":"<pre data-lines=\"1919,1924\"><code>NioEventLoopClient\n\n&#x5f00;&#x542f;&#x591a;&#x4e2a; NioEventLoopClient &#x5e76;&#x884c;&#x6267;&#x884c;&#x3002;\n\n&#x53ef;&#x4ee5;&#x770b;&#x5230;&#x4e24;&#x4e2a;&#x5de5;&#x4eba;&#x8f6e;&#x6d41;&#x5904;&#x7406; channel&#xff0c;&#x4f46;&#x5de5;&#x4eba;&#x4e0e; channel &#x4e4b;&#x95f4;&#x8fdb;&#x884c;&#x4e86;&#x7ed1;&#x5b9a;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1919,1924"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b50949993ec5edd1efc5d5f360824709.png\" alt>","children":[],"payload":{"tag":"img","lines":"1925,1926"}}],"payload":{"tag":"h4","lines":"1853,1854"}},{"content":"2.3.1.4&#x3001;&#x5904;&#x7406;&#x666e;&#x901a;&#x4efb;&#x52a1;","children":[{"content":"<pre data-lines=\"1929,1930\"><code>NioEventLoop &#x9664;&#x4e86;&#x53ef;&#x4ee5;&#x5904;&#x7406; io &#x4e8b;&#x4ef6;&#xff0c;&#x540c;&#x6837;&#x53ef;&#x4ee5;&#x5411;&#x5b83;&#x63d0;&#x4ea4;&#x666e;&#x901a;&#x4efb;&#x52a1;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1929,1930"}},{"content":"<pre data-lines=\"1931,1941\"><code class=\"language-java\"><span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">nioWorkers</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">2</span>);\n\nlog.debug(<span class=\"hljs-string\">&quot;server start...&quot;</span>);\nThread.sleep(<span class=\"hljs-number\">2000</span>);\nnioWorkers.execute(()-&gt;{\n    log.debug(<span class=\"hljs-string\">&quot;normal task...&quot;</span>);\n});\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1931,1941"}},{"content":"<pre data-lines=\"1942,1943\"><code>&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1942,1943"}},{"content":"<pre data-lines=\"1944,1949\"><code data-lines=\"1944,1949\"><span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">30</span>:<span class=\"hljs-number\">36</span> [<span class=\"hljs-symbol\">DEBUG</span>] [main] c.i.o.<span class=\"hljs-symbol\">EventLoopTest2</span> - server start...\n<span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">30</span>:<span class=\"hljs-number\">38</span> [<span class=\"hljs-symbol\">DEBUG</span>] [nioEventLoopGroup<span class=\"hljs-number\">-2</span><span class=\"hljs-number\">-1</span>] c.i.o.<span class=\"hljs-symbol\">EventLoopTest2</span> - normal task...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1944,1949"}},{"content":"<pre data-lines=\"1950,1951\"><code>&gt; &#x53ef;&#x4ee5;&#x7528;&#x6765;&#x6267;&#x884c;&#x8017;&#x65f6;&#x8f83;&#x957f;&#x7684;&#x4efb;&#x52a1;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1950,1951"}}],"payload":{"tag":"h4","lines":"1927,1928"}},{"content":"2.3.1.5&#x3001;&#x5904;&#x7406;&#x5b9a;&#x65f6;&#x4efb;&#x52a1;","children":[{"content":"<pre data-lines=\"1954,1955\"><code>NioEventLoop &#x9664;&#x4e86;&#x53ef;&#x4ee5;&#x5904;&#x7406; io &#x4e8b;&#x4ef6;&#xff0c;&#x540c;&#x6837;&#x53ef;&#x4ee5;&#x5411;&#x5b83;&#x63d0;&#x4ea4;&#x5b9a;&#x65f6;&#x4efb;&#x52a1;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1954,1955"}},{"content":"<pre data-lines=\"1956,1966\"><code class=\"language-java\"><span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">nioWorkers</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">2</span>);\n\nlog.debug(<span class=\"hljs-string\">&quot;server start...&quot;</span>);\nThread.sleep(<span class=\"hljs-number\">2000</span>);\nnioWorkers.scheduleAtFixedRate(() -&gt; {\n    log.debug(<span class=\"hljs-string\">&quot;running...&quot;</span>);\n}, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, TimeUnit.SECONDS);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1956,1966"}},{"content":"<pre data-lines=\"1967,1968\"><code>&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1967,1968"}},{"content":"<pre data-lines=\"1969,1978\"><code data-lines=\"1969,1978\"><span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">35</span>:<span class=\"hljs-number\">15</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[main]</span> c<span class=\"hljs-selector-class\">.i</span><span class=\"hljs-selector-class\">.o</span><span class=\"hljs-selector-class\">.EventLoopTest2</span> - server start...\n<span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">35</span>:<span class=\"hljs-number\">17</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[nioEventLoopGroup-2-1]</span> c<span class=\"hljs-selector-class\">.i</span><span class=\"hljs-selector-class\">.o</span><span class=\"hljs-selector-class\">.EventLoopTest2</span> - running...\n<span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">35</span>:<span class=\"hljs-number\">18</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[nioEventLoopGroup-2-1]</span> c<span class=\"hljs-selector-class\">.i</span><span class=\"hljs-selector-class\">.o</span><span class=\"hljs-selector-class\">.EventLoopTest2</span> - running...\n<span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">35</span>:<span class=\"hljs-number\">19</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[nioEventLoopGroup-2-1]</span> c<span class=\"hljs-selector-class\">.i</span><span class=\"hljs-selector-class\">.o</span><span class=\"hljs-selector-class\">.EventLoopTest2</span> - running...\n<span class=\"hljs-number\">22</span>:<span class=\"hljs-number\">35</span>:<span class=\"hljs-number\">20</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[nioEventLoopGroup-2-1]</span> c<span class=\"hljs-selector-class\">.i</span><span class=\"hljs-selector-class\">.o</span><span class=\"hljs-selector-class\">.EventLoopTest2</span> - running...\n...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1969,1978"}},{"content":"<pre data-lines=\"1979,1980\"><code>&gt; &#x53ef;&#x4ee5;&#x7528;&#x6765;&#x6267;&#x884c;&#x5b9a;&#x65f6;&#x4efb;&#x52a1;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1979,1980"}}],"payload":{"tag":"h4","lines":"1952,1953"}}],"payload":{"tag":"h3","lines":"1724,1725"}},{"content":"2.3.2&#x3001;Channel &amp; ChannelFuture","children":[{"content":"<pre data-lines=\"1984,1993\"><code>channel &#x7684;&#x4e3b;&#x8981;&#x4f5c;&#x7528;\n\n*   close() &#x53ef;&#x4ee5;&#x7528;&#x6765;&#x5173;&#x95ed; channel\n*   closeFuture() &#x7528;&#x6765;&#x5904;&#x7406; channel &#x7684;&#x5173;&#x95ed;\n    *   sync &#x65b9;&#x6cd5;&#x4f5c;&#x7528;&#x662f;&#x540c;&#x6b65;&#x7b49;&#x5f85; channel &#x5173;&#x95ed;\n    *   &#x800c; addListener &#x65b9;&#x6cd5;&#x662f;&#x5f02;&#x6b65;&#x7b49;&#x5f85; channel &#x5173;&#x95ed;\n*   pipeline() &#x65b9;&#x6cd5;&#x6dfb;&#x52a0;&#x5904;&#x7406;&#x5668;\n*   write() &#x65b9;&#x6cd5;&#x5c06;&#x6570;&#x636e;&#x5199;&#x5165;\n*   writeAndFlush() &#x65b9;&#x6cd5;&#x5c06;&#x6570;&#x636e;&#x5199;&#x5165;&#x5e76;&#x5237;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1984,1993"}},{"content":"2.3.2.1&#x3001;&#x7b2c;&#x4e00;&#x79cd;&#x4f18;&#x96c5;&#x91ca;&#x653e;&#x65b9;&#x5f0f;&#xff1a;&#x540c;&#x6b65;","children":[{"content":"<pre data-lines=\"1996,2031\"><code class=\"language-java\"><span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">group</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n<span class=\"hljs-type\">Channel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n        .group(group)\n        .channel(NioSocketChannel.class)\n        .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;Channel&gt;() {\n            <span class=\"hljs-meta\">@Override</span>\n            <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(Channel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n                ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>());\n            }\n        })\n        .connect(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">8080</span>)\n        .sync()\n        .channel();\n\n\n<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(()-&gt;{\n    <span class=\"hljs-type\">Scanner</span> <span class=\"hljs-variable\">scanner</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Scanner</span>(System.in);\n    <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">line</span> <span class=\"hljs-operator\">=</span> scanner.nextLine();\n        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">&quot;q&quot;</span>.equals(line)) {\n            channel.close();\n            <span class=\"hljs-keyword\">break</span>;\n        }\n        channel.writeAndFlush(line);\n    }\n}, <span class=\"hljs-string\">&quot;input-thread&quot;</span>).start();\n\n\n<span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">closeFuture</span> <span class=\"hljs-operator\">=</span> channel.closeFuture();\ncloseFuture.sync();\nlog.debug(<span class=\"hljs-string\">&quot;&#x5904;&#x7406;&#x5173;&#x95ed;&#x4e4b;&#x540e;&#x7684;&#x64cd;&#x4f5c;&quot;</span>);\ngroup.shutdownGracefully();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1996,2031"}},{"content":"<pre data-lines=\"2032,2040\"><code class=\"language-java\">123\n456\n789\nq\n16:56:23 [DEBUG] [main] i.g.c.n.ChannelClient - &#x5904;&#x7406;&#x5173;&#x95ed;&#x4e4b;&#x540e;&#x7684;&#x64cd;&#x4f5c;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2032,2040"}}],"payload":{"tag":"h4","lines":"1994,1995"}},{"content":"2.3.2.2&#x3001;&#x7b2c;&#x4e8c;&#x79cd;&#x4f18;&#x96c5;&#x91ca;&#x653e;&#x65b9;&#x5f0f;&#xff1a;&#x5f02;&#x6b65;","children":[{"content":"<pre data-lines=\"2043,2082\"><code class=\"language-java\"><span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">group</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n<span class=\"hljs-type\">Channel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n        .group(group)\n        .channel(NioSocketChannel.class)\n        .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;Channel&gt;() {\n            <span class=\"hljs-meta\">@Override</span>\n            <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(Channel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n                ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>());\n            }\n        })\n        .connect(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">8080</span>)\n        .sync()\n        .channel();\n\n\n<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n    <span class=\"hljs-type\">Scanner</span> <span class=\"hljs-variable\">scanner</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Scanner</span>(System.in);\n    <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">line</span> <span class=\"hljs-operator\">=</span> scanner.nextLine();\n        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">&quot;q&quot;</span>.equals(line)) {\n            channel.close();\n            <span class=\"hljs-keyword\">break</span>;\n        }\n        channel.writeAndFlush(line);\n    }\n}, <span class=\"hljs-string\">&quot;input-thread&quot;</span>).start();\n\n\n<span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">closeFuture</span> <span class=\"hljs-operator\">=</span> channel.closeFuture();\ncloseFuture.addListener(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">GenericFutureListener</span>&lt;Future&lt;? <span class=\"hljs-built_in\">super</span> Void&gt;&gt;() {\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">operationComplete</span><span class=\"hljs-params\">(Future&lt;? <span class=\"hljs-built_in\">super</span> Void&gt; future)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        log.debug(<span class=\"hljs-string\">&quot;&#x5904;&#x7406;&#x5173;&#x95ed;&#x4e4b;&#x540e;&#x7684;&#x64cd;&#x4f5c;&quot;</span>);\n        group.shutdownGracefully();\n    }\n});\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2043,2082"}},{"content":"<pre data-lines=\"2083,2091\"><code class=\"language-java\">123\n456\n789\nq\n16:55:06 [DEBUG] [nioEventLoopGroup-2-1] i.g.c.n.ChannelClient - &#x5904;&#x7406;&#x5173;&#x95ed;&#x4e4b;&#x540e;&#x7684;&#x64cd;&#x4f5c;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2083,2091"}}],"payload":{"tag":"h4","lines":"2041,2042"}}],"payload":{"tag":"h3","lines":"1981,1982"}},{"content":"2.3.3&#x3001;Future &amp; Promise","children":[{"content":"2.3.3.1&#x3001;&#x540c;&#x6b65;&#x5904;&#x7406;&#x4efb;&#x52a1;&#x6210;&#x529f;","children":[{"content":"<pre data-lines=\"2118,2137\"><code class=\"language-java\"><span class=\"hljs-type\">DefaultEventLoop</span> <span class=\"hljs-variable\">eventExecutors</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoop</span>();\nDefaultPromise&lt;Integer&gt; promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultPromise</span>&lt;&gt;(eventExecutors);\n\neventExecutors.execute(()-&gt;{\n    <span class=\"hljs-keyword\">try</span> {\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n    log.debug(<span class=\"hljs-string\">&quot;set success, {}&quot;</span>,<span class=\"hljs-number\">10</span>);\n    promise.setSuccess(<span class=\"hljs-number\">10</span>);\n});\n\nlog.debug(<span class=\"hljs-string\">&quot;start...&quot;</span>);\nlog.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>,promise.getNow()); \nlog.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>,promise.get());\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2118,2137"}},{"content":"<pre data-lines=\"2138,2145\"><code data-lines=\"2138,2145\"><span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">09</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[main]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - start...\n<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">09</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[main]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - null\n<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">10</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[defaultEventLoop-1-1]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - set success, <span class=\"hljs-number\">10</span>\n<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">10</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[main]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - <span class=\"hljs-number\">10</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2138,2145"}}],"payload":{"tag":"h4","lines":"2116,2117"}},{"content":"2.3.3.2&#x3001;&#x5f02;&#x6b65;&#x5904;&#x7406;&#x4efb;&#x52a1;&#x6210;&#x529f;","children":[{"content":"<pre data-lines=\"2148,2172\"><code class=\"language-java\"><span class=\"hljs-type\">DefaultEventLoop</span> <span class=\"hljs-variable\">eventExecutors</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoop</span>();\nDefaultPromise&lt;Integer&gt; promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultPromise</span>&lt;&gt;(eventExecutors);\n\n\npromise.addListener(future -&gt; {\n    \n    log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>,future.getNow());\n});\n\n\neventExecutors.execute(()-&gt;{\n    <span class=\"hljs-keyword\">try</span> {\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n    log.debug(<span class=\"hljs-string\">&quot;set success, {}&quot;</span>,<span class=\"hljs-number\">10</span>);\n    promise.setSuccess(<span class=\"hljs-number\">10</span>);\n});\n\nlog.debug(<span class=\"hljs-string\">&quot;start...&quot;</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2148,2172"}},{"content":"<pre data-lines=\"2173,2179\"><code data-lines=\"2173,2179\"><span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">43</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[main]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - start...\n<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">44</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[defaultEventLoop-1-1]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - set success, <span class=\"hljs-number\">10</span>\n<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">10</span>:<span class=\"hljs-number\">44</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[defaultEventLoop-1-1]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - <span class=\"hljs-number\">10</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2173,2179"}}],"payload":{"tag":"h4","lines":"2146,2147"}},{"content":"2.3.3.3&#x3001;&#x540c;&#x6b65;&#x5904;&#x7406;&#x4efb;&#x52a1;&#x5931;&#x8d25;","children":[{"content":"<pre data-lines=\"2182,2202\"><code class=\"language-java\"><span class=\"hljs-type\">DefaultEventLoop</span> <span class=\"hljs-variable\">eventExecutors</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoop</span>();\nDefaultPromise&lt;Integer&gt; promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultPromise</span>&lt;&gt;(eventExecutors);\n\neventExecutors.execute(() -&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n    <span class=\"hljs-type\">RuntimeException</span> <span class=\"hljs-variable\">e</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RuntimeException</span>(<span class=\"hljs-string\">&quot;error...&quot;</span>);\n    log.debug(<span class=\"hljs-string\">&quot;set failure, {}&quot;</span>, e.toString());\n    promise.setFailure(e);\n});\n\nlog.debug(<span class=\"hljs-string\">&quot;start...&quot;</span>);\nlog.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, promise.getNow());\npromise.get(); \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2182,2202"}},{"content":"<pre data-lines=\"2203,2219\"><code data-lines=\"2203,2219\"><span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">08</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[main]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - start...\n<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">08</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[main]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - null\n<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">09</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[defaultEventLoop-1-1]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - set failure, java<span class=\"hljs-selector-class\">.lang</span><span class=\"hljs-selector-class\">.RuntimeException</span>: error...\nException <span class=\"hljs-keyword\">in</span> thread <span class=\"hljs-string\">&quot;main&quot;</span> java<span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.ExecutionException</span>: java<span class=\"hljs-selector-class\">.lang</span><span class=\"hljs-selector-class\">.RuntimeException</span>: error...\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.DefaultPromise</span><span class=\"hljs-selector-class\">.get</span>(DefaultPromise<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">350</span>)\n\tat io<span class=\"hljs-selector-class\">.github</span><span class=\"hljs-selector-class\">.caochenlei</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span><span class=\"hljs-selector-class\">.main</span>(Test<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">28</span>)\nCaused by: java<span class=\"hljs-selector-class\">.lang</span><span class=\"hljs-selector-class\">.RuntimeException</span>: error...\n\tat io<span class=\"hljs-selector-class\">.github</span><span class=\"hljs-selector-class\">.caochenlei</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span>.lambda<span class=\"hljs-variable\">&#x24;main</span>&#x24;<span class=\"hljs-number\">0</span>(Test<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">21</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.channel</span><span class=\"hljs-selector-class\">.DefaultEventLoop</span><span class=\"hljs-selector-class\">.run</span>(DefaultEventLoop<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">54</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span>.SingleThreadEventExecutor&#x24;<span class=\"hljs-number\">4</span><span class=\"hljs-selector-class\">.run</span>(SingleThreadEventExecutor<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">989</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.internal</span>.ThreadExecutorMap&#x24;<span class=\"hljs-number\">2</span><span class=\"hljs-selector-class\">.run</span>(ThreadExecutorMap<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">74</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.FastThreadLocalRunnable</span><span class=\"hljs-selector-class\">.run</span>(FastThreadLocalRunnable<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">30</span>)\n\tat java<span class=\"hljs-selector-class\">.lang</span><span class=\"hljs-selector-class\">.Thread</span><span class=\"hljs-selector-class\">.run</span>(Thread<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">748</span>)\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2203,2219"}}],"payload":{"tag":"h4","lines":"2180,2181"}},{"content":"2.3.3.4&#x3001;&#x540c;&#x6b65;&#x5904;&#x7406;&#x4efb;&#x52a1;&#x5931;&#x8d25;","children":[{"content":"<pre data-lines=\"2222,2243\"><code class=\"language-java\"><span class=\"hljs-type\">DefaultEventLoop</span> <span class=\"hljs-variable\">eventExecutors</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoop</span>();\nDefaultPromise&lt;Integer&gt; promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultPromise</span>&lt;&gt;(eventExecutors);\n\neventExecutors.execute(() -&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n    <span class=\"hljs-type\">RuntimeException</span> <span class=\"hljs-variable\">e</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RuntimeException</span>(<span class=\"hljs-string\">&quot;error...&quot;</span>);\n    log.debug(<span class=\"hljs-string\">&quot;set failure, {}&quot;</span>, e.toString());\n    promise.setFailure(e);\n});\n\nlog.debug(<span class=\"hljs-string\">&quot;start...&quot;</span>);\nlog.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, promise.getNow());\npromise.await(); \nlog.debug(<span class=\"hljs-string\">&quot;result {}&quot;</span>, (promise.isSuccess() ? promise.getNow() : promise.cause()).toString());\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2222,2243"}},{"content":"<pre data-lines=\"2244,2251\"><code data-lines=\"2244,2251\"><span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">48</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[main]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - start...\n<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">48</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[main]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - null\n<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">49</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[defaultEventLoop-1-1]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - set failure, java<span class=\"hljs-selector-class\">.lang</span><span class=\"hljs-selector-class\">.RuntimeException</span>: error...\n<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">49</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[main]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - result java<span class=\"hljs-selector-class\">.lang</span><span class=\"hljs-selector-class\">.RuntimeException</span>: error...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2244,2251"}}],"payload":{"tag":"h4","lines":"2220,2221"}},{"content":"2.3.3.5&#x3001;&#x5f02;&#x6b65;&#x5904;&#x7406;&#x4efb;&#x52a1;&#x5931;&#x8d25;","children":[{"content":"<pre data-lines=\"2254,2276\"><code class=\"language-java\"><span class=\"hljs-type\">DefaultEventLoop</span> <span class=\"hljs-variable\">eventExecutors</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoop</span>();\nDefaultPromise&lt;Integer&gt; promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultPromise</span>&lt;&gt;(eventExecutors);\n\npromise.addListener(future -&gt; {\n    log.debug(<span class=\"hljs-string\">&quot;result {}&quot;</span>, (promise.isSuccess() ? promise.getNow() : promise.cause()).toString());\n});\n\neventExecutors.execute(() -&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n    <span class=\"hljs-type\">RuntimeException</span> <span class=\"hljs-variable\">e</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RuntimeException</span>(<span class=\"hljs-string\">&quot;error...&quot;</span>);\n    log.debug(<span class=\"hljs-string\">&quot;set failure, {}&quot;</span>, e.toString());\n    promise.setFailure(e);\n});\n\nlog.debug(<span class=\"hljs-string\">&quot;start...&quot;</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2254,2276"}},{"content":"<pre data-lines=\"2277,2283\"><code data-lines=\"2277,2283\"><span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">12</span>:<span class=\"hljs-number\">14</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[main]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - start...\n<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">12</span>:<span class=\"hljs-number\">15</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[defaultEventLoop-1-1]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - set failure, java<span class=\"hljs-selector-class\">.lang</span><span class=\"hljs-selector-class\">.RuntimeException</span>: error...\n<span class=\"hljs-number\">17</span>:<span class=\"hljs-number\">12</span>:<span class=\"hljs-number\">15</span> <span class=\"hljs-selector-attr\">[DEBUG]</span> <span class=\"hljs-selector-attr\">[defaultEventLoop-1-1]</span> <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.g</span><span class=\"hljs-selector-class\">.c</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span> - result java<span class=\"hljs-selector-class\">.lang</span><span class=\"hljs-selector-class\">.RuntimeException</span>: error...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2277,2283"}}],"payload":{"tag":"h4","lines":"2252,2253"}},{"content":"2.3.3.6&#x3001;await &#x6b7b;&#x9501;&#x68c0;&#x67e5;","children":[{"content":"<pre data-lines=\"2286,2287\"><code>&#x6ce8;&#x610f;&#x4e0d;&#x80fd;&#x4ec5;&#x6355;&#x83b7; InterruptedException &#x5f02;&#x5e38;&#xff0c;&#x5426;&#x5219;&#x6b7b;&#x9501;&#x68c0;&#x67e5;&#x629b;&#x51fa;&#x7684; BlockingOperationException &#x4f1a;&#x7ee7;&#x7eed;&#x5411;&#x4e0a;&#x4f20;&#x64ad;&#xff0c;&#x800c;&#x63d0;&#x4ea4;&#x7684;&#x4efb;&#x52a1;&#x4f1a;&#x88ab;&#x5305;&#x88c5;&#x4e3a; PromiseTask&#xff0c;&#x5b83;&#x7684; run &#x65b9;&#x6cd5;&#x4e2d;&#x4f1a; catch &#x6240;&#x6709;&#x5f02;&#x5e38;&#x7136;&#x540e;&#x8bbe;&#x7f6e;&#x4e3a; Promise &#x5931;&#x8d25;&#x7ed3;&#x679c;&#x800c;&#x4e0d;&#x4f1a;&#x629b;&#x51fa;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2286,2287"}},{"content":"<pre data-lines=\"2288,2313\"><code class=\"language-java\"><span class=\"hljs-type\">DefaultEventLoop</span> <span class=\"hljs-variable\">eventExecutors</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoop</span>();\nDefaultPromise&lt;Integer&gt; promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultPromise</span>&lt;&gt;(eventExecutors);\n\neventExecutors.submit(()-&gt;{\n    System.out.println(<span class=\"hljs-string\">&quot;1&quot;</span>);\n    <span class=\"hljs-keyword\">try</span> {\n        promise.await();\n    } <span class=\"hljs-keyword\">catch</span> (Exception e) { \n        e.printStackTrace();\n    }\n    System.out.println(<span class=\"hljs-string\">&quot;2&quot;</span>);\n});\n\neventExecutors.submit(()-&gt;{\n    System.out.println(<span class=\"hljs-string\">&quot;3&quot;</span>);\n    <span class=\"hljs-keyword\">try</span> {\n        promise.await();\n    } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n        e.printStackTrace();\n    }\n    System.out.println(<span class=\"hljs-string\">&quot;4&quot;</span>);\n});\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2288,2313"}},{"content":"<pre data-lines=\"2314,2339\"><code data-lines=\"2314,2339\">io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.BlockingOperationException</span>: DefaultPromise@<span class=\"hljs-number\">70</span><span class=\"hljs-built_in\">e8f653</span>(incomplete)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.DefaultPromise</span><span class=\"hljs-selector-class\">.checkDeadLock</span>(DefaultPromise<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">462</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.DefaultPromise</span><span class=\"hljs-selector-class\">.await</span>(DefaultPromise<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">247</span>)\n\tat io<span class=\"hljs-selector-class\">.github</span><span class=\"hljs-selector-class\">.caochenlei</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span>.lambda<span class=\"hljs-variable\">&#x24;main</span>&#x24;<span class=\"hljs-number\">0</span>(Test<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">18</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.PromiseTask</span><span class=\"hljs-selector-class\">.runTask</span>(PromiseTask<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">98</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.PromiseTask</span><span class=\"hljs-selector-class\">.run</span>(PromiseTask<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">106</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.channel</span><span class=\"hljs-selector-class\">.DefaultEventLoop</span><span class=\"hljs-selector-class\">.run</span>(DefaultEventLoop<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">54</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span>.SingleThreadEventExecutor&#x24;<span class=\"hljs-number\">4</span><span class=\"hljs-selector-class\">.run</span>(SingleThreadEventExecutor<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">989</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.internal</span>.ThreadExecutorMap&#x24;<span class=\"hljs-number\">2</span><span class=\"hljs-selector-class\">.run</span>(ThreadExecutorMap<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">74</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.FastThreadLocalRunnable</span><span class=\"hljs-selector-class\">.run</span>(FastThreadLocalRunnable<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">30</span>)\n\tat java<span class=\"hljs-selector-class\">.lang</span><span class=\"hljs-selector-class\">.Thread</span><span class=\"hljs-selector-class\">.run</span>(Thread<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">748</span>)\nio<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.BlockingOperationException</span>: DefaultPromise@<span class=\"hljs-number\">70</span><span class=\"hljs-built_in\">e8f653</span>(incomplete)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.DefaultPromise</span><span class=\"hljs-selector-class\">.checkDeadLock</span>(DefaultPromise<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">462</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.DefaultPromise</span><span class=\"hljs-selector-class\">.await</span>(DefaultPromise<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">247</span>)\n\tat io<span class=\"hljs-selector-class\">.github</span><span class=\"hljs-selector-class\">.caochenlei</span><span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.Test</span>.lambda<span class=\"hljs-variable\">&#x24;main</span>&#x24;<span class=\"hljs-number\">1</span>(Test<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">31</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.PromiseTask</span><span class=\"hljs-selector-class\">.runTask</span>(PromiseTask<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">98</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.PromiseTask</span><span class=\"hljs-selector-class\">.run</span>(PromiseTask<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">106</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.channel</span><span class=\"hljs-selector-class\">.DefaultEventLoop</span><span class=\"hljs-selector-class\">.run</span>(DefaultEventLoop<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">54</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span>.SingleThreadEventExecutor&#x24;<span class=\"hljs-number\">4</span><span class=\"hljs-selector-class\">.run</span>(SingleThreadEventExecutor<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">989</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.internal</span>.ThreadExecutorMap&#x24;<span class=\"hljs-number\">2</span><span class=\"hljs-selector-class\">.run</span>(ThreadExecutorMap<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">74</span>)\n\tat io<span class=\"hljs-selector-class\">.netty</span><span class=\"hljs-selector-class\">.util</span><span class=\"hljs-selector-class\">.concurrent</span><span class=\"hljs-selector-class\">.FastThreadLocalRunnable</span><span class=\"hljs-selector-class\">.run</span>(FastThreadLocalRunnable<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">30</span>)\n\tat java<span class=\"hljs-selector-class\">.lang</span><span class=\"hljs-selector-class\">.Thread</span><span class=\"hljs-selector-class\">.run</span>(Thread<span class=\"hljs-selector-class\">.java</span>:<span class=\"hljs-number\">748</span>)\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2314,2339"}}],"payload":{"tag":"h4","lines":"2284,2285"}}],"payload":{"tag":"h3","lines":"2092,2093"}},{"content":"2.3.4&#x3001;Handler &amp; Pipeline","children":[{"content":"<pre data-lines=\"2342,2350\"><code>ChannelHandler &#x7528;&#x6765;&#x5904;&#x7406; Channel &#x4e0a;&#x7684;&#x5404;&#x79cd;&#x4e8b;&#x4ef6;&#xff0c;&#x5206;&#x4e3a;&#x5165;&#x7ad9;&#x3001;&#x51fa;&#x7ad9;&#x4e24;&#x79cd;&#x3002;&#x6240;&#x6709; ChannelHandler &#x88ab;&#x8fde;&#x6210;&#x4e00;&#x4e32;&#xff0c;&#x5c31;&#x662f; Pipeline\n\n*   &#x5165;&#x7ad9;&#x5904;&#x7406;&#x5668;&#x901a;&#x5e38;&#x662f; ChannelInboundHandlerAdapter &#x7684;&#x5b50;&#x7c7b;&#xff0c;&#x4e3b;&#x8981;&#x7528;&#x6765;&#x8bfb;&#x53d6;&#x5ba2;&#x6237;&#x7aef;&#x6570;&#x636e;&#xff0c;&#x5199;&#x56de;&#x7ed3;&#x679c;\n*   &#x51fa;&#x7ad9;&#x5904;&#x7406;&#x5668;&#x901a;&#x5e38;&#x662f; ChannelOutboundHandlerAdapter &#x7684;&#x5b50;&#x7c7b;&#xff0c;&#x4e3b;&#x8981;&#x5bf9;&#x5199;&#x56de;&#x7ed3;&#x679c;&#x8fdb;&#x884c;&#x52a0;&#x5de5;\n\n&#x6253;&#x4e2a;&#x6bd4;&#x55bb;&#xff0c;&#x6bcf;&#x4e2a; Channel &#x662f;&#x4e00;&#x4e2a;&#x4ea7;&#x54c1;&#x7684;&#x52a0;&#x5de5;&#x8f66;&#x95f4;&#xff0c;Pipeline &#x662f;&#x8f66;&#x95f4;&#x4e2d;&#x7684;&#x6d41;&#x6c34;&#x7ebf;&#xff0c;ChannelHandler &#x5c31;&#x662f;&#x6d41;&#x6c34;&#x7ebf;&#x4e0a;&#x7684;&#x5404;&#x9053;&#x5de5;&#x5e8f;&#xff0c;&#x800c;&#x540e;&#x9762;&#x8981;&#x8bb2;&#x7684; ByteBuf &#x662f;&#x539f;&#x6750;&#x6599;&#xff0c;&#x7ecf;&#x8fc7;&#x5f88;&#x591a;&#x5de5;&#x5e8f;&#x7684;&#x52a0;&#x5de5;&#xff1a;&#x5148;&#x7ecf;&#x8fc7;&#x4e00;&#x9053;&#x9053;&#x5165;&#x7ad9;&#x5de5;&#x5e8f;&#xff0c;&#x518d;&#x7ecf;&#x8fc7;&#x4e00;&#x9053;&#x9053;&#x51fa;&#x7ad9;&#x5de5;&#x5e8f;&#x6700;&#x7ec8;&#x53d8;&#x6210;&#x4ea7;&#x54c1;&#x3002;\n\n&#x5148;&#x641e;&#x6e05;&#x695a; Pipeline &#x91cc;&#x7684; ChannelHandler &#x6267;&#x884c;&#x987a;&#x5e8f;&#x987a;&#x5e8f;&#xff0c;&#x6211;&#x4eec;&#x8fd9;&#x91cc;&#x53ea;&#x5173;&#x6ce8;&#x670d;&#x52a1;&#x7aef;&#x7684;&#x4ee3;&#x7801;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2342,2350"}},{"content":"<pre data-lines=\"2351,2404\"><code class=\"language-java\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>()\n        .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>())\n        .channel(NioServerSocketChannel.class)\n        .childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n            <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> {\n                ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                    <span class=\"hljs-meta\">@Override</span>\n                    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> {\n                        System.out.println(<span class=\"hljs-number\">1</span>);\n                        ctx.fireChannelRead(msg); \n                    }\n                });\n                ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                    <span class=\"hljs-meta\">@Override</span>\n                    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> {\n                        System.out.println(<span class=\"hljs-number\">2</span>);\n                        ctx.fireChannelRead(msg); \n                    }\n                });\n                ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                    <span class=\"hljs-meta\">@Override</span>\n                    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> {\n                        System.out.println(<span class=\"hljs-number\">3</span>);\n                        ctx.channel().write(msg); \n                    }\n                });\n                ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelOutboundHandlerAdapter</span>() {\n                    <span class=\"hljs-meta\">@Override</span>\n                    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">write</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> {\n                        System.out.println(<span class=\"hljs-number\">4</span>);\n                        ctx.write(msg, promise); \n                    }\n                });\n                ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelOutboundHandlerAdapter</span>() {\n                    <span class=\"hljs-meta\">@Override</span>\n                    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">write</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> {\n                        System.out.println(<span class=\"hljs-number\">5</span>);\n                        ctx.write(msg, promise); \n                    }\n                });\n                ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelOutboundHandlerAdapter</span>() {\n                    <span class=\"hljs-meta\">@Override</span>\n                    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">write</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg, ChannelPromise promise)</span> {\n                        System.out.println(<span class=\"hljs-number\">6</span>);\n                        ctx.write(msg, promise); \n                    }\n                });\n            }\n        })\n        .bind(<span class=\"hljs-number\">8080</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2351,2404"}},{"content":"<pre data-lines=\"2407,2416\"><code data-lines=\"2407,2416\">1\n2\n3\n6\n5\n4\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2407,2416"}},{"content":"<pre data-lines=\"2417,2418\"><code>&#x53ef;&#x4ee5;&#x770b;&#x5230;&#xff0c;ChannelInboundHandlerAdapter &#x662f;&#x6309;&#x7167; addLast &#x7684;&#x987a;&#x5e8f;&#x6267;&#x884c;&#x7684;&#xff0c;&#x800c; ChannelOutboundHandlerAdapter &#x662f;&#x6309;&#x7167; addLast &#x7684;&#x9006;&#x5e8f;&#x6267;&#x884c;&#x7684;&#x3002;ChannelPipeline &#x7684;&#x5b9e;&#x73b0;&#x662f;&#x4e00;&#x4e2a; ChannelHandlerContext&#xff08;&#x5305;&#x88c5;&#x4e86; ChannelHandler&#xff09; &#x7ec4;&#x6210;&#x7684;&#x53cc;&#x5411;&#x94fe;&#x8868;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2417,2418"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/54f58c804f9dce2e4cfbedda38207645.png\" alt>","children":[],"payload":{"tag":"img","lines":"2419,2420"}},{"content":"<pre data-lines=\"2421,2436\"><code>*   &#x5165;&#x7ad9;&#x5904;&#x7406;&#x5668;&#x4e2d;&#xff0c;ctx.fireChannelRead(msg) &#x662f; **&#x8c03;&#x7528;&#x4e0b;&#x4e00;&#x4e2a;&#x5165;&#x7ad9;&#x5904;&#x7406;&#x5668;**\n    *   &#x5982;&#x679c;&#x6ce8;&#x91ca;&#x6389; 1 &#x5904;&#x4ee3;&#x7801;&#xff0c;&#x5219;&#x4ec5;&#x4f1a;&#x6253;&#x5370; 1\n    *   &#x5982;&#x679c;&#x6ce8;&#x91ca;&#x6389; 2 &#x5904;&#x4ee3;&#x7801;&#xff0c;&#x5219;&#x4ec5;&#x4f1a;&#x6253;&#x5370; 1 2\n*   3 &#x5904;&#x7684; ctx.channel().write(msg) &#x4f1a; **&#x4ece;&#x5c3e;&#x90e8;&#x5f00;&#x59cb;&#x89e6;&#x53d1;** &#x540e;&#x7eed;&#x51fa;&#x7ad9;&#x5904;&#x7406;&#x5668;&#x7684;&#x6267;&#x884c;\n    *   &#x5982;&#x679c;&#x6ce8;&#x91ca;&#x6389; 3 &#x5904;&#x4ee3;&#x7801;&#xff0c;&#x5219;&#x4ec5;&#x4f1a;&#x6253;&#x5370; 1 2 3\n*   &#x7c7b;&#x4f3c;&#x7684;&#xff0c;&#x51fa;&#x7ad9;&#x5904;&#x7406;&#x5668;&#x4e2d;&#xff0c;ctx.write(msg, promise) &#x7684;&#x8c03;&#x7528;&#x4e5f;&#x4f1a; **&#x89e6;&#x53d1;&#x4e0a;&#x4e00;&#x4e2a;&#x51fa;&#x7ad9;&#x5904;&#x7406;&#x5668;**\n    *   &#x5982;&#x679c;&#x6ce8;&#x91ca;&#x6389; 6 &#x5904;&#x4ee3;&#x7801;&#xff0c;&#x5219;&#x4ec5;&#x4f1a;&#x6253;&#x5370; 1 2 3 6\n*   ctx.channel().write(msg) vs ctx.write(msg)\n    *   &#x90fd;&#x662f;&#x89e6;&#x53d1;&#x51fa;&#x7ad9;&#x5904;&#x7406;&#x5668;&#x7684;&#x6267;&#x884c;\n    *   ctx.channel().write(msg) &#x4ece;&#x5c3e;&#x90e8;&#x5f00;&#x59cb;&#x67e5;&#x627e;&#x51fa;&#x7ad9;&#x5904;&#x7406;&#x5668;\n    *   ctx.write(msg) &#x662f;&#x4ece;&#x5f53;&#x524d;&#x8282;&#x70b9;&#x627e;&#x4e0a;&#x4e00;&#x4e2a;&#x51fa;&#x7ad9;&#x5904;&#x7406;&#x5668;\n    *   3 &#x5904;&#x7684; ctx.channel().write(msg) &#x5982;&#x679c;&#x6539;&#x4e3a; ctx.write(msg) &#x4ec5;&#x4f1a;&#x6253;&#x5370; 1 2 3&#xff0c;&#x56e0;&#x4e3a;&#x8282;&#x70b9;3 &#x4e4b;&#x524d;&#x6ca1;&#x6709;&#x5176;&#x5b83;&#x51fa;&#x7ad9;&#x5904;&#x7406;&#x5668;&#x4e86;\n    *   6 &#x5904;&#x7684; ctx.write(msg, promise) &#x5982;&#x679c;&#x6539;&#x4e3a; ctx.channel().write(msg) &#x4f1a;&#x6253;&#x5370; 1 2 3 6 6 6&#x2026; &#x56e0;&#x4e3a; ctx.channel().write() &#x662f;&#x4ece;&#x5c3e;&#x90e8;&#x5f00;&#x59cb;&#x67e5;&#x627e;&#xff0c;&#x7ed3;&#x679c;&#x53c8;&#x662f;&#x8282;&#x70b9;6 &#x81ea;&#x5df1;\n\n&#x670d;&#x52a1;&#x7aef; pipeline &#x89e6;&#x53d1;&#x7684;&#x539f;&#x59cb;&#x6d41;&#x7a0b;&#xff0c;&#x56fe;&#x4e2d;&#x6570;&#x5b57;&#x4ee3;&#x8868;&#x4e86;&#x5904;&#x7406;&#x6b65;&#x9aa4;&#x7684;&#x5148;&#x540e;&#x6b21;&#x5e8f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2421,2436"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/2dcc9c15dd31f77575a6dd91d082849a.png\" alt>","children":[],"payload":{"tag":"img","lines":"2437,2438"}}],"payload":{"tag":"h3","lines":"2340,2341"}},{"content":"2.3.5&#x3001;ByteBuf","children":[{"content":"2.3.5.1&#x3001;&#x521b;&#x5efa;","children":[{"content":"<pre data-lines=\"2445,2450\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(<span class=\"hljs-number\">10</span>);\nlog(buffer);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2445,2450"}},{"content":"<pre data-lines=\"2451,2454\"><code>&#x4e0a;&#x9762;&#x4ee3;&#x7801;&#x521b;&#x5efa;&#x4e86;&#x4e00;&#x4e2a;&#x9ed8;&#x8ba4;&#x7684; ByteBuf&#xff08;&#x6c60;&#x5316;&#x57fa;&#x4e8e;&#x76f4;&#x63a5;&#x5185;&#x5b58;&#x7684; ByteBuf&#xff09;&#xff0c;&#x521d;&#x59cb;&#x5bb9;&#x91cf;&#x662f; 10\n\n&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2451,2454"}},{"content":"<pre data-lines=\"2455,2459\"><code data-lines=\"2455,2459\"><span class=\"hljs-keyword\">read</span> <span class=\"hljs-keyword\">index</span>:<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">write</span> <span class=\"hljs-keyword\">index</span>:<span class=\"hljs-number\">0</span> capacity:<span class=\"hljs-number\">10</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2455,2459"}},{"content":"<pre data-lines=\"2460,2461\"><code>&#x5176;&#x4e2d; log &#x65b9;&#x6cd5;&#x53c2;&#x8003;&#x5982;&#x4e0b;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2460,2461"}},{"content":"<pre data-lines=\"2462,2476\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">log</span><span class=\"hljs-params\">(ByteBuf buffer)</span> {\n    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">length</span> <span class=\"hljs-operator\">=</span> buffer.readableBytes();\n    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">rows</span> <span class=\"hljs-operator\">=</span> length / <span class=\"hljs-number\">16</span> + (length % <span class=\"hljs-number\">15</span> == <span class=\"hljs-number\">0</span> ? <span class=\"hljs-number\">0</span> : <span class=\"hljs-number\">1</span>) + <span class=\"hljs-number\">4</span>;\n    <span class=\"hljs-type\">StringBuilder</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringBuilder</span>(rows * <span class=\"hljs-number\">80</span> * <span class=\"hljs-number\">2</span>)\n        .append(<span class=\"hljs-string\">&quot;read index:&quot;</span>).append(buffer.readerIndex())\n        .append(<span class=\"hljs-string\">&quot; write index:&quot;</span>).append(buffer.writerIndex())\n        .append(<span class=\"hljs-string\">&quot; capacity:&quot;</span>).append(buffer.capacity())\n        .append(NEWLINE);\n    appendPrettyHexDump(buf, buffer);\n    System.out.println(buf.toString());\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2462,2476"}}],"payload":{"tag":"h4","lines":"2443,2444"}},{"content":"2.3.5.2&#x3001;&#x5806;&#x5185;&#x5b58; vs &#x76f4;&#x63a5;&#x5185;&#x5b58;","children":[{"content":"<pre data-lines=\"2479,2480\"><code>&#x53ef;&#x4ee5;&#x4f7f;&#x7528;&#x4e0b;&#x9762;&#x7684;&#x4ee3;&#x7801;&#x6765;&#x521b;&#x5efa;&#x6c60;&#x5316;&#x57fa;&#x4e8e;&#x5806;&#x7684; ByteBuf\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2479,2480"}},{"content":"<pre data-lines=\"2481,2485\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.heapBuffer(<span class=\"hljs-number\">10</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2481,2485"}},{"content":"<pre data-lines=\"2486,2487\"><code>&#x4e5f;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;&#x4e0b;&#x9762;&#x7684;&#x4ee3;&#x7801;&#x6765;&#x521b;&#x5efa;&#x6c60;&#x5316;&#x57fa;&#x4e8e;&#x76f4;&#x63a5;&#x5185;&#x5b58;&#x7684; ByteBuf\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2486,2487"}},{"content":"<pre data-lines=\"2488,2492\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.directBuffer(<span class=\"hljs-number\">10</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2488,2492"}},{"content":"<pre data-lines=\"2493,2495\"><code>*   &#x76f4;&#x63a5;&#x5185;&#x5b58;&#x521b;&#x5efa;&#x548c;&#x9500;&#x6bc1;&#x7684;&#x4ee3;&#x4ef7;&#x6602;&#x8d35;&#xff0c;&#x4f46;&#x8bfb;&#x5199;&#x6027;&#x80fd;&#x9ad8;&#xff08;&#x5c11;&#x4e00;&#x6b21;&#x5185;&#x5b58;&#x590d;&#x5236;&#xff09;&#xff0c;&#x9002;&#x5408;&#x914d;&#x5408;&#x6c60;&#x5316;&#x529f;&#x80fd;&#x4e00;&#x8d77;&#x7528;\n*   &#x76f4;&#x63a5;&#x5185;&#x5b58;&#x5bf9; GC &#x538b;&#x529b;&#x5c0f;&#xff0c;&#x56e0;&#x4e3a;&#x8fd9;&#x90e8;&#x5206;&#x5185;&#x5b58;&#x4e0d;&#x53d7; JVM &#x5783;&#x573e;&#x56de;&#x6536;&#x7684;&#x7ba1;&#x7406;&#xff0c;&#x4f46;&#x4e5f;&#x8981;&#x6ce8;&#x610f;&#x53ca;&#x65f6;&#x4e3b;&#x52a8;&#x91ca;&#x653e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2493,2495"}}],"payload":{"tag":"h4","lines":"2477,2478"}},{"content":"2.3.5.3&#x3001;&#x6c60;&#x5316; vs &#x975e;&#x6c60;&#x5316;","children":[{"content":"<pre data-lines=\"2498,2505\"><code>&#x6c60;&#x5316;&#x7684;&#x6700;&#x5927;&#x610f;&#x4e49;&#x5728;&#x4e8e;&#x53ef;&#x4ee5;&#x91cd;&#x7528; ByteBuf&#xff0c;&#x4f18;&#x70b9;&#x6709;\n\n*   &#x6ca1;&#x6709;&#x6c60;&#x5316;&#xff0c;&#x5219;&#x6bcf;&#x6b21;&#x90fd;&#x5f97;&#x521b;&#x5efa;&#x65b0;&#x7684; ByteBuf &#x5b9e;&#x4f8b;&#xff0c;&#x8fd9;&#x4e2a;&#x64cd;&#x4f5c;&#x5bf9;&#x76f4;&#x63a5;&#x5185;&#x5b58;&#x4ee3;&#x4ef7;&#x6602;&#x8d35;&#xff0c;&#x5c31;&#x7b97;&#x662f;&#x5806;&#x5185;&#x5b58;&#xff0c;&#x4e5f;&#x4f1a;&#x589e;&#x52a0; GC &#x538b;&#x529b;\n*   &#x6709;&#x4e86;&#x6c60;&#x5316;&#xff0c;&#x5219;&#x53ef;&#x4ee5;&#x91cd;&#x7528;&#x6c60;&#x4e2d; ByteBuf &#x5b9e;&#x4f8b;&#xff0c;&#x5e76;&#x4e14;&#x91c7;&#x7528;&#x4e86;&#x4e0e; jemalloc &#x7c7b;&#x4f3c;&#x7684;&#x5185;&#x5b58;&#x5206;&#x914d;&#x7b97;&#x6cd5;&#x63d0;&#x5347;&#x5206;&#x914d;&#x6548;&#x7387;\n*   &#x9ad8;&#x5e76;&#x53d1;&#x65f6;&#xff0c;&#x6c60;&#x5316;&#x529f;&#x80fd;&#x66f4;&#x8282;&#x7ea6;&#x5185;&#x5b58;&#xff0c;&#x51cf;&#x5c11;&#x5185;&#x5b58;&#x6ea2;&#x51fa;&#x7684;&#x53ef;&#x80fd;\n\n&#x6c60;&#x5316;&#x529f;&#x80fd;&#x662f;&#x5426;&#x5f00;&#x542f;&#xff0c;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x4e0b;&#x9762;&#x7684;&#x7cfb;&#x7edf;&#x73af;&#x5883;&#x53d8;&#x91cf;&#x6765;&#x8bbe;&#x7f6e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2498,2505"}},{"content":"<pre data-lines=\"2506,2510\"><code class=\"language-java\">-Dio.netty.allocator.type={unpooled|pooled}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2506,2510"}},{"content":"<pre data-lines=\"2511,2513\"><code>*   4.1 &#x4ee5;&#x540e;&#xff0c;&#x975e; Android &#x5e73;&#x53f0;&#x9ed8;&#x8ba4;&#x542f;&#x7528;&#x6c60;&#x5316;&#x5b9e;&#x73b0;&#xff0c;Android &#x5e73;&#x53f0;&#x542f;&#x7528;&#x975e;&#x6c60;&#x5316;&#x5b9e;&#x73b0;\n*   4.1 &#x4e4b;&#x524d;&#xff0c;&#x6c60;&#x5316;&#x529f;&#x80fd;&#x8fd8;&#x4e0d;&#x6210;&#x719f;&#xff0c;&#x9ed8;&#x8ba4;&#x662f;&#x975e;&#x6c60;&#x5316;&#x5b9e;&#x73b0;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2511,2513"}}],"payload":{"tag":"h4","lines":"2496,2497"}},{"content":"2.3.5.4&#x3001;&#x7ec4;&#x6210;","children":[{"content":"<pre data-lines=\"2516,2517\"><code>ByteBuf &#x7531;&#x56db;&#x90e8;&#x5206;&#x7ec4;&#x6210;&#xff0c;&#x6700;&#x5f00;&#x59cb;&#x8bfb;&#x5199;&#x6307;&#x9488;&#x90fd;&#x5728; 0 &#x4f4d;&#x7f6e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2516,2517"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1221b71d7a4748365a29cf89d1635f1a.png\" alt>","children":[],"payload":{"tag":"img","lines":"2518,2519"}}],"payload":{"tag":"h4","lines":"2514,2515"}},{"content":"2.3.5.5&#x3001;&#x5199;&#x5165;","children":[{"content":"<pre data-lines=\"2522,2523\"><code>&#x65b9;&#x6cd5;&#x5217;&#x8868;&#xff0c;&#x7701;&#x7565;&#x4e00;&#x4e9b;&#x4e0d;&#x91cd;&#x8981;&#x7684;&#x65b9;&#x6cd5;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2522,2523"}},{"content":"<table data-lines=\"2524,2539\">\n<thead data-lines=\"2524,2525\">\n<tr data-lines=\"2524,2525\">\n<th>&#x65b9;&#x6cd5;&#x7b7e;&#x540d;</th>\n<th>&#x542b;&#x4e49;</th>\n<th>&#x5907;&#x6ce8;</th>\n</tr>\n</thead>\n<tbody data-lines=\"2526,2539\">\n<tr data-lines=\"2526,2527\">\n<td>writeBoolean(boolean value)</td>\n<td>&#x5199;&#x5165; boolean &#x503c;</td>\n<td>&#x7528;&#x4e00;&#x5b57;&#x8282; 01</td>\n</tr>\n<tr data-lines=\"2527,2528\">\n<td>writeByte(int value)</td>\n<td>&#x5199;&#x5165; byte &#x503c;</td>\n<td></td>\n</tr>\n<tr data-lines=\"2528,2529\">\n<td>writeShort(int value)</td>\n<td>&#x5199;&#x5165; short &#x503c;</td>\n<td></td>\n</tr>\n<tr data-lines=\"2529,2530\">\n<td>writeInt(int value)</td>\n<td>&#x5199;&#x5165; int &#x503c;</td>\n<td>Big Endian&#xff0c;&#x5373; 0x250&#xff0c;&#x5199;&#x5165;&#x540e; 00 00 02 50</td>\n</tr>\n<tr data-lines=\"2530,2531\">\n<td>writeIntLE(int value)</td>\n<td>&#x5199;&#x5165; int &#x503c;</td>\n<td>Little Endian&#xff0c;&#x5373; 0x250&#xff0c;&#x5199;&#x5165;&#x540e; 50 02 00 00</td>\n</tr>\n<tr data-lines=\"2531,2532\">\n<td>writeLong(long value)</td>\n<td>&#x5199;&#x5165; long &#x503c;</td>\n<td></td>\n</tr>\n<tr data-lines=\"2532,2533\">\n<td>writeChar(int value)</td>\n<td>&#x5199;&#x5165; char &#x503c;</td>\n<td></td>\n</tr>\n<tr data-lines=\"2533,2534\">\n<td>writeFloat(float value)</td>\n<td>&#x5199;&#x5165; float &#x503c;</td>\n<td></td>\n</tr>\n<tr data-lines=\"2534,2535\">\n<td>writeDouble(double value)</td>\n<td>&#x5199;&#x5165; double &#x503c;</td>\n<td></td>\n</tr>\n<tr data-lines=\"2535,2536\">\n<td>writeBytes(ByteBuf src)</td>\n<td>&#x5199;&#x5165; netty &#x7684; ByteBuf</td>\n<td></td>\n</tr>\n<tr data-lines=\"2536,2537\">\n<td>writeBytes(byte[] src)</td>\n<td>&#x5199;&#x5165; byte[]</td>\n<td></td>\n</tr>\n<tr data-lines=\"2537,2538\">\n<td>writeBytes(ByteBuffer src)</td>\n<td>&#x5199;&#x5165; nio &#x7684; ByteBuffer</td>\n<td></td>\n</tr>\n<tr data-lines=\"2538,2539\">\n<td>int writeCharSequence(CharSequence sequence, Charset charset)</td>\n<td>&#x5199;&#x5165;&#x5b57;&#x7b26;&#x4e32;</td>\n<td></td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"2524,2539"}},{"content":"<pre data-lines=\"2540,2546\"><code>&gt; &#x6ce8;&#x610f;\n&gt; \n&gt; *   &#x8fd9;&#x4e9b;&#x65b9;&#x6cd5;&#x7684;&#x672a;&#x6307;&#x660e;&#x8fd4;&#x56de;&#x503c;&#x7684;&#xff0c;&#x5176;&#x8fd4;&#x56de;&#x503c;&#x90fd;&#x662f; ByteBuf&#xff0c;&#x610f;&#x5473;&#x7740;&#x53ef;&#x4ee5;&#x94fe;&#x5f0f;&#x8c03;&#x7528;\n&gt; *   &#x7f51;&#x7edc;&#x4f20;&#x8f93;&#xff0c;&#x9ed8;&#x8ba4;&#x4e60;&#x60ef;&#x662f; Big Endian\n\n&#x5148;&#x5199;&#x5165; 4 &#x4e2a;&#x5b57;&#x8282;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2540,2546"}},{"content":"<pre data-lines=\"2547,2552\"><code class=\"language-java\">buffer.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>});\nlog(buffer);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2547,2552"}},{"content":"<pre data-lines=\"2553,2554\"><code>&#x7ed3;&#x679c;&#x662f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2553,2554"}},{"content":"<pre data-lines=\"2555,2564\"><code data-lines=\"2555,2564\">read index:0 write index:4 capacity:10\n<span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 01 02 03 04                                     |....            |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2555,2564"}},{"content":"<pre data-lines=\"2565,2566\"><code>&#x518d;&#x5199;&#x5165;&#x4e00;&#x4e2a; int &#x6574;&#x6570;&#xff0c;&#x4e5f;&#x662f; 4 &#x4e2a;&#x5b57;&#x8282;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2565,2566"}},{"content":"<pre data-lines=\"2567,2572\"><code class=\"language-java\">buffer.writeInt(5);\nlog(buffer);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2567,2572"}},{"content":"<pre data-lines=\"2573,2574\"><code>&#x7ed3;&#x679c;&#x662f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2573,2574"}},{"content":"<pre data-lines=\"2575,2584\"><code data-lines=\"2575,2584\">read index:0 write index:8 capacity:10\n<span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 01 02 03 04 00 00 00 05                         |........        |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2575,2584"}},{"content":"<pre data-lines=\"2585,2586\"><code>&#x8fd8;&#x6709;&#x4e00;&#x7c7b;&#x65b9;&#x6cd5;&#x662f; set &#x5f00;&#x5934;&#x7684;&#x4e00;&#x7cfb;&#x5217;&#x65b9;&#x6cd5;&#xff0c;&#x4e5f;&#x53ef;&#x4ee5;&#x5199;&#x5165;&#x6570;&#x636e;&#xff0c;&#x4f46;&#x4e0d;&#x4f1a;&#x6539;&#x53d8;&#x5199;&#x6307;&#x9488;&#x4f4d;&#x7f6e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2585,2586"}}],"payload":{"tag":"h4","lines":"2520,2521"}},{"content":"2.3.5.6&#x3001;&#x6269;&#x5bb9;","children":[{"content":"<pre data-lines=\"2589,2590\"><code>&#x518d;&#x5199;&#x5165;&#x4e00;&#x4e2a; int &#x6574;&#x6570;&#x65f6;&#xff0c;&#x5bb9;&#x91cf;&#x4e0d;&#x591f;&#x4e86;&#xff08;&#x521d;&#x59cb;&#x5bb9;&#x91cf;&#x662f; 10&#xff09;&#xff0c;&#x8fd9;&#x65f6;&#x4f1a;&#x5f15;&#x53d1;&#x6269;&#x5bb9;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2589,2590"}},{"content":"<pre data-lines=\"2591,2596\"><code class=\"language-java\">buffer.writeInt(6);\nlog(buffer);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2591,2596"}},{"content":"<pre data-lines=\"2597,2604\"><code>&#x6269;&#x5bb9;&#x89c4;&#x5219;&#x662f;\n\n*   &#x5982;&#x4f55;&#x5199;&#x5165;&#x540e;&#x6570;&#x636e;&#x5927;&#x5c0f;&#x672a;&#x8d85;&#x8fc7; 512&#xff0c;&#x5219;&#x9009;&#x62e9;&#x4e0b;&#x4e00;&#x4e2a; 16 &#x7684;&#x6574;&#x6570;&#x500d;&#xff0c;&#x4f8b;&#x5982;&#x5199;&#x5165;&#x540e;&#x5927;&#x5c0f;&#x4e3a; 12 &#xff0c;&#x5219;&#x6269;&#x5bb9;&#x540e; capacity &#x662f; 16\n*   &#x5982;&#x679c;&#x5199;&#x5165;&#x540e;&#x6570;&#x636e;&#x5927;&#x5c0f;&#x8d85;&#x8fc7; 512&#xff0c;&#x5219;&#x9009;&#x62e9;&#x4e0b;&#x4e00;&#x4e2a; 2n&#xff0c;&#x4f8b;&#x5982;&#x5199;&#x5165;&#x540e;&#x5927;&#x5c0f;&#x4e3a; 513&#xff0c;&#x5219;&#x6269;&#x5bb9;&#x540e; capacity &#x662f; 210\\=1024&#xff08;29\\=512 &#x5df2;&#x7ecf;&#x4e0d;&#x591f;&#x4e86;&#xff09;\n*   &#x6269;&#x5bb9;&#x4e0d;&#x80fd;&#x8d85;&#x8fc7; max capacity &#x4f1a;&#x62a5;&#x9519;\n\n&#x7ed3;&#x679c;&#x662f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2597,2604"}},{"content":"<pre data-lines=\"2605,2614\"><code data-lines=\"2605,2614\">read index:0 write index:12 capacity:16\n<span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 01 02 03 04 00 00 00 05 00 00 00 06             |............    |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2605,2614"}}],"payload":{"tag":"h4","lines":"2587,2588"}},{"content":"2.3.5.7&#x3001;&#x8bfb;&#x53d6;","children":[{"content":"<pre data-lines=\"2617,2618\"><code>&#x4f8b;&#x5982;&#x8bfb;&#x4e86; 4 &#x6b21;&#xff0c;&#x6bcf;&#x6b21;&#x4e00;&#x4e2a;&#x5b57;&#x8282;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2617,2618"}},{"content":"<pre data-lines=\"2619,2627\"><code class=\"language-java\">System.out.println(buffer.readByte());\nSystem.out.println(buffer.readByte());\nSystem.out.println(buffer.readByte());\nSystem.out.println(buffer.readByte());\nlog(buffer);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2619,2627"}},{"content":"<pre data-lines=\"2628,2629\"><code>&#x8bfb;&#x8fc7;&#x7684;&#x5185;&#x5bb9;&#xff0c;&#x5c31;&#x5c5e;&#x4e8e;&#x5e9f;&#x5f03;&#x90e8;&#x5206;&#x4e86;&#xff0c;&#x518d;&#x8bfb;&#x53ea;&#x80fd;&#x8bfb;&#x90a3;&#x4e9b;&#x5c1a;&#x672a;&#x8bfb;&#x53d6;&#x7684;&#x90e8;&#x5206;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2628,2629"}},{"content":"<pre data-lines=\"2630,2643\"><code data-lines=\"2630,2643\">1\n2\n3\n4\nread index:4 write index:12 capacity:16\n<span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 00 00 00 05 00 00 00 06                         |........        |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2630,2643"}},{"content":"<pre data-lines=\"2644,2647\"><code>&#x5982;&#x679c;&#x9700;&#x8981;&#x91cd;&#x590d;&#x8bfb;&#x53d6; int &#x6574;&#x6570; 5&#xff0c;&#x600e;&#x4e48;&#x529e;&#xff1f;\n\n&#x53ef;&#x4ee5;&#x5728; read &#x524d;&#x5148;&#x505a;&#x4e2a;&#x6807;&#x8bb0; mark\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2644,2647"}},{"content":"<pre data-lines=\"2648,2654\"><code class=\"language-java\">buffer.markReaderIndex();\nSystem.out.println(buffer.readInt());\nlog(buffer);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2648,2654"}},{"content":"<pre data-lines=\"2655,2656\"><code>&#x7ed3;&#x679c;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2655,2656"}},{"content":"<pre data-lines=\"2657,2667\"><code data-lines=\"2657,2667\">5\nread index:8 write index:12 capacity:16\n<span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 00 00 00 06                                     |....            |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2657,2667"}},{"content":"<pre data-lines=\"2668,2669\"><code>&#x8fd9;&#x65f6;&#x8981;&#x91cd;&#x590d;&#x8bfb;&#x53d6;&#x7684;&#x8bdd;&#xff0c;&#x91cd;&#x7f6e;&#x5230;&#x6807;&#x8bb0;&#x4f4d;&#x7f6e; reset\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2668,2669"}},{"content":"<pre data-lines=\"2670,2675\"><code class=\"language-java\">buffer.resetReaderIndex();\nlog(buffer);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2670,2675"}},{"content":"<pre data-lines=\"2676,2677\"><code>&#x8fd9;&#x65f6;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2676,2677"}},{"content":"<pre data-lines=\"2678,2687\"><code data-lines=\"2678,2687\">read index:4 write index:12 capacity:16\n<span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 00 00 00 05 00 00 00 06                         |........        |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2678,2687"}},{"content":"<pre data-lines=\"2688,2689\"><code>&#x8fd8;&#x6709;&#x79cd;&#x529e;&#x6cd5;&#x662f;&#x91c7;&#x7528; get &#x5f00;&#x5934;&#x7684;&#x4e00;&#x7cfb;&#x5217;&#x65b9;&#x6cd5;&#xff0c;&#x8fd9;&#x4e9b;&#x65b9;&#x6cd5;&#x4e0d;&#x4f1a;&#x6539;&#x53d8; read index\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2688,2689"}}],"payload":{"tag":"h4","lines":"2615,2616"}},{"content":"2.3.5.8&#x3001;retain &amp; release","children":[{"content":"<pre data-lines=\"2692,2712\"><code>&#x7531;&#x4e8e; Netty &#x4e2d;&#x6709;&#x5806;&#x5916;&#x5185;&#x5b58;&#x7684; ByteBuf &#x5b9e;&#x73b0;&#xff0c;&#x5806;&#x5916;&#x5185;&#x5b58;&#x6700;&#x597d;&#x662f;&#x624b;&#x52a8;&#x6765;&#x91ca;&#x653e;&#xff0c;&#x800c;&#x4e0d;&#x662f;&#x7b49; GC &#x5783;&#x573e;&#x56de;&#x6536;&#x3002;\n\n*   UnpooledHeapByteBuf &#x4f7f;&#x7528;&#x7684;&#x662f; JVM &#x5185;&#x5b58;&#xff0c;&#x53ea;&#x9700;&#x7b49; GC &#x56de;&#x6536;&#x5185;&#x5b58;&#x5373;&#x53ef;\n*   UnpooledDirectByteBuf &#x4f7f;&#x7528;&#x7684;&#x5c31;&#x662f;&#x76f4;&#x63a5;&#x5185;&#x5b58;&#x4e86;&#xff0c;&#x9700;&#x8981;&#x7279;&#x6b8a;&#x7684;&#x65b9;&#x6cd5;&#x6765;&#x56de;&#x6536;&#x5185;&#x5b58;\n*   PooledByteBuf &#x548c;&#x5b83;&#x7684;&#x5b50;&#x7c7b;&#x4f7f;&#x7528;&#x4e86;&#x6c60;&#x5316;&#x673a;&#x5236;&#xff0c;&#x9700;&#x8981;&#x66f4;&#x590d;&#x6742;&#x7684;&#x89c4;&#x5219;&#x6765;&#x56de;&#x6536;&#x5185;&#x5b58;\n\n&gt; &#x56de;&#x6536;&#x5185;&#x5b58;&#x7684;&#x6e90;&#x7801;&#x5b9e;&#x73b0;&#xff0c;&#x8bf7;&#x5173;&#x6ce8;&#x4e0b;&#x9762;&#x65b9;&#x6cd5;&#x7684;&#x4e0d;&#x540c;&#x5b9e;&#x73b0;\n&gt; \n&gt; `protected abstract void deallocate()`\n\nNetty &#x8fd9;&#x91cc;&#x91c7;&#x7528;&#x4e86;&#x5f15;&#x7528;&#x8ba1;&#x6570;&#x6cd5;&#x6765;&#x63a7;&#x5236;&#x56de;&#x6536;&#x5185;&#x5b58;&#xff0c;&#x6bcf;&#x4e2a; ByteBuf &#x90fd;&#x5b9e;&#x73b0;&#x4e86; ReferenceCounted &#x63a5;&#x53e3;\n\n*   &#x6bcf;&#x4e2a; ByteBuf &#x5bf9;&#x8c61;&#x7684;&#x521d;&#x59cb;&#x8ba1;&#x6570;&#x4e3a; 1\n*   &#x8c03;&#x7528; release &#x65b9;&#x6cd5;&#x8ba1;&#x6570;&#x51cf; 1&#xff0c;&#x5982;&#x679c;&#x8ba1;&#x6570;&#x4e3a; 0&#xff0c;ByteBuf &#x5185;&#x5b58;&#x88ab;&#x56de;&#x6536;\n*   &#x8c03;&#x7528; retain &#x65b9;&#x6cd5;&#x8ba1;&#x6570;&#x52a0; 1&#xff0c;&#x8868;&#x793a;&#x8c03;&#x7528;&#x8005;&#x6ca1;&#x7528;&#x5b8c;&#x4e4b;&#x524d;&#xff0c;&#x5176;&#x5b83; handler &#x5373;&#x4f7f;&#x8c03;&#x7528;&#x4e86; release &#x4e5f;&#x4e0d;&#x4f1a;&#x9020;&#x6210;&#x56de;&#x6536;\n*   &#x5f53;&#x8ba1;&#x6570;&#x4e3a; 0 &#x65f6;&#xff0c;&#x5e95;&#x5c42;&#x5185;&#x5b58;&#x4f1a;&#x88ab;&#x56de;&#x6536;&#xff0c;&#x8fd9;&#x65f6;&#x5373;&#x4f7f; ByteBuf &#x5bf9;&#x8c61;&#x8fd8;&#x5728;&#xff0c;&#x5176;&#x5404;&#x4e2a;&#x65b9;&#x6cd5;&#x5747;&#x65e0;&#x6cd5;&#x6b63;&#x5e38;&#x4f7f;&#x7528;\n\n&#x8c01;&#x6765;&#x8d1f;&#x8d23; release &#x5462;&#xff1f;\n\n&#x4e0d;&#x662f;&#x6211;&#x4eec;&#x60f3;&#x8c61;&#x7684;&#xff08;&#x4e00;&#x822c;&#x60c5;&#x51b5;&#x4e0b;&#xff09;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2692,2712"}},{"content":"<pre data-lines=\"2713,2722\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> ...\n<span class=\"hljs-keyword\">try</span> {\n    ...\n} <span class=\"hljs-keyword\">finally</span> {\n    buf.release();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2713,2722"}},{"content":"<pre data-lines=\"2723,2740\"><code>&#x8bf7;&#x601d;&#x8003;&#xff0c;&#x56e0;&#x4e3a; pipeline &#x7684;&#x5b58;&#x5728;&#xff0c;&#x4e00;&#x822c;&#x9700;&#x8981;&#x5c06; ByteBuf &#x4f20;&#x9012;&#x7ed9;&#x4e0b;&#x4e00;&#x4e2a; ChannelHandler&#xff0c;&#x5982;&#x679c;&#x5728; finally &#x4e2d; release &#x4e86;&#xff0c;&#x5c31;&#x5931;&#x53bb;&#x4e86;&#x4f20;&#x9012;&#x6027;&#xff08;&#x5f53;&#x7136;&#xff0c;&#x5982;&#x679c;&#x5728;&#x8fd9;&#x4e2a; ChannelHandler &#x5185;&#x8fd9;&#x4e2a; ByteBuf &#x5df2;&#x5b8c;&#x6210;&#x4e86;&#x5b83;&#x7684;&#x4f7f;&#x547d;&#xff0c;&#x90a3;&#x4e48;&#x4fbf;&#x65e0;&#x987b;&#x518d;&#x4f20;&#x9012;&#xff09;\n\n&#x57fa;&#x672c;&#x89c4;&#x5219;&#x662f;&#xff0c;**&#x8c01;&#x662f;&#x6700;&#x540e;&#x4f7f;&#x7528;&#x8005;&#xff0c;&#x8c01;&#x8d1f;&#x8d23; release**&#xff0c;&#x8be6;&#x7ec6;&#x5206;&#x6790;&#x5982;&#x4e0b;\n\n*   &#x8d77;&#x70b9;&#xff0c;&#x5bf9;&#x4e8e; NIO &#x5b9e;&#x73b0;&#x6765;&#x8bb2;&#xff0c;&#x5728; io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read &#x65b9;&#x6cd5;&#x4e2d;&#x9996;&#x6b21;&#x521b;&#x5efa; ByteBuf &#x653e;&#x5165; pipeline&#xff08;line 163 pipeline.fireChannelRead(byteBuf)&#xff09;\n*   &#x5165;&#x7ad9; ByteBuf &#x5904;&#x7406;&#x539f;&#x5219;\n    *   &#x5bf9;&#x539f;&#x59cb; ByteBuf &#x4e0d;&#x505a;&#x5904;&#x7406;&#xff0c;&#x8c03;&#x7528; ctx.fireChannelRead(msg) &#x5411;&#x540e;&#x4f20;&#x9012;&#xff0c;&#x8fd9;&#x65f6;&#x65e0;&#x987b; release\n    *   &#x5c06;&#x539f;&#x59cb; ByteBuf &#x8f6c;&#x6362;&#x4e3a;&#x5176;&#x5b83;&#x7c7b;&#x578b;&#x7684; Java &#x5bf9;&#x8c61;&#xff0c;&#x8fd9;&#x65f6; ByteBuf &#x5c31;&#x6ca1;&#x7528;&#x4e86;&#xff0c;&#x5fc5;&#x987b; release\n    *   &#x5982;&#x679c;&#x4e0d;&#x8c03;&#x7528; ctx.fireChannelRead(msg) &#x5411;&#x540e;&#x4f20;&#x9012;&#xff0c;&#x90a3;&#x4e48;&#x4e5f;&#x5fc5;&#x987b; release\n    *   &#x6ce8;&#x610f;&#x5404;&#x79cd;&#x5f02;&#x5e38;&#xff0c;&#x5982;&#x679c; ByteBuf &#x6ca1;&#x6709;&#x6210;&#x529f;&#x4f20;&#x9012;&#x5230;&#x4e0b;&#x4e00;&#x4e2a; ChannelHandler&#xff0c;&#x5fc5;&#x987b; release\n    *   &#x5047;&#x8bbe;&#x6d88;&#x606f;&#x4e00;&#x76f4;&#x5411;&#x540e;&#x4f20;&#xff0c;&#x90a3;&#x4e48; TailContext &#x4f1a;&#x8d1f;&#x8d23;&#x91ca;&#x653e;&#x672a;&#x5904;&#x7406;&#x6d88;&#x606f;&#xff08;&#x539f;&#x59cb;&#x7684; ByteBuf&#xff09;\n*   &#x51fa;&#x7ad9; ByteBuf &#x5904;&#x7406;&#x539f;&#x5219;\n    *   &#x51fa;&#x7ad9;&#x6d88;&#x606f;&#x6700;&#x7ec8;&#x90fd;&#x4f1a;&#x8f6c;&#x4e3a; ByteBuf &#x8f93;&#x51fa;&#xff0c;&#x4e00;&#x76f4;&#x5411;&#x524d;&#x4f20;&#xff0c;&#x7531; HeadContext flush &#x540e; release\n*   &#x5f02;&#x5e38;&#x5904;&#x7406;&#x539f;&#x5219;\n    *   &#x6709;&#x65f6;&#x5019;&#x4e0d;&#x6e05;&#x695a; ByteBuf &#x88ab;&#x5f15;&#x7528;&#x4e86;&#x591a;&#x5c11;&#x6b21;&#xff0c;&#x4f46;&#x53c8;&#x5fc5;&#x987b;&#x5f7b;&#x5e95;&#x91ca;&#x653e;&#xff0c;&#x53ef;&#x4ee5;&#x5faa;&#x73af;&#x8c03;&#x7528; release &#x76f4;&#x5230;&#x8fd4;&#x56de; true\n\nTailContext &#x91ca;&#x653e;&#x672a;&#x5904;&#x7406;&#x6d88;&#x606f;&#x903b;&#x8f91;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2723,2740"}},{"content":"<pre data-lines=\"2741,2754\"><code class=\"language-java\">\n<span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">onUnhandledInboundMessage</span><span class=\"hljs-params\">(Object msg)</span> {\n    <span class=\"hljs-keyword\">try</span> {\n        logger.debug(\n            <span class=\"hljs-string\">&quot;Discarded inbound message {} that reached at the tail of the pipeline. &quot;</span> +\n            <span class=\"hljs-string\">&quot;Please check your pipeline configuration.&quot;</span>, msg);\n    } <span class=\"hljs-keyword\">finally</span> {\n        ReferenceCountUtil.release(msg);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2741,2754"}},{"content":"<pre data-lines=\"2755,2756\"><code>&#x5177;&#x4f53;&#x4ee3;&#x7801;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2755,2756"}},{"content":"<pre data-lines=\"2757,2767\"><code class=\"language-java\">\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">release</span><span class=\"hljs-params\">(Object msg)</span> {\n    <span class=\"hljs-keyword\">if</span> (msg <span class=\"hljs-keyword\">instanceof</span> ReferenceCounted) {\n        <span class=\"hljs-keyword\">return</span> ((ReferenceCounted) msg).release();\n    }\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2757,2767"}}],"payload":{"tag":"h4","lines":"2690,2691"}},{"content":"2.3.5.9&#x3001;slice","children":[{"content":"<pre data-lines=\"2770,2771\"><code>&#x3010;&#x96f6;&#x62f7;&#x8d1d;&#x3011;&#x7684;&#x4f53;&#x73b0;&#x4e4b;&#x4e00;&#xff0c;&#x5bf9;&#x539f;&#x59cb; ByteBuf &#x8fdb;&#x884c;&#x5207;&#x7247;&#x6210;&#x591a;&#x4e2a; ByteBuf&#xff0c;&#x5207;&#x7247;&#x540e;&#x7684; ByteBuf &#x5e76;&#x6ca1;&#x6709;&#x53d1;&#x751f;&#x5185;&#x5b58;&#x590d;&#x5236;&#xff0c;&#x8fd8;&#x662f;&#x4f7f;&#x7528;&#x539f;&#x59cb; ByteBuf &#x7684;&#x5185;&#x5b58;&#xff0c;&#x5207;&#x7247;&#x540e;&#x7684; ByteBuf &#x7ef4;&#x62a4;&#x72ec;&#x7acb;&#x7684; read&#xff0c;write &#x6307;&#x9488;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2770,2771"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/8b9907bdaff4fb4fde7a7d66d427ca10.png\" alt>","children":[],"payload":{"tag":"img","lines":"2772,2773"}},{"content":"<pre data-lines=\"2774,2775\"><code>&#x539f;&#x59cb; ByteBuf &#x8fdb;&#x884c;&#x4e00;&#x4e9b;&#x521d;&#x59cb;&#x64cd;&#x4f5c;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2774,2775"}},{"content":"<pre data-lines=\"2776,2783\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">origin</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(<span class=\"hljs-number\">10</span>);\norigin.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>});\norigin.readByte();\nSystem.out.println(ByteBufUtil.prettyHexDump(origin));\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2776,2783"}},{"content":"<pre data-lines=\"2784,2785\"><code>&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2784,2785"}},{"content":"<pre data-lines=\"2786,2794\"><code data-lines=\"2786,2794\"><span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 02 03 04                                        |...             |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2786,2794"}},{"content":"<pre data-lines=\"2795,2796\"><code>&#x8fd9;&#x65f6;&#x8c03;&#x7528; slice &#x8fdb;&#x884c;&#x5207;&#x7247;&#xff0c;&#x65e0;&#x53c2; slice &#x662f;&#x4ece;&#x539f;&#x59cb; ByteBuf &#x7684; read index &#x5230; write index &#x4e4b;&#x95f4;&#x7684;&#x5185;&#x5bb9;&#x8fdb;&#x884c;&#x5207;&#x7247;&#xff0c;&#x5207;&#x7247;&#x540e;&#x7684; max capacity &#x88ab;&#x56fa;&#x5b9a;&#x4e3a;&#x8fd9;&#x4e2a;&#x533a;&#x95f4;&#x7684;&#x5927;&#x5c0f;&#xff0c;&#x56e0;&#x6b64;&#x4e0d;&#x80fd;&#x8ffd;&#x52a0; write\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2795,2796"}},{"content":"<pre data-lines=\"2797,2803\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">slice</span> <span class=\"hljs-operator\">=</span> origin.slice();\nSystem.out.println(ByteBufUtil.prettyHexDump(slice));\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2797,2803"}},{"content":"<pre data-lines=\"2804,2805\"><code>&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2804,2805"}},{"content":"<pre data-lines=\"2806,2814\"><code data-lines=\"2806,2814\"><span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 02 03 04                                        |...             |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2806,2814"}},{"content":"<pre data-lines=\"2815,2816\"><code>&#x5982;&#x679c;&#x539f;&#x59cb; ByteBuf &#x518d;&#x6b21;&#x8bfb;&#x64cd;&#x4f5c;&#xff08;&#x53c8;&#x8bfb;&#x4e86;&#x4e00;&#x4e2a;&#x5b57;&#x8282;&#xff09;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2815,2816"}},{"content":"<pre data-lines=\"2817,2822\"><code class=\"language-java\">origin.readByte();\nSystem.out.println(ByteBufUtil.prettyHexDump(origin));\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2817,2822"}},{"content":"<pre data-lines=\"2823,2824\"><code>&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2823,2824"}},{"content":"<pre data-lines=\"2825,2833\"><code data-lines=\"2825,2833\"><span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 03 04                                           |..              |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2825,2833"}},{"content":"<pre data-lines=\"2834,2835\"><code>&#x8fd9;&#x65f6;&#x7684; slice &#x4e0d;&#x53d7;&#x5f71;&#x54cd;&#xff0c;&#x56e0;&#x4e3a;&#x5b83;&#x6709;&#x72ec;&#x7acb;&#x7684;&#x8bfb;&#x5199;&#x6307;&#x9488;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2834,2835"}},{"content":"<pre data-lines=\"2836,2840\"><code class=\"language-java\">System.out.println(ByteBufUtil.prettyHexDump(slice));\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2836,2840"}},{"content":"<pre data-lines=\"2841,2842\"><code>&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2841,2842"}},{"content":"<pre data-lines=\"2843,2851\"><code data-lines=\"2843,2851\"><span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 02 03 04                                        |...             |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2843,2851"}},{"content":"<pre data-lines=\"2852,2853\"><code>&#x5982;&#x679c; slice &#x7684;&#x5185;&#x5bb9;&#x53d1;&#x751f;&#x4e86;&#x66f4;&#x6539;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2852,2853"}},{"content":"<pre data-lines=\"2854,2859\"><code class=\"language-java\">slice.setByte(2, 5);\nSystem.out.println(ByteBufUtil.prettyHexDump(slice));\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2854,2859"}},{"content":"<pre data-lines=\"2860,2861\"><code>&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2860,2861"}},{"content":"<pre data-lines=\"2862,2870\"><code data-lines=\"2862,2870\"><span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 02 03 05                                        |...             |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2862,2870"}},{"content":"<pre data-lines=\"2871,2872\"><code>&#x8fd9;&#x65f6;&#xff0c;&#x539f;&#x59cb; ByteBuf &#x4e5f;&#x4f1a;&#x53d7;&#x5f71;&#x54cd;&#xff0c;&#x56e0;&#x4e3a;&#x5e95;&#x5c42;&#x90fd;&#x662f;&#x540c;&#x4e00;&#x5757;&#x5185;&#x5b58;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2871,2872"}},{"content":"<pre data-lines=\"2873,2877\"><code data-lines=\"2873,2877\"><span class=\"hljs-keyword\">System</span>.<span class=\"hljs-keyword\">out</span>.println(ByteBufUtil.prettyHexDump(origin));\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2873,2877"}},{"content":"<pre data-lines=\"2878,2879\"><code>&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2878,2879"}},{"content":"<pre data-lines=\"2880,2888\"><code data-lines=\"2880,2888\"><span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 03 05                                           |..              |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2880,2888"}}],"payload":{"tag":"h4","lines":"2768,2769"}},{"content":"2.3.5.10&#x3001;duplicate","children":[{"content":"<pre data-lines=\"2891,2892\"><code>&#x3010;&#x96f6;&#x62f7;&#x8d1d;&#x3011;&#x7684;&#x4f53;&#x73b0;&#x4e4b;&#x4e00;&#xff0c;&#x5c31;&#x597d;&#x6bd4;&#x622a;&#x53d6;&#x4e86;&#x539f;&#x59cb; ByteBuf &#x6240;&#x6709;&#x5185;&#x5bb9;&#xff0c;&#x5e76;&#x4e14;&#x6ca1;&#x6709; max capacity &#x7684;&#x9650;&#x5236;&#xff0c;&#x4e5f;&#x662f;&#x4e0e;&#x539f;&#x59cb; ByteBuf &#x4f7f;&#x7528;&#x540c;&#x4e00;&#x5757;&#x5e95;&#x5c42;&#x5185;&#x5b58;&#xff0c;&#x53ea;&#x662f;&#x8bfb;&#x5199;&#x6307;&#x9488;&#x662f;&#x72ec;&#x7acb;&#x7684;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2891,2892"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/0900ad613da4c33a79ade07521e25a86.png\" alt>","children":[],"payload":{"tag":"img","lines":"2893,2894"}},{"content":"<pre data-lines=\"2895,2899\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">duplicate</span> <span class=\"hljs-operator\">=</span> byteBuf.duplicate();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2895,2899"}}],"payload":{"tag":"h4","lines":"2889,2890"}},{"content":"2.3.5.11&#x3001;copy","children":[{"content":"<pre data-lines=\"2902,2903\"><code>&#x4f1a;&#x5c06;&#x5e95;&#x5c42;&#x5185;&#x5b58;&#x6570;&#x636e;&#x8fdb;&#x884c;&#x6df1;&#x62f7;&#x8d1d;&#xff0c;&#x56e0;&#x6b64;&#x65e0;&#x8bba;&#x8bfb;&#x5199;&#xff0c;&#x90fd;&#x4e0e;&#x539f;&#x59cb; ByteBuf &#x65e0;&#x5173;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2902,2903"}},{"content":"<pre data-lines=\"2904,2908\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">copy</span> <span class=\"hljs-operator\">=</span> byteBuf.copy();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2904,2908"}}],"payload":{"tag":"h4","lines":"2900,2901"}},{"content":"2.3.5.12&#x3001;CompositeByteBuf","children":[{"content":"<pre data-lines=\"2911,2914\"><code>&#x3010;&#x96f6;&#x62f7;&#x8d1d;&#x3011;&#x7684;&#x4f53;&#x73b0;&#x4e4b;&#x4e00;&#xff0c;&#x53ef;&#x4ee5;&#x5c06;&#x591a;&#x4e2a; ByteBuf &#x5408;&#x5e76;&#x4e3a;&#x4e00;&#x4e2a;&#x903b;&#x8f91;&#x4e0a;&#x7684; ByteBuf&#xff0c;&#x907f;&#x514d;&#x62f7;&#x8d1d;\n\n&#x6709;&#x4e24;&#x4e2a; ByteBuf &#x5982;&#x4e0b;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2911,2914"}},{"content":"<pre data-lines=\"2915,2924\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf1</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(<span class=\"hljs-number\">5</span>);\nbuf1.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>});\n<span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf2</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(<span class=\"hljs-number\">5</span>);\nbuf2.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">8</span>, <span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">10</span>});\nSystem.out.println(ByteBufUtil.prettyHexDump(buf1));\nSystem.out.println(ByteBufUtil.prettyHexDump(buf2));\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2915,2924"}},{"content":"<pre data-lines=\"2925,2926\"><code>&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2925,2926"}},{"content":"<pre data-lines=\"2927,2940\"><code data-lines=\"2927,2940\"><span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 01 02 03 04 05                                  |.....           |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 06 07 08 09 0a                                  |.....           |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2927,2940"}},{"content":"<pre data-lines=\"2941,2944\"><code>&#x73b0;&#x5728;&#x9700;&#x8981;&#x4e00;&#x4e2a;&#x65b0;&#x7684; ByteBuf&#xff0c;&#x5185;&#x5bb9;&#x6765;&#x81ea;&#x4e8e;&#x521a;&#x624d;&#x7684; buf1 &#x548c; buf2&#xff0c;&#x5982;&#x4f55;&#x5b9e;&#x73b0;&#xff1f;\n\n&#x65b9;&#x6cd5;1&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2941,2944"}},{"content":"<pre data-lines=\"2945,2952\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf3</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(buf1.readableBytes()+buf2.readableBytes());\nbuf3.writeBytes(buf1);\nbuf3.writeBytes(buf2);\nSystem.out.println(ByteBufUtil.prettyHexDump(buf3));\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2945,2952"}},{"content":"<pre data-lines=\"2953,2954\"><code>&#x7ed3;&#x679c;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2953,2954"}},{"content":"<pre data-lines=\"2955,2963\"><code data-lines=\"2955,2963\"><span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2955,2963"}},{"content":"<pre data-lines=\"2964,2967\"><code>&#x8fd9;&#x79cd;&#x65b9;&#x6cd5;&#x597d;&#x4e0d;&#x597d;&#xff1f;&#x56de;&#x7b54;&#x662f;&#x4e0d;&#x592a;&#x597d;&#xff0c;&#x56e0;&#x4e3a;&#x8fdb;&#x884c;&#x4e86;&#x6570;&#x636e;&#x7684;&#x5185;&#x5b58;&#x590d;&#x5236;&#x64cd;&#x4f5c;\n\n&#x65b9;&#x6cd5;2&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2964,2967"}},{"content":"<pre data-lines=\"2968,2974\"><code class=\"language-java\"><span class=\"hljs-type\">CompositeByteBuf</span> <span class=\"hljs-variable\">buf3</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.compositeBuffer();\n\nbuf3.addComponents(<span class=\"hljs-literal\">true</span>, buf1, buf2);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2968,2974"}},{"content":"<pre data-lines=\"2975,2976\"><code>&#x7ed3;&#x679c;&#x662f;&#x4e00;&#x6837;&#x7684;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2975,2976"}},{"content":"<pre data-lines=\"2977,2985\"><code data-lines=\"2977,2985\"><span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2977,2985"}},{"content":"<pre data-lines=\"2986,2990\"><code>CompositeByteBuf &#x662f;&#x4e00;&#x4e2a;&#x7ec4;&#x5408;&#x7684; ByteBuf&#xff0c;&#x5b83;&#x5185;&#x90e8;&#x7ef4;&#x62a4;&#x4e86;&#x4e00;&#x4e2a; Component &#x6570;&#x7ec4;&#xff0c;&#x6bcf;&#x4e2a; Component &#x7ba1;&#x7406;&#x4e00;&#x4e2a; ByteBuf&#xff0c;&#x8bb0;&#x5f55;&#x4e86;&#x8fd9;&#x4e2a; ByteBuf &#x76f8;&#x5bf9;&#x4e8e;&#x6574;&#x4f53;&#x504f;&#x79fb;&#x91cf;&#x7b49;&#x4fe1;&#x606f;&#xff0c;&#x4ee3;&#x8868;&#x7740;&#x6574;&#x4f53;&#x4e2d;&#x67d0;&#x4e00;&#x6bb5;&#x7684;&#x6570;&#x636e;&#x3002;\n\n*   &#x4f18;&#x70b9;&#xff0c;&#x5bf9;&#x5916;&#x662f;&#x4e00;&#x4e2a;&#x865a;&#x62df;&#x89c6;&#x56fe;&#xff0c;&#x7ec4;&#x5408;&#x8fd9;&#x4e9b; ByteBuf &#x4e0d;&#x4f1a;&#x4ea7;&#x751f;&#x5185;&#x5b58;&#x590d;&#x5236;\n*   &#x7f3a;&#x70b9;&#xff0c;&#x590d;&#x6742;&#x4e86;&#x5f88;&#x591a;&#xff0c;&#x591a;&#x6b21;&#x64cd;&#x4f5c;&#x4f1a;&#x5e26;&#x6765;&#x6027;&#x80fd;&#x7684;&#x635f;&#x8017;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2986,2990"}}],"payload":{"tag":"h4","lines":"2909,2910"}},{"content":"2.3.5.13&#x3001;Unpooled","children":[{"content":"<pre data-lines=\"2993,2996\"><code>Unpooled &#x662f;&#x4e00;&#x4e2a;&#x5de5;&#x5177;&#x7c7b;&#xff0c;&#x7c7b;&#x5982;&#x5176;&#x540d;&#xff0c;&#x63d0;&#x4f9b;&#x4e86;&#x975e;&#x6c60;&#x5316;&#x7684; ByteBuf &#x521b;&#x5efa;&#x3001;&#x7ec4;&#x5408;&#x3001;&#x590d;&#x5236;&#x7b49;&#x64cd;&#x4f5c;\n\n&#x8fd9;&#x91cc;&#x4ec5;&#x4ecb;&#x7ecd;&#x5176;&#x8ddf;&#x3010;&#x96f6;&#x62f7;&#x8d1d;&#x3011;&#x76f8;&#x5173;&#x7684; wrappedBuffer &#x65b9;&#x6cd5;&#xff0c;&#x53ef;&#x4ee5;&#x7528;&#x6765;&#x5305;&#x88c5; ByteBuf\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2993,2996"}},{"content":"<pre data-lines=\"2997,3008\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf1</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(<span class=\"hljs-number\">5</span>);\nbuf1.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>});\n<span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf2</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(<span class=\"hljs-number\">5</span>);\nbuf2.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">8</span>, <span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">10</span>});\n\n\n<span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf3</span> <span class=\"hljs-operator\">=</span> Unpooled.wrappedBuffer(buf1, buf2);\nSystem.out.println(ByteBufUtil.prettyHexDump(buf3));\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2997,3008"}},{"content":"<pre data-lines=\"3009,3010\"><code>&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3009,3010"}},{"content":"<pre data-lines=\"3011,3019\"><code data-lines=\"3011,3019\"><span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3011,3019"}},{"content":"<pre data-lines=\"3020,3021\"><code>&#x4e5f;&#x53ef;&#x4ee5;&#x7528;&#x6765;&#x5305;&#x88c5;&#x666e;&#x901a;&#x5b57;&#x8282;&#x6570;&#x7ec4;&#xff0c;&#x5e95;&#x5c42;&#x4e5f;&#x4e0d;&#x4f1a;&#x6709;&#x62f7;&#x8d1d;&#x64cd;&#x4f5c;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3020,3021"}},{"content":"<pre data-lines=\"3022,3028\"><code class=\"language-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf4</span> <span class=\"hljs-operator\">=</span> Unpooled.wrappedBuffer(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>}, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">6</span>});\nSystem.out.println(buf4.getClass());\nSystem.out.println(ByteBufUtil.prettyHexDump(buf4));\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3022,3028"}},{"content":"<pre data-lines=\"3029,3030\"><code>&#x8f93;&#x51fa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3029,3030"}},{"content":"<pre data-lines=\"3031,3040\"><code data-lines=\"3031,3040\">class io.netty.buffer.CompositeByteBuf\n<span class=\"hljs-code\">         +-------------------------------------------------+</span>\n<span class=\"hljs-section\">         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+</span>\n<span class=\"hljs-section\">|00000000| 01 02 03 04 05 06                               |......          |\n+--------+-------------------------------------------------+----------------+</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3031,3040"}}],"payload":{"tag":"h4","lines":"2991,2992"}},{"content":"2.3.5.14&#x3001;&#x4f18;&#x52bf;","children":[{"content":"<pre data-lines=\"3043,3048\"><code>*   &#x6c60;&#x5316; - &#x53ef;&#x4ee5;&#x91cd;&#x7528;&#x6c60;&#x4e2d; ByteBuf &#x5b9e;&#x4f8b;&#xff0c;&#x66f4;&#x8282;&#x7ea6;&#x5185;&#x5b58;&#xff0c;&#x51cf;&#x5c11;&#x5185;&#x5b58;&#x6ea2;&#x51fa;&#x7684;&#x53ef;&#x80fd;\n*   &#x8bfb;&#x5199;&#x6307;&#x9488;&#x5206;&#x79bb;&#xff0c;&#x4e0d;&#x9700;&#x8981;&#x50cf; ByteBuffer &#x4e00;&#x6837;&#x5207;&#x6362;&#x8bfb;&#x5199;&#x6a21;&#x5f0f;\n*   &#x53ef;&#x4ee5;&#x81ea;&#x52a8;&#x6269;&#x5bb9;\n*   &#x652f;&#x6301;&#x94fe;&#x5f0f;&#x8c03;&#x7528;&#xff0c;&#x4f7f;&#x7528;&#x66f4;&#x6d41;&#x7545;\n*   &#x5f88;&#x591a;&#x5730;&#x65b9;&#x4f53;&#x73b0;&#x96f6;&#x62f7;&#x8d1d;&#xff0c;&#x4f8b;&#x5982; slice&#x3001;duplicate&#x3001;CompositeByteBuf\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3043,3048"}}],"payload":{"tag":"h4","lines":"3041,3042"}}],"payload":{"tag":"h3","lines":"2439,2440"}}],"payload":{"tag":"h2","lines":"1721,1723"}},{"content":"2.4&#x3001;&#x6570;&#x636e;&#x7c98;&#x5305;&#x4e0e;&#x534a;&#x5305;","children":[{"content":"2.4.1&#x3001;&#x73b0;&#x8c61;&#x5206;&#x6790;","children":[{"content":"<pre data-lines=\"3054,3069\"><code>&#x7c98;&#x5305;\n\n*   &#x73b0;&#x8c61;&#xff0c;&#x53d1;&#x9001; abc def&#xff0c;&#x63a5;&#x6536; abcdef\n*   &#x539f;&#x56e0;\n    *   &#x5e94;&#x7528;&#x5c42;&#xff1a;&#x63a5;&#x6536;&#x65b9; ByteBuf &#x8bbe;&#x7f6e;&#x592a;&#x5927;&#xff08;Netty &#x9ed8;&#x8ba4; 1024&#xff09;\n    *   &#x6ed1;&#x52a8;&#x7a97;&#x53e3;&#xff1a;&#x5047;&#x8bbe;&#x53d1;&#x9001;&#x65b9; 256 bytes &#x8868;&#x793a;&#x4e00;&#x4e2a;&#x5b8c;&#x6574;&#x62a5;&#x6587;&#xff0c;&#x4f46;&#x7531;&#x4e8e;&#x63a5;&#x6536;&#x65b9;&#x5904;&#x7406;&#x4e0d;&#x53ca;&#x65f6;&#x4e14;&#x7a97;&#x53e3;&#x5927;&#x5c0f;&#x8db3;&#x591f;&#x5927;&#xff0c;&#x8fd9; 256 bytes &#x5b57;&#x8282;&#x5c31;&#x4f1a;&#x7f13;&#x51b2;&#x5728;&#x63a5;&#x6536;&#x65b9;&#x7684;&#x6ed1;&#x52a8;&#x7a97;&#x53e3;&#x4e2d;&#xff0c;&#x5f53;&#x6ed1;&#x52a8;&#x7a97;&#x53e3;&#x4e2d;&#x7f13;&#x51b2;&#x4e86;&#x591a;&#x4e2a;&#x62a5;&#x6587;&#x5c31;&#x4f1a;&#x7c98;&#x5305;\n    *   Nagle &#x7b97;&#x6cd5;&#xff1a;&#x4f1a;&#x9020;&#x6210;&#x7c98;&#x5305;\n\n&#x534a;&#x5305;\n\n*   &#x73b0;&#x8c61;&#xff0c;&#x53d1;&#x9001; abcdef&#xff0c;&#x63a5;&#x6536; abc def\n*   &#x539f;&#x56e0;\n    *   &#x5e94;&#x7528;&#x5c42;&#xff1a;&#x63a5;&#x6536;&#x65b9; ByteBuf &#x5c0f;&#x4e8e;&#x5b9e;&#x9645;&#x53d1;&#x9001;&#x6570;&#x636e;&#x91cf;\n    *   &#x6ed1;&#x52a8;&#x7a97;&#x53e3;&#xff1a;&#x5047;&#x8bbe;&#x63a5;&#x6536;&#x65b9;&#x7684;&#x7a97;&#x53e3;&#x53ea;&#x5269;&#x4e86; 128 bytes&#xff0c;&#x53d1;&#x9001;&#x65b9;&#x7684;&#x62a5;&#x6587;&#x5927;&#x5c0f;&#x662f; 256 bytes&#xff0c;&#x8fd9;&#x65f6;&#x653e;&#x4e0d;&#x4e0b;&#x4e86;&#xff0c;&#x53ea;&#x80fd;&#x5148;&#x53d1;&#x9001;&#x524d; 128 bytes&#xff0c;&#x7b49;&#x5f85; ack &#x540e;&#x624d;&#x80fd;&#x53d1;&#x9001;&#x5269;&#x4f59;&#x90e8;&#x5206;&#xff0c;&#x8fd9;&#x5c31;&#x9020;&#x6210;&#x4e86;&#x534a;&#x5305;\n    *   MSS &#x9650;&#x5236;&#xff1a;&#x5f53;&#x53d1;&#x9001;&#x7684;&#x6570;&#x636e;&#x8d85;&#x8fc7; MSS &#x9650;&#x5236;&#x540e;&#xff0c;&#x4f1a;&#x5c06;&#x6570;&#x636e;&#x5207;&#x5206;&#x53d1;&#x9001;&#xff0c;&#x5c31;&#x4f1a;&#x9020;&#x6210;&#x534a;&#x5305;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3054,3069"}}],"payload":{"tag":"h3","lines":"3052,3053"}},{"content":"2.4.2&#x3001;&#x95ee;&#x9898;&#x89e3;&#x51b3;","children":[{"content":"2.4.2.1&#x3001;&#x77ed;&#x94fe;&#x63a5;","children":[{"content":"<pre data-lines=\"3074,3077\"><code>&#x77ed;&#x94fe;&#x63a5;&#xff0c;&#x53d1;&#x4e00;&#x4e2a;&#x5305;&#x5efa;&#x7acb;&#x4e00;&#x6b21;&#x8fde;&#x63a5;&#xff0c;&#x8fd9;&#x6837;&#x8fde;&#x63a5;&#x5efa;&#x7acb;&#x5230;&#x8fde;&#x63a5;&#x65ad;&#x5f00;&#x4e4b;&#x95f4;&#x5c31;&#x662f;&#x6d88;&#x606f;&#x7684;&#x8fb9;&#x754c;&#xff0c;&#x7f3a;&#x70b9;&#x6548;&#x7387;&#x592a;&#x4f4e;&#xff0c;&#x7f3a;&#x70b9;&#x662f;&#x534a;&#x5305;&#x7528;&#x8fd9;&#x79cd;&#x529e;&#x6cd5;&#x8fd8;&#x662f;&#x4e0d;&#x597d;&#x89e3;&#x51b3;&#xff0c;&#x56e0;&#x4e3a;&#x63a5;&#x6536;&#x65b9;&#x7684;&#x7f13;&#x51b2;&#x533a;&#x5927;&#x5c0f;&#x662f;&#x6709;&#x9650;&#x7684;&#x3002;&#x4ee5;&#x89e3;&#x51b3;&#x7c98;&#x5305;&#x4e3a;&#x4f8b;&#xff1a;\n\n&#x670d;&#x52a1;&#x5668;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3074,3077"}},{"content":"<pre data-lines=\"3078,3106\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestShortLinkServer</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">boss</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">worker</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">ServerBootstrap</span> <span class=\"hljs-variable\">serverBootstrap</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>();\n            serverBootstrap.channel(NioServerSocketChannel.class);\n            serverBootstrap.group(boss, worker);\n            serverBootstrap.childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;SocketChannel&gt;() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(SocketChannel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LoggingHandler</span>(LogLevel.DEBUG));\n                }\n            });\n            <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> serverBootstrap.bind(<span class=\"hljs-number\">8080</span>).sync();\n            channelFuture.channel().closeFuture().sync();\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            log.error(<span class=\"hljs-string\">&quot;server error&quot;</span>, e);\n        } <span class=\"hljs-keyword\">finally</span> {\n            boss.shutdownGracefully();\n            worker.shutdownGracefully();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3078,3106"}},{"content":"<pre data-lines=\"3107,3108\"><code>&#x5ba2;&#x6237;&#x7aef;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3107,3108"}},{"content":"<pre data-lines=\"3109,3150\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestShortLinkClient</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">3</span>; i++) {\n            send();\n        }\n        System.out.println(<span class=\"hljs-string\">&quot;finish&quot;</span>);\n    }\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">send</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">worker</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">Bootstrap</span> <span class=\"hljs-variable\">bootstrap</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(worker);\n            bootstrap.handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;SocketChannel&gt;() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(SocketChannel ch)</span> {\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                        <span class=\"hljs-meta\">@Override</span>\n                        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelActive</span><span class=\"hljs-params\">(ChannelHandlerContext ctx)</span> {\n                            <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> ctx.alloc().buffer(<span class=\"hljs-number\">16</span>);\n                            buf.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">8</span>, <span class=\"hljs-number\">9</span>});\n                            ctx.writeAndFlush(buf);\n                            ctx.channel().close();\n                        }\n                    });\n                }\n            });\n            <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> bootstrap.connect(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8080</span>).sync();\n            channelFuture.channel().closeFuture().sync();\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            log.error(<span class=\"hljs-string\">&quot;client error&quot;</span>, e);\n        } <span class=\"hljs-keyword\">finally</span> {\n            worker.shutdownGracefully();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3109,3150"}},{"content":"<pre data-lines=\"3151,3152\"><code>&#x670d;&#x52a1;&#x5668;&#x8f93;&#x51fa;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3151,3152"}},{"content":"<pre data-lines=\"3153,3177\"><code class=\"language-java\">\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 01 02 03 04 05 06 07 08 09                   |..........      |\n+--------+-------------------------------------------------+----------------+\n\n\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 01 02 03 04 05 06 07 08 09                   |..........      |\n+--------+-------------------------------------------------+----------------+\n\n\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 01 02 03 04 05 06 07 08 09                   |..........      |\n+--------+-------------------------------------------------+----------------+\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3153,3177"}}],"payload":{"tag":"h4","lines":"3072,3073"}},{"content":"2.4.2.2&#x3001;&#x56fa;&#x5b9a;&#x957f;&#x5ea6;","children":[{"content":"<pre data-lines=\"3180,3183\"><code>&#x6bcf;&#x4e00;&#x6761;&#x6d88;&#x606f;&#x91c7;&#x7528;&#x56fa;&#x5b9a;&#x957f;&#x5ea6;&#xff0c;&#x7f3a;&#x70b9;&#x6d6a;&#x8d39;&#x7a7a;&#x95f4;&#x3002;&#x8ba9;&#x6240;&#x6709;&#x6570;&#x636e;&#x5305;&#x957f;&#x5ea6;&#x56fa;&#x5b9a;&#xff08;&#x5047;&#x8bbe;&#x957f;&#x5ea6;&#x4e3a; 8 &#x5b57;&#x8282;&#xff09;&#xff0c;&#x670d;&#x52a1;&#x5668;&#x7aef;&#x52a0;&#x5165; `ch.pipeline().addLast(new FixedLengthFrameDecoder(8));`&#x3002;&#x5ba2;&#x6237;&#x7aef;&#x6d4b;&#x8bd5;&#x4ee3;&#x7801;&#xff0c;&#x6ce8;&#x610f;&#x91c7;&#x7528;&#x8fd9;&#x79cd;&#x65b9;&#x6cd5;&#x540e;&#xff0c;&#x5ba2;&#x6237;&#x7aef;&#x4ec0;&#x4e48;&#x65f6;&#x5019; flush &#x90fd;&#x53ef;&#x4ee5;&#x3002;\n\n&#x670d;&#x52a1;&#x5668;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3180,3183"}},{"content":"<pre data-lines=\"3184,3213\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestFixedLengthServer</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">boss</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">worker</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">ServerBootstrap</span> <span class=\"hljs-variable\">serverBootstrap</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>();\n            serverBootstrap.channel(NioServerSocketChannel.class);\n            serverBootstrap.group(boss, worker);\n            serverBootstrap.childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;SocketChannel&gt;() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(SocketChannel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FixedLengthFrameDecoder</span>(<span class=\"hljs-number\">8</span>));\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LoggingHandler</span>(LogLevel.DEBUG));\n                }\n            });\n            <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> serverBootstrap.bind(<span class=\"hljs-number\">8080</span>).sync();\n            channelFuture.channel().closeFuture().sync();\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            log.error(<span class=\"hljs-string\">&quot;server error&quot;</span>, e);\n        } <span class=\"hljs-keyword\">finally</span> {\n            boss.shutdownGracefully();\n            worker.shutdownGracefully();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3184,3213"}},{"content":"<pre data-lines=\"3214,3215\"><code>&#x5ba2;&#x6237;&#x7aef;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3214,3215"}},{"content":"<pre data-lines=\"3216,3257\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestFixedLengthClient</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">worker</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">Bootstrap</span> <span class=\"hljs-variable\">bootstrap</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(worker);\n            bootstrap.handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;SocketChannel&gt;() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(SocketChannel ch)</span> {\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                        <span class=\"hljs-meta\">@Override</span>\n                        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelActive</span><span class=\"hljs-params\">(ChannelHandlerContext ctx)</span> {\n                            \n                            <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ctx.alloc().buffer();\n                            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">3</span>; i++) {\n                                <span class=\"hljs-type\">byte</span>[] bytes = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[<span class=\"hljs-number\">8</span>];\n                                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; j &lt; <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Random</span>().nextInt(<span class=\"hljs-number\">8</span>); j++) {\n                                    bytes[j] = (<span class=\"hljs-type\">byte</span>) (i + <span class=\"hljs-number\">65</span>);\n                                }\n                                buffer.writeBytes(bytes);\n                            }\n                            ctx.writeAndFlush(buffer);\n                            log.debug(<span class=\"hljs-string\">&quot;finish&quot;</span>);\n                        }\n                    });\n                }\n            });\n            <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> bootstrap.connect(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8080</span>).sync();\n            channelFuture.channel().closeFuture().sync();\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            log.error(<span class=\"hljs-string\">&quot;client error&quot;</span>, e);\n        } <span class=\"hljs-keyword\">finally</span> {\n            worker.shutdownGracefully();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3216,3257"}},{"content":"<pre data-lines=\"3258,3259\"><code>&#x670d;&#x52a1;&#x5668;&#x8f93;&#x51fa;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3258,3259"}},{"content":"<pre data-lines=\"3260,3283\"><code class=\"language-java\">\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 41 00 00 00 00 00 00 00                         |A.......        |\n+--------+-------------------------------------------------+----------------+\n\n\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 42 42 42 00 00 00 00 00                         |BBB.....        |\n+--------+-------------------------------------------------+----------------+\n\n\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 43 43 43 43 43 00 00 00                         |CCCCC...        |\n+--------+-------------------------------------------------+----------------+\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3260,3283"}}],"payload":{"tag":"h4","lines":"3178,3179"}},{"content":"2.4.2.3&#x3001;&#x56fa;&#x5b9a;&#x5206;&#x9694;&#x7b26;","children":[{"content":"<pre data-lines=\"3286,3289\"><code>&#x6bcf;&#x4e00;&#x6761;&#x6d88;&#x606f;&#x91c7;&#x7528;&#x5206;&#x9694;&#x7b26;&#xff0c;&#x9ed8;&#x8ba4;&#x4ee5; \\\\n &#x6216; \\\\r\\\\n &#x4f5c;&#x4e3a;&#x5206;&#x9694;&#x7b26;&#xff0c;&#x5982;&#x679c;&#x8d85;&#x51fa;&#x6307;&#x5b9a;&#x957f;&#x5ea6;&#x4ecd;&#x672a;&#x51fa;&#x73b0;&#x5206;&#x9694;&#x7b26;&#xff0c;&#x5219;&#x629b;&#x51fa;&#x5f02;&#x5e38;&#xff0c;&#x7f3a;&#x70b9;&#x9700;&#x8981;&#x8f6c;&#x4e49;&#x3002;&#x670d;&#x52a1;&#x5668;&#x7aef;&#x52a0;&#x5165;`ch.pipeline().addLast(new LineBasedFrameDecoder(1024));`&#x3002;\n\n&#x670d;&#x52a1;&#x5668;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3286,3289"}},{"content":"<pre data-lines=\"3290,3319\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestLineBasedFrameDecoderServer</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">boss</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">worker</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">ServerBootstrap</span> <span class=\"hljs-variable\">serverBootstrap</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>();\n            serverBootstrap.channel(NioServerSocketChannel.class);\n            serverBootstrap.group(boss, worker);\n            serverBootstrap.childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;SocketChannel&gt;() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(SocketChannel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LineBasedFrameDecoder</span>(<span class=\"hljs-number\">1024</span>));\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LoggingHandler</span>(LogLevel.DEBUG));\n                }\n            });\n            <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> serverBootstrap.bind(<span class=\"hljs-number\">8080</span>).sync();\n            channelFuture.channel().closeFuture().sync();\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            log.error(<span class=\"hljs-string\">&quot;server error&quot;</span>, e);\n        } <span class=\"hljs-keyword\">finally</span> {\n            boss.shutdownGracefully();\n            worker.shutdownGracefully();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3290,3319"}},{"content":"<pre data-lines=\"3320,3321\"><code>&#x5ba2;&#x6237;&#x7aef;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3320,3321"}},{"content":"<pre data-lines=\"3322,3362\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestLineBasedFrameDecoderClient</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">worker</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">Bootstrap</span> <span class=\"hljs-variable\">bootstrap</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(worker);\n            bootstrap.handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;SocketChannel&gt;() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(SocketChannel ch)</span> {\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                        <span class=\"hljs-meta\">@Override</span>\n                        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelActive</span><span class=\"hljs-params\">(ChannelHandlerContext ctx)</span> {\n                            \n                            <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ctx.alloc().buffer();\n                            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">3</span>; i++) {\n                                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; j &lt; <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Random</span>().nextInt(<span class=\"hljs-number\">8</span>); j++) {\n                                    buffer.writeByte((<span class=\"hljs-type\">byte</span>) (i + <span class=\"hljs-number\">65</span>));\n                                }\n                                buffer.writeByte(<span class=\"hljs-number\">10</span>);\n                            }\n                            ctx.writeAndFlush(buffer);\n                            log.debug(<span class=\"hljs-string\">&quot;finish&quot;</span>);\n                        }\n                    });\n                }\n            });\n            <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> bootstrap.connect(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8080</span>).sync();\n            channelFuture.channel().closeFuture().sync();\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            log.error(<span class=\"hljs-string\">&quot;client error&quot;</span>, e);\n        } <span class=\"hljs-keyword\">finally</span> {\n            worker.shutdownGracefully();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3322,3362"}},{"content":"<pre data-lines=\"3363,3364\"><code>&#x670d;&#x52a1;&#x5668;&#x8f93;&#x51fa;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3363,3364"}},{"content":"<pre data-lines=\"3365,3389\"><code class=\"language-java\">\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 41 41                                           |AA              |\n+--------+-------------------------------------------------+----------------+\n\n\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 42 42                                           |BB              |\n+--------+-------------------------------------------------+----------------+\n\n\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 43                                              |C               |\n+--------+-------------------------------------------------+----------------+\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3365,3389"}}],"payload":{"tag":"h4","lines":"3284,3285"}},{"content":"2.4.2.4&#x3001;&#x9884;&#x8bbe;&#x957f;&#x5ea6;","children":[{"content":"<pre data-lines=\"3392,3395\"><code>&#x6bcf;&#x4e00;&#x6761;&#x6d88;&#x606f;&#x5206;&#x4e3a; head &#x548c; body&#xff0c;head &#x4e2d;&#x5305;&#x542b; body &#x7684;&#x957f;&#x5ea6;&#xff0c;&#x5728;&#x53d1;&#x9001;&#x6d88;&#x606f;&#x524d;&#xff0c;&#x5148;&#x7ea6;&#x5b9a;&#x7528;&#x5b9a;&#x957f;&#x5b57;&#x8282;&#x8868;&#x793a;&#x63a5;&#x4e0b;&#x6765;&#x6570;&#x636e;&#x7684;&#x957f;&#x5ea6;&#x3002;\n\n&#x670d;&#x52a1;&#x5668;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3392,3395"}},{"content":"<pre data-lines=\"3396,3426\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestLengthFieldBasedFrameDecoderServer</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">boss</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">worker</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">ServerBootstrap</span> <span class=\"hljs-variable\">serverBootstrap</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>();\n            serverBootstrap.channel(NioServerSocketChannel.class);\n            serverBootstrap.group(boss, worker);\n            serverBootstrap.childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;SocketChannel&gt;() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(SocketChannel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n                    \n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LengthFieldBasedFrameDecoder</span>(<span class=\"hljs-number\">1024</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>));\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LoggingHandler</span>(LogLevel.DEBUG));\n                }\n            });\n            <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> serverBootstrap.bind(<span class=\"hljs-number\">8080</span>).sync();\n            channelFuture.channel().closeFuture().sync();\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            log.error(<span class=\"hljs-string\">&quot;server error&quot;</span>, e);\n        } <span class=\"hljs-keyword\">finally</span> {\n            boss.shutdownGracefully();\n            worker.shutdownGracefully();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3396,3426"}},{"content":"<pre data-lines=\"3427,3428\"><code>&#x5ba2;&#x6237;&#x7aef;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3427,3428"}},{"content":"<pre data-lines=\"3429,3474\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestLengthFieldBasedFrameDecoderClient</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">worker</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">Bootstrap</span> <span class=\"hljs-variable\">bootstrap</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(worker);\n            bootstrap.handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;SocketChannel&gt;() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(SocketChannel ch)</span> {\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                        <span class=\"hljs-meta\">@Override</span>\n                        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelActive</span><span class=\"hljs-params\">(ChannelHandlerContext ctx)</span> {\n                            \n                            <span class=\"hljs-type\">char</span> <span class=\"hljs-variable\">c</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&apos;a&apos;</span>;\n                            <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ctx.alloc().buffer();\n                            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">3</span>; i++) {\n                                <span class=\"hljs-type\">byte</span> <span class=\"hljs-variable\">length</span> <span class=\"hljs-operator\">=</span> (<span class=\"hljs-type\">byte</span>) (<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Random</span>().nextInt(<span class=\"hljs-number\">16</span>) + <span class=\"hljs-number\">1</span>);\n                                \n                                buffer.writeByte(length);\n                                \n                                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span>; j &lt;= length; j++) {\n                                    buffer.writeByte((<span class=\"hljs-type\">byte</span>) c);\n                                }\n                                c++;\n                            }\n                            ctx.writeAndFlush(buffer);\n                            log.debug(<span class=\"hljs-string\">&quot;finish&quot;</span>);\n                        }\n                    });\n                }\n            });\n            <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> bootstrap.connect(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8080</span>).sync();\n            channelFuture.channel().closeFuture().sync();\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            log.error(<span class=\"hljs-string\">&quot;client error&quot;</span>, e);\n        } <span class=\"hljs-keyword\">finally</span> {\n            worker.shutdownGracefully();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3429,3474"}},{"content":"<pre data-lines=\"3475,3476\"><code>&#x670d;&#x52a1;&#x5668;&#x8f93;&#x51fa;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3475,3476"}},{"content":"<pre data-lines=\"3477,3499\"><code class=\"language-java\">\n+--------+-------------------------------------------------+----------------+\n|00000000| 41 41 41 41 41 41 41 41 41 41 41 41             |AAAAAAAAAAAA    |\n+--------+-------------------------------------------------+----------------+\n\n\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 42 42                                           |BB              |\n+--------+-------------------------------------------------+----------------+\n\n\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 43 43 43                                        |CCC             |\n+--------+-------------------------------------------------+----------------+\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3477,3499"}}],"payload":{"tag":"h4","lines":"3390,3391"}}],"payload":{"tag":"h3","lines":"3070,3071"}}],"payload":{"tag":"h2","lines":"3049,3051"}},{"content":"2.5&#x3001;&#x534f;&#x8bae;&#x8bbe;&#x8ba1;&#x4e0e;&#x89e3;&#x6790;","children":[{"content":"2.5.1&#x3001;&#x4e3a;&#x4ec0;&#x4e48;&#x9700;&#x8981;&#x534f;&#x8bae;","children":[{"content":"<pre data-lines=\"3505,3508\"><code>TCP/IP &#x4e2d;&#x6d88;&#x606f;&#x4f20;&#x8f93;&#x57fa;&#x4e8e;&#x6d41;&#x7684;&#x65b9;&#x5f0f;&#xff0c;&#x6ca1;&#x6709;&#x8fb9;&#x754c;&#x3002;&#x534f;&#x8bae;&#x7684;&#x76ee;&#x7684;&#x5c31;&#x662f;&#x5212;&#x5b9a;&#x6d88;&#x606f;&#x7684;&#x8fb9;&#x754c;&#xff0c;&#x5236;&#x5b9a;&#x901a;&#x4fe1;&#x53cc;&#x65b9;&#x8981;&#x5171;&#x540c;&#x9075;&#x5b88;&#x7684;&#x901a;&#x4fe1;&#x89c4;&#x5219;&#x3002;\n\n&#x4f8b;&#x5982;&#xff1a;&#x5728;&#x7f51;&#x7edc;&#x4e0a;&#x4f20;&#x8f93;&#x4e0b;&#x9762;&#x8fd9;&#x53e5;&#x8bdd;&#x8457;&#x540d;&#x7684;&#x65e0;&#x6807;&#x70b9;&#x7b26;&#x53f7;&#x53e5;&#x5b50;&#xff0c;&#x5728;&#x6ca1;&#x6709;&#x6807;&#x70b9;&#x7b26;&#x53f7;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;&#x8fd9;&#x53e5;&#x8bdd;&#x6709;&#x6570;&#x79cd;&#x62c6;&#x89e3;&#x65b9;&#x5f0f;&#xff0c;&#x800c;&#x610f;&#x601d;&#x5374;&#x662f;&#x5b8c;&#x5168;&#x4e0d;&#x540c;&#xff0c;&#x6240;&#x4ee5;&#x5e38;&#x88ab;&#x7528;&#x4f5c;&#x8bb2;&#x8ff0;&#x6807;&#x70b9;&#x7b26;&#x53f7;&#x7684;&#x91cd;&#x8981;&#x6027;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3505,3508"}},{"content":"<pre data-lines=\"3509,3513\"><code data-lines=\"3509,3513\">&#x4e0b;&#x96e8;&#x5929;&#x7559;&#x5ba2;&#x5929;&#x7559;&#x6211;&#x4e0d;&#x7559;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3509,3513"}},{"content":"<pre data-lines=\"3514,3515\"><code>&#x4e00;&#x79cd;&#x89e3;&#x8bfb;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3514,3515"}},{"content":"<pre data-lines=\"3516,3520\"><code data-lines=\"3516,3520\">&#x4e0b;&#x96e8;&#x5929;&#x7559;&#x5ba2;&#xff0c;&#x5929;&#x7559;&#xff0c;&#x6211;&#x4e0d;&#x7559;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3516,3520"}},{"content":"<pre data-lines=\"3521,3522\"><code>&#x53e6;&#x4e00;&#x89e3;&#x8bfb;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3521,3522"}},{"content":"<pre data-lines=\"3523,3527\"><code data-lines=\"3523,3527\">&#x4e0b;&#x96e8;&#x5929;&#xff0c;&#x7559;&#x5ba2;&#x5929;&#xff0c;&#x7559;&#x6211;&#x4e0d;&#xff1f;&#x7559;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3523,3527"}},{"content":"<pre data-lines=\"3528,3529\"><code>&#x5982;&#x4f55;&#x8bbe;&#x8ba1;&#x534f;&#x8bae;&#x5462;&#xff1f;&#x5176;&#x5b9e;&#x5c31;&#x662f;&#x7ed9;&#x7f51;&#x7edc;&#x4f20;&#x8f93;&#x7684;&#x4fe1;&#x606f;&#x52a0;&#x4e0a;&#x201c;&#x6807;&#x70b9;&#x7b26;&#x53f7;&#x201d;&#x3002;&#x4f46;&#x901a;&#x8fc7;&#x5206;&#x9694;&#x7b26;&#x6765;&#x65ad;&#x53e5;&#x4e0d;&#x662f;&#x5f88;&#x597d;&#xff0c;&#x56e0;&#x4e3a;&#x5206;&#x9694;&#x7b26;&#x672c;&#x8eab;&#x5982;&#x679c;&#x7528;&#x4e8e;&#x4f20;&#x8f93;&#xff0c;&#x90a3;&#x4e48;&#x5fc5;&#x987b;&#x52a0;&#x4ee5;&#x533a;&#x5206;&#x3002;&#x56e0;&#x6b64;&#xff0c;&#x4e0b;&#x9762;&#x4e00;&#x79cd;&#x534f;&#x8bae;&#x8f83;&#x4e3a;&#x5e38;&#x7528;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3528,3529"}},{"content":"<pre data-lines=\"3530,3534\"><code data-lines=\"3530,3534\">&#x5b9a;&#x957f;&#x5b57;&#x8282;&#x8868;&#x793a;&#x5185;&#x5bb9;&#x957f;&#x5ea6; + &#x5b9e;&#x9645;&#x5185;&#x5bb9;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3530,3534"}},{"content":"<pre data-lines=\"3535,3536\"><code>&#x4f8b;&#x5982;&#xff0c;&#x5047;&#x8bbe;&#x4e00;&#x4e2a;&#x4e2d;&#x6587;&#x5b57;&#x7b26;&#x957f;&#x5ea6;&#x4e3a; 3&#xff0c;&#x6309;&#x7167;&#x4e0a;&#x8ff0;&#x534f;&#x8bae;&#x7684;&#x89c4;&#x5219;&#xff0c;&#x53d1;&#x9001;&#x4fe1;&#x606f;&#x65b9;&#x5f0f;&#x5982;&#x4e0b;&#xff0c;&#x5c31;&#x4e0d;&#x4f1a;&#x88ab;&#x63a5;&#x6536;&#x65b9;&#x5f04;&#x9519;&#x610f;&#x601d;&#x4e86;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3535,3536"}},{"content":"<pre data-lines=\"3537,3541\"><code data-lines=\"3537,3541\"><span class=\"hljs-attribute\">0f</span>&#x4e0b;&#x96e8;&#x5929;&#x7559;&#x5ba2;<span class=\"hljs-number\">06</span>&#x5929;&#x7559;<span class=\"hljs-number\">09</span>&#x6211;&#x4e0d;&#x7559;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3537,3541"}}],"payload":{"tag":"h3","lines":"3503,3504"}},{"content":"2.5.2&#x3001;redis &#x534f;&#x8bae;&#x4e3e;&#x4f8b;","children":[{"content":"<pre data-lines=\"3544,3545\"><code>Windows Redis&#x4e0b;&#x8f7d;&#x5730;&#x5740;&#xff1a;https://github.com/MicrosoftArchive/redis/releases\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3544,3545"}},{"content":"<pre data-lines=\"3546,3620\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestRedisClient</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">worker</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-type\">byte</span>[] LINE = {<span class=\"hljs-number\">13</span>, <span class=\"hljs-number\">10</span>};\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">Bootstrap</span> <span class=\"hljs-variable\">bootstrap</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>();\n            bootstrap.channel(NioSocketChannel.class);\n            bootstrap.group(worker);\n            bootstrap.handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;SocketChannel&gt;() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(SocketChannel ch)</span> {\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LoggingHandler</span>());\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                        <span class=\"hljs-meta\">@Override</span> \n                        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelActive</span><span class=\"hljs-params\">(ChannelHandlerContext ctx)</span> {\n                            set(ctx);\n                            get(ctx);\n                        }\n\n                        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">set</span><span class=\"hljs-params\">(ChannelHandlerContext ctx)</span> {\n                            <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> ctx.alloc().buffer();\n                            buf.writeBytes(<span class=\"hljs-string\">&quot;*3&quot;</span>.getBytes());\n                            buf.writeBytes(LINE);\n                            buf.writeBytes(<span class=\"hljs-string\">&quot;&#x24;3&quot;</span>.getBytes());\n                            buf.writeBytes(LINE);\n                            buf.writeBytes(<span class=\"hljs-string\">&quot;set&quot;</span>.getBytes());\n                            buf.writeBytes(LINE);\n                            buf.writeBytes(<span class=\"hljs-string\">&quot;&#x24;8&quot;</span>.getBytes());\n                            buf.writeBytes(LINE);\n                            buf.writeBytes(<span class=\"hljs-string\">&quot;username&quot;</span>.getBytes());\n                            buf.writeBytes(LINE);\n                            buf.writeBytes(<span class=\"hljs-string\">&quot;&#x24;8&quot;</span>.getBytes());\n                            buf.writeBytes(LINE);\n                            buf.writeBytes(<span class=\"hljs-string\">&quot;zhangsan&quot;</span>.getBytes());\n                            buf.writeBytes(LINE);\n                            ctx.writeAndFlush(buf);\n                        }\n\n                        <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">get</span><span class=\"hljs-params\">(ChannelHandlerContext ctx)</span> {\n                            <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> ctx.alloc().buffer();\n                            buf.writeBytes(<span class=\"hljs-string\">&quot;*2&quot;</span>.getBytes());\n                            buf.writeBytes(LINE);\n                            buf.writeBytes(<span class=\"hljs-string\">&quot;&#x24;3&quot;</span>.getBytes());\n                            buf.writeBytes(LINE);\n                            buf.writeBytes(<span class=\"hljs-string\">&quot;get&quot;</span>.getBytes());\n                            buf.writeBytes(LINE);\n                            buf.writeBytes(<span class=\"hljs-string\">&quot;&#x24;8&quot;</span>.getBytes());\n                            buf.writeBytes(LINE);\n                            buf.writeBytes(<span class=\"hljs-string\">&quot;username&quot;</span>.getBytes());\n                            buf.writeBytes(LINE);\n                            ctx.writeAndFlush(buf);\n                        }\n\n                        <span class=\"hljs-meta\">@Override</span>\n                        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> <span class=\"hljs-keyword\">throws</span> Exception{\n                            <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> (ByteBuf) msg;\n                            System.out.println(buf.toString(Charset.defaultCharset()));\n                        }\n                    });\n                }\n            });\n            <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> bootstrap.connect(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">6379</span>).sync();\n            channelFuture.channel().closeFuture().sync();\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            log.error(<span class=\"hljs-string\">&quot;client error&quot;</span>, e);\n        } <span class=\"hljs-keyword\">finally</span> {\n            worker.shutdownGracefully();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3546,3620"}},{"content":"<pre data-lines=\"3621,3650\"><code class=\"language-java\">\n\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 2a 33 0d 0a 24 33 0d 0a 73 65 74 0d 0a 24 38 0d |*3..&#x24;3..set..&#x24;8.|\n|00000010| 0a 75 73 65 72 6e 61 6d 65 0d 0a 24 38 0d 0a 7a |.username..&#x24;8..z|\n|00000020| 68 61 6e 67 73 61 6e 0d 0a                      |hangsan..       |\n+--------+-------------------------------------------------+----------------+\n\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 2a 32 0d 0a 24 33 0d 0a 67 65 74 0d 0a 24 38 0d |*2..&#x24;3..get..&#x24;8.|\n|00000010| 0a 75 73 65 72 6e 61 6d 65 0d 0a                |.username..     |\n+--------+-------------------------------------------------+----------------+\n\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 2b 4f 4b 0d 0a 24 38 0d 0a 7a 68 61 6e 67 73 61 |+OK..&#x24;8..zhangsa|\n|00000010| 6e 0d 0a                                        |n..             |\n+--------+-------------------------------------------------+----------------+\n+OK\n&#x24;8\nzhangsan\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3621,3650"}}],"payload":{"tag":"h3","lines":"3542,3543"}},{"content":"2.5.3&#x3001;http &#x534f;&#x8bae;&#x4e3e;&#x4f8b;","children":[{"content":"<pre data-lines=\"3653,3654\"><code>&#x6253;&#x5f00;Google Chrome&#x6d4f;&#x89c8;&#x5668;&#x8f93;&#x5165;&#xff1a;http://localhost:8080/\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3653,3654"}},{"content":"<pre data-lines=\"3655,3700\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestHttpClient</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">boss</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">worker</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">ServerBootstrap</span> <span class=\"hljs-variable\">serverBootstrap</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>();\n            serverBootstrap.channel(NioServerSocketChannel.class);\n            serverBootstrap.group(boss, worker);\n            serverBootstrap.childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;SocketChannel&gt;() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(SocketChannel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LoggingHandler</span>(LogLevel.DEBUG));\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HttpServerCodec</span>());\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SimpleChannelInboundHandler</span>&lt;HttpRequest&gt;() {\n                        <span class=\"hljs-meta\">@Override</span>\n                        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead0</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, HttpRequest msg)</span> \n                            <span class=\"hljs-keyword\">throws</span> Exception {\n                            \n                            log.debug(msg.uri());\n                            \n                            <span class=\"hljs-type\">DefaultFullHttpResponse</span> <span class=\"hljs-variable\">response</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultFullHttpResponse</span>(msg.protocolVersion(), HttpResponseStatus.OK);\n                            <span class=\"hljs-type\">byte</span>[] bytes = <span class=\"hljs-string\">&quot;&lt;h1&gt;Hello, world!&lt;/h1&gt;&quot;</span>.getBytes();\n                            response.headers().set(HttpHeaderNames.CONTENT_TYPE, <span class=\"hljs-string\">&quot;text/html&quot;</span>);\n                            response.headers().setInt(HttpHeaderNames.CONTENT_LENGTH, bytes.length);\n                            response.content().writeBytes(bytes);\n                            \n                            ctx.writeAndFlush(response);\n                        }\n                    });\n                }\n            });\n            <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> serverBootstrap.bind(<span class=\"hljs-number\">8080</span>).sync();\n            channelFuture.channel().closeFuture().sync();\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            log.error(<span class=\"hljs-string\">&quot;server error&quot;</span>, e);\n        } <span class=\"hljs-keyword\">finally</span> {\n            boss.shutdownGracefully();\n            worker.shutdownGracefully();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3655,3700"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/33ae9f5dde12b0076bfd76e830e9ba62.png\" alt>","children":[],"payload":{"tag":"img","lines":"3701,3702"}},{"content":"<pre data-lines=\"3703,3737\"><code class=\"language-java\">\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 47 45 54 20 2f 20 48 54 54 50 2f 31 2e 31 0d 0a |GET / HTTP/1.1..|\n|00000010| 48 6f 73 74 3a 20 6c 6f 63 61 6c 68 6f 73 74 3a |Host: localhost:|\n|00000020| 38 30 38 30 0d 0a 43 6f 6e 6e 65 63 74 69 6f 6e |8080..Connection|\n|00000030| 3a 20 6b 65 65 70 2d 61 6c 69 76 65 0d 0a 43 61 |: keep-alive..Ca|\n|00000040| 63 68 65 2d 43 6f 6e 74 72 6f 6c 3a 20 6d 61 78 |che-Control: max|\n|00000050| 2d 61 67 65 3d 30 0d 0a 73 65 63 2d 63 68 2d 75 |-age=0..sec-ch-u|\n|00000060| 61 3a 20 22 20 4e 6f 74 3b 41 20 42 72 61 6e 64 |a: &quot; Not;A Brand|\n|00000070| 22 3b 76 3d 22 39 39 22 2c 20 22 47 6f 6f 67 6c |&quot;;v=&quot;99&quot;, &quot;Googl|\n|00000080| 65 20 43 68 72 6f 6d 65 22 3b 76 3d 22 39 31 22 |e Chrome&quot;;v=&quot;91&quot;|\n|00000090| 2c 20 22 43 68 72 6f 6d 69 75 6d 22 3b 76 3d 22 |, &quot;Chromium&quot;;v=&quot;|\n|000000a0| 39 31 22 0d 0a 73 65 63 2d 63 68 2d 75 61 2d 6d |91&quot;..sec-ch-ua-m|\n|000000b0| 6f 62 69 6c 65 3a 20 3f 30 0d 0a 55 70 67 72 61 |obile: ?0..Upgra|\n|000000c0| 64 65 2d 49 6e 73 65 63 75 72 65 2d 52 65 71 75 |de-Insecure-Requ|\n|000000d0| 65 73 74 73 3a 20 31 0d 0a 55 73 65 72 2d 41 67 |ests: 1..User-Ag|\n|000000e0| 65 6e 74 3a 20 4d 6f 7a 69 6c 6c 61 2f 35 2e 30 |ent: Mozilla/5.0|\n|000000f0| 20 28 57 69 6e 64 6f 77 73 20 4e 54 20 31 30 2e | (Windows NT 10.|\n|00000100| 30 3b 20 57 69 6e 36 34 3b 20 78 36 34 29 20 41 |0; Win64; x64) A|\n|00000110| 70 70 6c 65 57 65 62 4b 69 74 2f 35 33 37 2e 33 |ppleWebKit/537.3|\n|00000120| 36 20 28 4b 48 54 4d 4c 2c 20 6c 69 6b 65 20 47 |6 (KHTML, like G|\n|00000130| 65 63 6b 6f 29 20 43 68 72 6f 6d 65 2f 39 31 2e |ecko) Chrome/91.|\n|00000140| 30 2e 34 34 37 32 2e 31 31 34 20 53 61 66 61 72 |0.4472.114 Safar|\n|00000150| 69 2f 35 33 37 2e 33 36 0d 0a 41 63 63 65 70 74 |i/537.36..Accept|\n|00000160| 3a 20 74 65 78 74 2f 68 74 6d 6c 2c 61 70 70 6c |: text/html,appl|\n|00000170| 69 63 61 74 69 6f 6e 2f 78 68 74 6d 6c 2b 78 6d |ication/xhtml+xm|\n|00000180| 6c 2c 61 70 70 6c 69 63 61 74 69 6f 6e 2f 78 6d |l,application/xm|\n|00000190| 6c 3b 71 3d 30 2e 39 2c 69 6d 61 67 65 2f 61 76 |l;q=0.9,image/av|\n|000001a0| 69 66 2c 69 6d 61 67 65 2f 77 65 62 70 2c 69 6d |if,image/webp,im|\n|000001b0| 61 67 65 2f 61 70 6e 67 2c 2a 2f 2a 3b 71 3d 30 |age/apng,*\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3703,3737"}}],"payload":{"tag":"h3","lines":"3651,3652"}},{"content":"2.5.4&#x3001;&#x81ea;&#x5b9a;&#x4e49;&#x534f;&#x8bae;","children":[{"content":"2.5.4.1&#x3001;&#x7ec4;&#x6210;&#x90e8;&#x5206;","children":[{"content":"<pre data-lines=\"3742,3749\"><code>*   &#x9b54;&#x6570;&#xff0c;&#x7528;&#x6765;&#x5728;&#x7b2c;&#x4e00;&#x65f6;&#x95f4;&#x5224;&#x5b9a;&#x662f;&#x5426;&#x662f;&#x65e0;&#x6548;&#x6570;&#x636e;&#x5305;\n*   &#x7248;&#x672c;&#x53f7;&#xff0c;&#x53ef;&#x4ee5;&#x652f;&#x6301;&#x534f;&#x8bae;&#x7684;&#x5347;&#x7ea7;\n*   &#x5e8f;&#x5217;&#x5316;&#x7b97;&#x6cd5;&#xff0c;&#x6d88;&#x606f;&#x6b63;&#x6587;&#x5230;&#x5e95;&#x91c7;&#x7528;&#x54ea;&#x79cd;&#x5e8f;&#x5217;&#x5316;&#x53cd;&#x5e8f;&#x5217;&#x5316;&#x65b9;&#x5f0f;&#xff0c;&#x53ef;&#x4ee5;&#x7531;&#x6b64;&#x6269;&#x5c55;&#xff0c;&#x4f8b;&#x5982;&#xff1a;json&#x3001;protobuf&#x3001;hessian&#x3001;jdk\n*   &#x6307;&#x4ee4;&#x7c7b;&#x578b;&#xff0c;&#x662f;&#x767b;&#x5f55;&#x3001;&#x6ce8;&#x518c;&#x3001;&#x5355;&#x804a;&#x3001;&#x7fa4;&#x804a;&#x2026; &#x8ddf;&#x4e1a;&#x52a1;&#x76f8;&#x5173;\n*   &#x8bf7;&#x6c42;&#x5e8f;&#x53f7;&#xff0c;&#x4e3a;&#x4e86;&#x53cc;&#x5de5;&#x901a;&#x4fe1;&#xff0c;&#x63d0;&#x4f9b;&#x5f02;&#x6b65;&#x80fd;&#x529b;\n*   &#x6b63;&#x6587;&#x957f;&#x5ea6;\n*   &#x6d88;&#x606f;&#x6b63;&#x6587;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3742,3749"}}],"payload":{"tag":"h4","lines":"3740,3741"}},{"content":"2.5.4.2&#x3001;&#x7f16;&#x7801;&#x89e3;&#x7801;","children":[{"content":"<pre data-lines=\"3752,3755\"><code>&#x6839;&#x636e;&#x4e0a;&#x9762;&#x7684;&#x8981;&#x7d20;&#xff0c;&#x8bbe;&#x8ba1;&#x4e00;&#x4e2a;&#x767b;&#x5f55;&#x8bf7;&#x6c42;&#x6d88;&#x606f;&#x548c;&#x767b;&#x5f55;&#x54cd;&#x5e94;&#x6d88;&#x606f;&#xff0c;&#x5e76;&#x4f7f;&#x7528; Netty &#x5b8c;&#x6210;&#x6536;&#x53d1;&#x3002;\n\nMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3752,3755"}},{"content":"<pre data-lines=\"3756,3765\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Message</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">Serializable</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> sequenceId;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> messageType;\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">getMessageType</span><span class=\"hljs-params\">()</span>;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3756,3765"}},{"content":"<pre data-lines=\"3766,3767\"><code>LoginRequestMessage\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3766,3767"}},{"content":"<pre data-lines=\"3768,3784\"><code class=\"language-java\"><span class=\"hljs-meta\">@Data</span>\n<span class=\"hljs-meta\">@NoArgsConstructor</span>\n<span class=\"hljs-meta\">@AllArgsConstructor</span>\n<span class=\"hljs-meta\">@ToString(callSuper = true)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">LoginRequestMessage</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">Message</span> {\n    <span class=\"hljs-keyword\">private</span> String username;\n    <span class=\"hljs-keyword\">private</span> String password;\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">getMessageType</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3768,3784"}},{"content":"<pre data-lines=\"3785,3786\"><code>MessageCodec\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3785,3786"}},{"content":"<pre data-lines=\"3787,3835\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MessageCodec</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">ByteToMessageCodec</span>&lt;Message&gt; {\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">encode</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Message msg, ByteBuf out)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        \n        out.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>});\n        \n        out.writeByte(<span class=\"hljs-number\">1</span>);\n        \n        out.writeByte(<span class=\"hljs-number\">0</span>);\n        \n        out.writeByte(msg.getMessageType());\n        \n        out.writeInt(msg.getSequenceId());\n        \n        out.writeByte(<span class=\"hljs-number\">0xff</span>);\n        \n        <span class=\"hljs-type\">ByteArrayOutputStream</span> <span class=\"hljs-variable\">baos</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ByteArrayOutputStream</span>();\n        <span class=\"hljs-type\">ObjectOutputStream</span> <span class=\"hljs-variable\">oos</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ObjectOutputStream</span>(baos);\n        oos.writeObject(msg);\n        <span class=\"hljs-type\">byte</span>[] bytes = baos.toByteArray();\n        \n        out.writeInt(bytes.length);\n        \n        out.writeBytes(bytes);\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">decode</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">magicNum</span> <span class=\"hljs-operator\">=</span> in.readInt();\n        <span class=\"hljs-type\">byte</span> <span class=\"hljs-variable\">version</span> <span class=\"hljs-operator\">=</span> in.readByte();\n        <span class=\"hljs-type\">byte</span> <span class=\"hljs-variable\">serializerType</span> <span class=\"hljs-operator\">=</span> in.readByte();\n        <span class=\"hljs-type\">byte</span> <span class=\"hljs-variable\">messageType</span> <span class=\"hljs-operator\">=</span> in.readByte();\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">sequenceId</span> <span class=\"hljs-operator\">=</span> in.readInt();\n        in.readByte();\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">length</span> <span class=\"hljs-operator\">=</span> in.readInt();\n        <span class=\"hljs-type\">byte</span>[] bytes = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[length];\n        in.readBytes(bytes, <span class=\"hljs-number\">0</span>, length);\n        <span class=\"hljs-type\">ObjectInputStream</span> <span class=\"hljs-variable\">ois</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ObjectInputStream</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ByteArrayInputStream</span>(bytes));\n        <span class=\"hljs-type\">Message</span> <span class=\"hljs-variable\">message</span> <span class=\"hljs-operator\">=</span> (Message) ois.readObject();\n        log.debug(<span class=\"hljs-string\">&quot;{}, {}, {}, {}, {}, {}&quot;</span>, magicNum, version, serializerType, messageType, sequenceId, length);\n        log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, message);\n        out.add(message);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3787,3835"}},{"content":"<pre data-lines=\"3836,3837\"><code>MessageCodecTest\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3836,3837"}},{"content":"<pre data-lines=\"3838,3858\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MessageCodecTest</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-type\">EmbeddedChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">EmbeddedChannel</span>(\n                <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LoggingHandler</span>(),\n                <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LengthFieldBasedFrameDecoder</span>(<span class=\"hljs-number\">1024</span>, <span class=\"hljs-number\">12</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>),\n                <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MessageCodec</span>()\n        );\n        \n        <span class=\"hljs-type\">LoginRequestMessage</span> <span class=\"hljs-variable\">message</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LoginRequestMessage</span>(<span class=\"hljs-string\">&quot;zhangsan&quot;</span>, <span class=\"hljs-string\">&quot;123456&quot;</span>);\n        channel.writeOutbound(message);\n        \n        <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MessageCodec</span>().encode(<span class=\"hljs-literal\">null</span>, message, buf);\n        channel.writeInbound(buf);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3838,3858"}},{"content":"<pre data-lines=\"3859,3908\"><code class=\"language-java\">13:54:16 [DEBUG] [main] i.n.h.l.LoggingHandler - [id: 0xembedded, L:embedded - R:embedded] REGISTERED\n13:54:16 [DEBUG] [main] i.n.h.l.LoggingHandler - [id: 0xembedded, L:embedded - R:embedded] ACTIVE\n13:54:16 [DEBUG] [main] i.n.h.l.LoggingHandler - [id: 0xembedded, L:embedded - R:embedded] WRITE: 235B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 01 00 00 00 00 00 00 ff 00 00 00 db |................|\n|00000010| ac ed 00 05 73 72 00 2e 69 6f 2e 67 69 74 68 75 |....sr..io.githu|\n|00000020| 62 2e 63 61 6f 63 68 65 6e 6c 65 69 2e 6e 65 74 |b.caochenlei.net|\n|00000030| 74 79 2e 4c 6f 67 69 6e 52 65 71 75 65 73 74 4d |ty.LoginRequestM|\n|00000040| 65 73 73 61 67 65 0d 67 e9 62 ba ea 90 23 02 00 |essage.g.b...#..|\n|00000050| 02 4c 00 08 70 61 73 73 77 6f 72 64 74 00 12 4c |.L..passwordt..L|\n|00000060| 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 |java/lang/String|\n|00000070| 3b 4c 00 08 75 73 65 72 6e 61 6d 65 71 00 7e 00 |;L..usernameq.~.|\n|00000080| 01 78 72 00 22 69 6f 2e 67 69 74 68 75 62 2e 63 |.xr.&quot;io.github.c|\n|00000090| 61 6f 63 68 65 6e 6c 65 69 2e 6e 65 74 74 79 2e |aochenlei.netty.|\n|000000a0| 4d 65 73 73 61 67 65 fc 71 85 c5 da 75 83 87 02 |Message.q...u...|\n|000000b0| 00 02 49 00 0b 6d 65 73 73 61 67 65 54 79 70 65 |..I..messageType|\n|000000c0| 49 00 0a 73 65 71 75 65 6e 63 65 49 64 78 70 00 |I..sequenceIdxp.|\n|000000d0| 00 00 00 00 00 00 00 74 00 06 31 32 33 34 35 36 |.......t..123456|\n|000000e0| 74 00 08 7a 68 61 6e 67 73 61 6e                |t..zhangsan     |\n+--------+-------------------------------------------------+----------------+\n13:54:16 [DEBUG] [main] i.n.h.l.LoggingHandler - [id: 0xembedded, L:embedded - R:embedded] FLUSH\n13:54:16 [DEBUG] [main] i.n.h.l.LoggingHandler - [id: 0xembedded, L:embedded - R:embedded] READ: 235B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 01 00 00 00 00 00 00 ff 00 00 00 db |................|\n|00000010| ac ed 00 05 73 72 00 2e 69 6f 2e 67 69 74 68 75 |....sr..io.githu|\n|00000020| 62 2e 63 61 6f 63 68 65 6e 6c 65 69 2e 6e 65 74 |b.caochenlei.net|\n|00000030| 74 79 2e 4c 6f 67 69 6e 52 65 71 75 65 73 74 4d |ty.LoginRequestM|\n|00000040| 65 73 73 61 67 65 0d 67 e9 62 ba ea 90 23 02 00 |essage.g.b...#..|\n|00000050| 02 4c 00 08 70 61 73 73 77 6f 72 64 74 00 12 4c |.L..passwordt..L|\n|00000060| 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 |java/lang/String|\n|00000070| 3b 4c 00 08 75 73 65 72 6e 61 6d 65 71 00 7e 00 |;L..usernameq.~.|\n|00000080| 01 78 72 00 22 69 6f 2e 67 69 74 68 75 62 2e 63 |.xr.&quot;io.github.c|\n|00000090| 61 6f 63 68 65 6e 6c 65 69 2e 6e 65 74 74 79 2e |aochenlei.netty.|\n|000000a0| 4d 65 73 73 61 67 65 fc 71 85 c5 da 75 83 87 02 |Message.q...u...|\n|000000b0| 00 02 49 00 0b 6d 65 73 73 61 67 65 54 79 70 65 |..I..messageType|\n|000000c0| 49 00 0a 73 65 71 75 65 6e 63 65 49 64 78 70 00 |I..sequenceIdxp.|\n|000000d0| 00 00 00 00 00 00 00 74 00 06 31 32 33 34 35 36 |.......t..123456|\n|000000e0| 74 00 08 7a 68 61 6e 67 73 61 6e                |t..zhangsan     |\n+--------+-------------------------------------------------+----------------+\n13:54:16 [DEBUG] [main] i.g.c.n.MessageCodec - 16909060, 1, 0, 0, 0, 219\n13:54:16 [DEBUG] [main] i.g.c.n.MessageCodec - LoginRequestMessage(super=Message(sequenceId=0, messageType=0), username=zhangsan, password=123456)\n13:54:16 [DEBUG] [main] i.n.h.l.LoggingHandler - [id: 0xembedded, L:embedded - R:embedded] READ COMPLETE\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3859,3908"}},{"content":"<pre data-lines=\"3909,3910\"><code>&#x89e3;&#x8bfb;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3909,3910"}},{"content":"<img src=\"https://gitee.com/caochenlei/blog-images/raw/master/20210626140327.png\" alt>","children":[],"payload":{"tag":"img","lines":"3911,3912"}},{"content":"<pre data-lines=\"3913,3918\"><code>@Sharable&#x6ce8;&#x89e3;&#xff0c;&#x4ec0;&#x4e48;&#x65f6;&#x5019;&#x53ef;&#x4ee5;&#x52a0; @Sharable&#xff1f;\n\n*   &#x5f53; handler &#x4e0d;&#x4fdd;&#x5b58;&#x72b6;&#x6001;&#x65f6;&#xff0c;&#x5c31;&#x53ef;&#x4ee5;&#x5b89;&#x5168;&#x5730;&#x5728;&#x591a;&#x7ebf;&#x7a0b;&#x4e0b;&#x88ab;&#x5171;&#x4eab;\n*   &#x4f46;&#x8981;&#x6ce8;&#x610f;&#x5bf9;&#x4e8e;&#x7f16;&#x89e3;&#x7801;&#x5668;&#x7c7b;&#xff0c;&#x4e0d;&#x80fd;&#x7ee7;&#x627f; ByteToMessageCodec &#x6216; CombinedChannelDuplexHandler &#x7236;&#x7c7b;&#xff0c;&#x4ed6;&#x4eec;&#x7684;&#x6784;&#x9020;&#x65b9;&#x6cd5;&#x5bf9; @Sharable &#x6709;&#x9650;&#x5236;\n*   &#x5982;&#x679c;&#x80fd;&#x786e;&#x4fdd;&#x7f16;&#x89e3;&#x7801;&#x5668;&#x4e0d;&#x4f1a;&#x4fdd;&#x5b58;&#x72b6;&#x6001;&#xff0c;&#x53ef;&#x4ee5;&#x7ee7;&#x627f; MessageToMessageCodec &#x7236;&#x7c7b;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3913,3918"}},{"content":"<pre data-lines=\"3919,3971\"><code class=\"language-java\">\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-meta\">@ChannelHandler</span>.Sharable\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MessageCodecSharable</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">MessageToMessageCodec</span>&lt;ByteBuf, Message&gt; {\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">encode</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Message msg, List&lt;Object&gt; outs)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">out</span> <span class=\"hljs-operator\">=</span> ctx.alloc().buffer();\n        \n        out.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>});\n        \n        out.writeByte(<span class=\"hljs-number\">1</span>);\n        \n        out.writeByte(<span class=\"hljs-number\">0</span>);\n        \n        out.writeByte(msg.getMessageType());\n        \n        out.writeInt(msg.getSequenceId());\n        \n        out.writeByte(<span class=\"hljs-number\">0xff</span>);\n        \n        <span class=\"hljs-type\">ByteArrayOutputStream</span> <span class=\"hljs-variable\">bos</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ByteArrayOutputStream</span>();\n        <span class=\"hljs-type\">ObjectOutputStream</span> <span class=\"hljs-variable\">oos</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ObjectOutputStream</span>(bos);\n        oos.writeObject(msg);\n        <span class=\"hljs-type\">byte</span>[] bytes = bos.toByteArray();\n        \n        out.writeInt(bytes.length);\n        \n        out.writeBytes(bytes);\n        outs.add(out);\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">decode</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">magicNum</span> <span class=\"hljs-operator\">=</span> in.readInt();\n        <span class=\"hljs-type\">byte</span> <span class=\"hljs-variable\">version</span> <span class=\"hljs-operator\">=</span> in.readByte();\n        <span class=\"hljs-type\">byte</span> <span class=\"hljs-variable\">serializerType</span> <span class=\"hljs-operator\">=</span> in.readByte();\n        <span class=\"hljs-type\">byte</span> <span class=\"hljs-variable\">messageType</span> <span class=\"hljs-operator\">=</span> in.readByte();\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">sequenceId</span> <span class=\"hljs-operator\">=</span> in.readInt();\n        in.readByte();\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">length</span> <span class=\"hljs-operator\">=</span> in.readInt();\n        <span class=\"hljs-type\">byte</span>[] bytes = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[length];\n        in.readBytes(bytes, <span class=\"hljs-number\">0</span>, length);\n        <span class=\"hljs-type\">ObjectInputStream</span> <span class=\"hljs-variable\">ois</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ObjectInputStream</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ByteArrayInputStream</span>(bytes));\n        <span class=\"hljs-type\">Message</span> <span class=\"hljs-variable\">message</span> <span class=\"hljs-operator\">=</span> (Message) ois.readObject();\n        log.debug(<span class=\"hljs-string\">&quot;{}, {}, {}, {}, {}, {}&quot;</span>, magicNum, version, serializerType, messageType, sequenceId, length);\n        log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, message);\n        out.add(message);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3919,3971"}}],"payload":{"tag":"h4","lines":"3750,3751"}}],"payload":{"tag":"h3","lines":"3738,3739"}}],"payload":{"tag":"h2","lines":"3500,3502"}},{"content":"2.6&#x3001;&#x8fde;&#x63a5;&#x5047;&#x6b7b;","children":[{"content":"<pre data-lines=\"3975,3989\"><code>&#x539f;&#x56e0;&#xff1a;\n\n*   &#x7f51;&#x7edc;&#x8bbe;&#x5907;&#x51fa;&#x73b0;&#x6545;&#x969c;&#xff0c;&#x4f8b;&#x5982;&#x7f51;&#x5361;&#xff0c;&#x673a;&#x623f;&#x7b49;&#xff0c;&#x5e95;&#x5c42;&#x7684; TCP &#x8fde;&#x63a5;&#x5df2;&#x7ecf;&#x65ad;&#x5f00;&#x4e86;&#xff0c;&#x4f46;&#x5e94;&#x7528;&#x7a0b;&#x5e8f;&#x6ca1;&#x6709;&#x611f;&#x77e5;&#x5230;&#xff0c;&#x4ecd;&#x7136;&#x5360;&#x7528;&#x7740;&#x8d44;&#x6e90;&#x3002;\n*   &#x516c;&#x7f51;&#x7f51;&#x7edc;&#x4e0d;&#x7a33;&#x5b9a;&#xff0c;&#x51fa;&#x73b0;&#x4e22;&#x5305;&#x3002;&#x5982;&#x679c;&#x8fde;&#x7eed;&#x51fa;&#x73b0;&#x4e22;&#x5305;&#xff0c;&#x8fd9;&#x65f6;&#x73b0;&#x8c61;&#x5c31;&#x662f;&#x5ba2;&#x6237;&#x7aef;&#x6570;&#x636e;&#x53d1;&#x4e0d;&#x51fa;&#x53bb;&#xff0c;&#x670d;&#x52a1;&#x7aef;&#x4e5f;&#x4e00;&#x76f4;&#x6536;&#x4e0d;&#x5230;&#x6570;&#x636e;&#xff0c;&#x5c31;&#x8fd9;&#x4e48;&#x4e00;&#x76f4;&#x8017;&#x7740;&#x3002;\n*   &#x5e94;&#x7528;&#x7a0b;&#x5e8f;&#x7ebf;&#x7a0b;&#x963b;&#x585e;&#xff0c;&#x65e0;&#x6cd5;&#x8fdb;&#x884c;&#x6570;&#x636e;&#x8bfb;&#x5199;&#x3002;\n\n&#x95ee;&#x9898;&#xff1a;\n\n*   &#x5047;&#x6b7b;&#x7684;&#x8fde;&#x63a5;&#x5360;&#x7528;&#x7684;&#x8d44;&#x6e90;&#x4e0d;&#x80fd;&#x81ea;&#x52a8;&#x91ca;&#x653e;&#x3002;\n*   &#x5411;&#x5047;&#x6b7b;&#x7684;&#x8fde;&#x63a5;&#x53d1;&#x9001;&#x6570;&#x636e;&#xff0c;&#x5f97;&#x5230;&#x7684;&#x53cd;&#x9988;&#x662f;&#x53d1;&#x9001;&#x8d85;&#x65f6;&#x3002;\n\n&#x670d;&#x52a1;&#x5668;&#x5b9a;&#x65f6;&#x68c0;&#x67e5;&#xff1a;\n\n*   &#x600e;&#x4e48;&#x5224;&#x65ad;&#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x662f;&#x5426;&#x5047;&#x6b7b;&#x5462;&#xff1f;&#x5982;&#x679c;&#x80fd;&#x6536;&#x5230;&#x5ba2;&#x6237;&#x7aef;&#x6570;&#x636e;&#xff0c;&#x8bf4;&#x660e;&#x6ca1;&#x6709;&#x5047;&#x6b7b;&#x3002;&#x56e0;&#x6b64;&#x7b56;&#x7565;&#x5c31;&#x53ef;&#x4ee5;&#x5b9a;&#x4e3a;&#xff0c;&#x6bcf;&#x9694;&#x4e00;&#x6bb5;&#x65f6;&#x95f4;&#x5c31;&#x68c0;&#x67e5;&#x8fd9;&#x6bb5;&#x65f6;&#x95f4;&#x5185;&#x662f;&#x5426;&#x63a5;&#x6536;&#x5230;&#x5ba2;&#x6237;&#x7aef;&#x6570;&#x636e;&#xff0c;&#x6ca1;&#x6709;&#x5c31;&#x53ef;&#x4ee5;&#x5224;&#x5b9a;&#x4e3a;&#x8fde;&#x63a5;&#x5047;&#x6b7b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3975,3989"}},{"content":"<pre data-lines=\"3990,4009\"><code class=\"language-java\">\n\nch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">IdleStateHandler</span>(<span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>));\n\nch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelDuplexHandler</span>() {\n    \n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">userEventTriggered</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object evt)</span> <span class=\"hljs-keyword\">throws</span> Exception{\n        <span class=\"hljs-type\">IdleStateEvent</span> <span class=\"hljs-variable\">event</span> <span class=\"hljs-operator\">=</span> (IdleStateEvent) evt;\n        \n        <span class=\"hljs-keyword\">if</span> (event.state() == IdleState.READER_IDLE) {\n            log.debug(<span class=\"hljs-string\">&quot;&#x5df2;&#x7ecf; 5s &#x6ca1;&#x6709;&#x8bfb;&#x5230;&#x6570;&#x636e;&#x4e86;&quot;</span>);\n            ctx.channel().close();\n        }\n    }\n});\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3990,4009"}},{"content":"<pre data-lines=\"4010,4013\"><code>&#x5ba2;&#x6237;&#x7aef;&#x5b9a;&#x65f6;&#x5fc3;&#x8df3;&#xff1a;\n\n*   &#x5ba2;&#x6237;&#x7aef;&#x53ef;&#x4ee5;&#x5b9a;&#x65f6;&#x5411;&#x670d;&#x52a1;&#x5668;&#x7aef;&#x53d1;&#x9001;&#x6570;&#x636e;&#xff0c;&#x53ea;&#x8981;&#x8fd9;&#x4e2a;&#x65f6;&#x95f4;&#x95f4;&#x9694;&#x5c0f;&#x4e8e;&#x670d;&#x52a1;&#x5668;&#x5b9a;&#x4e49;&#x7684;&#x7a7a;&#x95f2;&#x68c0;&#x6d4b;&#x7684;&#x65f6;&#x95f4;&#x95f4;&#x9694;&#xff0c;&#x90a3;&#x4e48;&#x5c31;&#x80fd;&#x9632;&#x6b62;&#x524d;&#x9762;&#x63d0;&#x5230;&#x7684;&#x8bef;&#x5224;&#xff0c;&#x5ba2;&#x6237;&#x7aef;&#x53ef;&#x4ee5;&#x5b9a;&#x4e49;&#x5982;&#x4e0b;&#x5fc3;&#x8df3;&#x5904;&#x7406;&#x5668;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4010,4013"}},{"content":"<pre data-lines=\"4014,4033\"><code class=\"language-java\">\n\nch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">IdleStateHandler</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">0</span>));\n\nch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelDuplexHandler</span>() {\n    \n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">userEventTriggered</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object evt)</span> <span class=\"hljs-keyword\">throws</span> Exception{\n        <span class=\"hljs-type\">IdleStateEvent</span> <span class=\"hljs-variable\">event</span> <span class=\"hljs-operator\">=</span> (IdleStateEvent) evt;\n        \n        <span class=\"hljs-keyword\">if</span> (event.state() == IdleState.WRITER_IDLE) {\n            \n            ctx.writeAndFlush(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PingMessage</span>());\n        }\n    }\n});\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4014,4033"}}],"payload":{"tag":"h2","lines":"3972,3974"}},{"content":"2.7&#x3001;&#x53c2;&#x6570;&#x8c03;&#x4f18;","children":[{"content":"2.7.1&#x3001;CONNECT_TIMEOUT_MILLIS","children":[{"content":"<pre data-lines=\"4041,4046\"><code>*   &#x5c5e;&#x4e8e; SocketChannal &#x53c2;&#x6570;\n    \n*   &#x7528;&#x5728;&#x5ba2;&#x6237;&#x7aef;&#x5efa;&#x7acb;&#x8fde;&#x63a5;&#x65f6;&#xff0c;&#x5982;&#x679c;&#x5728;&#x6307;&#x5b9a;&#x6beb;&#x79d2;&#x5185;&#x65e0;&#x6cd5;&#x8fde;&#x63a5;&#xff0c;&#x4f1a;&#x629b;&#x51fa; timeout &#x5f02;&#x5e38;\n    \n*   SO\\_TIMEOUT &#x4e3b;&#x8981;&#x7528;&#x5728;&#x963b;&#x585e; IO&#xff0c;&#x963b;&#x585e; IO &#x4e2d; accept&#xff0c;read &#x7b49;&#x90fd;&#x662f;&#x65e0;&#x9650;&#x7b49;&#x5f85;&#x7684;&#xff0c;&#x5982;&#x679c;&#x4e0d;&#x5e0c;&#x671b;&#x6c38;&#x8fdc;&#x963b;&#x585e;&#xff0c;&#x4f7f;&#x7528;&#x5b83;&#x8c03;&#x6574;&#x8d85;&#x65f6;&#x65f6;&#x95f4;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4041,4046"}},{"content":"<pre data-lines=\"4048,4071\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestConnectionTimeout</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">group</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">Bootstrap</span> <span class=\"hljs-variable\">bootstrap</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n                    .group(group)\n                    .option(ChannelOption.CONNECT_TIMEOUT_MILLIS, <span class=\"hljs-number\">300</span>)\n                    .channel(NioSocketChannel.class)\n                    .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LoggingHandler</span>());\n            <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">future</span> <span class=\"hljs-operator\">=</span> bootstrap.connect(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8080</span>);\n            future.sync().channel().closeFuture().sync(); \n        } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n            e.printStackTrace();\n            log.debug(<span class=\"hljs-string\">&quot;timeout&quot;</span>);\n        } <span class=\"hljs-keyword\">finally</span> {\n            group.shutdownGracefully();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4048,4071"}}],"payload":{"tag":"h3","lines":"4039,4040"}},{"content":"2.7.2&#x3001;SO_BACKLOG","children":[{"content":"<pre data-lines=\"4074,4075\"><code>*   &#x5c5e;&#x4e8e; ServerSocketChannal &#x53c2;&#x6570;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4074,4075"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/563007bc417798c91d6856b0bd913771.png\" alt>","children":[],"payload":{"tag":"img","lines":"4076,4077"}},{"content":"<pre data-lines=\"4078,4093\"><code>1.  &#x7b2c;&#x4e00;&#x6b21;&#x63e1;&#x624b;&#xff0c;client &#x53d1;&#x9001; SYN &#x5230; server&#xff0c;&#x72b6;&#x6001;&#x4fee;&#x6539;&#x4e3a; SYN\\_SEND&#xff0c;server &#x6536;&#x5230;&#xff0c;&#x72b6;&#x6001;&#x6539;&#x53d8;&#x4e3a; SYN\\_REVD&#xff0c;&#x5e76;&#x5c06;&#x8be5;&#x8bf7;&#x6c42;&#x653e;&#x5165; sync queue &#x961f;&#x5217;\n2.  &#x7b2c;&#x4e8c;&#x6b21;&#x63e1;&#x624b;&#xff0c;server &#x56de;&#x590d; SYN + ACK &#x7ed9; client&#xff0c;client &#x6536;&#x5230;&#xff0c;&#x72b6;&#x6001;&#x6539;&#x53d8;&#x4e3a; ESTABLISHED&#xff0c;&#x5e76;&#x53d1;&#x9001; ACK &#x7ed9; server\n3.  &#x7b2c;&#x4e09;&#x6b21;&#x63e1;&#x624b;&#xff0c;server &#x6536;&#x5230; ACK&#xff0c;&#x72b6;&#x6001;&#x6539;&#x53d8;&#x4e3a; ESTABLISHED&#xff0c;&#x5c06;&#x8be5;&#x8bf7;&#x6c42;&#x4ece; sync queue &#x653e;&#x5165; accept queue\n\n&#x6ce8;&#x610f;&#xff1a;\n\n*   &#x5728; linux 2.2 &#x4e4b;&#x524d;&#xff0c;backlog &#x5927;&#x5c0f;&#x5305;&#x62ec;&#x4e86;&#x4e24;&#x4e2a;&#x961f;&#x5217;&#x7684;&#x5927;&#x5c0f;&#xff0c;&#x5728; 2.2 &#x4e4b;&#x540e;&#xff0c;&#x5206;&#x522b;&#x7528;&#x4e0b;&#x9762;&#x4e24;&#x4e2a;&#x53c2;&#x6570;&#x6765;&#x63a7;&#x5236;\n    \n*   sync queue - &#x534a;&#x8fde;&#x63a5;&#x961f;&#x5217;\n    \n    *   &#x5927;&#x5c0f;&#x901a;&#x8fc7; /proc/sys/net/ipv4/tcp\\_max\\_syn\\_backlog &#x6307;&#x5b9a;&#xff0c;&#x5728; `syncookies` &#x542f;&#x7528;&#x7684;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;&#x903b;&#x8f91;&#x4e0a;&#x6ca1;&#x6709;&#x6700;&#x5927;&#x503c;&#x9650;&#x5236;&#xff0c;&#x8fd9;&#x4e2a;&#x8bbe;&#x7f6e;&#x4fbf;&#x88ab;&#x5ffd;&#x7565;\n*   accept queue - &#x5168;&#x8fde;&#x63a5;&#x961f;&#x5217;\n    \n    *   &#x5176;&#x5927;&#x5c0f;&#x901a;&#x8fc7; /proc/sys/net/core/somaxconn &#x6307;&#x5b9a;&#xff0c;&#x5728;&#x4f7f;&#x7528; listen &#x51fd;&#x6570;&#x65f6;&#xff0c;&#x5185;&#x6838;&#x4f1a;&#x6839;&#x636e;&#x4f20;&#x5165;&#x7684; backlog &#x53c2;&#x6570;&#x4e0e;&#x7cfb;&#x7edf;&#x53c2;&#x6570;&#xff0c;&#x53d6;&#x4e8c;&#x8005;&#x7684;&#x8f83;&#x5c0f;&#x503c;\n    *   &#x5982;&#x679c; accpet queue &#x961f;&#x5217;&#x6ee1;&#x4e86;&#xff0c;server &#x5c06;&#x53d1;&#x9001;&#x4e00;&#x4e2a;&#x62d2;&#x7edd;&#x8fde;&#x63a5;&#x7684;&#x9519;&#x8bef;&#x4fe1;&#x606f;&#x5230; client\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4078,4093"}}],"payload":{"tag":"h3","lines":"4072,4073"}},{"content":"2.7.3&#x3001;TCP_NODELAY","children":[{"content":"<pre data-lines=\"4096,4098\"><code>*   &#x5c5e;&#x4e8e; SocketChannal &#x53c2;&#x6570;\n*   &#x4e3b;&#x8981;&#x8d1f;&#x8d23;&#x662f;&#x5426;&#x7981;&#x7528; Nagle &#x7b97;&#x6cd5;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4096,4098"}}],"payload":{"tag":"h3","lines":"4094,4095"}},{"content":"2.7.4&#x3001;SO_SNDBUF &amp; SO_RCVBUF","children":[{"content":"<pre data-lines=\"4101,4103\"><code>*   SO\\_SNDBUF &#x5c5e;&#x4e8e; SocketChannal &#x53c2;&#x6570;\n*   SO\\_RCVBUF &#x65e2;&#x53ef;&#x7528;&#x4e8e; SocketChannal &#x53c2;&#x6570;&#xff0c;&#x4e5f;&#x53ef;&#x4ee5;&#x7528;&#x4e8e; ServerSocketChannal &#x53c2;&#x6570;&#xff08;&#x5efa;&#x8bae;&#x8bbe;&#x7f6e;&#x5230; ServerSocketChannal &#x4e0a;&#xff09;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4101,4103"}}],"payload":{"tag":"h3","lines":"4099,4100"}},{"content":"2.7.5&#x3001;ALLOCATOR","children":[{"content":"<pre data-lines=\"4106,4108\"><code>*   &#x5c5e;&#x4e8e; SocketChannal &#x53c2;&#x6570;\n*   &#x7528;&#x6765;&#x5206;&#x914d; ByteBuf&#xff0c; ctx.alloc()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4106,4108"}}],"payload":{"tag":"h3","lines":"4104,4105"}},{"content":"2.7.6&#x3001;RCVBUF_ALLOCATOR","children":[{"content":"<pre data-lines=\"4111,4114\"><code>*   &#x5c5e;&#x4e8e; SocketChannal &#x53c2;&#x6570;\n*   &#x63a7;&#x5236; netty &#x63a5;&#x6536;&#x7f13;&#x51b2;&#x533a;&#x5927;&#x5c0f;\n*   &#x8d1f;&#x8d23;&#x5165;&#x7ad9;&#x6570;&#x636e;&#x7684;&#x5206;&#x914d;&#xff0c;&#x51b3;&#x5b9a;&#x5165;&#x7ad9;&#x7f13;&#x51b2;&#x533a;&#x7684;&#x5927;&#x5c0f;&#xff08;&#x5e76;&#x53ef;&#x52a8;&#x6001;&#x8c03;&#x6574;&#xff09;&#xff0c;&#x7edf;&#x4e00;&#x91c7;&#x7528; direct &#x76f4;&#x63a5;&#x5185;&#x5b58;&#xff0c;&#x5177;&#x4f53;&#x6c60;&#x5316;&#x8fd8;&#x662f;&#x975e;&#x6c60;&#x5316;&#x7531; allocator &#x51b3;&#x5b9a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4111,4114"}}],"payload":{"tag":"h3","lines":"4109,4110"}}],"payload":{"tag":"h2","lines":"4034,4036"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
