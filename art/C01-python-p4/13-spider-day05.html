<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"","children":[{"content":"Day04&#x56de;&#x987e;","children":[{"content":"requests.get()&#x53c2;&#x6570;","children":[{"content":"<pre data-lines=\"4,17\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;url\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;params -&gt; {} &#xff1a;&#x67e5;&#x8be2;&#x53c2;&#x6570; Query String\n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;proxies -&gt; {}\n     proxies = {\n        <span class=\"hljs-string\">&apos;http&apos;</span>:<span class=\"hljs-string\">&apos;http://1.1.1.1:8888&apos;</span>,\n\t    <span class=\"hljs-string\">&apos;https&apos;</span>:<span class=\"hljs-string\">&apos;https://1.1.1.1:8888&apos;</span>\n     }\n&#x3010;<span class=\"hljs-number\">4</span>&#x3011;verify -&gt; <span class=\"hljs-literal\">True</span>/<span class=\"hljs-literal\">False</span>&#xff0c;&#x5f53;&#x7a0b;&#x5e8f;&#x4e2d;&#x629b;&#x51fa; SSLError &#x65f6;&#x6dfb;&#x52a0; verify=<span class=\"hljs-literal\">False</span>\n&#x3010;<span class=\"hljs-number\">5</span>&#x3011;timeout\n&#x3010;<span class=\"hljs-number\">6</span>&#x3011;headers\n&#x3010;<span class=\"hljs-number\">7</span>&#x3011;cookies\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4,17"}}],"payload":{"tag":"h3","lines":"2,3"}},{"content":"requests.post()","children":[{"content":"<pre data-lines=\"20,23\"><code class=\"language-python\">data : &#x5b57;&#x5178;&#xff0c;Form&#x8868;&#x5355;&#x6570;&#x636e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"20,23"}}],"payload":{"tag":"h3","lines":"18,19"}},{"content":"&#x5e38;&#x89c1;&#x7684;&#x53cd;&#x722c;&#x673a;&#x5236;&#x53ca;&#x5904;&#x7406;&#x65b9;&#x5f0f;","children":[{"content":"<pre data-lines=\"26,49\"><code class=\"language-python\">&#x3010;1&#x3011;Headers&#x53cd;&#x722c;&#x866b;\n   1.1) &#x68c0;&#x67e5;: Cookie&#x3001;Referer&#x3001;User-Agent\n   1.2) &#x89e3;&#x51b3;&#x65b9;&#x6848;: &#x901a;&#x8fc7;F12&#x83b7;&#x53d6;headers,&#x4f20;&#x7ed9;requests.get()&#x65b9;&#x6cd5;\n        \n&#x3010;2&#x3011;IP&#x9650;&#x5236;\n   2.1) &#x7f51;&#x7ad9;&#x6839;&#x636e;IP&#x5730;&#x5740;&#x8bbf;&#x95ee;&#x9891;&#x7387;&#x8fdb;&#x884c;&#x53cd;&#x722c;,&#x77ed;&#x65f6;&#x95f4;&#x5185;&#x9650;&#x5236;IP&#x8bbf;&#x95ee;\n   2.2) &#x89e3;&#x51b3;&#x65b9;&#x6848;: \n        a) &#x6784;&#x9020;&#x81ea;&#x5df1;IP&#x4ee3;&#x7406;&#x6c60;,&#x6bcf;&#x6b21;&#x8bbf;&#x95ee;&#x968f;&#x673a;&#x9009;&#x62e9;&#x4ee3;&#x7406;,&#x7ecf;&#x5e38;&#x66f4;&#x65b0;&#x4ee3;&#x7406;&#x6c60;\n        b) &#x8d2d;&#x4e70;&#x5f00;&#x653e;&#x4ee3;&#x7406;&#x6216;&#x79c1;&#x5bc6;&#x4ee3;&#x7406;IP\n        c) &#x964d;&#x4f4e;&#x722c;&#x53d6;&#x7684;&#x901f;&#x5ea6;\n        \n&#x3010;3&#x3011;User-Agent&#x9650;&#x5236;\n   3.1) &#x7c7b;&#x4f3c;&#x4e8e;IP&#x9650;&#x5236;&#xff0c;&#x68c0;&#x6d4b;&#x9891;&#x7387;\n   3.2) &#x89e3;&#x51b3;&#x65b9;&#x6848;: &#x6784;&#x9020;&#x81ea;&#x5df1;&#x7684;User-Agent&#x6c60;,&#x6bcf;&#x6b21;&#x8bbf;&#x95ee;&#x968f;&#x673a;&#x9009;&#x62e9;\n        a&gt; fake_useragent&#x6a21;&#x5757;\n        b&gt; &#x65b0;&#x5efa;py&#x6587;&#x4ef6;,&#x5b58;&#x653e;&#x5927;&#x91cf;User-Agent\n        c&gt; &#x7a0b;&#x5e8f;&#x4e2d;&#x5b9a;&#x4e49;&#x5217;&#x8868;,&#x5b58;&#x653e;&#x5927;&#x91cf;&#x7684;User-Agent\n        \n&#x3010;4&#x3011;&#x5bf9;&#x54cd;&#x5e94;&#x5185;&#x5bb9;&#x505a;&#x5904;&#x7406;\n   4.1) &#x9875;&#x9762;&#x7ed3;&#x6784;&#x548c;&#x54cd;&#x5e94;&#x5185;&#x5bb9;&#x4e0d;&#x540c;\n   4.2) &#x89e3;&#x51b3;&#x65b9;&#x6848;: &#x6253;&#x5370;&#x5e76;&#x67e5;&#x770b;&#x54cd;&#x5e94;&#x5185;&#x5bb9;,&#x7528;xpath&#x6216;&#x6b63;&#x5219;&#x505a;&#x5904;&#x7406;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"26,49"}}],"payload":{"tag":"h3","lines":"24,25"}},{"content":"&#x6709;&#x9053;&#x7ffb;&#x8bd1;&#x8fc7;&#x7a0b;&#x68b3;&#x7406;","children":[{"content":"<pre data-lines=\"52,76\"><code class=\"language-python\">&#x3010;1&#x3011;&#x6253;&#x5f00;&#x9996;&#x9875;\n\n&#x3010;2&#x3011;&#x51c6;&#x5907;&#x6293;&#x5305;: F12&#x5f00;&#x542f;&#x63a7;&#x5236;&#x53f0;\n    \n&#x3010;3&#x3011;&#x5bfb;&#x627e;&#x5730;&#x5740;\n   3.1) &#x9875;&#x9762;&#x4e2d;&#x8f93;&#x5165;&#x7ffb;&#x8bd1;&#x5355;&#x8bcd;&#xff0c;&#x63a7;&#x5236;&#x53f0;&#x4e2d;&#x6293;&#x53d6;&#x5230;&#x7f51;&#x7edc;&#x6570;&#x636e;&#x5305;&#xff0c;&#x67e5;&#x627e;&#x5e76;&#x5206;&#x6790;&#x8fd4;&#x56de;&#x7ffb;&#x8bd1;&#x6570;&#x636e;&#x7684;&#x5730;&#x5740;\n        F12-Network-XHR-Headers-Grneral-Request URL\n        \n&#x3010;4&#x3011;&#x53d1;&#x73b0;&#x89c4;&#x5f8b;\n   4.1) &#x627e;&#x5230;&#x8fd4;&#x56de;&#x5177;&#x4f53;&#x6570;&#x636e;&#x7684;&#x5730;&#x5740;&#xff0c;&#x5728;&#x9875;&#x9762;&#x4e2d;&#x591a;&#x8f93;&#x5165;&#x51e0;&#x4e2a;&#x5355;&#x8bcd;&#xff0c;&#x627e;&#x5230;&#x5bf9;&#x5e94;URL&#x5730;&#x5740;\n   4.2) &#x5206;&#x6790;&#x5bf9;&#x6bd4; Network - All(&#x6216;&#x8005;XHR) - Form Data&#xff0c;&#x53d1;&#x73b0;&#x5bf9;&#x5e94;&#x7684;&#x89c4;&#x5f8b;\n\n&#x3010;5&#x3011;&#x5bfb;&#x627e;JS&#x52a0;&#x5bc6;&#x6587;&#x4ef6;\n   5.1) &#x63a7;&#x5236;&#x53f0;&#x53f3;&#x4e0a;&#x89d2; ...-&gt;Search-&gt;&#x641c;&#x7d22;&#x5173;&#x952e;&#x5b57;-&gt;&#x5355;&#x51fb;-&gt;&#x8df3;&#x8f6c;&#x5230;Sources&#xff0c;&#x5de6;&#x4e0b;&#x89d2;&#x683c;&#x5f0f;&#x5316;&#x7b26;&#x53f7;{}\n    \n&#x3010;6&#x3011;&#x67e5;&#x770b;JS&#x4ee3;&#x7801;\n   6.1) &#x641c;&#x7d22;&#x5173;&#x952e;&#x5b57;&#xff0c;&#x627e;&#x5230;&#x76f8;&#x5173;&#x52a0;&#x5bc6;&#x65b9;&#x6cd5;&#xff0c;&#x7528;python&#x5b9e;&#x73b0;&#x52a0;&#x5bc6;&#x7b97;&#x6cd5;\n    \n&#x3010;7&#x3011;&#x65ad;&#x70b9;&#x8c03;&#x8bd5;\n   7.1) JS&#x4ee3;&#x7801;&#x4e2d;&#x90e8;&#x5206;&#x53c2;&#x6570;&#x4e0d;&#x6e05;&#x695a;&#x53ef;&#x901a;&#x8fc7;&#x65ad;&#x70b9;&#x8c03;&#x8bd5;&#x6765;&#x5206;&#x6790;&#x67e5;&#x770b;\n    \n&#x3010;8&#x3011;&#x5b8c;&#x5584;&#x7a0b;&#x5e8f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"52,76"}}],"payload":{"tag":"h3","lines":"50,51"}}],"payload":{"tag":"h1","lines":"0,1"}},{"content":"Day05&#x7b14;&#x8bb0;","children":[{"content":"&#x6709;&#x9053;&#x7ffb;&#x8bd1;&#x6b65;&#x9aa4;&#x68b3;&#x7406;","children":[{"content":"1&#x3001;&#x5f00;&#x542f;F12&#x6293;&#x5305;&#xff0c;&#x627e;&#x5230;Form&#x8868;&#x5355;&#x6570;&#x636e;&#x5982;&#x4e0b;:","children":[{"content":"<pre data-lines=\"83,98\"><code class=\"language-python\">i: &#x55b5;&#x55b5;&#x53eb;\n<span class=\"hljs-keyword\">from</span>: AUTO\nto: AUTO\nsmartresult: <span class=\"hljs-built_in\">dict</span>\nclient: fanyideskweb\nsalt: <span class=\"hljs-number\">15614112641250</span>\nsign: 94008208919faa19bd531acde36aac5d\nts: <span class=\"hljs-number\">1561411264125</span>\nbv: f4d62a2579ebb44874d7ef93ba47e822\ndoctype: json\nversion: <span class=\"hljs-number\">2.1</span>\nkeyfrom: fanyi.web\naction: FY_BY_REALTlME\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"83,98"}}],"payload":{"tag":"h3","lines":"81,82"}},{"content":"2&#x3001;&#x5728;&#x9875;&#x9762;&#x4e2d;&#x591a;&#x7ffb;&#x8bd1;&#x51e0;&#x4e2a;&#x5355;&#x8bcd;&#xff0c;&#x89c2;&#x5bdf;Form&#x8868;&#x5355;&#x6570;&#x636e;&#x53d8;&#x5316;","children":[{"content":"<pre data-lines=\"101,108\"><code class=\"language-python\">salt: <span class=\"hljs-number\">15614112641250</span>\nsign: 94008208919faa19bd531acde36aac5d\nts: <span class=\"hljs-number\">1561411264125</span>\nbv: f4d62a2579ebb44874d7ef93ba47e822\n<span class=\"hljs-comment\"># &#x4f46;&#x662f;bv&#x7684;&#x503c;&#x4e0d;&#x53d8;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"101,108"}}],"payload":{"tag":"h3","lines":"99,100"}},{"content":"3&#x3001;&#x4e00;&#x822c;&#x4e3a;&#x672c;&#x5730;js&#x6587;&#x4ef6;&#x52a0;&#x5bc6;&#xff0c;&#x5237;&#x65b0;&#x9875;&#x9762;&#xff0c;&#x627e;&#x5230;js&#x6587;&#x4ef6;&#x5e76;&#x5206;&#x6790;JS&#x4ee3;&#x7801;","children":[{"content":"<pre data-lines=\"111,119\"><code class=\"language-python\"><span class=\"hljs-comment\"># &#x65b9;&#x6cd5;1</span>\nNetwork - JS&#x9009;&#x9879; - &#x641c;&#x7d22;&#x5173;&#x952e;&#x8bcd;salt\n<span class=\"hljs-comment\"># &#x65b9;&#x6cd5;2</span>\n&#x63a7;&#x5236;&#x53f0;&#x53f3;&#x4e0a;&#x89d2; - Search - &#x641c;&#x7d22;salt - &#x67e5;&#x770b;&#x6587;&#x4ef6; - &#x683c;&#x5f0f;&#x5316;&#x8f93;&#x51fa;\n\n<span class=\"hljs-comment\"># &#x6700;&#x7ec8;&#x627e;&#x5230;&#x76f8;&#x5173;JS&#x6587;&#x4ef6; : fanyi.min.js</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"111,119"}}],"payload":{"tag":"h3","lines":"109,110"}},{"content":"4&#x3001;&#x6253;&#x5f00;JS&#x6587;&#x4ef6;&#xff0c;&#x5206;&#x6790;&#x52a0;&#x5bc6;&#x7b97;&#x6cd5;&#xff0c;&#x7528;Python&#x5b9e;&#x73b0;","children":[{"content":"<pre data-lines=\"122,139\"><code class=\"language-python\"><span class=\"hljs-comment\"># ts : &#x7ecf;&#x8fc7;&#x5206;&#x6790;&#x4e3a;13&#x4f4d;&#x7684;&#x65f6;&#x95f4;&#x6233;&#xff0c;&#x5b57;&#x7b26;&#x4e32;&#x7c7b;&#x578b;</span>\njs&#x4ee3;&#x7801;&#x5b9e;&#x73b0;:  <span class=\"hljs-string\">&quot;&quot;</span> + (new Date).getTime()\npython&#x5b9e;&#x73b0;: <span class=\"hljs-built_in\">str</span>(<span class=\"hljs-built_in\">int</span>(time.time()*<span class=\"hljs-number\">1000</span>))\n\n<span class=\"hljs-comment\"># salt</span>\njs&#x4ee3;&#x7801;&#x5b9e;&#x73b0;:  ts + parseInt(<span class=\"hljs-number\">10</span> * Math.random(), <span class=\"hljs-number\">10</span>);\npython&#x5b9e;&#x73b0;:  ts + <span class=\"hljs-built_in\">str</span>(random.randint(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">9</span>))\n\n<span class=\"hljs-comment\"># sign&#xff08;&#x8bbe;&#x7f6e;&#x65ad;&#x70b9;&#x8c03;&#x8bd5;&#xff0c;&#x6765;&#x67e5;&#x770b; e &#x7684;&#x503c;&#xff0c;&#x53d1;&#x73b0; e &#x4e3a;&#x8981;&#x7ffb;&#x8bd1;&#x7684;&#x5355;&#x8bcd;&#xff09;</span>\njs&#x4ee3;&#x7801;&#x5b9e;&#x73b0;: n.md5(<span class=\"hljs-string\">&quot;fanyideskweb&quot;</span> + e + salt + <span class=\"hljs-string\">&quot;n%A-rKaT5fb[Gy?;N5@Tj&quot;</span>)\npython&#x5b9e;&#x73b0;:\n<span class=\"hljs-keyword\">from</span> hashlib <span class=\"hljs-keyword\">import</span> md5\ns = md5()\ns.update(<span class=\"hljs-string\">&apos;&apos;</span>.encode())\nsign = s.hexdigest()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"122,139"}}],"payload":{"tag":"h3","lines":"120,121"}},{"content":"5&#x3001;pycharm&#x4e2d;&#x6b63;&#x5219;&#x5904;&#x7406;headers&#x548c;formdata","children":[{"content":"<pre data-lines=\"142,149\"><code class=\"language-python\"><span class=\"hljs-number\">1</span>&#x3001;pycharm&#x8fdb;&#x5165;&#x65b9;&#x6cd5; &#xff1a;Ctrl + r &#xff0c;&#x9009;&#x4e2d; Regex\n<span class=\"hljs-number\">2</span>&#x3001;&#x5904;&#x7406;headers&#x548c;formdata\n  (.*): (.*)\n  <span class=\"hljs-string\">&quot;&#x24;1&quot;</span>: <span class=\"hljs-string\">&quot;&#x24;2&quot;</span>,\n<span class=\"hljs-number\">3</span>&#x3001;&#x70b9;&#x51fb; Replace All\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"142,149"}}],"payload":{"tag":"h3","lines":"140,141"}}],"payload":{"tag":"h2","lines":"79,80"}},{"content":"&#x6c11;&#x653f;&#x90e8;&#x7f51;&#x7ad9;&#x6570;&#x636e;&#x6293;&#x53d6;","children":[{"content":"&#x76ee;&#x6807;","children":[{"content":"<pre data-lines=\"155,161\"><code class=\"language-python\">&#x3010;1&#x3011;URL: http://www.mca.gov.cn/ - &#x6c11;&#x653f;&#x6570;&#x636e; - &#x884c;&#x653f;&#x533a;&#x5212;&#x4ee3;&#x7801;\n    &#x5373;: http://www.mca.gov.cn/article/sj/xzqh/2020/\n        \n&#x3010;2&#x3011;&#x76ee;&#x6807;: &#x6293;&#x53d6;&#x6700;&#x65b0;&#x4e2d;&#x534e;&#x4eba;&#x6c11;&#x5171;&#x548c;&#x56fd;&#x53bf;&#x4ee5;&#x4e0a;&#x884c;&#x653f;&#x533a;&#x5212;&#x4ee3;&#x7801;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"155,161"}}],"payload":{"tag":"h3","lines":"153,154"}},{"content":"&#x5b9e;&#x73b0;&#x6b65;&#x9aa4;","children":[{"content":"<pre data-lines=\"164,209\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x4ece;&#x6c11;&#x653f;&#x6570;&#x636e;&#x7f51;&#x7ad9;&#x4e2d;&#x63d0;&#x53d6;&#x6700;&#x65b0;&#x884c;&#x653f;&#x533a;&#x5212;&#x4ee3;&#x7801;&#x94fe;&#x63a5;\n   <span class=\"hljs-number\">1.1</span>) &#x65b0;&#x7684;&#x5728;&#x4e0a;&#x9762;&#x7b2c;<span class=\"hljs-number\">2</span>&#x4e2a;\n   <span class=\"hljs-number\">1.2</span>) xpath&#x8868;&#x8fbe;&#x5f0f;: //table//tr[<span class=\"hljs-number\">2</span>]/td[<span class=\"hljs-number\">2</span>]/a/@href\n   \n  \n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;&#x4ece;&#x4e8c;&#x7ea7;&#x9875;&#x9762;&#x54cd;&#x5e94;&#x5185;&#x5bb9;&#x4e2d;&#x63d0;&#x53d6;&#x771f;&#x5b9e;&#x94fe;&#x63a5;\n   <span class=\"hljs-number\">2.1</span>) &#x53cd;&#x722c; - &#x54cd;&#x5e94;&#x5185;&#x5bb9;&#x4e2d;&#x5d4c;&#x5165;JS&#xff0c;&#x6307;&#x5411;&#x65b0;&#x7684;&#x94fe;&#x63a5;\n   <span class=\"hljs-number\">2.2</span>) &#x6253;&#x5370;&#x54cd;&#x5e94;&#x5185;&#x5bb9;&#xff0c;&#x641c;&#x7d22;&#x771f;&#x5b9e;&#x94fe;&#x63a5;URL&#xff0c;&#x627e;&#x5230;&#x4f4d;&#x7f6e;\n   <span class=\"hljs-number\">2.3</span>) &#x6b63;&#x5219;&#x5339;&#x914d;: window.location.href=<span class=\"hljs-string\">&quot;(.*?)&quot;</span>\n\n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;&#x4ece;&#x771f;&#x5b9e;&#x94fe;&#x63a5;&#x4e2d;&#x63d0;&#x53d6;&#x6240;&#x9700;&#x6570;&#x636e;\n   <span class=\"hljs-number\">3.1</span>) &#x57fa;&#x51c6;xpath(&#x4ee5;&#x54cd;&#x5e94;&#x5185;&#x5bb9;&#x4e3a;&#x4e3b;): //tr[@height=<span class=\"hljs-string\">&quot;19&quot;</span>]\n   <span class=\"hljs-number\">3.2</span>) <span class=\"hljs-keyword\">for</span>&#x5faa;&#x73af;&#x4f9d;&#x6b21;&#x904d;&#x5386;&#x63d0;&#x53d6;&#x6570;&#x636e;\n        &#x7f16;&#x7801;: ./td[<span class=\"hljs-number\">2</span>]/text() | ./td[<span class=\"hljs-number\">2</span>]/span/text()\n        &#x540d;&#x79f0;: ./td[<span class=\"hljs-number\">3</span>]/text()\n            \n&#x3010;<span class=\"hljs-number\">4</span>&#x3011;&#x6269;&#x5c55; - &#x8865;&#x5145;\n   <span class=\"hljs-number\">4.1</span>) &#x6570;&#x636e;&#x5b58;&#x5165;&#x5230; MySQL &#x6570;&#x636e;&#x5e93;&#xff0c;&#x4e00;&#x5b9a;&#x8981;&#x5206;&#x8868;&#x5b58;&#x50a8;\n   <span class=\"hljs-number\">4.2</span>) &#x4e09;&#x5f20;&#x8868;\n        a&gt; &#x7701;&#x8868;(province) : &#x540d;&#x79f0;  &#x7f16;&#x53f7;\n        b&gt; &#x5e02;&#x8868;(city)     : &#x540d;&#x79f0;  &#x7f16;&#x53f7;  &#x5bf9;&#x5e94;&#x7701;&#x7684;&#x7f16;&#x53f7;\n        c&gt; &#x53bf;&#x8868;(county)   : &#x540d;&#x79f0;  &#x7f16;&#x53f7;  &#x5bf9;&#x5e94;&#x5e02;&#x7684;&#x7f16;&#x53f7;\n            \n&#x3010;<span class=\"hljs-number\">5</span>&#x3011;MySQL&#x5efa;&#x5e93;&#x5efa;&#x8868;&#x8bed;&#x53e5;\ncreate database govdb charset utf8;\nuse govdb;\ncreate table province(\n<span class=\"hljs-built_in\">id</span> <span class=\"hljs-built_in\">int</span> primary key auto_increment,\npname varchar(<span class=\"hljs-number\">50</span>),\npcode varchar(<span class=\"hljs-number\">20</span>)\n)charset=utf8;\ncreate table city(\n<span class=\"hljs-built_in\">id</span> <span class=\"hljs-built_in\">int</span> primary key auto_increment,\ncname varchar(<span class=\"hljs-number\">50</span>),\nccode varchar(<span class=\"hljs-number\">20</span>),\ncfcode varchar(<span class=\"hljs-number\">20</span>)\n)charset=utf8;\ncreate table county(\n<span class=\"hljs-built_in\">id</span> <span class=\"hljs-built_in\">int</span> primary key auto_increment,\nxname varchar(<span class=\"hljs-number\">50</span>),\nxcode varchar(<span class=\"hljs-number\">20</span>),\nxfcode varchar(<span class=\"hljs-number\">20</span>)\n)charset=utf8;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"164,209"}}],"payload":{"tag":"h3","lines":"162,163"}},{"content":"&#x4ee3;&#x7801;&#x5b9e;&#x73b0; - &#x4f7f;&#x7528;redis&#x5b9e;&#x73b0;&#x589e;&#x91cf;","children":[{"content":"<pre data-lines=\"212,346\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">from</span> lxml <span class=\"hljs-keyword\">import</span> etree\n<span class=\"hljs-keyword\">import</span> re\n<span class=\"hljs-keyword\">import</span> redis\n<span class=\"hljs-keyword\">from</span> hashlib <span class=\"hljs-keyword\">import</span> md5\n<span class=\"hljs-keyword\">import</span> pymysql\n<span class=\"hljs-keyword\">import</span> sys\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GovementSpider</span>(<span class=\"hljs-title class_ inherited__\">object</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-variable language_\">self</span>.index_url = <span class=\"hljs-string\">&apos;http://www.mca.gov.cn/article/sj/xzqh/2020/&apos;</span>\n        <span class=\"hljs-variable language_\">self</span>.headers = {\n            <span class=\"hljs-string\">&quot;User-Agent&quot;</span>: <span class=\"hljs-string\">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36&quot;</span>,\n        }\n        <span class=\"hljs-comment\"># redis&#x6307;&#x7eb9;&#x589e;&#x91cf;</span>\n        <span class=\"hljs-variable language_\">self</span>.r = redis.Redis(host=<span class=\"hljs-string\">&apos;localhost&apos;</span>,port=<span class=\"hljs-number\">6379</span>,db=<span class=\"hljs-number\">0</span>)\n        <span class=\"hljs-comment\"># MySQL&#x76f8;&#x5173;&#x53d8;&#x91cf;</span>\n        <span class=\"hljs-variable language_\">self</span>.db = pymysql.connect(<span class=\"hljs-string\">&apos;localhost&apos;</span>, <span class=\"hljs-string\">&apos;root&apos;</span>, <span class=\"hljs-string\">&apos;123456&apos;</span>, <span class=\"hljs-string\">&apos;govdb&apos;</span>, charset=<span class=\"hljs-string\">&apos;utf8&apos;</span>)\n        <span class=\"hljs-variable language_\">self</span>.cursor = <span class=\"hljs-variable language_\">self</span>.db.cursor()\n        <span class=\"hljs-comment\"># &#x63d2;&#x5165;&#x8bed;&#x53e5;</span>\n        <span class=\"hljs-variable language_\">self</span>.ins1 = <span class=\"hljs-string\">&apos;insert into province(pname,pcode) values(%s,%s)&apos;</span>\n        <span class=\"hljs-variable language_\">self</span>.ins2 = <span class=\"hljs-string\">&apos;insert into city(cname,ccode,cfcode) values(%s,%s,%s)&apos;</span>\n        <span class=\"hljs-variable language_\">self</span>.ins3 = <span class=\"hljs-string\">&apos;insert into county(xname,xcode,xfcode) values(%s,%s,%s)&apos;</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_html</span>(<span class=\"hljs-params\">self,url</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x8bf7;&#x6c42;&#x529f;&#x80fd;&#x51fd;&#x6570;&quot;&quot;&quot;</span>\n        html = requests.get(url=url,headers=<span class=\"hljs-variable language_\">self</span>.headers).text\n\n        <span class=\"hljs-keyword\">return</span> html\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">xpath_func</span>(<span class=\"hljs-params\">self, html, xpath_bds</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x89e3;&#x6790;&#x529f;&#x80fd;&#x51fd;&#x6570;&quot;&quot;&quot;</span>\n        p = etree.HTML(html)\n        r_list = p.xpath(xpath_bds)\n\n        <span class=\"hljs-keyword\">return</span> r_list\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">md5_url</span>(<span class=\"hljs-params\">self,url</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;URL&#x52a0;&#x5bc6;&#x51fd;&#x6570;&quot;&quot;&quot;</span>\n        s = md5()\n        s.update(url.encode())\n\n        <span class=\"hljs-keyword\">return</span> s.hexdigest()\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_false_url</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x83b7;&#x53d6;&#x6700;&#x65b0;&#x6708;&#x4efd;&#x94fe;&#x63a5; - &#x5047;&#x94fe;&#x63a5;&quot;&quot;&quot;</span>\n        html = <span class=\"hljs-variable language_\">self</span>.get_html(<span class=\"hljs-variable language_\">self</span>.index_url)\n        <span class=\"hljs-built_in\">print</span>(html)\n        <span class=\"hljs-comment\"># &#x89e3;&#x6790;&#x63d0;&#x53d6;&#x6700;&#x65b0;&#x6708;&#x4efd;&#x94fe;&#x63a5; - &#x5047;&#x94fe;&#x63a5;</span>\n        one_xpath = <span class=\"hljs-string\">&apos;//table/tr[2]/td[2]/a/@href&apos;</span>\n        false_href_list = <span class=\"hljs-variable language_\">self</span>.xpath_func(html,one_xpath)\n        <span class=\"hljs-keyword\">if</span> false_href_list:\n            false_href = false_href_list[<span class=\"hljs-number\">0</span>]\n            false_url = <span class=\"hljs-string\">&apos;http://www.mca.gov.cn&apos;</span> + false_href\n            <span class=\"hljs-comment\"># &#x751f;&#x6210;&#x6307;&#x7eb9;</span>\n            finger = <span class=\"hljs-variable language_\">self</span>.md5_url(false_url)\n            <span class=\"hljs-comment\"># redis&#x96c6;&#x5408;&#x589e;&#x91cf;&#x5224;&#x65ad;</span>\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-variable language_\">self</span>.r.sadd(<span class=\"hljs-string\">&apos;govspider:fingers&apos;</span>,finger):\n                <span class=\"hljs-variable language_\">self</span>.get_real_url(false_url)\n            <span class=\"hljs-keyword\">else</span>:\n                sys.exit(<span class=\"hljs-string\">&apos;&#x6570;&#x636e;&#x5df2;&#x662f;&#x6700;&#x65b0;&apos;</span>)\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;&#x63d0;&#x53d6;&#x6700;&#x65b0;&#x6708;&#x4efd;&#x94fe;&#x63a5;&#x5931;&#x8d25;&apos;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_real_url</span>(<span class=\"hljs-params\">self,false_url</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x83b7;&#x53d6;&#x771f;&#x94fe;&#x63a5;&quot;&quot;&quot;</span>\n        <span class=\"hljs-comment\"># &#x5d4c;&#x5165;JS&#x6267;&#x884c;URL&#x8df3;&#x8f6c;,&#x63d0;&#x53d6;&#x771f;&#x5b9e;&#x94fe;&#x63a5;</span>\n        html = <span class=\"hljs-variable language_\">self</span>.get_html(false_url)\n        regex = <span class=\"hljs-string\">r&apos;window.location.href=&quot;(.*?)&quot;&apos;</span>\n        pattern = re.<span class=\"hljs-built_in\">compile</span>(regex,re.S)\n        true_url_list = pattern.findall(html)\n        <span class=\"hljs-keyword\">if</span> true_url_list:\n            true_url = true_url_list[<span class=\"hljs-number\">0</span>]\n            <span class=\"hljs-comment\"># &#x63d0;&#x53d6;&#x5177;&#x4f53;&#x7684;&#x6570;&#x636e;</span>\n            <span class=\"hljs-variable language_\">self</span>.get_data(true_url)\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;&#x63d0;&#x53d6;&#x771f;&#x5b9e;&#x94fe;&#x63a5;&#x5931;&#x8d25;&apos;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_data</span>(<span class=\"hljs-params\">self,true_url</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x63d0;&#x53d6;&#x5177;&#x4f53;&#x7684;&#x6570;&#x636e;&quot;&quot;&quot;</span>\n        html = <span class=\"hljs-variable language_\">self</span>.get_html(true_url)\n        <span class=\"hljs-comment\"># xpath&#x63d0;&#x53d6;&#x6570;&#x636e;</span>\n        two_xpath = <span class=\"hljs-string\">&apos;//tr[@height=&quot;19&quot;]&apos;</span>\n        tr_list = <span class=\"hljs-variable language_\">self</span>.xpath_func(html, two_xpath)\n        <span class=\"hljs-comment\"># &#x5728;&#x5b58;&#x5165;&#x65b0;&#x6570;&#x636e;&#x4e4b;&#x524d;&#x5148;&#x6e05;&#x7a7a;&#x6570;&#x636e;&#x5e93;</span>\n        <span class=\"hljs-variable language_\">self</span>.delete()\n        <span class=\"hljs-keyword\">for</span> tr <span class=\"hljs-keyword\">in</span> tr_list:\n            code_list = tr.xpath(<span class=\"hljs-string\">&apos;./td[2]/text() | ./td[2]/span/text()&apos;</span>)\n            name_list = tr.xpath(<span class=\"hljs-string\">&apos;./td[3]/text()&apos;</span>)\n            code = code_list[<span class=\"hljs-number\">0</span>].strip() <span class=\"hljs-keyword\">if</span> code_list <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">None</span>\n            name = name_list[<span class=\"hljs-number\">0</span>].strip() <span class=\"hljs-keyword\">if</span> name_list <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">None</span>\n            <span class=\"hljs-built_in\">print</span>(name, code)\n            <span class=\"hljs-comment\"># &#x5c06;&#x6240;&#x6293;&#x6570;&#x636e;&#x5b58;&#x5165;MySQL&#x6570;&#x636e;&#x5e93;</span>\n            <span class=\"hljs-keyword\">if</span> code[-<span class=\"hljs-number\">4</span>:] == <span class=\"hljs-string\">&apos;0000&apos;</span>:\n                <span class=\"hljs-variable language_\">self</span>.insert(<span class=\"hljs-variable language_\">self</span>.ins1, [name, code])\n                <span class=\"hljs-comment\"># &#x56db;&#x4e2a;&#x76f4;&#x8f96;&#x5e02;&#x7279;&#x6b8a;,&#x9700;&#x8981;&#x5b58;&#x5230;&#x5e02;&#x8868;&#x4e2d;&#x4e00;&#x4efd;</span>\n                <span class=\"hljs-keyword\">if</span> name <span class=\"hljs-keyword\">in</span> [<span class=\"hljs-string\">&apos;&#x5317;&#x4eac;&#x5e02;&apos;</span>, <span class=\"hljs-string\">&apos;&#x5929;&#x6d25;&#x5e02;&apos;</span>, <span class=\"hljs-string\">&apos;&#x4e0a;&#x6d77;&#x5e02;&apos;</span>, <span class=\"hljs-string\">&apos;&#x91cd;&#x5e86;&#x5e02;&apos;</span>]:\n                    <span class=\"hljs-variable language_\">self</span>.insert(<span class=\"hljs-variable language_\">self</span>.ins2, [name, code, code])\n            <span class=\"hljs-keyword\">elif</span> code[-<span class=\"hljs-number\">2</span>:] == <span class=\"hljs-string\">&apos;00&apos;</span>:\n                <span class=\"hljs-variable language_\">self</span>.insert(<span class=\"hljs-variable language_\">self</span>.ins2, [name, code, code[:<span class=\"hljs-number\">2</span>] + <span class=\"hljs-string\">&apos;0000&apos;</span>])\n                <span class=\"hljs-comment\"># &#x8bb0;&#x5f55;&#x6700;&#x8fd1;1&#x6b21;&#x57ce;&#x5e02;&#x7684;&#x7f16;&#x53f7;</span>\n                last_city = code\n            <span class=\"hljs-keyword\">else</span>:\n                <span class=\"hljs-keyword\">if</span> code[:<span class=\"hljs-number\">2</span>] <span class=\"hljs-keyword\">in</span> [<span class=\"hljs-string\">&apos;11&apos;</span>, <span class=\"hljs-string\">&apos;12&apos;</span>, <span class=\"hljs-string\">&apos;31&apos;</span>, <span class=\"hljs-string\">&apos;50&apos;</span>]:\n                    xfcode = code[:<span class=\"hljs-number\">2</span>] + <span class=\"hljs-string\">&apos;0000&apos;</span>\n                <span class=\"hljs-keyword\">else</span>:\n                    xfcode = last_city\n                <span class=\"hljs-variable language_\">self</span>.insert(<span class=\"hljs-variable language_\">self</span>.ins3, [name, code, xfcode])\n\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">delete</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x5220;&#x9664;&#x8868;&#x8bb0;&#x5f55;&#x529f;&#x80fd;&#x51fd;&#x6570;&quot;&quot;&quot;</span>\n        del1 = <span class=\"hljs-string\">&apos;delete from province;&apos;</span>\n        del2 = <span class=\"hljs-string\">&apos;delete from city;&apos;</span>\n        del3 = <span class=\"hljs-string\">&apos;delete from county;&apos;</span>\n        <span class=\"hljs-variable language_\">self</span>.cursor.execute(del1)\n        <span class=\"hljs-variable language_\">self</span>.cursor.execute(del2)\n        <span class=\"hljs-variable language_\">self</span>.cursor.execute(del3)\n        <span class=\"hljs-variable language_\">self</span>.db.commit()\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">insert</span>(<span class=\"hljs-params\">self, ins, li</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x5b58;&#x5165;MySQL&#x529f;&#x80fd;&#x51fd;&#x6570;&quot;&quot;&quot;</span>\n        <span class=\"hljs-variable language_\">self</span>.cursor.execute(ins, li)\n        <span class=\"hljs-variable language_\">self</span>.db.commit()\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x7a0b;&#x5e8f;&#x5165;&#x53e3;&#x51fd;&#x6570;&quot;&quot;&quot;</span>\n        <span class=\"hljs-variable language_\">self</span>.get_false_url()\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n  spider = GovementSpider()\n  spider.run()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"212,346"}}],"payload":{"tag":"h3","lines":"210,211"}}],"payload":{"tag":"h2","lines":"151,152"}},{"content":"&#x52a8;&#x6001;&#x52a0;&#x8f7d;&#x6570;&#x636e;&#x6293;&#x53d6;-Ajax","children":[{"content":"&#x7279;&#x70b9;","children":[{"content":"<pre data-lines=\"351,355\"><code class=\"language-python\">&#x3010;1&#x3011;&#x53f3;&#x952e; -&gt; &#x67e5;&#x770b;&#x7f51;&#x9875;&#x6e90;&#x7801;&#x4e2d;&#x6ca1;&#x6709;&#x5177;&#x4f53;&#x6570;&#x636e;\n&#x3010;2&#x3011;&#x6eda;&#x52a8;&#x9f20;&#x6807;&#x6ed1;&#x8f6e;&#x6216;&#x5176;&#x4ed6;&#x52a8;&#x4f5c;&#x65f6;&#x52a0;&#x8f7d;,&#x6216;&#x8005;&#x9875;&#x9762;&#x5c40;&#x90e8;&#x5237;&#x65b0;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"351,355"}}],"payload":{"tag":"h3","lines":"349,350"}},{"content":"&#x6293;&#x53d6;","children":[{"content":"<pre data-lines=\"358,364\"><code class=\"language-python\">&#x3010;1&#x3011;F12&#x6253;&#x5f00;&#x63a7;&#x5236;&#x53f0;&#xff0c;&#x9875;&#x9762;&#x52a8;&#x4f5c;&#x6293;&#x53d6;&#x7f51;&#x7edc;&#x6570;&#x636e;&#x5305;\n&#x3010;2&#x3011;&#x6293;&#x53d6;json&#x6587;&#x4ef6;URL&#x5730;&#x5740;\n   2.1) &#x63a7;&#x5236;&#x53f0;&#x4e2d; XHR &#xff1a;&#x5f02;&#x6b65;&#x52a0;&#x8f7d;&#x7684;&#x6570;&#x636e;&#x5305;\n   2.2) XHR -&gt; QueryStringParameters(&#x67e5;&#x8be2;&#x53c2;&#x6570;)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"358,364"}}],"payload":{"tag":"h3","lines":"356,357"}},{"content":"&#x8c46;&#x74e3;&#x7535;&#x5f71;&#x6570;&#x636e;&#x6293;&#x53d6;&#x6848;&#x4f8b;","children":[{"content":"&#x76ee;&#x6807;","children":[{"content":"<pre data-lines=\"369,373\"><code class=\"language-python\">&#x3010;1&#x3011;&#x5730;&#x5740;: &#x8c46;&#x74e3;&#x7535;&#x5f71; - &#x6392;&#x884c;&#x699c; - &#x5267;&#x60c5;\n&#x3010;2&#x3011;&#x76ee;&#x6807;: &#x7535;&#x5f71;&#x540d;&#x79f0;&#x3001;&#x7535;&#x5f71;&#x8bc4;&#x5206;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"369,373"}}],"payload":{"tag":"h4","lines":"367,368"}},{"content":"F12&#x6293;&#x5305;&#xff08;XHR&#xff09;","children":[{"content":"<pre data-lines=\"376,389\"><code class=\"language-python\">&#x3010;1&#x3011;Request URL(&#x57fa;&#x51c6;URL&#x5730;&#x5740;) &#xff1a;https://movie.douban.com/j/chart/top_list?\n&#x3010;2&#x3011;Query String(&#x67e5;&#x8be2;&#x53c2;&#x6570;)\n    # &#x6293;&#x53d6;&#x7684;&#x67e5;&#x8be2;&#x53c2;&#x6570;&#x5982;&#x4e0b;&#xff1a;\n    type: 13 # &#x7535;&#x5f71;&#x7c7b;&#x578b;\n    interval_id: 100:90\n    action: &apos;&apos;\n    start: 0  # &#x6bcf;&#x6b21;&#x52a0;&#x8f7d;&#x7535;&#x5f71;&#x7684;&#x8d77;&#x59cb;&#x7d22;&#x5f15;&#x503c; 0 20 40 60 \n    limit: 20 # &#x6bcf;&#x6b21;&#x52a0;&#x8f7d;&#x7684;&#x7535;&#x5f71;&#x6570;&#x91cf;\n        \n&#x3010;3&#x3011;URL\n    https://movie.douban.com/j/chart/top_list?type=13&amp;interval_id=100%3A90&amp;action=&amp;start={}&amp;limit=20\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"376,389"}}],"payload":{"tag":"h4","lines":"374,375"}},{"content":"&#x4ee3;&#x7801;&#x5b9e;&#x73b0; - &#x5168;&#x7ad9;&#x6293;&#x53d6;","children":[{"content":"<pre data-lines=\"392,486\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">import</span> random\n<span class=\"hljs-keyword\">import</span> re\n<span class=\"hljs-keyword\">from</span> fake_useragent <span class=\"hljs-keyword\">import</span> UserAgent\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DoubanSpider</span>(<span class=\"hljs-title class_ inherited__\">object</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-variable language_\">self</span>.url = <span class=\"hljs-string\">&apos;https://movie.douban.com/j/chart/top_list?&apos;</span>\n        <span class=\"hljs-variable language_\">self</span>.i = <span class=\"hljs-number\">0</span>\n\n    <span class=\"hljs-comment\"># &#x83b7;&#x53d6;&#x968f;&#x673a;headers</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_headers</span>(<span class=\"hljs-params\">self</span>):\n        headers = {<span class=\"hljs-string\">&apos;User-Agent&apos;</span>:UserAgent().random }\n\n        <span class=\"hljs-keyword\">return</span> headers\n\n    <span class=\"hljs-comment\"># &#x83b7;&#x53d6;&#x9875;&#x9762;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_page</span>(<span class=\"hljs-params\">self,params</span>):\n      <span class=\"hljs-comment\"># &#x8fd4;&#x56de; python &#x6570;&#x636e;&#x7c7b;&#x578b;</span>\n        html = requests.get(url=<span class=\"hljs-variable language_\">self</span>.url,params=params,headers=<span class=\"hljs-variable language_\">self</span>.get_headers()).json()\n        <span class=\"hljs-variable language_\">self</span>.parse_page(html)\n\n    <span class=\"hljs-comment\"># &#x89e3;&#x6790;&#x5e76;&#x4fdd;&#x5b58;&#x6570;&#x636e;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse_page</span>(<span class=\"hljs-params\">self,html</span>):\n        item = {}\n        <span class=\"hljs-comment\"># html&#x4e3a;&#x5927;&#x5217;&#x8868; [{&#x7535;&#x5f71;1&#x4fe1;&#x606f;},{},{}]</span>\n        <span class=\"hljs-keyword\">for</span> one <span class=\"hljs-keyword\">in</span> html:\n            <span class=\"hljs-comment\"># &#x540d;&#x79f0; + &#x8bc4;&#x5206;</span>\n            item[<span class=\"hljs-string\">&apos;name&apos;</span>] = one[<span class=\"hljs-string\">&apos;title&apos;</span>].strip()\n            item[<span class=\"hljs-string\">&apos;score&apos;</span>] = <span class=\"hljs-built_in\">float</span>(one[<span class=\"hljs-string\">&apos;score&apos;</span>].strip())\n            <span class=\"hljs-comment\"># &#x6253;&#x5370;&#x6d4b;&#x8bd5;</span>\n            <span class=\"hljs-built_in\">print</span>(item)\n            <span class=\"hljs-variable language_\">self</span>.i += <span class=\"hljs-number\">1</span>\n\n    <span class=\"hljs-comment\"># &#x4e3b;&#x51fd;&#x6570;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-comment\"># &#x83b7;&#x53d6;type&#x7684;&#x503c;</span>\n        type_dict = <span class=\"hljs-variable language_\">self</span>.get_all_type_films()\n        <span class=\"hljs-comment\"># &#x751f;&#x6210;&#x83dc;&#x5355;</span>\n        menu = <span class=\"hljs-string\">&apos;&apos;</span>\n        <span class=\"hljs-keyword\">for</span> key <span class=\"hljs-keyword\">in</span> type_dict:\n          menu += key + <span class=\"hljs-string\">&apos;|&apos;</span>\n\n        menu = menu + <span class=\"hljs-string\">&apos;\\n&#x8bf7;&#x505a;&#x51fa;&#x4f60;&#x7684;&#x9009;&#x62e9;:&apos;</span>\n        name = <span class=\"hljs-built_in\">input</span>(menu)\n        type_number = type_dict[name]\n        <span class=\"hljs-comment\"># &#x83b7;&#x53d6;&#x7535;&#x5f71;&#x603b;&#x6570;</span>\n        total = <span class=\"hljs-variable language_\">self</span>.total_number(type_number)\n        <span class=\"hljs-keyword\">for</span> start <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>,(total+<span class=\"hljs-number\">1</span>),<span class=\"hljs-number\">20</span>):\n            params = {\n                <span class=\"hljs-string\">&apos;type&apos;</span> : type_number,\n                <span class=\"hljs-string\">&apos;interval_id&apos;</span> : <span class=\"hljs-string\">&apos;100:90&apos;</span>,\n                <span class=\"hljs-string\">&apos;action&apos;</span> : <span class=\"hljs-string\">&apos;&apos;</span>,\n                <span class=\"hljs-string\">&apos;start&apos;</span> : <span class=\"hljs-built_in\">str</span>(start),\n                <span class=\"hljs-string\">&apos;limit&apos;</span> : <span class=\"hljs-string\">&apos;20&apos;</span>\n            }\n            <span class=\"hljs-comment\"># &#x8c03;&#x7528;&#x51fd;&#x6570;,&#x4f20;&#x9012;params&#x53c2;&#x6570;</span>\n            <span class=\"hljs-variable language_\">self</span>.get_page(params)\n            <span class=\"hljs-comment\"># &#x968f;&#x673a;&#x4f11;&#x7720;1-3&#x79d2;</span>\n            time.sleep(random.randint(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">3</span>))\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;&#x7535;&#x5f71;&#x6570;&#x91cf;:&apos;</span>,<span class=\"hljs-variable language_\">self</span>.i)\n\n    <span class=\"hljs-comment\"># &#x83b7;&#x53d6;&#x7535;&#x5f71;&#x603b;&#x6570;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">total_number</span>(<span class=\"hljs-params\">self,type_number</span>):\n        <span class=\"hljs-comment\"># F12&#x6293;&#x5305;&#x6293;&#x5230;&#x7684;&#x5730;&#x5740;</span>\n        url = <span class=\"hljs-string\">&apos;https://movie.douban.com/j/chart/top_list_count?type={}&amp;interval_id=100%3A90&apos;</span>.<span class=\"hljs-built_in\">format</span>(type_number)\n        headers = <span class=\"hljs-variable language_\">self</span>.get_headers()\n        html = requests.get(url=url,headers=headers).json()\n        total = <span class=\"hljs-built_in\">int</span>(html[<span class=\"hljs-string\">&apos;total&apos;</span>])\n\n        <span class=\"hljs-keyword\">return</span> total\n\n    <span class=\"hljs-comment\"># &#x83b7;&#x53d6;&#x6240;&#x6709;&#x7535;&#x5f71;&#x7684;&#x540d;&#x5b57;&#x548c;&#x5bf9;&#x5e94;type&#x503c;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_all_type_films</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-comment\"># &#x83b7;&#x53d6; &#x7c7b;&#x578b;&#x548c;&#x7c7b;&#x578b;&#x7801;</span>\n        url = <span class=\"hljs-string\">&apos;https://movie.douban.com/chart&apos;</span>\n        headers = <span class=\"hljs-variable language_\">self</span>.get_headers()\n        html = requests.get(url=url,headers=headers).text\n        re_bds = <span class=\"hljs-string\">r&apos;&lt;a href=.*?type_name=(.*?)&amp;type=(.*?)&amp;.*?&lt;/a&gt;&apos;</span>\n        pattern = re.<span class=\"hljs-built_in\">compile</span>(re_bds,re.S)\n        r_list = pattern.findall(html)\n        <span class=\"hljs-comment\"># &#x5b58;&#x653e;&#x6240;&#x6709;&#x7c7b;&#x578b;&#x548c;&#x5bf9;&#x5e94;&#x7c7b;&#x578b;&#x7801;&#x5927;&#x5b57;&#x5178;</span>\n        type_dict = {}\n        <span class=\"hljs-keyword\">for</span> r <span class=\"hljs-keyword\">in</span> r_list:\n            type_dict[r[<span class=\"hljs-number\">0</span>].strip()] = r[<span class=\"hljs-number\">1</span>].strip()\n\n        <span class=\"hljs-keyword\">return</span> type_dict\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n    spider = DoubanSpider()\n    spider.run()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"392,486"}}],"payload":{"tag":"h4","lines":"390,391"}}],"payload":{"tag":"h3","lines":"365,366"}}],"payload":{"tag":"h2","lines":"347,348"}},{"content":"json&#x89e3;&#x6790;&#x6a21;&#x5757;","children":[{"content":"json.loads(json)","children":[{"content":"<pre data-lines=\"491,496\"><code class=\"language-python\">&#x3010;1&#x3011;&#x4f5c;&#x7528; : &#x628a;json&#x683c;&#x5f0f;&#x7684;&#x5b57;&#x7b26;&#x4e32;&#x8f6c;&#x4e3a;Python&#x6570;&#x636e;&#x7c7b;&#x578b;\n\n&#x3010;2&#x3011;&#x793a;&#x4f8b; : html = json.loads(res.text)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"491,496"}}],"payload":{"tag":"h3","lines":"489,490"}},{"content":"json.dump(python,f,ensure_ascii=False)","children":[{"content":"<pre data-lines=\"499,527\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x4f5c;&#x7528;\n   &#x628a;python&#x6570;&#x636e;&#x7c7b;&#x578b; &#x8f6c;&#x4e3a; json&#x683c;&#x5f0f;&#x7684;&#x5b57;&#x7b26;&#x4e32;,&#x4e00;&#x822c;&#x8ba9;&#x4f60;&#x628a;&#x6293;&#x53d6;&#x7684;&#x6570;&#x636e;&#x4fdd;&#x5b58;&#x4e3a;json&#x6587;&#x4ef6;&#x65f6;&#x4f7f;&#x7528;\n\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;&#x53c2;&#x6570;&#x8bf4;&#x660e;\n   <span class=\"hljs-number\">2.1</span>) &#x7b2c;<span class=\"hljs-number\">1</span>&#x4e2a;&#x53c2;&#x6570;: python&#x7c7b;&#x578b;&#x7684;&#x6570;&#x636e;(&#x5b57;&#x5178;&#xff0c;&#x5217;&#x8868;&#x7b49;)\n   <span class=\"hljs-number\">2.2</span>) &#x7b2c;<span class=\"hljs-number\">2</span>&#x4e2a;&#x53c2;&#x6570;: &#x6587;&#x4ef6;&#x5bf9;&#x8c61;\n   <span class=\"hljs-number\">2.3</span>) &#x7b2c;<span class=\"hljs-number\">3</span>&#x4e2a;&#x53c2;&#x6570;: ensure_ascii=<span class=\"hljs-literal\">False</span> &#x5e8f;&#x5217;&#x5316;&#x65f6;&#x7f16;&#x7801;\n  \n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;&#x793a;&#x4f8b;&#x4ee3;&#x7801;\n    <span class=\"hljs-comment\"># &#x793a;&#x4f8b;1</span>\n    <span class=\"hljs-keyword\">import</span> json\n\n    item = {<span class=\"hljs-string\">&apos;name&apos;</span>:<span class=\"hljs-string\">&apos;QQ&apos;</span>,<span class=\"hljs-string\">&apos;app_id&apos;</span>:<span class=\"hljs-number\">1</span>}\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&apos;&#x5c0f;&#x7c73;.json&apos;</span>,<span class=\"hljs-string\">&apos;a&apos;</span>) <span class=\"hljs-keyword\">as</span> f:\n      json.dump(item,f,ensure_ascii=<span class=\"hljs-literal\">False</span>)\n  \n    <span class=\"hljs-comment\"># &#x793a;&#x4f8b;2</span>\n    <span class=\"hljs-keyword\">import</span> json\n\n    item_list = []\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">3</span>):\n      item = {<span class=\"hljs-string\">&apos;name&apos;</span>:<span class=\"hljs-string\">&apos;QQ&apos;</span>,<span class=\"hljs-string\">&apos;id&apos;</span>:i}\n      item_list.append(item)\n\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&apos;xiaomi.json&apos;</span>,<span class=\"hljs-string\">&apos;a&apos;</span>) <span class=\"hljs-keyword\">as</span> f:\n        json.dump(item_list,f,ensure_ascii=<span class=\"hljs-literal\">False</span>)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"499,527"}}],"payload":{"tag":"h3","lines":"497,498"}},{"content":"json.dumps(python)","children":[{"content":"<pre data-lines=\"530,543\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x4f5c;&#x7528; : &#x628a; python &#x7c7b;&#x578b; &#x8f6c;&#x4e3a; json &#x683c;&#x5f0f;&#x7684;&#x5b57;&#x7b26;&#x4e32;\n\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011; &#x793a;&#x4f8b;\n<span class=\"hljs-keyword\">import</span> json\n\n<span class=\"hljs-comment\"># json.dumps()&#x4e4b;&#x524d;</span>\nitem = {<span class=\"hljs-string\">&apos;name&apos;</span>:<span class=\"hljs-string\">&apos;QQ&apos;</span>,<span class=\"hljs-string\">&apos;app_id&apos;</span>:<span class=\"hljs-number\">1</span>}\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;before dumps&apos;</span>,<span class=\"hljs-built_in\">type</span>(item)) <span class=\"hljs-comment\"># dict</span>\n<span class=\"hljs-comment\"># json.dumps&#x4e4b;&#x540e;</span>\nitem = json.dumps(item)\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;after dumps&apos;</span>,<span class=\"hljs-built_in\">type</span>(item)) <span class=\"hljs-comment\"># str</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"530,543"}}],"payload":{"tag":"h3","lines":"528,529"}},{"content":"json.load(f)","children":[{"content":"<pre data-lines=\"546,556\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x4f5c;&#x7528; : &#x5c06;json&#x6587;&#x4ef6;&#x8bfb;&#x53d6;,&#x5e76;&#x8f6c;&#x4e3a;python&#x7c7b;&#x578b;\n\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011; &#x793a;&#x4f8b;\n<span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&apos;D:/spider_test/xiaomi.json&apos;</span>,<span class=\"hljs-string\">&apos;r&apos;</span>) <span class=\"hljs-keyword\">as</span> f:\n    data = json.load(f)\n    \n<span class=\"hljs-built_in\">print</span>(data)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"546,556"}}],"payload":{"tag":"h3","lines":"544,545"}},{"content":"json&#x6a21;&#x5757;&#x603b;&#x7ed3;","children":[{"content":"<pre data-lines=\"559,574\"><code class=\"language-python\"><span class=\"hljs-comment\"># &#x722c;&#x866b;&#x6700;&#x5e38;&#x7528;</span>\n&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x6570;&#x636e;&#x6293;&#x53d6; - json.loads(html)\n    &#x5c06;&#x54cd;&#x5e94;&#x5185;&#x5bb9;&#x7531;: json &#x8f6c;&#x4e3a; python\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;&#x6570;&#x636e;&#x4fdd;&#x5b58; - json.dump(item_list,f,ensure_ascii=<span class=\"hljs-literal\">False</span>)\n    &#x5c06;&#x6293;&#x53d6;&#x7684;&#x6570;&#x636e;&#x4fdd;&#x5b58;&#x5230;&#x672c;&#x5730; json&#x6587;&#x4ef6;\n\n<span class=\"hljs-comment\"># &#x6293;&#x53d6;&#x6570;&#x636e;&#x4e00;&#x822c;&#x5904;&#x7406;&#x65b9;&#x5f0f;</span>\n&#x3010;<span class=\"hljs-number\">1</span>&#x3011;txt&#x6587;&#x4ef6;\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;csv&#x6587;&#x4ef6;\n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;json&#x6587;&#x4ef6;\n&#x3010;<span class=\"hljs-number\">4</span>&#x3011;MySQL&#x6570;&#x636e;&#x5e93;\n&#x3010;<span class=\"hljs-number\">5</span>&#x3011;MongoDB&#x6570;&#x636e;&#x5e93;\n&#x3010;<span class=\"hljs-number\">6</span>&#x3011;Redis&#x6570;&#x636e;&#x5e93;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"559,574"}}],"payload":{"tag":"h3","lines":"557,558"}}],"payload":{"tag":"h2","lines":"487,488"}},{"content":"&#x591a;&#x7ebf;&#x7a0b;&#x722c;&#x866b;","children":[{"content":"&#x5e94;&#x7528;&#x573a;&#x666f;","children":[{"content":"<pre data-lines=\"579,583\"><code class=\"language-python\">&#x3010;1&#x3011;&#x591a;&#x8fdb;&#x7a0b; &#xff1a;CPU&#x5bc6;&#x96c6;&#x7a0b;&#x5e8f;\n&#x3010;2&#x3011;&#x591a;&#x7ebf;&#x7a0b; &#xff1a;&#x722c;&#x866b;(&#x7f51;&#x7edc;I/O)&#x3001;&#x672c;&#x5730;&#x78c1;&#x76d8;I/O\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"579,583"}}],"payload":{"tag":"h3","lines":"577,578"}},{"content":"&#x77e5;&#x8bc6;&#x70b9;&#x56de;&#x987e;","children":[{"content":"&#x961f;&#x5217;","children":[{"content":"<pre data-lines=\"588,604\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x5bfc;&#x5165;&#x6a21;&#x5757;\n   <span class=\"hljs-keyword\">from</span> queue <span class=\"hljs-keyword\">import</span> Queue\n\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;&#x4f7f;&#x7528;\n    q = Queue()\n    q.put(url)\n    q.get()   <span class=\"hljs-comment\"># &#x5f53;&#x961f;&#x5217;&#x4e3a;&#x7a7a;&#x65f6;&#xff0c;&#x963b;&#x585e;</span>\n    q.empty() <span class=\"hljs-comment\"># &#x5224;&#x65ad;&#x961f;&#x5217;&#x662f;&#x5426;&#x4e3a;&#x7a7a;&#xff0c;True/False</span>\n\n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;q.get()&#x89e3;&#x9664;&#x963b;&#x585e;&#x65b9;&#x5f0f;\n   <span class=\"hljs-number\">3.1</span>) q.get(block=<span class=\"hljs-literal\">False</span>)\n   <span class=\"hljs-number\">3.2</span>) q.get(block=<span class=\"hljs-literal\">True</span>,timeout=<span class=\"hljs-number\">3</span>)\n   <span class=\"hljs-number\">3.3</span>) <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> q.empty():\n            q.get()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"588,604"}}],"payload":{"tag":"h4","lines":"586,587"}},{"content":"&#x7ebf;&#x7a0b;&#x6a21;&#x5757;","children":[{"content":"<pre data-lines=\"607,627\"><code class=\"language-python\"><span class=\"hljs-comment\"># &#x5bfc;&#x5165;&#x6a21;&#x5757;</span>\n<span class=\"hljs-keyword\">from</span> threading <span class=\"hljs-keyword\">import</span> Thread\n\n<span class=\"hljs-comment\"># &#x4f7f;&#x7528;&#x6d41;&#x7a0b;  </span>\nt = Thread(target=&#x51fd;&#x6570;&#x540d;) <span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x7ebf;&#x7a0b;&#x5bf9;&#x8c61;</span>\nt.start() <span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x5e76;&#x542f;&#x52a8;&#x7ebf;&#x7a0b;</span>\nt.join()  <span class=\"hljs-comment\"># &#x963b;&#x585e;&#x7b49;&#x5f85;&#x56de;&#x6536;&#x7ebf;&#x7a0b;</span>\n\n<span class=\"hljs-comment\"># &#x5982;&#x4f55;&#x521b;&#x5efa;&#x591a;&#x7ebf;&#x7a0b;</span>\nt_list = []\n\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">5</span>):\n    t = Thread(target=&#x51fd;&#x6570;&#x540d;)\n    t_list.append(t)\n    t.start()\n\n<span class=\"hljs-keyword\">for</span> t <span class=\"hljs-keyword\">in</span> t_list:\n    t.join()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"607,627"}}],"payload":{"tag":"h4","lines":"605,606"}}],"payload":{"tag":"h3","lines":"584,585"}}],"payload":{"tag":"h2","lines":"575,576"}},{"content":"&#x4eca;&#x65e5;&#x4f5c;&#x4e1a;","children":[{"content":"&#x793a;&#x4f8b;","children":[{"content":"<pre data-lines=\"661,724\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\n&#x6709;&#x9053;&#x7ffb;&#x8bd1;&#x7834;&#x89e3;\n&quot;&quot;&quot;</span>\n\n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">import</span> random\n<span class=\"hljs-keyword\">from</span> hashlib <span class=\"hljs-keyword\">import</span> md5\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">YdSpider</span>:\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-comment\"># url: &#x4e3a;F12&#x6293;&#x5305;&#x6293;&#x5230;&#x7684; POST &#x7684;&#x5730;&#x5740;</span>\n        <span class=\"hljs-variable language_\">self</span>.url = <span class=\"hljs-string\">&apos;http://fanyi.youdao.com/translate_o?smartresult=dict&amp;smartresult=rule&apos;</span>\n        <span class=\"hljs-variable language_\">self</span>.headers = {\n            <span class=\"hljs-comment\"># Cookie&#x3001;Referer&#x3001;User-Agent &#x4e09;&#x4e2a;,&#x662f;&#x7f51;&#x7ad9;&#x68c0;&#x67e5;&#x9891;&#x7387;&#x6700;&#x9ad8;&#x7684;&#x4e09;&#x4e2a;</span>\n            <span class=\"hljs-string\">&quot;Cookie&quot;</span>: <span class=\"hljs-string\">&quot;DICT_UGC=be3af0da19b5c5e6aa4e17bd8d90b28a|; OUTFOX_SEARCH_USER_ID=-1116822587@101.30.19.86; JSESSIONID=abcFhgsjM3GXwcIUyl8dx; OUTFOX_SEARCH_USER_ID_NCOO=627961735.004065; SESSION_FROM_COOKIE=unknown; ___rl__test__cookies=1584782441965&quot;</span>,\n            <span class=\"hljs-string\">&quot;Referer&quot;</span>: <span class=\"hljs-string\">&quot;http://fanyi.youdao.com/&quot;</span>,\n            <span class=\"hljs-string\">&quot;User-Agent&quot;</span>: <span class=\"hljs-string\">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36&quot;</span>,\n        }\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_ts_salt_sign</span>(<span class=\"hljs-params\">self,word</span>):\n        <span class=\"hljs-comment\"># &#x529f;&#x80fd;&#x51fd;&#x6570;&#xff1a;&#x83b7;&#x53d6; ts + salt + sign</span>\n        ts = <span class=\"hljs-built_in\">str</span>(<span class=\"hljs-built_in\">int</span>(time.time() * <span class=\"hljs-number\">1000</span>))\n        salt = ts + <span class=\"hljs-built_in\">str</span>(random.randint(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">9</span>))\n        string = <span class=\"hljs-string\">&quot;fanyideskweb&quot;</span> + word + salt + <span class=\"hljs-string\">&quot;n%A-rKaT5fb[Gy?;N5@Tj&quot;</span>\n        s = md5()\n        s.update(string.encode())\n        sign = s.hexdigest()\n\n        <span class=\"hljs-keyword\">return</span> ts,salt,sign\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">attack_yd</span>(<span class=\"hljs-params\">self,word</span>):\n        ts,salt,sign = <span class=\"hljs-variable language_\">self</span>.get_ts_salt_sign(word)\n        data = {\n            <span class=\"hljs-string\">&quot;i&quot;</span>: word,\n            <span class=\"hljs-string\">&quot;from&quot;</span>: <span class=\"hljs-string\">&quot;AUTO&quot;</span>,\n            <span class=\"hljs-string\">&quot;to&quot;</span>: <span class=\"hljs-string\">&quot;AUTO&quot;</span>,\n            <span class=\"hljs-string\">&quot;smartresult&quot;</span>: <span class=\"hljs-string\">&quot;dict&quot;</span>,\n            <span class=\"hljs-string\">&quot;client&quot;</span>: <span class=\"hljs-string\">&quot;fanyideskweb&quot;</span>,\n            <span class=\"hljs-string\">&quot;salt&quot;</span>: salt,\n            <span class=\"hljs-string\">&quot;sign&quot;</span>: sign,\n            <span class=\"hljs-string\">&quot;ts&quot;</span>: ts,\n            <span class=\"hljs-string\">&quot;bv&quot;</span>: <span class=\"hljs-string\">&quot;82ac0fd3b5f5289bb79af17e1f202a1e&quot;</span>,\n            <span class=\"hljs-string\">&quot;doctype&quot;</span>: <span class=\"hljs-string\">&quot;json&quot;</span>,\n            <span class=\"hljs-string\">&quot;version&quot;</span>: <span class=\"hljs-string\">&quot;2.1&quot;</span>,\n            <span class=\"hljs-string\">&quot;keyfrom&quot;</span>: <span class=\"hljs-string\">&quot;fanyi.web&quot;</span>,\n            <span class=\"hljs-string\">&quot;action&quot;</span>: <span class=\"hljs-string\">&quot;FY_BY_REALTlME&quot;</span>,\n        }\n        <span class=\"hljs-comment\"># .json() &#x628a;json&#x683c;&#x5f0f;&#x7684;&#x5b57;&#x7b26;&#x4e32;&#x8f6c;&#x4e3a;&#x4e86; python &#x6570;&#x636e;&#x7c7b;&#x578b;</span>\n        html = requests.post(url=<span class=\"hljs-variable language_\">self</span>.url, data=data, headers=<span class=\"hljs-variable language_\">self</span>.headers).json()\n\n        <span class=\"hljs-keyword\">return</span> html[<span class=\"hljs-string\">&apos;translateResult&apos;</span>][<span class=\"hljs-number\">0</span>][<span class=\"hljs-number\">0</span>][<span class=\"hljs-string\">&apos;tgt&apos;</span>]\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>(<span class=\"hljs-params\">self</span>):\n        word = <span class=\"hljs-built_in\">input</span>(<span class=\"hljs-string\">&apos;&#x8bf7;&#x8f93;&#x5165;&#x8981;&#x7ffb;&#x8bd1;&#x7684;&#x5355;&#x8bcd;:&apos;</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-variable language_\">self</span>.attack_yd(word))\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n    spider = YdSpider()\n    spider.run()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"661,724"}},{"content":"<pre data-lines=\"725,819\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\n&#x6c11;&#x653f;&#x90e8;&#x7f51;&#x7ad9; - &#x6700;&#x65b0;&#x884c;&#x653f;&#x533a;&#x5212;&#x4ee3;&#x7801;&#x63d0;&#x53d6;\n&#x601d;&#x8def;&#xff1a;\n1&#x3001;&#x63d0;&#x53d6;&#x5047;&#x94fe;&#x63a5; &#xff1a;&#x5411;&#x4e3b;&#x9875;&#x53d1;&#x8bf7;&#x6c42;,&#x63d0;&#x53d6;&#x6700;&#x65b0;&#x6708;&#x4efd;&#x7684;&#x94fe;&#x63a5;\n2&#x3001;&#x63d0;&#x53d6;&#x771f;&#x94fe;&#x63a5; &#xff1a;&#x5411;&#x5047;&#x94fe;&#x63a5;&#x53d1;&#x8bf7;&#x6c42;,&#x63d0;&#x53d6;&#x771f;&#x5b9e;&#x8fd4;&#x56de;&#x6570;&#x636e;&#x7684;URL&#x5730;&#x5740;\n3&#x3001;&#x63d0;&#x53d6;&#x6570;&#x636e;   &#xff1a;&#x5411;&#x771f;&#x94fe;&#x63a5;&#x53d1;&#x8bf7;&#x6c42;,&#x63d0;&#x53d6;&#x6700;&#x7ec8;&#x6240;&#x9700;&#x6570;&#x636e;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">from</span> lxml <span class=\"hljs-keyword\">import</span> etree\n<span class=\"hljs-keyword\">import</span> redis\n<span class=\"hljs-keyword\">from</span> hashlib <span class=\"hljs-keyword\">import</span> md5\n<span class=\"hljs-keyword\">import</span> sys\n<span class=\"hljs-keyword\">import</span> re\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MzbSpider</span>:\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-variable language_\">self</span>.url = <span class=\"hljs-string\">&apos;http://www.mca.gov.cn/article/sj/xzqh/2020/&apos;</span>\n        <span class=\"hljs-variable language_\">self</span>.headers = {<span class=\"hljs-string\">&apos;User-Agent&apos;</span>:<span class=\"hljs-string\">&apos;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/14.0.835.163 Safari/535.1&apos;</span>}\n        <span class=\"hljs-comment\"># redis&#x5b9e;&#x73b0;&#x589e;&#x91cf;</span>\n        <span class=\"hljs-variable language_\">self</span>.r = redis.Redis(host=<span class=\"hljs-string\">&apos;127.0.0.1&apos;</span>, port=<span class=\"hljs-number\">6379</span>, db=<span class=\"hljs-number\">0</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_html</span>(<span class=\"hljs-params\">self, url</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x529f;&#x80fd;&#x51fd;&#x6570;1&quot;&quot;&quot;</span>\n        html = requests.get(url=url, headers=<span class=\"hljs-variable language_\">self</span>.headers).text\n\n        <span class=\"hljs-keyword\">return</span> html\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">xpath_func</span>(<span class=\"hljs-params\">self, html, xpath_bds</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x529f;&#x80fd;&#x51fd;&#x6570;2&quot;&quot;&quot;</span>\n        p = etree.HTML(html)\n        r_list = p.xpath(xpath_bds)\n\n        <span class=\"hljs-keyword\">return</span> r_list\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">md5_url</span>(<span class=\"hljs-params\">self, url</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x529f;&#x80fd;&#x51fd;&#x6570;3&quot;&quot;&quot;</span>\n        s = md5()\n        s.update(url.encode())\n\n        <span class=\"hljs-keyword\">return</span> s.hexdigest()\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_false_url</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x63d0;&#x53d6;&#x6700;&#x65b0;&#x6708;&#x4efd;&#x7684;&#x94fe;&#x63a5; - &#x5047;&#x94fe;&#x63a5;&quot;&quot;&quot;</span>\n        html = <span class=\"hljs-variable language_\">self</span>.get_html(url=<span class=\"hljs-variable language_\">self</span>.url)\n        one_xpath = <span class=\"hljs-string\">&apos;//table/tr[2]/td[2]/a/@href&apos;</span>\n        href_list = <span class=\"hljs-variable language_\">self</span>.xpath_func(html, one_xpath)\n        <span class=\"hljs-keyword\">if</span> href_list:\n            false_url = <span class=\"hljs-string\">&apos;http://www.mca.gov.cn&apos;</span> + href_list[<span class=\"hljs-number\">0</span>]\n            finger = <span class=\"hljs-variable language_\">self</span>.md5_url(false_url)\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-variable language_\">self</span>.r.sadd(<span class=\"hljs-string\">&apos;mzb:spiders&apos;</span>,finger) == <span class=\"hljs-number\">1</span>:\n                <span class=\"hljs-comment\"># &#x5f00;&#x59cb;&#x8fdb;&#x884c;&#x6570;&#x636e;&#x6293;&#x53d6;</span>\n                <span class=\"hljs-variable language_\">self</span>.get_real_url(false_url)\n            <span class=\"hljs-keyword\">else</span>:\n                sys.exit(<span class=\"hljs-string\">&apos;&#x7f51;&#x7ad9;&#x672a;&#x66f4;&#x65b0;&apos;</span>)\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;&#x6700;&#x65b0;&#x6708;&#x4efd;&#x94fe;&#x63a5;&#x63d0;&#x53d6;&#x5931;&#x8d25;&apos;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_real_url</span>(<span class=\"hljs-params\">self, false_url</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x63d0;&#x53d6;&#x771f;&#x5b9e;&#x8fd4;&#x56de;&#x6570;&#x636e;&#x7684;&#x94fe;&#x63a5;&quot;&quot;&quot;</span>\n        html = <span class=\"hljs-variable language_\">self</span>.get_html(url=false_url)\n        regex = <span class=\"hljs-string\">&apos;window.location.href=&quot;(.*?)&quot;&apos;</span>\n        pattern = re.<span class=\"hljs-built_in\">compile</span>(regex, re.S)\n        <span class=\"hljs-comment\"># &#x63d0;&#x53d6;&#x51fa;&#x4e86;&#x5b9e;&#x9645;&#x8fd4;&#x56de;&#x6570;&#x636e;&#x7684;URL&#x5730;&#x5740;</span>\n        real_url_list = pattern.findall(html)\n        <span class=\"hljs-keyword\">if</span> real_url_list:\n            real_url = real_url_list[<span class=\"hljs-number\">0</span>]\n            <span class=\"hljs-comment\"># &#x63d0;&#x53d6;&#x6240;&#x9700;&#x6570;&#x636e;</span>\n            <span class=\"hljs-variable language_\">self</span>.get_data(real_url)\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;&#x63d0;&#x53d6;&#x771f;&#x5b9e;&#x94fe;&#x63a5;&#x5931;&#x8d25;&apos;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_data</span>(<span class=\"hljs-params\">self, real_url</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x63d0;&#x53d6;&#x5177;&#x4f53;&#x6570;&#x636e;&quot;&quot;&quot;</span>\n        html = <span class=\"hljs-variable language_\">self</span>.get_html(url=real_url)\n        <span class=\"hljs-comment\"># &#x57fa;&#x51c6;xpath</span>\n        two_xpath = <span class=\"hljs-string\">&apos;//tr[@height=&quot;19&quot;]&apos;</span>\n        tr_list = <span class=\"hljs-variable language_\">self</span>.xpath_func(html, two_xpath)\n        item = {}\n        <span class=\"hljs-keyword\">for</span> tr <span class=\"hljs-keyword\">in</span> tr_list:\n            code_list = tr.xpath(<span class=\"hljs-string\">&apos;./td[2]/text() | ./td[2]/span/text()&apos;</span>)\n            name_list = tr.xpath(<span class=\"hljs-string\">&apos;./td[3]/text()&apos;</span>)\n            item[<span class=\"hljs-string\">&apos;code&apos;</span>] = code_list[<span class=\"hljs-number\">0</span>].strip() <span class=\"hljs-keyword\">if</span> code_list <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">None</span>\n            item[<span class=\"hljs-string\">&apos;name&apos;</span>] = name_list[<span class=\"hljs-number\">0</span>].strip() <span class=\"hljs-keyword\">if</span> name_list <span class=\"hljs-keyword\">else</span> <span class=\"hljs-literal\">None</span>\n            <span class=\"hljs-built_in\">print</span>(item)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-variable language_\">self</span>.get_false_url()\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n    spider = MzbSpider()\n    spider.run()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"725,819"}},{"content":"<pre data-lines=\"820,873\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\n&#x8c46;&#x74e3;&#x7535;&#x5f71; - &#x5267;&#x60c5; - &#x6293;&#x53d6;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">from</span> fake_useragent <span class=\"hljs-keyword\">import</span> UserAgent\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">import</span> random\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DoubanSpider</span>:\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-variable language_\">self</span>.url = <span class=\"hljs-string\">&apos;https://movie.douban.com/j/chart/top_list?&apos;</span>\n        <span class=\"hljs-variable language_\">self</span>.i = <span class=\"hljs-number\">0</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_agent</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x83b7;&#x53d6;&#x968f;&#x673a;&#x7684;User-Agent&quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">return</span> UserAgent().random\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_html</span>(<span class=\"hljs-params\">self, params</span>):\n        headers = {<span class=\"hljs-string\">&apos;User-Agent&apos;</span>:<span class=\"hljs-variable language_\">self</span>.get_agent()}\n        html = requests.get(url=<span class=\"hljs-variable language_\">self</span>.url, params=params, headers=headers).json()\n        <span class=\"hljs-variable language_\">self</span>.parse_html(html)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse_html</span>(<span class=\"hljs-params\">self, html</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x89e3;&#x6790;&quot;&quot;&quot;</span>\n        <span class=\"hljs-comment\"># html: [{},{},{},{}]</span>\n        item = {}\n        <span class=\"hljs-keyword\">for</span> one_film <span class=\"hljs-keyword\">in</span> html:\n            item[<span class=\"hljs-string\">&apos;rank&apos;</span>] = one_film[<span class=\"hljs-string\">&apos;rank&apos;</span>]\n            item[<span class=\"hljs-string\">&apos;title&apos;</span>] = one_film[<span class=\"hljs-string\">&apos;title&apos;</span>]\n            item[<span class=\"hljs-string\">&apos;score&apos;</span>] = one_film[<span class=\"hljs-string\">&apos;score&apos;</span>]\n            <span class=\"hljs-built_in\">print</span>(item)\n            <span class=\"hljs-variable language_\">self</span>.i += <span class=\"hljs-number\">1</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">for</span> start <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">684</span>,<span class=\"hljs-number\">20</span>):\n            params = {\n                <span class=\"hljs-string\">&apos;type&apos;</span>: <span class=\"hljs-string\">&apos;11&apos;</span>,\n                <span class=\"hljs-string\">&apos;interval_id&apos;</span>: <span class=\"hljs-string\">&apos;100:90&apos;</span>,\n                <span class=\"hljs-string\">&apos;action&apos;</span>: <span class=\"hljs-string\">&apos;&apos;</span>,\n                <span class=\"hljs-string\">&apos;start&apos;</span>: <span class=\"hljs-built_in\">str</span>(start),\n                <span class=\"hljs-string\">&apos;limit&apos;</span>: <span class=\"hljs-string\">&apos;20&apos;</span>\n            }\n            <span class=\"hljs-variable language_\">self</span>.get_html(params=params)\n            time.sleep(random.randint(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>))\n\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;&#x6570;&#x91cf;:&apos;</span>,<span class=\"hljs-variable language_\">self</span>.i)\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n    spider = DoubanSpider()\n    spider.run()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"820,873"}},{"content":"<pre data-lines=\"874,977\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\n&#x8c46;&#x74e3;&#x7535;&#x5f71; - &#x5267;&#x60c5; - &#x6293;&#x53d6;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">from</span> fake_useragent <span class=\"hljs-keyword\">import</span> UserAgent\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">import</span> random\n<span class=\"hljs-keyword\">import</span> re\n<span class=\"hljs-keyword\">import</span> json\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DoubanSpider</span>:\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-variable language_\">self</span>.url = <span class=\"hljs-string\">&apos;https://movie.douban.com/j/chart/top_list?&apos;</span>\n        <span class=\"hljs-variable language_\">self</span>.i = <span class=\"hljs-number\">0</span>\n        <span class=\"hljs-comment\"># &#x5b58;&#x5165;json&#x6587;&#x4ef6;</span>\n        <span class=\"hljs-variable language_\">self</span>.f = <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&apos;douban.json&apos;</span>, <span class=\"hljs-string\">&apos;w&apos;</span>, encoding=<span class=\"hljs-string\">&apos;utf-8&apos;</span>)\n        <span class=\"hljs-variable language_\">self</span>.all_film_list = []\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_agent</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x83b7;&#x53d6;&#x968f;&#x673a;&#x7684;User-Agent&quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">return</span> UserAgent().random\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_html</span>(<span class=\"hljs-params\">self, params</span>):\n        headers = {<span class=\"hljs-string\">&apos;User-Agent&apos;</span>:<span class=\"hljs-variable language_\">self</span>.get_agent()}\n        html = requests.get(url=<span class=\"hljs-variable language_\">self</span>.url, params=params, headers=headers).text\n        <span class=\"hljs-comment\"># &#x628a;json&#x683c;&#x5f0f;&#x7684;&#x5b57;&#x7b26;&#x4e32;&#x8f6c;&#x4e3a;python&#x6570;&#x636e;&#x7c7b;&#x578b;</span>\n        html = json.loads(html)\n\n        <span class=\"hljs-variable language_\">self</span>.parse_html(html)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse_html</span>(<span class=\"hljs-params\">self, html</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x89e3;&#x6790;&quot;&quot;&quot;</span>\n        <span class=\"hljs-comment\"># html: [{},{},{},{}]</span>\n        item = {}\n        <span class=\"hljs-keyword\">for</span> one_film <span class=\"hljs-keyword\">in</span> html:\n            item[<span class=\"hljs-string\">&apos;rank&apos;</span>] = one_film[<span class=\"hljs-string\">&apos;rank&apos;</span>]\n            item[<span class=\"hljs-string\">&apos;title&apos;</span>] = one_film[<span class=\"hljs-string\">&apos;title&apos;</span>]\n            item[<span class=\"hljs-string\">&apos;score&apos;</span>] = one_film[<span class=\"hljs-string\">&apos;score&apos;</span>]\n            <span class=\"hljs-built_in\">print</span>(item)\n            <span class=\"hljs-variable language_\">self</span>.all_film_list.append(item)\n            <span class=\"hljs-variable language_\">self</span>.i += <span class=\"hljs-number\">1</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-comment\"># d: {&apos;&#x5267;&#x60c5;&apos;:&apos;11&apos;,&apos;&#x7231;&#x60c5;&apos;:&apos;13&apos;,&apos;&#x559c;&#x5267;&apos;:&apos;5&apos;,...,...}</span>\n        d = <span class=\"hljs-variable language_\">self</span>.get_d()\n        <span class=\"hljs-comment\"># 1&#x3001;&#x7ed9;&#x7528;&#x6237;&#x63d0;&#x793a;,&#x8ba9;&#x7528;&#x6237;&#x9009;&#x62e9;</span>\n        menu = <span class=\"hljs-string\">&apos;&apos;</span>\n        <span class=\"hljs-keyword\">for</span> key <span class=\"hljs-keyword\">in</span> d:\n            menu += key + <span class=\"hljs-string\">&apos;|&apos;</span>\n        <span class=\"hljs-built_in\">print</span>(menu)\n        choice = <span class=\"hljs-built_in\">input</span>(<span class=\"hljs-string\">&apos;&#x8bf7;&#x8f93;&#x5165;&#x7535;&#x5f71;&#x7c7b;&#x522b;&#xff1a;&apos;</span>)\n        <span class=\"hljs-keyword\">if</span> choice <span class=\"hljs-keyword\">in</span> d:\n            code = d[choice]\n            <span class=\"hljs-comment\"># 2&#x3001;total: &#x7535;&#x5f71;&#x603b;&#x6570;</span>\n            total = <span class=\"hljs-variable language_\">self</span>.get_total(code)\n            <span class=\"hljs-keyword\">for</span> start <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>,total,<span class=\"hljs-number\">20</span>):\n                params = {\n                    <span class=\"hljs-string\">&apos;type&apos;</span>: code,\n                    <span class=\"hljs-string\">&apos;interval_id&apos;</span>: <span class=\"hljs-string\">&apos;100:90&apos;</span>,\n                    <span class=\"hljs-string\">&apos;action&apos;</span>: <span class=\"hljs-string\">&apos;&apos;</span>,\n                    <span class=\"hljs-string\">&apos;start&apos;</span>: <span class=\"hljs-built_in\">str</span>(start),\n                    <span class=\"hljs-string\">&apos;limit&apos;</span>: <span class=\"hljs-string\">&apos;20&apos;</span>\n                }\n                <span class=\"hljs-variable language_\">self</span>.get_html(params=params)\n                time.sleep(random.randint(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>))\n\n            <span class=\"hljs-comment\"># &#x628a;&#x6570;&#x636e;&#x5b58;&#x5165;json&#x6587;&#x4ef6;</span>\n            json.dump(<span class=\"hljs-variable language_\">self</span>.all_film_list, <span class=\"hljs-variable language_\">self</span>.f, ensure_ascii=<span class=\"hljs-literal\">False</span>)\n            <span class=\"hljs-variable language_\">self</span>.f.close()\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;&#x6570;&#x91cf;:&apos;</span>,<span class=\"hljs-variable language_\">self</span>.i)\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;&#x8bf7;&#x505a;&#x51fa;&#x6b63;&#x786e;&#x7684;&#x9009;&#x62e9;&apos;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_d</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;{&apos;&#x5267;&#x60c5;&apos;:&apos;11&apos;,&apos;&#x7231;&#x60c5;&apos;:&apos;13&apos;,&apos;&#x559c;&#x5267;&apos;:&apos;5&apos;,...,...}&quot;&quot;&quot;</span>\n        url = <span class=\"hljs-string\">&apos;https://movie.douban.com/chart&apos;</span>\n        html = requests.get(url=url,headers={<span class=\"hljs-string\">&apos;User-Agent&apos;</span>:<span class=\"hljs-variable language_\">self</span>.get_agent()}).text\n        regex = <span class=\"hljs-string\">&apos;&lt;span&gt;&lt;a href=&quot;.*?type_name=(.*?)&amp;type=(.*?)&amp;interval_id=100:90&amp;action=&quot;&gt;&apos;</span>\n        pattern = re.<span class=\"hljs-built_in\">compile</span>(regex, re.S)\n        <span class=\"hljs-comment\"># r_list: [(&apos;&#x5267;&#x60c5;&apos;,&apos;11&apos;),(&apos;&#x559c;&#x5267;&apos;,&apos;5&apos;),(&apos;&#x7231;&#x60c5;&apos;:&apos;13&apos;)... ...]</span>\n        r_list = pattern.findall(html)\n        <span class=\"hljs-comment\"># d: {&apos;&#x5267;&#x60c5;&apos;: &apos;11&apos;, &apos;&#x7231;&#x60c5;&apos;: &apos;13&apos;, &apos;&#x559c;&#x5267;&apos;: &apos;5&apos;, ..., ...}</span>\n        d = {}\n        <span class=\"hljs-keyword\">for</span> r <span class=\"hljs-keyword\">in</span> r_list:\n            d[r[<span class=\"hljs-number\">0</span>]] = r[<span class=\"hljs-number\">1</span>]\n\n        <span class=\"hljs-keyword\">return</span> d\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_total</span>(<span class=\"hljs-params\">self, code</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x83b7;&#x53d6;&#x67d0;&#x4e2a;&#x7c7b;&#x522b;&#x4e0b;&#x7684;&#x7535;&#x5f71;&#x603b;&#x6570;&quot;&quot;&quot;</span>\n        url = <span class=\"hljs-string\">&apos;https://movie.douban.com/j/chart/top_list_count?type={}&amp;interval_id=100%3A90&apos;</span>.<span class=\"hljs-built_in\">format</span>(code)\n        html = requests.get(url=url,headers={<span class=\"hljs-string\">&apos;User-Agent&apos;</span>:<span class=\"hljs-variable language_\">self</span>.get_agent()}).text\n        html = json.loads(html)\n\n        <span class=\"hljs-keyword\">return</span> html[<span class=\"hljs-string\">&apos;total&apos;</span>]\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n    spider = DoubanSpider()\n    spider.run()\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"874,977"}},{"content":"<pre data-lines=\"978,997\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\njson.dump()&#x4f7f;&#x7528;\n&#x53c2;&#x6570;3&#x4e2a;&#xff1a;\n1&#x3001;python&#x6570;&#x636e;\n2&#x3001;&#x6587;&#x4ef6;&#x5bf9;&#x8c61;\n3&#x3001;ensure_ascii = Flase\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">import</span> json\n\nall_film_list = [\n    {<span class=\"hljs-string\">&apos;name&apos;</span>:<span class=\"hljs-string\">&apos;&#x5927;&#x5723;&#x5a36;&#x4eb2;&apos;</span>,<span class=\"hljs-string\">&apos;star&apos;</span>:<span class=\"hljs-string\">&apos;&#x5468;&#x661f;&#x9a70;&apos;</span>},\n    {<span class=\"hljs-string\">&apos;name&apos;</span>:<span class=\"hljs-string\">&apos;&#x6708;&#x5149;&#x5b9d;&#x76d2;&apos;</span>,<span class=\"hljs-string\">&apos;star&apos;</span>:<span class=\"hljs-string\">&apos;&#x5468;&#x661f;&#x9a70;&apos;</span>}\n]\n<span class=\"hljs-comment\"># &#x628a;&#x6293;&#x53d6;&#x4e0b;&#x6765;&#x7684;&#x6570;&#x636e;&#x4fdd;&#x5b58;&#x5230;json&#x6587;&#x4ef6;&#x4e2d;</span>\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&apos;film.json&apos;</span>, <span class=\"hljs-string\">&apos;w&apos;</span>, encoding=<span class=\"hljs-string\">&apos;utf-8&apos;</span>) <span class=\"hljs-keyword\">as</span> f:\n    json.dump(all_film_list, f, ensure_ascii=<span class=\"hljs-literal\">False</span>)\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"978,997"}},{"content":"<pre data-lines=\"998,1048\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\n&#x591a;&#x7ebf;&#x7a0b; + &#x7ebf;&#x7a0b;&#x9501;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> threading <span class=\"hljs-keyword\">import</span> Thread,Lock\n\nn = <span class=\"hljs-number\">5000</span>\nlock = Lock()\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">f1</span>():\n    <span class=\"hljs-keyword\">global</span> n\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1000000</span>):\n        lock.acquire()\n        n = n + <span class=\"hljs-number\">1</span>\n        lock.release()\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">f2</span>():\n    <span class=\"hljs-keyword\">global</span> n\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1000000</span>):\n        lock.acquire()\n        n = n - <span class=\"hljs-number\">1</span>\n        lock.release()\n\nt1 = Thread(target=f1)\nt1.start()\nt2 = Thread(target=f2)\nt2.start()\n\nt1.join()\nt2.join()\n\n<span class=\"hljs-built_in\">print</span>(n)\n\n<span class=\"hljs-string\">&quot;&quot;&quot;\nn = 5000\n# &#x6b63;&#x5e38;&#x60c5;&#x51b5;\n&#x6267;&#x884c;1&#x6b21;&#x52a0;1&#x64cd;&#x4f5c;&#x548c;1&#x6b21;&#x51cf;1&#x64cd;&#x4f5c;\nx = n + 1\nn = x       # n=5001\nx = n - 1\nn = x      # n=5000\n\n&#x975e;&#x6b63;&#x5e38;&#x60c5;&#x51b5;&#xff1a;&#x6267;&#x884c;1&#x6b21;&#x52a0;1&#x64cd;&#x4f5c;&#x548c;&#x51cf;1&#x64cd;&#x4f5c;\nx = n + 1    # x=5001\nx = n - 1    # x=4999\nn = x        # n=4999\nn = x        # n=4999\n&quot;&quot;&quot;</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"998,1048"}},{"content":"<pre data-lines=\"1049,1134\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\n&#x8c46;&#x74e3;&#x7535;&#x5f71; - &#x5267;&#x60c5; - &#x6293;&#x53d6;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">from</span> fake_useragent <span class=\"hljs-keyword\">import</span> UserAgent\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">import</span> random\n<span class=\"hljs-keyword\">from</span> threading <span class=\"hljs-keyword\">import</span> Thread,Lock\n<span class=\"hljs-keyword\">from</span> queue <span class=\"hljs-keyword\">import</span> Queue\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DoubanSpider</span>:\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-variable language_\">self</span>.url = <span class=\"hljs-string\">&apos;https://movie.douban.com/j/chart/top_list?type=13&amp;interval_id=100%3A90&amp;action=&amp;start={}&amp;limit=20&apos;</span>\n        <span class=\"hljs-variable language_\">self</span>.i = <span class=\"hljs-number\">0</span>\n        <span class=\"hljs-comment\"># &#x961f;&#x5217; + &#x9501;</span>\n        <span class=\"hljs-variable language_\">self</span>.q = Queue()\n        <span class=\"hljs-variable language_\">self</span>.lock = Lock()\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_agent</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x83b7;&#x53d6;&#x968f;&#x673a;&#x7684;User-Agent&quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">return</span> UserAgent().random\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">url_in</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x628a;&#x6240;&#x6709;&#x8981;&#x6293;&#x53d6;&#x7684;URL&#x5730;&#x5740;&#x5165;&#x961f;&#x5217;&quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">for</span> start <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">684</span>,<span class=\"hljs-number\">20</span>):\n            url = <span class=\"hljs-variable language_\">self</span>.url.<span class=\"hljs-built_in\">format</span>(start)\n            <span class=\"hljs-comment\"># url&#x5165;&#x961f;&#x5217;</span>\n            <span class=\"hljs-variable language_\">self</span>.q.put(url)\n\n    <span class=\"hljs-comment\"># &#x7ebf;&#x7a0b;&#x4e8b;&#x4ef6;&#x51fd;&#x6570;&#xff1a;&#x8bf7;&#x6c42;+&#x89e3;&#x6790;+&#x6570;&#x636e;&#x5904;&#x7406;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_html</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n            <span class=\"hljs-comment\"># &#x4ece;&#x961f;&#x5217;&#x4e2d;&#x83b7;&#x53d6;URL&#x5730;&#x5740;</span>\n            <span class=\"hljs-comment\"># &#x4e00;&#x5b9a;&#x8981;&#x5728;&#x5224;&#x65ad;&#x961f;&#x5217;&#x662f;&#x5426;&#x4e3a;&#x7a7a; &#x548c; get() &#x5730;&#x5740; &#x524d;&#x540e;&#x52a0;&#x9501;,&#x9632;&#x6b62;&#x961f;&#x5217;&#x4e2d;&#x53ea;&#x5269;&#x4e00;&#x4e2a;&#x5730;&#x5740;&#x65f6;&#x51fa;&#x73b0;&#x91cd;&#x590d;&#x5224;&#x65ad;</span>\n            <span class=\"hljs-variable language_\">self</span>.lock.acquire()\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-variable language_\">self</span>.q.empty():\n                headers = {<span class=\"hljs-string\">&apos;User-Agent&apos;</span>: <span class=\"hljs-variable language_\">self</span>.get_agent()}\n                url = <span class=\"hljs-variable language_\">self</span>.q.get()\n                <span class=\"hljs-variable language_\">self</span>.lock.release()\n\n                html = requests.get(url=url, headers=headers).json()\n                <span class=\"hljs-variable language_\">self</span>.parse_html(html)\n            <span class=\"hljs-keyword\">else</span>:\n                <span class=\"hljs-comment\"># &#x5982;&#x679c;&#x961f;&#x5217;&#x4e3a;&#x7a7a;,&#x5219;&#x6700;&#x7ec8;&#x5fc5;&#x987b;&#x91ca;&#x653e;&#x9501;</span>\n                <span class=\"hljs-variable language_\">self</span>.lock.release()\n                <span class=\"hljs-keyword\">break</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse_html</span>(<span class=\"hljs-params\">self, html</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x89e3;&#x6790;&quot;&quot;&quot;</span>\n        <span class=\"hljs-comment\"># html: [{},{},{},{}]</span>\n        item = {}\n        <span class=\"hljs-keyword\">for</span> one_film <span class=\"hljs-keyword\">in</span> html:\n            item[<span class=\"hljs-string\">&apos;rank&apos;</span>] = one_film[<span class=\"hljs-string\">&apos;rank&apos;</span>]\n            item[<span class=\"hljs-string\">&apos;title&apos;</span>] = one_film[<span class=\"hljs-string\">&apos;title&apos;</span>]\n            item[<span class=\"hljs-string\">&apos;score&apos;</span>] = one_film[<span class=\"hljs-string\">&apos;score&apos;</span>]\n            <span class=\"hljs-built_in\">print</span>(item)\n            <span class=\"hljs-comment\"># &#x52a0;&#x9501; + &#x91ca;&#x653e;&#x9501;</span>\n            <span class=\"hljs-variable language_\">self</span>.lock.acquire()\n            <span class=\"hljs-variable language_\">self</span>.i += <span class=\"hljs-number\">1</span>\n            <span class=\"hljs-variable language_\">self</span>.lock.release()\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-comment\"># &#x5148;&#x8ba9;URL&#x5730;&#x5740;&#x5165;&#x961f;&#x5217;</span>\n        <span class=\"hljs-variable language_\">self</span>.url_in()\n        <span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x591a;&#x4e2a;&#x7ebf;&#x7a0b;,&#x5f00;&#x5e72;&#x5427;</span>\n        t_list = []\n        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>):\n            t = Thread(target=<span class=\"hljs-variable language_\">self</span>.get_html)\n            t_list.append(t)\n            t.start()\n\n        <span class=\"hljs-keyword\">for</span> t <span class=\"hljs-keyword\">in</span> t_list:\n            t.join()\n\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;&#x6570;&#x91cf;:&apos;</span>,<span class=\"hljs-variable language_\">self</span>.i)\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n    start_time = time.time()\n    spider = DoubanSpider()\n    spider.run()\n    end_time = time.time()\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;&#x6267;&#x884c;&#x65f6;&#x95f4;:%.2f&apos;</span> % (end_time-start_time))\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1049,1134"}}],"payload":{"tag":"h3","lines":"659,660"}}],"payload":{"tag":"h2","lines":"628,629"}}],"payload":{"tag":"h1","lines":"77,78"}}]},{})</script>
</body>
</html>
