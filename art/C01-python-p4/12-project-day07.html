<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"&#x793a;&#x4f8b;","children":[{"content":"&#x6a21;&#x5757;","children":[{"content":"<pre data-lines=\"6,31\"><code data-lines=\"6,31\">cats\n\t<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x6a21;&#x5757;</span>\ndashop11\n\t<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x6a21;&#x5757;</span>\ndtoken\n\t<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x6a21;&#x5757;</span>\ngoods\n\t<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x6a21;&#x5757;</span>\nmedia\n\t<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x56fe;&#x7247;</span>\norder\n\t<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x6a21;&#x5757;</span>\n\tmigrations\n\t\t<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x6a21;&#x5757;</span>\ntools\n\t<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x6a21;&#x5757;</span>\nuser\n\t<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x6a21;&#x5757;</span>\n\tmigrations\n\t\t<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">&#x6a21;&#x5757;</span>\ndb.sqlite3\ngoods_data.json\nmanage.py\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6,31"}}],"payload":{"tag":"h4","lines":"4,5"}},{"content":"cats","children":[{"content":"<pre data-lines=\"34,41\"><code data-lines=\"34,41\"><span class=\"hljs-comment\"># admin.py</span>\n<span class=\"hljs-keyword\">from</span> django.contrib <span class=\"hljs-keyword\">import</span> admin\n\n<span class=\"hljs-comment\"># Register your models here.</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"34,41"}},{"content":"<pre data-lines=\"42,51\"><code data-lines=\"42,51\"># apps.py\n<span class=\"hljs-keyword\">from</span> django.apps <span class=\"hljs-keyword\">import</span> AppConfig\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-symbol\">CartsConfig</span>(<span class=\"hljs-symbol\">AppConfig</span>):\n    <span class=\"hljs-symbol\">name</span> = &apos;<span class=\"hljs-symbol\">carts</span>&apos;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"42,51"}},{"content":"<pre data-lines=\"52,59\"><code data-lines=\"52,59\"><span class=\"hljs-comment\"># models.py</span>\n<span class=\"hljs-keyword\">from</span> django.db <span class=\"hljs-keyword\">import</span> models\n\n<span class=\"hljs-comment\"># Create your models here.</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"52,59"}},{"content":"<pre data-lines=\"60,67\"><code data-lines=\"60,67\"><span class=\"hljs-comment\"># tests.py</span>\n<span class=\"hljs-keyword\">from</span> django.test <span class=\"hljs-keyword\">import</span> TestCase\n\n<span class=\"hljs-comment\"># Create your tests here.</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"60,67"}},{"content":"<pre data-lines=\"68,79\"><code data-lines=\"68,79\"><span class=\"hljs-comment\"># urls.py</span>\n<span class=\"hljs-keyword\">from</span> django.conf.urls <span class=\"hljs-keyword\">import</span> url\n<span class=\"hljs-keyword\">from</span> . <span class=\"hljs-keyword\">import</span> views\n\nurlpatterns = [\n\n    url(<span class=\"hljs-string\">r&apos;^/(?P&lt;username&gt;\\w{1,11})&#x24;&apos;</span>, views.CartsView.as_view())\n\n]\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"68,79"}},{"content":"<pre data-lines=\"80,248\"><code data-lines=\"80,248\"><span class=\"hljs-comment\"># views.py</span>\n<span class=\"hljs-keyword\">from</span> django.http <span class=\"hljs-keyword\">import</span> JsonResponse\n<span class=\"hljs-keyword\">from</span> django.shortcuts <span class=\"hljs-keyword\">import</span> render\n<span class=\"hljs-keyword\">from</span> django.views <span class=\"hljs-keyword\">import</span> View\n<span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">from</span> tools.logging_dec <span class=\"hljs-keyword\">import</span> logging_check\n<span class=\"hljs-keyword\">from</span> goods.models <span class=\"hljs-keyword\">import</span> SKU\n<span class=\"hljs-keyword\">from</span> django.core.cache <span class=\"hljs-keyword\">import</span> caches\n<span class=\"hljs-keyword\">from</span> django.conf <span class=\"hljs-keyword\">import</span> settings\n\nCARTS_CACHE = caches[<span class=\"hljs-string\">&apos;carts&apos;</span>]\n\n<span class=\"hljs-comment\"># Create your views here.</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">CartsView</span>(<span class=\"hljs-title class_ inherited__\">View</span>):\n\n<span class=\"hljs-meta\">    @logging_check</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-params\">self, request, *args, **kwargs</span>):\n        json_str = request.body\n        request.json_obj = {}\n        <span class=\"hljs-keyword\">if</span> json_str:\n            request.json_obj = json.loads(json_str)\n\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">super</span>().dispatch(request, *args, **kwargs)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_sku_attr_name_and_values</span>(<span class=\"hljs-params\">self, sku</span>):\n\n        sku_sale_attr_name = []\n        sku_sale_attr_values = []\n        sku_sale_values = sku.sale_attr_value.<span class=\"hljs-built_in\">all</span>()\n        <span class=\"hljs-keyword\">for</span> sale <span class=\"hljs-keyword\">in</span> sku_sale_values:\n            sku_sale_attr_values.append(sale.name)\n            sku_sale_attr_name.append(sale.spu_sale_attr.name)\n        <span class=\"hljs-keyword\">return</span> sku_sale_attr_name, sku_sale_attr_values\n\n\n\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_cache_key</span>(<span class=\"hljs-params\">self,uid</span>):\n\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&apos;carts_%s&apos;</span>%(uid)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_carts_all_data</span>(<span class=\"hljs-params\">self, uid</span>):\n        <span class=\"hljs-comment\"># key -&gt; carts_%s(uid)</span>\n        <span class=\"hljs-comment\"># value -&gt; {skuid:{&apos;count&apos;:1,&apos;selected&apos;:1}}</span>\n        <span class=\"hljs-comment\"># value2 -&gt;{skuid:[count, selected]}  - *</span>\n        key = <span class=\"hljs-variable language_\">self</span>.get_cache_key(uid)\n        value = CARTS_CACHE.get(key)\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> value:\n            <span class=\"hljs-keyword\">return</span> {}\n\n        data = {<span class=\"hljs-built_in\">int</span>(k):v <span class=\"hljs-keyword\">for</span> k, v <span class=\"hljs-keyword\">in</span> value.items()}\n        <span class=\"hljs-keyword\">return</span> data\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">set_carts_data</span>(<span class=\"hljs-params\">self, uid, sku_id, data</span>):\n\n        key = <span class=\"hljs-variable language_\">self</span>.get_cache_key(uid)\n        all_data = <span class=\"hljs-variable language_\">self</span>.get_carts_all_data(uid)\n        all_data[sku_id] = data\n        CARTS_CACHE.<span class=\"hljs-built_in\">set</span>(key, all_data)\n\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_carts_lists</span>(<span class=\"hljs-params\">self, user_id</span>):\n\n        carts_data = <span class=\"hljs-variable language_\">self</span>.get_carts_all_data(user_id)\n\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> carts_data:\n            <span class=\"hljs-keyword\">return</span> []\n\n        skus = SKU.objects.<span class=\"hljs-built_in\">filter</span>(id__in=carts_data.keys())\n        skus_list = []\n        <span class=\"hljs-keyword\">for</span> sku <span class=\"hljs-keyword\">in</span> skus:\n            sku_dict = {}\n            sku_dict[<span class=\"hljs-string\">&apos;id&apos;</span>] = sku.<span class=\"hljs-built_in\">id</span>\n            sku_dict[<span class=\"hljs-string\">&apos;name&apos;</span>] = sku.name\n            sku_dict[<span class=\"hljs-string\">&apos;price&apos;</span>] = <span class=\"hljs-built_in\">str</span>(sku.price)\n            sku_dict[<span class=\"hljs-string\">&apos;default_image_url&apos;</span>] = <span class=\"hljs-built_in\">str</span>(sku.default_image_url)\n            sku_dict[<span class=\"hljs-string\">&apos;count&apos;</span>] = <span class=\"hljs-built_in\">int</span>(carts_data[sku.<span class=\"hljs-built_in\">id</span>][<span class=\"hljs-number\">0</span>])\n            sku_dict[<span class=\"hljs-string\">&apos;selected&apos;</span>] = <span class=\"hljs-built_in\">int</span>(carts_data[sku.<span class=\"hljs-built_in\">id</span>][<span class=\"hljs-number\">1</span>])\n            <span class=\"hljs-comment\"># sku_sale_attr_name = [&quot;&#x5c3a;&#x5bf8;&quot;,&quot;&#x989c;&#x8272;&quot;]</span>\n            <span class=\"hljs-comment\"># sku_sale_attr_val = [&quot;18&#x5bf8;&quot;, &quot;&#x84dd;&#x8272;&quot;]</span>\n            sku_sale_attr_name, sku_sale_attr_val = <span class=\"hljs-variable language_\">self</span>.get_sku_attr_name_and_values(sku)\n            sku_dict[<span class=\"hljs-string\">&apos;sku_sale_attr_name&apos;</span>] = sku_sale_attr_name\n            sku_dict[<span class=\"hljs-string\">&apos;sku_sale_attr_val&apos;</span>] = sku_sale_attr_val\n            skus_list.append(sku_dict)\n\n        <span class=\"hljs-keyword\">return</span> skus_list\n\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">post</span>(<span class=\"hljs-params\">self, request, username</span>):\n        <span class=\"hljs-comment\">#&#x6dfb;&#x52a0;&#x8d2d;&#x7269;&#x8f66;</span>\n        <span class=\"hljs-comment\">#{&apos;sku_id&apos;:xxxx, &apos;count&apos;:1}</span>\n        sku_id = request.json_obj[<span class=\"hljs-string\">&apos;sku_id&apos;</span>]\n        count = request.json_obj[<span class=\"hljs-string\">&apos;count&apos;</span>]\n        user = request.myuser\n\n        <span class=\"hljs-keyword\">try</span>:\n            sku = SKU.objects.get(<span class=\"hljs-built_in\">id</span>=sku_id)\n        <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;sku get error %s&apos;</span>%(e))\n            <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-string\">&apos;10400&apos;</span>, <span class=\"hljs-string\">&apos;error&apos;</span>:<span class=\"hljs-string\">&apos;no sku&apos;</span>})\n\n        count = <span class=\"hljs-built_in\">int</span>(count)\n        <span class=\"hljs-comment\">#&#x9884;&#x5224;&#x65ad;&#x5e93;&#x5b58;&#x662f;&#x5426;&#x5145;&#x88d5;</span>\n        <span class=\"hljs-keyword\">if</span> count &gt; sku.stock:\n            <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-string\">&apos;10401&apos;</span>, <span class=\"hljs-string\">&apos;error&apos;</span>: <span class=\"hljs-string\">&apos;stock error&apos;</span>})\n\n        carts = <span class=\"hljs-variable language_\">self</span>.get_carts_all_data(user.<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;---carts data is %s&apos;</span>%(carts))\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> carts:\n            <span class=\"hljs-comment\">#&#x7528;&#x6237;&#x7b2c;&#x4e00;&#x6b21;&#x4f7f;&#x7528;&#x8d2d;&#x7269;&#x8f66;&#x529f;&#x80fd;&#x6dfb;&#x52a0;&#x6570;&#x636e;</span>\n            info = [count, <span class=\"hljs-number\">1</span>]\n            <span class=\"hljs-comment\">#&#x5b58;&#x50a8;&#x5230;&#x8d2d;&#x7269;&#x8f66;</span>\n            <span class=\"hljs-variable language_\">self</span>.set_carts_data(user.<span class=\"hljs-built_in\">id</span>, <span class=\"hljs-built_in\">int</span>(sku_id),info)\n            <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;data&apos;</span>:{<span class=\"hljs-string\">&apos;carts_count&apos;</span>:<span class=\"hljs-number\">1</span>}, <span class=\"hljs-string\">&apos;base_url&apos;</span>: settings.PIC_URL})\n        <span class=\"hljs-keyword\">else</span>:\n            my_info = carts.get(<span class=\"hljs-built_in\">int</span>(sku_id))\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> my_info:\n                new_info = [count, <span class=\"hljs-number\">1</span>]\n            <span class=\"hljs-keyword\">else</span>:\n                <span class=\"hljs-comment\">#&#x4ee3;&#x8868;&#x8d2d;&#x7269;&#x8f66;&#x4e4b;&#x524d;&#x52a0;&#x8fc7;&#x8fd9;&#x4e2a;&#x5305;</span>\n                old_count = my_info[<span class=\"hljs-number\">0</span>]\n                new_count = old_count + count\n                <span class=\"hljs-keyword\">if</span> new_count &gt; sku.stock:\n                    <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">10401</span>, <span class=\"hljs-string\">&apos;error&apos;</span>:<span class=\"hljs-string\">&apos;stock error&apos;</span>})\n                old_select = my_info[<span class=\"hljs-number\">1</span>]\n                new_info = [new_count, old_select]\n            <span class=\"hljs-variable language_\">self</span>.set_carts_data(user.<span class=\"hljs-built_in\">id</span>, <span class=\"hljs-built_in\">int</span>(sku_id), new_info)\n            carts_data = <span class=\"hljs-variable language_\">self</span>.get_carts_all_data(user.<span class=\"hljs-built_in\">id</span>)\n            <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;data&apos;</span>:{<span class=\"hljs-string\">&apos;carts_count&apos;</span>:<span class=\"hljs-built_in\">len</span>(carts_data)}, <span class=\"hljs-string\">&apos;base_url&apos;</span>:settings.PIC_URL})\n\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get</span>(<span class=\"hljs-params\">self, request, username</span>):\n\n        user = request.myuser\n        skus_list = <span class=\"hljs-variable language_\">self</span>.get_carts_lists(user.<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;data&apos;</span>:skus_list, <span class=\"hljs-string\">&apos;base_url&apos;</span>: settings.PIC_URL})\n\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">merge_carts</span>(<span class=\"hljs-params\">self, user_id, carts_info</span>):\n        <span class=\"hljs-comment\">#&#x8fd4;&#x56de;&#x503c; -&gt; &#x8d2d;&#x7269;&#x8f66;sku&#x79cd;&#x7c7b;&#x7684;&#x6570;&#x91cf; -&gt; &#x540c;&#x6b65;&#x8d2d;&#x7269;&#x8f66;&#x5c0f;&#x7ea2;&#x70b9;</span>\n        carts_data = <span class=\"hljs-variable language_\">self</span>.get_carts_all_data(user_id)\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> carts_info:\n            <span class=\"hljs-comment\">#&#x524d;&#x7aef;&#x8d2d;&#x7269;&#x8f66;&#x6ca1;&#x6570;&#x636e;</span>\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">len</span>(carts_data)\n        <span class=\"hljs-keyword\">for</span> c_dic <span class=\"hljs-keyword\">in</span> carts_info:\n            sku_id = <span class=\"hljs-built_in\">int</span>(c_dic[<span class=\"hljs-string\">&apos;id&apos;</span>])\n            count = <span class=\"hljs-built_in\">int</span>(c_dic[<span class=\"hljs-string\">&apos;count&apos;</span>])\n            sku_data = SKU.objects.get(<span class=\"hljs-built_in\">id</span>=sku_id)\n\n            <span class=\"hljs-keyword\">if</span> sku_id <span class=\"hljs-keyword\">in</span> carts_data:\n                <span class=\"hljs-comment\">#&#x5408;&#x5e76;</span>\n                old_count = carts_data[sku_id][<span class=\"hljs-number\">0</span>]\n                new_count = <span class=\"hljs-built_in\">min</span>(sku_data.stock, <span class=\"hljs-built_in\">max</span>(count, old_count))\n                new_info = [new_count, <span class=\"hljs-number\">1</span>]\n            <span class=\"hljs-keyword\">else</span>:\n                new_info = [<span class=\"hljs-built_in\">min</span>(count, sku_data.stock), <span class=\"hljs-number\">1</span>]\n            <span class=\"hljs-variable language_\">self</span>.set_carts_data(user_id, sku_id, new_info)\n\n        new_carts = <span class=\"hljs-variable language_\">self</span>.get_carts_all_data(user_id)\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">len</span>(new_carts)\n\n\n\n\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"80,248"}}],"payload":{"tag":"h4","lines":"32,33"}},{"content":"dashop11","children":[{"content":"<pre data-lines=\"251,256\"><code data-lines=\"251,256\"><span class=\"hljs-meta\"># __init__.py</span>\n<span class=\"hljs-keyword\">import</span> pymysql\n<span class=\"hljs-title\">pymysql</span>.install_as_MySQLdb()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"251,256"}},{"content":"<pre data-lines=\"257,276\"><code data-lines=\"257,276\"># celery.py\n<span class=\"hljs-keyword\">from</span> celery <span class=\"hljs-keyword\">import</span> Celery\n<span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">from</span> django.conf <span class=\"hljs-keyword\">import</span> settings\n#&#x5f53;&#x524d;&#x9879;&#x76ee;&#x7684;&#x914d;&#x7f6e;&#x6587;&#x4ef6;&#x8def;&#x5f84;\nos.environ.setdefault(<span class=\"hljs-string\">&apos;DJANGO_SETTINGS_MODULE&apos;</span>, <span class=\"hljs-string\">&apos;dashop11.settings&apos;</span>)\n\n#&#x53c2;&#x6570;&#x4e2d;&#x7684;&#x540d;&#x5b57; &#x81ea;&#x5b9a;&#x4e49;\napp = Celery(<span class=\"hljs-string\">&apos;dashop11&apos;</span>)\n\napp.conf.update(\n    BROKER_URL =<span class=\"hljs-string\">&apos;redis://@127.0.0.1:6379/4&apos;</span>\n)\n\napp.autodiscover_tasks(settings.INSTALLED_APPS)\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"257,276"}},{"content":"<pre data-lines=\"277,530\"><code data-lines=\"277,530\"><span class=\"hljs-comment\"># settings.py</span>\n<span class=\"hljs-string\">&quot;&quot;&quot;\nDjango settings for dashop11 project.\n\nGenerated by &apos;django-admin startproject&apos; using Django 1.11.8.\n\nFor more information on this file, see\nhttps://docs.djangoproject.com/en/1.11/topics/settings/\n\nFor the full list of settings and their values, see\nhttps://docs.djangoproject.com/en/1.11/ref/settings/\n&quot;&quot;&quot;</span>\n\n<span class=\"hljs-keyword\">import</span> os\n\n<span class=\"hljs-comment\"># Build paths inside the project like this: os.path.join(BASE_DIR, ...)</span>\nBASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\n\n\n<span class=\"hljs-comment\"># Quick-start development settings - unsuitable for production</span>\n<span class=\"hljs-comment\"># See https://docs.djangoproject.com/en/1.11/howto/deployment/checklist/</span>\n\n<span class=\"hljs-comment\"># SECURITY WARNING: keep the secret key used in production secret!</span>\nSECRET_KEY = <span class=\"hljs-string\">&apos;2izd&amp;vh(7sfqbt_h#!h^n2vug*x@r+%685i&amp;#&#x24;f0u)s0d-%6#^&apos;</span>\n\n<span class=\"hljs-comment\"># SECURITY WARNING: don&apos;t run with debug turned on in production!</span>\nDEBUG = <span class=\"hljs-literal\">True</span>\n\nALLOWED_HOSTS = []\n\n\n<span class=\"hljs-comment\"># Application definition</span>\n\nINSTALLED_APPS = [\n    <span class=\"hljs-string\">&apos;django.contrib.admin&apos;</span>,\n    <span class=\"hljs-string\">&apos;django.contrib.auth&apos;</span>,\n    <span class=\"hljs-string\">&apos;django.contrib.contenttypes&apos;</span>,\n    <span class=\"hljs-string\">&apos;django.contrib.sessions&apos;</span>,\n    <span class=\"hljs-string\">&apos;django.contrib.messages&apos;</span>,\n    <span class=\"hljs-string\">&apos;django.contrib.staticfiles&apos;</span>,\n    <span class=\"hljs-string\">&apos;corsheaders&apos;</span>,\n    <span class=\"hljs-string\">&apos;user&apos;</span>,\n    <span class=\"hljs-string\">&apos;dtoken&apos;</span>,\n    <span class=\"hljs-string\">&apos;goods&apos;</span>,\n    <span class=\"hljs-string\">&apos;carts&apos;</span>,\n    <span class=\"hljs-string\">&apos;order&apos;</span>\n]\n\nMIDDLEWARE = [\n    <span class=\"hljs-string\">&apos;django.middleware.security.SecurityMiddleware&apos;</span>,\n    <span class=\"hljs-string\">&apos;django.contrib.sessions.middleware.SessionMiddleware&apos;</span>,\n    <span class=\"hljs-string\">&apos;corsheaders.middleware.CorsMiddleware&apos;</span>,\n    <span class=\"hljs-string\">&apos;django.middleware.common.CommonMiddleware&apos;</span>,\n    <span class=\"hljs-comment\">#&apos;django.middleware.csrf.CsrfViewMiddleware&apos;,</span>\n    <span class=\"hljs-string\">&apos;django.contrib.auth.middleware.AuthenticationMiddleware&apos;</span>,\n    <span class=\"hljs-string\">&apos;django.contrib.messages.middleware.MessageMiddleware&apos;</span>,\n    <span class=\"hljs-string\">&apos;django.middleware.clickjacking.XFrameOptionsMiddleware&apos;</span>,\n]\n\nROOT_URLCONF = <span class=\"hljs-string\">&apos;dashop11.urls&apos;</span>\n\nTEMPLATES = [\n    {\n        <span class=\"hljs-string\">&apos;BACKEND&apos;</span>: <span class=\"hljs-string\">&apos;django.template.backends.django.DjangoTemplates&apos;</span>,\n        <span class=\"hljs-string\">&apos;DIRS&apos;</span>: [],\n        <span class=\"hljs-string\">&apos;APP_DIRS&apos;</span>: <span class=\"hljs-literal\">True</span>,\n        <span class=\"hljs-string\">&apos;OPTIONS&apos;</span>: {\n            <span class=\"hljs-string\">&apos;context_processors&apos;</span>: [\n                <span class=\"hljs-string\">&apos;django.template.context_processors.debug&apos;</span>,\n                <span class=\"hljs-string\">&apos;django.template.context_processors.request&apos;</span>,\n                <span class=\"hljs-string\">&apos;django.contrib.auth.context_processors.auth&apos;</span>,\n                <span class=\"hljs-string\">&apos;django.contrib.messages.context_processors.messages&apos;</span>,\n            ],\n        },\n    },\n]\n\nWSGI_APPLICATION = <span class=\"hljs-string\">&apos;dashop11.wsgi.application&apos;</span>\n\n\n<span class=\"hljs-comment\"># Database</span>\n<span class=\"hljs-comment\"># https://docs.djangoproject.com/en/1.11/ref/settings/#databases</span>\n\nDATABASES = {\n    <span class=\"hljs-string\">&apos;default&apos;</span>: {\n        <span class=\"hljs-string\">&apos;ENGINE&apos;</span>: <span class=\"hljs-string\">&apos;django.db.backends.mysql&apos;</span>,\n        <span class=\"hljs-string\">&apos;NAME&apos;</span>: <span class=\"hljs-string\">&apos;dashop11&apos;</span>,\n        <span class=\"hljs-string\">&apos;USER&apos;</span>: <span class=\"hljs-string\">&apos;root&apos;</span>,\n        <span class=\"hljs-string\">&apos;PASSWORD&apos;</span>: <span class=\"hljs-string\">&apos;123456&apos;</span>,\n        <span class=\"hljs-string\">&apos;HOST&apos;</span>: <span class=\"hljs-string\">&apos;127.0.0.1&apos;</span>,\n        <span class=\"hljs-string\">&apos;PORT&apos;</span>: <span class=\"hljs-string\">&apos;3306&apos;</span>\n    }\n}\n\n\n<span class=\"hljs-comment\"># Password validation</span>\n<span class=\"hljs-comment\"># https://docs.djangoproject.com/en/1.11/ref/settings/#auth-password-validators</span>\n\nAUTH_PASSWORD_VALIDATORS = [\n    {\n        <span class=\"hljs-string\">&apos;NAME&apos;</span>: <span class=\"hljs-string\">&apos;django.contrib.auth.password_validation.UserAttributeSimilarityValidator&apos;</span>,\n    },\n    {\n        <span class=\"hljs-string\">&apos;NAME&apos;</span>: <span class=\"hljs-string\">&apos;django.contrib.auth.password_validation.MinimumLengthValidator&apos;</span>,\n    },\n    {\n        <span class=\"hljs-string\">&apos;NAME&apos;</span>: <span class=\"hljs-string\">&apos;django.contrib.auth.password_validation.CommonPasswordValidator&apos;</span>,\n    },\n    {\n        <span class=\"hljs-string\">&apos;NAME&apos;</span>: <span class=\"hljs-string\">&apos;django.contrib.auth.password_validation.NumericPasswordValidator&apos;</span>,\n    },\n]\n\n\n<span class=\"hljs-comment\"># Internationalization</span>\n<span class=\"hljs-comment\"># https://docs.djangoproject.com/en/1.11/topics/i18n/</span>\n\nLANGUAGE_CODE = <span class=\"hljs-string\">&apos;zh-Hans&apos;</span>\n\nTIME_ZONE = <span class=\"hljs-string\">&apos;Asia/Shanghai&apos;</span>\n\nUSE_I18N = <span class=\"hljs-literal\">True</span>\n\nUSE_L10N = <span class=\"hljs-literal\">True</span>\n\nUSE_TZ = <span class=\"hljs-literal\">True</span>\n\n\n<span class=\"hljs-comment\"># Static files (CSS, JavaScript, Images)</span>\n<span class=\"hljs-comment\"># https://docs.djangoproject.com/en/1.11/howto/static-files/</span>\n\nSTATIC_URL = <span class=\"hljs-string\">&apos;/static/&apos;</span>\n\n\nCORS_ORIGIN_ALLOW_ALL = <span class=\"hljs-literal\">True</span>\n\nCORS_ALLOW_METHODS = (\n    <span class=\"hljs-string\">&apos;DELETE&apos;</span>,\n    <span class=\"hljs-string\">&apos;GET&apos;</span>,\n    <span class=\"hljs-string\">&apos;OPTIONS&apos;</span>,\n    <span class=\"hljs-string\">&apos;PATCH&apos;</span>,\n    <span class=\"hljs-string\">&apos;POST&apos;</span>,\n    <span class=\"hljs-string\">&apos;PUT&apos;</span>,\n)\n<span class=\"hljs-comment\">#ctrl + alt + l &#x53ef;&#x81ea;&#x52a8;&#x8c03;&#x6574;&#x9009;&#x62e9;&#x533a;&#x57df;&#x7684;&#x7f29;&#x8fdb;</span>\nCORS_ALLOW_HEADERS = (\n    <span class=\"hljs-string\">&apos;accept-encoding&apos;</span>,\n    <span class=\"hljs-string\">&apos;authorization&apos;</span>,\n    <span class=\"hljs-string\">&apos;content-type&apos;</span>,\n    <span class=\"hljs-string\">&apos;dnt&apos;</span>,\n    <span class=\"hljs-string\">&apos;origin&apos;</span>,\n    <span class=\"hljs-string\">&apos;user-agent&apos;</span>,\n    <span class=\"hljs-string\">&apos;x-csrftoken&apos;</span>,\n    <span class=\"hljs-string\">&apos;x-requested-with&apos;</span>,\n)\n\n\nSHOP_TOKEN_KEY = <span class=\"hljs-string\">&apos;1234567&apos;</span>\n\n\n\nCACHES = {\n    <span class=\"hljs-string\">&quot;default&quot;</span>: {\n            <span class=\"hljs-string\">&quot;BACKEND&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.cache.RedisCache&quot;</span>,\n            <span class=\"hljs-string\">&quot;LOCATION&quot;</span>: <span class=\"hljs-string\">&quot;redis://127.0.0.1:6379/1&quot;</span>,\n            <span class=\"hljs-string\">&quot;OPTIONS&quot;</span>: {\n                <span class=\"hljs-string\">&quot;CLIENT_CLASS&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.client.DefaultClient&quot;</span>,\n                <span class=\"hljs-comment\">#&quot;PASSWORD&quot;: &apos;123456&apos;,   #&#x6709;&#x5bc6;&#x7801;&#x7684;&#x6dfb;&#x52a0;</span>\n            }\n        },\n    <span class=\"hljs-string\">&quot;user_email&quot;</span>: {\n        <span class=\"hljs-string\">&quot;BACKEND&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.cache.RedisCache&quot;</span>,\n        <span class=\"hljs-string\">&quot;LOCATION&quot;</span>: <span class=\"hljs-string\">&quot;redis://127.0.0.1:6379/2&quot;</span>,\n        <span class=\"hljs-string\">&quot;OPTIONS&quot;</span>: {\n            <span class=\"hljs-string\">&quot;CLIENT_CLASS&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.client.DefaultClient&quot;</span>,\n            <span class=\"hljs-comment\"># &quot;PASSWORD&quot;: &apos;123456&apos;,   #&#x6709;&#x5bc6;&#x7801;&#x7684;&#x6dfb;&#x52a0;</span>\n        }\n    },\n    <span class=\"hljs-string\">&quot;goods&quot;</span>: {\n        <span class=\"hljs-string\">&quot;BACKEND&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.cache.RedisCache&quot;</span>,\n        <span class=\"hljs-string\">&quot;LOCATION&quot;</span>: <span class=\"hljs-string\">&quot;redis://127.0.0.1:6379/2&quot;</span>,\n        <span class=\"hljs-string\">&quot;OPTIONS&quot;</span>: {\n            <span class=\"hljs-string\">&quot;CLIENT_CLASS&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.client.DefaultClient&quot;</span>,\n            <span class=\"hljs-string\">&quot;COMPRESSOR&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.compressors.zlib.ZlibCompressor&quot;</span>\n            <span class=\"hljs-comment\"># &quot;PASSWORD&quot;: &apos;123456&apos;,   #&#x6709;&#x5bc6;&#x7801;&#x7684;&#x6dfb;&#x52a0;</span>\n        }\n    },\n    <span class=\"hljs-string\">&quot;goods_detail&quot;</span>: {\n        <span class=\"hljs-string\">&quot;BACKEND&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.cache.RedisCache&quot;</span>,\n        <span class=\"hljs-string\">&quot;LOCATION&quot;</span>: <span class=\"hljs-string\">&quot;redis://127.0.0.1:6379/3&quot;</span>,\n        <span class=\"hljs-string\">&quot;OPTIONS&quot;</span>: {\n            <span class=\"hljs-string\">&quot;CLIENT_CLASS&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.client.DefaultClient&quot;</span>,\n            <span class=\"hljs-string\">&quot;COMPRESSOR&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.compressors.zlib.ZlibCompressor&quot;</span>\n            <span class=\"hljs-comment\"># &quot;PASSWORD&quot;: &apos;123456&apos;,   #&#x6709;&#x5bc6;&#x7801;&#x7684;&#x6dfb;&#x52a0;</span>\n        }\n    },\n    <span class=\"hljs-string\">&quot;carts&quot;</span>: {\n        <span class=\"hljs-string\">&quot;BACKEND&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.cache.RedisCache&quot;</span>,\n        <span class=\"hljs-string\">&quot;LOCATION&quot;</span>: <span class=\"hljs-string\">&quot;redis://127.0.0.1:6379/4&quot;</span>,\n        <span class=\"hljs-string\">&apos;TIMEOUT&apos;</span>: <span class=\"hljs-literal\">None</span>,\n        <span class=\"hljs-string\">&quot;OPTIONS&quot;</span>: {\n            <span class=\"hljs-string\">&quot;CLIENT_CLASS&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.client.DefaultClient&quot;</span>,\n            <span class=\"hljs-string\">&quot;COMPRESSOR&quot;</span>: <span class=\"hljs-string\">&quot;django_redis.compressors.zlib.ZlibCompressor&quot;</span>\n            <span class=\"hljs-comment\"># &quot;PASSWORD&quot;: &apos;123456&apos;,   #&#x6709;&#x5bc6;&#x7801;&#x7684;&#x6dfb;&#x52a0;</span>\n        }\n    },\n\n}\n\n<span class=\"hljs-comment\">#from django.core.cache import cache, caches</span>\n<span class=\"hljs-comment\">#&#x901a;&#x8fc7;cache&#x53ef;&#x8fdb;&#x884c;&#x76f8;&#x5173;django cache&#x547d;&#x4ee4;&#x7684;&#x64cd;&#x4f5c; &#x5982; set,get&#x7b49;</span>\n<span class=\"hljs-comment\">#c = caches[&apos;user_email&apos;]</span>\n\n<span class=\"hljs-comment\">#from django_redis import get_redis_connection</span>\n<span class=\"hljs-comment\"># r = get_redis_connection(&apos;default&apos;)</span>\n\n\n\nEMAIL_BACKEND = <span class=\"hljs-string\">&apos;django.core.mail.backends.smtp.EmailBackend&apos;</span>\nEMAIL_HOST = <span class=\"hljs-string\">&apos;smtp.qq.com&apos;</span>\nEMAIL_PORT = <span class=\"hljs-number\">25</span>\nEMAIL_HOST_USER = <span class=\"hljs-string\">&apos;572708691@qq.com&apos;</span>\nEMAIL_HOST_PASSWORD = <span class=\"hljs-string\">&apos;rkgimrslgcpjbcjg&apos;</span>\nEMAIL_USE_TLS = <span class=\"hljs-literal\">False</span>\n\n<span class=\"hljs-comment\">#APPEND_SLASH &#x4e3a;True&#x65f6;</span>\n<span class=\"hljs-comment\">#&#x8def;&#x7531;&#x914d;&#x7f6e;-&gt; r&apos;^test/&#x24;&apos;</span>\n<span class=\"hljs-comment\">#&#x6d4f;&#x89c8;&#x5668;  &#x4e2d;&#x5730;&#x5740;&#x680f;&#x8f93;&#x5165;127.0.0.1/test&#x65f6;&#xff0c;</span>\n<span class=\"hljs-comment\">#django&#x4f1a;&#x8fd4;&#x56de;302&#xff0c;&#x5c06;&#x7528;&#x6237;&#x8df3;&#x8f6c;&#x81f3; 127.0.0.1/test/</span>\nAPPEND_SLASH = <span class=\"hljs-literal\">False</span>\n\n\nWEIBO_CLIENT_ID = <span class=\"hljs-string\">&apos;1402695440&apos;</span>\nWEIBO_CLIENT_SECRET = <span class=\"hljs-string\">&apos;4ce611c76bb0e48b46abf4dbb0d933fa&apos;</span>\nWEIBO_REDIRECT_URI = <span class=\"hljs-string\">&apos;http://127.0.0.1:7000/dadashop/templates/callback.html&apos;</span>\n<span class=\"hljs-comment\">#1, &#x8ba9;&#x7528;&#x6237;&#x80fd;&#x8df3;&#x8f6c;&#x5230; &#x5fae;&#x8584;&#x6388;&#x6743;&#x9875; / &#x524d;&#x7aef;login&#x9875;&#x9762; &#x70b9;&#x51fb; &#x5fae;&#x535a;&#x767b;&#x5f55;</span>\n\n\n\n<span class=\"hljs-comment\"># Django &#x6a21;&#x578b;&#x7c7b; image&#x5b57;&#x6bb5;</span>\n<span class=\"hljs-comment\"># &#x9700;&#x8981;&#x5b89;&#x88c5;  sudo pip3 install Pillow==5.1.0</span>\n<span class=\"hljs-comment\"># &#x68c0;&#x67e5; pip3 freeze|grep -i &apos;pillow&apos;</span>\n\n<span class=\"hljs-comment\">#&#x4e0a;&#x4f20;&#x7c7b;&#x7684;&#x6587;&#x4ef6;/&#x56fe;&#x7247; &#x5b58;&#x50a8;&#x8def;&#x5f84;</span>\nMEDIA_ROOT = os.path.join(BASE_DIR, <span class=\"hljs-string\">&apos;media&apos;</span>)\n<span class=\"hljs-comment\">#&#x6807;&#x8bc6;&#x4ec0;&#x4e48;&#x6837;&#x7684;&#x8bf7;&#x6c42; &#x4e3a; &#x8bfb;&#x53d6;&#x4e0a;&#x4f20;&#x6587;&#x4ef6;&#x7684;&#x8bf7;&#x6c42;&#xff0c;&#x8be5;&#x8bf7;&#x6c42;&#x4e0d;&#x8d70;&#x89c6;&#x56fe;&#x51fd;&#x6570;&#xff0c;&#x76f4;&#x63a5;&#x53bb;MEDIA_ROOT&#x8def;&#x5f84;&#x4e0b;&#x5bfb;&#x627e;&#x6587;&#x4ef6; [&#x9700;&#x8981;&#x5728;&#x4e3b;&#x8def;&#x7531;&#x4e2d;&#x6dfb;&#x52a0;&#x65b0;&#x7684;&#x8def;&#x7531;]</span>\nMEDIA_URL = <span class=\"hljs-string\">&apos;/media/&apos;</span>\n\n<span class=\"hljs-comment\">#http://127.0.0.1:8000/media/ + sku/1.jpg</span>\nPIC_URL = <span class=\"hljs-string\">&apos;http://127.0.0.1:8000&apos;</span> + MEDIA_URL\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"277,530"}},{"content":"<pre data-lines=\"531,567\"><code data-lines=\"531,567\"><span class=\"hljs-comment\"># urls.py</span>\n<span class=\"hljs-string\">&quot;&quot;&quot;dashop11 URL Configuration\n\nThe `urlpatterns` list routes URLs to views. For more information please see:\n    https://docs.djangoproject.com/en/1.11/topics/http/urls/\nExamples:\nFunction views\n    1. Add an import:  from my_app import views\n    2. Add a URL to urlpatterns:  url(r&apos;^&#x24;&apos;, views.home, name=&apos;home&apos;)\nClass-based views\n    1. Add an import:  from other_app.views import Home\n    2. Add a URL to urlpatterns:  url(r&apos;^&#x24;&apos;, Home.as_view(), name=&apos;home&apos;)\nIncluding another URLconf\n    1. Import the include() function: from django.conf.urls import url, include\n    2. Add a URL to urlpatterns:  url(r&apos;^blog/&apos;, include(&apos;blog.urls&apos;))\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> django.conf.urls <span class=\"hljs-keyword\">import</span> url,include\n<span class=\"hljs-keyword\">from</span> django.conf.urls.static <span class=\"hljs-keyword\">import</span> static\n<span class=\"hljs-keyword\">from</span> django.contrib <span class=\"hljs-keyword\">import</span> admin\n<span class=\"hljs-keyword\">from</span> . <span class=\"hljs-keyword\">import</span> views\n<span class=\"hljs-keyword\">from</span> django.conf <span class=\"hljs-keyword\">import</span> settings\n\nurlpatterns = [\n    url(<span class=\"hljs-string\">r&apos;^admin/&apos;</span>, admin.site.urls),\n    url(<span class=\"hljs-string\">r&apos;^test_cors&#x24;&apos;</span>, views.test_cors),\n    <span class=\"hljs-comment\">#http://127.0.0.1/v1/users</span>\n    url(<span class=\"hljs-string\">r&apos;^v1/users&apos;</span>, include(<span class=\"hljs-string\">&apos;user.urls&apos;</span>)),\n    url(<span class=\"hljs-string\">r&apos;^v1/tokens&apos;</span>,include(<span class=\"hljs-string\">&apos;dtoken.urls&apos;</span>)),\n    url(<span class=\"hljs-string\">r&apos;^v1/goods&apos;</span>, include(<span class=\"hljs-string\">&apos;goods.urls&apos;</span>)),\n    url(<span class=\"hljs-string\">r&apos;^v1/carts&apos;</span>, include(<span class=\"hljs-string\">&apos;carts.urls&apos;</span>)),\n    url(<span class=\"hljs-string\">r&apos;^v1/orders&apos;</span>, include(<span class=\"hljs-string\">&apos;order.urls&apos;</span>))\n]\n<span class=\"hljs-comment\">#&#x8bbe;&#x7f6e;static&#x65b9;&#x6cd5;&#xff0c;&#x7ed1;&#x5b9a;MEDIA_URL&#x548c;MEDIA_ROOT, &#x5b9e;&#x73b0;&#x4e86; 127.0.0.1:8000/media/a.jpg&#x8bf7;&#x6c42;&#x5230;&#x8fbe;django&#x540e;&#xff0c; django&#x53bb;MEDIA_ROOT&#x4e0b; &#x627e;&#x5bfb;&#x76f8;&#x5e94;&#x8d44;&#x6e90;&#x6587;&#x4ef6;; &#x5f53;&#x524d;&#x65b9;&#x6cd5;&#x53ea;&#x5728;debug=True&#x7684;&#x65f6;&#x5019;&#x751f;&#x6548;</span>\nurlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"531,567"}},{"content":"<pre data-lines=\"568,578\"><code data-lines=\"568,578\"><span class=\"hljs-comment\"># views.py</span>\n<span class=\"hljs-keyword\">from</span> django.http <span class=\"hljs-keyword\">import</span> HttpResponse\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">test_cors</span>(<span class=\"hljs-params\">request</span>):\n\n    <span class=\"hljs-keyword\">return</span> HttpResponse(<span class=\"hljs-string\">&apos;--hahahahaha--&apos;</span>)\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"568,578"}},{"content":"<pre data-lines=\"579,599\"><code data-lines=\"579,599\"><span class=\"hljs-comment\"># wsgi.py</span>\n<span class=\"hljs-string\">&quot;&quot;&quot;\nWSGI config for dashop11 project.\n\nIt exposes the WSGI callable as a module-level variable named ``application``.\n\nFor more information on this file, see\nhttps://docs.djangoproject.com/en/1.11/howto/deployment/wsgi/\n&quot;&quot;&quot;</span>\n\n<span class=\"hljs-keyword\">import</span> os\n\n<span class=\"hljs-keyword\">from</span> django.core.wsgi <span class=\"hljs-keyword\">import</span> get_wsgi_application\n\nos.environ.setdefault(<span class=\"hljs-string\">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class=\"hljs-string\">&quot;dashop11.settings&quot;</span>)\n\napplication = get_wsgi_application()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"579,599"}}],"payload":{"tag":"h4","lines":"249,250"}},{"content":"dtoken","children":[{"content":"<pre data-lines=\"604,611\"><code data-lines=\"604,611\"><span class=\"hljs-comment\"># admin.py</span>\n<span class=\"hljs-keyword\">from</span> django.contrib <span class=\"hljs-keyword\">import</span> admin\n\n<span class=\"hljs-comment\"># Register your models here.</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"604,611"}},{"content":"<pre data-lines=\"612,621\"><code data-lines=\"612,621\"># apps.py\n<span class=\"hljs-keyword\">from</span> django.apps <span class=\"hljs-keyword\">import</span> AppConfig\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-symbol\">DtokenConfig</span>(<span class=\"hljs-symbol\">AppConfig</span>):\n    <span class=\"hljs-symbol\">name</span> = &apos;<span class=\"hljs-symbol\">dtoken</span>&apos;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"612,621"}},{"content":"<pre data-lines=\"622,629\"><code data-lines=\"622,629\"><span class=\"hljs-comment\"># models.py</span>\n<span class=\"hljs-keyword\">from</span> django.db <span class=\"hljs-keyword\">import</span> models\n\n<span class=\"hljs-comment\"># Create your models here.</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"622,629"}},{"content":"<pre data-lines=\"630,637\"><code data-lines=\"630,637\"><span class=\"hljs-comment\"># tests.py</span>\n<span class=\"hljs-keyword\">from</span> django.test <span class=\"hljs-keyword\">import</span> TestCase\n\n<span class=\"hljs-comment\"># Create your tests here.</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"630,637"}},{"content":"<pre data-lines=\"638,649\"><code data-lines=\"638,649\"><span class=\"hljs-comment\">#urls.py</span>\n<span class=\"hljs-keyword\">from</span> django.conf.urls <span class=\"hljs-keyword\">import</span> url\n<span class=\"hljs-keyword\">from</span> . <span class=\"hljs-keyword\">import</span> views\n\nurlpatterns = [\n\n    url(<span class=\"hljs-string\">r&apos;^&#x24;&apos;</span>, views.tokens)\n\n]\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"638,649"}},{"content":"<pre data-lines=\"650,710\"><code data-lines=\"650,710\"><span class=\"hljs-comment\"># views.py</span>\n<span class=\"hljs-keyword\">import</span> hashlib\n<span class=\"hljs-keyword\">import</span> json\n\n<span class=\"hljs-keyword\">from</span> django.http <span class=\"hljs-keyword\">import</span> JsonResponse\n<span class=\"hljs-keyword\">from</span> django.shortcuts <span class=\"hljs-keyword\">import</span> render\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">from</span> django.conf <span class=\"hljs-keyword\">import</span> settings\n<span class=\"hljs-keyword\">from</span> user.models <span class=\"hljs-keyword\">import</span> UserProfile\n<span class=\"hljs-keyword\">from</span> carts.views <span class=\"hljs-keyword\">import</span> CartsView\n\n<span class=\"hljs-comment\">#10200 - 10299 code</span>\n\n<span class=\"hljs-comment\"># Create your views here.</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">tokens</span>(<span class=\"hljs-params\">request</span>):\n    <span class=\"hljs-comment\">#&#x767b;&#x5f55;</span>\n    <span class=\"hljs-keyword\">if</span> request.method != <span class=\"hljs-string\">&apos;POST&apos;</span>:\n        result = {<span class=\"hljs-string\">&apos;code&apos;</span>: <span class=\"hljs-number\">10200</span> , <span class=\"hljs-string\">&apos;error&apos;</span>: <span class=\"hljs-string\">&apos;Please use POST&apos;</span>}\n        <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n    json_str = request.body\n    json_obj = json.loads(json_str)\n    username = json_obj[<span class=\"hljs-string\">&apos;username&apos;</span>]\n    password = json_obj[<span class=\"hljs-string\">&apos;password&apos;</span>]\n\n    users = UserProfile.objects.<span class=\"hljs-built_in\">filter</span>(username=username)\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> users:\n        result = {<span class=\"hljs-string\">&apos;code&apos;</span>: <span class=\"hljs-number\">10201</span>, <span class=\"hljs-string\">&apos;error&apos;</span>:<span class=\"hljs-string\">&apos;username or password is wrong !!&apos;</span>}\n        <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n\n    user = users[<span class=\"hljs-number\">0</span>]\n    m = hashlib.md5()\n    m.update(password.encode())\n    <span class=\"hljs-keyword\">if</span> m.hexdigest() != user.password:\n        result = {<span class=\"hljs-string\">&apos;code&apos;</span>: <span class=\"hljs-number\">10202</span>, <span class=\"hljs-string\">&apos;error&apos;</span>: <span class=\"hljs-string\">&apos;username or password is wrong !!&apos;</span>}\n        <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n    <span class=\"hljs-comment\">#&#x53d1;&#x95e8;&#x7968;</span>\n    token = make_token(username)\n    result = {<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;username&apos;</span>:username,<span class=\"hljs-string\">&apos;data&apos;</span>:{<span class=\"hljs-string\">&apos;token&apos;</span>:token.decode()},<span class=\"hljs-string\">&apos;carts_count&apos;</span>:<span class=\"hljs-number\">0</span>}\n\n    <span class=\"hljs-comment\">#&#x5408;&#x5e76;&#x8d2d;&#x7269;&#x8f66;</span>\n    carts_data = json_obj.get(<span class=\"hljs-string\">&apos;carts&apos;</span>)\n    carts_obj = CartsView()\n    carts_len = carts_obj.merge_carts(user.<span class=\"hljs-built_in\">id</span>, carts_data)\n    result[<span class=\"hljs-string\">&apos;carts_count&apos;</span>] = carts_len\n\n    <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">make_token</span>(<span class=\"hljs-params\">username, expire=<span class=\"hljs-number\">3600</span>*<span class=\"hljs-number\">24</span></span>):\n\n    <span class=\"hljs-keyword\">import</span> jwt\n    now = time.time()\n    key = settings.SHOP_TOKEN_KEY\n    payload = {<span class=\"hljs-string\">&apos;username&apos;</span>:username, <span class=\"hljs-string\">&apos;exp&apos;</span>:<span class=\"hljs-built_in\">int</span>(now+expire)}\n    <span class=\"hljs-keyword\">return</span> jwt.encode(payload, key, algorithm=<span class=\"hljs-string\">&apos;HS256&apos;</span>)\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"650,710"}}],"payload":{"tag":"h4","lines":"602,603"}},{"content":"goods","children":[{"content":"<pre data-lines=\"713,943\"><code data-lines=\"713,943\"><span class=\"hljs-comment\"># admin.py</span>\n<span class=\"hljs-keyword\">from</span> django.contrib <span class=\"hljs-keyword\">import</span> admin\n<span class=\"hljs-keyword\">from</span> .models <span class=\"hljs-keyword\">import</span> *\n\n<span class=\"hljs-keyword\">from</span> django.core.cache <span class=\"hljs-keyword\">import</span> caches\nGOODS_CACHES = caches[<span class=\"hljs-string\">&apos;goods&apos;</span>]\nGD_CACHES = caches[<span class=\"hljs-string\">&apos;goods_detail&apos;</span>]\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BaseModel</span>(admin.ModelAdmin):\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    &#x7ee7;&#x627f;admin.ModelAdmin\n    &#x91cd;&#x5199;save_model / delete_model &#x65b9;&#x6cd5;\n    &quot;&quot;&quot;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">save_model</span>(<span class=\"hljs-params\">self, request, obj, form, change</span>):\n        <span class=\"hljs-built_in\">super</span>().save_model(request, obj, form, change)\n        <span class=\"hljs-comment\"># &#x5220;&#x9664;&#x9996;&#x9875;&#x7f13;&#x5b58;</span>\n        GOODS_CACHES.clear()\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x4fdd;&#x5b58;&#x6570;&#x636e;&#x65f6;&#xff0c;&#x9996;&#x9875;&#x7f13;&#x5b58;&#x5220;&#x9664;&quot;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">delete_model</span>(<span class=\"hljs-params\">self, request, obj</span>):\n        <span class=\"hljs-built_in\">super</span>().delete_model(request, obj)\n        <span class=\"hljs-comment\"># &#x5220;&#x9664;&#x9996;&#x9875;&#x7f13;&#x5b58;</span>\n        GOODS_CACHES.clear()\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x5220;&#x9664;&#x6570;&#x636e;&#x65f6;&#xff0c;&#x9996;&#x9875;&#x7f13;&#x5b58;&#x5220;&#x9664;&quot;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">delete_goods_detail_cache</span>(<span class=\"hljs-params\">self, sku_id</span>):\n\n        cache_key = <span class=\"hljs-string\">&apos;gd%s&apos;</span>%(sku_id)\n        GD_CACHES.delete(cache_key)\n\n<span class=\"hljs-comment\">#admin.site.register(Brand, BrandAdmin)</span>\n\n<span class=\"hljs-meta\">@admin.register(<span class=\"hljs-params\">Brand</span>)</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BrandAdmin</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    list_display = [<span class=\"hljs-string\">&apos;id&apos;</span>, <span class=\"hljs-string\">&apos;name&apos;</span>]\n\n    <span class=\"hljs-comment\"># list_per_page&#x8bbe;&#x7f6e;&#x6bcf;&#x9875;&#x663e;&#x793a;&#x591a;&#x5c11;&#x6761;&#x8bb0;&#x5f55;&#xff0c;&#x9ed8;&#x8ba4;&#x662f;100&#x6761;</span>\n    list_per_page = <span class=\"hljs-number\">20</span>\n\n    <span class=\"hljs-comment\"># ordering&#x8bbe;&#x7f6e;&#x9ed8;&#x8ba4;&#x6392;&#x5e8f;&#x5b57;&#x6bb5;&#xff0c;&#x521b;&#x5efa;&#x65f6;&#x95f4;&#x964d;&#x5e8f;&#x6392;&#x5e8f;</span>\n    ordering = (<span class=\"hljs-string\">&apos;created_time&apos;</span>,)\n\n\n<span class=\"hljs-meta\">@admin.register(<span class=\"hljs-params\">Catalog</span>)</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">CatalogAdmin</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    list_display = [<span class=\"hljs-string\">&apos;id&apos;</span>, <span class=\"hljs-string\">&apos;name&apos;</span>]\n\n    <span class=\"hljs-comment\"># list_per_page&#x8bbe;&#x7f6e;&#x6bcf;&#x9875;&#x663e;&#x793a;&#x591a;&#x5c11;&#x6761;&#x8bb0;&#x5f55;&#xff0c;&#x9ed8;&#x8ba4;&#x662f;100&#x6761;</span>\n    list_per_page = <span class=\"hljs-number\">20</span>\n\n    <span class=\"hljs-comment\"># ordering&#x8bbe;&#x7f6e;&#x9ed8;&#x8ba4;&#x6392;&#x5e8f;&#x5b57;&#x6bb5;&#xff0c;&#x521b;&#x5efa;&#x65f6;&#x95f4;&#x964d;&#x5e8f;&#x6392;&#x5e8f;</span>\n    ordering = (<span class=\"hljs-string\">&apos;created_time&apos;</span>,)\n\n\n<span class=\"hljs-meta\">@admin.register(<span class=\"hljs-params\">SPU</span>)</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SPUAdmin</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n\n    list_display = [<span class=\"hljs-string\">&apos;id&apos;</span>, <span class=\"hljs-string\">&apos;name&apos;</span>, <span class=\"hljs-string\">&apos;catalog&apos;</span>]\n\n    <span class=\"hljs-comment\"># list_per_page&#x8bbe;&#x7f6e;&#x6bcf;&#x9875;&#x663e;&#x793a;&#x591a;&#x5c11;&#x6761;&#x8bb0;&#x5f55;&#xff0c;&#x9ed8;&#x8ba4;&#x662f;100&#x6761;</span>\n    list_per_page = <span class=\"hljs-number\">20</span>\n\n    <span class=\"hljs-comment\"># ordering&#x8bbe;&#x7f6e;&#x9ed8;&#x8ba4;&#x6392;&#x5e8f;&#x5b57;&#x6bb5;&#xff0c;&#x521b;&#x5efa;&#x65f6;&#x95f4;&#x964d;&#x5e8f;&#x6392;&#x5e8f;</span>\n    ordering = (<span class=\"hljs-string\">&apos;created_time&apos;</span>,)\n\n    <span class=\"hljs-comment\"># fk_fields &#x8bbe;&#x7f6e;&#x663e;&#x793a;&#x5916;&#x952e;&#x5b57;&#x6bb5;</span>\n    fk_fields = (<span class=\"hljs-string\">&apos;catalog&apos;</span>,)\n\n    search_fields = (<span class=\"hljs-string\">&apos;name&apos;</span>, )  <span class=\"hljs-comment\"># &#x641c;&#x7d22;&#x5b57;&#x6bb5;</span>\n\n\n<span class=\"hljs-meta\">@admin.register(<span class=\"hljs-params\">SPUSaleAttr</span>)</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SPUSaleAttrAdmin</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">save_model</span>(<span class=\"hljs-params\">self, request, obj, form, change</span>):\n        <span class=\"hljs-built_in\">super</span>().save_model(request, obj, form, change)\n        <span class=\"hljs-comment\"># &#x5220;&#x9664;&#x9996;&#x9875;&#x7f13;&#x5b58;</span>\n        GOODS_CACHES.clear()\n        <span class=\"hljs-comment\">#&#x5220;&#x9664;spu&#x5bf9;&#x5e94;&#x7684;sku&#x7f13;&#x5b58;</span>\n        all_sku_ids = obj.spu.sku_set.values(<span class=\"hljs-string\">&apos;id&apos;</span>)\n        <span class=\"hljs-keyword\">for</span> sid <span class=\"hljs-keyword\">in</span> all_sku_ids:\n            _<span class=\"hljs-built_in\">id</span> = sid[<span class=\"hljs-string\">&apos;id&apos;</span>]\n            <span class=\"hljs-variable language_\">self</span>.delete_goods_detail_cache(_<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x4fdd;&#x5b58;&#x6570;&#x636e;&#x65f6;&#xff0c;&#x9996;&#x9875;&#x7f13;&#x5b58;&#x5220;&#x9664;&#xff0c;&#x8be6;&#x60c5;&#x9875;&#x7f13;&#x5b58;&#x5220;&#x9664;&quot;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">delete_model</span>(<span class=\"hljs-params\">self, request, obj</span>):\n        all_sku_ids = obj.spu.sku_set.values(<span class=\"hljs-string\">&apos;id&apos;</span>)\n        <span class=\"hljs-built_in\">super</span>().delete_model(request, obj)\n        <span class=\"hljs-comment\"># &#x5220;&#x9664;&#x9996;&#x9875;&#x7f13;&#x5b58;</span>\n        GOODS_CACHES.clear()\n        <span class=\"hljs-comment\">#&#x5220;&#x9664;spu&#x5bf9;&#x5e94;&#x7684;sku&#x7f13;&#x5b58;</span>\n        <span class=\"hljs-keyword\">for</span> sid <span class=\"hljs-keyword\">in</span> all_sku_ids:\n            _<span class=\"hljs-built_in\">id</span> = sid[<span class=\"hljs-string\">&apos;id&apos;</span>]\n            <span class=\"hljs-variable language_\">self</span>.delete_goods_detail_cache(_<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x4fdd;&#x5b58;&#x6570;&#x636e;&#x65f6;&#xff0c;&#x9996;&#x9875;&#x7f13;&#x5b58;&#x5220;&#x9664;&#xff0c;&#x8be6;&#x60c5;&#x9875;&#x7f13;&#x5b58;&#x5220;&#x9664;&quot;</span>)\n\n    list_display = [<span class=\"hljs-string\">&apos;id&apos;</span>, <span class=\"hljs-string\">&apos;spu&apos;</span>, <span class=\"hljs-string\">&apos;name&apos;</span>]\n\n    <span class=\"hljs-comment\"># list_per_page&#x8bbe;&#x7f6e;&#x6bcf;&#x9875;&#x663e;&#x793a;&#x591a;&#x5c11;&#x6761;&#x8bb0;&#x5f55;&#xff0c;&#x9ed8;&#x8ba4;&#x662f;100&#x6761;</span>\n    list_per_page = <span class=\"hljs-number\">20</span>\n\n    <span class=\"hljs-comment\"># ordering&#x8bbe;&#x7f6e;&#x9ed8;&#x8ba4;&#x6392;&#x5e8f;&#x5b57;&#x6bb5;&#xff0c;&#x521b;&#x5efa;&#x65f6;&#x95f4;&#x964d;&#x5e8f;&#x6392;&#x5e8f;</span>\n    ordering = (<span class=\"hljs-string\">&apos;created_time&apos;</span>,)\n\n    <span class=\"hljs-comment\"># fk_fields &#x8bbe;&#x7f6e;&#x663e;&#x793a;&#x5916;&#x952e;&#x5b57;&#x6bb5;</span>\n    fk_fields = (<span class=\"hljs-string\">&apos;spu&apos;</span>,)\n\n    search_fields = (<span class=\"hljs-string\">&apos;name&apos;</span>,)  <span class=\"hljs-comment\"># &#x641c;&#x7d22;&#x5b57;&#x6bb5;</span>\n\n\n<span class=\"hljs-meta\">@admin.register(<span class=\"hljs-params\">SKU</span>)</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SKUAdmin</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">save_model</span>(<span class=\"hljs-params\">self, request, obj, form, change</span>):\n        <span class=\"hljs-built_in\">super</span>().save_model(request, obj, form, change)\n        GOODS_CACHES.clear()\n        <span class=\"hljs-variable language_\">self</span>.delete_goods_detail_cache(obj.<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x4fdd;&#x5b58;&#x6570;&#x636e;&#x65f6;&#xff0c;&#x9996;&#x9875;&#x7f13;&#x5b58;&#x5220;&#x9664;&#xff0c;&#x8be6;&#x60c5;&#x9875;&#x7f13;&#x5b58;&#x5220;&#x9664;&quot;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">delete_model</span>(<span class=\"hljs-params\">self, request, obj</span>):\n        <span class=\"hljs-built_in\">super</span>().delete_model(request, obj)\n        <span class=\"hljs-comment\"># &#x5220;&#x9664;&#x9996;&#x9875;&#x7f13;&#x5b58;</span>\n        GOODS_CACHES.clear()\n        <span class=\"hljs-variable language_\">self</span>.delete_goods_detail_cache(obj.<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x4fdd;&#x5b58;&#x6570;&#x636e;&#x65f6;&#xff0c;&#x9996;&#x9875;&#x7f13;&#x5b58;&#x5220;&#x9664;&#xff0c;&#x8be6;&#x60c5;&#x9875;&#x7f13;&#x5b58;&#x5220;&#x9664;&quot;</span>)\n\n    list_display = [<span class=\"hljs-string\">&apos;id&apos;</span>, <span class=\"hljs-string\">&apos;name&apos;</span>, <span class=\"hljs-string\">&apos;spu&apos;</span>, <span class=\"hljs-string\">&apos;is_launched&apos;</span>,]\n    <span class=\"hljs-comment\"># list_per_page&#x8bbe;&#x7f6e;&#x6bcf;&#x9875;&#x663e;&#x793a;&#x591a;&#x5c11;&#x6761;&#x8bb0;&#x5f55;&#xff0c;&#x9ed8;&#x8ba4;&#x662f;100&#x6761;</span>\n    list_per_page = <span class=\"hljs-number\">20</span>\n\n    <span class=\"hljs-comment\"># ordering&#x8bbe;&#x7f6e;&#x9ed8;&#x8ba4;&#x6392;&#x5e8f;&#x5b57;&#x6bb5;&#xff0c;&#x521b;&#x5efa;&#x65f6;&#x95f4;&#x964d;&#x5e8f;&#x6392;&#x5e8f;</span>\n    ordering = (<span class=\"hljs-string\">&apos;created_time&apos;</span>,)\n\n    <span class=\"hljs-comment\"># fk_fields &#x8bbe;&#x7f6e;&#x663e;&#x793a;&#x5916;&#x952e;&#x5b57;&#x6bb5;</span>\n    fk_fields = (<span class=\"hljs-string\">&apos;spu&apos;</span>,)\n\n    search_fields = (<span class=\"hljs-string\">&apos;name&apos;</span>,)  <span class=\"hljs-comment\"># &#x641c;&#x7d22;&#x5b57;&#x6bb5;</span>\n\n\n<span class=\"hljs-meta\">@admin.register(<span class=\"hljs-params\">SaleAttrValue</span>)</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SaleAttrValueAdmin</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    list_display = [<span class=\"hljs-string\">&apos;id&apos;</span>, <span class=\"hljs-string\">&apos;name&apos;</span>, <span class=\"hljs-string\">&apos;spu_sale_attr&apos;</span>,]\n    <span class=\"hljs-comment\"># list_per_page&#x8bbe;&#x7f6e;&#x6bcf;&#x9875;&#x663e;&#x793a;&#x591a;&#x5c11;&#x6761;&#x8bb0;&#x5f55;&#xff0c;&#x9ed8;&#x8ba4;&#x662f;100&#x6761;</span>\n    list_per_page = <span class=\"hljs-number\">20</span>\n\n    <span class=\"hljs-comment\"># ordering&#x8bbe;&#x7f6e;&#x9ed8;&#x8ba4;&#x6392;&#x5e8f;&#x5b57;&#x6bb5;&#xff0c;&#x521b;&#x5efa;&#x65f6;&#x95f4;&#x964d;&#x5e8f;&#x6392;&#x5e8f;</span>\n    ordering = (<span class=\"hljs-string\">&apos;created_time&apos;</span>,)\n\n    <span class=\"hljs-comment\"># fk_fields &#x8bbe;&#x7f6e;&#x663e;&#x793a;&#x5916;&#x952e;&#x5b57;&#x6bb5;</span>\n    fk_fields = (<span class=\"hljs-string\">&apos;spu_sale_attr&apos;</span>,)\n\n    search_fields = (<span class=\"hljs-string\">&apos;name&apos;</span>,)  <span class=\"hljs-comment\"># &#x641c;&#x7d22;&#x5b57;&#x6bb5;</span>\n\n\n<span class=\"hljs-meta\">@admin.register(<span class=\"hljs-params\">SKUImage</span>)</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SKUImageAdmin</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">save_model</span>(<span class=\"hljs-params\">self, request, obj, form, change</span>):\n        <span class=\"hljs-built_in\">super</span>().save_model(request, obj, form, change)\n        <span class=\"hljs-comment\"># &#x5220;&#x9664;&#x8be6;&#x60c5;&#x9875;&#x7f13;&#x5b58;</span>\n        <span class=\"hljs-variable language_\">self</span>.delete_goods_detail_cache(obj.sku.<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;sku.id&quot;</span>, obj.sku.<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x4fdd;&#x5b58;&#x6570;&#x636e;&#x65f6;&#xff0c;&#x8be6;&#x60c5;&#x9875;&#x7f13;&#x5b58;&#x6e05;&#x9664;&quot;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">delete_model</span>(<span class=\"hljs-params\">self, request, obj</span>):\n        <span class=\"hljs-built_in\">super</span>().delete_model(request, obj)\n        <span class=\"hljs-comment\"># &#x5220;&#x9664;&#x8be6;&#x60c5;&#x9875;&#x7f13;&#x5b58;</span>\n        <span class=\"hljs-variable language_\">self</span>.delete_goods_detail_cache(obj.sku.<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;sku.id&quot;</span>, obj.sku.<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x4fdd;&#x5b58;&#x6570;&#x636e;&#x65f6;&#xff0c;&#x8be6;&#x60c5;&#x9875;&#x7f13;&#x5b58;&#x6e05;&#x9664;&quot;</span>)\n\n    list_display = [<span class=\"hljs-string\">&apos;id&apos;</span>, <span class=\"hljs-string\">&apos;sku&apos;</span>, <span class=\"hljs-string\">&apos;image&apos;</span>,]\n    <span class=\"hljs-comment\"># list_per_page&#x8bbe;&#x7f6e;&#x6bcf;&#x9875;&#x663e;&#x793a;&#x591a;&#x5c11;&#x6761;&#x8bb0;&#x5f55;&#xff0c;&#x9ed8;&#x8ba4;&#x662f;100&#x6761;</span>\n    list_per_page = <span class=\"hljs-number\">20</span>\n\n    <span class=\"hljs-comment\"># ordering&#x8bbe;&#x7f6e;&#x9ed8;&#x8ba4;&#x6392;&#x5e8f;&#x5b57;&#x6bb5;&#xff0c;&#x521b;&#x5efa;&#x65f6;&#x95f4;&#x964d;&#x5e8f;&#x6392;&#x5e8f;</span>\n    ordering = (<span class=\"hljs-string\">&apos;created_time&apos;</span>,)\n\n    <span class=\"hljs-comment\"># fk_fields &#x8bbe;&#x7f6e;&#x663e;&#x793a;&#x5916;&#x952e;&#x5b57;&#x6bb5;</span>\n    fk_fields = (<span class=\"hljs-string\">&apos;sku&apos;</span>,)\n\n\n<span class=\"hljs-meta\">@admin.register(<span class=\"hljs-params\">SPUSpec</span>)</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SPUSpecAdmin</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n\n    list_display = [<span class=\"hljs-string\">&apos;id&apos;</span>, <span class=\"hljs-string\">&apos;spu&apos;</span>, <span class=\"hljs-string\">&apos;name&apos;</span>]\n\n    <span class=\"hljs-comment\"># list_per_page&#x8bbe;&#x7f6e;&#x6bcf;&#x9875;&#x663e;&#x793a;&#x591a;&#x5c11;&#x6761;&#x8bb0;&#x5f55;&#xff0c;&#x9ed8;&#x8ba4;&#x662f;100&#x6761;</span>\n    list_per_page = <span class=\"hljs-number\">20</span>\n\n    <span class=\"hljs-comment\"># ordering&#x8bbe;&#x7f6e;&#x9ed8;&#x8ba4;&#x6392;&#x5e8f;&#x5b57;&#x6bb5;&#xff0c;&#x521b;&#x5efa;&#x65f6;&#x95f4;&#x964d;&#x5e8f;&#x6392;&#x5e8f;</span>\n    ordering = (<span class=\"hljs-string\">&apos;created_time&apos;</span>,)\n\n    <span class=\"hljs-comment\"># fk_fields &#x8bbe;&#x7f6e;&#x663e;&#x793a;&#x5916;&#x952e;&#x5b57;&#x6bb5;</span>\n    fk_fields = (<span class=\"hljs-string\">&apos;spu&apos;</span>,)\n\n    search_fields = (<span class=\"hljs-string\">&apos;name&apos;</span>,)  <span class=\"hljs-comment\"># &#x641c;&#x7d22;&#x5b57;&#x6bb5;</span>\n\n\n<span class=\"hljs-meta\">@admin.register(<span class=\"hljs-params\">SKUSpecValue</span>)</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SKUSpecValueAdmin</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">save_model</span>(<span class=\"hljs-params\">self, request, obj, form, change</span>):\n        <span class=\"hljs-built_in\">super</span>().save_model(request, obj, form, change)\n        <span class=\"hljs-comment\"># &#x5220;&#x9664;&#x8be6;&#x60c5;&#x9875;&#x7f13;&#x5b58;</span>\n        <span class=\"hljs-variable language_\">self</span>.delete_goods_detail_cache(obj.sku.<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;sku.id&quot;</span>, obj.sku.<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x4fdd;&#x5b58;&#x6570;&#x636e;&#x65f6;&#xff0c;&#x8be6;&#x60c5;&#x9875;&#x7f13;&#x5b58;&#x6e05;&#x9664;&quot;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">delete_model</span>(<span class=\"hljs-params\">self, request, obj</span>):\n        <span class=\"hljs-built_in\">super</span>().delete_model(request, obj)\n        <span class=\"hljs-comment\"># &#x5220;&#x9664;&#x8be6;&#x60c5;&#x9875;&#x7f13;&#x5b58;</span>\n        <span class=\"hljs-variable language_\">self</span>.delete_goods_detail_cache(obj.sku.<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x4fdd;&#x5b58;&#x6570;&#x636e;&#x65f6;&#xff0c;&#x8be6;&#x60c5;&#x9875;&#x7f13;&#x5b58;&#x6e05;&#x9664;&quot;</span>)\n\n    list_display = [<span class=\"hljs-string\">&apos;id&apos;</span>, <span class=\"hljs-string\">&apos;sku&apos;</span>, <span class=\"hljs-string\">&apos;spu_spec&apos;</span>, <span class=\"hljs-string\">&apos;name&apos;</span>]\n\n    <span class=\"hljs-comment\"># list_per_page&#x8bbe;&#x7f6e;&#x6bcf;&#x9875;&#x663e;&#x793a;&#x591a;&#x5c11;&#x6761;&#x8bb0;&#x5f55;&#xff0c;&#x9ed8;&#x8ba4;&#x662f;100&#x6761;</span>\n    list_per_page = <span class=\"hljs-number\">20</span>\n\n    <span class=\"hljs-comment\"># ordering&#x8bbe;&#x7f6e;&#x9ed8;&#x8ba4;&#x6392;&#x5e8f;&#x5b57;&#x6bb5;&#xff0c;&#x521b;&#x5efa;&#x65f6;&#x95f4;&#x964d;&#x5e8f;&#x6392;&#x5e8f;</span>\n    ordering = (<span class=\"hljs-string\">&apos;created_time&apos;</span>,)\n\n    <span class=\"hljs-comment\"># fk_fields &#x8bbe;&#x7f6e;&#x663e;&#x793a;&#x5916;&#x952e;&#x5b57;&#x6bb5;</span>\n    fk_fields = (<span class=\"hljs-string\">&apos;sku&apos;</span>, <span class=\"hljs-string\">&apos;spu_spec&apos;</span>)\n\n    search_fields = (<span class=\"hljs-string\">&apos;spec_name&apos;</span>,)  <span class=\"hljs-comment\"># &#x641c;&#x7d22;&#x5b57;&#x6bb5;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"713,943"}},{"content":"<pre data-lines=\"944,953\"><code data-lines=\"944,953\"># apps.py\n<span class=\"hljs-keyword\">from</span> django.apps <span class=\"hljs-keyword\">import</span> AppConfig\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-symbol\">GoodsConfig</span>(<span class=\"hljs-symbol\">AppConfig</span>):\n    <span class=\"hljs-symbol\">name</span> = &apos;<span class=\"hljs-symbol\">goods</span>&apos;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"944,953"}},{"content":"<pre data-lines=\"954,1127\"><code data-lines=\"954,1127\"><span class=\"hljs-comment\"># models.py</span>\n<span class=\"hljs-keyword\">from</span> django.db <span class=\"hljs-keyword\">import</span> models\n<span class=\"hljs-keyword\">from</span> tools.models <span class=\"hljs-keyword\">import</span> BaseModel\n\n\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Catalog</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    &#x5546;&#x54c1;&#x7c7b;&#x522b;\n    &quot;&quot;&quot;</span>\n    name = models.CharField(max_length=<span class=\"hljs-number\">10</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x7c7b;&#x522b;&#x540d;&#x79f0;&apos;</span>)\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Meta</span>:\n\n        verbose_name = <span class=\"hljs-string\">&apos;&#x5546;&#x54c1;&#x7c7b;&#x522b;&apos;</span>\n        verbose_name_plural = verbose_name\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__str__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">self</span>.name\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Brand</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    &#x54c1;&#x724c;\n    &quot;&quot;&quot;</span>\n\n    name = models.CharField(max_length=<span class=\"hljs-number\">20</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x5546;&#x54c1;&#x540d;&#x79f0;&apos;</span>)\n    logo = models.ImageField(verbose_name=<span class=\"hljs-string\">&apos;Logo&#x56fe;&#x7247;&apos;</span>, upload_to=<span class=\"hljs-string\">&apos;brand&apos;</span>)\n    first_letter = models.CharField(max_length=<span class=\"hljs-number\">1</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x54c1;&#x724c;&#x9996;&#x5b57;&#x6bcd;&apos;</span>)\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Meta</span>:\n\n        verbose_name = <span class=\"hljs-string\">&apos;&#x54c1;&#x724c;&apos;</span>\n        verbose_name_plural = verbose_name\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__str__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">self</span>.name\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SPU</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n\n    name = models.CharField(max_length=<span class=\"hljs-number\">50</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x540d;&#x79f0;&apos;</span>)\n    sales = models.IntegerField(default=<span class=\"hljs-number\">0</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x5546;&#x54c1;&#x9500;&#x91cf;&apos;</span>)\n    comments = models.IntegerField(default=<span class=\"hljs-number\">0</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x8bc4;&#x4ef7;&#x6570;&#x91cf;&apos;</span>)\n    brand = models.ForeignKey(Brand, verbose_name=<span class=\"hljs-string\">&apos;&#x54c1;&#x724c;&apos;</span>)\n    catalog = models.ForeignKey(Catalog, verbose_name=<span class=\"hljs-string\">&apos;&#x5546;&#x54c1;&#x7c7b;&#x522b;&apos;</span>)\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Meta</span>:\n\n        verbose_name = <span class=\"hljs-string\">&apos;SPU&apos;</span>\n        verbose_name_plural = verbose_name\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__str__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">self</span>.name\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SPUSaleAttr</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    SPU&#x9500;&#x552e;&#x5c5e;&#x6027;&#x8868;\n    &quot;&quot;&quot;</span>\n    spu = models.ForeignKey(SPU)\n    name = models.CharField(max_length=<span class=\"hljs-number\">20</span>, verbose_name=<span class=\"hljs-string\">&apos;SPU&#x5c5e;&#x6027;&#x540d;&#x79f0;&apos;</span>)\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Meta</span>:\n        db_table = <span class=\"hljs-string\">&apos;goods_spu_sale_attr&apos;</span>\n        verbose_name = <span class=\"hljs-string\">&apos;SPU&#x9500;&#x552e;&#x5c5e;&#x6027;&apos;</span>\n        verbose_name_plural = verbose_name\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__str__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&apos;%s&apos;</span> % (<span class=\"hljs-variable language_\">self</span>.name)\n\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SaleAttrValue</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    &#x9500;&#x552e;&#x5c5e;&#x6027;&#x503c;&#x8868;\n    &quot;&quot;&quot;</span>\n    spu_sale_attr = models.ForeignKey(SPUSaleAttr, on_delete=models.CASCADE, verbose_name=<span class=\"hljs-string\">&apos;&#x9500;&#x552e;&#x5c5e;&#x6027;&apos;</span>)\n    name = models.CharField(max_length=<span class=\"hljs-number\">20</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x9500;&#x552e;&#x5c5e;&#x6027;&#x503c;&#x540d;&#x79f0;&apos;</span>)\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Meta</span>:\n        db_table = <span class=\"hljs-string\">&apos;goods_sale_attr_value&apos;</span>\n        verbose_name = <span class=\"hljs-string\">&apos;&#x9500;&#x552e;&#x5c5e;&#x6027;&#x503c;&apos;</span>\n        verbose_name_plural = verbose_name\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__str__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-comment\"># return &apos;%s - %s - %s&apos; % (self.sale_attr_id, self.sku.name, self.sale_attr_value_name)</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&apos;%s - %s&apos;</span> % (<span class=\"hljs-variable language_\">self</span>.spu_sale_attr, <span class=\"hljs-variable language_\">self</span>.name)\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SKU</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    SKU\n    &quot;&quot;&quot;</span>\n    name = models.CharField(max_length=<span class=\"hljs-number\">50</span>, verbose_name=<span class=\"hljs-string\">&apos;SKU&#x540d;&#x79f0;&apos;</span>)\n    caption = models.CharField(max_length=<span class=\"hljs-number\">100</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x526f;&#x6807;&#x9898;&apos;</span>)\n    spu = models.ForeignKey(SPU)\n    price = models.DecimalField(max_digits=<span class=\"hljs-number\">10</span>, decimal_places=<span class=\"hljs-number\">2</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x5355;&#x4ef7;&apos;</span>)\n    cost_price = models.DecimalField(max_digits=<span class=\"hljs-number\">10</span>, decimal_places=<span class=\"hljs-number\">2</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x8fdb;&#x4ef7;&apos;</span>)\n    market_price = models.DecimalField(max_digits=<span class=\"hljs-number\">10</span>, decimal_places=<span class=\"hljs-number\">2</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x5e02;&#x573a;&#x4ef7;&apos;</span>)\n    stock = models.IntegerField(default=<span class=\"hljs-number\">0</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x5e93;&#x5b58;&apos;</span>)\n    sales = models.IntegerField(default=<span class=\"hljs-number\">0</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x9500;&#x91cf;&apos;</span>)\n    comments = models.IntegerField(default=<span class=\"hljs-number\">0</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x8bc4;&#x4ef7;&#x6570;&apos;</span>)\n    is_launched = models.BooleanField(default=<span class=\"hljs-literal\">True</span>, verbose_name=<span class=\"hljs-string\">&apos;&#x662f;&#x5426;&#x4e0a;&#x67b6;&#x9500;&#x552e;&apos;</span>)\n    default_image_url = models.ImageField(verbose_name=<span class=\"hljs-string\">&apos;&#x9ed8;&#x8ba4;&#x56fe;&#x7247;&apos;</span>,default=<span class=\"hljs-literal\">None</span>, upload_to=<span class=\"hljs-string\">&apos;sku&apos;</span>)\n    version = models.IntegerField(default=<span class=\"hljs-number\">0</span>,verbose_name=<span class=\"hljs-string\">&quot;&#x5e93;&#x5b58;&#x7248;&#x672c;&quot;</span>)\n    sale_attr_value = models.ManyToManyField(SaleAttrValue)\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Meta</span>:\n\n        verbose_name = <span class=\"hljs-string\">&apos;SKU&#x8868;&apos;</span>\n        verbose_name_plural = verbose_name\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__str__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&apos;%s: %s&apos;</span> % (<span class=\"hljs-variable language_\">self</span>.<span class=\"hljs-built_in\">id</span>, <span class=\"hljs-variable language_\">self</span>.name)\n\n\n\n\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SKUImage</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    SKU&#x56fe;&#x7247;\n    &quot;&quot;&quot;</span>\n    sku = models.ForeignKey(SKU, on_delete=models.CASCADE, verbose_name=<span class=\"hljs-string\">&apos;sku&apos;</span>)\n    <span class=\"hljs-comment\">#upload_to&#x53c2;&#x6570;&#xff0c; &#x5f53;&#x56fe;&#x7247;&#x6267;&#x884c;&#x4e0a;&#x4f20;&#x65f6;&#xff0c;django&#x4f1a;&#x628a;&#x56fe;&#x7247;&#x4e0a;&#x4f20;&#x81f3; MEDIA_ROOT + upload_to&#x8def;&#x5f84;&#x4e0b;</span>\n    image = models.ImageField(verbose_name=<span class=\"hljs-string\">&apos;&#x56fe;&#x7247;&#x8def;&#x5f84;&apos;</span>, upload_to=<span class=\"hljs-string\">&apos;sku_images&apos;</span>)\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Meta</span>:\n        db_table = <span class=\"hljs-string\">&apos;goods_sku_image&apos;</span>\n        verbose_name = <span class=\"hljs-string\">&apos;SKU&#x56fe;&#x7247;&apos;</span>\n        verbose_name_plural = verbose_name\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__str__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&apos;%s %s&apos;</span> % (<span class=\"hljs-variable language_\">self</span>.sku.name, <span class=\"hljs-variable language_\">self</span>.<span class=\"hljs-built_in\">id</span>)\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SPUSpec</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    SPU&#x89c4;&#x683c;&#x8868;\n    &quot;&quot;&quot;</span>\n    spu = models.ForeignKey(SPU)\n    name = models.CharField(max_length=<span class=\"hljs-number\">20</span>, verbose_name=<span class=\"hljs-string\">&apos;SPU&#x89c4;&#x683c;&#x540d;&#x79f0;&apos;</span>)\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Meta</span>:\n        db_table = <span class=\"hljs-string\">&apos;goods_spu_spec&apos;</span>\n        verbose_name = <span class=\"hljs-string\">&apos;SPU&#x89c4;&#x683c;&apos;</span>\n        verbose_name_plural = verbose_name\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__str__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&apos;%s: %s&apos;</span> % (<span class=\"hljs-variable language_\">self</span>.spu.name, <span class=\"hljs-variable language_\">self</span>.name)\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SKUSpecValue</span>(<span class=\"hljs-title class_ inherited__\">BaseModel</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    SKU&#x89c4;&#x683c;&#x5c5e;&#x6027;&#x8868;\n    &quot;&quot;&quot;</span>\n    sku = models.ForeignKey(SKU)\n    spu_spec = models.ForeignKey(SPUSpec)\n    name = models.CharField(max_length=<span class=\"hljs-number\">20</span>, verbose_name=<span class=\"hljs-string\">&apos;SKU&#x89c4;&#x683c;&#x540d;&#x79f0;&#x503c;&apos;</span>)\n\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Meta</span>:\n        db_table = <span class=\"hljs-string\">&apos;goods_spu_spec_value&apos;</span>\n        verbose_name = <span class=\"hljs-string\">&apos;SKU&#x89c4;&#x683c;&#x5c5e;&#x6027;&#x503c;&#x8868;&apos;</span>\n        verbose_name_plural = verbose_name\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__str__</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&apos;%s: %s: %s&apos;</span> % (<span class=\"hljs-variable language_\">self</span>.sku, <span class=\"hljs-variable language_\">self</span>.spu_spec.name, <span class=\"hljs-variable language_\">self</span>.name)\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"954,1127"}},{"content":"<pre data-lines=\"1128,1135\"><code data-lines=\"1128,1135\"><span class=\"hljs-comment\"># tests.py</span>\n<span class=\"hljs-keyword\">from</span> django.test <span class=\"hljs-keyword\">import</span> TestCase\n\n<span class=\"hljs-comment\"># Create your tests here.</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1128,1135"}},{"content":"<pre data-lines=\"1136,1152\"><code data-lines=\"1136,1152\"><span class=\"hljs-comment\"># urls.py</span>\n<span class=\"hljs-keyword\">from</span> django.conf.urls <span class=\"hljs-keyword\">import</span> url\n<span class=\"hljs-keyword\">from</span> . <span class=\"hljs-keyword\">import</span> views\n<span class=\"hljs-keyword\">from</span> django.views.decorators.cache <span class=\"hljs-keyword\">import</span> cache_page\n\n\n\nurlpatterns=[\n\n    url(<span class=\"hljs-string\">r&apos;^/index&#x24;&apos;</span>,  cache_page(<span class=\"hljs-number\">60</span>, cache=<span class=\"hljs-string\">&apos;goods&apos;</span>)(views.GoodsIndexView.as_view())),\n    url(<span class=\"hljs-string\">r&apos;^/detail/(?P&lt;sku_id&gt;\\d+)&#x24;&apos;</span>,views.GoodsDetailView.as_view())\n\n\n]\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1136,1152"}},{"content":"<pre data-lines=\"1153,1354\"><code data-lines=\"1153,1354\"><span class=\"hljs-comment\"># views.py</span>\n<span class=\"hljs-keyword\">from</span> django.core.paginator <span class=\"hljs-keyword\">import</span> Paginator\n<span class=\"hljs-keyword\">from</span> django.http <span class=\"hljs-keyword\">import</span> JsonResponse\n<span class=\"hljs-keyword\">from</span> django.views.generic <span class=\"hljs-keyword\">import</span> View\n<span class=\"hljs-keyword\">from</span> django_redis.compressors <span class=\"hljs-keyword\">import</span> zlib\n<span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">from</span> django.conf <span class=\"hljs-keyword\">import</span> settings\n<span class=\"hljs-keyword\">from</span> tools.cache_dec <span class=\"hljs-keyword\">import</span> cache_check\n\n<span class=\"hljs-keyword\">from</span> .models <span class=\"hljs-keyword\">import</span> *\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GoodsIndexView</span>(<span class=\"hljs-title class_ inherited__\">View</span>):\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get</span>(<span class=\"hljs-params\">self, request</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &#x9996;&#x9875;&#x5546;&#x54c1;&#x53ca;&#x5206;&#x7c7b;&#x9879;&#x5c55;&#x793a;\n\n        :param result:\n        :return:\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-comment\"># 127.0.0.1:8000/v1/goods/index</span>\n        <span class=\"hljs-comment\"># 0. &#x83b7;&#x53d6;&#x6240;&#x6709;&#x54c1;&#x7c7b;</span>\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;----goods index view in----&apos;</span>)\n        catalog_list = Catalog.objects.<span class=\"hljs-built_in\">all</span>()\n        <span class=\"hljs-comment\"># 1. &#x83b7;&#x53d6;&#x5404;&#x4e2a;catalog&#x4e0b;&#x7684;&#x4e09;&#x6761;sku&#x6570;&#x636e;&#xff0c;&#x9996;&#x9875;&#x6bcf;&#x4e2a;&#x54c1;&#x7c7b;&#x4e0b;&#x9762;&#x9ed8;&#x8ba4;&#x663e;&#x793a;&#x4e09;&#x4e2a;sku</span>\n        index_data = []\n        <span class=\"hljs-comment\"># &#x4ece;redis&#x4e2d;&#x83b7;&#x53d6;&#x6240;&#x6709;&#x6570;&#x636e;</span>\n\n        <span class=\"hljs-keyword\">for</span> cata <span class=\"hljs-keyword\">in</span> catalog_list:\n            catalog_dic = {}\n            catalog_dic[<span class=\"hljs-string\">&quot;catalog_id&quot;</span>] = cata.<span class=\"hljs-built_in\">id</span>\n            catalog_dic[<span class=\"hljs-string\">&quot;catalog_name&quot;</span>] = cata.name\n            <span class=\"hljs-comment\"># 1.1 &#x83b7;&#x53d6;&#x62c9;&#x6746;&#x7bb1;sku</span>\n            spu_ids = SPU.objects.<span class=\"hljs-built_in\">filter</span>(catalog=cata.<span class=\"hljs-built_in\">id</span>).values(<span class=\"hljs-string\">&quot;id&quot;</span>)\n            sku_list = SKU.objects.<span class=\"hljs-built_in\">filter</span>(spu__in=spu_ids, is_launched=<span class=\"hljs-literal\">True</span>)[:<span class=\"hljs-number\">3</span>]\n            catalog_dic[<span class=\"hljs-string\">&quot;sku&quot;</span>] = []\n            <span class=\"hljs-keyword\">for</span> sku <span class=\"hljs-keyword\">in</span> sku_list:\n                sku_dict = <span class=\"hljs-built_in\">dict</span>()\n                sku_dict[<span class=\"hljs-string\">&apos;skuid&apos;</span>] = sku.<span class=\"hljs-built_in\">id</span>\n                sku_dict[<span class=\"hljs-string\">&apos;caption&apos;</span>] = sku.caption\n                sku_dict[<span class=\"hljs-string\">&apos;name&apos;</span>] = sku.name\n                sku_dict[<span class=\"hljs-string\">&apos;price&apos;</span>] = <span class=\"hljs-built_in\">str</span>(sku.price)\n                sku_dict[<span class=\"hljs-string\">&apos;image&apos;</span>] = <span class=\"hljs-built_in\">str</span>(sku.default_image_url)\n                catalog_dic[<span class=\"hljs-string\">&quot;sku&quot;</span>].append(sku_dict)\n            index_data.append(catalog_dic)\n\n        result = {<span class=\"hljs-string\">&quot;code&quot;</span>: <span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&quot;data&quot;</span>: index_data, <span class=\"hljs-string\">&quot;base_url&quot;</span>: settings.PIC_URL}\n\n        <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GoodsListView</span>(<span class=\"hljs-title class_ inherited__\">View</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get</span>(<span class=\"hljs-params\">self, request, catalog_id</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &#x83b7;&#x53d6;&#x5217;&#x8868;&#x9875;&#x5185;&#x5bb9;\n        :param request:\n        :param catalog_id: &#x5206;&#x7c7b;id\n        :param page_num: &#x7b2c;&#x51e0;&#x9875;\n        :param page_size: &#x6bcf;&#x9875;&#x663e;&#x793a;&#x591a;&#x5c11;&#x9879;\n        :return:\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-comment\"># 127.0.0.1:8000/v1/goods/catalogs/1/?launched=true&amp;page=1</span>\n        <span class=\"hljs-comment\"># 0. &#x83b7;&#x53d6;url&#x4f20;&#x9012;&#x53c2;&#x6570;&#x503c;</span>\n        launched = <span class=\"hljs-built_in\">bool</span>(request.GET.get(<span class=\"hljs-string\">&apos;launched&apos;</span>, <span class=\"hljs-literal\">True</span>))\n        page_num = request.GET.get(<span class=\"hljs-string\">&apos;page&apos;</span>, <span class=\"hljs-number\">1</span>)\n        <span class=\"hljs-comment\"># 1.&#x83b7;&#x53d6;&#x5206;&#x7c7b;&#x4e0b;&#x7684;sku&#x5217;&#x8868;</span>\n        spu_list_ids = SPU.objects.<span class=\"hljs-built_in\">filter</span>(catalog=catalog_id).values(<span class=\"hljs-string\">&quot;id&quot;</span>)\n        sku_list = SKU.objects.<span class=\"hljs-built_in\">filter</span>(spu__in=spu_list_ids, is_launched=launched).order_by(<span class=\"hljs-string\">&quot;id&quot;</span>)\n        <span class=\"hljs-comment\"># 2.&#x5206;&#x9875;</span>\n        <span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x5206;&#x9875;&#x5bf9;&#x8c61;&#xff0c;&#x6307;&#x5b9a;&#x5217;&#x8868;&#x3001;&#x9875;&#x5927;&#x5c0f;</span>\n        page_num = <span class=\"hljs-built_in\">int</span>(page_num)\n        page_size = <span class=\"hljs-number\">9</span>\n        <span class=\"hljs-keyword\">try</span>:\n            paginator = Paginator(sku_list, page_size)\n            <span class=\"hljs-comment\"># &#x83b7;&#x53d6;&#x6307;&#x5b9a;&#x9875;&#x7801;&#x7684;&#x6570;&#x636e;</span>\n            page_skus = paginator.page(page_num)\n            page_skus_json = []\n            <span class=\"hljs-keyword\">for</span> sku <span class=\"hljs-keyword\">in</span> page_skus:\n                sku_dict = <span class=\"hljs-built_in\">dict</span>()\n                sku_dict[<span class=\"hljs-string\">&apos;skuid&apos;</span>] = sku.<span class=\"hljs-built_in\">id</span>\n                sku_dict[<span class=\"hljs-string\">&apos;name&apos;</span>] = sku.name\n                sku_dict[<span class=\"hljs-string\">&apos;price&apos;</span>] = <span class=\"hljs-built_in\">str</span>(sku.price)\n                sku_dict[<span class=\"hljs-string\">&apos;image&apos;</span>] = <span class=\"hljs-built_in\">str</span>(sku.default_image_url)\n                page_skus_json.append(sku_dict)\n        <span class=\"hljs-keyword\">except</span>:\n            result = {<span class=\"hljs-string\">&apos;code&apos;</span>: <span class=\"hljs-number\">40200</span>, <span class=\"hljs-string\">&apos;error&apos;</span>: <span class=\"hljs-string\">&apos;&#x9875;&#x6570;&#x6709;&#x8bef;&#xff0c;&#x5c0f;&#x4e8e;0&#x6216;&#x8005;&#x5927;&#x4e8e;&#x603b;&#x9875;&#x6570;&apos;</span>}\n            <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n        result = {<span class=\"hljs-string\">&apos;code&apos;</span>: <span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;data&apos;</span>: page_skus_json, <span class=\"hljs-string\">&apos;paginator&apos;</span>:{<span class=\"hljs-string\">&apos;pagesize&apos;</span>:page_size, <span class=\"hljs-string\">&apos;total&apos;</span>: <span class=\"hljs-built_in\">len</span>(sku_list)}, <span class=\"hljs-string\">&apos;base_url&apos;</span>: settings.PIC_URL}\n        <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GoodsDetailView</span>(<span class=\"hljs-title class_ inherited__\">View</span>):\n\n<span class=\"hljs-meta\">    @cache_check(<span class=\"hljs-params\">key_prefix=<span class=\"hljs-string\">&apos;gd&apos;</span>, key_param=<span class=\"hljs-string\">&apos;sku_id&apos;</span>, cache=<span class=\"hljs-string\">&apos;goods_detail&apos;</span>, expire=<span class=\"hljs-number\">300</span></span>)</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get</span>(<span class=\"hljs-params\">self, request, sku_id</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &#x83b7;&#x53d6;sku&#x8be6;&#x60c5;&#x9875;&#x4fe1;&#x606f;&#xff0c;&#x83b7;&#x53d6;&#x56fe;&#x7247;&#x6682;&#x672a;&#x5b8c;&#x6210;\n        :param request:\n        :param sku_id: sku&#x7684;id\n        :return:\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-comment\"># 127.0.0.1:8000/v1/goods/detail/1</span>\n        <span class=\"hljs-comment\"># &#x83b7;&#x53d6;sku&#x5b9e;&#x4f8b;</span>\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;----goods detail view in----&apos;</span>)\n\n        sku_details = {}\n\n        <span class=\"hljs-keyword\">try</span>:\n            sku_item = SKU.objects.get(<span class=\"hljs-built_in\">id</span>=sku_id)\n        <span class=\"hljs-keyword\">except</span>:\n            <span class=\"hljs-comment\"># &#x5224;&#x65ad;&#x662f;&#x5426;&#x6709;&#x5f53;&#x524d;sku</span>\n            result = {<span class=\"hljs-string\">&apos;code&apos;</span>: <span class=\"hljs-number\">40300</span>, <span class=\"hljs-string\">&apos;error&apos;</span>: <span class=\"hljs-string\">&quot;Such sku doesn&apos; exist&quot;</span>, }\n            <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n        sku_catalog = sku_item.spu.catalog\n        sku_details[<span class=\"hljs-string\">&apos;image&apos;</span>] = <span class=\"hljs-built_in\">str</span>(sku_item.default_image_url)\n        sku_details[<span class=\"hljs-string\">&quot;spu&quot;</span>] = sku_item.spu.<span class=\"hljs-built_in\">id</span>\n        sku_details[<span class=\"hljs-string\">&quot;name&quot;</span>] = sku_item.name\n        sku_details[<span class=\"hljs-string\">&quot;caption&quot;</span>] = sku_item.caption\n        sku_details[<span class=\"hljs-string\">&quot;price&quot;</span>] = <span class=\"hljs-built_in\">str</span>(sku_item.price)\n        sku_details[<span class=\"hljs-string\">&quot;catalog_id&quot;</span>] = sku_catalog.<span class=\"hljs-built_in\">id</span>\n        sku_details[<span class=\"hljs-string\">&quot;catalog_name&quot;</span>] = sku_catalog.name\n\n        <span class=\"hljs-comment\"># &#x8be6;&#x60c5;&#x56fe;&#x7247;</span>\n        sku_image = SKUImage.objects.<span class=\"hljs-built_in\">filter</span>(sku=sku_item)\n        <span class=\"hljs-keyword\">if</span> sku_image:\n            sku_details[<span class=\"hljs-string\">&apos;detail_image&apos;</span>] = <span class=\"hljs-built_in\">str</span>(sku_image[<span class=\"hljs-number\">0</span>].image)\n        <span class=\"hljs-keyword\">else</span>:\n            sku_details[<span class=\"hljs-string\">&apos;detail_image&apos;</span>] = <span class=\"hljs-string\">&quot;&quot;</span>\n\n        sku_sale_attr_id = []  <span class=\"hljs-comment\"># &#x5b58;&#x653e;&#x9500;&#x552e;&#x5c5e;&#x6027;id</span>\n        sku_sale_attr_names = [] <span class=\"hljs-comment\"># &#x5b58;&#x653e;&#x9500;&#x552e;&#x5c5e;&#x6027;name</span>\n        <span class=\"hljs-comment\">#spu_sale_attrs = SPUSaleAttr.objects.filter(SPU_id=sku_item.SPU_ID.id).order_by(&quot;weight&quot;)</span>\n        spu_sale_attrs = SPUSaleAttr.objects.<span class=\"hljs-built_in\">filter</span>(spu=sku_item.spu.<span class=\"hljs-built_in\">id</span>)\n        <span class=\"hljs-keyword\">for</span> attr <span class=\"hljs-keyword\">in</span> spu_sale_attrs:\n            sku_sale_attr_id.append(attr.<span class=\"hljs-built_in\">id</span>)\n            sku_sale_attr_names.append(attr.name)\n\n\n        sku_sale_attr_val_id = [i.<span class=\"hljs-built_in\">id</span> <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> sku_item.sale_attr_value.<span class=\"hljs-built_in\">all</span>()]\n\n        <span class=\"hljs-comment\">#TODO</span>\n        sku_all_sale_attr_vals_id = {} <span class=\"hljs-comment\"># &#x5b58;&#x653e;&#x8fd9;&#x4e2a;sku&#x6240;&#x5c5e;&#x7684;spu&#x6240;&#x6709;&#x9500;&#x552e;&#x5c5e;&#x6027;&#x5bf9;&#x5e94;&#x7684;&#x6240;&#x6709;&#x9500;&#x552e;&#x5c5e;&#x6027;&#x503c;id</span>\n        sku_all_sale_attr_vals_name = {} <span class=\"hljs-comment\"># &#x5b58;&#x653e;&#x8fd9;&#x4e2a;sku&#x6240;&#x5c5e;&#x7684;spu&#x6240;&#x6709;&#x9500;&#x552e;&#x5c5e;&#x6027;&#x5bf9;&#x5e94;&#x7684;&#x6240;&#x6709;&#x9500;&#x552e;&#x5c5e;&#x6027;&#x503c;name</span>\n        <span class=\"hljs-keyword\">for</span> <span class=\"hljs-built_in\">id</span> <span class=\"hljs-keyword\">in</span> sku_sale_attr_id:\n            items = SaleAttrValue.objects.<span class=\"hljs-built_in\">filter</span>(spu_sale_attr=<span class=\"hljs-built_in\">id</span>)\n            sku_all_sale_attr_vals_id[<span class=\"hljs-built_in\">id</span>] = []\n            sku_all_sale_attr_vals_name[<span class=\"hljs-built_in\">id</span>] = []\n            <span class=\"hljs-keyword\">for</span> item <span class=\"hljs-keyword\">in</span> items:\n                sku_all_sale_attr_vals_id[<span class=\"hljs-built_in\">id</span>].append(item.<span class=\"hljs-built_in\">id</span>)\n                sku_all_sale_attr_vals_name[<span class=\"hljs-built_in\">id</span>].append(item.name)\n\n        sku_details[<span class=\"hljs-string\">&apos;sku_sale_attr_id&apos;</span>] = sku_sale_attr_id\n        sku_details[<span class=\"hljs-string\">&apos;sku_sale_attr_names&apos;</span>] = sku_sale_attr_names\n        sku_details[<span class=\"hljs-string\">&apos;sku_sale_attr_val_id&apos;</span>] = sku_sale_attr_val_id\n        sku_details[<span class=\"hljs-string\">&apos;sku_all_sale_attr_vals_id&apos;</span>] = sku_all_sale_attr_vals_id\n        sku_details[<span class=\"hljs-string\">&apos;sku_all_sale_attr_vals_name&apos;</span>] = sku_all_sale_attr_vals_name\n\n        <span class=\"hljs-comment\"># sku&#x89c4;&#x683c;&#x90e8;&#x5206;</span>\n        <span class=\"hljs-comment\"># &#x7528;&#x4e8e;&#x5b58;&#x653e;&#x89c4;&#x683c;&#x76f8;&#x5173;&#x6570;&#x636e;&#xff0c;&#x683c;&#x5f0f;&#xff1a;{&#x89c4;&#x683c;&#x540d;&#x79f0;1: &#x89c4;&#x683c;&#x503c;1, &#x89c4;&#x683c;&#x540d;&#x79f0;2: &#x89c4;&#x683c;&#x503c;2, ...}</span>\n        spec = <span class=\"hljs-built_in\">dict</span>()\n        sku_spec_values = SKUSpecValue.objects.<span class=\"hljs-built_in\">filter</span>(sku=sku_id)\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> sku_spec_values:\n            sku_details[<span class=\"hljs-string\">&apos;spec&apos;</span>] = <span class=\"hljs-built_in\">dict</span>()\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-keyword\">for</span> sku_spec_value <span class=\"hljs-keyword\">in</span> sku_spec_values:\n                spec[sku_spec_value.spu_spec.name] = sku_spec_value.name\n            sku_details[<span class=\"hljs-string\">&apos;spec&apos;</span>] = spec\n\n        result = {<span class=\"hljs-string\">&apos;code&apos;</span>: <span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;data&apos;</span>: sku_details, <span class=\"hljs-string\">&apos;base_url&apos;</span>: settings.PIC_URL}\n        <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GoodsChangeSkuView</span>(<span class=\"hljs-title class_ inherited__\">View</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">post</span>(<span class=\"hljs-params\">self, request</span>):\n        <span class=\"hljs-comment\"># example = &apos;{&quot;spuid&quot;: 1, &quot;1&quot;:2, &quot;4&quot;: 4}&apos;</span>\n        data = json.loads(request.body)\n        <span class=\"hljs-comment\"># &#x5c06;&#x524d;&#x7aef;&#x4f20;&#x6765;&#x7684;&#x9500;&#x552e;&#x5c5e;&#x6027;&#x503c;id&#x653e;&#x5165;&#x5217;&#x8868;</span>\n        sku_vals = []\n        result = {}\n        <span class=\"hljs-keyword\">for</span> k <span class=\"hljs-keyword\">in</span> data:\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">&apos;spuid&apos;</span> != k:\n                sku_vals.append(data[k])\n        sku_list = SKU.objects.<span class=\"hljs-built_in\">filter</span>(spu=data[<span class=\"hljs-string\">&apos;spuid&apos;</span>])\n\n        <span class=\"hljs-keyword\">for</span> sku <span class=\"hljs-keyword\">in</span> sku_list:\n            sku_details = <span class=\"hljs-built_in\">dict</span>()\n            sku_details[<span class=\"hljs-string\">&apos;sku_id&apos;</span>] = sku.<span class=\"hljs-built_in\">id</span>\n            <span class=\"hljs-comment\"># &#x83b7;&#x53d6;sku&#x9500;&#x552e;&#x5c5e;&#x6027;&#x503c;id</span>\n\n            sku_sale_attr_val_id = [i.<span class=\"hljs-built_in\">id</span> <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> sku.sale_attr_value.<span class=\"hljs-built_in\">all</span>()]\n\n            <span class=\"hljs-keyword\">if</span> sku_vals == sku_sale_attr_val_id:\n                result = {<span class=\"hljs-string\">&quot;code&quot;</span>: <span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&quot;data&quot;</span>: sku.<span class=\"hljs-built_in\">id</span>,}\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(result) == <span class=\"hljs-number\">0</span>:\n            result = {<span class=\"hljs-string\">&quot;code&quot;</span>: <span class=\"hljs-number\">40050</span>, <span class=\"hljs-string\">&quot;error&quot;</span>: <span class=\"hljs-string\">&quot;no such sku&quot;</span>,}\n        <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1153,1354"}}],"payload":{"tag":"h4","lines":"711,712"}},{"content":"order","children":[{"content":"migrations","children":[{"content":"<pre data-lines=\"1603,1670\"><code data-lines=\"1603,1670\"><span class=\"hljs-comment\"># 0001_initial.py</span>\n<span class=\"hljs-comment\"># -*- coding: utf-8 -*-</span>\n<span class=\"hljs-comment\"># Generated by Django 1.11.8 on 2020-03-16 02:17</span>\n<span class=\"hljs-keyword\">from</span> __future__ import unicode_literals\n\n<span class=\"hljs-keyword\">from</span> django.db import migrations, models\nimport django.db.models.deletion\n\n\nclass Migration(migrations.Migration):\n\n    initial = <span class=\"hljs-literal\">True</span>\n\n    dependencies = [\n        (<span class=\"hljs-string\">&apos;goods&apos;</span>, <span class=\"hljs-string\">&apos;0001_initial&apos;</span>),\n        (<span class=\"hljs-string\">&apos;user&apos;</span>, <span class=\"hljs-string\">&apos;0003_weiboprofile&apos;</span>),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            <span class=\"hljs-attribute\">name</span>=<span class=\"hljs-string\">&apos;OrderGoods&apos;</span>,\n            fields=[\n                (<span class=\"hljs-string\">&apos;id&apos;</span>, models.AutoField(<span class=\"hljs-attribute\">auto_created</span>=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-attribute\">primary_key</span>=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-attribute\">serialize</span>=<span class=\"hljs-literal\">False</span>, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;ID&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;created_time&apos;</span>, models.DateTimeField(<span class=\"hljs-attribute\">auto_now_add</span>=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x521b;&#x5efa;&#x65f6;&#x95f4;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;updated_time&apos;</span>, models.DateTimeField(<span class=\"hljs-attribute\">auto_now</span>=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x66f4;&#x65b0;&#x65f6;&#x95f4;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;count&apos;</span>, models.IntegerField(<span class=\"hljs-attribute\">default</span>=1, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x6570;&#x91cf;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;price&apos;</span>, models.DecimalField(<span class=\"hljs-attribute\">decimal_places</span>=2, <span class=\"hljs-attribute\">max_digits</span>=10, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x5355;&#x4ef7;&apos;</span>)),\n            ],\n            options={\n                <span class=\"hljs-string\">&apos;db_table&apos;</span>: <span class=\"hljs-string\">&apos;order_order_goods&apos;</span>,\n            },\n        ),\n        migrations.CreateModel(\n            <span class=\"hljs-attribute\">name</span>=<span class=\"hljs-string\">&apos;OrderInfo&apos;</span>,\n            fields=[\n                (<span class=\"hljs-string\">&apos;created_time&apos;</span>, models.DateTimeField(<span class=\"hljs-attribute\">auto_now_add</span>=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x521b;&#x5efa;&#x65f6;&#x95f4;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;updated_time&apos;</span>, models.DateTimeField(<span class=\"hljs-attribute\">auto_now</span>=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x66f4;&#x65b0;&#x65f6;&#x95f4;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;order_id&apos;</span>, models.CharField(<span class=\"hljs-attribute\">default</span>=<span class=\"hljs-string\">&apos;&apos;</span>, <span class=\"hljs-attribute\">max_length</span>=64, <span class=\"hljs-attribute\">primary_key</span>=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-attribute\">serialize</span>=<span class=\"hljs-literal\">False</span>, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x8ba2;&#x5355;&#x53f7;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;total_count&apos;</span>, models.IntegerField(<span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x5546;&#x54c1;&#x603b;&#x6570;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;total_amount&apos;</span>, models.DecimalField(<span class=\"hljs-attribute\">decimal_places</span>=2, <span class=\"hljs-attribute\">max_digits</span>=10, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x5546;&#x54c1;&#x603b;&#x91d1;&#x989d;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;freight&apos;</span>, models.DecimalField(<span class=\"hljs-attribute\">decimal_places</span>=2, <span class=\"hljs-attribute\">max_digits</span>=10, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x8fd0;&#x8d39;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;pay_method&apos;</span>, models.SmallIntegerField(<span class=\"hljs-attribute\">default</span>=1, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x652f;&#x4ed8;&#x65b9;&#x5f0f;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;receiver&apos;</span>, models.CharField(<span class=\"hljs-attribute\">max_length</span>=11, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x6536;&#x4ef6;&#x4eba;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;address&apos;</span>, models.CharField(<span class=\"hljs-attribute\">max_length</span>=100, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x6536;&#x83b7;&#x5730;&#x5740;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;receiver_mobile&apos;</span>, models.CharField(<span class=\"hljs-attribute\">max_length</span>=11, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x6536;&#x4ef6;&#x4eba;&#x7535;&#x8bdd;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;tag&apos;</span>, models.CharField(<span class=\"hljs-attribute\">max_length</span>=10, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x6807;&#x7b7e;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;status&apos;</span>, models.SmallIntegerField(choices=[(1, <span class=\"hljs-string\">&apos;&#x5f85;&#x4ed8;&#x6b3e;&apos;</span>), (2, <span class=\"hljs-string\">&apos;&#x5f85;&#x53d1;&#x8d27;&apos;</span>), (3, <span class=\"hljs-string\">&apos;&#x5f85;&#x6536;&#x8d27;&apos;</span>), (4, <span class=\"hljs-string\">&apos;&#x8ba2;&#x5355;&#x5b8c;&#x6210;&apos;</span>)], <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x8ba2;&#x5355;&#x72b6;&#x6001;&apos;</span>)),\n                (<span class=\"hljs-string\">&apos;user_profile&apos;</span>, models.ForeignKey(<span class=\"hljs-attribute\">on_delete</span>=django.db.models.deletion.CASCADE, <span class=\"hljs-attribute\">to</span>=<span class=\"hljs-string\">&apos;user.UserProfile&apos;</span>)),\n            ],\n            options={\n                <span class=\"hljs-string\">&apos;db_table&apos;</span>: <span class=\"hljs-string\">&apos;order_order_info&apos;</span>,\n            },\n        ),\n        migrations.AddField(\n            <span class=\"hljs-attribute\">model_name</span>=<span class=\"hljs-string\">&apos;ordergoods&apos;</span>,\n            <span class=\"hljs-attribute\">name</span>=<span class=\"hljs-string\">&apos;order&apos;</span>,\n            <span class=\"hljs-attribute\">field</span>=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, <span class=\"hljs-attribute\">to</span>=<span class=\"hljs-string\">&apos;order.OrderInfo&apos;</span>),\n        ),\n        migrations.AddField(\n            <span class=\"hljs-attribute\">model_name</span>=<span class=\"hljs-string\">&apos;ordergoods&apos;</span>,\n            <span class=\"hljs-attribute\">name</span>=<span class=\"hljs-string\">&apos;sku&apos;</span>,\n            <span class=\"hljs-attribute\">field</span>=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, <span class=\"hljs-attribute\">to</span>=<span class=\"hljs-string\">&apos;goods.SKU&apos;</span>),\n        ),\n    ]\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1603,1670"}}],"payload":{"tag":"h5","lines":"1601,1602"}}],"payload":{"tag":"h4","lines":"1355,1356"}},{"content":"tools","children":[{"content":"<pre data-lines=\"1673,1703\"><code data-lines=\"1673,1703\"><span class=\"hljs-comment\"># cache_dec.py</span>\n<span class=\"hljs-keyword\">from</span> django.core.cache <span class=\"hljs-keyword\">import</span> caches\n\n<span class=\"hljs-comment\">#&#x53c2;&#x6570; key_prefix, key_param, expire(s) , cache(where)</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">cache_check</span>(<span class=\"hljs-params\">**cache_kwargs</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">_cache_check</span>(<span class=\"hljs-params\">func</span>):\n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">wrapper</span>(<span class=\"hljs-params\">self, request, *args, **kwargs</span>):\n            CACHE = caches[<span class=\"hljs-string\">&apos;default&apos;</span>]\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-string\">&apos;cache&apos;</span> <span class=\"hljs-keyword\">in</span> cache_kwargs:\n                CACHE = caches[cache_kwargs[<span class=\"hljs-string\">&apos;cache&apos;</span>]]\n            key_prefix = cache_kwargs[<span class=\"hljs-string\">&apos;key_prefix&apos;</span>]\n            key_param = cache_kwargs[<span class=\"hljs-string\">&apos;key_param&apos;</span>]\n            expire = cache_kwargs.get(<span class=\"hljs-string\">&apos;expire&apos;</span>, <span class=\"hljs-number\">30</span>)\n            <span class=\"hljs-comment\">#&apos;/detail/1&apos; -&gt; def get(self,request, sku_id)</span>\n            <span class=\"hljs-keyword\">if</span> key_param <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> kwargs:\n                <span class=\"hljs-keyword\">raise</span>\n            cache_key = key_prefix + kwargs[key_param]\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;cache_key is %s&apos;</span>%(cache_key))\n            res = CACHE.get(cache_key)\n            <span class=\"hljs-keyword\">if</span> res:\n                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;return %s cache&apos;</span>%(cache_key))\n                <span class=\"hljs-keyword\">return</span> res\n            <span class=\"hljs-comment\">#&#x6ca1;&#x6709;&#x7f13;&#x5b58;</span>\n            res = func(<span class=\"hljs-variable language_\">self</span>, request, *args, **kwargs)\n            CACHE.<span class=\"hljs-built_in\">set</span>(cache_key, res, expire)\n            <span class=\"hljs-keyword\">return</span> res\n        <span class=\"hljs-keyword\">return</span> wrapper\n    <span class=\"hljs-keyword\">return</span> _cache_check\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1673,1703"}},{"content":"<pre data-lines=\"1704,1732\"><code data-lines=\"1704,1732\"><span class=\"hljs-comment\"># logging_dec.py</span>\n<span class=\"hljs-keyword\">from</span> django.http <span class=\"hljs-keyword\">import</span> JsonResponse\n<span class=\"hljs-keyword\">import</span> jwt\n<span class=\"hljs-keyword\">from</span> django.conf <span class=\"hljs-keyword\">import</span> settings\n<span class=\"hljs-keyword\">from</span> user.models <span class=\"hljs-keyword\">import</span> UserProfile\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">logging_check</span>(<span class=\"hljs-params\">func</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">wrapper</span>(<span class=\"hljs-params\">self, request, *args, **kwagrs</span>):\n        token = request.META.get(<span class=\"hljs-string\">&apos;HTTP_AUTHORIZATION&apos;</span>)\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> token:\n            result = {<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">403</span>, <span class=\"hljs-string\">&apos;error&apos;</span>: <span class=\"hljs-string\">&apos;Please login~&apos;</span>}\n            <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n        <span class=\"hljs-keyword\">try</span>:\n            res = jwt.decode(token, settings.SHOP_TOKEN_KEY, algorithms=<span class=\"hljs-string\">&apos;HS256&apos;</span>)\n        <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;jwt error %s&apos;</span>%(e))\n            result = {<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">403</span>, <span class=\"hljs-string\">&apos;error&apos;</span>: <span class=\"hljs-string\">&apos;Please login&apos;</span>}\n            <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n\n        username = res[<span class=\"hljs-string\">&apos;username&apos;</span>]\n        user = UserProfile.objects.get(username=username)\n        request.myuser = user\n\n        <span class=\"hljs-keyword\">return</span> func(<span class=\"hljs-variable language_\">self</span>, request, *args, **kwagrs)\n    <span class=\"hljs-keyword\">return</span> wrapper\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1704,1732"}},{"content":"<pre data-lines=\"1733,1746\"><code data-lines=\"1733,1746\"><span class=\"hljs-comment\"># models.py</span>\n<span class=\"hljs-keyword\">from</span> django.db import models\n\nclass BaseModel(models.Model):\n    #&#x6b64;&#x7c7b;&#x53ef;&#x4e3a;&#x5176;&#x4ed6;&#x6a21;&#x578b;&#x7c7b;&#x8865;&#x5145;&#x5b57;&#x6bb5; - &#x62bd;&#x8c61;&#x7c7b;\n    created_time = models.DateTimeField(<span class=\"hljs-attribute\">auto_now_add</span>=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x521b;&#x5efa;&#x65f6;&#x95f4;&apos;</span>)\n    updated_time = models.DateTimeField(<span class=\"hljs-attribute\">auto_now</span>=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x66f4;&#x65b0;&#x65f6;&#x95f4;&apos;</span>)\n\n    class Meta:\n        abstract = <span class=\"hljs-literal\">True</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1733,1746"}}],"payload":{"tag":"h4","lines":"1671,1672"}},{"content":"user","children":[{"content":"<pre data-lines=\"1749,1756\"><code data-lines=\"1749,1756\"><span class=\"hljs-comment\"># admin.py</span>\n<span class=\"hljs-keyword\">from</span> django.contrib <span class=\"hljs-keyword\">import</span> admin\n\n<span class=\"hljs-comment\"># Register your models here.</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1749,1756"}},{"content":"<pre data-lines=\"1757,1766\"><code data-lines=\"1757,1766\"># apps.py\n<span class=\"hljs-keyword\">from</span> django.apps <span class=\"hljs-keyword\">import</span> AppConfig\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-symbol\">UserConfig</span>(<span class=\"hljs-symbol\">AppConfig</span>):\n    <span class=\"hljs-symbol\">name</span> = &apos;<span class=\"hljs-symbol\">user</span>&apos;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1757,1766"}},{"content":"<pre data-lines=\"1767,1814\"><code data-lines=\"1767,1814\"><span class=\"hljs-comment\"># models.py</span>\n<span class=\"hljs-keyword\">from</span> django.db import models\n\n<span class=\"hljs-comment\"># Create your models here.</span>\nclass UserProfile(models.Model):\n\n    username = models.CharField(<span class=\"hljs-attribute\">max_length</span>=11, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x7528;&#x6237;&#x540d;&apos;</span>, <span class=\"hljs-attribute\">unique</span>=<span class=\"hljs-literal\">True</span>)\n    password = models.CharField(<span class=\"hljs-attribute\">max_length</span>=32)\n    email = models.EmailField(<span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x90ae;&#x7bb1;&apos;</span>)\n    phone = models.CharField(<span class=\"hljs-attribute\">max_length</span>=11, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x624b;&#x673a;&#x53f7;&apos;</span>)\n    is_active = models.BooleanField(<span class=\"hljs-attribute\">default</span>=<span class=\"hljs-literal\">False</span>, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x6fc0;&#x6d3b;&#x72b6;&#x6001;&apos;</span>)\n    created_time = models.DateTimeField(<span class=\"hljs-attribute\">auto_now_add</span>=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x521b;&#x5efa;&#x65f6;&#x95f4;&apos;</span>)\n    updated_time = models.DateTimeField(<span class=\"hljs-attribute\">auto_now</span>=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x66f4;&#x65b0;&#x65f6;&#x95f4;&apos;</span>)\n\n    class Meta:\n        db_table = <span class=\"hljs-string\">&apos;user_user_profile&apos;</span>\n\n    def __str__(self):\n        return <span class=\"hljs-string\">&apos;%s_%s&apos;</span>%(self.id, self.is_active)\n\n\nclass Address(models.Model):\n\n    user_profile = models.ForeignKey(UserProfile)\n    receiver = models.CharField(<span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x6536;&#x4ef6;&#x4eba;&apos;</span>, <span class=\"hljs-attribute\">max_length</span>=11)\n   <span class=\"hljs-built_in\"> address </span>= models.CharField(<span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x6536;&#x8d27;&#x5730;&#x5740;&apos;</span>, <span class=\"hljs-attribute\">max_length</span>=100)\n    postcode = models.CharField(<span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x90ae;&#x7f16;&apos;</span>, <span class=\"hljs-attribute\">max_length</span>=6)\n    receiver_mobile = models.CharField(<span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x8054;&#x7cfb;&#x4eba;&#x7535;&#x8bdd;&apos;</span>,max_length=11)\n    tag = models.CharField(<span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x6807;&#x7b7e;&apos;</span>, <span class=\"hljs-attribute\">max_length</span>=10)\n    is_default = models.BooleanField(<span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x662f;&#x5426;&#x4e3a;&#x9ed8;&#x8ba4;&#x5730;&#x5740;&apos;</span>, <span class=\"hljs-attribute\">default</span>=<span class=\"hljs-literal\">False</span>)\n    is_active = models.BooleanField(<span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x662f;&#x5426;&#x5220;&#x9664;&apos;</span>,default=True)\n\n    def __str__(self):\n        return <span class=\"hljs-string\">&quot;%s,%s,%s,%s&quot;</span> %(self.id, self.receiver,self.address,self.is_default)\n\n\nclass WeiboProfile(models.Model):\n\n    user_profile = models.OneToOneField(UserProfile, <span class=\"hljs-attribute\">null</span>=<span class=\"hljs-literal\">True</span>)\n    wuid = models.CharField(<span class=\"hljs-attribute\">max_length</span>=10, <span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x5fae;&#x535a;uid&apos;</span>, <span class=\"hljs-attribute\">unique</span>=<span class=\"hljs-literal\">True</span>)\n    access_token = models.CharField(<span class=\"hljs-attribute\">verbose_name</span>=<span class=\"hljs-string\">&apos;&#x5fae;&#x535a;&#x6388;&#x6743;&#x4ee4;&#x724c;&apos;</span>, <span class=\"hljs-attribute\">max_length</span>=32)\n\n    class Meta:\n        db_table = <span class=\"hljs-string\">&apos;user_weibo_profile&apos;</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1767,1814"}},{"content":"<pre data-lines=\"1815,1831\"><code data-lines=\"1815,1831\"><span class=\"hljs-comment\"># tasks.py</span>\n<span class=\"hljs-keyword\">from</span> dashop11.celery <span class=\"hljs-keyword\">import</span> app\n<span class=\"hljs-keyword\">from</span> django.core.mail <span class=\"hljs-keyword\">import</span> send_mail\n<span class=\"hljs-keyword\">from</span> django.conf <span class=\"hljs-keyword\">import</span> settings\n\n<span class=\"hljs-meta\">@app.task</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">send_active_email_celery</span>(<span class=\"hljs-params\">email_address, verify_url</span>):\n\n    subject = <span class=\"hljs-string\">&apos;dashop11&#x6fc0;&#x6d3b;&#x90ae;&#x4ef6;&apos;</span>\n    html_message = <span class=\"hljs-string\">&apos;&apos;&apos;\n    &lt;p&gt;&#x5c0a;&#x656c;&#x7684;&#x7528;&#x6237; &#x60a8;&#x597d;&lt;/p&gt;\n    &lt;p&gt;&#x60a8;&#x7684;&#x6fc0;&#x6d3b;&#x94fe;&#x63a5;&#x4e3a;&lt;a href=&quot;%s&quot; target=&quot;_blank&quot;&gt;&#x70b9;&#x51fb;&#x6fc0;&#x6d3b;&lt;/a&gt;&lt;/p&gt;\n    &apos;&apos;&apos;</span>%(verify_url)\n    send_mail(subject,<span class=\"hljs-string\">&apos;&apos;</span>,settings.EMAIL_HOST_USER,[email_address], html_message=html_message)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1815,1831"}},{"content":"<pre data-lines=\"1832,1839\"><code data-lines=\"1832,1839\"><span class=\"hljs-comment\"># tests.py</span>\n<span class=\"hljs-keyword\">from</span> django.test <span class=\"hljs-keyword\">import</span> TestCase\n\n<span class=\"hljs-comment\"># Create your tests here.</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1832,1839"}},{"content":"<pre data-lines=\"1840,1865\"><code data-lines=\"1840,1865\"><span class=\"hljs-comment\"># urls.py</span>\n<span class=\"hljs-keyword\">from</span> django.conf.urls <span class=\"hljs-keyword\">import</span> url\n<span class=\"hljs-keyword\">from</span> . <span class=\"hljs-keyword\">import</span> views\n\nurlpatterns = [\n    <span class=\"hljs-comment\">#http://127.0.0.1:8000/v1/users</span>\n    url(<span class=\"hljs-string\">r&apos;^&#x24;&apos;</span>, views.users),\n    <span class=\"hljs-comment\">#http://127.0.0.1:8000/v1/users/activation</span>\n    url(<span class=\"hljs-string\">r&apos;^/activation&#x24;&apos;</span>, views.user_active),\n    <span class=\"hljs-comment\">#http://127.0.0.1:8000/v1/users/&lt;username&gt;/address</span>\n    url(<span class=\"hljs-string\">r&apos;^/(?P&lt;username&gt;\\w{1,11})/address&#x24;&apos;</span>, views.AddressView.as_view()),\n\n    <span class=\"hljs-comment\">#&#x5fae;&#x535a;&#x76f8;&#x5173;</span>\n    <span class=\"hljs-comment\">#http://127.0.0.1:8000/v1/users/weibo/authorization</span>\n    url(<span class=\"hljs-string\">r&apos;^/weibo/authorization&#x24;&apos;</span>, views.oauth_url),\n    <span class=\"hljs-comment\">#http://127.0.0.1:8000/v1/users/weibo/users?code=xxxx</span>\n    url(<span class=\"hljs-string\">r&apos;^/weibo/users&apos;</span>, views.oauth_token)\n\n\n\n\n\n]\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1840,1865"}},{"content":"<pre data-lines=\"1866,2143\"><code data-lines=\"1866,2143\"><span class=\"hljs-comment\"># views.py</span>\n<span class=\"hljs-keyword\">import</span> base64\n<span class=\"hljs-keyword\">import</span> hashlib\n<span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">import</span> random\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">from</span> urllib.parse <span class=\"hljs-keyword\">import</span> urlencode\n\n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">from</span> django.core.mail <span class=\"hljs-keyword\">import</span> send_mail\n<span class=\"hljs-keyword\">from</span> django.http <span class=\"hljs-keyword\">import</span> JsonResponse\n<span class=\"hljs-keyword\">from</span> django.shortcuts <span class=\"hljs-keyword\">import</span> render\n<span class=\"hljs-keyword\">from</span> .models <span class=\"hljs-keyword\">import</span> UserProfile, Address, WeiboProfile\n<span class=\"hljs-keyword\">from</span> django.conf <span class=\"hljs-keyword\">import</span> settings\n<span class=\"hljs-keyword\">from</span> dtoken.views <span class=\"hljs-keyword\">import</span> make_token\n<span class=\"hljs-keyword\">from</span> django.core.cache <span class=\"hljs-keyword\">import</span> cache, caches\n<span class=\"hljs-keyword\">from</span> .tasks <span class=\"hljs-keyword\">import</span> send_active_email_celery\n<span class=\"hljs-keyword\">from</span> django.views <span class=\"hljs-keyword\">import</span> View\n<span class=\"hljs-keyword\">from</span> tools.logging_dec <span class=\"hljs-keyword\">import</span> logging_check\n<span class=\"hljs-keyword\">from</span> django.db <span class=\"hljs-keyword\">import</span> transaction\n\nEMAIL_CACHE = caches[<span class=\"hljs-string\">&apos;user_email&apos;</span>]\n\n\n<span class=\"hljs-comment\">#10100 - 10199 &#x5f02;&#x5e38;&#x72b6;&#x6001;&#x7801;</span>\n\n<span class=\"hljs-comment\"># Create your views here.</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">users</span>(<span class=\"hljs-params\">request</span>):\n\n    <span class=\"hljs-keyword\">if</span> request.method == <span class=\"hljs-string\">&apos;POST&apos;</span>:\n        <span class=\"hljs-comment\">#&#x6ce8;&#x518c;&#x7528;&#x6237;</span>\n        data = request.body\n        json_obj = json.loads(data)\n        username = json_obj[<span class=\"hljs-string\">&apos;uname&apos;</span>]\n        email = json_obj[<span class=\"hljs-string\">&apos;email&apos;</span>]\n        password = json_obj[<span class=\"hljs-string\">&apos;password&apos;</span>]\n        phone = json_obj[<span class=\"hljs-string\">&apos;phone&apos;</span>]\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(password) &lt; <span class=\"hljs-number\">6</span>:\n            result = {<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">10100</span>, <span class=\"hljs-string\">&apos;error&apos;</span>:<span class=\"hljs-string\">&apos;Password length is wrong&apos;</span>}\n            <span class=\"hljs-comment\">#JsonResponse &#x5c06;&#x53c2;&#x6570;&#x8f6c;&#x6210;json&#x4e32; &#x4e14;&#x5c06;&#x54cd;&#x5e94;&#x5934;&#x4e2d;&#x7684;CT&#x503c;&#x6539;&#x6210;application/json</span>\n            <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n\n        <span class=\"hljs-comment\">#&#x7528;&#x6237;&#x540d;&#x662f;&#x5426;&#x53ef;&#x7528;; &#x5df2;&#x6ce8;&#x518c;&#x7684;&#x8bdd;&#x7ed9;&#x4e2a;&#x9519;&#x8bef;&#x8fd4;&#x56de;</span>\n        old_user = UserProfile.objects.<span class=\"hljs-built_in\">filter</span>(username=username)\n        <span class=\"hljs-keyword\">if</span> old_user:\n            result = {<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">10101</span>, <span class=\"hljs-string\">&apos;error&apos;</span>: <span class=\"hljs-string\">&apos;Your username is already existed~&apos;</span>}\n            <span class=\"hljs-keyword\">return</span> JsonResponse(result)\n        <span class=\"hljs-comment\">#&#x521b;&#x5efa;&#x7528;&#x6237; &#x5bc6;&#x7801;&#x7528;md5</span>\n        m = hashlib.md5()\n        m.update(password.encode())\n        <span class=\"hljs-keyword\">try</span>:\n           user = UserProfile.objects.create(username=username,password=m.hexdigest(), email=email,phone=phone)\n        <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n            <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">10102</span>, <span class=\"hljs-string\">&apos;error&apos;</span>:<span class=\"hljs-string\">&apos;Your username is used&apos;</span>})\n        <span class=\"hljs-comment\">#&#x7528;jwt&#x7b7e;&#x53d1;token  &#x6709;&#x6548;&#x671f;1&#x5929;&#xff0c; token&#x91cc;&#x9762;&#x5b58;&#x653e; username:xxxx</span>\n        token = make_token(username)\n        <span class=\"hljs-comment\">#{&apos;code&apos;:200,&apos;username&apos;:username,&apos;data&apos;:{&apos;token&apos;:xxx}}</span>\n\n        <span class=\"hljs-comment\">#&#x751f;&#x6210;&#x56db;&#x4f4d;&#x968f;&#x673a;&#x6570;</span>\n        code = <span class=\"hljs-string\">&quot;%s&quot;</span>%(random.randint(<span class=\"hljs-number\">1000</span>,<span class=\"hljs-number\">9999</span>))\n        <span class=\"hljs-comment\">#&#x7528;&#x6237;&#x540d; + &#x968f;&#x673a;&#x6570; &#x62fc;&#x63a5;&#x6210; &#x4e00;&#x4e2a; &#x65b0;&#x7684;&#x5b57;&#x7b26;&#x4e32;</span>\n        code_str = code + <span class=\"hljs-string\">&apos;_&apos;</span> + username\n        <span class=\"hljs-comment\"># b64(&#x65b0;&#x5b57;&#x7b26;&#x4e32;)</span>\n        code_bs = base64.urlsafe_b64encode(code_str.encode())\n        <span class=\"hljs-comment\">#&#x5b58;&#x50a8;&#x968f;&#x673a;&#x6570;</span>\n        EMAIL_CACHE.<span class=\"hljs-built_in\">set</span>(<span class=\"hljs-string\">&apos;email_active_%s&apos;</span>%(username), code, <span class=\"hljs-number\">3600</span>*<span class=\"hljs-number\">24</span>*<span class=\"hljs-number\">3</span>)\n        <span class=\"hljs-comment\">#&#x751f;&#x6210;&#x6fc0;&#x6d3b;&#x94fe;&#x63a5; &apos;http://127.0.0.1:7000/dadashop/templates/active.html?code=%s&apos;</span>\n        verify_url = <span class=\"hljs-string\">&apos;http://127.0.0.1:7000/dadashop/templates/active.html?code=%s&apos;</span>%(code_bs.decode())\n        <span class=\"hljs-comment\">#&#x5c06;&#x94fe;&#x63a5;&#x53d1;&#x9001;&#x81f3;&#x7528;&#x6237;&#x90ae;&#x7bb1;</span>\n        <span class=\"hljs-comment\">#send_active_email(email, verify_url)</span>\n        send_active_email_celery.delay(email, verify_url)\n        <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;username&apos;</span>:username,<span class=\"hljs-string\">&apos;data&apos;</span>:{<span class=\"hljs-string\">&apos;token&apos;</span>:token.decode()}, <span class=\"hljs-string\">&apos;carts_count&apos;</span>:<span class=\"hljs-number\">0</span>})\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">send_active_email</span>(<span class=\"hljs-params\">email_address, verify_url</span>):\n\n    subject = <span class=\"hljs-string\">&apos;dashop11&#x6fc0;&#x6d3b;&#x90ae;&#x4ef6;&apos;</span>\n    html_message = <span class=\"hljs-string\">&apos;&apos;&apos;\n    &lt;p&gt;&#x5c0a;&#x656c;&#x7684;&#x7528;&#x6237; &#x60a8;&#x597d;&lt;/p&gt;\n    &lt;p&gt;&#x60a8;&#x7684;&#x6fc0;&#x6d3b;&#x94fe;&#x63a5;&#x4e3a;&lt;a href=&quot;%s&quot; target=&quot;_blank&quot;&gt;&#x70b9;&#x51fb;&#x6fc0;&#x6d3b;&lt;/a&gt;&lt;/p&gt;\n    &apos;&apos;&apos;</span>%(verify_url)\n    send_mail(subject,<span class=\"hljs-string\">&apos;&apos;</span>,settings.EMAIL_HOST_USER,[email_address], html_message=html_message)\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">user_active</span>(<span class=\"hljs-params\">request</span>):\n    <span class=\"hljs-comment\">#&#x6fc0;&#x6d3b;&#x7528;&#x6237;</span>\n\n    code = request.GET.get(<span class=\"hljs-string\">&apos;code&apos;</span>)\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> code:\n        <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">10103</span>, <span class=\"hljs-string\">&apos;error&apos;</span>:<span class=\"hljs-string\">&apos;Please give me code !&apos;</span>})\n    code_str = base64.urlsafe_b64decode(code.encode()).decode()\n    <span class=\"hljs-comment\">#code_str:&apos;code_username&apos;</span>\n    random_code , username = code_str.split(<span class=\"hljs-string\">&apos;_&apos;</span>)\n    old_code = EMAIL_CACHE.get(<span class=\"hljs-string\">&apos;email_active_%s&apos;</span>%(username))\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> old_code:\n        <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">10104</span>, <span class=\"hljs-string\">&apos;error&apos;</span>:<span class=\"hljs-string\">&apos;Link is wrong&apos;</span>})\n    <span class=\"hljs-keyword\">if</span> random_code != old_code:\n        <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">10105</span>, <span class=\"hljs-string\">&apos;error&apos;</span>:<span class=\"hljs-string\">&apos;Link is wrong&apos;</span>})\n    <span class=\"hljs-keyword\">try</span>:\n        user = UserProfile.objects.get(username=username)\n    <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n        <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">10106</span>, <span class=\"hljs-string\">&apos;error&apos;</span>:<span class=\"hljs-string\">&apos;User get error&apos;</span>})\n    user.is_active = <span class=\"hljs-literal\">True</span>\n    user.save()\n    <span class=\"hljs-comment\">#&#x5220;&#x9664;&#x7f13;&#x5b58;</span>\n    EMAIL_CACHE.delete(<span class=\"hljs-string\">&apos;email_active_%s&apos;</span>%(username))\n    <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;data&apos;</span>:<span class=\"hljs-string\">&apos;OK&apos;</span>})\n\n\n<span class=\"hljs-comment\">#FBV - &#x51fd;&#x6570;&#x89c6;&#x56fe;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">address_view</span>(<span class=\"hljs-params\">request</span>):\n\n    <span class=\"hljs-keyword\">if</span> request.method == <span class=\"hljs-string\">&apos;GET&apos;</span>:\n        <span class=\"hljs-keyword\">pass</span>\n    <span class=\"hljs-keyword\">elif</span> request.method == <span class=\"hljs-string\">&apos;POST&apos;</span>:\n        <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-comment\">#CBV - &#x7c7b;&#x89c6;&#x56fe;</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AddressView</span>(<span class=\"hljs-title class_ inherited__\">View</span>):\n\n<span class=\"hljs-meta\">    @logging_check</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">dispatch</span>(<span class=\"hljs-params\">self, request, *args, **kwargs</span>):\n\n        json_str = request.body\n        request.json_obj = {}\n        <span class=\"hljs-keyword\">if</span> json_str:\n            json_obj = json.loads(json_str)\n            request.json_obj = json_obj\n\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">super</span>().dispatch(request, *args, **kwargs)\n\n    <span class=\"hljs-comment\">#405&#x54cd;&#x5e94;  &#x5982;&#x679c;&#x89c6;&#x56fe;&#x7c7b;&#x6ca1;&#x5b9a;&#x4e49;&#x8be5;http &#x8bf7;&#x6c42;&#x52a8;&#x4f5c;&#x7684;&#x65b9;&#x6cd5;&#xff0c;&#x5219;&#x62a5;405&#x9519;&#x8bef;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get</span>(<span class=\"hljs-params\">self,request, username</span>):\n\n        user = request.myuser\n        all_addr = user.address_set.<span class=\"hljs-built_in\">filter</span>(is_active=<span class=\"hljs-literal\">True</span>)\n        res = []\n        <span class=\"hljs-keyword\">for</span> addr <span class=\"hljs-keyword\">in</span> all_addr:\n            addr_data = {}\n            addr_data[<span class=\"hljs-string\">&apos;id&apos;</span>] = addr.<span class=\"hljs-built_in\">id</span>\n            addr_data[<span class=\"hljs-string\">&apos;address&apos;</span>] = addr.address\n            addr_data[<span class=\"hljs-string\">&apos;receiver&apos;</span>] = addr.receiver\n            addr_data[<span class=\"hljs-string\">&apos;tag&apos;</span>] = addr.tag\n            addr_data[<span class=\"hljs-string\">&apos;receiver_mobile&apos;</span>] = addr.receiver_mobile\n            addr_data[<span class=\"hljs-string\">&apos;is_default&apos;</span>] = addr.is_default\n            res.append(addr_data)\n        <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;addresslist&apos;</span>:res})\n\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">post</span>(<span class=\"hljs-params\">self, request, username</span>):\n        <span class=\"hljs-comment\">#&#x9ed8;&#x8ba4;&#x5730;&#x5740;&#x539f;&#x5219;&#xff0c; &#x7b2c;&#x4e00;&#x4e2a;&#x521b;&#x5efa;&#x51fa;&#x6765;&#x7684;&#x5730;&#x5740; &#x4e3a; &#x9ed8;&#x8ba4;&#x5730;&#x5740;</span>\n        data = request.json_obj\n        receiver = data[<span class=\"hljs-string\">&apos;receiver&apos;</span>]\n        address = data[<span class=\"hljs-string\">&apos;address&apos;</span>]\n        receiver_phone = data[<span class=\"hljs-string\">&apos;receiver_phone&apos;</span>]\n        postcode = data[<span class=\"hljs-string\">&apos;postcode&apos;</span>]\n        tag = data[<span class=\"hljs-string\">&apos;tag&apos;</span>]\n\n        <span class=\"hljs-comment\"># if request.myuser.username != username:</span>\n        <span class=\"hljs-comment\">#     raise</span>\n\n        user = request.myuser\n        <span class=\"hljs-comment\">#&#x53cd;&#x54cd;&#x67e5;&#x8be2; user.address_set.all()</span>\n\n        <span class=\"hljs-comment\">#&#x5224;&#x65ad;&#x4e00;&#x4e0b; &#x9ed8;&#x8ba4;&#x5730;&#x5740;&#x95ee;&#x9898;</span>\n        old_addr = Address.objects.<span class=\"hljs-built_in\">filter</span>(user_profile=user)\n        default_status = <span class=\"hljs-literal\">False</span>\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> old_addr:\n            default_status = <span class=\"hljs-literal\">True</span>\n\n        Address.objects.create(user_profile=user, receiver=receiver, address=address, receiver_mobile=receiver_phone, postcode=postcode,tag=tag,is_default=default_status)\n\n        <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;data&apos;</span>:<span class=\"hljs-string\">&apos;ok&apos;</span>})\n\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">put</span>(<span class=\"hljs-params\">self, request</span>):\n        <span class=\"hljs-keyword\">pass</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">delete</span>(<span class=\"hljs-params\">self, request</span>):\n        <span class=\"hljs-keyword\">pass</span>\n\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">oauth_url</span>(<span class=\"hljs-params\">request</span>):\n    <span class=\"hljs-comment\">#&#x83b7;&#x53d6;&#x5fae;&#x535a;&#x6388;&#x6743;&#x5730;&#x5740;</span>\n    params = {\n        <span class=\"hljs-string\">&apos;response_type&apos;</span>: <span class=\"hljs-string\">&apos;code&apos;</span>,\n        <span class=\"hljs-string\">&apos;client_id&apos;</span>: settings.WEIBO_CLIENT_ID,\n        <span class=\"hljs-string\">&apos;redirect_uri&apos;</span>: settings.WEIBO_REDIRECT_URI\n    }\n\n    weibo_url = <span class=\"hljs-string\">&apos;https://api.weibo.com/oauth2/authorize?&apos;</span>\n    url = weibo_url + urlencode(params)\n    <span class=\"hljs-comment\">#&#x8bf7;&#x6c42;&#x4e0d;&#x5408;&#x6cd5; - &#x68c0;&#x67e5;params key&#x548c;&#x53c2;&#x6570;</span>\n    <span class=\"hljs-comment\">#&#x91cd;&#x5b9a;&#x5411;&#x5730;&#x5740;&#x4e0d;&#x4e00;&#x81f4;  &#x68c0;&#x67e5; &#x5404;&#x79cd; params weibo_url</span>\n    <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;oauth_url&apos;</span>:url})\n\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">oauth_token</span>(<span class=\"hljs-params\">request</span>):\n\n    <span class=\"hljs-keyword\">if</span> request.method == <span class=\"hljs-string\">&apos;GET&apos;</span>:\n        code = request.GET.get(<span class=\"hljs-string\">&apos;code&apos;</span>)\n        <span class=\"hljs-built_in\">print</span>(code)\n        <span class=\"hljs-comment\">#&#x7ed9;&#x5fae;&#x535a;&#x670d;&#x52a1;&#x5668;&#x53d1;&#x8bf7;&#x6c42; &#x7528; &#x6388;&#x6743;&#x7801; &#x4ea4;&#x6362;&#x7528;&#x6237; token</span>\n        token_url = <span class=\"hljs-string\">&apos;https://api.weibo.com/oauth2/access_token&apos;</span>\n        req_data = {\n            <span class=\"hljs-string\">&apos;client_id&apos;</span>: settings.WEIBO_CLIENT_ID,\n            <span class=\"hljs-string\">&apos;client_secret&apos;</span>: settings.WEIBO_CLIENT_SECRET,\n            <span class=\"hljs-string\">&apos;grant_type&apos;</span>: <span class=\"hljs-string\">&apos;authorization_code&apos;</span>,\n            <span class=\"hljs-string\">&apos;code&apos;</span>: code,\n            <span class=\"hljs-string\">&apos;redirect_uri&apos;</span>: settings.WEIBO_REDIRECT_URI\n        }\n        <span class=\"hljs-comment\">#sudo pip3 install requests</span>\n        response = requests.post(token_url,data=req_data)\n        <span class=\"hljs-keyword\">if</span> response.status_code == <span class=\"hljs-number\">200</span>:\n            res_data = json.loads(response.text)\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;change code error %s&apos;</span>%(response.status_code))\n            <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">10108</span>, <span class=\"hljs-string\">&apos;error&apos;</span>:<span class=\"hljs-string\">&apos;weibo error&apos;</span>})\n\n        <span class=\"hljs-keyword\">if</span> res_data.get(<span class=\"hljs-string\">&apos;error&apos;</span>):\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;change error&apos;</span>)\n            <span class=\"hljs-built_in\">print</span>(res_data.get(<span class=\"hljs-string\">&apos;error&apos;</span>))\n            <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">10109</span>, <span class=\"hljs-string\">&apos;error&apos;</span>:<span class=\"hljs-string\">&apos;weibo error !&apos;</span>})\n\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;----weibo token is ----&apos;</span>)\n        <span class=\"hljs-built_in\">print</span>(res_data)\n        <span class=\"hljs-comment\"># {&apos;access_token&apos;: &apos;2.00rudyBCAKZvWBe7549d8161JrJDdB&apos;, &apos;remind_in&apos;: &apos;157679999&apos;, &apos;expires_in&apos;: 157679999,</span>\n        <span class=\"hljs-comment\">#  &apos;uid&apos;: &apos;1861495121&apos;, &apos;isRealName&apos;: &apos;false&apos;}</span>\n        weibo_uid = res_data[<span class=\"hljs-string\">&apos;uid&apos;</span>]\n        access_token = res_data[<span class=\"hljs-string\">&apos;access_token&apos;</span>]\n        <span class=\"hljs-comment\">#&#x5148;&#x68c0;&#x67e5; &#x8be5;&#x5fae;&#x535a;&#x7528;&#x6237;&#x662f;&#x5426;&#x7b2c;&#x4e00;&#x6b21;&#x8fdb;&#x5165;&#x5230;&#x6211;&#x4eec;&#x7684;&#x7f51;&#x7ad9;</span>\n        <span class=\"hljs-keyword\">try</span>:\n            weibo_user = WeiboProfile.objects.get(wuid=weibo_uid)\n        <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n            <span class=\"hljs-comment\">#&#x8be5;&#x7528;&#x6237;&#x7b2c;&#x4e00;&#x6b21;&#x6765;</span>\n            WeiboProfile.objects.create(access_token=access_token, wuid=weibo_uid)\n            <span class=\"hljs-comment\"># &#x5982;&#x679c;&#x662f;&#x7b2c;&#x4e00;&#x6b21;&#x6765;&#xff0c;&#x8d76;&#x7d27;&#x5b58;&#x4e0b;&#x6765;&#xff0c; &#x6211;&#x73b0;&#x5728;&#x6709;&#x5185;&#x90e8;&#x7528;&#x6237;&#x53ef;&#x4ee5;&#x7ed1;&#x5b9a;&#x4e48;&#xff1f; - &#x5916;&#x5efa;&#x53ef;&#x4ee5;&#x6682;&#x65f6;&#x4e3a;&#x7a7a;</span>\n            <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">201</span>, <span class=\"hljs-string\">&apos;uid&apos;</span>: weibo_uid})\n        <span class=\"hljs-keyword\">else</span>:\n            <span class=\"hljs-comment\">#&#x8fd9;&#x4e2a;&#x5fae;&#x535a;&#x5e10;&#x53f7;&#x4e4b;&#x524d;&#x6765;&#x8fc7;</span>\n            user = weibo_user.user_profile\n            <span class=\"hljs-keyword\">if</span> user:\n                <span class=\"hljs-comment\">#1,&#x6267;&#x884c;&#x8fc7;&#x5b8c;&#x6574;&#x6d41;&#x7a0b;&#xff0c;&#x5373;&#x5b8c;&#x6210;&#x4e86;&#x7ed1;&#x5b9a;&#x6ce8;&#x518c;</span>\n                token = make_token(user.username)\n                <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;username&apos;</span>:user.username, <span class=\"hljs-string\">&apos;token&apos;</span>:token.decode()})\n            <span class=\"hljs-keyword\">else</span>:\n                <span class=\"hljs-comment\">#2,&#x6765;&#x662f;&#x6765;&#x8fc7;&#xff0c;&#x6ca1;&#x505a;&#x7ed1;&#x5b9a;&#x6ce8;&#x518c;&#xff0c;&#x76f4;&#x63a5;&#x8d70;&#x4e86;</span>\n                <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>: <span class=\"hljs-number\">201</span>, <span class=\"hljs-string\">&apos;uid&apos;</span>: weibo_uid})\n\n    <span class=\"hljs-keyword\">elif</span> request.method == <span class=\"hljs-string\">&apos;POST&apos;</span>:\n        <span class=\"hljs-comment\">#&#x7ed1;&#x5b9a;&#x6ce8;&#x518c;</span>\n        data = json.loads(request.body)\n        uid = data[<span class=\"hljs-string\">&apos;uid&apos;</span>]\n        username = data[<span class=\"hljs-string\">&apos;username&apos;</span>]\n        password = data[<span class=\"hljs-string\">&apos;password&apos;</span>]\n        phone = data[<span class=\"hljs-string\">&apos;phone&apos;</span>]\n        email = data[<span class=\"hljs-string\">&apos;email&apos;</span>]\n        <span class=\"hljs-comment\">#TODO &#x68c0;&#x67e5;&#x7528;&#x6237;&#x540d;&#x662f;&#x5426;&#x5df2;&#x5b58;&#x5728;</span>\n        m = hashlib.md5()\n        m.update(password.encode())\n        <span class=\"hljs-comment\">#&#x521b;&#x5efa;&#x5185;&#x90e8;&#x7528;&#x6237;&amp;&#x7ed1;&#x5b9a;&#x5fae;&#x535a;&#x7528;&#x6237;</span>\n        <span class=\"hljs-keyword\">try</span>:\n            <span class=\"hljs-keyword\">with</span> transaction.atomic():\n                user = UserProfile.objects.create(username=username,password=m.hexdigest(),email=email,phone=phone)\n                weibo_user = WeiboProfile.objects.get(wuid=uid)\n                weibo_user.user_profile = user\n                weibo_user.save()\n        <span class=\"hljs-keyword\">except</span> Exception <span class=\"hljs-keyword\">as</span> e:\n            <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">10110</span>, <span class=\"hljs-string\">&apos;error&apos;</span>:<span class=\"hljs-string\">&apos;bind register error&apos;</span>})\n        token = make_token(username)\n        <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">200</span>, <span class=\"hljs-string\">&apos;username&apos;</span>:username, <span class=\"hljs-string\">&apos;token&apos;</span>:token.decode()})\n\n\n    <span class=\"hljs-keyword\">return</span> JsonResponse({<span class=\"hljs-string\">&apos;code&apos;</span>:<span class=\"hljs-number\">200</span>})\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1866,2143"}}],"payload":{"tag":"h4","lines":"1747,1748"}},{"content":"goods_data.json","children":[{"content":"<pre data-lines=\"2146,2402\"><code data-lines=\"2146,2402\">[\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.catalog&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">1</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:53:32.649&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:53:32.649&quot;</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>624b<span class=\"hljs-char escape_\">\\u</span>63d0<span class=\"hljs-char escape_\">\\u</span>5305&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.brand&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">1</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:53:21.783&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:53:21.783&quot;</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0f&quot;</span>,\n    <span class=\"hljs-string\">&quot;logo&quot;</span>: <span class=\"hljs-string\">&quot;brand/1_bhUBGXb.png&quot;</span>,\n    <span class=\"hljs-string\">&quot;first_letter&quot;</span>: <span class=\"hljs-string\">&quot;A&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.spu&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">1</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:53:44.000&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:53:44.000&quot;</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0fA&quot;</span>,\n    <span class=\"hljs-string\">&quot;sales&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;comments&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;brand&quot;</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">&quot;catalog&quot;</span>: <span class=\"hljs-number\">1</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.spu&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">2</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:53:49.770&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:53:49.770&quot;</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0fB&quot;</span>,\n    <span class=\"hljs-string\">&quot;sales&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;comments&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;brand&quot;</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">&quot;catalog&quot;</span>: <span class=\"hljs-number\">1</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.spu&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">3</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:53:54.513&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:53:54.513&quot;</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0fC&quot;</span>,\n    <span class=\"hljs-string\">&quot;sales&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;comments&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;brand&quot;</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">&quot;catalog&quot;</span>: <span class=\"hljs-number\">1</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.spusaleattr&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">1</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:54:08.941&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:54:08.941&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu&quot;</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0fA/<span class=\"hljs-char escape_\">\\u</span>5c3a<span class=\"hljs-char escape_\">\\u</span>5bf8&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.spusaleattr&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">2</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:54:15.499&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:54:15.499&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu&quot;</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0fA/<span class=\"hljs-char escape_\">\\u</span>989c<span class=\"hljs-char escape_\">\\u</span>8272&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.spusaleattr&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">3</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:54:20.624&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:54:20.625&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu&quot;</span>: <span class=\"hljs-number\">2</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0fB/<span class=\"hljs-char escape_\">\\u</span>5c3a<span class=\"hljs-char escape_\">\\u</span>5bf8&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.spusaleattr&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">4</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:54:25.681&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:54:25.681&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu&quot;</span>: <span class=\"hljs-number\">2</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0fB/<span class=\"hljs-char escape_\">\\u</span>989c<span class=\"hljs-char escape_\">\\u</span>8272&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.spusaleattr&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">5</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:54:31.556&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:54:31.556&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu&quot;</span>: <span class=\"hljs-number\">3</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0fC/<span class=\"hljs-char escape_\">\\u</span>5c3a<span class=\"hljs-char escape_\">\\u</span>5bf8&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.spusaleattr&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">6</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:54:36.124&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:54:36.124&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu&quot;</span>: <span class=\"hljs-number\">3</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0fC/<span class=\"hljs-char escape_\">\\u</span>989c<span class=\"hljs-char escape_\">\\u</span>8272&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.saleattrvalue&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">1</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:55:21.068&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:55:21.068&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu_sale_attr&quot;</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;15<span class=\"hljs-char escape_\">\\u</span>5bf8&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.saleattrvalue&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">2</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:55:31.229&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:55:31.229&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu_sale_attr&quot;</span>: <span class=\"hljs-number\">2</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>84dd<span class=\"hljs-char escape_\">\\u</span>8272&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.saleattrvalue&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">3</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:56:37.091&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:56:37.092&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu_sale_attr&quot;</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;18<span class=\"hljs-char escape_\">\\u</span>5bf8&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.saleattrvalue&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">4</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:56:46.080&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:56:46.080&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu_sale_attr&quot;</span>: <span class=\"hljs-number\">2</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>7070<span class=\"hljs-char escape_\">\\u</span>8272&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.saleattrvalue&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">5</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:57:28.512&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:57:28.512&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu_sale_attr&quot;</span>: <span class=\"hljs-number\">3</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;15<span class=\"hljs-char escape_\">\\u</span>5bf8&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.saleattrvalue&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">6</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:57:37.762&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:57:37.762&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu_sale_attr&quot;</span>: <span class=\"hljs-number\">4</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>84dd<span class=\"hljs-char escape_\">\\u</span>8272&quot;</span>\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.sku&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">1</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:55:40.974&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:55:40.974&quot;</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0fA<span class=\"hljs-char escape_\">\\u</span>84dd<span class=\"hljs-char escape_\">\\u</span>8272<span class=\"hljs-char escape_\">\\u</span>5c0f<span class=\"hljs-char escape_\">\\u</span>5c3a<span class=\"hljs-char escape_\">\\u</span>5bf8&quot;</span>,\n    <span class=\"hljs-string\">&quot;caption&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>84dd<span class=\"hljs-char escape_\">\\u</span>8272<span class=\"hljs-char escape_\">\\u</span>5c0f<span class=\"hljs-char escape_\">\\u</span>5c3a<span class=\"hljs-char escape_\">\\u</span>5bf8&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu&quot;</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">&quot;price&quot;</span>: <span class=\"hljs-string\">&quot;88.00&quot;</span>,\n    <span class=\"hljs-string\">&quot;cost_price&quot;</span>: <span class=\"hljs-string\">&quot;100.00&quot;</span>,\n    <span class=\"hljs-string\">&quot;market_price&quot;</span>: <span class=\"hljs-string\">&quot;100.00&quot;</span>,\n    <span class=\"hljs-string\">&quot;stock&quot;</span>: <span class=\"hljs-number\">1000</span>,\n    <span class=\"hljs-string\">&quot;sales&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;comments&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;is_launched&quot;</span>: <span class=\"hljs-literal\">true</span>,\n    <span class=\"hljs-string\">&quot;default_image_url&quot;</span>: <span class=\"hljs-string\">&quot;sku/1_CWVre0U.png&quot;</span>,\n    <span class=\"hljs-string\">&quot;version&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;sale_attr_value&quot;</span>: [\n      <span class=\"hljs-number\">1</span>,\n      <span class=\"hljs-number\">2</span>\n    ]\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.sku&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">2</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:56:49.141&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:56:49.141&quot;</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0fA<span class=\"hljs-char escape_\">\\u</span>7070<span class=\"hljs-char escape_\">\\u</span>8272<span class=\"hljs-char escape_\">\\u</span>5927<span class=\"hljs-char escape_\">\\u</span>5c3a<span class=\"hljs-char escape_\">\\u</span>5bf8&quot;</span>,\n    <span class=\"hljs-string\">&quot;caption&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>7070<span class=\"hljs-char escape_\">\\u</span>8272<span class=\"hljs-char escape_\">\\u</span>5927<span class=\"hljs-char escape_\">\\u</span>5c3a<span class=\"hljs-char escape_\">\\u</span>5bf8&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu&quot;</span>: <span class=\"hljs-number\">1</span>,\n    <span class=\"hljs-string\">&quot;price&quot;</span>: <span class=\"hljs-string\">&quot;139.00&quot;</span>,\n    <span class=\"hljs-string\">&quot;cost_price&quot;</span>: <span class=\"hljs-string\">&quot;200.00&quot;</span>,\n    <span class=\"hljs-string\">&quot;market_price&quot;</span>: <span class=\"hljs-string\">&quot;200.00&quot;</span>,\n    <span class=\"hljs-string\">&quot;stock&quot;</span>: <span class=\"hljs-number\">1000</span>,\n    <span class=\"hljs-string\">&quot;sales&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;comments&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;is_launched&quot;</span>: <span class=\"hljs-literal\">true</span>,\n    <span class=\"hljs-string\">&quot;default_image_url&quot;</span>: <span class=\"hljs-string\">&quot;sku/2_viqhhBm.png&quot;</span>,\n    <span class=\"hljs-string\">&quot;version&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;sale_attr_value&quot;</span>: [\n      <span class=\"hljs-number\">3</span>,\n      <span class=\"hljs-number\">4</span>\n    ]\n  }\n},\n{\n  <span class=\"hljs-string\">&quot;model&quot;</span>: <span class=\"hljs-string\">&quot;goods.sku&quot;</span>,\n  <span class=\"hljs-string\">&quot;pk&quot;</span>: <span class=\"hljs-number\">3</span>,\n  <span class=\"hljs-string\">&quot;fields&quot;</span>: {\n    <span class=\"hljs-string\">&quot;created_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:57:39.828&quot;</span>,\n    <span class=\"hljs-string\">&quot;updated_time&quot;</span>: <span class=\"hljs-string\">&quot;2020-02-20T17:58:37.073&quot;</span>,\n    <span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>5b89<span class=\"hljs-char escape_\">\\u</span>8e0fB<span class=\"hljs-char escape_\">\\u</span>84dd<span class=\"hljs-char escape_\">\\u</span>8272<span class=\"hljs-char escape_\">\\u</span>5c0f<span class=\"hljs-char escape_\">\\u</span>5c3a<span class=\"hljs-char escape_\">\\u</span>5bf8&quot;</span>,\n    <span class=\"hljs-string\">&quot;caption&quot;</span>: <span class=\"hljs-string\">&quot;<span class=\"hljs-char escape_\">\\u</span>84dd<span class=\"hljs-char escape_\">\\u</span>8272<span class=\"hljs-char escape_\">\\u</span>5c0f<span class=\"hljs-char escape_\">\\u</span>5c3a<span class=\"hljs-char escape_\">\\u</span>5bf8&quot;</span>,\n    <span class=\"hljs-string\">&quot;spu&quot;</span>: <span class=\"hljs-number\">2</span>,\n    <span class=\"hljs-string\">&quot;price&quot;</span>: <span class=\"hljs-string\">&quot;167.00&quot;</span>,\n    <span class=\"hljs-string\">&quot;cost_price&quot;</span>: <span class=\"hljs-string\">&quot;200.00&quot;</span>,\n    <span class=\"hljs-string\">&quot;market_price&quot;</span>: <span class=\"hljs-string\">&quot;200.00&quot;</span>,\n    <span class=\"hljs-string\">&quot;stock&quot;</span>: <span class=\"hljs-number\">1000</span>,\n    <span class=\"hljs-string\">&quot;sales&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;comments&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;is_launched&quot;</span>: <span class=\"hljs-literal\">true</span>,\n    <span class=\"hljs-string\">&quot;default_image_url&quot;</span>: <span class=\"hljs-string\">&quot;sku/3_1Dc1Us9.png&quot;</span>,\n    <span class=\"hljs-string\">&quot;version&quot;</span>: <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">&quot;sale_attr_value&quot;</span>: [\n      <span class=\"hljs-number\">5</span>,\n      <span class=\"hljs-number\">6</span>\n    ]\n  }\n}\n]\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2146,2402"}}],"payload":{"tag":"h4","lines":"2144,2145"}},{"content":"mange.py","children":[{"content":"<pre data-lines=\"2405,2430\"><code data-lines=\"2405,2430\"><span class=\"hljs-comment\">#!/usr/bin/env python</span>\n<span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">import</span> sys\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\n    os.environ.setdefault(<span class=\"hljs-string\">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class=\"hljs-string\">&quot;dashop11.settings&quot;</span>)\n    <span class=\"hljs-keyword\">try</span>:\n        <span class=\"hljs-keyword\">from</span> django.core.management <span class=\"hljs-keyword\">import</span> execute_from_command_line\n    <span class=\"hljs-keyword\">except</span> <span class=\"hljs-type\">ImportError</span>:\n        <span class=\"hljs-comment\"># The above import may fail for some other reason. Ensure that the</span>\n        <span class=\"hljs-comment\"># issue is really that Django is missing to avoid masking other</span>\n        <span class=\"hljs-comment\"># exceptions on Python 2.</span>\n        <span class=\"hljs-keyword\">try</span>:\n            <span class=\"hljs-keyword\">import</span> django\n        <span class=\"hljs-keyword\">except</span> <span class=\"hljs-type\">ImportError</span>:\n            <span class=\"hljs-keyword\">raise</span> <span class=\"hljs-type\">ImportError</span>(\n                <span class=\"hljs-string\">&quot;Couldn&apos;t import Django. Are you sure it&apos;s installed and &quot;</span>\n                <span class=\"hljs-string\">&quot;available on your PYTHONPATH environment variable? Did you &quot;</span>\n                <span class=\"hljs-string\">&quot;forget to activate a virtual environment?&quot;</span>\n            )\n        <span class=\"hljs-keyword\">raise</span>\n    execute_from_command_line(sys.argv)\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2405,2430"}}],"payload":{"tag":"h4","lines":"2403,2404"}}],"payload":{"tag":"h3","lines":"2,3"}},{})</script>
</body>
</html>
