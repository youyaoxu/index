<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"ref","children":[{"content":"<pre data-lines=\"2,7\"><code>&#x5728;&#x8c03;&#x548c;&#x5b50;&#x8282;&#x70b9;&#x5f97;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x4f1a;&#x5bf9;`ReactElement`&#x4e2d;&#x5f97;`ref`&#x8fdb;&#x884c;&#x5904;&#x7406;&#xff0c;&#x4e3b;&#x8981;&#x662f;&#x5904;&#x7406;`string ref`&#xff0c;&#x628a;&#x4ed6;&#x8f6c;&#x6362;&#x6210;&#x4e00;&#x4e2a;&#x65b9;&#x6cd5;&#xff0c;&#x8fd9;&#x4e2a;&#x65b9;&#x6cd5;&#x4e3b;&#x8981;&#x505a;&#x7684;&#x4e8b;&#x60c5;&#x5c31;&#x662f;&#x8bbe;&#x7f6e;`instance.refs[stringRef] = element`&#xff0c;&#x76f8;&#x5f53;&#x4e8e;&#x628a;&#x4ed6;&#x8f6c;&#x6362;&#x6210;&#x4e86;`function ref`\n\n&#x5bf9;&#x4e8e;&#x66f4;&#x65b0;&#x5f97;&#x8fc7;&#x7a0b;&#x4e2d;`string ref`&#x662f;&#x5426;&#x53d8;&#x5316;&#x9700;&#x8981;&#x5bf9;&#x6bd4;&#x5f97;&#x662f;`current.ref._stringRef`&#xff0c;&#x8fd9;&#x91cc;&#x8bb0;&#x5f55;&#x4e86;&#x4e0a;&#x4e00;&#x6b21;&#x6e32;&#x67d3;&#x5f97;&#x65f6;&#x5019;&#x5982;&#x679c;&#x4f7f;&#x7528;&#x5f97;&#x662f;`string ref`&#x4ed6;&#x7684;&#x503c;&#x662f;&#x4ec0;&#x4e48;\n\n`owner`&#x662f;&#x5728;&#x8c03;&#x7528;`createElement`&#x7684;&#x65f6;&#x5019;&#x83b7;&#x53d6;&#x7684;&#xff0c;&#x901a;&#x8fc7;`ReactCurrentOwner.current`&#x83b7;&#x53d6;&#xff0c;&#x8fd9;&#x4e2a;&#x503c;&#x5728;&#x66f4;&#x65b0;&#x4e00;&#x4e2a;&#x7ec4;&#x4ef6;&#x524d;&#x4f1a;&#x88ab;&#x8bbe;&#x7f6e;&#xff0c;&#x6bd4;&#x5982;&#x66f4;&#x65b0;`ClassComponent`&#x7684;&#x65f6;&#x5019;&#xff0c;&#x8c03;&#x7528;`render`&#x65b9;&#x6cd5;&#x4e4b;&#x524d;&#x4f1a;&#x8bbe;&#x7f6e;&#xff0c;&#x7136;&#x540e;&#x8c03;&#x7528;`render`&#x7684;&#x65f6;&#x5019;&#x5c31;&#x53ef;&#x4ee5;&#x83b7;&#x53d6;&#x5bf9;&#x5e94;&#x7684;`owner`&#x4e86;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2,7"}},{"content":"<pre data-lines=\"8,66\"><code data-lines=\"8,66\">\nexisting.<span class=\"hljs-keyword\">ref</span> = coerceRef(returnFiber, current, element)\n\n<span class=\"hljs-function\">function <span class=\"hljs-title\">coerceRef</span>(<span class=\"hljs-params\">\n  returnFiber: Fiber,\n  current: Fiber | <span class=\"hljs-literal\">null</span>,\n  element: ReactElement,\n</span>)</span> {\n  <span class=\"hljs-keyword\">let</span> mixedRef = element.<span class=\"hljs-function\"><span class=\"hljs-keyword\">ref</span>\n  <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">\n    mixedRef !== <span class=\"hljs-literal\">null</span> &amp;&amp;\n    <span class=\"hljs-keyword\">typeof</span> mixedRef !== <span class=\"hljs-string\">&apos;function&apos;</span> &amp;&amp;\n    <span class=\"hljs-keyword\">typeof</span> mixedRef !== <span class=\"hljs-string\">&apos;object&apos;</span>\n  </span>)</span> {\n    \n\n    <span class=\"hljs-keyword\">if</span> (element._owner) {\n      <span class=\"hljs-keyword\">const</span> owner: ?Fiber = (element._owner: any)\n      <span class=\"hljs-function\"><span class=\"hljs-keyword\">let</span> inst\n      <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">owner</span>)</span> {\n        <span class=\"hljs-keyword\">const</span> ownerFiber = ((owner: any): Fiber)\n        \n        inst = ownerFiber.stateNode\n      }\n      \n      <span class=\"hljs-keyword\">const</span> stringRef = <span class=\"hljs-string\">&apos;&apos;</span> + <span class=\"hljs-function\">mixedRef\n      \n      <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">\n        current !== <span class=\"hljs-literal\">null</span> &amp;&amp;\n        current.<span class=\"hljs-keyword\">ref</span> !== <span class=\"hljs-literal\">null</span> &amp;&amp;\n        <span class=\"hljs-keyword\">typeof</span> current.<span class=\"hljs-keyword\">ref</span> === <span class=\"hljs-string\">&apos;function&apos;</span> &amp;&amp;\n        current.<span class=\"hljs-keyword\">ref</span>._stringRef === stringRef\n      </span>)</span> {\n        <span class=\"hljs-keyword\">return</span> current.<span class=\"hljs-keyword\">ref</span>\n      }\n      <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">ref</span> = function(<span class=\"hljs-keyword\">value</span>) {\n        <span class=\"hljs-keyword\">let</span> refs = inst.<span class=\"hljs-function\">refs\n        <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">refs === emptyRefsObject</span>)</span> {\n          \n          refs = inst.refs = {}\n        }\n        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">value</span> === <span class=\"hljs-literal\">null</span>) {\n          delete refs[stringRef]\n        } <span class=\"hljs-keyword\">else</span> {\n          refs[stringRef] = <span class=\"hljs-keyword\">value</span>\n        }\n      }\n      <span class=\"hljs-keyword\">ref</span>._stringRef = stringRef\n      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">ref</span>\n    } <span class=\"hljs-keyword\">else</span> {\n      \n    }\n  }\n  <span class=\"hljs-keyword\">return</span> mixedRef\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"8,66"}},{"content":"<pre data-lines=\"67,70\"><code>&#x5728;`commitRoot`&#x6700;&#x540e;&#x9636;&#x6bb5;&#xff0c;`commitAllLifecycle`&#x7684;&#x65f6;&#x5019;&#xff0c;&#x5982;&#x679c;&#x53c8;`Ref`&#x5f97;`side effect`&#xff0c;&#x5219;&#x4f1a;&#x8c03;&#x7528;&#x8be5;&#x65b9;&#x6cd5;\n\n&#x8be5;&#x65b9;&#x6cd5;&#x5f88;&#x7b80;&#x5355;&#xff0c;&#x83b7;&#x53d6;`ref`&#x4f5c;&#x7528;&#x5f97;&#x8282;&#x70b9;&#xff0c;&#x5e76;&#x6839;&#x636e;`ref`&#x7684;&#x7c7b;&#x578b;&#xff0c;&#x8c03;&#x7528;&#x65b9;&#x6cd5;&#xff0c;&#x6216;&#x8005;&#x8d4b;&#x503c;`ref.current`&#xff0c;&#x56e0;&#x4e3a;`ref`&#x5df2;&#x7ecf;&#x5728;`coerceRef`&#x5904;&#x7406;&#x8fc7;&#x4e86;&#xff0c;&#x4e0d;&#x4f1a;&#x5b58;&#x5728;&#x8fd8;&#x662f;`string`&#x5f97;&#x60c5;&#x51b5;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"67,70"}},{"content":"<pre data-lines=\"71,93\"><code data-lines=\"71,93\"><span class=\"hljs-function\">function <span class=\"hljs-title\">commitAttachRef</span>(<span class=\"hljs-params\">finishedWork: Fiber</span>)</span> {\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">ref</span> = finishedWork.<span class=\"hljs-function\"><span class=\"hljs-keyword\">ref</span>\n  <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\"><span class=\"hljs-keyword\">ref</span> !== <span class=\"hljs-literal\">null</span></span>)</span> {\n    <span class=\"hljs-keyword\">const</span> instance = finishedWork.<span class=\"hljs-function\">stateNode\n    <span class=\"hljs-keyword\">let</span> instanceToUse\n    <span class=\"hljs-title\">switch</span> (<span class=\"hljs-params\">finishedWork.tag</span>)</span> {\n      <span class=\"hljs-keyword\">case</span> HostComponent:\n        instanceToUse = getPublicInstance(instance)\n        <span class=\"hljs-keyword\">break</span>\n      <span class=\"hljs-literal\">default</span>:\n        instanceToUse = instance\n    }\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-keyword\">ref</span> === <span class=\"hljs-string\">&apos;function&apos;</span>) {\n      <span class=\"hljs-keyword\">ref</span>(instanceToUse)\n    } <span class=\"hljs-keyword\">else</span> {\n      <span class=\"hljs-keyword\">ref</span>.current = instanceToUse\n    }\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"71,93"}},{"content":"<pre data-lines=\"94,97\"><code>&#x5378;&#x8f7d;`ref`&#xff0c;&#x8bbe;&#x7f6e;&#x4e3a;`null`\n\n&#x5728;`commitAllHostEffects`&#x7684;&#x65f6;&#x5019;&#x4f1a;&#x7edf;&#x4e00;&#x5bf9;&#x6240;&#x6709;&#x6709;`ref`&#x7684;`side effect`&#x7684;&#x8282;&#x70b9;&#x5148;&#x5378;&#x8f7d;`ref`&#xff0c;&#x540e;&#x7eed;&#x4f1a;&#x7edf;&#x4e00;&#x518d;&#x8bbe;&#x7f6e;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"94,97"}},{"content":"<pre data-lines=\"98,111\"><code data-lines=\"98,111\"><span class=\"hljs-function\">function <span class=\"hljs-title\">commitDetachRef</span>(<span class=\"hljs-params\">current: Fiber</span>)</span> {\n  <span class=\"hljs-keyword\">const</span> currentRef = current.<span class=\"hljs-function\"><span class=\"hljs-keyword\">ref</span>\n  <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">currentRef !== <span class=\"hljs-literal\">null</span></span>)</span> {\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> currentRef === <span class=\"hljs-string\">&apos;function&apos;</span>) {\n      currentRef(<span class=\"hljs-literal\">null</span>)\n    } <span class=\"hljs-keyword\">else</span> {\n      currentRef.current = <span class=\"hljs-literal\">null</span>\n    }\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"98,111"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"112,113"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"116,117"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
