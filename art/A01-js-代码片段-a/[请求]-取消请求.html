<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://unpkg.com/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://unpkg.com/d3@7.9.0/dist/d3.min.js"></script><script src="https://unpkg.com/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://unpkg.com/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"axios&#x53d6;&#x6d88;&#x91cd;&#x590d;&#x8bf7;&#x6c42;","children":[{"content":"&#x65b9;&#x5f0f;&#x4e00;","children":[{"content":"<pre data-lines=\"3,29\"><code class=\"language-js\"><span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;axios&apos;</span>\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">let</span> axiosCancelArr=[]\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">handleAxiosCancelToken</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-comment\">// &#x6536;&#x96c6;&#x8bf7;&#x6c42;&#x96c6;&#x5408;</span>\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> axios.<span class=\"hljs-title class_\">CancelToken</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">c</span>) =&gt;</span> {\n    <span class=\"hljs-comment\">// &#x6570;&#x7ec4;&#x5b58;&#x50a8;&#x4e00;&#x4e2a;cancel&#x51fd;&#x6570;&#x7528;&#x4e8e;&#x53d6;&#x6d88;&#x672c;&#x6b21;&#x7684;&#x7f51;&#x7edc;&#x8bf7;&#x6c42;</span>\n    axiosCancelArr.<span class=\"hljs-title function_\">push</span>(c)\n  })\n}\n\n<span class=\"hljs-comment\">/*\n * params {message} &#x9519;&#x8bef;&#x63d0;&#x793a;\n * */</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">handleAxiosCancel</span>(<span class=\"hljs-params\">message</span>) {\n  <span class=\"hljs-comment\">// &#x53d6;&#x6d88;&#x672c;&#x6b21;&#x8bf7;&#x6c42;&#x4e4b;&#x524d;&#x7684;&#x6240;&#x6709;&#x8bf7;&#x6c42;</span>\n  <span class=\"hljs-keyword\">if</span> (axiosCancelArr &amp;&amp; axiosCancelArr.<span class=\"hljs-property\">length</span>&gt;<span class=\"hljs-number\">0</span>) {\n    axiosCancelArr.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">cancel, idx</span>) =&gt;</span> {\n      <span class=\"hljs-title function_\">cancel</span>(message)\n      <span class=\"hljs-comment\">// &#x53d6;&#x6d88;&#x7f51;&#x7edc;&#x8bf7;&#x6c42;</span>\n      <span class=\"hljs-keyword\">delete</span> axiosCancelArr[idx] <span class=\"hljs-comment\">//&#x79fb;&#x9664;&#x96c6;&#x5408;&#x91cc;&#x5df2;&#x7ecf;&#x53d6;&#x6d88;&#x7684;&#x8bf7;&#x6c42;</span>\n    })\n  }\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3,29"}},{"content":"<pre data-lines=\"31,42\"><code class=\"language-js\"><span class=\"hljs-comment\">// &#x83b7;&#x53d6;&#x7528;&#x6237;&#x5458;&#x5de5;&#x96c6;&#x5408;</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">listTaskDetailUserApi</span>(<span class=\"hljs-params\">params,fn</span>) {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">request</span>({\n    <span class=\"hljs-attr\">url</span>: <span class=\"hljs-string\">`<span class=\"hljs-subst\">&#x24;{three}</span>/wechatwork/api/task-manages-user`</span>,\n    <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&apos;get&apos;</span>,\n    params,\n    <span class=\"hljs-attr\">cancelToken</span>:fn || <span class=\"hljs-literal\">null</span>\n  })\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"31,42"}},{"content":"<pre data-lines=\"43,58\"><code class=\"language-js\"><span class=\"hljs-keyword\">import</span> {handleAxiosCancelToken, handleAxiosCancel} <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@/utils/requestCancel&quot;</span>\n\n<span class=\"hljs-comment\">// &#x63a5;&#x53e3;(&#x8c03;&#x7528;)-&#x67e5;&#x8be2;&#x4efb;&#x52a1;&#x4e2d;&#x5fc3;&#x7528;&#x6237;&#x5217;&#x8868;</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">fetchTaskUsers</span>(<span class=\"hljs-params\">params</span>) {\n  <span class=\"hljs-keyword\">let</span> payload = {}\n  <span class=\"hljs-title function_\">handleAxiosCancel</span>(<span class=\"hljs-string\">&apos;cancel&apos;</span>)\n  <span class=\"hljs-keyword\">const</span> [err, res] = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">to</span>(<span class=\"hljs-title function_\">listTaskDetailUserApi</span>(payload,<span class=\"hljs-title function_\">handleAxiosCancelToken</span>()))\n  <span class=\"hljs-keyword\">if</span> (err) {\n    <span class=\"hljs-keyword\">if</span>(err.<span class=\"hljs-property\">message</span>===<span class=\"hljs-string\">&apos;cancel&apos;</span>)<span class=\"hljs-keyword\">return</span>\n    <span class=\"hljs-title function_\">errorInfo</span>(err)\n    <span class=\"hljs-keyword\">return</span>\n  }\n},\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"43,58"}},{"content":"<pre data-lines=\"60,66\"><code class=\"language-js\"><span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;axios&apos;</span>\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title class_\">CancelToken</span> = axios.<span class=\"hljs-property\">CancelToken</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> source = <span class=\"hljs-title class_\">CancelToken</span>.<span class=\"hljs-title function_\">source</span>()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"60,66"}},{"content":"<pre data-lines=\"68,86\"><code class=\"language-js\"><span class=\"hljs-keyword\">import</span> axios <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;axios&apos;</span>\n<span class=\"hljs-keyword\">import</span> {source} <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;@/utils/requestCancel.js&apos;</span>\n\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">fetchTaskUsers</span>(<span class=\"hljs-params\">params</span>) {\n  <span class=\"hljs-keyword\">let</span> payload = {}\n  <span class=\"hljs-keyword\">const</span> [err, res] = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">to</span>(<span class=\"hljs-title function_\">listTaskDetailUserApi</span>(payload,source.<span class=\"hljs-property\">token</span>)\n  source.<span class=\"hljs-title function_\">cancel</span>(<span class=\"hljs-string\">&apos;cancel&apos;</span>)\n  <span class=\"hljs-keyword\">if</span> (err) {\n    <span class=\"hljs-keyword\">if</span>(axios.<span class=\"hljs-title function_\">isCancel</span>(err)){\n    \t<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;Request canceled&apos;</span>,err.<span class=\"hljs-property\">message</span>)\n    }\n    <span class=\"hljs-title function_\">errorInfo</span>(err)\n    <span class=\"hljs-keyword\">return</span>\n  }\n  \n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"68,86"}}],"payload":{"tag":"h3","lines":"1,2"}},{"content":"&#x65b9;&#x5f0f;&#x4e09;","children":[{"content":"<pre data-lines=\"90,158\"><code class=\"language-js\">\n<span class=\"hljs-comment\">/*\n* &#x7528;&#x4e8e;&#x6839;&#x636e;&#x5f53;&#x524d;&#x8bf7;&#x6c42;&#x7684;&#x4fe1;&#x606f;,&#x751f;&#x6210;&#x8bf7;&#x6c42;key\n*/</span>\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">generateReqKey</span>(<span class=\"hljs-params\">config</span>) {\n  <span class=\"hljs-keyword\">const</span> { method, url, params, data } = config;\n  <span class=\"hljs-keyword\">return</span> [method, url, <span class=\"hljs-title class_\">Qs</span>.<span class=\"hljs-title function_\">stringify</span>(params), <span class=\"hljs-title class_\">Qs</span>.<span class=\"hljs-title function_\">stringify</span>(data)].<span class=\"hljs-title function_\">join</span>(<span class=\"hljs-string\">&quot;&amp;&quot;</span>);\n}\n\n<span class=\"hljs-comment\">/*\n* &#x7528;&#x4e8e;&#x628a;&#x5f53;&#x524d;&#x8bf7;&#x6c42;&#x4fe1;&#x606f;&#x6dfb;&#x52a0;&#x5230;pendingRequest&#x5bf9;&#x8c61;&#x4e2d;\n*/</span>\n<span class=\"hljs-keyword\">const</span> pendingRequest = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Map</span>();\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">addPendingRequest</span>(<span class=\"hljs-params\">config</span>) {\n  <span class=\"hljs-keyword\">const</span> requestKey = <span class=\"hljs-title function_\">generateReqKey</span>(config);\n  config.<span class=\"hljs-property\">cancelToken</span> = config.<span class=\"hljs-property\">cancelToken</span> || <span class=\"hljs-keyword\">new</span> axios.<span class=\"hljs-title class_\">CancelToken</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">cancel</span>) =&gt;</span> {\n    <span class=\"hljs-keyword\">if</span> (!pendingRequest.<span class=\"hljs-title function_\">has</span>(requestKey)) {\n       pendingRequest.<span class=\"hljs-title function_\">set</span>(requestKey, cancel);\n    }\n  });\n}\n\n<span class=\"hljs-comment\">/*\n* &#x68c0;&#x67e5;&#x662f;&#x5426;&#x5b58;&#x5728;&#x91cd;&#x590d;&#x8bf7;&#x6c42;,&#x82e5;&#x5b58;&#x5728;&#x5219;&#x53d6;&#x6d88;&#x4ee5;&#x53d1;&#x7684;&#x8bf7;&#x6c42;\n*/</span>\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">removePendingRequest</span>(<span class=\"hljs-params\">config</span>) {\n  <span class=\"hljs-keyword\">const</span> requestKey = <span class=\"hljs-title function_\">generateReqKey</span>(config);\n  <span class=\"hljs-keyword\">if</span> (pendingRequest.<span class=\"hljs-title function_\">has</span>(requestKey)) {\n     <span class=\"hljs-keyword\">const</span> cancelToken = pendingRequest.<span class=\"hljs-title function_\">get</span>(requestKey);\n     <span class=\"hljs-title function_\">cancelToken</span>(requestKey);\n     pendingRequest.<span class=\"hljs-title function_\">delete</span>(requestKey);\n  }\n}\n\n<span class=\"hljs-comment\">/*\n* &#x8bbe;&#x7f6e;&#x8bf7;&#x6c42;&#x62e6;&#x622a;&#x5668;\n*/</span>\naxios.<span class=\"hljs-property\">interceptors</span>.<span class=\"hljs-property\">request</span>.<span class=\"hljs-title function_\">use</span>(\n  <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">config</span>) {\n    <span class=\"hljs-title function_\">removePendingRequest</span>(config); <span class=\"hljs-comment\">// &#x68c0;&#x67e5;&#x662f;&#x5426;&#x5b58;&#x5728;&#x91cd;&#x590d;&#x8bf7;&#x6c42;&#xff0c;&#x82e5;&#x5b58;&#x5728;&#x5219;&#x53d6;&#x6d88;&#x5df2;&#x53d1;&#x7684;&#x8bf7;&#x6c42;</span>\n    <span class=\"hljs-title function_\">addPendingRequest</span>(config); <span class=\"hljs-comment\">// &#x628a;&#x5f53;&#x524d;&#x8bf7;&#x6c42;&#x4fe1;&#x606f;&#x6dfb;&#x52a0;&#x5230;pendingRequest&#x5bf9;&#x8c61;&#x4e2d;</span>\n    <span class=\"hljs-keyword\">return</span> config;\n  },\n  <span class=\"hljs-function\">(<span class=\"hljs-params\">error</span>) =&gt;</span> {\n     <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">reject</span>(error);\n  }\n);\n\n<span class=\"hljs-comment\">/*\n* &#x8bbe;&#x7f6e;&#x54cd;&#x5e94;&#x62e6;&#x622a;&#x5668;\n*/</span>\naxios.<span class=\"hljs-property\">interceptors</span>.<span class=\"hljs-property\">response</span>.<span class=\"hljs-title function_\">use</span>(\n  <span class=\"hljs-function\">(<span class=\"hljs-params\">response</span>) =&gt;</span> {\n     <span class=\"hljs-title function_\">removePendingRequest</span>(response.<span class=\"hljs-property\">config</span>); <span class=\"hljs-comment\">// &#x4ece;pendingRequest&#x5bf9;&#x8c61;&#x4e2d;&#x79fb;&#x9664;&#x8bf7;&#x6c42;</span>\n     <span class=\"hljs-keyword\">return</span> response;\n   },\n   <span class=\"hljs-function\">(<span class=\"hljs-params\">error</span>) =&gt;</span> {\n      <span class=\"hljs-title function_\">removePendingRequest</span>(error.<span class=\"hljs-property\">config</span> || {}); <span class=\"hljs-comment\">// &#x4ece;pendingRequest&#x5bf9;&#x8c61;&#x4e2d;&#x79fb;&#x9664;&#x8bf7;&#x6c42;</span>\n      <span class=\"hljs-keyword\">if</span> (axios.<span class=\"hljs-title function_\">isCancel</span>(error)) {\n        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;&#x5df2;&#x53d6;&#x6d88;&#x7684;&#x91cd;&#x590d;&#x8bf7;&#x6c42;&#xff1a;&quot;</span> + error.<span class=\"hljs-property\">message</span>);\n      } <span class=\"hljs-keyword\">else</span> {\n        <span class=\"hljs-comment\">// &#x6dfb;&#x52a0;&#x5f02;&#x5e38;&#x5904;&#x7406;</span>\n      }\n      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">reject</span>(error);\n   }\n);\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"90,158"}}],"payload":{"tag":"h3","lines":"88,89"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
