<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"<a href=\"#nexttick\">#</a> nextTick","children":[{"content":"&#x8ba4;&#x8bc6;","children":[{"content":"<pre data-lines=\"6,7\"><code>`nextTick` &#x662f; Vue &#x7684;&#x4e00;&#x4e2a;&#x6838;&#x5fc3;&#x5b9e;&#x73b0;&#xff0c;&#x5728;&#x4ecb;&#x7ecd; Vue &#x7684; nextTick &#x4e4b;&#x524d;&#xff0c;&#x4e3a;&#x4e86;&#x65b9;&#x4fbf;&#x5927;&#x5bb6;&#x7406;&#x89e3;&#xff0c;&#x6211;&#x5148;&#x7b80;&#x5355;&#x4ecb;&#x7ecd;&#x4e00;&#x4e0b; JS &#x7684;&#x8fd0;&#x884c;&#x673a;&#x5236;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6,7"}}],"payload":{"tag":"h2","lines":"3,5"}},{"content":"<a href=\"#js-%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6\">#</a> JS &#x8fd0;&#x884c;&#x673a;&#x5236;","children":[{"content":"<pre data-lines=\"11,26\"><code>JS &#x6267;&#x884c;&#x662f;&#x5355;&#x7ebf;&#x7a0b;&#x7684;&#xff0c;&#x5b83;&#x662f;&#x57fa;&#x4e8e;&#x4e8b;&#x4ef6;&#x5faa;&#x73af;&#x7684;&#x3002;&#x4e8b;&#x4ef6;&#x5faa;&#x73af;&#x5927;&#x81f4;&#x5206;&#x4e3a;&#x4ee5;&#x4e0b;&#x51e0;&#x4e2a;&#x6b65;&#x9aa4;&#xff1a;\n\n&#xff08;1&#xff09;&#x6240;&#x6709;&#x540c;&#x6b65;&#x4efb;&#x52a1;&#x90fd;&#x5728;&#x4e3b;&#x7ebf;&#x7a0b;&#x4e0a;&#x6267;&#x884c;&#xff0c;&#x5f62;&#x6210;&#x4e00;&#x4e2a;&#x6267;&#x884c;&#x6808;&#xff08;execution context stack&#xff09;&#x3002;\n\n&#xff08;2&#xff09;&#x4e3b;&#x7ebf;&#x7a0b;&#x4e4b;&#x5916;&#xff0c;&#x8fd8;&#x5b58;&#x5728;&#x4e00;&#x4e2a;&quot;&#x4efb;&#x52a1;&#x961f;&#x5217;&quot;&#xff08;task queue&#xff09;&#x3002;&#x53ea;&#x8981;&#x5f02;&#x6b65;&#x4efb;&#x52a1;&#x6709;&#x4e86;&#x8fd0;&#x884c;&#x7ed3;&#x679c;&#xff0c;&#x5c31;&#x5728;&quot;&#x4efb;&#x52a1;&#x961f;&#x5217;&quot;&#x4e4b;&#x4e2d;&#x653e;&#x7f6e;&#x4e00;&#x4e2a;&#x4e8b;&#x4ef6;&#x3002;\n\n&#xff08;3&#xff09;&#x4e00;&#x65e6;&quot;&#x6267;&#x884c;&#x6808;&quot;&#x4e2d;&#x7684;&#x6240;&#x6709;&#x540c;&#x6b65;&#x4efb;&#x52a1;&#x6267;&#x884c;&#x5b8c;&#x6bd5;&#xff0c;&#x7cfb;&#x7edf;&#x5c31;&#x4f1a;&#x8bfb;&#x53d6;&quot;&#x4efb;&#x52a1;&#x961f;&#x5217;&quot;&#xff0c;&#x770b;&#x770b;&#x91cc;&#x9762;&#x6709;&#x54ea;&#x4e9b;&#x4e8b;&#x4ef6;&#x3002;&#x90a3;&#x4e9b;&#x5bf9;&#x5e94;&#x7684;&#x5f02;&#x6b65;&#x4efb;&#x52a1;&#xff0c;&#x4e8e;&#x662f;&#x7ed3;&#x675f;&#x7b49;&#x5f85;&#x72b6;&#x6001;&#xff0c;&#x8fdb;&#x5165;&#x6267;&#x884c;&#x6808;&#xff0c;&#x5f00;&#x59cb;&#x6267;&#x884c;&#x3002;\n\n&#xff08;4&#xff09;&#x4e3b;&#x7ebf;&#x7a0b;&#x4e0d;&#x65ad;&#x91cd;&#x590d;&#x4e0a;&#x9762;&#x7684;&#x7b2c;&#x4e09;&#x6b65;&#x3002;\n\n![](https://ustbhuangyi.github.io/vue-analysis/assets/event-loop.png)\n\n&#x4e3b;&#x7ebf;&#x7a0b;&#x7684;&#x6267;&#x884c;&#x8fc7;&#x7a0b;&#x5c31;&#x662f;&#x4e00;&#x4e2a; tick&#xff0c;&#x800c;&#x6240;&#x6709;&#x7684;&#x5f02;&#x6b65;&#x7ed3;&#x679c;&#x90fd;&#x662f;&#x901a;&#x8fc7; &#x201c;&#x4efb;&#x52a1;&#x961f;&#x5217;&#x201d; &#x6765;&#x8c03;&#x5ea6;&#x3002; &#x6d88;&#x606f;&#x961f;&#x5217;&#x4e2d;&#x5b58;&#x653e;&#x7684;&#x662f;&#x4e00;&#x4e2a;&#x4e2a;&#x7684;&#x4efb;&#x52a1;&#xff08;task&#xff09;&#x3002; &#x89c4;&#x8303;&#x4e2d;&#x89c4;&#x5b9a; task &#x5206;&#x4e3a;&#x4e24;&#x5927;&#x7c7b;&#xff0c;&#x5206;&#x522b;&#x662f; macro task &#x548c; micro task&#xff0c;&#x5e76;&#x4e14;&#x6bcf;&#x4e2a; macro task &#x7ed3;&#x675f;&#x540e;&#xff0c;&#x90fd;&#x8981;&#x6e05;&#x7a7a;&#x6240;&#x6709;&#x7684; micro task&#x3002;\n\n&#x5173;&#x4e8e; macro task &#x548c; micro task &#x7684;&#x6982;&#x5ff5;&#xff0c;&#x8fd9;&#x91cc;&#x4e0d;&#x4f1a;&#x7ec6;&#x8bb2;&#xff0c;&#x7b80;&#x5355;&#x901a;&#x8fc7;&#x4e00;&#x6bb5;&#x4ee3;&#x7801;&#x6f14;&#x793a;&#x4ed6;&#x4eec;&#x7684;&#x6267;&#x884c;&#x987a;&#x5e8f;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"11,26"}},{"content":"<pre data-lines=\"27,38\"><code data-lines=\"27,38\">for (macroTask of macroTaskQueue) {\n    <span class=\"hljs-comment\">// 1. Handle current MACRO-TASK</span>\n    <span class=\"hljs-built_in\">handleMacroTask</span>();\n      \n    <span class=\"hljs-comment\">// 2. Handle all MICRO-TASK</span>\n    for (microTask of microTaskQueue) {\n        <span class=\"hljs-built_in\">handleMicroTask</span>(microTask);\n    }\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"27,38"}},{"content":"<pre data-lines=\"39,40\"><code>&#x5728;&#x6d4f;&#x89c8;&#x5668;&#x73af;&#x5883;&#x4e2d;&#xff0c;&#x5e38;&#x89c1;&#x7684; macro task &#x6709; setTimeout&#x3001;MessageChannel&#x3001;postMessage&#x3001;setImmediate&#xff1b;&#x5e38;&#x89c1;&#x7684; micro task &#x6709; MutationObsever &#x548c; Promise.then&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"39,40"}}],"payload":{"tag":"h2","lines":"8,10"}},{"content":"<a href=\"#vue-%E7%9A%84%E5%AE%9E%E7%8E%B0\">#</a> Vue &#x7684;&#x5b9e;&#x73b0;","children":[{"content":"<pre data-lines=\"44,45\"><code>&#x5728; Vue &#x6e90;&#x7801; 2.5+ &#x540e;&#xff0c;`nextTick` &#x7684;&#x5b9e;&#x73b0;&#x5355;&#x72ec;&#x6709;&#x4e00;&#x4e2a; JS &#x6587;&#x4ef6;&#x6765;&#x7ef4;&#x62a4;&#x5b83;&#xff0c;&#x5b83;&#x7684;&#x6e90;&#x7801;&#x5e76;&#x4e0d;&#x591a;&#xff0c;&#x603b;&#x5171;&#x4e5f;&#x5c31; 100 &#x591a;&#x884c;&#x3002;&#x63a5;&#x4e0b;&#x6765;&#x6211;&#x4eec;&#x6765;&#x770b;&#x4e00;&#x4e0b;&#x5b83;&#x7684;&#x5b9e;&#x73b0;&#xff0c;&#x5728; `src/core/util/next-tick.js` &#x4e2d;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"44,45"}},{"content":"<pre data-lines=\"46,162\"><code data-lines=\"46,162\"><span class=\"hljs-keyword\">import</span> { noop } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;shared/util&apos;</span>\n<span class=\"hljs-keyword\">import</span> { handleError } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;./error&apos;</span>\n<span class=\"hljs-keyword\">import</span> { isIOS, isNative } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;./env&apos;</span>\n\n<span class=\"hljs-keyword\">const</span> callbacks = []\n<span class=\"hljs-keyword\">let</span> pending = <span class=\"hljs-literal\">false</span>\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">flushCallbacks</span> (<span class=\"hljs-params\"></span>) {\n  pending = <span class=\"hljs-literal\">false</span>\n  <span class=\"hljs-keyword\">const</span> copies = callbacks.<span class=\"hljs-title function_\">slice</span>(<span class=\"hljs-number\">0</span>)\n  callbacks.<span class=\"hljs-property\">length</span> = <span class=\"hljs-number\">0</span>\n  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; copies.<span class=\"hljs-property\">length</span>; i++) {\n    copies[i]()\n  }\n}\n\n<span class=\"hljs-comment\">// Here we have async deferring wrappers using both microtasks and (macro) tasks.</span>\n<span class=\"hljs-comment\">// In &lt; 2.4 we used microtasks everywhere, but there are some scenarios where</span>\n<span class=\"hljs-comment\">// microtasks have too high a priority and fire in between supposedly</span>\n<span class=\"hljs-comment\">// sequential events (e.g. #4521, #6690) or even between bubbling of the same</span>\n<span class=\"hljs-comment\">// event (#6566). However, using (macro) tasks everywhere also has subtle problems</span>\n<span class=\"hljs-comment\">// when state is changed right before repaint (e.g. #6813, out-in transitions).</span>\n<span class=\"hljs-comment\">// Here we use microtask by default, but expose a way to force (macro) task when</span>\n<span class=\"hljs-comment\">// needed (e.g. in event handlers attached by v-on).</span>\n<span class=\"hljs-keyword\">let</span> microTimerFunc\n<span class=\"hljs-keyword\">let</span> macroTimerFunc\n<span class=\"hljs-keyword\">let</span> useMacroTask = <span class=\"hljs-literal\">false</span>\n\n<span class=\"hljs-comment\">// Determine (macro) task defer implementation.</span>\n<span class=\"hljs-comment\">// Technically setImmediate should be the ideal choice, but it&apos;s only available</span>\n<span class=\"hljs-comment\">// in IE. The only polyfill that consistently queues the callback after all DOM</span>\n<span class=\"hljs-comment\">// events triggered in the same loop is by using MessageChannel.</span>\n<span class=\"hljs-comment\">/* istanbul ignore if */</span>\n<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> setImmediate !== <span class=\"hljs-string\">&apos;undefined&apos;</span> &amp;&amp; <span class=\"hljs-title function_\">isNative</span>(setImmediate)) {\n  macroTimerFunc = <span class=\"hljs-function\">() =&gt;</span> {\n    <span class=\"hljs-title function_\">setImmediate</span>(flushCallbacks)\n  }\n} <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-title class_\">MessageChannel</span> !== <span class=\"hljs-string\">&apos;undefined&apos;</span> &amp;&amp; (\n  <span class=\"hljs-title function_\">isNative</span>(<span class=\"hljs-title class_\">MessageChannel</span>) ||\n  <span class=\"hljs-comment\">// PhantomJS</span>\n  <span class=\"hljs-title class_\">MessageChannel</span>.<span class=\"hljs-title function_\">toString</span>() === <span class=\"hljs-string\">&apos;[object MessageChannelConstructor]&apos;</span>\n)) {\n  <span class=\"hljs-keyword\">const</span> channel = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MessageChannel</span>()\n  <span class=\"hljs-keyword\">const</span> port = channel.<span class=\"hljs-property\">port2</span>\n  channel.<span class=\"hljs-property\">port1</span>.<span class=\"hljs-property\">onmessage</span> = flushCallbacks\n  macroTimerFunc = <span class=\"hljs-function\">() =&gt;</span> {\n    port.<span class=\"hljs-title function_\">postMessage</span>(<span class=\"hljs-number\">1</span>)\n  }\n} <span class=\"hljs-keyword\">else</span> {\n  <span class=\"hljs-comment\">/* istanbul ignore next */</span>\n  macroTimerFunc = <span class=\"hljs-function\">() =&gt;</span> {\n    <span class=\"hljs-built_in\">setTimeout</span>(flushCallbacks, <span class=\"hljs-number\">0</span>)\n  }\n}\n\n<span class=\"hljs-comment\">// Determine microtask defer implementation.</span>\n<span class=\"hljs-comment\">/* istanbul ignore next, &#x24;flow-disable-line */</span>\n<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-title class_\">Promise</span> !== <span class=\"hljs-string\">&apos;undefined&apos;</span> &amp;&amp; <span class=\"hljs-title function_\">isNative</span>(<span class=\"hljs-title class_\">Promise</span>)) {\n  <span class=\"hljs-keyword\">const</span> p = <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">resolve</span>()\n  microTimerFunc = <span class=\"hljs-function\">() =&gt;</span> {\n    p.<span class=\"hljs-title function_\">then</span>(flushCallbacks)\n    <span class=\"hljs-comment\">// in problematic UIWebViews, Promise.then doesn&apos;t completely break, but</span>\n    <span class=\"hljs-comment\">// it can get stuck in a weird state where callbacks are pushed into the</span>\n    <span class=\"hljs-comment\">// microtask queue but the queue isn&apos;t being flushed, until the browser</span>\n    <span class=\"hljs-comment\">// needs to do some other work, e.g. handle a timer. Therefore we can</span>\n    <span class=\"hljs-comment\">// &quot;force&quot; the microtask queue to be flushed by adding an empty timer.</span>\n    <span class=\"hljs-keyword\">if</span> (isIOS) <span class=\"hljs-built_in\">setTimeout</span>(noop)\n  }\n} <span class=\"hljs-keyword\">else</span> {\n  <span class=\"hljs-comment\">// fallback to macro</span>\n  microTimerFunc = macroTimerFunc\n}\n\n<span class=\"hljs-comment\">/**\n * Wrap a function so that if any code inside triggers state change,\n * the changes are queued using a (macro) task instead of a microtask.\n */</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">withMacroTask</span> (<span class=\"hljs-params\">fn: <span class=\"hljs-built_in\">Function</span></span>): <span class=\"hljs-title class_\">Function</span> {\n  <span class=\"hljs-keyword\">return</span> fn.<span class=\"hljs-property\">_withTask</span> || (fn.<span class=\"hljs-property\">_withTask</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) {\n    useMacroTask = <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-keyword\">const</span> res = fn.<span class=\"hljs-title function_\">apply</span>(<span class=\"hljs-literal\">null</span>, <span class=\"hljs-variable language_\">arguments</span>)\n    useMacroTask = <span class=\"hljs-literal\">false</span>\n    <span class=\"hljs-keyword\">return</span> res\n  })\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">nextTick</span> (<span class=\"hljs-params\">cb?: <span class=\"hljs-built_in\">Function</span>, ctx?: <span class=\"hljs-built_in\">Object</span></span>) {\n  <span class=\"hljs-keyword\">let</span> _resolve\n  callbacks.<span class=\"hljs-title function_\">push</span>(<span class=\"hljs-function\">() =&gt;</span> {\n    <span class=\"hljs-keyword\">if</span> (cb) {\n      <span class=\"hljs-keyword\">try</span> {\n        cb.<span class=\"hljs-title function_\">call</span>(ctx)\n      } <span class=\"hljs-keyword\">catch</span> (e) {\n        <span class=\"hljs-title function_\">handleError</span>(e, ctx, <span class=\"hljs-string\">&apos;nextTick&apos;</span>)\n      }\n    } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (_resolve) {\n      <span class=\"hljs-title function_\">_resolve</span>(ctx)\n    }\n  })\n  <span class=\"hljs-keyword\">if</span> (!pending) {\n    pending = <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-keyword\">if</span> (useMacroTask) {\n      <span class=\"hljs-title function_\">macroTimerFunc</span>()\n    } <span class=\"hljs-keyword\">else</span> {\n      <span class=\"hljs-title function_\">microTimerFunc</span>()\n    }\n  }\n  <span class=\"hljs-comment\">// &#x24;flow-disable-line</span>\n  <span class=\"hljs-keyword\">if</span> (!cb &amp;&amp; <span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-title class_\">Promise</span> !== <span class=\"hljs-string\">&apos;undefined&apos;</span>) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">resolve</span> =&gt;</span> {\n      _resolve = resolve\n    })\n  }\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"46,162"}},{"content":"<pre data-lines=\"163,170\"><code>`next-tick.js` &#x7533;&#x660e;&#x4e86; `microTimerFunc` &#x548c; `macroTimerFunc` 2 &#x4e2a;&#x53d8;&#x91cf;&#xff0c;&#x5b83;&#x4eec;&#x5206;&#x522b;&#x5bf9;&#x5e94;&#x7684;&#x662f; micro task &#x7684;&#x51fd;&#x6570;&#x548c; macro task &#x7684;&#x51fd;&#x6570;&#x3002;&#x5bf9;&#x4e8e; macro task &#x7684;&#x5b9e;&#x73b0;&#xff0c;&#x4f18;&#x5148;&#x68c0;&#x6d4b;&#x662f;&#x5426;&#x652f;&#x6301;&#x539f;&#x751f; `setImmediate`&#xff0c;&#x8fd9;&#x662f;&#x4e00;&#x4e2a;&#x9ad8;&#x7248;&#x672c; IE &#x548c; Edge &#x624d;&#x652f;&#x6301;&#x7684;&#x7279;&#x6027;&#xff0c;&#x4e0d;&#x652f;&#x6301;&#x7684;&#x8bdd;&#x518d;&#x53bb;&#x68c0;&#x6d4b;&#x662f;&#x5426;&#x652f;&#x6301;&#x539f;&#x751f;&#x7684; `MessageChannel`&#xff0c;&#x5982;&#x679c;&#x4e5f;&#x4e0d;&#x652f;&#x6301;&#x7684;&#x8bdd;&#x5c31;&#x4f1a;&#x964d;&#x7ea7;&#x4e3a; `setTimeout 0`&#xff1b;&#x800c;&#x5bf9;&#x4e8e; micro task &#x7684;&#x5b9e;&#x73b0;&#xff0c;&#x5219;&#x68c0;&#x6d4b;&#x6d4f;&#x89c8;&#x5668;&#x662f;&#x5426;&#x539f;&#x751f;&#x652f;&#x6301; Promise&#xff0c;&#x4e0d;&#x652f;&#x6301;&#x7684;&#x8bdd;&#x76f4;&#x63a5;&#x6307;&#x5411; macro task &#x7684;&#x5b9e;&#x73b0;&#x3002;\n\n`next-tick.js` &#x5bf9;&#x5916;&#x66b4;&#x9732;&#x4e86; 2 &#x4e2a;&#x51fd;&#x6570;&#xff0c;&#x5148;&#x6765;&#x770b; `nextTick`&#xff0c;&#x8fd9;&#x5c31;&#x662f;&#x6211;&#x4eec;&#x5728;&#x4e0a;&#x4e00;&#x8282;&#x6267;&#x884c; `nextTick(flushSchedulerQueue)` &#x6240;&#x7528;&#x5230;&#x7684;&#x51fd;&#x6570;&#x3002;&#x5b83;&#x7684;&#x903b;&#x8f91;&#x4e5f;&#x5f88;&#x7b80;&#x5355;&#xff0c;&#x628a;&#x4f20;&#x5165;&#x7684;&#x56de;&#x8c03;&#x51fd;&#x6570; `cb` &#x538b;&#x5165; `callbacks` &#x6570;&#x7ec4;&#xff0c;&#x6700;&#x540e;&#x4e00;&#x6b21;&#x6027;&#x5730;&#x6839;&#x636e; `useMacroTask` &#x6761;&#x4ef6;&#x6267;&#x884c; `macroTimerFunc` &#x6216;&#x8005;&#x662f; `microTimerFunc`&#xff0c;&#x800c;&#x5b83;&#x4eec;&#x90fd;&#x4f1a;&#x5728;&#x4e0b;&#x4e00;&#x4e2a; tick &#x6267;&#x884c; `flushCallbacks`&#xff0c;`flushCallbacks` &#x7684;&#x903b;&#x8f91;&#x975e;&#x5e38;&#x7b80;&#x5355;&#xff0c;&#x5bf9; `callbacks` &#x904d;&#x5386;&#xff0c;&#x7136;&#x540e;&#x6267;&#x884c;&#x76f8;&#x5e94;&#x7684;&#x56de;&#x8c03;&#x51fd;&#x6570;&#x3002;\n\n&#x8fd9;&#x91cc;&#x4f7f;&#x7528; `callbacks` &#x800c;&#x4e0d;&#x662f;&#x76f4;&#x63a5;&#x5728; `nextTick` &#x4e2d;&#x6267;&#x884c;&#x56de;&#x8c03;&#x51fd;&#x6570;&#x7684;&#x539f;&#x56e0;&#x662f;&#x4fdd;&#x8bc1;&#x5728;&#x540c;&#x4e00;&#x4e2a; tick &#x5185;&#x591a;&#x6b21;&#x6267;&#x884c; `nextTick`&#xff0c;&#x4e0d;&#x4f1a;&#x5f00;&#x542f;&#x591a;&#x4e2a;&#x5f02;&#x6b65;&#x4efb;&#x52a1;&#xff0c;&#x800c;&#x628a;&#x8fd9;&#x4e9b;&#x5f02;&#x6b65;&#x4efb;&#x52a1;&#x90fd;&#x538b;&#x6210;&#x4e00;&#x4e2a;&#x540c;&#x6b65;&#x4efb;&#x52a1;&#xff0c;&#x5728;&#x4e0b;&#x4e00;&#x4e2a; tick &#x6267;&#x884c;&#x5b8c;&#x6bd5;&#x3002;\n\n`nextTick` &#x51fd;&#x6570;&#x6700;&#x540e;&#x8fd8;&#x6709;&#x4e00;&#x6bb5;&#x903b;&#x8f91;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"163,170"}},{"content":"<pre data-lines=\"171,178\"><code data-lines=\"171,178\"> <span class=\"hljs-keyword\">if</span> (!cb &amp;&amp; <span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-title class_\">Promise</span> !== <span class=\"hljs-string\">&apos;undefined&apos;</span>) {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-params\">resolve</span> =&gt;</span> {\n    _resolve = resolve\n  })\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"171,178"}},{"content":"<pre data-lines=\"179,180\"><code>&#x8fd9;&#x662f;&#x5f53; `nextTick` &#x4e0d;&#x4f20; `cb` &#x53c2;&#x6570;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x63d0;&#x4f9b;&#x4e00;&#x4e2a; Promise &#x5316;&#x7684;&#x8c03;&#x7528;&#xff0c;&#x6bd4;&#x5982;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"179,180"}},{"content":"<pre data-lines=\"181,184\"><code data-lines=\"181,184\"><span class=\"hljs-function\"><span class=\"hljs-title\">nextTick</span><span class=\"hljs-params\">()</span></span><span class=\"hljs-selector-class\">.then</span>(() =&gt; {}) \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"181,184"}},{"content":"<pre data-lines=\"185,188\"><code>&#x5f53; `_resolve` &#x51fd;&#x6570;&#x6267;&#x884c;&#xff0c;&#x5c31;&#x4f1a;&#x8df3;&#x5230; `then` &#x7684;&#x903b;&#x8f91;&#x4e2d;&#x3002;\n\n`next-tick.js` &#x8fd8;&#x5bf9;&#x5916;&#x66b4;&#x9732;&#x4e86; `withMacroTask` &#x51fd;&#x6570;&#xff0c;&#x5b83;&#x662f;&#x5bf9;&#x51fd;&#x6570;&#x505a;&#x4e00;&#x5c42;&#x5305;&#x88c5;&#xff0c;&#x786e;&#x4fdd;&#x51fd;&#x6570;&#x6267;&#x884c;&#x8fc7;&#x7a0b;&#x4e2d;&#x5bf9;&#x6570;&#x636e;&#x4efb;&#x610f;&#x7684;&#x4fee;&#x6539;&#xff0c;&#x89e6;&#x53d1;&#x53d8;&#x5316;&#x6267;&#x884c; `nextTick` &#x7684;&#x65f6;&#x5019;&#x5f3a;&#x5236;&#x8d70; `macroTimerFunc`&#x3002;&#x6bd4;&#x5982;&#x5bf9;&#x4e8e;&#x4e00;&#x4e9b; DOM &#x4ea4;&#x4e92;&#x4e8b;&#x4ef6;&#xff0c;&#x5982; `v-on` &#x7ed1;&#x5b9a;&#x7684;&#x4e8b;&#x4ef6;&#x56de;&#x8c03;&#x51fd;&#x6570;&#x7684;&#x5904;&#x7406;&#xff0c;&#x4f1a;&#x5f3a;&#x5236;&#x8d70; macro task&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"185,188"}}],"payload":{"tag":"h2","lines":"41,43"}},{"content":"<a href=\"#%E6%80%BB%E7%BB%93\">#</a> &#x603b;&#x7ed3;","children":[{"content":"<pre data-lines=\"192,193\"><code>&#x901a;&#x8fc7;&#x8fd9;&#x4e00;&#x8282;&#x5bf9; `nextTick` &#x7684;&#x5206;&#x6790;&#xff0c;&#x5e76;&#x7ed3;&#x5408;&#x4e0a;&#x4e00;&#x8282;&#x7684; setter &#x5206;&#x6790;&#xff0c;&#x6211;&#x4eec;&#x4e86;&#x89e3;&#x5230;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#x5230; DOM &#x7684;&#x91cd;&#x65b0;&#x6e32;&#x67d3;&#x662f;&#x4e00;&#x4e2a;&#x5f02;&#x6b65;&#x8fc7;&#x7a0b;&#xff0c;&#x53d1;&#x751f;&#x5728;&#x4e0b;&#x4e00;&#x4e2a; tick&#x3002;&#x8fd9;&#x5c31;&#x662f;&#x6211;&#x4eec;&#x5e73;&#x65f6;&#x5728;&#x5f00;&#x53d1;&#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x6bd4;&#x5982;&#x4ece;&#x670d;&#x52a1;&#x7aef;&#x63a5;&#x53e3;&#x53bb;&#x83b7;&#x53d6;&#x6570;&#x636e;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x6570;&#x636e;&#x505a;&#x4e86;&#x4fee;&#x6539;&#xff0c;&#x5982;&#x679c;&#x6211;&#x4eec;&#x7684;&#x67d0;&#x4e9b;&#x65b9;&#x6cd5;&#x53bb;&#x4f9d;&#x8d56;&#x4e86;&#x6570;&#x636e;&#x4fee;&#x6539;&#x540e;&#x7684; DOM &#x53d8;&#x5316;&#xff0c;&#x6211;&#x4eec;&#x5c31;&#x5fc5;&#x987b;&#x5728; `nextTick` &#x540e;&#x6267;&#x884c;&#x3002;&#x6bd4;&#x5982;&#x4e0b;&#x9762;&#x7684;&#x4f2a;&#x4ee3;&#x7801;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"192,193"}},{"content":"<pre data-lines=\"194,202\"><code data-lines=\"194,202\"><span class=\"hljs-function\"><span class=\"hljs-title\">getData</span><span class=\"hljs-params\">(res)</span></span><span class=\"hljs-selector-class\">.then</span>(()=&gt;{\n  this<span class=\"hljs-selector-class\">.xxx</span> = res<span class=\"hljs-selector-class\">.data</span>\n  this.<span class=\"hljs-variable\">&#x24;nextTick</span>(() =&gt; {\n    <span class=\"hljs-comment\">// &#x8fd9;&#x91cc;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x83b7;&#x53d6;&#x53d8;&#x5316;&#x540e;&#x7684; DOM</span>\n  })\n}) \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"194,202"}},{"content":"<pre data-lines=\"203,204\"><code>Vue.js &#x63d0;&#x4f9b;&#x4e86; 2 &#x79cd;&#x8c03;&#x7528; `nextTick` &#x7684;&#x65b9;&#x5f0f;&#xff0c;&#x4e00;&#x79cd;&#x662f;&#x5168;&#x5c40; API `Vue.nextTick`&#xff0c;&#x4e00;&#x79cd;&#x662f;&#x5b9e;&#x4f8b;&#x4e0a;&#x7684;&#x65b9;&#x6cd5; `vm.&#x24;nextTick`&#xff0c;&#x65e0;&#x8bba;&#x6211;&#x4eec;&#x4f7f;&#x7528;&#x54ea;&#x4e00;&#x79cd;&#xff0c;&#x6700;&#x540e;&#x90fd;&#x662f;&#x8c03;&#x7528; `next-tick.js` &#x4e2d;&#x5b9e;&#x73b0;&#x7684; `nextTick` &#x65b9;&#x6cd5;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"203,204"}}],"payload":{"tag":"h2","lines":"189,191"}}],"payload":{"tag":"h1","lines":"0,2"}},{})</script>
</body>
</html>
