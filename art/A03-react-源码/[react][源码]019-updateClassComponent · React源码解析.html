<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"updateClassComponent","children":[{"content":"<pre data-lines=\"2,77\"><code data-lines=\"2,77\">function updateClassComponent(\n<span class=\"hljs-title\">  current:</span> Fiber | null,\n<span class=\"hljs-title\">  workInProgress:</span> Fiber,\n<span class=\"hljs-title\">  Component:</span> any,\n<span class=\"hljs-built_in\">  nextProps,</span>\n<span class=\"hljs-title\">  renderExpirationTime:</span> ExpirationTime,\n) {\n  \n  \n  \n  let hasContext\n  if (isLegacyContextProvider(Component)) {\n    hasContext = <span class=\"hljs-literal\">true</span>\n    pushLegacyContextProvider(workInProgress)\n  } else {\n    hasContext = <span class=\"hljs-literal\">false</span>\n  }\n  prepareToReadContext(workInProgress, renderExpirationTime)\n\n  const instance = workInProgress.stateNode\n  let shouldUpdate\n  if (instance === null) {\n    if (current !== null) {\n      \n      \n      \n      \n      current.alternate = null\n      workInProgress.alternate = null\n      \n      workInProgress.effectTag |= Placement\n    }\n    \n    constructClassInstance(\n<span class=\"hljs-built_in\">      workInProgress,</span>\n<span class=\"hljs-built_in\">      Component,</span>\n<span class=\"hljs-built_in\">      nextProps,</span>\n<span class=\"hljs-built_in\">      renderExpirationTime,</span>\n    )\n    mountClassInstance(\n<span class=\"hljs-built_in\">      workInProgress,</span>\n<span class=\"hljs-built_in\">      Component,</span>\n<span class=\"hljs-built_in\">      nextProps,</span>\n<span class=\"hljs-built_in\">      renderExpirationTime,</span>\n    )\n    shouldUpdate = <span class=\"hljs-literal\">true</span>\n  } else if (current === null) {\n    \n    shouldUpdate = resumeMountClassInstance(\n<span class=\"hljs-built_in\">      workInProgress,</span>\n<span class=\"hljs-built_in\">      Component,</span>\n<span class=\"hljs-built_in\">      nextProps,</span>\n<span class=\"hljs-built_in\">      renderExpirationTime,</span>\n    )\n  } else {\n    shouldUpdate = updateClassInstance(\n<span class=\"hljs-built_in\">      current,</span>\n<span class=\"hljs-built_in\">      workInProgress,</span>\n<span class=\"hljs-built_in\">      Component,</span>\n<span class=\"hljs-built_in\">      nextProps,</span>\n<span class=\"hljs-built_in\">      renderExpirationTime,</span>\n    )\n  }\n  <span class=\"hljs-keyword\">return</span> finishClassComponent(\n<span class=\"hljs-built_in\">    current,</span>\n<span class=\"hljs-built_in\">    workInProgress,</span>\n<span class=\"hljs-built_in\">    Component,</span>\n<span class=\"hljs-built_in\">    shouldUpdate,</span>\n<span class=\"hljs-built_in\">    hasContext,</span>\n<span class=\"hljs-built_in\">    renderExpirationTime,</span>\n  )\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2,77"}},{"content":"<pre data-lines=\"78,79\"><code>&#x9996;&#x5148;&#x6839;&#x636e;`workInProcess.type`&#x83b7;&#x53d6;`class`&#xff0c;&#x7136;&#x540e;&#x6784;&#x5efa;`instance`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"78,79"}},{"content":"<pre data-lines=\"80,92\"><code data-lines=\"80,92\">function adoptClassInstance(workInProgress, instance) {\n  instance.updater = classComponentUpdater\n  workInProgress.stateNode =<span class=\"hljs-built_in\"> instance\n</span>  \n  set(instance, workInProgress)\n  {\n    instance._reactInternalInstance = fakeInternalInstance\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"80,92"}},{"content":"<pre data-lines=\"93,94\"><code>&#x8fd9;&#x4e2a;&#x65b9;&#x6cd5;&#x7ed9; ClassComponent &#x7684;&#x5b9e;&#x4f8b;&#x6302;&#x8f7d;&#x4e00;&#x4e2a;`updater`&#x5bf9;&#x8c61;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"93,94"}},{"content":"<pre data-lines=\"95,104\"><code data-lines=\"95,104\">{\n  enqueueForceUpdate: <span class=\"hljs-keyword\">func</span>,\n  enqueueReplaceState: <span class=\"hljs-keyword\">func</span>,\n  enqueueSetState: <span class=\"hljs-keyword\">func</span>,\n  isMounted: <span class=\"hljs-keyword\">func</span>\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"95,104"}},{"content":"<pre data-lines=\"105,106\"><code>&#x5f88;&#x719f;&#x6089;&#x5bf9;&#x4e0d;&#x5bf9;&#xff0c;&#x8fd9;&#x51e0;&#x4e2a;&#x65b9;&#x6cd5;&#x5c31;&#x5bf9;&#x5e94;&#x6211;&#x4eec;&#x5e73;&#x65f6;&#x8c03;&#x7528;&#x7684;`forceUpdate, replaceState, setState`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"105,106"}},{"content":"<pre data-lines=\"107,113\"><code data-lines=\"107,113\">function <span class=\"hljs-built_in\">set</span>(<span class=\"hljs-built_in\">key</span>, value) {\n  <span class=\"hljs-built_in\">key</span>._reactInternalFiber = value\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"107,113"}},{"content":"<pre data-lines=\"114,117\"><code>&#x8fd9;&#x91cc;&#x7ed9; instance &#x7684;`_reactInternalFiber`&#x6302;&#x8f7d;&#x4e0a;`workInProgress`&#xff0c;&#x6240;&#x4ee5;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;`this._reactInternalFiber`&#x83b7;&#x53d6;&#x8be5;&#x5b9e;&#x4f8b;&#x5bf9;&#x5e94;&#x7684;`Fiber`&#x5bf9;&#x8c61;\n\n&#x5173;&#x4e8e;`Context`&#x770b;[&#x8fd9;&#x91cc;](https://react.jokcy.me/book/basic/context.html)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"114,117"}},{"content":"<pre data-lines=\"118,156\"><code data-lines=\"118,156\">function constructClassInstance(\n  workInProgress: Fiber,\n  ctor: <span class=\"hljs-literal\">any</span>,\n  props: <span class=\"hljs-literal\">any</span>,\n  renderExpirationTime: ExpirationTime,\n): <span class=\"hljs-literal\">any</span> {\n  <span class=\"hljs-keyword\">const</span> unmaskedContext = getUnmaskedContext(workInProgress, ctor, true)\n  <span class=\"hljs-keyword\">const</span> contextTypes = ctor.contextTypes\n  <span class=\"hljs-keyword\">const</span> isContextConsumer = contextTypes !== null &amp;&amp; contextTypes !== undefined\n  <span class=\"hljs-keyword\">const</span> context = isContextConsumer\n    ? getMaskedContext(workInProgress, unmaskedContext)\n    : emptyContextObject\n\n  <span class=\"hljs-keyword\">const</span> instance = new ctor(props, context)\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">state</span> = (workInProgress.memoizedState =\n    instance.<span class=\"hljs-keyword\">state</span> !== null &amp;&amp; instance.<span class=\"hljs-keyword\">state</span> !== undefined\n      ? instance.<span class=\"hljs-keyword\">state</span>\n      : null)\n  adoptClassInstance(workInProgress, instance)\n\n  \n\n  if (isContextConsumer) {\n    cacheContext(workInProgress, unmaskedContext, context)\n  }\n\n  return instance\n}\n\nfunction adoptClassInstance(workInProgress: Fiber, instance: <span class=\"hljs-literal\">any</span>): void {\n  instance.updater = classComponentUpdater\n  workInProgress.<span class=\"hljs-keyword\">state</span>Node = instance\n  \n  ReactInstanceMap.<span class=\"hljs-built_in\">set</span>(instance, workInProgress)\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"118,156"}},{"content":"<pre data-lines=\"157,162\"><code>&#x521d;&#x59cb;&#x5316; props&#x3001;state &#x7b49;&#x5b9e;&#x4f8b;&#x5c5e;&#x6027;&#xff0c;&#x5982;&#x679c;&#x6709;`updateQueue`&#x5c31;&#x66f4;&#x65b0;&#x4e4b;&#xff0c;&#x4e00;&#x822c;&#x6765;&#x8bf4;&#x7b2c;&#x4e00;&#x6b21;&#x6e32;&#x67d3;&#x662f;&#x6ca1;&#x6709;&#x7684;&#x3002;\n\n`processUpdateQueue`&#x7528;&#x6765;&#x8ba1;&#x7b97;&#x65b0;&#x7684;`state`&#xff0c;&#x8be6;&#x89c1;[&#x8fd9;&#x91cc;](https://react.jokcy.me/docs/depth-analysis/process-update-queue.html)\n\nTODO: updateQueue\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"157,162"}},{"content":"<pre data-lines=\"163,171\"><code data-lines=\"163,171\">var getDerivedStateFromProps = workInProgress.type.getDerivedStateFromProps\nif (typeof getDerivedStateFromProps === &apos;function&apos;) {\n  applyDerivedStateFromProps(workInProgress, getDerivedStateFromProps, props)\n  instance.<span class=\"hljs-keyword\">state</span> = workInProgress.memoizedState\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"163,171"}},{"content":"<pre data-lines=\"172,177\"><code>&#x5982;&#x679c; class &#x6709;&#x58f0;&#x660e;`getDerivedStateFromProps`&#xff0c;&#x5c31;&#x8c03;&#x7528;&#x4ed6;&#xff0c;&#x8c03;&#x7528;&#x8be5;&#x65b9;&#x6cd5;&#x4e4b;&#x540e;&#x4f1a;&#x6839;&#x636e;&#x7ed3;&#x679c;&#x66f4;&#x65b0;`workInProgress.memoizedState`&#xff0c;&#x6240;&#x4ee5;&#x8981;&#x91cd;&#x65b0;&#x8d4b;&#x503c;&#x7ed9;`instance.state`\n\n&#x63a5;&#x4e0b;&#x53bb;&#x5224;&#x65ad;&#x4e00;&#x4e0b;&#x662f;&#x5426;&#x6ca1;&#x6709;&#x65b0;&#x7684;&#x751f;&#x547d;&#x5468;&#x671f;&#x65b9;&#x6cd5;&#xff0c;&#x5982;&#x679c;&#x6ca1;&#x6709;&#x5e76;&#x4e14;&#x6709;`componentWillMount`&#x751f;&#x547d;&#x5468;&#x671f;&#x65b9;&#x6cd5;&#xff0c;&#x5219;&#x8c03;&#x7528;&#x4ed6;&#x3002;\n\n&#x6700;&#x540e;&#x5224;&#x65ad;&#x662f;&#x5426;&#x6709;`componentDidMount`&#xff0c;&#x5982;&#x679c;&#x6709;&#x5c31;&#x4fee;&#x6539;`workInProgress.effectTag |= Update`&#xff0c;&#x56e0;&#x4e3a;`componentDidMount`&#x8981;&#x5728;&#x771f;&#x6b63;&#x6e32;&#x67d3;&#x8fdb;`DOM`&#x4e4b;&#x540e;&#x624d;&#x8c03;&#x7528;&#xff0c;&#x4e5f;&#x5c31;&#x662f;`commit`&#x4e4b;&#x540e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"172,177"}},{"content":"<pre data-lines=\"178,248\"><code data-lines=\"178,248\">function mountClassInstance(\n  workInProgress: Fiber,\n  ctor: <span class=\"hljs-literal\">any</span>,\n  newProps: <span class=\"hljs-literal\">any</span>,\n  renderExpirationTime: ExpirationTime,\n): void {\n  if (__DEV__) {\n    checkClassInstance(workInProgress, ctor, newProps)\n  }\n\n  <span class=\"hljs-keyword\">const</span> instance = workInProgress.<span class=\"hljs-keyword\">state</span>Node\n  <span class=\"hljs-keyword\">const</span> unmaskedContext = getUnmaskedContext(workInProgress, ctor, true)\n\n  instance.props = newProps\n  instance.<span class=\"hljs-keyword\">state</span> = workInProgress.memoizedState\n  instance.refs = emptyRefsObject\n  instance.context = getMaskedContext(workInProgress, unmaskedContext)\n\n  let updateQueue = workInProgress.updateQueue\n  if (updateQueue !== null) {\n    processUpdateQueue(\n      workInProgress,\n      updateQueue,\n      newProps,\n      instance,\n      renderExpirationTime,\n    )\n    instance.<span class=\"hljs-keyword\">state</span> = workInProgress.memoizedState\n  }\n\n  <span class=\"hljs-keyword\">const</span> getDerivedStateFromProps = ctor.getDerivedStateFromProps\n  if (typeof getDerivedStateFromProps === &apos;function&apos;) {\n    applyDerivedStateFromProps(\n      workInProgress,\n      ctor,\n      getDerivedStateFromProps,\n      newProps,\n    )\n    instance.<span class=\"hljs-keyword\">state</span> = workInProgress.memoizedState\n  }\n\n  if (\n    typeof ctor.getDerivedStateFromProps !== &apos;function&apos; &amp;&amp;\n    typeof instance.getSnapshotBeforeUpdate !== &apos;function&apos; &amp;&amp;\n    (typeof instance.UNSAFE_componentWillMount === &apos;function&apos; ||\n      typeof instance.componentWillMount === &apos;function&apos;)\n  ) {\n    callComponentWillMount(workInProgress, instance)\n    \n    \n    updateQueue = workInProgress.updateQueue\n    if (updateQueue !== null) {\n      processUpdateQueue(\n        workInProgress,\n        updateQueue,\n        newProps,\n        instance,\n        renderExpirationTime,\n      )\n      instance.<span class=\"hljs-keyword\">state</span> = workInProgress.memoizedState\n    }\n  }\n\n  if (typeof instance.componentDidMount === &apos;function&apos;) {\n    workInProgress.effectTag |= Update\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"178,248"}},{"content":"<pre data-lines=\"249,250\"><code>&#x8c03;&#x7528;`getDerivedStateFromProps`&#x83b7;&#x5f97;&#x6700;&#x65b0;&#x7684;`state`&#x5e76;&#x653e;&#x5230;`fiber.memoizedState`&#x4e0a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"249,250"}},{"content":"<pre data-lines=\"251,277\"><code data-lines=\"251,277\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">applyDerivedStateFromProps</span>(<span class=\"hljs-params\">\n  <span class=\"hljs-attr\">workInProgress</span>: <span class=\"hljs-title class_\">Fiber</span>,\n  <span class=\"hljs-attr\">getDerivedStateFromProps</span>: (props: <span class=\"hljs-built_in\">any</span>, state: <span class=\"hljs-built_in\">any</span>) =&gt; <span class=\"hljs-built_in\">any</span>,\n  <span class=\"hljs-attr\">nextProps</span>: <span class=\"hljs-built_in\">any</span>,\n</span>) {\n  <span class=\"hljs-keyword\">const</span> prevState = workInProgress.<span class=\"hljs-property\">memoizedState</span>\n\n  <span class=\"hljs-keyword\">const</span> partialState = <span class=\"hljs-title function_\">getDerivedStateFromProps</span>(nextProps, prevState)\n\n  \n  <span class=\"hljs-keyword\">const</span> memoizedState =\n    partialState === <span class=\"hljs-literal\">null</span> || partialState === <span class=\"hljs-literal\">undefined</span>\n      ? prevState\n      : <span class=\"hljs-title class_\">Object</span>.<span class=\"hljs-title function_\">assign</span>({}, prevState, partialState)\n  workInProgress.<span class=\"hljs-property\">memoizedState</span> = memoizedState\n\n  \n  \n  <span class=\"hljs-keyword\">const</span> updateQueue = workInProgress.<span class=\"hljs-property\">updateQueue</span>\n  <span class=\"hljs-keyword\">if</span> (updateQueue !== <span class=\"hljs-literal\">null</span> &amp;&amp; updateQueue.<span class=\"hljs-property\">expirationTime</span> === <span class=\"hljs-title class_\">NoWork</span>) {\n    updateQueue.<span class=\"hljs-property\">baseState</span> = memoizedState\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"251,277"}},{"content":"<pre data-lines=\"278,279\"><code>&#x9996;&#x5148;`markRef`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"278,279"}},{"content":"<pre data-lines=\"280,293\"><code data-lines=\"280,293\"><span class=\"hljs-keyword\">function</span> markRef(<span class=\"hljs-keyword\">current</span>: Fiber | <span class=\"hljs-keyword\">null</span>, workInProgress: Fiber) {\n  const <span class=\"hljs-keyword\">ref</span> = workInProgress.<span class=\"hljs-keyword\">ref</span>\n  <span class=\"hljs-keyword\">if</span> (\n    (<span class=\"hljs-keyword\">current</span> === <span class=\"hljs-keyword\">null</span> &amp;&amp; <span class=\"hljs-keyword\">ref</span> !== <span class=\"hljs-keyword\">null</span>) ||\n    (<span class=\"hljs-keyword\">current</span> !== <span class=\"hljs-keyword\">null</span> &amp;&amp; <span class=\"hljs-keyword\">current</span>.<span class=\"hljs-keyword\">ref</span> !== <span class=\"hljs-keyword\">ref</span>)\n  ) {\n    \n    workInProgress.effectTag |= <span class=\"hljs-keyword\">Ref</span>\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"280,293"}},{"content":"<pre data-lines=\"294,301\"><code>&#x4e5f;&#x5c31;&#x662f;&#x7ed9;`effectTag`&#x52a0;&#x4e0a;`Ref`&#x5c5e;&#x6027;\n\n&#x7136;&#x540e;&#x5982;&#x679c;&#x5373;`shouldUpdate`&#x4e0d;&#x4e3a;`true`&#xff0c;&#x53c8;&#x6ca1;&#x6709;&#x6355;&#x83b7;&#x5230;&#x9519;&#x8bef;&#xff0c;&#x90a3;&#x4e48;&#x8bf4;&#x660e;&#x8fd9;&#x4e2a;&#x7ec4;&#x4ef6;&#x5df2;&#x7ecf;&#x66f4;&#x65b0;&#x5b8c;&#x6210;&#x4e86;&#xff0c;&#x76f4;&#x63a5;&#x8fd4;&#x56de;`bailoutOnAlreadyFinishedWork`\n\n&#x4e4b;&#x540e;&#x8fdb;&#x5165;`render`&#x9636;&#x6bb5;&#xff0c;&#x8fd9;&#x4e2a;&#x9636;&#x6bb5;&#x4e3b;&#x8981;&#x662f;&#x83b7;&#x53d6;`instance.render`&#x7684;&#x7ed3;&#x679c;&#xff0c;&#x4f5c;&#x4e3a;&#x5f53;&#x524d;`Fiber`&#x7684;`children`&#xff0c;&#x5230;&#x8fd9;&#x91cc;&#x5c31;&#x7ed3;&#x675f;&#x4e86;`render`&#x9636;&#x6bb5;&#x3002;\n\n&#x518d;&#x7ed9;`effectTag`&#x52a0;&#x4e0a;`PerformedWork`&#xff0c;&#x63a5;&#x4e0b;&#x53bb;&#x5c31;&#x8fdb;&#x5165;&#x4e86;&#x65e5;&#x5e38;&#x7684;`reconcileChildrenAtExpirationTime`&#x9636;&#x6bb5;&#x4e86;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"294,301"}},{"content":"<pre data-lines=\"302,375\"><code data-lines=\"302,375\"><span class=\"hljs-function\">function <span class=\"hljs-title\">finishClassComponent</span>(<span class=\"hljs-params\">\n  current: Fiber | <span class=\"hljs-literal\">null</span>,\n  workInProgress: Fiber,\n  shouldUpdate: boolean,\n  hasContext: boolean,\n  renderExpirationTime: ExpirationTime,\n</span>)</span> {\n  \n  markRef(current, workInProgress)\n\n  <span class=\"hljs-keyword\">const</span> didCaptureError = (workInProgress.effectTag &amp; DidCapture) !== <span class=\"hljs-function\">NoEffect\n\n  <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">!shouldUpdate &amp;&amp; !didCaptureError</span>)</span> {\n    \n    <span class=\"hljs-keyword\">if</span> (hasContext) {\n      invalidateContextProvider(workInProgress, <span class=\"hljs-literal\">false</span>)\n    }\n\n    <span class=\"hljs-keyword\">return</span> bailoutOnAlreadyFinishedWork(current, workInProgress)\n  }\n\n  <span class=\"hljs-keyword\">const</span> ctor = workInProgress.type\n  <span class=\"hljs-keyword\">const</span> instance = workInProgress.stateNode\n\n  \n  ReactCurrentOwner.current = <span class=\"hljs-function\">workInProgress\n  <span class=\"hljs-keyword\">let</span> nextChildren\n  <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">\n    didCaptureError &amp;&amp;\n    (!enableGetDerivedStateFromCatch ||\n      <span class=\"hljs-keyword\">typeof</span> ctor.getDerivedStateFromCatch !== <span class=\"hljs-string\">&apos;function&apos;</span></span>)\n  )</span> {\n    nextChildren = <span class=\"hljs-function\"><span class=\"hljs-literal\">null</span>\n\n    <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">enableProfilerTimer</span>)</span> {\n      stopBaseRenderTimerIfRunning()\n    }\n  } <span class=\"hljs-keyword\">else</span> {\n    nextChildren = instance.render()\n  }\n\n  \n  workInProgress.effectTag |= <span class=\"hljs-function\">PerformedWork\n  <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">didCaptureError</span>)</span> {\n    reconcileChildrenAtExpirationTime(\n      current,\n      workInProgress,\n      <span class=\"hljs-literal\">null</span>,\n      renderExpirationTime,\n    )\n    workInProgress.child = <span class=\"hljs-literal\">null</span>\n  }\n  reconcileChildrenAtExpirationTime(\n    current,\n    workInProgress,\n    nextChildren,\n    renderExpirationTime,\n  )\n  \n  \n  memoizeState(workInProgress, instance.state)\n  memoizeProps(workInProgress, instance.props)\n\n  \n  <span class=\"hljs-keyword\">if</span> (hasContext) {\n    invalidateContextProvider(workInProgress, <span class=\"hljs-literal\">true</span>)\n  }\n\n  <span class=\"hljs-keyword\">return</span> workInProgress.child\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"302,375"}},{"content":"<pre data-lines=\"376,381\"><code>&#x8fd9;&#x4e2a;&#x4ee3;&#x7801;&#x5c31;&#x662f;&#x6309;&#x7167;&#x6d41;&#x7a0b;&#x6765;&#x529e;&#x4e8b;&#x6765;&#xff0c;&#x6bd4;&#x8f83;&#x7b80;&#x5355;&#x5c31;&#x4e0d;&#x8be6;&#x7ec6;&#x8bb2;&#x4e86;&#x3002;&#x4e3b;&#x8981;&#x5c31;&#x662f;&#x8c03;&#x7528;&#x6765;&#x66f4;&#x65b0;&#x76f8;&#x5173;&#x7684;&#x51e0;&#x4e2a;&#x751f;&#x547d;&#x5468;&#x671f;&#x65b9;&#x6cd5;\n\n`checkShouldComponentUpdate`&#x91cc;&#x9762;&#x4f1a;&#x8c03;&#x7528;`shouldComponentUpdate`&#x751f;&#x547d;&#x5468;&#x671f;&#x65b9;&#x6cd5;\n\n**&#x8fd9;&#x91cc;&#x770b;&#x51fa;&#x6765;&#x662f;&#x5426;&#x9700;&#x8981;`update`&#x53ea;&#x53d6;&#x51b3;&#x4e8e;&#x4f60;`shouldComponentUpdate`&#x7684;&#x8fd4;&#x56de;&#x4ee5;&#x53ca;&#x662f;&#x5426;&#x662f;`PureComponent`&#x5e76;&#x4e14;`props`&#x548c;`state`&#x6ca1;&#x6709;&#x53d8;&#x5316;**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"376,381"}},{"content":"<pre data-lines=\"382,424\"><code data-lines=\"382,424\">function checkShouldComponentUpdate(\n<span class=\"hljs-built_in\">  workInProgress,</span>\n<span class=\"hljs-built_in\">  ctor,</span>\n<span class=\"hljs-built_in\">  oldProps,</span>\n<span class=\"hljs-built_in\">  newProps,</span>\n<span class=\"hljs-built_in\">  oldState,</span>\n<span class=\"hljs-built_in\">  newState,</span>\n<span class=\"hljs-built_in\">  nextLegacyContext,</span>\n) {\n  const instance = workInProgress.stateNode\n  if (typeof instance.shouldComponentUpdate === &apos;function&apos;) {\n    startPhaseTimer(workInProgress, &apos;shouldComponentUpdate&apos;)\n    const shouldUpdate = instance.shouldComponentUpdate(\n<span class=\"hljs-built_in\">      newProps,</span>\n<span class=\"hljs-built_in\">      newState,</span>\n<span class=\"hljs-built_in\">      nextLegacyContext,</span>\n    )\n    stopPhaseTimer()\n\n    if (__DEV__) {\n      warningWithoutStack(\n        shouldUpdate !== undefined,\n<span class=\"hljs-title\">        &apos;%s.shouldComponentUpdate():</span> Returned undefined instead of a &apos; +\n          &apos;boolean value. Make sure to <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span> <span class=\"hljs-literal\">or</span> <span class=\"hljs-literal\">false</span>.&apos;,\n        getComponentName(ctor) || &apos;Component&apos;,\n      )\n    }\n\n    <span class=\"hljs-keyword\">return</span> shouldUpdate\n  }\n\n  if (ctor.prototype &amp;&amp; ctor.prototype.isPureReactComponent) {\n    <span class=\"hljs-keyword\">return</span> (\n      !shallowEqual(oldProps, newProps) || !shallowEqual(oldState, newState)\n    )\n  }\n\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"382,424"}},{"content":"<pre data-lines=\"425,582\"><code data-lines=\"425,582\"><span class=\"hljs-title\">function</span> updateClassInstance(\n  current: <span class=\"hljs-type\">Fiber</span>,\n  workInProgress: <span class=\"hljs-type\">Fiber</span>,\n  renderExpirationTime: <span class=\"hljs-type\">ExpirationTime</span>,\n): boolean {\n  const ctor = workInProgress.<span class=\"hljs-class\"><span class=\"hljs-keyword\">type</span></span>\n  const <span class=\"hljs-keyword\">instance</span> = workInProgress.stateNode\n\n  const oldProps = workInProgress.memoizedProps\n  const newProps = workInProgress.pendingProps\n<span class=\"hljs-class\">  <span class=\"hljs-keyword\">instance</span>.props = oldProps\n\n  const oldContext = <span class=\"hljs-keyword\">instance</span>.context\n  const newUnmaskedContext = getUnmaskedContext(<span class=\"hljs-title\">workInProgress</span>)\n  const newContext = getMaskedContext(<span class=\"hljs-title\">workInProgress</span>, <span class=\"hljs-title\">newUnmaskedContext</span>)\n\n  const getDerivedStateFromProps = ctor.getDerivedStateFromProps\n  const hasNewLifecycles =\n    typeof getDerivedStateFromProps === &apos;function&apos; ||\n    typeof <span class=\"hljs-keyword\">instance</span>.getSnapshotBeforeUpdate === &apos;function&apos;\n\n  if (\n    !<span class=\"hljs-title\">hasNewLifecycles</span> &amp;&amp;\n    (<span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">instance</span>.<span class=\"hljs-type\">UNSAFE_componentWillReceiveProps</span> === &apos;<span class=\"hljs-title\">function&apos;</span> ||\n      <span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">instance</span>.<span class=\"hljs-title\">componentWillReceiveProps</span> === &apos;<span class=\"hljs-title\">function&apos;</span>)\n  ) {\n    if (<span class=\"hljs-title\">oldProps</span> !== <span class=\"hljs-title\">newProps</span> || <span class=\"hljs-title\">oldContext</span> !== <span class=\"hljs-title\">newContext</span>) {\n      callComponentWillReceiveProps(\n        <span class=\"hljs-title\">workInProgress</span>,\n        <span class=\"hljs-title\">instance</span>,\n        <span class=\"hljs-title\">newProps</span>,\n        <span class=\"hljs-title\">newContext</span>,\n      )\n    }\n  }\n\n  resetHasForceUpdateBeforeProcessing()\n\n  const oldState = workInProgress.memoizedState\n  let newState = (<span class=\"hljs-title\">instance</span>.<span class=\"hljs-title\">state</span> = <span class=\"hljs-title\">oldState</span>)\n  let updateQueue = workInProgress.updateQueue\n  if (<span class=\"hljs-title\">updateQueue</span> !== <span class=\"hljs-title\">null</span>) {\n    processUpdateQueue(\n      <span class=\"hljs-title\">workInProgress</span>,\n      <span class=\"hljs-title\">updateQueue</span>,\n      <span class=\"hljs-title\">newProps</span>,\n      <span class=\"hljs-title\">instance</span>,\n      <span class=\"hljs-title\">renderExpirationTime</span>,\n    )\n    newState = workInProgress.memoizedState\n  }\n\n  if (\n    <span class=\"hljs-title\">oldProps</span> === <span class=\"hljs-title\">newProps</span> &amp;&amp;\n    <span class=\"hljs-title\">oldState</span> === <span class=\"hljs-title\">newState</span> &amp;&amp;\n    !<span class=\"hljs-title\">hasContextChanged</span>() &amp;&amp;\n    !checkHasForceUpdateAfterProcessing()\n  ) {\n    if (<span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">instance</span>.<span class=\"hljs-title\">componentDidUpdate</span> === &apos;<span class=\"hljs-title\">function&apos;</span>) {\n      if (\n        <span class=\"hljs-title\">oldProps</span> !== <span class=\"hljs-title\">current</span>.<span class=\"hljs-title\">memoizedProps</span> ||\n        <span class=\"hljs-title\">oldState</span> !== <span class=\"hljs-title\">current</span>.<span class=\"hljs-title\">memoizedState</span>\n      ) {\n        workInProgress.effectTag |= <span class=\"hljs-type\">Update</span>\n      }\n    }\n    if (<span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">instance</span>.<span class=\"hljs-title\">getSnapshotBeforeUpdate</span> === &apos;<span class=\"hljs-title\">function&apos;</span>) {\n      if (\n        <span class=\"hljs-title\">oldProps</span> !== <span class=\"hljs-title\">current</span>.<span class=\"hljs-title\">memoizedProps</span> ||\n        <span class=\"hljs-title\">oldState</span> !== <span class=\"hljs-title\">current</span>.<span class=\"hljs-title\">memoizedState</span>\n      ) {\n        workInProgress.effectTag |= <span class=\"hljs-type\">Snapshot</span>\n      }\n    }\n    return false\n  }\n\n  if (<span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">getDerivedStateFromProps</span> === &apos;<span class=\"hljs-title\">function&apos;</span>) {\n    applyDerivedStateFromProps(\n      <span class=\"hljs-title\">workInProgress</span>,\n      <span class=\"hljs-title\">getDerivedStateFromProps</span>,\n      <span class=\"hljs-title\">newProps</span>,\n    )\n    newState = workInProgress.memoizedState\n  }\n\n  const shouldUpdate =\n    checkHasForceUpdateAfterProcessing() ||\n    checkShouldComponentUpdate(\n      <span class=\"hljs-title\">workInProgress</span>,\n      <span class=\"hljs-title\">oldProps</span>,\n      <span class=\"hljs-title\">newProps</span>,\n      <span class=\"hljs-title\">oldState</span>,\n      <span class=\"hljs-title\">newState</span>,\n      <span class=\"hljs-title\">newContext</span>,\n    )\n\n  if (<span class=\"hljs-title\">shouldUpdate</span>) {\n    \n    \n    if (\n      !<span class=\"hljs-title\">hasNewLifecycles</span> &amp;&amp;\n      (<span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">instance</span>.<span class=\"hljs-type\">UNSAFE_componentWillUpdate</span> === &apos;<span class=\"hljs-title\">function&apos;</span> ||\n        <span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">instance</span>.<span class=\"hljs-title\">componentWillUpdate</span> === &apos;<span class=\"hljs-title\">function&apos;</span>)\n    ) {\n      startPhaseTimer(<span class=\"hljs-title\">workInProgress</span>, &apos;<span class=\"hljs-title\">componentWillUpdate&apos;</span>)\n      if (<span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">instance</span>.<span class=\"hljs-title\">componentWillUpdate</span> === &apos;<span class=\"hljs-title\">function&apos;</span>) {\n        <span class=\"hljs-keyword\">instance</span>.componentWillUpdate(<span class=\"hljs-title\">newProps</span>, <span class=\"hljs-title\">newState</span>, <span class=\"hljs-title\">newContext</span>)\n      }\n      if (<span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">instance</span>.<span class=\"hljs-type\">UNSAFE_componentWillUpdate</span> === &apos;<span class=\"hljs-title\">function&apos;</span>) {\n        <span class=\"hljs-keyword\">instance</span>.<span class=\"hljs-type\">UNSAFE_componentWillUpdate</span>(<span class=\"hljs-title\">newProps</span>, <span class=\"hljs-title\">newState</span>, <span class=\"hljs-title\">newContext</span>)\n      }\n      stopPhaseTimer()\n    }\n    if (<span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">instance</span>.<span class=\"hljs-title\">componentDidUpdate</span> === &apos;<span class=\"hljs-title\">function&apos;</span>) {\n      workInProgress.effectTag |= <span class=\"hljs-type\">Update</span>\n    }\n    if (<span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">instance</span>.<span class=\"hljs-title\">getSnapshotBeforeUpdate</span> === &apos;<span class=\"hljs-title\">function&apos;</span>) {\n      workInProgress.effectTag |= <span class=\"hljs-type\">Snapshot</span>\n    }\n  } else {\n    \n    \n    if (<span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">instance</span>.<span class=\"hljs-title\">componentDidUpdate</span> === &apos;<span class=\"hljs-title\">function&apos;</span>) {\n      if (\n        <span class=\"hljs-title\">oldProps</span> !== <span class=\"hljs-title\">current</span>.<span class=\"hljs-title\">memoizedProps</span> ||\n        <span class=\"hljs-title\">oldState</span> !== <span class=\"hljs-title\">current</span>.<span class=\"hljs-title\">memoizedState</span>\n      ) {\n        workInProgress.effectTag |= <span class=\"hljs-type\">Update</span>\n      }\n    }\n    if (<span class=\"hljs-title\">typeof</span> <span class=\"hljs-title\">instance</span>.<span class=\"hljs-title\">getSnapshotBeforeUpdate</span> === &apos;<span class=\"hljs-title\">function&apos;</span>) {\n      if (\n        <span class=\"hljs-title\">oldProps</span> !== <span class=\"hljs-title\">current</span>.<span class=\"hljs-title\">memoizedProps</span> ||\n        <span class=\"hljs-title\">oldState</span> !== <span class=\"hljs-title\">current</span>.<span class=\"hljs-title\">memoizedState</span>\n      ) {\n        workInProgress.effectTag |= <span class=\"hljs-type\">Snapshot</span>\n      }\n    }\n\n    \n    \n    workInProgress.memoizedProps = newProps\n    workInProgress.memoizedState = newState\n  }\n\n  \n  \n  <span class=\"hljs-keyword\">instance</span>.props = newProps\n  <span class=\"hljs-keyword\">instance</span>.state = newState\n  <span class=\"hljs-keyword\">instance</span>.context = newContext\n\n  return shouldUpdate\n}\n\n</span></code></pre>","children":[],"payload":{"tag":"pre","lines":"425,582"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
