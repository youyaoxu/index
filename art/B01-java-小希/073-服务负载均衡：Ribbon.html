<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://unpkg.com/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://unpkg.com/d3@7.9.0/dist/d3.min.js"></script><script src="https://unpkg.com/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://unpkg.com/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"&#x670d;&#x52a1;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#xff1a;Ribbon","children":[{"content":"1.1&#x3001;&#x4ec0;&#x4e48;&#x662f;Ribbon","children":[{"content":"<pre data-lines=\"5,8\"><code>Ribbon &#x662f;&#x4e00;&#x4e2a;&#x57fa;&#x4e8e; HTTP &#x548c; TCP &#x7684;&#x5ba2;&#x670d;&#x7aef;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x5de5;&#x5177;&#xff0c;&#x5b83;&#x662f;&#x57fa;&#x4e8e; Netflix Ribbon &#x5b9e;&#x73b0;&#x7684;&#x3002;&#x5b83;&#x4e0d;&#x50cf; Spring Cloud &#x670d;&#x52a1;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;&#x3001;&#x914d;&#x7f6e;&#x4e2d;&#x5fc3;&#x3001;API &#x7f51;&#x5173;&#x90a3;&#x6837;&#x72ec;&#x7acb;&#x90e8;&#x7f72;&#xff0c;&#x4f46;&#x662f;&#x5b83;&#x51e0;&#x4e4e;&#x5b58;&#x5728;&#x4e8e;&#x6bcf;&#x4e2a; Spring Cloud &#x5fae;&#x670d;&#x52a1;&#x4e2d;&#x3002;&#x5305;&#x62ec; Feign &#x63d0;&#x4f9b;&#x7684;&#x58f0;&#x660e;&#x5f0f;&#x670d;&#x52a1;&#x8c03;&#x7528;&#x4e5f;&#x662f;&#x57fa;&#x4e8e;&#x8be5; Ribbon &#x5b9e;&#x73b0;&#x7684;&#x3002;\n\nRibbon &#x9ed8;&#x8ba4;&#x63d0;&#x4f9b;&#x5f88;&#x591a;&#x79cd;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x7b97;&#x6cd5;&#xff0c;&#x4f8b;&#x5982;&#x8f6e;&#x8be2;&#x3001;&#x968f;&#x673a;&#x7b49;&#x7b49;&#xff0c;&#x751a;&#x81f3;&#x5305;&#x542b;&#x81ea;&#x5b9a;&#x4e49;&#x7684;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x7b97;&#x6cd5;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5,8"}}],"payload":{"tag":"h2","lines":"2,4"}},{"content":"1.2&#x3001;&#x4e3a;&#x5565;&#x7528;Ribbon","children":[{"content":"<pre data-lines=\"12,16\"><code>Ribbon &#x63d0;&#x4f9b;&#x4e86;&#x4e00;&#x5957;&#x5fae;&#x670d;&#x52a1;&#x7684;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x89e3;&#x51b3;&#x65b9;&#x6848;&#x3002;&#x76ee;&#x524d;&#x4e1a;&#x754c;&#x4e3b;&#x6d41;&#x7684;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x65b9;&#x6848;&#x53ef;&#x5206;&#x6210;&#x4e24;&#x7c7b;&#xff1a;\n\n*   &#x96c6;&#x4e2d;&#x5f0f;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#xff08;&#x670d;&#x52a1;&#x5668;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#xff09;&#xff0c;&#x5373;&#x5728; consumer &#x548c; provider &#x4e4b;&#x95f4;&#x4f7f;&#x7528;&#x72ec;&#x7acb;&#x7684;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x8bbe;&#x65bd;(&#x53ef;&#x4ee5;&#x662f;&#x786c;&#x4ef6;&#xff0c;&#x5982; F5&#xff0c;&#x4e5f;&#x53ef;&#x4ee5;&#x662f;&#x8f6f;&#x4ef6;&#xff0c;&#x5982; nginx)&#xff0c;&#x7531;&#x8be5;&#x8bbe;&#x65bd;&#x8d1f;&#x8d23;&#x628a;&#x8bbf;&#x95ee;&#x8bf7;&#x6c42;&#x901a;&#x8fc7;&#x67d0;&#x79cd;&#x7b56;&#x7565;&#x8f6c;&#x53d1;&#x81f3; provider&#xff1b;\n*   &#x8fdb;&#x7a0b;&#x5185;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#xff08;&#x5ba2;&#x6237;&#x7aef;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#xff09;&#xff0c;&#x5c06;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x903b;&#x8f91;&#x96c6;&#x6210;&#x5230; consumer&#xff0c;consumer &#x4ece;&#x670d;&#x52a1;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;&#x83b7;&#x77e5;&#x6709;&#x54ea;&#x4e9b;&#x5730;&#x5740;&#x53ef;&#x7528;&#xff0c;&#x7136;&#x540e;&#x81ea;&#x5df1;&#x518d;&#x4ece;&#x8fd9;&#x4e9b;&#x5730;&#x5740;&#x4e2d;&#x9009;&#x62e9;&#x51fa;&#x4e00;&#x4e2a;&#x5408;&#x9002;&#x7684; provider&#x3002;Ribbon &#x5c5e;&#x4e8e;&#x540e;&#x8005;&#xff0c;&#x5b83;&#x53ea;&#x662f;&#x4e00;&#x4e2a;&#x7c7b;&#x5e93;&#xff0c;&#x96c6;&#x6210;&#x4e8e; consumer &#x8fdb;&#x7a0b;&#xff0c;consumer &#x901a;&#x8fc7;&#x5b83;&#x6765;&#x83b7;&#x53d6; provider &#x7684;&#x5730;&#x5740;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"12,16"}}],"payload":{"tag":"h2","lines":"9,11"}},{"content":"2.1&#x3001;&#x9879;&#x76ee;&#x51c6;&#x5907;","children":[{"content":"<pre data-lines=\"20,21\"><code>&#x6211;&#x4eec;&#x63a5;&#x4e0b;&#x6765;&#x7684;&#x6240;&#x6709;&#x64cd;&#x4f5c;&#x5747;&#x662f;&#x5728;`Eureka`&#x6700;&#x540e;&#x5b8c;&#x6210;&#x7684;&#x5de5;&#x7a0b;&#x4e0a;&#x8fdb;&#x884c;&#x64cd;&#x4f5c;&#xff0c;&#x76f8;&#x5173;&#x4ee3;&#x7801;&#x8bf7;&#x5230;&#x914d;&#x5957;&#x8d44;&#x6599;&#x4e2d;&#x5bfb;&#x627e;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"20,21"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1fe85e3cab06a0fdcb0717783ef06192.png\" alt>","children":[],"payload":{"tag":"img","lines":"22,23"}}],"payload":{"tag":"h2","lines":"17,19"}},{"content":"2.2&#x3001;&#x6dfb;&#x52a0;&#x670d;&#x52a1;&#x63d0;&#x4f9b;&#x8005;","children":[{"content":"<pre data-lines=\"27,30\"><code>&#x65e2;&#x7136;&#x6211;&#x4eec;&#x8981;&#x505a;&#x670d;&#x52a1;&#x7684;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#xff0c;&#x90a3;&#x80af;&#x5b9a;&#x9700;&#x8981;&#x6709;&#x5f88;&#x591a;&#x670d;&#x52a1;&#xff0c;&#x4e00;&#x4e2a;&#x670d;&#x52a1;&#x518d;&#x600e;&#x4e48;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x8fd8;&#x662f;&#x4ed6;&#x81ea;&#x5df1;&#xff0c;&#x56e0;&#x6b64;&#xff0c;&#x6211;&#x4eec;&#x9700;&#x8981;&#x5728;&#x539f;&#x5de5;&#x7a0b;&#x7684;&#x57fa;&#x7840;&#x4e0a;&#x5728;&#x6dfb;&#x52a0;&#x4e00;&#x4e2a;&#x670d;&#x52a1;&#x63d0;&#x4f9b;&#x8005;&#xff0c;&#x914d;&#x7f6e;&#x57fa;&#x672c;&#x548c;`service-provider8001`&#x5dee;&#x4e0d;&#x591a;&#xff0c;&#x53ea;&#x4e0d;&#x8fc7;&#x7aef;&#x53e3;&#x4e0d;&#x4e00;&#x6837;&#x800c;&#x5df2;&#xff0c;&#x63a5;&#x4e0b;&#x6765;&#x4f1a;&#x7ed9;&#x51fa;&#x5177;&#x4f53;&#x4e0d;&#x4e00;&#x6837;&#x7684;&#x914d;&#x7f6e;&#x3002;\n\n&#xff08;1&#xff09;&#x4fee;&#x6539;&#x542f;&#x52a8;&#x7c7b;&#x4e3a;`ServiceProvider8002Application`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"27,30"}},{"content":"<pre data-lines=\"31,41\"><code class=\"language-java\"><span class=\"hljs-meta\">@EnableEurekaClient</span>\n<span class=\"hljs-meta\">@SpringBootApplication</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ServiceProvider8002Application</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        SpringApplication.run(ServiceProvider8002Application.class);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"31,41"}},{"content":"<pre data-lines=\"42,43\"><code>&#xff08;2&#xff09;&#x4fee;&#x6539;&#x914d;&#x7f6e;&#x6587;&#x4ef6;application.yaml\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"42,43"}},{"content":"<pre data-lines=\"44,77\"><code class=\"language-yaml\"><span class=\"hljs-attr\">server:</span>\n  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">8002</span>\n\n<span class=\"hljs-attr\">spring:</span>\n  <span class=\"hljs-attr\">application:</span>\n    <span class=\"hljs-comment\">#&#x8be5;&#x540d;&#x79f0;&#x5728;&#x96c6;&#x7fa4;&#x6a21;&#x5f0f;&#x4e0b;&#x5e94;&#x8be5;&#x4fdd;&#x6301;&#x4e00;&#x81f4;</span>\n    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">service-provider</span>\n\n<span class=\"hljs-comment\">#&#x5ea6;&#x91cf;&#x6307;&#x6807;&#x76d1;&#x63a7;&#x4e0e;&#x5065;&#x5eb7;&#x68c0;&#x67e5;</span>\n<span class=\"hljs-attr\">management:</span>\n  <span class=\"hljs-attr\">endpoints:</span>\n    <span class=\"hljs-attr\">web:</span>\n      <span class=\"hljs-attr\">exposure:</span>\n        <span class=\"hljs-comment\">#&#x5f00;&#x542f; shutdown &#x7aef;&#x70b9;&#x8bbf;&#x95ee;</span>\n        <span class=\"hljs-attr\">include:</span> <span class=\"hljs-string\">shutdown</span>\n  <span class=\"hljs-attr\">endpoint:</span>\n    <span class=\"hljs-comment\">#&#x5f00;&#x542f; shutdown &#x5b9e;&#x73b0;&#x4f18;&#x96c5;&#x505c;&#x670d;</span>\n    <span class=\"hljs-attr\">shutdown:</span>\n      <span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n\n<span class=\"hljs-attr\">eureka:</span>\n  <span class=\"hljs-attr\">instance:</span>\n    <span class=\"hljs-comment\">#&#x662f;&#x5426;&#x4f7f;&#x7528; ip &#x5730;&#x5740;&#x6ce8;&#x518c;</span>\n    <span class=\"hljs-attr\">prefer-ip-address:</span> <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-comment\">#&#x8be5;&#x5b9e;&#x4f8b;&#x6ce8;&#x518c;&#x5230;&#x670d;&#x52a1;&#x4e2d;&#x5fc3;&#x7684;&#x552f;&#x4e00;ID</span>\n    <span class=\"hljs-attr\">instance-id:</span> <span class=\"hljs-string\">&#x24;{spring.cloud.client.ip-address}:&#x24;{server.port}</span>\n  <span class=\"hljs-attr\">client:</span>\n    <span class=\"hljs-comment\">#&#x8bbe;&#x7f6e;&#x670d;&#x52a1;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;&#x5730;&#x5740;</span>\n    <span class=\"hljs-attr\">service-url:</span>\n      <span class=\"hljs-attr\">defaultZone:</span> <span class=\"hljs-string\">http://root:123456@eureka-server7001.com:7001/eureka/,http://root:123456@eureka-server7002.com:7002/eureka/</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"44,77"}},{"content":"<pre data-lines=\"78,81\"><code>&#xff08;3&#xff09;&#x5206;&#x522b;&#x4fee;&#x6539;`service-provider8001`&#x548c;`service-provider8002`&#x7684;&#x63a7;&#x5236;&#x5c42;`ProductController` &#x4ee3;&#x7801;&#xff0c;&#x90fd;&#x52a0;&#x5165;&#x4e00;&#x6bb5;&#x65b0;&#x7684;&#x63a7;&#x5236;&#x5668;&#x65b9;&#x6cd5;&#xff0c;&#x4ee3;&#x7801;&#x5982;&#x4e0b;&#xff1a;\n\nservice-provider8001&#x7684;ProductController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"78,81"}},{"content":"<pre data-lines=\"82,89\"><code class=\"language-java\"><span class=\"hljs-meta\">@RequestMapping(&quot;/provider/product/findByPid&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">findByPid</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;pid&quot;)</span> Integer pid)</span> {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;8001 findByPid ...&quot;</span>;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"82,89"}},{"content":"<pre data-lines=\"90,91\"><code>service-provider8002&#x7684;ProductController\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"90,91"}},{"content":"<pre data-lines=\"92,99\"><code class=\"language-java\"><span class=\"hljs-meta\">@RequestMapping(&quot;/provider/product/findByPid&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">findByPid</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;pid&quot;)</span> Integer pid)</span> {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;8002 findByPid ...&quot;</span>;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"92,99"}},{"content":"<pre data-lines=\"100,113\"><code>&#xff08;4&#xff09;&#x542f;&#x52a8;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;\n\n1.  &#x542f;&#x52a8;eureka-server7001\n2.  &#x542f;&#x52a8;eureka-server7002\n\n&#xff08;5&#xff09;&#x542f;&#x52a8;&#x670d;&#x52a1;&#x63d0;&#x4f9b;&#x8005;\n\n1.  &#x542f;&#x52a8;service-provider8001\n2.  &#x542f;&#x52a8;service-provider8002\n\n&#xff08;6&#xff09;&#x67e5;&#x770b;&#x670d;&#x52a1;&#x662f;&#x5426;&#x6ce8;&#x518c;&#x5230;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;&#xff0c;&#x767b;&#x5f55;&#x8d26;&#x6237;&#x4e3a;root&#xff0c;&#x767b;&#x5f55;&#x5bc6;&#x7801;&#x4e3a;123456\n\n&#x5728;&#x6d4f;&#x89c8;&#x5668;&#x6253;&#x5f00;&#x5730;&#x5740;&#xff1a;http://localhost:7001/\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"100,113"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/bf40c7b69acc0bff8dedaad7fb505e01.png\" alt>","children":[],"payload":{"tag":"img","lines":"114,115"}}],"payload":{"tag":"h2","lines":"24,26"}},{"content":"2.3&#x3001;&#x4fee;&#x6539;&#x670d;&#x52a1;&#x6d88;&#x8d39;&#x8005;","children":[{"content":"2.3.1&#x3001;&#x65b9;&#x5f0f;&#x4e00;&#xff1a;LoadBalancerClient","children":[{"content":"<pre data-lines=\"121,122\"><code>&#xff08;1&#xff09;&#x4fee;&#x6539;`service-consumer9001`&#x7684;`ProductController`&#x63a7;&#x5236;&#x5668;&#x4ee3;&#x7801;&#xff0c;&#x5728;&#x91cc;&#x8fb9;&#x65b0;&#x589e;&#x4ee5;&#x4e0b;&#x4ee3;&#x7801;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"121,122"}},{"content":"<pre data-lines=\"123,144\"><code class=\"language-java\"><span class=\"hljs-comment\">// Ribbon &#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x5668;</span>\n<span class=\"hljs-comment\">// import org.springframework.cloud.client.loadbalancer.LoadBalancerClient;</span>\n<span class=\"hljs-meta\">@Autowired</span>\n<span class=\"hljs-keyword\">private</span> LoadBalancerClient loadBalancerClient;\n\n<span class=\"hljs-meta\">@RequestMapping(&quot;/consumer/product/findByPid&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">findByPid</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;pid&quot;)</span> Integer pid)</span> {\n    <span class=\"hljs-comment\">//&#x4ece;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;&#x83b7;&#x53d6;&#x4e00;&#x4e2a;SERVICE-PROVIDER&#x670d;&#x52a1;&#x7684;&#x5b9e;&#x4f8b;&#x5bf9;&#x8c61;</span>\n    <span class=\"hljs-type\">ServiceInstance</span> <span class=\"hljs-variable\">si</span> <span class=\"hljs-operator\">=</span> loadBalancerClient.choose(<span class=\"hljs-string\">&quot;SERVICE-PROVIDER&quot;</span>);\n    <span class=\"hljs-keyword\">if</span> (si == <span class=\"hljs-literal\">null</span>) {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;\n    }\n\n    <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">findByPidUrl</span> <span class=\"hljs-operator\">=</span> si.getUri() + <span class=\"hljs-string\">&quot;/provider/product/findByPid&quot;</span> + <span class=\"hljs-string\">&quot;?pid=&quot;</span> + pid;\n    <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">product</span> <span class=\"hljs-operator\">=</span> restTemplate.getForObject(findByPidUrl, String.class);\n    <span class=\"hljs-keyword\">return</span> product;\n    <span class=\"hljs-comment\">//&#x8fd9;&#x91cc;&#x53ea;&#x662f;&#x505a;&#x6a21;&#x62df;&#x8fd4;&#x56de;&#x4e86;&#x4e00;&#x4e2a;&#x5b57;&#x7b26;&#x4e32;&#xff0c;&#x5f53;&#x7136;&#x4f60;&#x4e5f;&#x53ef;&#x4ee5;&#x8fd4;&#x56de;&#x4e00;&#x4e2a;&#x5546;&#x54c1;&#x5bf9;&#x8c61;&#xff0c;&#x8fd9;&#x53d6;&#x51b3;&#x4e8e;&#x4f60;</span>\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"123,144"}},{"content":"<pre data-lines=\"145,146\"><code>&#xff08;2&#xff09;&#x542f;&#x52a8;`service-consumer9001`&#xff0c;&#x7136;&#x540e;&#x6253;&#x5f00;&#x6d4f;&#x89c8;&#x5668;&#x8f93;&#x5165;&#x5730;&#x5740;&#x8bbf;&#x95ee;&#xff1a;http://localhost:9001/consumer/product/findByPid?pid=1\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"145,146"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/598eb0df64381ad38d67e67c2dd2d1cf.gif\" alt>","children":[],"payload":{"tag":"img","lines":"147,148"}}],"payload":{"tag":"h3","lines":"119,120"}},{"content":"2.3.2&#x3001;&#x65b9;&#x5f0f;&#x4e8c;&#xff1a;@LoadBalanced","children":[{"content":"<pre data-lines=\"151,152\"><code>&#xff08;1&#xff09;&#x4fee;&#x6539;`service-consumer9001`&#x7684;`ServiceConsumer9001Application`&#x542f;&#x52a8;&#x7c7b;&#x4ee3;&#x7801;&#xff0c;&#x5728;&#x91cc;&#x8fb9;&#x65b0;&#x589e;&#x4ee5;&#x4e0b;&#x4ee3;&#x7801;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"151,152"}},{"content":"<pre data-lines=\"153,169\"><code class=\"language-java\"><span class=\"hljs-meta\">@EnableEurekaClient</span>\n<span class=\"hljs-meta\">@SpringBootApplication</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ServiceConsumer9001Application</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        SpringApplication.run(ServiceConsumer9001Application.class);\n    }\n\n    <span class=\"hljs-meta\">@Bean</span>\n    <span class=\"hljs-meta\">@LoadBalanced</span> <span class=\"hljs-comment\">// Ribbbon &#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x6ce8;&#x89e3;&#xff0c;&#x52a0;&#x4e0a;&#x8fd9;&#x4e2a;&#x6ce8;&#x89e3;&#xff0c;restTemplate&#x9ed8;&#x8ba4;&#x5c31;&#x6709;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x7684;&#x80fd;&#x529b;&#x4e86;</span>\n    <span class=\"hljs-keyword\">public</span> RestTemplate <span class=\"hljs-title function_\">restTemplate</span><span class=\"hljs-params\">()</span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RestTemplate</span>();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"153,169"}},{"content":"<pre data-lines=\"170,171\"><code>&#xff08;2&#xff09;&#x4fee;&#x6539;`service-consumer9001`&#x7684;`ProductController`&#x63a7;&#x5236;&#x5668;&#x4ee3;&#x7801;&#xff0c;&#x5728;&#x91cc;&#x8fb9;&#x65b0;&#x589e;&#x4ee5;&#x4e0b;&#x4ee3;&#x7801;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"170,171"}},{"content":"<pre data-lines=\"172,182\"><code class=\"language-java\"><span class=\"hljs-meta\">@RequestMapping(&quot;/consumer/product/findByPid2&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">findByPid2</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;pid&quot;)</span> Integer pid)</span> {\n    <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">findByPidUrl</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;http://SERVICE-PROVIDER/provider/product/findByPid&quot;</span> + <span class=\"hljs-string\">&quot;?pid=&quot;</span> + pid;\n    <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">product</span> <span class=\"hljs-operator\">=</span> restTemplate.getForObject(findByPidUrl, String.class);\n    System.out.println(product);\n    <span class=\"hljs-keyword\">return</span> product;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"172,182"}},{"content":"<pre data-lines=\"183,184\"><code>&#xff08;3&#xff09;&#x91cd;&#x542f;`service-consumer9001`&#xff0c;&#x7136;&#x540e;&#x6253;&#x5f00;&#x6d4f;&#x89c8;&#x5668;&#x8f93;&#x5165;&#x5730;&#x5740;&#x8bbf;&#x95ee;&#xff1a;http://localhost:9001/consumer/product/findByPid2?pid=1\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"183,184"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/0e27261ac2e07f98d2b914ffdca216c1.gif\" alt>","children":[],"payload":{"tag":"img","lines":"185,186"}}],"payload":{"tag":"h3","lines":"149,150"}}],"payload":{"tag":"h2","lines":"116,118"}},{"content":"3.1&#x3001;&#x8f6e;&#x8be2;&#x7b56;&#x7565;&#xff08;&#x9ed8;&#x8ba4;&#xff09;","children":[{"content":"<pre data-lines=\"190,193\"><code>&#x7b56;&#x7565;&#x5bf9;&#x5e94;&#x7c7b;&#x540d;&#xff1a;`RoundRobinRule`\n\n&#x5b9e;&#x73b0;&#x539f;&#x7406;&#xff1a;&#x8f6e;&#x8be2;&#x7b56;&#x7565;&#x8868;&#x793a;&#x6bcf;&#x6b21;&#x90fd;&#x987a;&#x5e8f;&#x53d6;&#x4e0b;&#x4e00;&#x4e2a; provider&#xff0c;&#x6bd4;&#x5982;&#x4e00;&#x5171;&#x6709; 5 &#x4e2a; provider&#xff0c;&#x7b2c; 1 &#x6b21;&#x53d6;&#x7b2c; 1 &#x4e2a;&#xff0c;&#x7b2c; 2 &#x6b21;&#x53d6;&#x7b2c; 2 &#x4e2a;&#xff0c;&#x7b2c; 3 &#x6b21;&#x53d6;&#x7b2c; 3 &#x4e2a;&#xff0c;&#x4ee5;&#x6b64;&#x7c7b;&#x63a8;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"190,193"}}],"payload":{"tag":"h2","lines":"187,189"}},{"content":"3.2&#x3001;&#x6743;&#x91cd;&#x8f6e;&#x8be2;&#x7b56;&#x7565;","children":[{"content":"<pre data-lines=\"197,203\"><code>&#x7b56;&#x7565;&#x5bf9;&#x5e94;&#x7c7b;&#x540d;&#xff1a;`WeightedResponseTimeRule`\n\n&#x5b9e;&#x73b0;&#x539f;&#x7406;&#xff1a;\n\n*   &#x6839;&#x636e;&#x6bcf;&#x4e2a; provider &#x7684;&#x54cd;&#x5e94;&#x65f6;&#x95f4;&#x5206;&#x914d;&#x4e00;&#x4e2a;&#x6743;&#x91cd;&#xff0c;&#x54cd;&#x5e94;&#x65f6;&#x95f4;&#x8d8a;&#x957f;&#xff0c;&#x6743;&#x91cd;&#x8d8a;&#x5c0f;&#xff0c;&#x88ab;&#x9009;&#x4e2d;&#x7684;&#x53ef;&#x80fd;&#x6027;&#x8d8a;&#x4f4e;&#x3002;\n*   &#x539f;&#x7406;&#xff1a;&#x4e00;&#x5f00;&#x59cb;&#x4e3a;&#x8f6e;&#x8be2;&#x7b56;&#x7565;&#xff0c;&#x5e76;&#x5f00;&#x542f;&#x4e00;&#x4e2a;&#x8ba1;&#x65f6;&#x5668;&#xff0c;&#x6bcf; 30 &#x79d2;&#x6536;&#x96c6;&#x4e00;&#x6b21;&#x6bcf;&#x4e2a; provider &#x7684;&#x5e73;&#x5747;&#x54cd;&#x5e94;&#x65f6;&#x95f4;&#xff0c;&#x5f53;&#x4fe1;&#x606f;&#x8db3;&#x591f;&#x65f6;&#xff0c;&#x7ed9;&#x6bcf;&#x4e2a; provider &#x9644;&#x4e0a;&#x4e00;&#x4e2a;&#x6743;&#x91cd;&#xff0c;&#x5e76;&#x6309;&#x6743;&#x91cd;&#x968f;&#x673a;&#x9009;&#x62e9; provider&#xff0c;&#x9ad8;&#x6743;&#x8d8a;&#x91cd;&#x7684; provider &#x4f1a;&#x88ab;&#x9ad8;&#x6982;&#x7387;&#x9009;&#x4e2d;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"197,203"}}],"payload":{"tag":"h2","lines":"194,196"}},{"content":"3.3&#x3001;&#x968f;&#x673a;&#x7b56;&#x7565;","children":[{"content":"<pre data-lines=\"207,210\"><code>&#x7b56;&#x7565;&#x5bf9;&#x5e94;&#x7c7b;&#x540d;&#xff1a;`RandomRule`\n\n&#x5b9e;&#x73b0;&#x539f;&#x7406;&#xff1a;&#x4ece; provider &#x5217;&#x8868;&#x4e2d;&#x968f;&#x673a;&#x9009;&#x62e9;&#x4e00;&#x4e2a;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"207,210"}}],"payload":{"tag":"h2","lines":"204,206"}},{"content":"3.4&#x3001;&#x6700;&#x5c11;&#x5e76;&#x53d1;&#x6570;&#x7b56;&#x7565;","children":[{"content":"<pre data-lines=\"214,217\"><code>&#x7b56;&#x7565;&#x5bf9;&#x5e94;&#x7c7b;&#x540d;&#xff1a;`BestAvailableRule`\n\n&#x5b9e;&#x73b0;&#x539f;&#x7406;&#xff1a;&#x9009;&#x62e9;&#x6b63;&#x5728;&#x8bf7;&#x6c42;&#x4e2d;&#x7684;&#x5e76;&#x53d1;&#x6570;&#x6700;&#x5c0f;&#x7684; provider&#xff0c;&#x9664;&#x975e;&#x8fd9;&#x4e2a; provider &#x5728;&#x7194;&#x65ad;&#x4e2d;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"214,217"}}],"payload":{"tag":"h2","lines":"211,213"}},{"content":"3.5&#x3001;&#x91cd;&#x8bd5;&#x7b56;&#x7565;","children":[{"content":"<pre data-lines=\"221,224\"><code>&#x7b56;&#x7565;&#x5bf9;&#x5e94;&#x7c7b;&#x540d;&#xff1a;`RetryRule`\n\n&#x5b9e;&#x73b0;&#x539f;&#x7406;&#xff1a;&#x5176;&#x5b9e;&#x5c31;&#x662f;&#x8f6e;&#x8be2;&#x7b56;&#x7565;&#x7684;&#x589e;&#x5f3a;&#x7248;&#xff0c;&#x8f6e;&#x8be2;&#x7b56;&#x7565;&#x670d;&#x52a1;&#x4e0d;&#x53ef;&#x7528;&#x65f6;&#x4e0d;&#x505a;&#x5904;&#x7406;&#xff0c;&#x91cd;&#x8bd5;&#x7b56;&#x7565;&#x670d;&#x52a1;&#x4e0d;&#x53ef;&#x7528;&#x65f6;&#x4f1a;&#x91cd;&#x65b0;&#x5c1d;&#x8bd5;&#x96c6;&#x7fa4;&#x4e2d;&#x7684;&#x5176;&#x4ed6;&#x8282;&#x70b9;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"221,224"}}],"payload":{"tag":"h2","lines":"218,220"}},{"content":"3.6&#x3001;&#x53ef;&#x7528;&#x6027;&#x654f;&#x611f;&#x7b56;&#x7565;","children":[{"content":"<pre data-lines=\"228,234\"><code>&#x7b56;&#x7565;&#x5bf9;&#x5e94;&#x7c7b;&#x540d;&#xff1a;`AvailabilityFilteringRule`\n\n&#x5b9e;&#x73b0;&#x539f;&#x7406;&#xff1a;&#x8fc7;&#x6ee4;&#x6027;&#x80fd;&#x5dee;&#x7684; provider\n\n*   &#x7b2c;&#x4e00;&#x79cd;&#xff1a;&#x8fc7;&#x6ee4;&#x6389;&#x5728; Eureka &#x4e2d;&#x5904;&#x4e8e;&#x4e00;&#x76f4;&#x8fde;&#x63a5;&#x5931;&#x8d25;&#x7684; provider&#x3002;\n*   &#x7b2c;&#x4e8c;&#x79cd;&#xff1a;&#x8fc7;&#x6ee4;&#x6389;&#x9ad8;&#x5e76;&#x53d1;&#xff08;&#x7e41;&#x5fd9;&#xff09;&#x7684; provider&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"228,234"}}],"payload":{"tag":"h2","lines":"225,227"}},{"content":"3.7&#x3001;&#x533a;&#x57df;&#x654f;&#x611f;&#x6027;&#x7b56;&#x7565;","children":[{"content":"<pre data-lines=\"238,244\"><code>&#x7b56;&#x7565;&#x5bf9;&#x5e94;&#x7c7b;&#x540d;&#xff1a;`ZoneAvoidanceRule`\n\n&#x5b9e;&#x73b0;&#x539f;&#x7406;&#xff1a;\n\n*   &#x4ee5;&#x4e00;&#x4e2a;&#x533a;&#x57df;&#x4e3a;&#x5355;&#x4f4d;&#x8003;&#x5bdf;&#x53ef;&#x7528;&#x6027;&#xff0c;&#x5bf9;&#x4e8e;&#x4e0d;&#x53ef;&#x7528;&#x7684;&#x533a;&#x57df;&#x6574;&#x4e2a;&#x4e22;&#x5f03;&#xff0c;&#x4ece;&#x5269;&#x4e0b;&#x533a;&#x57df;&#x4e2d;&#x9009;&#x53ef;&#x7528;&#x7684; provider&#x3002;\n*   &#x5982;&#x679c;&#x8fd9;&#x4e2a; ip &#x533a;&#x57df;&#x5185;&#x6709;&#x4e00;&#x4e2a;&#x6216;&#x591a;&#x4e2a;&#x5b9e;&#x4f8b;&#x4e0d;&#x53ef;&#x8fbe;&#x6216;&#x54cd;&#x5e94;&#x53d8;&#x6162;&#xff0c;&#x90fd;&#x4f1a;&#x964d;&#x4f4e;&#x8be5; ip &#x533a;&#x57df;&#x5185;&#x5176;&#x4ed6; ip &#x88ab;&#x9009;&#x4e2d;&#x7684;&#x6743;&#x91cd;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"238,244"}}],"payload":{"tag":"h2","lines":"235,237"}},{"content":"4.1&#x3001;&#x5168;&#x5c40;&#x66ff;&#x6362;","children":[{"content":"<pre data-lines=\"248,249\"><code>&#x5728;&#x542f;&#x52a8;&#x7c7b;&#x6216;&#x914d;&#x7f6e;&#x7c7b;&#x4e2d;&#x6ce8;&#x5165;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x7b56;&#x7565;&#x5bf9;&#x8c61;&#xff0c;&#x6240;&#x6709;&#x670d;&#x52a1;&#x8bf7;&#x6c42;&#x5747;&#x4f7f;&#x7528;&#x8be5;&#x7b56;&#x7565;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"248,249"}},{"content":"<pre data-lines=\"250,271\"><code class=\"language-java\"><span class=\"hljs-meta\">@EnableEurekaClient</span>\n<span class=\"hljs-meta\">@SpringBootApplication</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ServiceConsumer9001Application</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        SpringApplication.run(ServiceConsumer9001Application.class);\n    }\n\n    <span class=\"hljs-meta\">@Bean</span>\n    <span class=\"hljs-meta\">@LoadBalanced</span> <span class=\"hljs-comment\">// Ribbbon &#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x6ce8;&#x89e3;&#xff0c;&#x52a0;&#x4e0a;&#x8fd9;&#x4e2a;&#x6ce8;&#x89e3;&#xff0c;restTemplate&#x9ed8;&#x8ba4;&#x5c31;&#x6709;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x7684;&#x80fd;&#x529b;&#x4e86;</span>\n    <span class=\"hljs-keyword\">public</span> RestTemplate <span class=\"hljs-title function_\">restTemplate</span><span class=\"hljs-params\">()</span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RestTemplate</span>();\n    }\n\n    <span class=\"hljs-meta\">@Bean</span>\n    <span class=\"hljs-keyword\">public</span> RandomRule <span class=\"hljs-title function_\">randomRule</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RandomRule</span>();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"250,271"}},{"content":"<pre data-lines=\"272,273\"><code>&#x91cd;&#x542f;&#x6d88;&#x8d39;&#x8005;&#x7136;&#x540e;&#x591a;&#x6b21;&#x8bbf;&#x95ee;&#xff1a;http://localhost:9001/consumer/product/findByPid2?pid=1&#xff0c;&#x7ed3;&#x679c;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"272,273"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/e4eab4b39fd667c9622d90a0527c697d.png\" alt>","children":[],"payload":{"tag":"img","lines":"274,275"}}],"payload":{"tag":"h2","lines":"245,247"}},{"content":"4.2&#x3001;&#x5c40;&#x90e8;&#x66ff;&#x6362;","children":[{"content":"<pre data-lines=\"279,280\"><code>&#x8bf7;&#x6ce8;&#x91ca;&#x6389;&#x521a;&#x624d;&#x7684;&#x5168;&#x5c40;&#x8bbe;&#x7f6e;&#xff0c;&#x907f;&#x514d;&#x5f71;&#x54cd;&#x7ed3;&#x679c;&#xff0c;&#x4fee;&#x6539;&#x914d;&#x7f6e;&#x6587;&#x4ef6;&#x6307;&#x5b9a;&#x670d;&#x52a1;&#x7684;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x7b56;&#x7565;&#x3002;&#x683c;&#x5f0f;&#xff1a;`&#x670d;&#x52a1;&#x5e94;&#x7528;&#x540d;.ribbon.NFLoadBalancerRuleClassName`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"279,280"}},{"content":"<pre data-lines=\"281,289\"><code class=\"language-yaml\"><span class=\"hljs-comment\"># &#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x7b56;&#x7565;</span>\n<span class=\"hljs-comment\"># service-provider &#x4e3a;&#x8c03;&#x7528;&#x7684;&#x670d;&#x52a1;&#x7684;&#x540d;&#x79f0;</span>\n<span class=\"hljs-attr\">service-provider:</span>\n  <span class=\"hljs-attr\">ribbon:</span>\n    <span class=\"hljs-attr\">NFLoadBalancerRuleClassName:</span> <span class=\"hljs-string\">com.netflix.loadbalancer.RandomRule</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"281,289"}},{"content":"<pre data-lines=\"290,291\"><code>&#x91cd;&#x542f;&#x6d88;&#x8d39;&#x8005;&#x7136;&#x540e;&#x591a;&#x6b21;&#x8bbf;&#x95ee;&#xff1a;http://localhost:9001/consumer/product/findByPid2?pid=1&#xff0c;&#x7ed3;&#x679c;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"290,291"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/a5a795b81e50f3af60bbe787e7ab1d6c.png\" alt>","children":[],"payload":{"tag":"img","lines":"292,293"}}],"payload":{"tag":"h2","lines":"276,278"}},{"content":"5.1&#x3001;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x7b97;&#x6cd5;","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/781f0751b0cd1e0db87be5440fd1d5e3.png\" alt>","children":[],"payload":{"tag":"img","lines":"297,298"}}],"payload":{"tag":"h2","lines":"294,296"}},{"content":"5.2&#x3001;&#x8f6e;&#x8be2;&#x7b56;&#x7565;&#x6e90;&#x7801;","children":[{"content":"<pre data-lines=\"302,315\"><code>**&#x6838;&#x5fc3;**&#xff1a;&#x81ea;&#x65cb;&#x9501;&#xff0c;`private int incrementAndGetModulo(int modulo)`&#x65b9;&#x6cd5;&#x7528;&#x5230;&#x4e86;&#x81ea;&#x65cb;&#x9501;\n\n**&#x5b9a;&#x4e49;&#xff1a;**   \n&#x81ea;&#x65cb;&#x9501;&#xff08;spin lock&#xff09;&#x662f;&#x4e00;&#x79cd;&#x975e;&#x963b;&#x585e;&#x9501;&#xff0c;&#x4e5f;&#x5c31;&#x662f;&#x8bf4;&#xff0c;&#x5982;&#x679c;&#x67d0;&#x7ebf;&#x7a0b;&#x9700;&#x8981;&#x83b7;&#x53d6;&#x9501;&#xff0c;&#x4f46;&#x8be5;&#x9501;&#x5df2;&#x7ecf;&#x88ab;&#x5176;&#x4ed6;&#x7ebf;&#x7a0b;&#x5360;&#x7528;&#x65f6;&#xff0c;&#x8be5;&#x7ebf;&#x7a0b;&#x4e0d;&#x4f1a;&#x88ab;&#x6302;&#x8d77;&#xff0c;&#x800c;&#x662f;&#x5728;&#x4e0d;&#x65ad;&#x7684;&#x6d88;&#x8017;CPU&#x7684;&#x65f6;&#x95f4;&#xff0c;&#x4e0d;&#x505c;&#x7684;&#x8bd5;&#x56fe;&#x83b7;&#x53d6;&#x9501;&#x3002;&#x7ebf;&#x7a0b;&#x53cd;&#x590d;&#x68c0;&#x67e5;&#x9501;&#x53d8;&#x91cf;&#x662f;&#x5426;&#x53ef;&#x7528;&#x3002;&#x7531;&#x4e8e;&#x7ebf;&#x7a0b;&#x5728;&#x8fd9;&#x4e00;&#x8fc7;&#x7a0b;&#x4e2d;&#x4fdd;&#x6301;&#x6267;&#x884c;&#xff0c;&#x56e0;&#x6b64;&#x662f;&#x4e00;&#x79cd;&#x5fd9;&#x7b49;&#x5f85;&#x3002;\n\n**&#x4f5c;&#x7528;&#xff1a;**   \n&#x81ea;&#x65cb;&#x9501;&#x907f;&#x514d;&#x4e86;&#x8fdb;&#x7a0b;&#x4e0a;&#x4e0b;&#x6587;&#x7684;&#x8c03;&#x5ea6;&#x5f00;&#x9500;&#x3002;&#x7ebf;&#x7a0b;&#x4e00;&#x76f4;&#x5904;&#x4e8e;&#x7528;&#x6237;&#x6001;&#xff0c;&#x51cf;&#x5c11;&#x4e86;&#x7528;&#x6237;&#x6001;&#x5230;&#x5185;&#x6838;&#x6001;&#x7684;&#x5f00;&#x9500;&#x4e0e;&#x635f;&#x8017;&#xff08;&#x51cf;&#x5c11;&#x4e86;&#x4e0a;&#x4e0b;&#x6587;&#x5207;&#x6362;&#xff09;&#x3002;\n\n**&#x9002;&#x7528;&#x573a;&#x666f;&#xff1a;**   \n1&#x3001;&#x591a;&#x7ebf;&#x7a0b;  \n2&#x3001;&#x4f7f;&#x7528;&#x8005;&#x5360;&#x6709;&#x9501;&#x7684;&#x65f6;&#x95f4;&#x77ed;\n\n**&#x8f6e;&#x8be2;&#x6e90;&#x7801;&#xff1a;** \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"302,315"}},{"content":"<pre data-lines=\"316,394\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">RoundRobinRule</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">AbstractLoadBalancerRule</span> {\n    <span class=\"hljs-keyword\">private</span> AtomicInteger nextServerCyclicCounter;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-variable\">AVAILABLE_ONLY_SERVERS</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">true</span>;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-variable\">ALL_SERVERS</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">false</span>;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">Logger</span> <span class=\"hljs-variable\">log</span> <span class=\"hljs-operator\">=</span> LoggerFactory.getLogger(RoundRobinRule.class);\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">RoundRobinRule</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-built_in\">this</span>.nextServerCyclicCounter = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AtomicInteger</span>(<span class=\"hljs-number\">0</span>);\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">RoundRobinRule</span><span class=\"hljs-params\">(ILoadBalancer lb)</span> {\n        <span class=\"hljs-built_in\">this</span>();\n        <span class=\"hljs-built_in\">this</span>.setLoadBalancer(lb);\n    }\n\n    <span class=\"hljs-keyword\">public</span> Server <span class=\"hljs-title function_\">choose</span><span class=\"hljs-params\">(ILoadBalancer lb, Object key)</span> {\n        <span class=\"hljs-keyword\">if</span> (lb == <span class=\"hljs-literal\">null</span>) {\n            log.warn(<span class=\"hljs-string\">&quot;no load balancer&quot;</span>);\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;\n        } <span class=\"hljs-keyword\">else</span> {\n            <span class=\"hljs-type\">Server</span> <span class=\"hljs-variable\">server</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">count</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n\n            <span class=\"hljs-keyword\">while</span>(<span class=\"hljs-literal\">true</span>) {\n                <span class=\"hljs-keyword\">if</span> (server == <span class=\"hljs-literal\">null</span> &amp;&amp; count++ &lt; <span class=\"hljs-number\">10</span>) {\n                    List&lt;Server&gt; reachableServers = lb.getReachableServers();\n                    List&lt;Server&gt; allServers = lb.getAllServers();\n                    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">upCount</span> <span class=\"hljs-operator\">=</span> reachableServers.size();\n                    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">serverCount</span> <span class=\"hljs-operator\">=</span> allServers.size();\n                    <span class=\"hljs-keyword\">if</span> (upCount != <span class=\"hljs-number\">0</span> &amp;&amp; serverCount != <span class=\"hljs-number\">0</span>) {\n                        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">nextServerIndex</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-built_in\">this</span>.incrementAndGetModulo(serverCount);\n                        server = (Server)allServers.get(nextServerIndex);\n                        <span class=\"hljs-keyword\">if</span> (server == <span class=\"hljs-literal\">null</span>) {\n                            Thread.<span class=\"hljs-keyword\">yield</span>();\n                        } <span class=\"hljs-keyword\">else</span> {\n                            <span class=\"hljs-keyword\">if</span> (server.isAlive() &amp;&amp; server.isReadyToServe()) {\n                                <span class=\"hljs-keyword\">return</span> server;\n                            }\n\n                            server = <span class=\"hljs-literal\">null</span>;\n                        }\n                        <span class=\"hljs-keyword\">continue</span>;\n                    }\n\n                    log.warn(<span class=\"hljs-string\">&quot;No up servers available from load balancer: &quot;</span> + lb);\n                    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;\n                }\n\n                <span class=\"hljs-keyword\">if</span> (count &gt;= <span class=\"hljs-number\">10</span>) {\n                    log.warn(<span class=\"hljs-string\">&quot;No available alive servers after 10 tries from load balancer: &quot;</span> + lb);\n                }\n\n                <span class=\"hljs-keyword\">return</span> server;\n            }\n        }\n    }\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">incrementAndGetModulo</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> modulo)</span> {\n        <span class=\"hljs-type\">int</span> current;\n        <span class=\"hljs-type\">int</span> next;\n        <span class=\"hljs-keyword\">do</span> {\n            current = <span class=\"hljs-built_in\">this</span>.nextServerCyclicCounter.get();\n            next = (current + <span class=\"hljs-number\">1</span>) % modulo;\n        } <span class=\"hljs-keyword\">while</span>(!<span class=\"hljs-built_in\">this</span>.nextServerCyclicCounter.compareAndSet(current, next));\n\n        <span class=\"hljs-keyword\">return</span> next;\n    }\n\n    <span class=\"hljs-keyword\">public</span> Server <span class=\"hljs-title function_\">choose</span><span class=\"hljs-params\">(Object key)</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">this</span>.choose(<span class=\"hljs-built_in\">this</span>.getLoadBalancer(), key);\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initWithNiwsConfig</span><span class=\"hljs-params\">(IClientConfig clientConfig)</span> {\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"316,394"}}],"payload":{"tag":"h2","lines":"299,301"}},{"content":"5.3&#x3001;&#x624b;&#x5199;&#x8d1f;&#x8f7d;&#x5747;&#x8861;","children":[{"content":"<pre data-lines=\"398,403\"><code>&#xff08;1&#xff09;&#x521b;&#x5efa;&#x4e00;&#x4e2a;&#x63d2;&#x4ef6;&#x5305;&#x540d;&#x5b57;&#x53eb;&#xff1a;`com.caochenlei.plugin`\n\n&#xff08;2&#xff09;&#x5728;&#x8fd9;&#x4e2a;&#x63d2;&#x4ef6;&#x5305;&#x4e2d;&#x65b0;&#x5efa;&#x7c7b;&#xff1a;`MyLoadBalanced`\n\n&#xff08;3&#xff09;&#x624b;&#x5199;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x5668;&#x6765;&#x66ff;&#x4ee3;&#x9ed8;&#x8ba4;&#x7684;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x5668;&#x6ce8;&#x89e3;`@LoadBalanced`&#xff0c;&#x6e90;&#x7801;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"398,403"}},{"content":"<pre data-lines=\"404,430\"><code class=\"language-java\"><span class=\"hljs-meta\">@Component</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyLoadBalanced</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">AtomicInteger</span> <span class=\"hljs-variable\">atomicInteger</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AtomicInteger</span>(<span class=\"hljs-number\">0</span>);\n\n    <span class=\"hljs-comment\">//&#x83b7;&#x53d6;&#x670d;&#x52a1;&#x63d0;&#x4f9b;&#x8005;&#x5b9e;&#x4f8b;&#x4e0b;&#x6807;</span>\n    <span class=\"hljs-keyword\">public</span> ServiceInstance <span class=\"hljs-title function_\">instances</span><span class=\"hljs-params\">(List&lt;ServiceInstance&gt; serviceInstances)</span> {\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">index</span> <span class=\"hljs-operator\">=</span> getAndIncrement() % serviceInstances.size();\n        <span class=\"hljs-keyword\">return</span> serviceInstances.get(index);\n    }\n\n    <span class=\"hljs-comment\">//&#x4f7f;&#x7528;&#x81ea;&#x65cb;&#x9501;&#x8fdb;&#x884c;&#x7d2f;&#x52a0;&#x64cd;&#x4f5c;</span>\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">getAndIncrement</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-type\">int</span> current;\n        <span class=\"hljs-type\">int</span> next;\n        <span class=\"hljs-keyword\">do</span> {\n            current = <span class=\"hljs-built_in\">this</span>.atomicInteger.get();\n            next = current &gt;= Integer.MAX_VALUE ? <span class=\"hljs-number\">0</span> : current + <span class=\"hljs-number\">1</span>;\n            <span class=\"hljs-comment\">//&#x7b2c;&#x4e00;&#x4e2a;&#x53c2;&#x6570;&#x662f;&#x671f;&#x671b;&#x503c;&#xff0c;&#x7b2c;&#x4e8c;&#x4e2a;&#x53c2;&#x6570;&#x662f;&#x4fee;&#x6539;&#x503c;</span>\n        } <span class=\"hljs-keyword\">while</span> (!<span class=\"hljs-built_in\">this</span>.atomicInteger.compareAndSet(current, next));\n        System.out.println(<span class=\"hljs-string\">&quot;&#x8bbf;&#x95ee;&#x6b21;&#x6570;&#xff1a;&quot;</span> + next);\n        <span class=\"hljs-keyword\">return</span> next;\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"404,430"}},{"content":"<pre data-lines=\"431,432\"><code>&#xff08;4&#xff09;&#x5728;&#x63a7;&#x5236;&#x5668;&#x7c7b;`ProductController`&#x4e2d;&#x65b0;&#x589e;&#x5982;&#x4e0b;&#x6d4b;&#x8bd5;&#x4ee3;&#x7801;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"431,432"}},{"content":"<pre data-lines=\"433,454\"><code class=\"language-java\"><span class=\"hljs-meta\">@Autowired</span>\n<span class=\"hljs-keyword\">private</span> MyLoadBalanced loadBalanced;\n\n<span class=\"hljs-meta\">@RequestMapping(&quot;/consumer/product/findByPid3&quot;)</span>\n<span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">findByPid3</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@RequestParam(&quot;pid&quot;)</span> Integer pid)</span> {\n    <span class=\"hljs-comment\">//&#x83b7;&#x53d6;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;&#x670d;&#x52a1;&#x5217;&#x8868;</span>\n    List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class=\"hljs-string\">&quot;SERVICE-PROVIDER&quot;</span>);\n    <span class=\"hljs-keyword\">if</span> (CollectionUtils.isEmpty(instances)) {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;\n    }\n\n    <span class=\"hljs-comment\">//&#x4f7f;&#x7528;&#x81ea;&#x5b9a;&#x4e49;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x5668;</span>\n    <span class=\"hljs-type\">ServiceInstance</span> <span class=\"hljs-variable\">si</span> <span class=\"hljs-operator\">=</span> loadBalanced.instances(instances);\n    <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">findByPidUrl</span> <span class=\"hljs-operator\">=</span> si.getUri() + <span class=\"hljs-string\">&quot;/provider/product/findByPid&quot;</span> + <span class=\"hljs-string\">&quot;?pid=&quot;</span> + pid;\n    <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">product</span> <span class=\"hljs-operator\">=</span> restTemplate.getForObject(findByPidUrl, String.class);\n    System.out.println(product);\n    <span class=\"hljs-keyword\">return</span> product;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"433,454"}},{"content":"<pre data-lines=\"455,456\"><code>&#xff08;5&#xff09;&#x6ce8;&#x91ca;&#x914d;&#x7f6e;&#x6587;&#x4ef6;&#x4e2d;&#x914d;&#x7f6e;&#x7684;&#x968f;&#x673a;&#x7b56;&#x7565;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"455,456"}},{"content":"<pre data-lines=\"457,465\"><code class=\"language-yaml\"><span class=\"hljs-comment\"># &#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x7b56;&#x7565;</span>\n<span class=\"hljs-comment\"># SERVICE-PROVIDER &#x4e3a;&#x8c03;&#x7528;&#x7684;&#x670d;&#x52a1;&#x7684;&#x540d;&#x79f0;</span>\n<span class=\"hljs-comment\">#SERVICE-PROVIDER:</span>\n<span class=\"hljs-comment\">#  ribbon:</span>\n<span class=\"hljs-comment\">#    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"457,465"}},{"content":"<pre data-lines=\"466,467\"><code>&#xff08;6&#xff09;&#x6ce8;&#x91ca;Ribbon&#x9ed8;&#x8ba4;&#x7684;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x5668;&#x6ce8;&#x89e3;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"466,467"}},{"content":"<pre data-lines=\"468,489\"><code class=\"language-java\"><span class=\"hljs-meta\">@EnableEurekaClient</span>\n<span class=\"hljs-meta\">@SpringBootApplication</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ServiceConsumer9001Application</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        SpringApplication.run(ServiceConsumer9001Application.class);\n    }\n\n    <span class=\"hljs-meta\">@Bean</span>\n    <span class=\"hljs-comment\">//@LoadBalanced // Ribbbon &#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x6ce8;&#x89e3;&#xff0c;&#x52a0;&#x4e0a;&#x8fd9;&#x4e2a;&#x6ce8;&#x89e3;&#xff0c;restTemplate&#x9ed8;&#x8ba4;&#x5c31;&#x6709;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x7684;&#x80fd;&#x529b;&#x4e86;</span>\n    <span class=\"hljs-keyword\">public</span> RestTemplate <span class=\"hljs-title function_\">restTemplate</span><span class=\"hljs-params\">()</span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RestTemplate</span>();\n    }\n\n<span class=\"hljs-comment\">//    @Bean</span>\n<span class=\"hljs-comment\">//    public RandomRule randomRule() {</span>\n<span class=\"hljs-comment\">//        return new RandomRule();</span>\n<span class=\"hljs-comment\">//    }</span>\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"468,489"}}],"payload":{"tag":"h2","lines":"395,397"}},{"content":"5.4&#x3001;&#x6d4b;&#x8bd5;&#x6700;&#x7ec8;&#x6548;&#x679c;","children":[{"content":"<pre data-lines=\"493,494\"><code>&#x91cd;&#x542f;&#x6d88;&#x8d39;&#x8005;&#x7136;&#x540e;&#x591a;&#x6b21;&#x8bbf;&#x95ee;&#xff1a;http://localhost:9001/consumer/product/findByPid3?pid=1&#xff0c;&#x7ed3;&#x679c;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"493,494"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/77e12bd63a43e8f9a0c60b955f594367.png\" alt>","children":[],"payload":{"tag":"img","lines":"495,496"}},{"content":"<pre data-lines=\"497,498\"><code>&gt; &#x6ce8;&#x610f;&#xff1a;&#x6b64;&#x65f6;&#x5982;&#x679c;&#x4f60;&#x8bbf;&#x95ee;http://localhost:9001/consumer/product/findByPid2?pid=1&#xff0c;&#x5219;&#x4f1a;&#x62a5;&#x9519;&#xff0c;&#x56e0;&#x4e3a;&#x8fd9;&#x4e2a;&#x65b9;&#x6cd5;&#x4e2d;&#x4f7f;&#x7528;&#x7684;&#x662f;&#x9ed8;&#x8ba4;&#x7684;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x5668;&#xff0c;&#x521a;&#x624d;&#x6211;&#x4eec;&#x5df2;&#x7ecf;&#x6ce8;&#x91ca;&#x6389;&#x4e86;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"497,498"}}],"payload":{"tag":"h2","lines":"490,492"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
