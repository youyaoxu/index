<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"&#x8c03;&#x548c;&#x5355;&#x4e2a;&#x8282;&#x70b9;","children":[{"content":"<pre data-lines=\"2,9\"><code>&#x7b2c;&#x4e00;&#x4e2a;`while`&#x5faa;&#x73af;&#x7684;&#x76ee;&#x7684;&#x660e;&#x663e;&#x5c31;&#x662f;&#x627e;&#x5230;&#x8001;&#x7684;`children`&#x548c;&#x65b0;&#x7684;`children`&#x4e2d;&#x7b2c;&#x4e00;&#x4e2a;**`key`&#x548c;&#x8282;&#x70b9;&#x7c7b;&#x578b;**&#x76f8;&#x540c;&#x7684;&#x8282;&#x70b9;&#xff0c;&#x76f4;&#x63a5;&#x590d;&#x7528;&#x8fd9;&#x4e2a;&#x8282;&#x70b9;&#xff0c;&#x7136;&#x540e;&#x5220;&#x9664;&#x8001;&#x7684;`children`&#x4e2d;&#x5176;&#x4ed6;&#x7684;&#xff08;&#x6211;&#x4eec;&#x65e0;&#x6cd5;&#x4fdd;&#x8bc1;&#x65b0;&#x7684;`children`&#x662f;&#x5355;&#x4e2a;&#x8282;&#x70b9;&#x7684;&#x65f6;&#x5019;&#x8001;&#x7684;`children`&#x4e5f;&#x662f;&#x5355;&#x4e2a;&#x7684;&#xff0c;&#x6240;&#x4ee5;&#x8981;&#x7528;&#x904d;&#x5386;&#x3002;&#xff09;\n\n**&#x6ce8;&#x610f;`key`&#x4e3a;`null`&#x6211;&#x4eec;&#x4e5f;&#x8ba4;&#x4e3a;&#x662f;&#x76f8;&#x7b49;&#xff0c;&#x56e0;&#x4e3a;&#x5355;&#x4e2a;&#x8282;&#x70b9;&#x6ca1;&#x6709;`key`&#x4e5f;&#x662f;&#x6b63;&#x5e38;&#x7684;**\n\n&#x5982;&#x679c;&#x627e;&#x4e86;&#x4e00;&#x5708;&#x6ca1;&#x53d1;&#x73b0;&#xff0c;&#x90a3;&#x4e48;&#x5c31;&#x628a;&#x8001;&#x7684;`children`&#x90fd;&#x5220;&#x4e86;&#xff0c;&#x91cd;&#x65b0;&#x4e3a;&#x65b0;&#x7684;`children`&#x521b;&#x5efa;&#x8282;&#x70b9;&#x3002;\n\n`coerceRef`&#x7684;&#x4f5c;&#x7528;&#x662f;&#x628a;&#x89c4;&#x8303;&#x5316;`ref`&#xff0c;&#x56e0;&#x4e3a;`ref`&#x6709;&#x4e09;&#x79cd;&#x5f62;&#x5f0f;&#xff0c;`string ref`&#x8981;&#x8f6c;&#x6362;&#x6210;&#x65b9;&#x6cd5;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2,9"}},{"content":"<pre data-lines=\"10,71\"><code data-lines=\"10,71\"><span class=\"hljs-function\">function <span class=\"hljs-title\">coerceRef</span>(<span class=\"hljs-params\">\n  returnFiber: Fiber,\n  current: Fiber | <span class=\"hljs-literal\">null</span>,\n  element: ReactElement,\n</span>)</span> {\n  <span class=\"hljs-keyword\">let</span> mixedRef = element.<span class=\"hljs-function\"><span class=\"hljs-keyword\">ref</span>\n  <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">\n    mixedRef !== <span class=\"hljs-literal\">null</span> &amp;&amp;\n    <span class=\"hljs-keyword\">typeof</span> mixedRef !== <span class=\"hljs-string\">&apos;function&apos;</span> &amp;&amp;\n    <span class=\"hljs-keyword\">typeof</span> mixedRef !== <span class=\"hljs-string\">&apos;object&apos;</span>\n  </span>)</span> {\n    <span class=\"hljs-keyword\">if</span> (element._owner) {\n      <span class=\"hljs-keyword\">const</span> owner: ?Fiber = (element._owner: any)\n      <span class=\"hljs-function\"><span class=\"hljs-keyword\">let</span> inst\n      <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">owner</span>)</span> {\n        <span class=\"hljs-keyword\">const</span> ownerFiber = ((owner: any): Fiber)\n        invariant(\n          ownerFiber.tag === ClassComponent,\n          <span class=\"hljs-string\">&apos;Function components cannot have refs.&apos;</span>,\n        )\n        inst = ownerFiber.stateNode\n      }\n      invariant(\n        inst,\n        <span class=\"hljs-string\">&apos;Missing owner for string ref %s. This error is likely caused by a &apos;</span> +\n          <span class=\"hljs-string\">&apos;bug in React. Please file an issue.&apos;</span>,\n        mixedRef,\n      )\n      <span class=\"hljs-keyword\">const</span> stringRef = <span class=\"hljs-string\">&apos;&apos;</span> + <span class=\"hljs-function\">mixedRef\n      \n      <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">\n        current !== <span class=\"hljs-literal\">null</span> &amp;&amp;\n        current.<span class=\"hljs-keyword\">ref</span> !== <span class=\"hljs-literal\">null</span> &amp;&amp;\n        <span class=\"hljs-keyword\">typeof</span> current.<span class=\"hljs-keyword\">ref</span> === <span class=\"hljs-string\">&apos;function&apos;</span> &amp;&amp;\n        current.<span class=\"hljs-keyword\">ref</span>._stringRef === stringRef\n      </span>)</span> {\n        <span class=\"hljs-keyword\">return</span> current.<span class=\"hljs-keyword\">ref</span>\n      }\n      <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">ref</span> = function(<span class=\"hljs-keyword\">value</span>) {\n        <span class=\"hljs-keyword\">let</span> refs = inst.<span class=\"hljs-function\">refs\n        <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">refs === emptyRefsObject</span>)</span> {\n          \n          refs = inst.refs = {}\n        }\n        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">value</span> === <span class=\"hljs-literal\">null</span>) {\n          delete refs[stringRef]\n        } <span class=\"hljs-keyword\">else</span> {\n          refs[stringRef] = <span class=\"hljs-keyword\">value</span>\n        }\n      }\n      <span class=\"hljs-keyword\">ref</span>._stringRef = stringRef\n      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">ref</span>\n    } <span class=\"hljs-keyword\">else</span> {\n      \n    }\n  }\n  <span class=\"hljs-keyword\">return</span> mixedRef\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"10,71"}},{"content":"<pre data-lines=\"72,73\"><code>&#x8fd9;&#x4e2a;&#x65b9;&#x6cd5;&#x53ef;&#x4ee5;&#x770b;&#x51fa;&#x6765;&#x4f1a;&#x628a;`string ref`&#x8f6c;&#x6362;&#x6210;&#x4e00;&#x4e2a;&#x65b9;&#x6cd5;&#xff0c;&#x6700;&#x7ec8;&#x4f1a;&#x628a;&#x5bf9;&#x8c61;&#x8bbe;&#x7f6e;&#x5230;`inst.refs`&#x4e0a;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"72,73"}},{"content":"<pre data-lines=\"74,139\"><code data-lines=\"74,139\">function reconcileSingleElement(\n  returnFiber: Fiber,\n  currentFirstChild: Fiber | <span class=\"hljs-literal\">null</span>,\n  element: ReactElement,\n  expirationTime: ExpirationTime,\n): Fiber {\n  <span class=\"hljs-keyword\">const</span> key = element.key\n  let child = currentFirstChild\n  <span class=\"hljs-keyword\">while</span> (child !== <span class=\"hljs-literal\">null</span>) {\n    \n    \n    <span class=\"hljs-keyword\">if</span> (child.key === key) {\n      <span class=\"hljs-keyword\">if</span> (\n        child.tag === Fragment\n          ? element.type === REACT_FRAGMENT_TYPE\n          : child.elementType === element.type\n      ) {\n        deleteRemainingChildren(returnFiber, child.sibling)\n        <span class=\"hljs-keyword\">const</span> existing = useFiber(\n          child,\n          element.type === REACT_FRAGMENT_TYPE\n            ? element.props.children\n            : element.props,\n          expirationTime,\n        )\n        existing.ref = coerceRef(returnFiber, child, element)\n        existing.<span class=\"hljs-keyword\">return</span> = returnFiber\n        <span class=\"hljs-keyword\">if</span> (__DEV__) {\n          existing._debugSource = element._source\n          existing._debugOwner = element._owner\n        }\n        <span class=\"hljs-keyword\">return</span> existing\n      } <span class=\"hljs-keyword\">else</span> {\n        deleteRemainingChildren(returnFiber, child)\n        <span class=\"hljs-keyword\">break</span>\n      }\n    } <span class=\"hljs-keyword\">else</span> {\n      deleteChild(returnFiber, child)\n    }\n    child = child.sibling\n  }\n\n  <span class=\"hljs-keyword\">if</span> (element.type === REACT_FRAGMENT_TYPE) {\n    <span class=\"hljs-keyword\">const</span> created = createFiberFromFragment(\n      element.props.children,\n      returnFiber.mode,\n      expirationTime,\n      element.key,\n    )\n    created.<span class=\"hljs-keyword\">return</span> = returnFiber\n    <span class=\"hljs-keyword\">return</span> created\n  } <span class=\"hljs-keyword\">else</span> {\n    <span class=\"hljs-keyword\">const</span> created = createFiberFromElement(\n      element,\n      returnFiber.mode,\n      expirationTime,\n    )\n    created.ref = coerceRef(returnFiber, currentFirstChild, element)\n    created.<span class=\"hljs-keyword\">return</span> = returnFiber\n    <span class=\"hljs-keyword\">return</span> created\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"74,139"}},{"content":"<pre data-lines=\"140,141\"><code>`portal`&#x5176;&#x5b9e;&#x5c31;&#x662f;&#x7279;&#x6b8a;&#x7684;`ReactElement`&#xff0c;&#x4ed6;&#x7684;`&#x24;&#x24;typeof`&#x4e0d;&#x662f;`REACT_ELEMENT_TYPE`&#x3002;&#x4f46;&#x662f;&#x4ed6;&#x4eec;&#x7684;&#x5904;&#x7406;&#x65b9;&#x5f0f;&#x5176;&#x5b9e;&#x5dee;&#x4e0d;&#x591a;&#xff0c;&#x4e5f;&#x90fd;&#x662f;&#x5faa;&#x73af;&#x8001;&#x7684;`children`&#x627e;&#x80fd;&#x590d;&#x7528;&#x7684;&#xff0c;&#x627e;&#x4e0d;&#x5230;&#x5c31;&#x521b;&#x5efa;&#x65b0;&#x7684;&#xff0c;&#x53ea;&#x662f;&#x521b;&#x5efa;`Fiber`&#x7684;&#x65b9;&#x6cd5;&#x4e0d;&#x4e00;&#x6837;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"140,141"}},{"content":"<pre data-lines=\"142,182\"><code data-lines=\"142,182\">function reconcileSinglePortal(\n  returnFiber: Fiber,\n  currentFirstChild: Fiber | <span class=\"hljs-literal\">null</span>,\n  portal: ReactPortal,\n  expirationTime: ExpirationTime,\n): Fiber {\n  <span class=\"hljs-keyword\">const</span> key = portal.key\n  let child = currentFirstChild\n  <span class=\"hljs-keyword\">while</span> (child !== <span class=\"hljs-literal\">null</span>) {\n    <span class=\"hljs-keyword\">if</span> (child.key === key) {\n      <span class=\"hljs-keyword\">if</span> (\n        child.tag === HostPortal &amp;&amp;\n        child.stateNode.containerInfo === portal.containerInfo &amp;&amp;\n        child.stateNode.implementation === portal.implementation\n      ) {\n        deleteRemainingChildren(returnFiber, child.sibling)\n        <span class=\"hljs-keyword\">const</span> existing = useFiber(child, portal.children || [], expirationTime)\n        existing.<span class=\"hljs-keyword\">return</span> = returnFiber\n        <span class=\"hljs-keyword\">return</span> existing\n      } <span class=\"hljs-keyword\">else</span> {\n        deleteRemainingChildren(returnFiber, child)\n        <span class=\"hljs-keyword\">break</span>\n      }\n    } <span class=\"hljs-keyword\">else</span> {\n      deleteChild(returnFiber, child)\n    }\n    child = child.sibling\n  }\n\n  <span class=\"hljs-keyword\">const</span> created = createFiberFromPortal(\n    portal,\n    returnFiber.mode,\n    expirationTime,\n  )\n  created.<span class=\"hljs-keyword\">return</span> = returnFiber\n  <span class=\"hljs-keyword\">return</span> created\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"142,182"}},{"content":"<pre data-lines=\"183,184\"><code>&#x6587;&#x5b57;&#x8282;&#x70b9;&#x7684;&#x5bf9;&#x6bd4;&#x6bd4;&#x8f83;&#x7b80;&#x5355;&#x7c97;&#x66b4;&#xff0c;&#x76f4;&#x63a5;&#x627e;&#x8001;&#x7684;`children`&#x4e2d;&#x7684;&#x7b2c;&#x4e00;&#x4e2a;&#x8282;&#x70b9;&#xff0c;&#x5982;&#x679c;&#x662f;&#x6587;&#x5b57;&#x8282;&#x70b9;&#x5c31;&#x590d;&#x7528;&#xff0c;&#x5982;&#x679c;&#x4e0d;&#x662f;&#x5c31;&#x5220;&#x9664;&#x5168;&#x90e8;&#x8001;&#x7684;&#x8282;&#x70b9;&#xff0c;&#x521b;&#x5efa;&#x65b0;&#x7684;&#x6587;&#x5b57;&#x8282;&#x70b9;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"183,184"}},{"content":"<pre data-lines=\"185,215\"><code data-lines=\"185,215\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">reconcileSingleTextNode</span>(<span class=\"hljs-params\">\n  returnFiber: <span class=\"hljs-built_in\">Fiber</span>,\n  currentFirstChild: <span class=\"hljs-built_in\">Fiber</span> | <span class=\"hljs-literal\">null</span>,\n  textContent: <span class=\"hljs-keyword\">string</span>,\n  expirationTime: ExpirationTime,\n</span>): <span class=\"hljs-title\">Fiber</span> </span>{\n  \n  \n  <span class=\"hljs-keyword\">if</span> (currentFirstChild !== <span class=\"hljs-literal\">null</span> &amp;&amp; currentFirstChild.tag === HostText) {\n    \n    \n    <span class=\"hljs-title function_ invoke__\">deleteRemainingChildren</span>(returnFiber, currentFirstChild.sibling)\n    <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">existing</span> = <span class=\"hljs-title function_ invoke__\">useFiber</span>(currentFirstChild, textContent, expirationTime)\n    existing.<span class=\"hljs-keyword\">return</span> = returnFiber\n    <span class=\"hljs-keyword\">return</span> existing\n  }\n  \n  \n  <span class=\"hljs-title function_ invoke__\">deleteRemainingChildren</span>(returnFiber, currentFirstChild)\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">created</span> = <span class=\"hljs-title function_ invoke__\">createFiberFromText</span>(\n    textContent,\n    returnFiber.mode,\n    expirationTime,\n  )\n  created.<span class=\"hljs-keyword\">return</span> = returnFiber\n  <span class=\"hljs-keyword\">return</span> created\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"185,215"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"216,217"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"220,221"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
