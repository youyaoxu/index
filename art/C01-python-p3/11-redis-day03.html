<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"","children":[{"content":"redis_day02&#x56de;&#x987e;","children":[{"content":"&#x4e94;&#x5927;&#x6570;&#x636e;&#x7c7b;&#x578b;&#x53ca;&#x5e94;&#x7528;&#x573a;&#x666f;","children":[{"content":"<table data-lines=\"4,11\">\n<thead data-lines=\"4,5\">\n<tr data-lines=\"4,5\">\n<th style=\"text-align:left\">&#x7c7b;&#x578b;</th>\n<th style=\"text-align:left\">&#x7279;&#x70b9;</th>\n<th style=\"text-align:left\">&#x4f7f;&#x7528;&#x573a;&#x666f;</th>\n</tr>\n</thead>\n<tbody data-lines=\"6,11\">\n<tr data-lines=\"6,7\">\n<td style=\"text-align:left\">string</td>\n<td style=\"text-align:left\">&#x7b80;&#x5355;key-value&#x7c7b;&#x578b;&#xff0c;value&#x53ef;&#x4e3a;&#x5b57;&#x7b26;&#x4e32;&#x548c;&#x6570;&#x5b57;</td>\n<td style=\"text-align:left\">&#x5e38;&#x89c4;&#x8ba1;&#x6570;&#xff08;&#x5fae;&#x535a;&#x6570;, &#x7c89;&#x4e1d;&#x6570;&#x7b49;&#x529f;&#x80fd;&#xff09;</td>\n</tr>\n<tr data-lines=\"7,8\">\n<td style=\"text-align:left\">hash</td>\n<td style=\"text-align:left\">&#x662f;&#x4e00;&#x4e2a;string&#x7c7b;&#x578b;&#x7684;field&#x548c;value&#x7684;&#x6620;&#x5c04;&#x8868;&#xff0c;hash&#x7279;&#x522b;&#x9002;&#x5408;&#x7528;&#x4e8e;&#x5b58;&#x50a8;&#x5bf9;&#x8c61;</td>\n<td style=\"text-align:left\">&#x5b58;&#x50a8;&#x90e8;&#x5206;&#x53ef;&#x80fd;&#x9700;&#x8981;&#x53d8;&#x66f4;&#x7684;&#x6570;&#x636e;&#xff08;&#x6bd4;&#x5982;&#x7528;&#x6237;&#x4fe1;&#x606f;&#xff09;</td>\n</tr>\n<tr data-lines=\"8,9\">\n<td style=\"text-align:left\">list</td>\n<td style=\"text-align:left\">&#x6709;&#x5e8f;&#x53ef;&#x91cd;&#x590d;&#x5217;&#x8868;</td>\n<td style=\"text-align:left\">&#x5173;&#x6ce8;&#x5217;&#x8868;&#xff0c;&#x7c89;&#x4e1d;&#x5217;&#x8868;&#xff0c;&#x6d88;&#x606f;&#x961f;&#x5217;&#x7b49;</td>\n</tr>\n<tr data-lines=\"9,10\">\n<td style=\"text-align:left\">set</td>\n<td style=\"text-align:left\">&#x65e0;&#x5e8f;&#x4e0d;&#x53ef;&#x91cd;&#x590d;&#x5217;&#x8868;</td>\n<td style=\"text-align:left\">&#x5b58;&#x50a8;&#x5e76;&#x8ba1;&#x7b97;&#x5173;&#x7cfb;&#xff08;&#x5982;&#x5fae;&#x535a;&#xff0c;&#x5173;&#x6ce8;&#x4eba;&#x6216;&#x7c89;&#x4e1d;&#x5b58;&#x653e;&#x5728;&#x96c6;&#x5408;&#xff0c;&#x53ef;&#x901a;&#x8fc7;&#x4ea4;&#x96c6;&#x3001;&#x5e76;&#x96c6;&#x3001;&#x5dee;&#x96c6;&#x7b49;&#x64cd;&#x4f5c;&#x5b9e;&#x73b0;&#x5982;&#x5171;&#x540c;&#x5173;&#x6ce8;&#x3001;&#x5171;&#x540c;&#x559c;&#x597d;&#x7b49;&#x529f;&#x80fd;&#xff09;</td>\n</tr>\n<tr data-lines=\"10,11\">\n<td style=\"text-align:left\">sorted set</td>\n<td style=\"text-align:left\">&#x6bcf;&#x4e2a;&#x5143;&#x7d20;&#x5e26;&#x6709;&#x5206;&#x503c;&#x7684;&#x96c6;&#x5408;</td>\n<td style=\"text-align:left\">&#x5404;&#x79cd;&#x6392;&#x884c;&#x699c;</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"4,11"}}],"payload":{"tag":"h2","lines":"2,3"}}],"payload":{"tag":"h1","lines":"0,1"}},{"content":"redis_day03&#x7b14;&#x8bb0;","children":[{"content":"Redis&#x4e3b;&#x4ece;&#x590d;&#x5236;","children":[{"content":"&#x5b9a;&#x4e49;","children":[{"content":"<pre data-lines=\"534,539\"><code class=\"language-python\">1&#x3001;&#x4e00;&#x4e2a;Redis&#x670d;&#x52a1;&#x53ef;&#x4ee5;&#x6709;&#x591a;&#x4e2a;&#x8be5;&#x670d;&#x52a1;&#x7684;&#x590d;&#x5236;&#x54c1;&#xff0c;&#x8fd9;&#x4e2a;Redis&#x670d;&#x52a1;&#x6210;&#x4e3a;master&#xff0c;&#x5176;&#x4ed6;&#x590d;&#x5236;&#x54c1;&#x6210;&#x4e3a;slaves\n2&#x3001;master&#x4f1a;&#x4e00;&#x76f4;&#x5c06;&#x81ea;&#x5df1;&#x7684;&#x6570;&#x636e;&#x66f4;&#x65b0;&#x540c;&#x6b65;&#x7ed9;slaves&#xff0c;&#x4fdd;&#x6301;&#x4e3b;&#x4ece;&#x540c;&#x6b65;\n3&#x3001;&#x53ea;&#x6709;master&#x53ef;&#x4ee5;&#x6267;&#x884c;&#x5199;&#x547d;&#x4ee4;&#xff0c;slave&#x53ea;&#x80fd;&#x6267;&#x884c;&#x8bfb;&#x547d;&#x4ee4;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"534,539"}}],"payload":{"tag":"h3","lines":"532,533"}},{"content":"&#x4f5c;&#x7528;","children":[{"content":"<pre data-lines=\"542,545\"><code class=\"language-python\">&#x5206;&#x62c5;&#x4e86;&#x8bfb;&#x7684;&#x538b;&#x529b;&#xff08;&#x9ad8;&#x5e76;&#x53d1;&#xff09;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"542,545"}}],"payload":{"tag":"h3","lines":"540,541"}},{"content":"&#x539f;&#x7406;","children":[{"content":"<pre data-lines=\"548,551\"><code class=\"language-python\">&#x4ece;&#x670d;&#x52a1;&#x5668;&#x6267;&#x884c;&#x5ba2;&#x6237;&#x7aef;&#x53d1;&#x9001;&#x7684;&#x8bfb;&#x547d;&#x4ee4;&#xff0c;&#x6bd4;&#x5982;GET&#x3001;LRANGE&#x3001;SMEMMBERS&#x3001;HGET&#x3001;ZRANGE&#x7b49;&#x7b49;&#xff0c;&#x5ba2;&#x6237;&#x7aef;&#x53ef;&#x4ee5;&#x8fde;&#x63a5;slaves&#x6267;&#x884c;&#x8bfb;&#x8bf7;&#x6c42;&#xff0c;&#x6765;&#x964d;&#x4f4e;master&#x7684;&#x8bfb;&#x538b;&#x529b;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"548,551"}}],"payload":{"tag":"h3","lines":"546,547"}},{"content":"&#x4e24;&#x79cd;&#x5b9e;&#x73b0;&#x65b9;&#x5f0f;","children":[{"content":"&#x65b9;&#x5f0f;&#x4e00;&#xff08;Linux&#x547d;&#x4ee4;&#x884c;&#x5b9e;&#x73b0;1&#xff09;","children":[{"content":"<pre data-lines=\"556,559\"><code data-lines=\"556,559\">redis-server --slaveof <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">master-ip</span>&gt;</span> <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">master-port</span>&gt;</span> --masterauth <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">master</span> <span class=\"hljs-attr\">password</span>&gt;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"556,559"}},{"content":"<pre data-lines=\"562,574\"><code class=\"language-python\"># &#x4ece;&#x670d;&#x52a1;&#x7aef;\nredis-server --port 6300 --slaveof 127.0.0.1 6379\n# &#x4ece;&#x5ba2;&#x6237;&#x7aef;\nredis-cli -p 6300\n127.0.0.1:6300&gt; keys * \n# &#x53d1;&#x73b0;&#x662f;&#x590d;&#x5236;&#x4e86;&#x539f;6379&#x7aef;&#x53e3;&#x7684;redis&#x4e2d;&#x6570;&#x636e;\n127.0.0.1:6300&gt; set mykey 123\n(error) READONLY You can&apos;t write against a read only slave.\n127.0.0.1:6300&gt; \n# &#x4ece;&#x670d;&#x52a1;&#x5668;&#x53ea;&#x80fd;&#x8bfb;&#x6570;&#x636e;&#xff0c;&#x4e0d;&#x80fd;&#x5199;&#x6570;&#x636e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"562,574"}}],"payload":{"tag":"h4","lines":"554,555"}},{"content":"&#x65b9;&#x5f0f;&#x4e00;&#xff08;Redis&#x547d;&#x4ee4;&#x884c;&#x5b9e;&#x73b0;2&#xff09;","children":[{"content":"<pre data-lines=\"577,582\"><code class=\"language-python\"><span class=\"hljs-comment\"># &#x4e24;&#x6761;&#x547d;&#x4ee4;</span>\n<span class=\"hljs-number\">1</span>&#x3001;&gt;slaveof IP PORT\n<span class=\"hljs-number\">2</span>&#x3001;&gt;slaveof no one\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"577,582"}}],"payload":{"tag":"h4","lines":"575,576"}},{"content":"&#x793a;&#x4f8b;","children":[{"content":"<pre data-lines=\"585,609\"><code class=\"language-python\"># &#x670d;&#x52a1;&#x7aef;&#x542f;&#x52a8;\nredis-server --port 6301\n# &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;\ntarena@tedu:~&#x24; redis-cli -p 6301\n127.0.0.1:6301&gt; keys *\n1) &quot;myset&quot;\n2) &quot;mylist&quot;\n127.0.0.1:6301&gt; set mykey 123\nOK\n# &#x5207;&#x6362;&#x4e3a;&#x4ece;\n127.0.0.1:6301&gt; slaveof 127.0.0.1 6379\nOK\n127.0.0.1:6301&gt; set newkey 456\n(error) READONLY You can&apos;t write against a read only slave.\n127.0.0.1:6301&gt; keys *\n1) &quot;myset&quot;\n2) &quot;mylist&quot; \n# &#x518d;&#x5207;&#x6362;&#x4e3a;&#x4e3b;\n127.0.0.1:6301&gt; slaveof no one\nOK\n127.0.0.1:6301&gt; set name hello\nOK\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"585,609"}}],"payload":{"tag":"h4","lines":"583,584"}},{"content":"&#x65b9;&#x5f0f;&#x4e8c;(&#x4fee;&#x6539;&#x914d;&#x7f6e;&#x6587;&#x4ef6;)","children":[{"content":"<pre data-lines=\"612,629\"><code class=\"language-python\"># &#x6bcf;&#x4e2a;redis&#x670d;&#x52a1;,&#x90fd;&#x6709;1&#x4e2a;&#x548c;&#x4ed6;&#x5bf9;&#x5e94;&#x7684;&#x914d;&#x7f6e;&#x6587;&#x4ef6;\n# &#x4e24;&#x4e2a;redis&#x670d;&#x52a1;\n  1&#x3001;6379 -&gt; /etc/redis/redis.conf\n  2&#x3001;6300 -&gt; /home/tarena/redis_6300.conf\n\n# &#x4fee;&#x6539;&#x914d;&#x7f6e;&#x6587;&#x4ef6;\nvi redis_6300.conf\nslaveof 127.0.0.1 6379\nport 6300\n# &#x542f;&#x52a8;redis&#x670d;&#x52a1;\nredis-server redis_6300.conf\n# &#x5ba2;&#x6237;&#x7aef;&#x8fde;&#x63a5;&#x6d4b;&#x8bd5;\nredis-cli -p 6300\n127.0.0.1:6300&gt; hset user:1 username guods\n(error) READONLY You can&apos;t write against a read only slave.\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"612,629"}}],"payload":{"tag":"h4","lines":"610,611"}},{"content":"&#x95ee;&#x9898;&#x603b;&#x7ed3;&#xff1a;master&#x6302;&#x4e86;&#x600e;&#x4e48;&#x529e;&#xff1f;","children":[{"content":"<pre data-lines=\"632,639\"><code class=\"language-python\"><span class=\"hljs-number\">1</span>&#x3001;&#x4e00;&#x4e2a;Master&#x53ef;&#x4ee5;&#x6709;&#x591a;&#x4e2a;Slaves\n<span class=\"hljs-number\">2</span>&#x3001;Slave&#x4e0b;&#x7ebf;&#xff0c;&#x53ea;&#x662f;&#x8bfb;&#x8bf7;&#x6c42;&#x7684;&#x5904;&#x7406;&#x6027;&#x80fd;&#x4e0b;&#x964d;\n<span class=\"hljs-number\">3</span>&#x3001;Master&#x4e0b;&#x7ebf;&#xff0c;&#x5199;&#x8bf7;&#x6c42;&#x65e0;&#x6cd5;&#x6267;&#x884c;\n<span class=\"hljs-number\">4</span>&#x3001;&#x5176;&#x4e2d;&#x4e00;&#x53f0;Slave&#x4f7f;&#x7528;SLAVEOF no one&#x547d;&#x4ee4;&#x6210;&#x4e3a;Master&#xff0c;&#x5176;&#x4ed6;Slaves&#x6267;&#x884c;SLAVEOF&#x547d;&#x4ee4;&#x6307;&#x5411;&#x8fd9;&#x4e2a;&#x65b0;&#x7684;Master&#xff0c;&#x4ece;&#x5b83;&#x8fd9;&#x91cc;&#x540c;&#x6b65;&#x6570;&#x636e;\n<span class=\"hljs-comment\"># &#x4ee5;&#x4e0a;&#x8fc7;&#x7a0b;&#x662f;&#x624b;&#x52a8;&#x7684;&#xff0c;&#x80fd;&#x591f;&#x5b9e;&#x73b0;&#x81ea;&#x52a8;&#xff0c;&#x8fd9;&#x5c31;&#x9700;&#x8981;Sentinel&#x54e8;&#x5175;&#xff0c;&#x5b9e;&#x73b0;&#x6545;&#x969c;&#x8f6c;&#x79fb;Failover&#x64cd;&#x4f5c;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"632,639"}}],"payload":{"tag":"h4","lines":"630,631"}},{"content":"&#x6f14;&#x793a;","children":[{"content":"<pre data-lines=\"642,661\"><code class=\"language-python\"><span class=\"hljs-number\">1</span>&#x3001;&#x542f;&#x52a8;&#x7aef;&#x53e3;6400redis&#xff0c;&#x8bbe;&#x7f6e;&#x4e3a;<span class=\"hljs-number\">6379</span>&#x7684;slave\n   redis-server --port <span class=\"hljs-number\">6400</span>\n   redis-cli -p <span class=\"hljs-number\">6400</span>\n   redis&gt;slaveof <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span> <span class=\"hljs-number\">6379</span>\n<span class=\"hljs-number\">2</span>&#x3001;&#x542f;&#x52a8;&#x7aef;&#x53e3;6401redis&#xff0c;&#x8bbe;&#x7f6e;&#x4e3a;<span class=\"hljs-number\">6379</span>&#x7684;slave\n   redis-server --port <span class=\"hljs-number\">6401</span>\n   redis-cli -p <span class=\"hljs-number\">6401</span>\n   redis&gt;slaveof <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span> <span class=\"hljs-number\">6379</span>\n<span class=\"hljs-number\">3</span>&#x3001;&#x5173;&#x95ed;6379redis\n   sudo /etc/init.d/redis-server stop\n<span class=\"hljs-number\">4</span>&#x3001;&#x628a;6400redis&#x8bbe;&#x7f6e;&#x4e3a;master\n   redis-cli -p <span class=\"hljs-number\">6401</span>\n   redis&gt;slaveof no one\n<span class=\"hljs-number\">5</span>&#x3001;&#x628a;<span class=\"hljs-number\">6401</span>&#x7684;redis&#x8bbe;&#x7f6e;&#x4e3a;6400redis&#x7684;salve\n   redis-cli -p <span class=\"hljs-number\">6401</span>\n   redis&gt;slaveof <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span> <span class=\"hljs-number\">6400</span>\n<span class=\"hljs-comment\"># &#x8fd9;&#x662f;&#x624b;&#x52a8;&#x64cd;&#x4f5c;&#xff0c;&#x6548;&#x7387;&#x4f4e;&#xff0c;&#x800c;&#x4e14;&#x9700;&#x8981;&#x65f6;&#x95f4;&#xff0c;&#x6709;&#x6ca1;&#x6709;&#x81ea;&#x52a8;&#x7684;&#xff1f;&#xff1f;&#xff1f;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"642,661"}}],"payload":{"tag":"h4","lines":"640,641"}}],"payload":{"tag":"h3","lines":"552,553"}}],"payload":{"tag":"h2","lines":"530,531"}},{"content":"&#x5b98;&#x65b9;&#x9ad8;&#x53ef;&#x7528;&#x65b9;&#x6848;Sentinel","children":[{"content":"Redis&#x4e4b;&#x54e8;&#x5175; - sentinel","children":[{"content":"<pre data-lines=\"666,670\"><code class=\"language-python\">1&#x3001;Sentinel&#x4f1a;&#x4e0d;&#x65ad;&#x68c0;&#x67e5;Master&#x548c;Slaves&#x662f;&#x5426;&#x6b63;&#x5e38;\n2&#x3001;&#x6bcf;&#x4e00;&#x4e2a;Sentinel&#x53ef;&#x4ee5;&#x76d1;&#x63a7;&#x4efb;&#x610f;&#x591a;&#x4e2a;Master&#x548c;&#x8be5;Master&#x4e0b;&#x7684;Slaves\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"666,670"}}],"payload":{"tag":"h3","lines":"664,665"}},{"content":"&#x6848;&#x4f8b;&#x6f14;&#x793a;","children":[{"content":"<pre data-lines=\"673,674\"><code>1&#x3001;&#x73af;&#x5883;&#x642d;&#x5efa;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"673,674"}},{"content":"<pre data-lines=\"675,689\"><code class=\"language-python\"><span class=\"hljs-comment\"># &#x5171;3&#x53f0;redis&#x7684;&#x670d;&#x52a1;&#x5668;&#xff0c;&#x5982;&#x679c;&#x662f;&#x4e0d;&#x540c;&#x673a;&#x5668;&#x7aef;&#x53e3;&#x53f7;&#x53ef;&#x4ee5;&#x662f;&#x4e00;&#x6837;&#x7684;</span>\n<span class=\"hljs-number\">1</span>&#x3001;&#x542f;&#x52a8;<span class=\"hljs-number\">6379</span>&#x7684;redis&#x670d;&#x52a1;&#x5668;\n   \tsudo /etc/init.d/redis-server start\n<span class=\"hljs-number\">2</span>&#x3001;&#x542f;&#x52a8;<span class=\"hljs-number\">6380</span>&#x7684;redis&#x670d;&#x52a1;&#x5668;&#xff0c;&#x8bbe;&#x7f6e;&#x4e3a;<span class=\"hljs-number\">6379</span>&#x7684;&#x4ece;\n    redis-server --port <span class=\"hljs-number\">6380</span>\n    tarena@tedu:~&#x24; redis-cli -p <span class=\"hljs-number\">6380</span>\n    <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">6380</span>&gt; slaveof <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span> <span class=\"hljs-number\">6379</span>\n    OK\n<span class=\"hljs-number\">3</span>&#x3001;&#x542f;&#x52a8;<span class=\"hljs-number\">6381</span>&#x7684;redis&#x670d;&#x52a1;&#x5668;&#xff0c;&#x8bbe;&#x7f6e;&#x4e3a;<span class=\"hljs-number\">6379</span>&#x7684;&#x4ece;\n   \tredis-server --port <span class=\"hljs-number\">6381</span>\n   \ttarena@tedu:~&#x24; redis-cli -p <span class=\"hljs-number\">6381</span>\n   \t<span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">6381</span>&gt; slaveof <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span> <span class=\"hljs-number\">6379</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"675,689"}},{"content":"<pre data-lines=\"690,691\"><code>2&#x3001;&#x5b89;&#x88c5;&#x5e76;&#x642d;&#x5efa;sentinel&#x54e8;&#x5175;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"690,691"}},{"content":"<pre data-lines=\"692,714\"><code class=\"language-python\"><span class=\"hljs-comment\"># 1&#x3001;&#x5b89;&#x88c5;redis-sentinel</span>\nsudo apt install redis-sentinel\n&#x9a8c;&#x8bc1;: sudo /etc/init.d/redis-sentinel stop\n<span class=\"hljs-comment\"># 2&#x3001;&#x65b0;&#x5efa;&#x914d;&#x7f6e;&#x6587;&#x4ef6;sentinel.conf</span>\nport <span class=\"hljs-number\">26379</span>\nsentinel monitor tedu <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span> <span class=\"hljs-number\">6379</span> <span class=\"hljs-number\">1</span>\n\n<span class=\"hljs-comment\"># 3&#x3001;&#x542f;&#x52a8;sentinel</span>\n&#x65b9;&#x5f0f;&#x4e00;: redis-sentinel sentinel.conf\n&#x65b9;&#x5f0f;&#x4e8c;: redis-server sentinel.conf --sentinel\n\n<span class=\"hljs-comment\">#4&#x3001;&#x5c06;master&#x7684;redis&#x670d;&#x52a1;&#x7ec8;&#x6b62;&#xff0c;&#x67e5;&#x770b;&#x4ece;&#x662f;&#x5426;&#x4f1a;&#x63d0;&#x5347;&#x4e3a;&#x4e3b;</span>\nsudo /etc/init.d/redis-server stop\n<span class=\"hljs-comment\"># &#x53d1;&#x73b0;&#x63d0;&#x5347;6381&#x4e3a;master&#xff0c;&#x5176;&#x4ed6;&#x4e24;&#x4e2a;&#x4e3a;&#x4ece;</span>\n<span class=\"hljs-comment\"># &#x5728;6381&#x4e0a;&#x8bbe;&#x7f6e;&#x65b0;&#x503c;&#xff0c;6380&#x67e5;&#x770b;</span>\n<span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">6381</span>&gt; <span class=\"hljs-built_in\">set</span> name tedu\nOK\n\n<span class=\"hljs-comment\"># &#x542f;&#x52a8;6379&#xff0c;&#x89c2;&#x5bdf;&#x65e5;&#x5fd7;&#xff0c;&#x53d1;&#x73b0;&#x53d8;&#x4e3a;&#x4e86;6381&#x7684;&#x4ece;</span>\n&#x4e3b;&#x4ece;+&#x54e8;&#x5175;&#x57fa;&#x672c;&#x5c31;&#x591f;&#x7528;&#x4e86;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"692,714"}}],"payload":{"tag":"h3","lines":"671,672"}},{"content":"sentinel.conf&#x89e3;&#x91ca;","children":[{"content":"<pre data-lines=\"717,729\"><code class=\"language-python\"><span class=\"hljs-comment\"># sentinel&#x76d1;&#x542c;&#x7aef;&#x53e3;&#xff0c;&#x9ed8;&#x8ba4;&#x662f;26379&#xff0c;&#x53ef;&#x4ee5;&#x4fee;&#x6539;</span>\nport <span class=\"hljs-number\">26379</span>\n<span class=\"hljs-comment\"># &#x544a;&#x8bc9;sentinel&#x53bb;&#x76d1;&#x542c;&#x5730;&#x5740;&#x4e3a;ip:port&#x7684;&#x4e00;&#x4e2a;master&#xff0c;&#x8fd9;&#x91cc;&#x7684;master-name&#x53ef;&#x4ee5;&#x81ea;&#x5b9a;&#x4e49;&#xff0c;quorum&#x662f;&#x4e00;&#x4e2a;&#x6570;&#x5b57;&#xff0c;&#x6307;&#x660e;&#x5f53;&#x6709;&#x591a;&#x5c11;&#x4e2a;sentinel&#x8ba4;&#x4e3a;&#x4e00;&#x4e2a;master&#x5931;&#x6548;&#x65f6;&#xff0c;master&#x624d;&#x7b97;&#x771f;&#x6b63;&#x5931;&#x6548;</span>\nsentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;\n\n<span class=\"hljs-comment\">#&#x5982;&#x679c;master&#x6709;&#x5bc6;&#x7801;&#xff0c;&#x5219;&#x9700;&#x8981;&#x6dfb;&#x52a0;&#x8be5;&#x914d;&#x7f6e;</span>\nsentinel auth-<span class=\"hljs-keyword\">pass</span> &lt;master-name&gt; &lt;password&gt;\n\n<span class=\"hljs-comment\">#master&#x591a;&#x4e45;&#x5931;&#x8054;&#x624d;&#x8ba4;&#x4e3a;&#x662f;&#x4e0d;&#x53ef;&#x7528;&#x4e86;&#xff0c;&#x9ed8;&#x8ba4;&#x662f;30&#x79d2;</span>\nsentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt; \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"717,729"}}],"payload":{"tag":"h3","lines":"715,716"}},{"content":"python&#x83b7;&#x53d6;master","children":[{"content":"<pre data-lines=\"734,748\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> redis.sentinel <span class=\"hljs-keyword\">import</span> Sentinel\n\n<span class=\"hljs-comment\">#&#x751f;&#x6210;&#x54e8;&#x5175;&#x8fde;&#x63a5;</span>\nsentinel = Sentinel([(<span class=\"hljs-string\">&apos;localhost&apos;</span>, <span class=\"hljs-number\">26379</span>)], socket_timeout=<span class=\"hljs-number\">0.1</span>)\n\n<span class=\"hljs-comment\">#&#x521d;&#x59cb;&#x5316;master&#x8fde;&#x63a5;</span>\nmaster = sentinel.master_for(<span class=\"hljs-string\">&apos;tedu&apos;</span>, socket_timeout=<span class=\"hljs-number\">0.1</span>, db=<span class=\"hljs-number\">1</span>)\nslave = sentinel.slave_for(<span class=\"hljs-string\">&apos;tedu&apos;</span>,socket_timeout=<span class=\"hljs-number\">0.1</span>, db=<span class=\"hljs-number\">1</span>)\n\n<span class=\"hljs-comment\">#&#x4f7f;&#x7528;redis&#x76f8;&#x5173;&#x547d;&#x4ee4;</span>\nmaster.<span class=\"hljs-built_in\">set</span>(<span class=\"hljs-string\">&apos;mymaster&apos;</span>, <span class=\"hljs-string\">&apos;yes&apos;</span>)\n<span class=\"hljs-built_in\">print</span>(slave.get(<span class=\"hljs-string\">&apos;mymaster&apos;</span>))\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"734,748"}}],"payload":{"tag":"h3","lines":"732,733"}},{"content":"&#x793a;&#x4f8b;","children":[{"content":"<pre data-lines=\"751,792\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> redis\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x8fde;&#x63a5;&#x6c60;&#x5e76;&#x8fde;&#x63a5;&#x5230;redis</span>\npool = redis.ConnectionPool(host = <span class=\"hljs-string\">&apos;127.0.0.1&apos;</span>,db=<span class=\"hljs-number\">0</span>,port=<span class=\"hljs-number\">6379</span>)\nr = redis.Redis(connection_pool=pool)\n\n<span class=\"hljs-comment\"># pipe = r.pipeline()</span>\n<span class=\"hljs-comment\"># print(pipe.set(&apos;fans&apos;,50))</span>\n<span class=\"hljs-comment\"># pipe.incr(&apos;fans&apos;)</span>\n<span class=\"hljs-comment\"># pipe.incrby(&apos;fans&apos;,100)</span>\n<span class=\"hljs-comment\"># print(pipe.execute())</span>\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">withpipeline</span>(<span class=\"hljs-params\">r</span>):\n    p = r.pipeline()\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1000</span>):\n        key = <span class=\"hljs-string\">&apos;test1&apos;</span> + <span class=\"hljs-built_in\">str</span>(i)\n        value = i+<span class=\"hljs-number\">1</span>\n        p.<span class=\"hljs-built_in\">set</span>(key, value)\n    p.execute()\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">withoutpipeline</span>(<span class=\"hljs-params\">r</span>):\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1000</span>):\n        key = <span class=\"hljs-string\">&apos;test2&apos;</span> + <span class=\"hljs-built_in\">str</span>(i)\n        value = i+<span class=\"hljs-number\">1</span>\n        r.<span class=\"hljs-built_in\">set</span>(key, value)\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n\n    <span class=\"hljs-keyword\">import</span> time\n    t1 = time.time()\n    <span class=\"hljs-comment\">#0.019922256469726562</span>\n    <span class=\"hljs-comment\">#withpipeline(r)</span>\n\n    <span class=\"hljs-comment\">#0.1391603946685791</span>\n    withoutpipeline(r)\n    t2 = time.time()\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;time is %s&apos;</span>%(t2-t1))\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"751,792"}},{"content":"<pre data-lines=\"793,811\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> redis\n\nr = redis.Redis(host=<span class=\"hljs-string\">&apos;127.0.0.1&apos;</span>,port=<span class=\"hljs-number\">6379</span>, db=<span class=\"hljs-number\">1</span>)\n<span class=\"hljs-comment\">#&#x6dfb;&#x52a0;&#x5143;&#x7d20; 2</span>\n<span class=\"hljs-comment\">#print(r.sadd(&apos;pys1&apos;, &apos;tom&apos;, &apos;lili&apos;))</span>\n<span class=\"hljs-comment\">#&#x67e5;&#x770b;&#x96c6;&#x5408;&#x5143;&#x7d20; {b&apos;lili&apos;, b&apos;tom&apos;}</span>\n<span class=\"hljs-comment\">#print(r.smembers(&apos;pys1&apos;))</span>\n\n<span class=\"hljs-comment\">#&#x68c0;&#x67e5;values&#x662f;&#x5426;&#x5728;&#x96c6;&#x5408;&#x4e2d;  True/False</span>\n<span class=\"hljs-comment\">#print(r.sismember(&apos;pys1&apos;, &apos;tom&apos;))</span>\n\nr.sadd(<span class=\"hljs-string\">&apos;pys2&apos;</span>, <span class=\"hljs-string\">&apos;g&apos;</span>, <span class=\"hljs-string\">&apos;a&apos;</span>, <span class=\"hljs-string\">&apos;tom&apos;</span>, <span class=\"hljs-string\">&apos;lili&apos;</span>, <span class=\"hljs-string\">&apos;gah&apos;</span>)\n<span class=\"hljs-comment\">#&#x4ea4;&#x96c6;  {b&apos;lili&apos;, b&apos;tom&apos;}</span>\n<span class=\"hljs-built_in\">print</span>(r.sinter(<span class=\"hljs-string\">&apos;pys1&apos;</span>, <span class=\"hljs-string\">&apos;pys2&apos;</span>))\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"793,811"}},{"content":"<pre data-lines=\"812,840\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> redis\nr = redis.Redis(host=<span class=\"hljs-string\">&apos;127.0.0.1&apos;</span>, port=<span class=\"hljs-number\">6379</span>, db=<span class=\"hljs-number\">1</span>)\n\n<span class=\"hljs-comment\">#r.zadd(&apos;salary&apos;, {&apos;tom&apos;:6000, &apos;jack&apos;:8000})</span>\n\n<span class=\"hljs-comment\">#[(b&apos;tom&apos;, 6000.0), (b&apos;jack&apos;, 8000.0)]</span>\n<span class=\"hljs-comment\">#print(r.zrange(&apos;salary&apos;,0, -1, withscores=True))</span>\n<span class=\"hljs-comment\">#[(b&apos;jack&apos;, 8000.0), (b&apos;tom&apos;, 6000.0)]</span>\n<span class=\"hljs-comment\">#print(r.zrevrange(&apos;salary&apos;,0, -1, withscores=True))</span>\n\n<span class=\"hljs-comment\">#10000.0</span>\n<span class=\"hljs-comment\">#print(r.zincrby(&apos;salary&apos;, 2000, &apos;jack&apos;))</span>\n<span class=\"hljs-comment\">#[(b&apos;tom&apos;, 6000.0), (b&apos;jack&apos;, 10000.0)]</span>\n<span class=\"hljs-comment\">#print(r.zrange(&apos;salary&apos;, 0, -1, withscores=True))</span>\n\n<span class=\"hljs-comment\">#&#x4ea4;&#x96c6;</span>\n\n<span class=\"hljs-comment\">#r.zadd(&apos;salary1&apos;, {&apos;jack&apos;: 8000})</span>\n<span class=\"hljs-comment\">#r.zinterstore(&apos;salary5&apos;, (&apos;salary&apos;, &apos;salary1&apos;), aggregate=&apos;max&apos;)</span>\n<span class=\"hljs-comment\">#print(r.zrange(&apos;salary&apos;, 0, -1, withscores=True))</span>\n<span class=\"hljs-comment\">#print(r.zrange(&apos;salary1&apos;, 0, -1, withscores=True))</span>\n<span class=\"hljs-comment\">#print(r.zrange(&apos;salary5&apos;, 0, -1 , withscores=True))</span>\n\n\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"812,840"}},{"content":"<pre data-lines=\"841,878\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> redis\n<span class=\"hljs-keyword\">import</span> time\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x8fde;&#x63a5;&#x6c60;&#x5e76;&#x8fde;&#x63a5;&#x5230;redis</span>\npool = redis.ConnectionPool(host = <span class=\"hljs-string\">&apos;127.0.0.1&apos;</span>,db=<span class=\"hljs-number\">1</span>,port=<span class=\"hljs-number\">6379</span>)\nr = redis.Redis(connection_pool=pool)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">double_account</span>(<span class=\"hljs-params\">user_id</span>):\n\n    key = <span class=\"hljs-string\">&apos;account_%s&apos;</span>%(user_id)\n    <span class=\"hljs-keyword\">with</span> r.pipeline(transaction=<span class=\"hljs-literal\">True</span>) <span class=\"hljs-keyword\">as</span> pipe:\n        <span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n            <span class=\"hljs-keyword\">try</span>:\n                pipe.watch(key)\n                value = <span class=\"hljs-built_in\">int</span>(r.get(key))\n                value *= <span class=\"hljs-number\">2</span>\n                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;value is %s&apos;</span>%(value))\n                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;sleep--is start&apos;</span>)\n                time.sleep(<span class=\"hljs-number\">20</span>)\n                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;sleep--is ok&apos;</span>)\n\n                pipe.multi()\n                pipe.<span class=\"hljs-built_in\">set</span>(key, value)\n                pipe.execute()\n                <span class=\"hljs-comment\">#&#x5982;&#x679c;&#x6ca1;&#x6709;&#x4efb;&#x4f55;&#x5f02;&#x5e38;&#xff0c;&#x5219;&#x64cd;&#x4f5c;&#x6210;&#x529f;</span>\n                <span class=\"hljs-keyword\">break</span>\n            <span class=\"hljs-keyword\">except</span> redis.WatchError:\n                <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;---key changed&apos;</span>)\n                <span class=\"hljs-keyword\">continue</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">int</span>(r.get(key))\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&apos;__main__&apos;</span>:\n\n    <span class=\"hljs-built_in\">print</span>(double_account(<span class=\"hljs-string\">&apos;guoxiaonao&apos;</span>))\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"841,878"}}],"payload":{"tag":"h3","lines":"749,750"}}],"payload":{"tag":"h2","lines":"662,663"}}],"payload":{"tag":"h1","lines":"12,13"}}]},{})</script>
</body>
</html>
