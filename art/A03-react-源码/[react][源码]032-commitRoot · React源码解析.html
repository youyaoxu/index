<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"commitRoot","children":[{"content":"<pre data-lines=\"2,16\"><code>&#x9996;&#x5148;&#x8981;&#x6807;&#x8bb0;&#x4f18;&#x5148;&#x7ea7;&#xff0c;&#x56e0;&#x4e3a;&#x6709;&#x4e00;&#x90e8;&#x5206;&#x4f18;&#x5148;&#x7ea7;&#x7684;&#x4efb;&#x52a1;&#x5df2;&#x7ecf;&#x88ab;&#x63d0;&#x4ea4;&#x4e86;&#xff0c;&#x6240;&#x4ee5;&#x9700;&#x8981;&#x6e05;&#x695a;&#x4e00;&#x4e9b;&#x76f8;&#x5173;&#x7684;&#x4f18;&#x5148;&#x7ea7;&#x3002;&#x88ab;&#x63d0;&#x4ea4;&#x7684;&#x4efb;&#x52a1;&#x5e94;&#x8be5;&#x662f;&#xff1a;\n\n*   &#x5b50;&#x6811;&#x4e2d;&#x4f18;&#x5148;&#x7ea7;&#x6700;&#x9ad8;&#x7684;&#x4efb;&#x52a1;\n*   &#x6216;&#x8005;&#x5916;&#x90e8;&#x6307;&#x5b9a;&#x7684;&#x4f18;&#x5148;&#x7ea7;&#xff08;`flushSync`&#x6216;&#x8005;`retry`&#xff09;\n\n&#x5982;&#x679c;`RootFiber`&#x672c;&#x8eab;&#x4e5f;&#x6709;&#x526f;&#x4f5c;&#x7528;&#xff08;&#x4e00;&#x822c;&#x53ea;&#x6709;&#x7b2c;&#x4e00;&#x6b21;&#xff09;&#xff0c;&#x90a3;&#x4e48;&#x4ed6;&#x672c;&#x8eab;&#x4e5f;&#x8981;&#x52a0;&#x5230;`effect`&#x94fe;&#x4e0a;&#xff0c;&#x653e;&#x5728;&#x6700;&#x540e;&#x3002;\n\n&#x63a5;&#x4e0b;&#x53bb;&#x662f;&#x4e09;&#x4e2a;&#x63d0;&#x4ea4;&#x64cd;&#x4f5c;&#xff0c;&#x5206;&#x522b;&#x662f;&#xff1a;\n\n*   [&#x63d0;&#x4ea4;`Snapshot`](https://react.jokcy.me/book/commit-phase/commitBeforeMutationLifecycles.html)\n*   [&#x63d0;&#x4ea4;`HostComponent`&#x7684; side effect\\`](https://react.jokcy.me/book/commit-phase/commit-all-host-effecrts.md)\n*   [&#x63d0;&#x4ea4;&#x6240;&#x6709;&#x7ec4;&#x4ef6;&#x7684;&#x751f;&#x547d;&#x5468;&#x671f;](https://react.jokcy.me/book/commit-phase/commit-all-lifecycles.html)\n\n&#x6ce8;&#x610f;&#x8fd9;&#x91cc;&#x7528;&#x5230;&#x4e86;&#x4e00;&#x4e2a;&#x65b9;&#x6cd5;`invokeGuardedCallback`&#xff0c;&#x53ea;&#x6709;&#x5728;&#x5f00;&#x53d1;&#x73af;&#x5883;&#x624d;&#x4f1a;&#x4f7f;&#x7528;&#xff0c;&#x90a3;&#x4e48;&#x4ed6;&#x662f;&#x5e72;&#x561b;&#x7684;&#x5462;&#xff1f;[&#x770b;&#x8fd9;&#x91cc;](https://react.jokcy.me/book/commit-phase/invokeGuardedCallback.html)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2,16"}},{"content":"<pre data-lines=\"17,207\"><code data-lines=\"17,207\">function commitRoot(root: FiberRoot, finishedWork: Fiber): void {\n  isWorking = true\n  isCommitting = true\n  startCommitTimer()\n\n  invariant(\n    root.current !== finishedWork,\n    <span class=\"hljs-string\">&apos;Cannot commit the same tree as before. This is probably a bug &apos;</span> +\n      <span class=\"hljs-string\">&apos;related to the return field. This error is likely caused by a bug &apos;</span> +\n      <span class=\"hljs-string\">&apos;in React. Please file an issue.&apos;</span>,\n  )\n  const committedExpirationTime = root.pendingCommitExpirationTime\n  invariant(\n    committedExpirationTime !== NoWork,\n    <span class=\"hljs-string\">&apos;Cannot commit an incomplete root. This error is likely caused by a &apos;</span> +\n      <span class=\"hljs-string\">&apos;bug in React. Please file an issue.&apos;</span>,\n  )\n  root.pendingCommitExpirationTime = NoWork\n\n  const updateExpirationTimeBeforeCommit = finishedWork.expirationTime\n  const childExpirationTimeBeforeCommit = finishedWork.childExpirationTime\n  const earliestRemainingTimeBeforeCommit =\n    updateExpirationTimeBeforeCommit === NoWork ||\n    (childExpirationTimeBeforeCommit !== NoWork &amp;&amp;\n      childExpirationTimeBeforeCommit &lt; updateExpirationTimeBeforeCommit)\n      ? childExpirationTimeBeforeCommit\n      : updateExpirationTimeBeforeCommit\n  markCommittedPriorityLevels(root, earliestRemainingTimeBeforeCommit)\n\n  let prevInteractions: <span class=\"hljs-keyword\">Set</span>&lt;Interaction&gt; = (null: any)\n\n  \n  ReactCurrentOwner.current <span class=\"hljs-comment\">= null</span>\n\n  let <span class=\"hljs-comment\">firstEffect</span>\n  if <span class=\"hljs-comment\">(finishedWork.effectTag &gt; PerformedWork) {</span>\n    \n    \n    \n    \n    if <span class=\"hljs-comment\">(finishedWork.lastEffect !== null) {</span>\n      finishedWork.lastEffect.nextEffect <span class=\"hljs-comment\">= finishedWork</span>\n      firstEffect <span class=\"hljs-comment\">= finishedWork.firstEffect</span>\n    } else <span class=\"hljs-comment\">{</span>\n      firstEffect <span class=\"hljs-comment\">= finishedWork</span>\n    }\n  } else <span class=\"hljs-comment\">{</span>\n    \n    firstEffect <span class=\"hljs-comment\">= finishedWork.firstEffect</span>\n  }\n\n  prepareForCommit(root.containerInfo)\n\n  \n  nextEffect <span class=\"hljs-comment\">= firstEffect</span>\n  startCommitSnapshotEffectsTimer()\n  while <span class=\"hljs-comment\">(nextEffect !== null) {</span>\n    let <span class=\"hljs-comment\">didError = false</span>\n    let <span class=\"hljs-comment\">error</span>\n    if <span class=\"hljs-comment\">(__DEV__) {</span>\n      invokeGuardedCallback(null, commitBeforeMutationLifecycles, null)\n      if <span class=\"hljs-comment\">(hasCaughtError()) {</span>\n        didError <span class=\"hljs-comment\">= true</span>\n        error <span class=\"hljs-comment\">= clearCaughtError()</span>\n      }\n    } else <span class=\"hljs-comment\">{</span>\n      try <span class=\"hljs-comment\">{</span>\n        commitBeforeMutationLifecycles()\n      } catch <span class=\"hljs-comment\">(e) {</span>\n        didError <span class=\"hljs-comment\">= true</span>\n        error <span class=\"hljs-comment\">= e</span>\n      }\n    }\n    if <span class=\"hljs-comment\">(didError) {</span>\n      invariant(\n        nextEffect <span class=\"hljs-comment\">!== null,</span>\n        <span class=\"hljs-string\">&apos;Should have next effect. This error is likely caused by a bug &apos;</span> +\n          <span class=\"hljs-string\">&apos;in React. Please file an issue.&apos;</span>,\n      )\n      captureCommitPhaseError(nextEffect, error)\n      \n      if <span class=\"hljs-comment\">(nextEffect !== null) {</span>\n        nextEffect <span class=\"hljs-comment\">= nextEffect.nextEffect</span>\n      }\n    }\n  }\n  stopCommitSnapshotEffectsTimer()\n\n  nextEffect <span class=\"hljs-comment\">= firstEffect</span>\n  startCommitHostEffectsTimer()\n  while <span class=\"hljs-comment\">(nextEffect !== null) {</span>\n    let <span class=\"hljs-comment\">didError = false</span>\n    let <span class=\"hljs-comment\">error</span>\n    if <span class=\"hljs-comment\">(__DEV__) {</span>\n      invokeGuardedCallback(null, commitAllHostEffects, null)\n      if <span class=\"hljs-comment\">(hasCaughtError()) {</span>\n        didError <span class=\"hljs-comment\">= true</span>\n        error <span class=\"hljs-comment\">= clearCaughtError()</span>\n      }\n    } else <span class=\"hljs-comment\">{</span>\n      try <span class=\"hljs-comment\">{</span>\n        commitAllHostEffects()\n      } catch <span class=\"hljs-comment\">(e) {</span>\n        didError <span class=\"hljs-comment\">= true</span>\n        error <span class=\"hljs-comment\">= e</span>\n      }\n    }\n    if <span class=\"hljs-comment\">(didError) {</span>\n      invariant(\n        nextEffect <span class=\"hljs-comment\">!== null,</span>\n        <span class=\"hljs-string\">&apos;Should have next effect. This error is likely caused by a bug &apos;</span> +\n          <span class=\"hljs-string\">&apos;in React. Please file an issue.&apos;</span>,\n      )\n      captureCommitPhaseError(nextEffect, error)\n      \n      if <span class=\"hljs-comment\">(nextEffect !== null) {</span>\n        nextEffect <span class=\"hljs-comment\">= nextEffect.nextEffect</span>\n      }\n    }\n  }\n  stopCommitHostEffectsTimer()\n\n  resetAfterCommit(root.containerInfo)\n\n  root.current <span class=\"hljs-comment\">= finishedWork</span>\n\n  nextEffect <span class=\"hljs-comment\">= firstEffect</span>\n  startCommitLifeCyclesTimer()\n  while <span class=\"hljs-comment\">(nextEffect !== null) {</span>\n    let <span class=\"hljs-comment\">didError = false</span>\n    let <span class=\"hljs-comment\">error</span>\n    if <span class=\"hljs-comment\">(__DEV__) {</span>\n      invokeGuardedCallback(\n        null,\n        commitAllLifeCycles,\n        null,\n        root,\n        committedExpirationTime,\n      )\n      if <span class=\"hljs-comment\">(hasCaughtError()) {</span>\n        didError <span class=\"hljs-comment\">= true</span>\n        error <span class=\"hljs-comment\">= clearCaughtError()</span>\n      }\n    } else <span class=\"hljs-comment\">{</span>\n      try <span class=\"hljs-comment\">{</span>\n        commitAllLifeCycles(root, committedExpirationTime)\n      } catch <span class=\"hljs-comment\">(e) {</span>\n        didError <span class=\"hljs-comment\">= true</span>\n        error <span class=\"hljs-comment\">= e</span>\n      }\n    }\n    if <span class=\"hljs-comment\">(didError) {</span>\n      invariant(\n        nextEffect <span class=\"hljs-comment\">!== null,</span>\n        <span class=\"hljs-string\">&apos;Should have next effect. This error is likely caused by a bug &apos;</span> +\n          <span class=\"hljs-string\">&apos;in React. Please file an issue.&apos;</span>,\n      )\n      captureCommitPhaseError(nextEffect, error)\n      if <span class=\"hljs-comment\">(nextEffect !== null) {</span>\n        nextEffect <span class=\"hljs-comment\">= nextEffect.nextEffect</span>\n      }\n    }\n  }\n\n  isCommitting <span class=\"hljs-comment\">= false</span>\n  isWorking <span class=\"hljs-comment\">= false</span>\n  stopCommitLifeCyclesTimer()\n  stopCommitTimer()\n  onCommitRoot(finishedWork.stateNode)\n\n  const <span class=\"hljs-comment\">updateExpirationTimeAfterCommit = finishedWork.expirationTime</span>\n  const <span class=\"hljs-comment\">childExpirationTimeAfterCommit = finishedWork.childExpirationTime</span>\n  const <span class=\"hljs-comment\">earliestRemainingTimeAfterCommit =</span>\n    updateExpirationTimeAfterCommit <span class=\"hljs-comment\">=== NoWork</span> ||\n    (childExpirationTimeAfterCommit <span class=\"hljs-comment\">!== NoWork &amp;&amp;</span>\n      childExpirationTimeAfterCommit <span class=\"hljs-comment\">&lt; updateExpirationTimeAfterCommit)</span>\n      ? childExpirationTimeAfterCommit\n      : updateExpirationTimeAfterCommit\n  if <span class=\"hljs-comment\">(earliestRemainingTimeAfterCommit === NoWork) {</span>\n    \n    \n    legacyErrorBoundariesThatAlreadyFailed <span class=\"hljs-comment\">= null</span>\n  }\n  onCommit(root, earliestRemainingTimeAfterCommit)\n\n  \n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"17,207"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"208,209"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"212,213"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
