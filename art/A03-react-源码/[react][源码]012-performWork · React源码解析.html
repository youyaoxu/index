<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"performWork","children":[{"content":"performAsyncWork &#x5f02;&#x6b65;&#x65b9;&#x5f0f;","children":[{"content":"<pre data-lines=\"6,7\"><code>&#x5f02;&#x6b65;&#x60c5;&#x51b5;&#x7ed9;`performWork`&#x8bbe;&#x7f6e;&#x7684;`minExpirationTime`&#x662f;`NoWork`&#xff0c;&#x5e76;&#x4e14;&#x4f1a;&#x5224;&#x65ad;`dl.didTimeout`&#xff0c;&#x8fd9;&#x4e2a;&#x503c;&#x662f;&#x6307;&#x4efb;&#x52a1;&#x7684;`expirationTime`&#x662f;&#x5426;&#x5df2;&#x7ecf;&#x8d85;&#x65f6;&#xff0c;&#x5982;&#x679c;&#x8d85;&#x65f6;&#x4e86;&#xff0c;&#x5219;&#x76f4;&#x63a5;&#x8bbe;&#x7f6e;`newExpirationTimeToWorkOn`&#x4e3a;&#x5f53;&#x524d;&#x65f6;&#x95f4;&#xff0c;&#x8868;&#x793a;&#x8fd9;&#x4e2a;&#x4efb;&#x52a1;&#x76f4;&#x63a5;&#x6267;&#x884c;&#x5c31;&#x884c;&#x4e86;&#xff0c;&#x4e0d;&#x9700;&#x8981;&#x5224;&#x65ad;&#x662f;&#x5426;&#x8d85;&#x8fc7;&#x4e86;&#x5e27;&#x65f6;&#x95f4;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6,7"}}],"payload":{"tag":"h5","lines":"4,5"}},{"content":"performSyncWork &#x540c;&#x6b65;&#x65b9;&#x5f0f;","children":[{"content":"<pre data-lines=\"10,11\"><code>&#x540c;&#x6b65;&#x65b9;&#x5f0f;&#x4e45;&#x6bd4;&#x8f83;&#x7b80;&#x5355;&#x4e86;&#xff0c;&#x8bbe;&#x7f6e;`minExpirationTime`&#x4e3a;`Sync`&#x4e5f;&#x5c31;&#x662f;`1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"10,11"}}],"payload":{"tag":"h5","lines":"8,9"}},{"content":"&#x5177;&#x4f53; performWork","children":[{"content":"<pre data-lines=\"14,19\"><code>&#x9996;&#x5148;&#x8981;&#x901a;&#x8fc7;`findHighestPriorityRoot`&#x627e;&#x5230;&#x4e0b;&#x4e00;&#x4e2a;&#x9700;&#x8981;&#x64cd;&#x4f5c;&#x7684;`root`&#xff0c;&#x4f1a;&#x8bbe;&#x7f6e;&#x4e24;&#x4e2a;&#x5168;&#x5c40;&#x53d8;&#x91cf;\n\n&#x8fd9;&#x91cc;&#x5224;&#x65ad;&#x662f;&#x5426;&#x6709;`deadline`&#x6765;&#x5206;&#x6210;&#x4e24;&#x79cd;&#x6e32;&#x67d3;&#x65b9;&#x5f0f;&#xff0c;&#x4f46;&#x6700;&#x5927;&#x7684;&#x5dee;&#x8ddd;&#x5176;&#x5b9e;&#x662f;`while`&#x5faa;&#x73af;&#x7684;&#x5224;&#x65ad;&#x6761;&#x4ef6;&#xff0c;&#x6709;`deadline`&#x7684;&#x591a;&#x4e86;&#x4e00;&#x4e2a;&#x6761;&#x4ef6;`(!deadlineDidExpire || currentRendererTime &gt;= nextFlushedExpirationTime)`\n\n&#x6211;&#x4eec;&#x5148;&#x6765;&#x770b;&#x76f8;&#x540c;&#x7684;&#x90e8;&#x5206;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"14,19"}},{"content":"<pre data-lines=\"20,27\"><code data-lines=\"20,27\">nextFlushedRoot !<span class=\"hljs-punctuation\">=</span><span class=\"hljs-punctuation\">=</span> <span class=\"hljs-literal\">null</span> <span class=\"hljs-meta\">&amp;&amp;</span>\n  nextFlushedExpirationTime !<span class=\"hljs-punctuation\">=</span><span class=\"hljs-punctuation\">=</span> NoWork <span class=\"hljs-meta\">&amp;&amp;</span>\n  <span class=\"hljs-punctuation\">(</span>minExpirationTime <span class=\"hljs-punctuation\">=</span><span class=\"hljs-punctuation\">=</span><span class=\"hljs-punctuation\">=</span> NoWork <span class=\"hljs-string\">||</span>\n    minExpirationTime &gt;<span class=\"hljs-punctuation\">=</span> nextFlushedExpirationTime<span class=\"hljs-punctuation\">)</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"20,27"}},{"content":"<pre data-lines=\"28,33\"><code>&#x4e0b;&#x4e00;&#x4e2a;&#x8f93;&#x51fa;&#x8282;&#x70b9;&#x4e0d;&#x662f;`null`&#xff0c;&#x5e76;&#x4e14;&#x8fc7;&#x671f;&#x65f6;&#x95f4;&#x4e0d;&#x662f;`NoWork`&#xff0c;&#x540c;&#x65f6;_&#x8d85;&#x65f6;&#x65f6;&#x95f4;&#x662f;`NoWork`&#xff0c;&#x6216;&#x8005;&#x8d85;&#x65f6;&#x65f6;&#x95f4;&#x5927;&#x4e8e;&#x4e0b;&#x4e2a;&#x8282;&#x70b9;&#x7684;&#x8d85;&#x65f6;&#x65f6;&#x95f4;_&#xff0c;&#x4e00;&#x822c;&#x6765;&#x8bf4;`minExpirationTime`&#x5e94;&#x8be5;&#x5c31;&#x7b49;&#x4e8e;`nextFlushedExpirationTime`&#x56e0;&#x4e3a;&#x4ed6;&#x4eec;&#x6765;&#x81ea;&#x540c;&#x4e00;&#x4e2a; root&#xff0c;`nextFlushedExpirationTime`&#x662f;&#x5728;`findHighestPriorityRoot`&#x9636;&#x6bb5;&#x8bfb;&#x53d6;&#x51fa;&#x6765;&#x7684;`root.expirationTime`\n\n&#x5728;&#x975e;&#x5f02;&#x6b65;&#x7684;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;&#x63a5;&#x4e0b;&#x53bb;&#x5c31;&#x662f;&#x5faa;&#x73af;&#x6267;&#x884c;`performWorkOnRoot`&#x7136;&#x540e;&#x518d;&#x627e;&#x4e0b;&#x4e00;&#x4e2a;&#x4f18;&#x5148;&#x7ea7;&#x7684;`root`&#x6267;&#x884c;\n\n&#x800c;&#x5728;&#x5f02;&#x6b65;&#x7684;&#x60c5;&#x51b5;&#x4e0b;&#x591a;&#x4e86;&#x4e00;&#x4e2a;&#x5224;&#x65ad;`(!deadlineDidExpire || currentRendererTime &gt;= nextFlushedExpirationTime)`&#xff0c;&#x4ec0;&#x4e48;&#x610f;&#x601d;&#x5462;&#xff1f;`deadlineDidExpire`&#x662f;&#x7528;&#x6765;&#x5224;&#x65ad;&#x65f6;&#x95f4;&#x7247;&#x662f;&#x5426;&#x5230;&#x671f;&#x7684;&#xff0c;&#x4e5f;&#x5c31;&#x662f;`deadline`&#x4e2d;&#x8bbe;&#x7f6e;&#x7684;&#xff0c;&#x800c;&#x7b2c;&#x4e8c;&#x4e2a;&#x6761;&#x4ef6;&#x662f;_&#x5f53;&#x524d;&#x6e32;&#x67d3;&#x65f6;&#x95f4;&#x662f;&#x5426;&#x5927;&#x4e8e;`nextFlushedExpirationTime`_&#xff0c;&#x4e5f;&#x5c31;&#x662f;&#x5224;&#x65ad;&#x4efb;&#x52a1;&#x662f;&#x5426;&#x5df2;&#x7ecf;&#x8d85;&#x65f6;&#x4e86;&#x4e86;&#xff0c;&#x5982;&#x679c;&#x8d85;&#x65f6;&#x4e86;&#xff0c;&#x6839;&#x636e;&#x4e0b;&#x9762;&#x8c03;&#x7528;`performWorkOnRoot`&#x7684;&#x53c2;&#x6570;&#x4e2d;&#x6709;&#x4e00;&#x4e2a;`currentRendererTime &gt;= nextFlushedExpirationTime`&#xff0c;&#x4e5f;&#x5c31;&#x662f;&#x8fd9;&#x79cd;&#x60c5;&#x51b5;&#x4e0b;&#x4e3a;`true`&#xff0c;&#x4ee3;&#x8868;&#x7684;&#x610f;&#x601d;&#x662f;&#x540c;&#x6b65;&#x6267;&#x884c;&#x4efb;&#x52a1;&#x4e0d;&#x518d;&#x5224;&#x65ad;&#x662f;&#x5426;&#x65f6;&#x95f4;&#x7247;&#x5230;&#x671f;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"28,33"}}],"payload":{"tag":"h5","lines":"12,13"}},{"content":"&#x6536;&#x5c3e;","children":[{"content":"<pre data-lines=\"36,37\"><code>&#x6700;&#x540e;&#x5982;&#x679c;&#x8df3;&#x51fa;&#x5faa;&#x73af;&#xff0c;&#x6709;&#x4e24;&#x79cd;&#x53ef;&#x80fd;&#xff0c;&#x4e00;&#x662f;&#x4efb;&#x52a1;&#x5df2;&#x7ecf;&#x5b8c;&#x6210;&#xff0c;&#x4e00;&#x662f;&#x65f6;&#x95f4;&#x7247;&#x7528;&#x5b8c;&#x4e86;&#x5e76;&#x4e14;&#x4efb;&#x52a1;&#x6ca1;&#x8fc7;&#x671f;&#x3002;&#x5bf9;&#x4e8e;&#x7b2c;&#x4e8c;&#x79cd;&#x60c5;&#x51b5;&#x4f1a;&#x91cd;&#x65b0;&#x53d1;&#x8d77;&#x4e00;&#x6b21;&#x5f02;&#x6b65;&#x8c03;&#x5ea6;&#xff0c;&#x7b49;`requestIdleCallback`&#x6709;&#x7a7a;&#x4e86;&#x518d;&#x56de;&#x6765;&#x7ee7;&#x7eed;&#x6267;&#x884c;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"36,37"}},{"content":"<pre data-lines=\"38,127\"><code data-lines=\"38,127\"><span class=\"hljs-keyword\">function</span> performAsyncWork(dl) {\n  <span class=\"hljs-keyword\">if</span> (dl.didTimeout) {\n    <span class=\"hljs-keyword\">if</span> (firstScheduledRoot !== <span class=\"hljs-literal\">null</span>) {\n      recomputeCurrentRenderer<span class=\"hljs-built_in\">Time</span>()\n      <span class=\"hljs-keyword\">let</span> root: FiberRoot = firstScheduledRoot\n      <span class=\"hljs-keyword\">do</span> {\n        didExpireAtExpiration<span class=\"hljs-built_in\">Time</span>(root, currentRendererTime)\n        \n        root = (root.nextScheduledRoot: any)\n      } <span class=\"hljs-keyword\">while</span> (root !== firstScheduledRoot)\n    }\n  }\n  performWork(NoWork, dl)\n}\n\n<span class=\"hljs-keyword\">function</span> performSyncWork() {\n  performWork(Sync, <span class=\"hljs-literal\">null</span>)\n}\n\n<span class=\"hljs-keyword\">function</span> performWork(minExpirationTime: ExpirationTime, dl: Deadline | <span class=\"hljs-literal\">null</span>) {\n  deadline = dl\n\n  \n  \n  findHighestPriorityRoot()\n\n  <span class=\"hljs-keyword\">if</span> (deadline !== <span class=\"hljs-literal\">null</span>) {\n    recomputeCurrentRenderer<span class=\"hljs-built_in\">Time</span>()\n    currentSchedulerTime = currentRendererTime\n\n    <span class=\"hljs-keyword\">if</span> (enableUserTimingAPI) {\n      <span class=\"hljs-keyword\">const</span> didExpire = nextFlushedExpirationTime &lt; currentRendererTime\n      <span class=\"hljs-keyword\">const</span> timeout = expirationTimeToMs(nextFlushedExpirationTime)\n      stopRequestCallback<span class=\"hljs-built_in\">Timer</span>(didExpire, timeout)\n    }\n\n    <span class=\"hljs-keyword\">while</span> (\n      nextFlushedRoot !== <span class=\"hljs-literal\">null</span> &amp;&amp;\n      nextFlushedExpirationTime !== NoWork &amp;&amp;\n      (minExpirationTime === NoWork ||\n        minExpirationTime &gt;= nextFlushedExpirationTime) &amp;&amp;\n      (!deadlineDidExpire || currentRendererTime &gt;= nextFlushedExpirationTime)\n    ) {\n      performWorkOnRoot(\n        nextFlushedRoot,\n        nextFlushedExpirationTime,\n        currentRendererTime &gt;= nextFlushedExpirationTime,\n      )\n      findHighestPriorityRoot()\n      recomputeCurrentRenderer<span class=\"hljs-built_in\">Time</span>()\n      currentSchedulerTime = currentRendererTime\n    }\n  } <span class=\"hljs-keyword\">else</span> {\n    <span class=\"hljs-keyword\">while</span> (\n      nextFlushedRoot !== <span class=\"hljs-literal\">null</span> &amp;&amp;\n      nextFlushedExpirationTime !== NoWork &amp;&amp;\n      (minExpirationTime === NoWork ||\n        minExpirationTime &gt;= nextFlushedExpirationTime)\n    ) {\n      performWorkOnRoot(nextFlushedRoot, nextFlushedExpirationTime, <span class=\"hljs-literal\">true</span>)\n      findHighestPriorityRoot()\n    }\n  }\n\n  \n  \n\n  \n  <span class=\"hljs-keyword\">if</span> (deadline !== <span class=\"hljs-literal\">null</span>) {\n    callbackExpirationTime = NoWork\n    callbackID = <span class=\"hljs-literal\">null</span>\n  }\n  \n  <span class=\"hljs-keyword\">if</span> (nextFlushedExpirationTime !== NoWork) {\n    scheduleCallbackWithExpiration<span class=\"hljs-built_in\">Time</span>(\n      ((nextFlushedRoot: any): FiberRoot),\n      nextFlushedExpirationTime,\n    )\n  }\n\n  \n  deadline = <span class=\"hljs-literal\">null</span>\n  deadlineDidExpire = <span class=\"hljs-literal\">false</span>\n\n  finishRendering()\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"38,127"}},{"content":"<pre data-lines=\"128,140\"><code>&#x8fd9;&#x91cc;&#x4e5f;&#x5206;&#x4e3a;&#x540c;&#x6b65;&#x548c;&#x5f02;&#x6b65;&#x4e24;&#x79cd;&#x60c5;&#x51b5;&#xff0c;&#x4f46;&#x662f;&#x8fd9;&#x4e24;&#x79cd;&#x60c5;&#x51b5;&#x7684;&#x533a;&#x522b;&#x5176;&#x5b9e;&#x975e;&#x5e38;&#x5c0f;&#x3002;\n\n&#x9996;&#x5148;&#x662f;&#x4e00;&#x4e2a;&#x53c2;&#x6570;&#x7684;&#x533a;&#x522b;&#xff0c;`isYieldy`&#x5728;&#x540c;&#x6b65;&#x7684;&#x60c5;&#x51b5;&#x4e0b;&#x662f;`false`&#xff0c;&#x800c;&#x5728;&#x5f02;&#x6b65;&#x60c5;&#x51b5;&#x4e0b;&#x662f;`true`&#x3002;&#x8fd9;&#x4e2a;&#x53c2;&#x6570;&#x987e;&#x540d;&#x601d;&#x4e49;&#x5c31;&#x662f;_&#x662f;&#x5426;&#x53ef;&#x4ee5;&#x4e2d;&#x65ad;_&#xff0c;&#x90a3;&#x4e48;&#x8fd9;&#x4e2a;&#x533a;&#x522b;&#x4e5f;&#x5c31;&#x5f88;&#x597d;&#x7406;&#x89e3;&#x4e86;&#x3002;\n\n&#x7b2c;&#x4e8c;&#x4e2a;&#x533a;&#x522b;&#x5c31;&#x662f;&#x5728;`renderRoot`&#x4e4b;&#x540e;&#x5224;&#x65ad;&#x4e00;&#x4e0b;`shouldYeild`&#xff0c;&#x5982;&#x679c;&#x65f6;&#x95f4;&#x7247;&#x5df2;&#x7ecf;&#x7528;&#x5b8c;&#xff0c;&#x5219;&#x4e0d;&#x76f4;&#x63a5;`completeRoot`&#xff0c;&#x800c;&#x662f;&#x7b49;&#x5230;&#x4e00;&#x4e0b;&#x6b21;`requestIdleCallback`&#x4e4b;&#x540e;&#x518d;&#x6267;&#x884c;&#x3002;\n\n`renderRoot`&#x548c;`completeRoot`&#x5206;&#x522b;&#x5bf9;&#x5e94;&#x4e24;&#x4e2a;&#x9636;&#x6bb5;&#xff1a;\n\n*   &#x6e32;&#x67d3;&#x9636;&#x6bb5;\n*   &#x63d0;&#x4ea4;&#x9636;&#x6bb5;\n\n&#x6e32;&#x67d3;&#x9636;&#x6bb5;&#x53ef;&#x4ee5;&#x88ab;&#x6253;&#x65ad;&#xff0c;&#x800c;&#x63d0;&#x4ea4;&#x9636;&#x6bb5;&#x4e0d;&#x80fd;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"128,140"}},{"content":"<pre data-lines=\"141,203\"><code data-lines=\"141,203\">function <span class=\"hljs-title function_\">performWorkOnRoot</span><span class=\"hljs-params\">(\n  root: FiberRoot,\n  expirationTime: ExpirationTime,\n  isExpired: <span class=\"hljs-type\">boolean</span>,\n)</span> {\n  isRendering = <span class=\"hljs-literal\">true</span>\n\n  <span class=\"hljs-title function_\">if</span> <span class=\"hljs-params\">(deadline === <span class=\"hljs-literal\">null</span> || isExpired)</span> {\n    <span class=\"hljs-type\">let</span> <span class=\"hljs-variable\">finishedWork</span> <span class=\"hljs-operator\">=</span> root.finishedWork\n    <span class=\"hljs-title function_\">if</span> <span class=\"hljs-params\">(finishedWork !== <span class=\"hljs-literal\">null</span>)</span> {\n      \n      completeRoot(root, finishedWork, expirationTime)\n    } <span class=\"hljs-keyword\">else</span> {\n      root.finishedWork = <span class=\"hljs-literal\">null</span>\n      <span class=\"hljs-type\">const</span> <span class=\"hljs-variable\">timeoutHandle</span> <span class=\"hljs-operator\">=</span> root.timeoutHandle\n      <span class=\"hljs-title function_\">if</span> <span class=\"hljs-params\">(enableSuspense &amp;&amp; timeoutHandle !== noTimeout)</span> {\n        root.timeoutHandle = noTimeout\n        <span class=\"hljs-title function_\">cancelTimeout</span><span class=\"hljs-params\">(timeoutHandle)</span>\n      }\n      <span class=\"hljs-type\">const</span> <span class=\"hljs-variable\">isYieldy</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">false</span>\n      <span class=\"hljs-title function_\">renderRoot</span><span class=\"hljs-params\">(root, isYieldy, isExpired)</span>\n      finishedWork = root.finishedWork\n      <span class=\"hljs-title function_\">if</span> <span class=\"hljs-params\">(finishedWork !== <span class=\"hljs-literal\">null</span>)</span> {\n        \n        completeRoot(root, finishedWork, expirationTime)\n      }\n    }\n  } <span class=\"hljs-keyword\">else</span> {\n    \n    <span class=\"hljs-type\">let</span> <span class=\"hljs-variable\">finishedWork</span> <span class=\"hljs-operator\">=</span> root.finishedWork\n    <span class=\"hljs-title function_\">if</span> <span class=\"hljs-params\">(finishedWork !== <span class=\"hljs-literal\">null</span>)</span> {\n      \n      completeRoot(root, finishedWork, expirationTime)\n    } <span class=\"hljs-keyword\">else</span> {\n      root.finishedWork = <span class=\"hljs-literal\">null</span>\n      \n      \n      <span class=\"hljs-type\">const</span> <span class=\"hljs-variable\">timeoutHandle</span> <span class=\"hljs-operator\">=</span> root.timeoutHandle\n      <span class=\"hljs-title function_\">if</span> <span class=\"hljs-params\">(enableSuspense &amp;&amp; timeoutHandle !== noTimeout)</span> {\n        root.timeoutHandle = noTimeout\n        \n        <span class=\"hljs-title function_\">cancelTimeout</span><span class=\"hljs-params\">(timeoutHandle)</span>\n      }\n      <span class=\"hljs-type\">const</span> <span class=\"hljs-variable\">isYieldy</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">true</span>\n      <span class=\"hljs-title function_\">renderRoot</span><span class=\"hljs-params\">(root, isYieldy, isExpired)</span>\n      finishedWork = root.finishedWork\n      <span class=\"hljs-title function_\">if</span> <span class=\"hljs-params\">(finishedWork !== <span class=\"hljs-literal\">null</span>)</span> {\n        <span class=\"hljs-keyword\">if</span> (!shouldYield()) {\n          \n          completeRoot(root, finishedWork, expirationTime)\n        } <span class=\"hljs-keyword\">else</span> {\n          root.finishedWork = finishedWork\n        }\n      }\n    }\n  }\n\n  isRendering = <span class=\"hljs-literal\">false</span>\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"141,203"}},{"content":"<pre data-lines=\"204,213\"><code>&#x4e00;&#x822c;&#x60c5;&#x51b5;&#x4e0b;&#x6211;&#x4eec;&#x7684; React &#x5e94;&#x7528;&#x53ea;&#x4f1a;&#x6709;&#x4e00;&#x4e2a;`root`&#xff0c;&#x6240;&#x4ee5;&#x8fd9;&#x91cc;&#x7684;&#x5927;&#x90e8;&#x5206;&#x903b;&#x8f91;&#x5176;&#x5b9e;&#x90fd;&#x4e0d;&#x662f;&#x5e38;&#x89c1;&#x60c5;&#x51b5;\n\n&#x5faa;&#x73af;`firstScheduledRoot =&gt; lastScheduledRoot`&#xff0c;`remainingExpirationTime`&#x662f;`root.expirationTime`&#xff0c;&#x4e5f;&#x5c31;&#x662f;&#x6700;&#x65e9;&#x7684;&#x8fc7;&#x671f;&#x65f6;&#x95f4;&#x3002;\n\n&#x5982;&#x679c;&#x4ed6;&#x662f;`NoWork`&#x8bf4;&#x660e;&#x4ed6;&#x5df2;&#x7ecf;&#x6ca1;&#x6709;&#x4efb;&#x52a1;&#x4e86;&#xff0c;&#x4ece;&#x94fe;&#x8868;&#x4e2d;&#x5220;&#x9664;&#x3002;\n\n&#x4ece;&#x5269;&#x4e0b;&#x7684;&#x4e2d;&#x627e;&#x5230;`expirationTime`&#x6700;&#x5c0f;&#x7684;&#x4e5f;&#x5c31;&#x662f;&#x4f18;&#x5148;&#x7ea7;&#x6700;&#x9ad8;&#x7684;`root`&#x7136;&#x540e;&#x628a;&#x4ed6;&#x8d4b;&#x503c;&#x7ed9;`nextFlushedRoot`&#x5e76;&#x628a;&#x4ed6;&#x7684;`expirationTime`&#x8d4b;&#x503c;&#x7ed9;`nextFlushedExpirationTime`&#x8fd9;&#x4e24;&#x4e2a;&#x516c;&#x5171;&#x53d8;&#x91cf;&#x3002;\n\n&#x4e00;&#x822c;&#x6765;&#x8bf4;&#x4f1a;&#x76f4;&#x63a5;&#x6267;&#x884c;&#x4e0b;&#x9762;&#x8fd9;&#x4e2a;&#x903b;&#x8f91;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"204,213"}},{"content":"<pre data-lines=\"214,223\"><code data-lines=\"214,223\">if (root <span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span><span class=\"hljs-operator\">=</span> root.nextScheduledRoot) {\n  \n  root.nextScheduledRoot <span class=\"hljs-operator\">=</span> null<span class=\"hljs-comment\">;</span>\n  firstScheduledRoot <span class=\"hljs-operator\">=</span> lastScheduledRoot <span class=\"hljs-operator\">=</span> null<span class=\"hljs-comment\">;</span>\n  break<span class=\"hljs-comment\">;</span>\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"214,223"}},{"content":"<pre data-lines=\"224,294\"><code data-lines=\"224,294\"><span class=\"hljs-keyword\">function</span> findHighestPriorityRoot() {\n  <span class=\"hljs-keyword\">let</span> highestPriorityWork = NoWork\n  <span class=\"hljs-keyword\">let</span> highestPriorityRoot = null\n  <span class=\"hljs-keyword\">if</span> (lastScheduledRoot !== null) {\n    <span class=\"hljs-keyword\">let</span> previousScheduledRoot = lastScheduledRoot\n    <span class=\"hljs-keyword\">let</span><span class=\"hljs-built_in\"> root</span> = firstScheduledRoot\n    while <span class=\"hljs-built_in\">(root</span> !== null) {\n      const remainingExpirationTime =<span class=\"hljs-built_in\"> root</span>.expirationTime\n      <span class=\"hljs-keyword\">if</span> (remainingExpirationTime === NoWork) {\n        \n\n        \n        \n        \n        invariant(\n          previousScheduledRoot !== null &amp;&amp; lastScheduledRoot !== null,\n          <span class=\"hljs-string\">&apos;Should have a previous and last root. This error is likely &apos;</span> +\n            <span class=\"hljs-string\">&apos;caused by a bug in React. Please file an issue.&apos;</span>,\n        )\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">(root</span> ===<span class=\"hljs-built_in\"> root</span>.nextScheduledRoot) {\n          \n         <span class=\"hljs-built_in\"> root</span>.nextScheduledRoot = null\n          firstScheduledRoot = lastScheduledRoot = null\n          break\n        } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">(root</span> === firstScheduledRoot) {\n          \n          const <span class=\"hljs-keyword\">next</span> =<span class=\"hljs-built_in\"> root</span>.nextScheduledRoot\n          firstScheduledRoot = <span class=\"hljs-keyword\">next</span>\n          lastScheduledRoot.nextScheduledRoot = <span class=\"hljs-keyword\">next</span>\n         <span class=\"hljs-built_in\"> root</span>.nextScheduledRoot = null\n        } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">(root</span> === lastScheduledRoot) {\n          \n          lastScheduledRoot = previousScheduledRoot\n          lastScheduledRoot.nextScheduledRoot = firstScheduledRoot\n         <span class=\"hljs-built_in\"> root</span>.nextScheduledRoot = null\n          break\n        } <span class=\"hljs-keyword\">else</span> {\n          previousScheduledRoot.nextScheduledRoot =<span class=\"hljs-built_in\"> root</span>.nextScheduledRoot\n         <span class=\"hljs-built_in\"> root</span>.nextScheduledRoot = null\n        }\n       <span class=\"hljs-built_in\"> root</span> = previousScheduledRoot.nextScheduledRoot\n      } <span class=\"hljs-keyword\">else</span> {\n        <span class=\"hljs-keyword\">if</span> (\n          highestPriorityWork === NoWork ||\n          remainingExpirationTime &lt; highestPriorityWork\n        ) {\n          \n          highestPriorityWork = remainingExpirationTime\n          highestPriorityRoot =<span class=\"hljs-built_in\"> root</span>\n        }\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">(root</span> === lastScheduledRoot) {\n          break\n        }\n        <span class=\"hljs-keyword\">if</span> (highestPriorityWork === Sync) {\n          \n          \n          break\n        }\n        previousScheduledRoot =<span class=\"hljs-built_in\"> root</span>\n       <span class=\"hljs-built_in\"> root</span> =<span class=\"hljs-built_in\"> root</span>.nextScheduledRoot\n      }\n    }\n  }\n\n  nextFlushedRoot = highestPriorityRoot\n  nextFlushedExpirationTime = highestPriorityWork\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"224,294"}},{"content":"<pre data-lines=\"295,296\"><code>&#x4e0b;&#x4e00;&#x7bc7;&#xff1a;[`renderRoot`](https://react.jokcy.me/book/flow/render-root.html)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"295,296"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"297,298"}},{"content":"<pre data-lines=\"299,300\"><code>&#x626b;&#x7801;&#x6dfb;&#x52a0;Jokcy&#xff0c;&#x66f4;&#x591a;&#x66f4;&#x65b0;&#x66f4;&#x4f18;&#x8d28;&#x7684;&#x524d;&#x7aef;&#x5b66;&#x4e60;&#x5185;&#x5bb9;&#x4e0d;&#x65ad;&#x66f4;&#x65b0;&#x4e2d;&#xff0c;&#x671f;&#x5f85;&#x4e0e;&#x4f60;&#x4e00;&#x8d77;&#x6210;&#x957f;&#xff01;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"299,300"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"301,302"}}],"payload":{"tag":"h5","lines":"34,35"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
