<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"PIG &#x6574;&#x5408; RenRen &#x5355;&#x70b9;&#x767b;&#x5f55;","children":[{"content":"&#x73af;&#x5883;&#x8bf4;&#x660e;","children":[{"content":"pig 2.10","children":[],"payload":{"tag":"li","lines":"6,7"}},{"content":"renren-security 4.0.0","children":[],"payload":{"tag":"li","lines":"7,11"}}],"payload":{"tag":"h2","lines":"3,5"}},{"content":"&#x6dfb;&#x52a0;&#x4f9d;&#x8d56;&#x548c;&#x914d;&#x7f6e;","children":[{"content":"<pre data-lines=\"14,15\"><code>*   PIG &#x5ba2;&#x6237;&#x7aef;&#x8868; &#x4fe1;&#x606f;&#x5ba2;&#x6237;&#x7aef;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"14,15"}},{"content":"<pre data-lines=\"18,21\"><code data-lines=\"18,21\"><span class=\"hljs-keyword\">INSERT</span> <span class=\"hljs-keyword\">INTO</span> <span class=\"hljs-symbol\">`pig`</span>.<span class=\"hljs-symbol\">`sys_oauth_client_details`</span> (<span class=\"hljs-symbol\">`client_id`</span>,<span class=\"hljs-symbol\">`resource_ids`</span>,<span class=\"hljs-symbol\">`client_secret`</span>,<span class=\"hljs-symbol\">`scope`</span>,<span class=\"hljs-symbol\">`authorized_grant_types`</span>,<span class=\"hljs-symbol\">`web_server_redirect_uri`</span>,<span class=\"hljs-symbol\">`authorities`</span>,<span class=\"hljs-symbol\">`access_token_validity`</span>,<span class=\"hljs-symbol\">`refresh_token_validity`</span>,<span class=\"hljs-symbol\">`additional_information`</span>,<span class=\"hljs-symbol\">`autoapprove`</span>) <span class=\"hljs-keyword\">VALUES</span> (<span class=\"hljs-string\">&apos;renren&apos;</span>,<span class=\"hljs-literal\">NULL</span>,<span class=\"hljs-string\">&apos;renren&apos;</span>,<span class=\"hljs-string\">&apos;server&apos;</span>,<span class=\"hljs-string\">&apos;refresh_token,authorization_code&apos;</span>,<span class=\"hljs-string\">&apos;http://localhost:8080/renren-admin/sso/login&apos;</span>,<span class=\"hljs-literal\">NULL</span>,<span class=\"hljs-number\">43200</span>,<span class=\"hljs-number\">2592001</span>,<span class=\"hljs-literal\">NULL</span>,<span class=\"hljs-string\">&apos;true&apos;</span>); \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"18,21"}},{"content":"<pre data-lines=\"22,23\"><code>*   renren-admin/pom.xm\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"22,23"}},{"content":"<pre data-lines=\"26,33\"><code data-lines=\"26,33\"> <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.pig4cloud.shiro<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>sso-sdk<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>0.0.7<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span> \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"26,33"}},{"content":"<pre data-lines=\"34,35\"><code>*   &#x589e;&#x52a0;&#x914d;&#x7f6e; application.yml\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"34,35"}},{"content":"<pre data-lines=\"38,48\"><code data-lines=\"38,48\"><span class=\"hljs-params\">oauth2:</span>\n <span class=\"hljs-params\">client:</span>\n <span class=\"hljs-params\">client-id:</span> renren\n <span class=\"hljs-params\">client-secret:</span> renren\n <span class=\"hljs-params\">target-uri:</span> http:<span class=\"hljs-operator\">//</span>localhost:&#x24;{server.port}<span class=\"hljs-symbol\">/renren-security</span>  <span class=\"hljs-comment\">#&#x767b;&#x5f55;&#x540e;&#x8df3;&#x8f6c;&#x5230;&#x9996;&#x9875;&#x7684;&#x5730;&#x5740;</span>\n <span class=\"hljs-params\">logout-uri:</span> http:<span class=\"hljs-operator\">//</span>localhost:&#x24;{server.port}<span class=\"hljs-symbol\">/renren-security</span>   <span class=\"hljs-comment\">#&#x9000;&#x51fa;&#x540e;&#x8df3;&#x8f6c;&#x7684;&#x5730;&#x5740;</span>\n <span class=\"hljs-params\">sso-server-uri:</span> http:<span class=\"hljs-operator\">//</span><span class=\"hljs-number\">192.168</span>.<span class=\"hljs-number\">0.33</span>:<span class=\"hljs-number\">3000</span>      <span class=\"hljs-comment\">#pig &#x8ba4;&#x8bc1;&#x4e2d;&#x5fc3;&#x7684;&#x5730;&#x5740;</span>\n <span class=\"hljs-params\">scope:</span> server \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"38,48"}}],"payload":{"tag":"h2","lines":"11,13"}},{"content":"&#x65b0;&#x589e;&#x914d;&#x7f6e; OAuth2Realm","children":[{"content":"<pre data-lines=\"53,54\"><code>*   renren-admin/io.renren.modules.sys.shiro\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"53,54"}},{"content":"<pre data-lines=\"57,85\"><code data-lines=\"57,85\"><span class=\"hljs-meta\">@Component</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OAuth2Realm</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">UserRealm</span> {\n <span class=\"hljs-meta\">@Autowired</span>\n <span class=\"hljs-keyword\">private</span> SysUserDao sysUserDao;\n <span class=\"hljs-meta\">@Autowired</span>\n <span class=\"hljs-keyword\">private</span> OAuth2SsoKit auth2SsoKit;\n <span class=\"hljs-meta\">@Override</span>\n <span class=\"hljs-keyword\">protected</span> AuthenticationInfo <span class=\"hljs-title function_\">doGetAuthenticationInfo</span><span class=\"hljs-params\">(AuthenticationToken token)</span> <span class=\"hljs-keyword\">throws</span> AuthenticationException {\n <span class=\"hljs-type\">OAuth2SsoAuthenticationToken</span> <span class=\"hljs-variable\">oAuth2SsoAuthenticationToken</span> <span class=\"hljs-operator\">=</span> (OAuth2SsoAuthenticationToken) token;\n Map&lt;String, Object&gt; map = auth2SsoKit.getAccessToken(oAuth2SsoAuthenticationToken.getCode());\n <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">username</span>  <span class=\"hljs-operator\">=</span> (String) map.get(Constant.username);\n <span class=\"hljs-type\">SysUserEntity</span> <span class=\"hljs-variable\">sysUser</span> <span class=\"hljs-operator\">=</span> sysUserDao.selectOne(Wrappers.&lt;SysUserEntity&gt;lambdaQuery().eq(SysUserEntity::getUsername,username));\n <span class=\"hljs-type\">SimpleAuthenticationInfo</span> <span class=\"hljs-variable\">info</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SimpleAuthenticationInfo</span>(sysUser, sysUser.getPassword(), ByteSource.Util.bytes(sysUser.getSalt()), getName());\n oAuth2SsoAuthenticationToken.setUsername(sysUser.getUsername());\n oAuth2SsoAuthenticationToken.setPassword(sysUser.getPassword().toCharArray());\n <span class=\"hljs-keyword\">return</span> info;\n }\n <span class=\"hljs-meta\">@Override</span>\n <span class=\"hljs-keyword\">public</span> CredentialsMatcher <span class=\"hljs-title function_\">getCredentialsMatcher</span><span class=\"hljs-params\">()</span> {\n <span class=\"hljs-keyword\">return</span> (token, info) -&gt; <span class=\"hljs-literal\">true</span>;\n }\n <span class=\"hljs-meta\">@Override</span>\n <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">supports</span><span class=\"hljs-params\">(AuthenticationToken token)</span> {\n <span class=\"hljs-keyword\">return</span> token <span class=\"hljs-keyword\">instanceof</span> OAuth2SsoAuthenticationToken;\n }\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"57,85"}},{"content":"<pre data-lines=\"86,87\"><code>*   &#x914d;&#x7f6e; ShiroConfig\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"86,87"}},{"content":"<img src=\"https://mintlify.s3.us-west-1.amazonaws.com/xzcxz/images/1601977572787-3ed26630-eda4-49a0-9bc6-c047f5a27e44.png\" alt>","children":[],"payload":{"tag":"img","lines":"88,89"}},{"content":"<img src=\"https://mintlify.s3.us-west-1.amazonaws.com/xzcxz/images/1601977605304-c640af1a-a3d0-4919-899f-1c3c880d7a74.png\" alt>","children":[],"payload":{"tag":"img","lines":"90,91"}}],"payload":{"tag":"h2","lines":"50,52"}},{"content":"&#x524d;&#x7aef;&#x4f7f;&#x7528;","children":[{"content":"<pre data-lines=\"99,102\"><code data-lines=\"99,102\">http:<span class=\"hljs-regexp\">//</span>localhost:<span class=\"hljs-number\">8080</span><span class=\"hljs-regexp\">/renren-admin/</span>sso/login \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"99,102"}}],"payload":{"tag":"h2","lines":"94,96"}},{"content":"&#x9000;&#x51fa;&#x903b;&#x8f91;","children":[{"content":"<pre data-lines=\"109,118\"><code data-lines=\"109,118\"> <span class=\"hljs-variable\">@ResponseBody</span>\n <span class=\"hljs-variable\">@RequestMapping</span>(value = <span class=\"hljs-string\">&quot;logout&quot;</span>, method = RequestMethod.GET)\n public void <span class=\"hljs-built_in\">logout</span>() {\n <span class=\"hljs-selector-tag\">ssoKit</span><span class=\"hljs-selector-class\">.deleteToken</span>();\n <span class=\"hljs-selector-tag\">ShiroUtils</span><span class=\"hljs-selector-class\">.logout</span>();\n <span class=\"hljs-selector-tag\">ssoKit</span><span class=\"hljs-selector-class\">.logout</span>();\n } \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"109,118"}},{"content":"<img src=\"https://mintlify.s3.us-west-1.amazonaws.com/xzcxz/images/1601979272644-934ef2b2-ddfc-4fdd-b68d-9cd0c6565240.png\" alt>","children":[],"payload":{"tag":"img","lines":"119,120"}}],"payload":{"tag":"h2","lines":"104,106"}}],"payload":{"tag":"h1","lines":"0,2"}},{})</script>
</body>
</html>
