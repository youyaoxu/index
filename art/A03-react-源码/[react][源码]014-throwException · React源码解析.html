<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"throwException","children":[{"content":"<pre data-lines=\"4,7\"><code>&#x9996;&#x5148;&#x7ed9;&#x8fd9;&#x4e2a;`Fiber`&#x52a0;&#x4e0a;`Incomplete`&#x7684;`side effect`&#xff0c;&#x5e76;&#x4e14;&#x6674;&#x7a7a;`effect`&#x94fe;\n\n&#x4e3b;&#x8981;&#x5206;&#x4e3a;`suspend`&#x548c;`did error`&#x4e24;&#x79cd;&#x60c5;&#x51b5;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4,7"}},{"content":"suspend","children":[{"content":"","children":[{"content":"<pre data-lines=\"13,14\"><code>&#x9700;&#x8981;&#x7b26;&#x5408;&#x6761;&#x4ef6;&#xff1a;`throw value`&#x662f;&#x4e00;&#x4e2a;`promise`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"13,14"}},{"content":"<pre data-lines=\"15,23\"><code data-lines=\"15,23\">if <span class=\"hljs-punctuation\">(</span>\n  value !<span class=\"hljs-punctuation\">=</span><span class=\"hljs-punctuation\">=</span> <span class=\"hljs-literal\">null</span> <span class=\"hljs-meta\">&amp;&amp;</span>\n  typeof value <span class=\"hljs-punctuation\">=</span><span class=\"hljs-punctuation\">=</span><span class=\"hljs-punctuation\">=</span> &apos;object&apos; <span class=\"hljs-meta\">&amp;&amp;</span>\n  typeof value.then <span class=\"hljs-punctuation\">=</span><span class=\"hljs-punctuation\">=</span><span class=\"hljs-punctuation\">=</span> &apos;function&apos;\n<span class=\"hljs-punctuation\">)</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"15,23"}},{"content":"<pre data-lines=\"24,25\"><code>&#x5904;&#x7406;&#x8fd9;&#x79cd;&#x60c5;&#x51b5;&#x4f1a;&#x6709;&#x4e24;&#x4e2a;&#x5faa;&#x73af;&#xff0c;&#x5728;&#x8fd9;&#x4e4b;&#x524d;&#x521d;&#x59cb;&#x5316;&#x4e86;&#x4e24;&#x4e2a;&#x53d8;&#x91cf;`earliestTimeoutMs`&#x548c;`startTimeMs`&#xff0c;&#x90fd;&#x662f;`-1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"24,25"}}],"payload":{"tag":"h4","lines":"11,12"}},{"content":"&#x7b2c;&#x4e00;&#x4e2a;&#x5faa;&#x73af;","children":[{"content":"<pre data-lines=\"28,29\"><code>&#x8fd9;&#x4e2a;&#x5faa;&#x73af;&#x4e3b;&#x8981;&#x662f;&#x8ba1;&#x7b97;&#x521d;&#x59cb;&#x5316;&#x7684;&#x4e24;&#x4e2a;&#x503c;&#x3002;&#x4ed6;&#x4eec;&#x53ea;&#x8ddf;`Suspense`&#x6709;&#x5173;&#x7cfb;&#xff0c;`timeOutAt`&#x662f;&#x5728;`commitWork`&#x7684;&#x65f6;&#x5019;&#x8bbe;&#x7f6e;&#x7684;&#xff0c;&#x6240;&#x4ee5;&#x7b2c;&#x4e00;&#x6b21;&#x6ca1;&#x6709;&#xff0c;&#x800c;&#x8bbe;&#x7f6e;&#x7684;&#x503c;&#x5c31;&#x662f;&#x5f53;&#x65f6;&#x7684;`currentTime`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"28,29"}},{"content":"<pre data-lines=\"30,35\"><code data-lines=\"30,35\"><span class=\"hljs-keyword\">const</span> currentTime = requestCurrentTime()\nfinishedWork.<span class=\"hljs-keyword\">state</span>Node = { timedOutAt: currentTime }\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"30,35"}},{"content":"<pre data-lines=\"36,39\"><code>`earliestTimeoutMs`&#x8ddf;`maxDuration`&#x6709;&#x5173;&#xff0c;&#x4ed6;&#x4f1a;&#x5411;&#x4e0a;&#x627e;&#x5230;`maxDuration`&#x6700;&#x5c0f;&#x7684;&#x975e;&#x8d1f;&#x6570;\n\n&#x6240;&#x4ee5;&#x7b2c;&#x4e00;&#x6b21;&#x6e32;&#x67d3;&#x7684;&#x65f6;&#x5019;&#xff0c;`startTimeMs`&#x662f;`-1`&#xff0c;&#x7b2c;&#x4e8c;&#x6b21;&#x6e32;&#x67d3;`earliestTimeoutMs`&#x662f;`-1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"36,39"}}],"payload":{"tag":"h4","lines":"26,27"}},{"content":"&#x7b2c;&#x4e8c;&#x4e2a;&#x5faa;&#x73af;","children":[{"content":"&#x90a3;&#x4e48;&#x7b2c;&#x4e8c;&#x4e2a;&#x5faa;&#x73af;&#x518d;<code>!didTimeout</code>&#x4e2d;&#x7684;&#x903b;&#x8f91;&#x5177;&#x4f53;&#x662f;&#x4ec0;&#x4e48;&#x5462;","children":[{"content":"<pre data-lines=\"57,58\"><code>&#x9996;&#x5148;&#x8981;&#x7ed1;&#x5b9a;`suquense`&#x7ec4;&#x4ef6;&#x7684;`resolve`&#x4e4b;&#x540e;&#x8981;&#x6267;&#x884c;`retrySuspendedRoot`&#xff0c;&#x7136;&#x540e;&#x8ba1;&#x7b97;`absoluteTimeoutMs`&#xff0c;&#x7136;&#x540e;&#x8c03;&#x7528;`renderDidSuspend`&#xff0c;&#x8fd9;&#x5757;&#x6211;&#x4eec;&#x653e;&#x5230;&#x4e0b;&#x9762;&#x518d;&#x8bb2;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"57,58"}}],"payload":{"tag":"h6","lines":"55,56"}}],"payload":{"tag":"h4","lines":"40,41"}},{"content":"&#x6ce8;&#x610f;","children":[{"content":"<pre data-lines=\"61,64\"><code>**&#x5728;&#x5199;&#x8fd9;&#x7247;&#x6587;&#x7ae0;&#x7684;&#x65f6;&#x5019;`susquense`&#x529f;&#x80fd;&#x5e76;&#x6ca1;&#x6709;&#x6b63;&#x5f0f;&#x53d1;&#x5e03;&#xff0c;&#x6240;&#x4ee5;&#x53ef;&#x80fd;&#x4f1a;&#x6709;&#x633a;&#x591a;&#x6539;&#x52a8;&#xff0c;&#x5e76;&#x4e14;&#x4e5f;&#x5b58;&#x5728;&#x4e00;&#x4e9b; bug&#xff0c;&#x6bd4;&#x5982;`maxDuration`&#x8c8c;&#x4f3c;&#x6ca1;&#x7528;&#xff0c;&#x518d;&#x6bd4;&#x5982;&#x591a;&#x6b21;`throwException`&#x4e2d;&#x4f1a;&#x7ed9;&#x540c;&#x4e00;&#x4e2a;`promise`&#x7ed1;&#x5b9a;&#x591a;&#x6b21;`retry`&#xff0c;&#x5bfc;&#x81f4;&#x540e;&#x6765;`retry`&#x591a;&#x6b21;&#x6e32;&#x67d3;&#xff0c;&#x76f8;&#x4fe1;&#x5728; 17 &#x7248;&#x672c;&#x53d1;&#x5e03;&#x7684;&#x65f6;&#x5019;&#x5e94;&#x8be5;&#x6709;&#x6240;&#x6539;&#x5584;&#x3002;** \n\nTODO: 17 &#x7248;&#x672c;&#x53d1;&#x5e03;&#x4e4b;&#x540e;&#x518d;&#x6b21;&#x786e;&#x8ba4;&#x8fd9;&#x90e8;&#x5206;&#x4ee3;&#x7801;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"61,64"}}],"payload":{"tag":"h4","lines":"59,60"}}],"payload":{"tag":"h2","lines":"8,10"}},{"content":"&#x975e;<code>Suspense</code>&#x7684;&#x60c5;&#x51b5;","children":[{"content":"<pre data-lines=\"68,74\"><code>&#x8fd9;&#x79cd;&#x60c5;&#x51b5;&#x76f8;&#x5f53;&#x4e8e;&#x6355;&#x6349;&#x5230;&#x4e86;&#x4e00;&#x4e2a;&#x9519;&#x8bef;&#xff0c;&#x8fd9;&#x8fb9;&#x7684;&#x64cd;&#x4f5c;&#x662f;&#x5411;&#x4e0a;&#x904d;&#x5386;&#x8282;&#x70b9;&#xff0c;&#x5bf9;`HostRoot`&#x3001;`ClassComponent`&#x548c;`ClassComponentLazy`&#x505a;&#x4e00;&#x4e9b;&#x64cd;&#x4f5c;&#xff1a;\n\n1.  &#x52a0;&#x4e0a;`shouldCapture`&#x7684;`side effect`\n2.  &#x521b;&#x5efa;`error update`\n\n&#x6ce8;&#x610f;&#xff0c;&#x5bf9;&#x4e8e;`ClassComponent`&#x53ea;&#x6709;&#x5f53;&#x7ec4;&#x4ef6;&#x58f0;&#x660e;`getDerivedStateFromCatch`&#x6216;&#x8005;`componentDidCatch`&#x7684;&#x7ec4;&#x4ef6;&#x4f1a;&#x505a;&#x8fd9;&#x4e9b;&#x64cd;&#x4f5c;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"68,74"}},{"content":"<pre data-lines=\"75,256\"><code data-lines=\"75,256\"><span class=\"hljs-function\">function <span class=\"hljs-title\">throwException</span>(<span class=\"hljs-params\">\n  root: FiberRoot,\n  returnFiber: Fiber,\n  sourceFiber: Fiber,\n  <span class=\"hljs-keyword\">value</span>: mixed,\n  renderExpirationTime: ExpirationTime,\n</span>)</span> {\n  \n  sourceFiber.effectTag |= Incomplete\n  \n  sourceFiber.firstEffect = sourceFiber.lastEffect = <span class=\"hljs-function\"><span class=\"hljs-literal\">null</span>\n\n  <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">\n    <span class=\"hljs-keyword\">value</span> !== <span class=\"hljs-literal\">null</span> &amp;&amp;\n    <span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-keyword\">value</span> === <span class=\"hljs-string\">&apos;object&apos;</span> &amp;&amp;\n    <span class=\"hljs-keyword\">typeof</span> <span class=\"hljs-keyword\">value</span>.then === <span class=\"hljs-string\">&apos;function&apos;</span>\n  </span>)</span> {\n    \n    <span class=\"hljs-keyword\">const</span> thenable: Thenable = (<span class=\"hljs-keyword\">value</span>: any)\n\n    <span class=\"hljs-keyword\">let</span> workInProgress = returnFiber\n    <span class=\"hljs-keyword\">let</span> earliestTimeoutMs = <span class=\"hljs-number\">-1</span>\n    <span class=\"hljs-keyword\">let</span> startTimeMs = <span class=\"hljs-number\">-1</span>\n    <span class=\"hljs-keyword\">do</span> {\n      <span class=\"hljs-keyword\">if</span> (workInProgress.tag === SuspenseComponent) {\n        <span class=\"hljs-keyword\">const</span> current = workInProgress.<span class=\"hljs-function\">alternate\n        <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">current !== <span class=\"hljs-literal\">null</span></span>)</span> {\n          <span class=\"hljs-keyword\">const</span> currentState: SuspenseState | <span class=\"hljs-literal\">null</span> = current.<span class=\"hljs-function\">memoizedState\n          <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">currentState !== <span class=\"hljs-literal\">null</span> &amp;&amp; currentState.didTimeout</span>)</span> {\n            \n            \n            <span class=\"hljs-keyword\">const</span> timedOutAt = currentState.timedOutAt\n            startTimeMs = expirationTimeToMs(timedOutAt)\n            \n            <span class=\"hljs-keyword\">break</span>\n          }\n        }\n        <span class=\"hljs-keyword\">let</span> timeoutPropMs = workInProgress.pendingProps.<span class=\"hljs-function\">maxDuration\n        <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\"><span class=\"hljs-keyword\">typeof</span> timeoutPropMs === <span class=\"hljs-string\">&apos;number&apos;</span></span>)</span> {\n          <span class=\"hljs-keyword\">if</span> (timeoutPropMs &lt;= <span class=\"hljs-number\">0</span>) {\n            earliestTimeoutMs = <span class=\"hljs-number\">0</span>\n          } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (\n            earliestTimeoutMs === <span class=\"hljs-number\">-1</span> ||\n            timeoutPropMs &lt; earliestTimeoutMs\n          ) {\n            earliestTimeoutMs = timeoutPropMs\n          }\n        }\n      }\n      workInProgress = workInProgress.<span class=\"hljs-keyword\">return</span>\n    } <span class=\"hljs-keyword\">while</span> (workInProgress !== <span class=\"hljs-literal\">null</span>)\n\n    \n    workInProgress = returnFiber\n    <span class=\"hljs-keyword\">do</span> {\n      <span class=\"hljs-keyword\">if</span> (\n        workInProgress.tag === SuspenseComponent &amp;&amp;\n        shouldCaptureSuspense(workInProgress.alternate, workInProgress)\n      ) {\n        <span class=\"hljs-keyword\">const</span> pingTime =\n          (workInProgress.mode &amp; ConcurrentMode) === NoEffect\n            ? Sync\n            : renderExpirationTime\n\n        \n        <span class=\"hljs-keyword\">let</span> onResolveOrReject = retrySuspendedRoot.bind(\n          <span class=\"hljs-literal\">null</span>,\n          root,\n          workInProgress,\n          sourceFiber,\n          pingTime,\n        )\n        <span class=\"hljs-keyword\">if</span> (enableSchedulerTracing) {\n          onResolveOrReject = Schedule_tracing_wrap(onResolveOrReject)\n        }\n        thenable.then(onResolveOrReject, onResolveOrReject)\n        <span class=\"hljs-keyword\">if</span> ((workInProgress.mode &amp; ConcurrentMode) === NoEffect) {\n          workInProgress.effectTag |= CallbackEffect\n\n          \n          <span class=\"hljs-keyword\">const</span> nextChildren = <span class=\"hljs-function\"><span class=\"hljs-literal\">null</span>\n          <span class=\"hljs-title\">reconcileChildren</span>(<span class=\"hljs-params\">\n            sourceFiber.alternate,\n            sourceFiber,\n            nextChildren,\n            renderExpirationTime,\n          </span>)\n          sourceFiber.effectTag &amp;</span>= ~<span class=\"hljs-function\">Incomplete\n\n          <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">sourceFiber.tag === ClassComponent</span>)</span> {\n            sourceFiber.effectTag &amp;= ~LifecycleEffectMask\n            <span class=\"hljs-keyword\">const</span> current = sourceFiber.<span class=\"hljs-function\">alternate\n            <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">current === <span class=\"hljs-literal\">null</span></span>)</span> {\n              sourceFiber.tag = IncompleteClassComponent\n            }\n          }\n\n          \n          <span class=\"hljs-keyword\">return</span>\n        }\n\n        <span class=\"hljs-function\"><span class=\"hljs-keyword\">let</span> absoluteTimeoutMs\n        <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">earliestTimeoutMs === <span class=\"hljs-number\">-1</span></span>)</span> {\n          absoluteTimeoutMs = maxSigned31BitInt\n        } <span class=\"hljs-keyword\">else</span> {\n          <span class=\"hljs-keyword\">if</span> (startTimeMs === <span class=\"hljs-number\">-1</span>) {\n            <span class=\"hljs-keyword\">const</span> earliestExpirationTime = findEarliestOutstandingPriorityLevel(\n              root,\n              renderExpirationTime,\n            )\n            <span class=\"hljs-keyword\">const</span> earliestExpirationTimeMs = expirationTimeToMs(\n              earliestExpirationTime,\n            )\n            startTimeMs = earliestExpirationTimeMs - LOW_PRIORITY_EXPIRATION\n          }\n          absoluteTimeoutMs = startTimeMs + earliestTimeoutMs\n        }\n        renderDidSuspend(root, absoluteTimeoutMs, renderExpirationTime)\n\n        workInProgress.effectTag |= ShouldCapture\n        workInProgress.expirationTime = renderExpirationTime\n        <span class=\"hljs-keyword\">return</span>\n      }\n      workInProgress = workInProgress.<span class=\"hljs-keyword\">return</span>\n    } <span class=\"hljs-keyword\">while</span> (workInProgress !== <span class=\"hljs-literal\">null</span>)\n    \n    <span class=\"hljs-keyword\">value</span> = <span class=\"hljs-keyword\">new</span> Error(\n      <span class=\"hljs-string\">&apos;An update was suspended, but no placeholder UI was provided.&apos;</span>,\n    )\n  }\n\n  renderDidError()\n  <span class=\"hljs-keyword\">value</span> = createCapturedValue(<span class=\"hljs-keyword\">value</span>, sourceFiber)\n  <span class=\"hljs-keyword\">let</span> workInProgress = returnFiber\n  <span class=\"hljs-keyword\">do</span> {\n    <span class=\"hljs-keyword\">switch</span> (workInProgress.tag) {\n      <span class=\"hljs-keyword\">case</span> HostRoot: {\n        <span class=\"hljs-keyword\">const</span> errorInfo = <span class=\"hljs-keyword\">value</span>\n        workInProgress.effectTag |= ShouldCapture\n        workInProgress.expirationTime = renderExpirationTime\n        <span class=\"hljs-keyword\">const</span> update = createRootErrorUpdate(\n          workInProgress,\n          errorInfo,\n          renderExpirationTime,\n        )\n        enqueueCapturedUpdate(workInProgress, update)\n        <span class=\"hljs-keyword\">return</span>\n      }\n      <span class=\"hljs-keyword\">case</span> ClassComponent:\n        \n        <span class=\"hljs-keyword\">const</span> errorInfo = <span class=\"hljs-keyword\">value</span>\n        <span class=\"hljs-keyword\">const</span> ctor = workInProgress.type\n        <span class=\"hljs-keyword\">const</span> instance = workInProgress.<span class=\"hljs-function\">stateNode\n        <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">\n          (workInProgress.effectTag &amp; DidCapture</span>)</span> === NoEffect &amp;&amp;\n          (<span class=\"hljs-keyword\">typeof</span> ctor.getDerivedStateFromError === <span class=\"hljs-string\">&apos;function&apos;</span> ||\n            (instance !== <span class=\"hljs-literal\">null</span> &amp;&amp;\n              <span class=\"hljs-keyword\">typeof</span> instance.componentDidCatch === <span class=\"hljs-string\">&apos;function&apos;</span> &amp;&amp;\n              !isAlreadyFailedLegacyErrorBoundary(instance)))\n        ) {\n          workInProgress.effectTag |= ShouldCapture\n          workInProgress.expirationTime = renderExpirationTime\n          \n          <span class=\"hljs-keyword\">const</span> update = createClassErrorUpdate(\n            workInProgress,\n            errorInfo,\n            renderExpirationTime,\n          )\n          enqueueCapturedUpdate(workInProgress, update)\n          <span class=\"hljs-keyword\">return</span>\n        }\n        <span class=\"hljs-keyword\">break</span>\n      <span class=\"hljs-literal\">default</span>:\n        <span class=\"hljs-keyword\">break</span>\n    }\n    workInProgress = workInProgress.<span class=\"hljs-keyword\">return</span>\n  } <span class=\"hljs-keyword\">while</span> (workInProgress !== <span class=\"hljs-literal\">null</span>)\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"75,256"}},{"content":"<pre data-lines=\"257,273\"><code>&#x6211;&#x4eec;&#x4e0a;&#x9762;&#x63d0;&#x5230;&#x4e86;&#xff1a;\n\n*   `earliestTimeoutMs`&#x662f;&#x6700;&#x5c0f;&#x7684;`maxDuration`\n*   `startTimeMs`&#x662f;&#x4e0a;&#x6b21;`commit`&#x8bbe;&#x7f6e;&#x7684;`timedOutAt`\n\n&#x5982;&#x679c;&#x6ca1;&#x6709;&#x8bbe;&#x7f6e;`maxDuration`&#xff0c;&#x90a3;&#x4e48;`absoluteTimeoutMs`&#x662f;`maxSigned31BitInt`&#x4e5f;&#x5c31;&#x662f;`1073741823`&#xff0c;&#x57fa;&#x672c;&#x610f;&#x601d;&#x5c31;&#x662f;&#x6c38;&#x8fdc;&#x4e0d;&#x8fc7;&#x8d85;&#x65f6;\n\n&#x5982;&#x679c;&#x6709;&#x8bbe;&#x7f6e;`maxDuration`&#xff0c;&#x56e0;&#x4e3a;&#x7b2c;&#x4e00;&#x6b21;&#x6ca1;&#x6709;`startTimeMs`&#xff0c;&#x6240;&#x4ee5;&#x8981;&#x8ba1;&#x7b97;&#x4e00;&#x4e2a;&#xff0c;&#x4ece;&#x5f53;&#x524d;`root`&#x7684;&#x6240;&#x6709;&#x8fc7;&#x671f;&#x65f6;&#x95f4;&#x4e2d;&#x627e;&#x4e00;&#x4e2a;&#x4f18;&#x5148;&#x7ea7;&#x6700;&#x9ad8;&#x7684;&#xff0c;&#x7136;&#x540e;&#x51cf;&#x53bb;`LOW_PRIORITY_EXPIRATION`&#xff0c;&#x8fd9;&#x90e8;&#x5206;&#x8ba1;&#x7b97;&#x4e0d;&#x5fc5;&#x8981;&#x592a;&#x5728;&#x610f;&#xff0c;&#x6211;&#x4eec;&#x4e3b;&#x8981;&#x770b;&#x4e00;&#x4e0b;&#x7b2c;&#x4e8c;&#x6b21;&#x8fdb;&#x6765;&#x7684;&#x65f6;&#x5019;\n\n&#x5728;&#x6709;`earliestTimeoutMs`&#x548c;`startTimeMs`&#x7684;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;`absoluteTimeoutMs`&#x7b49;&#x4e8e;`startTimeMs + earliestTimeoutM`&#xff0c;&#x7b80;&#x5355;&#x6765;&#x8bf4;&#x5c31;&#x662f;&#x5c11;&#x4e86;&#x7b2c;&#x4e00;&#x6b21;&#x6e32;&#x67d3;&#x5230;&#x8fd9;&#x6b21;&#x6709;&#x66f4;&#x65b0;&#x8fdb;&#x6765;&#x4e2d;&#x95f4;&#x7684;&#x7a7a;&#x767d;&#x65f6;&#x95f4;&#xff0c;&#x4e5f;&#x7b26;&#x5408;`maxDuration`&#x9700;&#x8981;&#x7684;&#x542b;&#x4e49;&#x3002;\n\n**&#x4f46;&#x662f;&#x6839;&#x636e;&#x4e4b;&#x524d;&#x8bf4;&#x7684;&#x903b;&#x8f91;&#xff0c;&#x5728;&#x6709;`startTimeMs`&#x7684;&#x60c5;&#x51b5;&#x4e0b;&#x6839;&#x672c;&#x4e0d;&#x4f1a;&#x6267;&#x884c;`earliestTimeoutMs`&#x7684;&#x903b;&#x8f91;&#xff0c;&#x6240;&#x4ee5;&#x8fd9;&#x4e2a;&#x903b;&#x8f91;&#x662f;&#x5426;&#x6709;&#x95ee;&#x9898;&#xff1f;&#x5b9e;&#x9645;&#x6211;&#x5199;&#x4e86;&#x4e2a;&#x5c0f;&#x4f8b;&#x5b50;&#x770b;&#x4e86;&#x4e00;&#x4e0b;&#x7ed3;&#x679c;&#x4e5f;&#x662f;&#x548c;&#x6211;&#x7684;&#x9884;&#x671f;&#x4e00;&#x6837;**\n\nTODO: 17 &#x7248;&#x672c;&#x6765;&#x9a8c;&#x8bc1;&#x8fd9;&#x4e2a;&#x903b;&#x8f91;&#x662f;&#x5426;&#x6709;&#x95ee;&#x9898;\n\n[&#x56de;&#x5230;`renderRoot`](https://react.jokcy.me/book/flow/render-root.html)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"257,273"}},{"content":"<pre data-lines=\"274,309\"><code data-lines=\"274,309\">\n<span class=\"hljs-keyword\">let</span> absoluteTimeoutMs\n<span class=\"hljs-function\"><span class=\"hljs-title\">if</span> <span class=\"hljs-params\">(earliestTimeoutMs === -<span class=\"hljs-number\">1</span>)</span> {\n  <span class=\"hljs-title\">absoluteTimeoutMs</span> = <span class=\"hljs-title\">maxSigned31BitInt</span>\n} <span class=\"hljs-title\">else</span> {\n  <span class=\"hljs-title\">if</span> <span class=\"hljs-params\">(startTimeMs === -<span class=\"hljs-number\">1</span>)</span> {\n    <span class=\"hljs-title\">const</span> <span class=\"hljs-title\">earliestExpirationTime</span> = <span class=\"hljs-title\">findEarliestOutstandingPriorityLevel</span><span class=\"hljs-params\">(\n      root,\n      renderExpirationTime,\n    )</span>\n    <span class=\"hljs-title\">const</span> <span class=\"hljs-title\">earliestExpirationTimeMs</span> = <span class=\"hljs-title\">expirationTimeToMs</span><span class=\"hljs-params\">(earliestExpirationTime)</span>\n    <span class=\"hljs-title\">startTimeMs</span> = <span class=\"hljs-title\">earliestExpirationTimeMs</span> - LOW_PRIORITY_EXPIRATION\n  }\n  <span class=\"hljs-title\">absoluteTimeoutMs</span> = <span class=\"hljs-title\">startTimeMs</span> + <span class=\"hljs-title\">earliestTimeoutMs</span>\n}\n\n<span class=\"hljs-title\">renderDidSuspend</span><span class=\"hljs-params\">(root, absoluteTimeoutMs, renderExpirationTime)</span>\n\n\n<span class=\"hljs-title\">function</span> <span class=\"hljs-title\">renderDidSuspend</span><span class=\"hljs-params\">(\n  root: FiberRoot,\n  absoluteTimeoutMs: number,\n  suspendedTime: ExpirationTime,\n)</span> {\n  \n  <span class=\"hljs-title\">if</span> <span class=\"hljs-params\">(\n    absoluteTimeoutMs &gt;= <span class=\"hljs-number\">0</span> &amp;&amp;\n    nextLatestAbsoluteTimeoutMs &lt; absoluteTimeoutMs\n  )</span> {\n    <span class=\"hljs-title\">nextLatestAbsoluteTimeoutMs</span> = <span class=\"hljs-title\">absoluteTimeoutMs</span>\n  }\n}\n\n</span></code></pre>","children":[],"payload":{"tag":"pre","lines":"274,309"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"310,311"}},{"content":"<pre data-lines=\"312,313\"><code>&#x626b;&#x7801;&#x6dfb;&#x52a0;Jokcy&#xff0c;&#x66f4;&#x591a;&#x66f4;&#x65b0;&#x66f4;&#x4f18;&#x8d28;&#x7684;&#x524d;&#x7aef;&#x5b66;&#x4e60;&#x5185;&#x5bb9;&#x4e0d;&#x65ad;&#x66f4;&#x65b0;&#x4e2d;&#xff0c;&#x671f;&#x5f85;&#x4e0e;&#x4f60;&#x4e00;&#x8d77;&#x6210;&#x957f;&#xff01;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"312,313"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"314,315"}}],"payload":{"tag":"h2","lines":"65,67"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
