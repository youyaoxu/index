<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"03-io-concur-day07","children":[{"content":"IO-CONCUR","children":[{"content":"&#x524d;&#x60c5;&#x56de;&#x987e;","children":[{"content":"<pre data-lines=\"8,56\"><code data-lines=\"8,56\">\n<span class=\"hljs-bullet\">1.</span> &#x5b64;&#x513f;&#x8fdb;&#x7a0b;&#x548c;&#x50f5;&#x5c38;&#x8fdb;&#x7a0b;\n\n   wait()\n   &#x4e8c;&#x7ea7;&#x5b50;&#x8fdb;&#x7a0b;\n   signal\n\n<span class=\"hljs-bullet\">2.</span> &#x804a;&#x5929;&#x5ba4;\n\n  &#x9700;&#x6c42;&#x7684;&#x5206;&#x6790;-&gt;&#x6280;&#x672f;&#x70b9;-&gt;&#x7ed3;&#x6784;&#x62c6;&#x5206;&#xff0c;&#x5206;&#x88c5;&#x8bbe;&#x5b9a;-&gt;&#x529f;&#x80fd;&#x5212;&#x5206;&#xff0c;&#x534f;&#x8bae;&#x8bbe;&#x8ba1;-&gt;&#x6839;&#x636e;&#x529f;&#x80fd;&#x6a21;&#x5757;&#x7f16;&#x5199;&#x4ee3;&#x7801;-&gt;&#x4ee3;&#x7801;&#x5757;&#x68c0;&#x6d4b;\n\n<span class=\"hljs-bullet\">  *</span> &#x5b9a;&#x534f;&#x8bae;\n<span class=\"hljs-bullet\">  *</span> &#x8bf7;&#x6c42;&#x5e94;&#x7b54;&#x6d41;&#x7a0b;\n<span class=\"hljs-bullet\">  *</span> &#x4efb;&#x52a1;&#x5206;&#x53d1; &#xff08;&#x603b;&#x5206;&#xff09;\n\n\n&#x7ec3;&#x4e60;1&#xff1a; &#x5927;&#x6587;&#x4ef6;&#x62c6;&#x5206;\n\n<span class=\"hljs-code\">       &#x4f7f;&#x7528;Process&#x5b8c;&#x6210;&#xff0c;&#x8981;&#x6c42;&#x5c06;&#x5927;&#x6587;&#x4ef6;&#x62c6;&#x5206;&#x6210;2&#x4e2a;&#x5c0f;&#x6587;&#x4ef6;&#xff0c;\n       &#x6309;&#x7167;&#x5b57;&#x8282;&#x5927;&#x5c0f;&#x53bb;&#x5206;&#x6210;&#x4e24;&#x4e2a;&#x3002;&#x8981;&#x6c42;&#x4e0a;&#x4e0b;&#x4e24;&#x4e2a;&#x90e8;&#x5206;&#x540c;&#x65f6;&#x64cd;&#x4f5c;&#x3002;\n</span>\n<span class=\"hljs-code\">       &#x63d0;&#x793a;&#xff1a; &#x4e24;&#x4e2a;&#x5b50;&#x8fdb;&#x7a0b;&#x5206;&#x522b;&#x53bb;&#x505a;\n             &#x6ce8;&#x610f;&#x8bfb;&#x5199;&#x504f;&#x79fb;&#x91cf;&#x63a7;&#x5236;\n</span>\n&#x7ec3;&#x4e60;2&#xff1a; &#x6c42;100000&#x4ee5;&#x5185;&#x8d28;&#x6570;&#x4e4b;&#x548c;&#xff0c;&#x4f7f;&#x7528;&#x540c;&#x6837;&#x7b97;&#x6cd5;&#x5c06;&#x65f6;&#x95f4;&#x964d;&#x5230;&#x4ee5;&#x524d;&#x7684;60%&#x4ee5;&#x4e0b;\n\n<span class=\"hljs-code\">       &#x63d0;&#x793a;&#xff1a; 4&#x8fdb;&#x7a0b;  1---25000\n                   25001---75000\n</span>\n<span class=\"hljs-code\">            10&#x8fdb;&#x7a0b;  1----10000\n                   10001--20000\n</span>\n&#x7ec3;&#x4e60;3&#xff1a; &#x4f7f;&#x7528;&#x8fdb;&#x7a0b;&#x6c60;&#x62f7;&#x8d1d;&#x4e00;&#x4e2a;&#x76ee;&#x5f55;&#xff08;&#x5305;&#x542b;&#x76ee;&#x5f55;&#x4e2d;&#x6240;&#x6709;&#x5185;&#x5bb9;&#xff09;&#xff0c;&#x76ee;&#x5f55;&#x4e2d;\n&#x5305;&#x542b;&#x82e5;&#x5e72;&#x4e2a;&#x666e;&#x901a;&#x6587;&#x4ef6;&#x3002;\n\n<span class=\"hljs-bullet\">       *</span>  &#x76ee;&#x5f55;&#x4e2d;&#x7684;&#x6bcf;&#x4e2a;&#x6587;&#x4ef6;&#x62f7;&#x8d1d;&#x8fc7;&#x7a0b;&#x90fd;&#x9700;&#x8981;&#x4e00;&#x4e2a;&#x5355;&#x72ec;&#x7684;&#x8fdb;&#x7a0b;&#x53bb;\n<span class=\"hljs-code\">       &#x5b9e;&#x73b0;\n</span>\n<span class=\"hljs-bullet\">       *</span>  &#x62f7;&#x8d1d;&#x8fc7;&#x7a0b;&#x4e2d;&#x5b9e;&#x65f6;&#x663e;&#x793a;&#x62f7;&#x8d1d;&#x7684;&#x767e;&#x5206;&#x6bd4;\n\n\n<span class=\"hljs-code\">       os.mkdir() &#x521b;&#x5efa;&#x76ee;&#x5f55;\n</span>\n&#x4f5c;&#x4e1a;&#xff1a; 1. &#x5bf9;&#x6bd4;&#x719f;&#x7ec3;&#x4e24;&#x79cd;&#x8fdb;&#x7a0b;&#x521b;&#x5efa;&#x65b9;&#x6cd5;\n<span class=\"hljs-bullet\">      2.</span> &#x5b8c;&#x6210;&#x5269;&#x4f59;&#x7ec3;&#x4e60;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"8,56"}}],"payload":{"tag":"h5","lines":"6,7"}},{"content":"&#x793a;&#x4f8b;","children":[{"content":"<pre data-lines=\"59,89\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nmy_process.py\n&#x81ea;&#x5b9a;&#x4e49;&#x8fdb;&#x7a0b;&#x7c7b;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> multiprocessing <span class=\"hljs-keyword\">import</span> Process\n<span class=\"hljs-keyword\">from</span> time <span class=\"hljs-keyword\">import</span> sleep\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyProcess</span>(<span class=\"hljs-title class_ inherited__\">Process</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self,value</span>):\n        <span class=\"hljs-built_in\">super</span>().__init__()  <span class=\"hljs-comment\"># &#x8c03;&#x7528;Process&#x7c7b;&#x7684;init&#x65b9;&#x6cd5;&#xff0c;&#x83b7;&#x53d6;&#x7236;&#x7c7b;&#x4e2d;&#x5b9a;&#x4e49;&#x7684;&#x5c5e;&#x6027;</span>\n        <span class=\"hljs-variable language_\">self</span>.value = value\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">fun1</span>(<span class=\"hljs-params\">self</span>):\n        sleep(<span class=\"hljs-number\">2</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x590d;&#x6742;&#x6b65;&#x9aa4;1&quot;</span>)\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">fun2</span>(<span class=\"hljs-params\">self</span>):\n        sleep(<span class=\"hljs-number\">3</span>)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x590d;&#x6742;&#x6b65;&#x9aa4;2&quot;</span>)\n\n    <span class=\"hljs-comment\"># &#x8fdb;&#x7a0b;&#x51fd;&#x6570;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-variable language_\">self</span>.fun1()\n        <span class=\"hljs-variable language_\">self</span>.fun2()\n\n\np = MyProcess(<span class=\"hljs-number\">2</span>)\np.start() <span class=\"hljs-comment\"># &#x81ea;&#x52a8;&#x8fd0;&#x884c;run()</span>\np.join()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"59,89"}},{"content":"<pre data-lines=\"90,119\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\npool.py\n&#x8fdb;&#x7a0b;&#x6c60;&#x4f7f;&#x7528;&#x793a;&#x4f8b;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> multiprocessing <span class=\"hljs-keyword\">import</span> Pool\n<span class=\"hljs-keyword\">from</span> time <span class=\"hljs-keyword\">import</span> ctime,sleep\n\n<span class=\"hljs-comment\"># &#x8fdb;&#x7a0b;&#x6c60;&#x4e8b;&#x4ef6;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">worker</span>(<span class=\"hljs-params\">msg</span>):\n    sleep(<span class=\"hljs-number\">2</span>)\n    <span class=\"hljs-built_in\">print</span>(ctime(),<span class=\"hljs-string\">&apos;---&apos;</span>,msg)\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x8fdb;&#x7a0b;&#x6c60;</span>\npool = Pool(<span class=\"hljs-number\">4</span>)\n\n<span class=\"hljs-comment\"># &#x5411;&#x8fdb;&#x7a0b;&#x6c60;&#x6dfb;&#x52a0;&#x4e8b;&#x4ef6;</span>\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">10</span>):\n    msg = <span class=\"hljs-string\">&quot;Tedu %d&quot;</span>%i\n    pool.apply_async(func=worker,args=(msg,))\n\npool.close() <span class=\"hljs-comment\"># &#x5173;&#x95ed;&#x8fdb;&#x7a0b;&#x6c60;</span>\n\npool.join() <span class=\"hljs-comment\"># &#x56de;&#x6536;&#x8fdb;&#x7a0b;&#x6c60;</span>\n\n\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"90,119"}},{"content":"<pre data-lines=\"120,163\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nprocess_1.py\nmultiprocessing &#x521b;&#x5efa;&#x8fdb;&#x7a0b;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">import</span> multiprocessing\n<span class=\"hljs-keyword\">from</span> time <span class=\"hljs-keyword\">import</span> sleep\n\na = <span class=\"hljs-number\">1</span>\n\n<span class=\"hljs-comment\"># &#x8fdb;&#x7a0b;&#x51fd;&#x6570;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">fun</span>():\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;2020&#x7b2c;&#x4e00;&#x4e2a;&#x4ee3;&#x7801;&quot;</span>)\n    sleep(<span class=\"hljs-number\">3</span>)\n    <span class=\"hljs-keyword\">global</span> a\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;a = &quot;</span>,a)\n    a = <span class=\"hljs-number\">10000</span>\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x5b50;&#x8fdb;&#x7a0b;&#x7ed3;&#x675f;&quot;</span>)\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x8fdb;&#x7a0b;&#x5bf9;&#x8c61;</span>\np = multiprocessing.Process(target = fun)\np.start()  <span class=\"hljs-comment\"># &#x542f;&#x52a8;&#x8fdb;&#x7a0b;</span>\n\n<span class=\"hljs-comment\"># &#x7236;&#x8fdb;&#x7a0b;&#x4e8b;&#x4ef6;</span>\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x7236;&#x8fdb;&#x7a0b;&#x4e5f;&#x505a;&#x70b9;&#x4e8b;&quot;</span>)\nsleep(<span class=\"hljs-number\">2</span>)\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x7236;&#x8fdb;&#x7a0b;&#x5b8c;&#x6210;&quot;</span>)\n\n\np.join() <span class=\"hljs-comment\"># &#x56de;&#x6536;&#x8fdb;&#x7a0b;</span>\n\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;a:&quot;</span>,a)\n\n<span class=\"hljs-string\">&quot;&quot;&quot;\npid = os.fork()\nif pid == 0:\n    fun()\n    os._exit(0)\nelse:\n    wait()\n&quot;&quot;&quot;</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"120,163"}},{"content":"<pre data-lines=\"164,202\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nprocess_2.py\n&#x540c;&#x65f6;&#x521b;&#x5efa;&#x591a;&#x4e2a;&#x5b50;&#x8fdb;&#x7a0b;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> multiprocessing <span class=\"hljs-keyword\">import</span> Process\n<span class=\"hljs-keyword\">from</span> time <span class=\"hljs-keyword\">import</span> sleep\n<span class=\"hljs-keyword\">import</span> os\n\n<span class=\"hljs-comment\"># &#x8fdb;&#x7a0b;&#x4e8b;&#x4ef6;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">th1</span>():\n    sleep(<span class=\"hljs-number\">3</span>)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x5403;&#x996d;&quot;</span>)\n    <span class=\"hljs-built_in\">print</span>(os.getppid(),<span class=\"hljs-string\">&quot;---&quot;</span>,os.getpid())\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">th2</span>():\n    sleep(<span class=\"hljs-number\">2</span>)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x7761;&#x89c9;&quot;</span>)\n    <span class=\"hljs-built_in\">print</span>(os.getppid(),<span class=\"hljs-string\">&quot;---&quot;</span>,os.getpid())\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">th3</span>():\n    sleep(<span class=\"hljs-number\">4</span>)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x6253;&#x8c46;&#x8c46;&quot;</span>)\n    <span class=\"hljs-built_in\">print</span>(os.getppid(),<span class=\"hljs-string\">&quot;---&quot;</span>,os.getpid())\n\njobs = []\n<span class=\"hljs-keyword\">for</span> th <span class=\"hljs-keyword\">in</span> [th1,th2,th3]:\n    p = Process(target=th)\n    jobs.append(p) <span class=\"hljs-comment\"># &#x4fdd;&#x5b58;&#x8fdb;&#x7a0b;&#x5bf9;&#x8c61;</span>\n    p.start()\n\n<span class=\"hljs-comment\"># &#x4e00;&#x8d77;&#x56de;&#x6536;</span>\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> jobs:\n    i.join()\n\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"164,202"}},{"content":"<pre data-lines=\"203,224\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nprocess_3.py\n&#x5e26;&#x53c2;&#x6570;&#x7684;&#x8fdb;&#x7a0b;&#x51fd;&#x6570;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> multiprocessing <span class=\"hljs-keyword\">import</span> Process\n<span class=\"hljs-keyword\">from</span> time <span class=\"hljs-keyword\">import</span> sleep\n\n<span class=\"hljs-comment\"># &#x5e26;&#x53c2;&#x6570;&#x7684;&#x8fdb;&#x7a0b;&#x51fd;&#x6570;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">worker</span>(<span class=\"hljs-params\">sec,name</span>):\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">3</span>):\n        sleep(sec)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;I&apos;m %s&quot;</span>%name)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;I&apos;m working&quot;</span>)\n\n<span class=\"hljs-comment\"># p = Process(target=worker,args=(2,&apos;Baron&apos;))</span>\np = Process(target=worker,args=(<span class=\"hljs-number\">2</span>,),\n            kwargs={<span class=\"hljs-string\">&apos;name&apos;</span>:<span class=\"hljs-string\">&apos;Emma&apos;</span>})\np.start()\np.join()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"203,224"}},{"content":"<pre data-lines=\"225,248\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nprocess_attr.py\n&#x8fdb;&#x7a0b;&#x5c5e;&#x6027;&#x5c55;&#x793a;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> multiprocessing <span class=\"hljs-keyword\">import</span> Process\n<span class=\"hljs-keyword\">import</span> time\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">fun</span>():\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">3</span>):\n        <span class=\"hljs-built_in\">print</span>(time.ctime())\n        time.sleep(<span class=\"hljs-number\">2</span>)\np = Process(target = fun,name = <span class=\"hljs-string\">&quot;Tedu&quot;</span>)\n\n<span class=\"hljs-comment\"># &#x7236;&#x8fdb;&#x7a0b;&#x9000;&#x51fa;&#x8be5;&#x5b50;&#x8fdb;&#x7a0b;&#x4e5f;&#x9000;&#x51fa;</span>\np.daemon = <span class=\"hljs-literal\">True</span>\n\np.start()\n\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Name:&quot;</span>,p.name)\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;PID&#xff1a;&quot;</span>,p.pid)\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;is_alive:&quot;</span>,p.is_alive())\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"225,248"}},{"content":"<pre data-lines=\"249,288\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nqueue_test.py\n&#x6d88;&#x606f;&#x961f;&#x5217;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> multiprocessing <span class=\"hljs-keyword\">import</span> Queue,Process\n<span class=\"hljs-keyword\">from</span> random <span class=\"hljs-keyword\">import</span> randint\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x6d88;&#x606f;&#x961f;&#x5217;</span>\nq = Queue(<span class=\"hljs-number\">10</span>)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">handle</span>():\n    <span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n        x = randint(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">33</span>)\n        q.put(x) <span class=\"hljs-comment\"># &#x653e;&#x5165;&#x961f;&#x5217;</span>\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">recv</span>():\n    l = []\n    <span class=\"hljs-keyword\">while</span> <span class=\"hljs-built_in\">len</span>(l) &lt; <span class=\"hljs-number\">6</span>:\n        x = q.get()\n        <span class=\"hljs-keyword\">if</span> x <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> l:\n            l.append(x)\n    l.sort()\n    l.append(randint(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">16</span>))\n    <span class=\"hljs-built_in\">print</span>(l)\n\np1 = Process(target=handle)\np2 = Process(target=recv)\n\np1.daemon = <span class=\"hljs-literal\">True</span> <span class=\"hljs-comment\"># &#x7236;&#x8fdb;&#x7a0b;&#x7ed3;&#x675f;p1&#x4e5f;&#x7ed3;&#x675f;</span>\n\np1.start()\np2.start()\n\np2.join()\n\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"249,288"}},{"content":"<img src=\"../../image/12-python-new/03-io-concur-day07/pool.png\" alt=\"img\">","children":[],"payload":{"tag":"img","lines":"289,290"}}],"payload":{"tag":"h5","lines":"57,58"}},{"content":"&#x7ec3;&#x4e60;","children":[{"content":"<pre data-lines=\"293,355\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nexercise_1.py\n&#x5927;&#x6587;&#x4ef6;&#x62c6;&#x5206;\n\n       &#x4f7f;&#x7528;Process&#x5b8c;&#x6210;&#xff0c;&#x8981;&#x6c42;&#x5c06;&#x5927;&#x6587;&#x4ef6;&#x62c6;&#x5206;&#x6210;2&#x4e2a;&#x5c0f;&#x6587;&#x4ef6;&#xff0c;\n       &#x6309;&#x7167;&#x5b57;&#x8282;&#x5927;&#x5c0f;&#x53bb;&#x5206;&#x6210;&#x4e24;&#x4e2a;&#x3002;&#x8981;&#x6c42;&#x4e0a;&#x4e0b;&#x4e24;&#x4e2a;&#x90e8;&#x5206;&#x540c;&#x65f6;&#x64cd;&#x4f5c;&#x3002;\n\n       &#x63d0;&#x793a;&#xff1a; &#x4e24;&#x4e2a;&#x5b50;&#x8fdb;&#x7a0b;&#x5206;&#x522b;&#x53bb;&#x505a;\n             &#x6ce8;&#x610f;&#x8bfb;&#x5199;&#x504f;&#x79fb;&#x91cf;&#x63a7;&#x5236;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">from</span> multiprocessing <span class=\"hljs-keyword\">import</span> Process\n<span class=\"hljs-keyword\">import</span> os\n\nfilename = <span class=\"hljs-string\">&quot;timg.jpeg&quot;</span>\nsize = os.path.getsize(filename)\n\n<span class=\"hljs-string\">&quot;&quot;&quot;\n&#x5bf9;&#x4e8e;IO&#x64cd;&#x4f5c;&#x6765;&#x8bf4;&#xff0c;&#x5982;&#x679c;&#x5728;&#x7236;&#x8fdb;&#x7a0b;&#x521b;&#x5efa;IO&#xff0c;&#x8fdb;&#x7a0b;&#x4ece;&#x7236;&#x8fdb;&#x7a0b;&#x83b7;&#x53d6;&#x4e86;IO.\n&#x90a3;&#x4e48;&#x8fd9;&#x4e9b;&#x8fdb;&#x7a0b;&#x5bf9;&#x8be5;IO&#x7684;&#x64cd;&#x4f5c;&#x53ef;&#x80fd;&#x76f8;&#x4e92;&#x6709;&#x5f71;&#x54cd;&#x3002;\n&#x5982;&#x679c;&#x5728;&#x5404;&#x81ea;&#x8fdb;&#x7a0b;&#x4e2d;&#x5206;&#x522b;&#x6253;&#x5f00;&#x7684;IO&#x76f8;&#x4e92;&#x6ca1;&#x6709;&#x4efb;&#x4f55;&#x5f71;&#x54cd; \n&quot;&quot;&quot;</span>\n<span class=\"hljs-comment\"># fr = open(filename,&apos;rb&apos;)</span>\n\n<span class=\"hljs-comment\"># &#x590d;&#x5236;&#x4e0a;&#x534a;&#x90e8;&#x5206;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">top</span>():\n    fr = <span class=\"hljs-built_in\">open</span>(filename,<span class=\"hljs-string\">&apos;rb&apos;</span>)\n    fw = <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&apos;top.jpg&apos;</span>,<span class=\"hljs-string\">&apos;wb&apos;</span>)\n    n = size // <span class=\"hljs-number\">2</span>\n    <span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n        <span class=\"hljs-keyword\">if</span> n &lt;= <span class=\"hljs-number\">1024</span>:\n            data = fr.read(n)\n            fw.write(data)\n            <span class=\"hljs-keyword\">break</span>\n        data = fr.read(<span class=\"hljs-number\">1024</span>)\n        fw.write(data)\n        n -= <span class=\"hljs-number\">1024</span>\n    fr.close()\n    fw.close()\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">bot</span>():\n    fr = <span class=\"hljs-built_in\">open</span>(filename, <span class=\"hljs-string\">&apos;rb&apos;</span>)\n    fw = <span class=\"hljs-built_in\">open</span>(<span class=\"hljs-string\">&apos;bot.jpg&apos;</span>, <span class=\"hljs-string\">&apos;wb&apos;</span>)\n    fr.seek(size // <span class=\"hljs-number\">2</span>)\n    <span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n        data = fr.read(<span class=\"hljs-number\">1024</span>)\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> data:\n            <span class=\"hljs-keyword\">break</span>\n        fw.write(data)\n    fr.close()\n    fw.close()\n\n\np1 = Process(target=top)\np2 = Process(target=bot)\np1.start()\np2.start()\n\np1.join()\np2.join()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"293,355"}},{"content":"<pre data-lines=\"356,430\"><code class=\"language-python\"><span class=\"hljs-comment\"># exercise_2.py</span>\n<span class=\"hljs-comment\"># &#x6c42;100000&#x4ee5;&#x5185;&#x6240;&#x6709;&#x8d28;&#x6570;&#x4e4b;&#x548c;</span>\n\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">from</span> multiprocessing <span class=\"hljs-keyword\">import</span> Process\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">timeit</span>(<span class=\"hljs-params\">f</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">wrapper</span>(<span class=\"hljs-params\">*args,**kwargs</span>):\n        s_t = time.time()\n        res = f(*args,**kwargs)\n        e_t = time.time()\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x51fd;&#x6570;&#x6267;&#x884c;&#x65f6;&#x95f4;&#xff1a;%.6f&quot;</span>%(e_t-s_t))\n        <span class=\"hljs-keyword\">return</span> res\n    <span class=\"hljs-keyword\">return</span> wrapper\n\n<span class=\"hljs-comment\"># &#x5224;&#x65ad;&#x4e00;&#x4e2a;&#x6570;&#x662f;&#x4e0d;&#x662f;&#x8d28;&#x6570;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">is_prime</span>(<span class=\"hljs-params\">n</span>):\n    <span class=\"hljs-keyword\">if</span> n &lt;= <span class=\"hljs-number\">1</span>:\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span>\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">2</span>,n):\n        <span class=\"hljs-keyword\">if</span> n % i == <span class=\"hljs-number\">0</span>:\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">False</span>\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">True</span>\n\n<span class=\"hljs-comment\"># &#x6c42;&#x548c;</span>\n<span class=\"hljs-meta\">@timeit</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">prime</span>():\n    l = []\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">100001</span>):\n        <span class=\"hljs-keyword\">if</span> is_prime(i):\n            l.append(i)\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">sum</span>(l)\n\n<span class=\"hljs-comment\"># prime() # &#x51fd;&#x6570;&#x6267;&#x884c;&#x65f6;&#x95f4;&#xff1a;26.753193</span>\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Prime</span>(<span class=\"hljs-title class_ inherited__\">Process</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self,pr,begin,end</span>):\n        <span class=\"hljs-built_in\">super</span>().__init__()\n        <span class=\"hljs-variable language_\">self</span>.pr = pr\n        <span class=\"hljs-variable language_\">self</span>.begin = begin\n        <span class=\"hljs-variable language_\">self</span>.end = end\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">run</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-variable language_\">self</span>.begin,<span class=\"hljs-variable language_\">self</span>.end):\n            <span class=\"hljs-keyword\">if</span> is_prime(i):\n                <span class=\"hljs-variable language_\">self</span>.pr.append(i)\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-built_in\">sum</span>(<span class=\"hljs-variable language_\">self</span>.pr))\n\n<span class=\"hljs-meta\">@timeit</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">process_4</span>():\n    prime = []\n    jobs = []\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">100001</span>,<span class=\"hljs-number\">25000</span>):\n        p = Prime(prime,i,i+<span class=\"hljs-number\">25000</span>)\n        jobs.append(p)\n        p.start()\n    [i.join() <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> jobs]\n\n<span class=\"hljs-comment\"># process_4() #&#x51fd;&#x6570;&#x6267;&#x884c;&#x65f6;&#x95f4;&#xff1a;15.282414</span>\n\n<span class=\"hljs-meta\">@timeit</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">process_10</span>():\n    prime = []\n    jobs = []\n    <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">100001</span>,<span class=\"hljs-number\">10000</span>):\n        p = Prime(prime,i,i+<span class=\"hljs-number\">10000</span>)\n        jobs.append(p)\n        p.start()\n    [i.join() <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> jobs]\n\nprocess_10() <span class=\"hljs-comment\"># &#x51fd;&#x6570;&#x6267;&#x884c;&#x65f6;&#x95f4;&#xff1a;14.053634</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"356,430"}},{"content":"<pre data-lines=\"431,480\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;\nexercise_3.py\n&#x4f7f;&#x7528;&#x8fdb;&#x7a0b;&#x6c60;&#x62f7;&#x8d1d;&#x4e00;&#x4e2a;&#x76ee;&#x5f55;&#xff08;&#x5305;&#x542b;&#x76ee;&#x5f55;&#x4e2d;&#x6240;&#x6709;&#x5185;&#x5bb9;&#xff09;&#xff0c;&#x76ee;&#x5f55;&#x4e2d;\n&#x5305;&#x542b;&#x82e5;&#x5e72;&#x4e2a;&#x666e;&#x901a;&#x6587;&#x4ef6;&#x3002;\n\n       *  &#x76ee;&#x5f55;&#x4e2d;&#x7684;&#x6bcf;&#x4e2a;&#x6587;&#x4ef6;&#x62f7;&#x8d1d;&#x8fc7;&#x7a0b;&#x90fd;&#x9700;&#x8981;&#x4e00;&#x4e2a;&#x5355;&#x72ec;&#x7684;&#x8fdb;&#x7a0b;&#x53bb;\n       &#x5b9e;&#x73b0;\n\n       *  &#x62f7;&#x8d1d;&#x8fc7;&#x7a0b;&#x4e2d;&#x5b9e;&#x65f6;&#x663e;&#x793a;&#x62f7;&#x8d1d;&#x7684;&#x767e;&#x5206;&#x6bd4;\n\n\n       os.mkdir() &#x521b;&#x5efa;&#x76ee;&#x5f55;\n&quot;&quot;&quot;</span>\n\n<span class=\"hljs-keyword\">from</span> multiprocessing <span class=\"hljs-keyword\">import</span> Pool\n<span class=\"hljs-keyword\">import</span> os\n\nbase_path = <span class=\"hljs-string\">&quot;/home/tarena/&quot;</span> <span class=\"hljs-comment\"># &#x8981;&#x62f7;&#x8d1d;&#x7684;&#x76ee;&#x5f55;&#x5728;&#x8fd9;&#x4e2a;&#x76ee;&#x5f55;&#x4e0b;</span>\n<span class=\"hljs-built_in\">dir</span> = <span class=\"hljs-built_in\">input</span>(<span class=\"hljs-string\">&quot;&#x8981;&#x62f7;&#x8d1d;&#x7684;&#x76ee;&#x5f55;&#xff1a;&quot;</span>)\nold_folder = base_path + <span class=\"hljs-built_in\">dir</span>\n\n<span class=\"hljs-comment\"># &#x65b0;&#x7684;&#x76ee;&#x5f55;</span>\nnew_folder = old_folder+<span class=\"hljs-string\">&apos;-&#x5907;&#x4efd;&apos;</span>\nos.mkdir(new_folder)\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">copy_file</span>(<span class=\"hljs-params\">file</span>):\n    fr = <span class=\"hljs-built_in\">open</span>(old_folder+<span class=\"hljs-string\">&apos;/&apos;</span>+file,<span class=\"hljs-string\">&apos;rb&apos;</span>)\n    fw = <span class=\"hljs-built_in\">open</span>(new_folder+<span class=\"hljs-string\">&apos;/&apos;</span>+file,<span class=\"hljs-string\">&apos;wb&apos;</span>)\n    <span class=\"hljs-keyword\">while</span> <span class=\"hljs-literal\">True</span>:\n        data = fr.read(<span class=\"hljs-number\">1024</span>)\n        <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> data:\n            <span class=\"hljs-keyword\">break</span>\n        fw.write(data)\n    fr.close()\n    fw.close()\n\n\n<span class=\"hljs-comment\"># &#x4e00;&#x5171;&#x6709;&#x54ea;&#x4e9b;&#x6587;&#x4ef6;</span>\nall_files = os.listdir(old_folder)\n<span class=\"hljs-comment\"># &#x4f7f;&#x7528;&#x8fdb;&#x7a0b;&#x6c60;&#x62f7;&#x8d1d;</span>\npool = Pool()\n<span class=\"hljs-keyword\">for</span> file <span class=\"hljs-keyword\">in</span> all_files:\n    <span class=\"hljs-comment\"># &#x6bcf;copy&#x4e00;&#x4e2a;&#x6587;&#x4ef6;&#x5c31;&#x662f;&#x4e00;&#x4e2a;&#x4e8b;&#x4ef6;</span>\n    pool.apply_async(copy_file,args=(file,))\npool.close()\npool.join()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"431,480"}}],"payload":{"tag":"h5","lines":"291,292"}}],"payload":{"tag":"h3","lines":"2,3"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
