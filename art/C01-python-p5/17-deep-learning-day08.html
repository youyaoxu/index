<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"Deep-Learning","children":[{"content":"&#x793a;&#x4f8b;","children":[{"content":"<pre data-lines=\"6,257\"><code class=\"language-python\"><span class=\"hljs-comment\"># 01_emotion_analyses.py</span>\n<span class=\"hljs-comment\"># &#x60c5;&#x611f;&#x5206;&#x6790;&#x793a;&#x4f8b;</span>\n<span class=\"hljs-string\">&apos;&apos;&apos; &#x6570;&#x636e;&#x96c6;&#x4ecb;&#x7ecd;\n&#x4e2d;&#x6587;&#x9152;&#x5e97;&#x8bc4;&#x8bba;&#xff0c;7766&#x7b14;&#x6570;&#x636e;&#xff0c;&#x5206;&#x4e3a;&#x6b63;&#x9762;&#x3001;&#x8d1f;&#x9762;&#x8bc4;&#x4ef7;\n&apos;&apos;&apos;</span>\n<span class=\"hljs-keyword\">import</span> paddle\n<span class=\"hljs-keyword\">import</span> paddle.dataset.imdb <span class=\"hljs-keyword\">as</span> imdb\n<span class=\"hljs-keyword\">import</span> paddle.fluid <span class=\"hljs-keyword\">as</span> fluid\n<span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np\n<span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">import</span> random\n<span class=\"hljs-keyword\">from</span> multiprocessing <span class=\"hljs-keyword\">import</span> cpu_count\n\n<span class=\"hljs-comment\"># &#x6570;&#x636e;&#x9884;&#x5904;&#x7406;&#xff0c;&#x5c06;&#x4e2d;&#x6587;&#x6587;&#x5b57;&#x89e3;&#x6790;&#x51fa;&#x6765;&#xff0c;&#x5e76;&#x8fdb;&#x884c;&#x7f16;&#x7801;&#x8f6c;&#x6362;&#x4e3a;&#x6570;&#x5b57;&#xff0c;&#x6bcf;&#x4e00;&#x884c;&#x6587;&#x5b57;&#x5b58;&#x5165;&#x6570;&#x7ec4;</span>\nmydict = {}  <span class=\"hljs-comment\"># &#x5b58;&#x653e;&#x51fa;&#x73b0;&#x7684;&#x5b57;&#x53ca;&#x7f16;&#x7801;&#xff0c;&#x683c;&#x5f0f;&#xff1a; &#x597d;,1</span>\ncode = <span class=\"hljs-number\">1</span>\ndata_file = <span class=\"hljs-string\">&quot;data/hotel_discuss2.csv&quot;</span>  <span class=\"hljs-comment\"># &#x539f;&#x59cb;&#x6837;&#x672c;&#x8def;&#x5f84;</span>\ndict_file = <span class=\"hljs-string\">&quot;data/hotel_dict.txt&quot;</span>  <span class=\"hljs-comment\"># &#x5b57;&#x5178;&#x6587;&#x4ef6;&#x8def;&#x5f84;</span>\nencoding_file = <span class=\"hljs-string\">&quot;data/hotel_encoding.txt&quot;</span>  <span class=\"hljs-comment\"># &#x7f16;&#x7801;&#x540e;&#x7684;&#x6837;&#x672c;&#x6587;&#x4ef6;&#x8def;&#x5f84;</span>\npuncts = <span class=\"hljs-string\">&quot; \\n&quot;</span>  <span class=\"hljs-comment\"># &#x8981;&#x5254;&#x9664;&#x7684;&#x6807;&#x70b9;&#x7b26;&#x53f7;&#x5217;&#x8868;</span>\n\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(data_file, <span class=\"hljs-string\">&quot;r&quot;</span>, encoding=<span class=\"hljs-string\">&quot;utf-8-sig&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n    <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> f.readlines():\n        <span class=\"hljs-comment\"># print(line)</span>\n        trim_line = line.strip()\n        <span class=\"hljs-keyword\">for</span> ch <span class=\"hljs-keyword\">in</span> trim_line:\n            <span class=\"hljs-keyword\">if</span> ch <span class=\"hljs-keyword\">in</span> puncts:  <span class=\"hljs-comment\"># &#x7b26;&#x53f7;&#x4e0d;&#x53c2;&#x4e0e;&#x7f16;&#x7801;</span>\n                <span class=\"hljs-keyword\">continue</span>\n\n            <span class=\"hljs-keyword\">if</span> ch <span class=\"hljs-keyword\">in</span> mydict:  <span class=\"hljs-comment\"># &#x5df2;&#x7ecf;&#x5728;&#x7f16;&#x7801;&#x5b57;&#x5178;&#x4e2d;</span>\n                <span class=\"hljs-keyword\">continue</span>\n            <span class=\"hljs-keyword\">elif</span> <span class=\"hljs-built_in\">len</span>(ch) &lt;= <span class=\"hljs-number\">0</span>:\n                <span class=\"hljs-keyword\">continue</span>\n            <span class=\"hljs-keyword\">else</span>:  <span class=\"hljs-comment\"># &#x5f53;&#x524d;&#x6587;&#x5b57;&#x6ca1;&#x5728;&#x5b57;&#x5178;&#x4e2d;</span>\n                mydict[ch] = code\n                code += <span class=\"hljs-number\">1</span>\n    code += <span class=\"hljs-number\">1</span>\n    mydict[<span class=\"hljs-string\">&quot;&lt;unk&gt;&quot;</span>] = code  <span class=\"hljs-comment\"># &#x672a;&#x77e5;&#x5b57;&#x7b26;</span>\n\n<span class=\"hljs-comment\"># &#x5faa;&#x73af;&#x7ed3;&#x675f;&#x540e;&#xff0c;&#x5c06;&#x5b57;&#x5178;&#x5b58;&#x5165;&#x5b57;&#x5178;&#x6587;&#x4ef6;</span>\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(dict_file, <span class=\"hljs-string\">&quot;w&quot;</span>, encoding=<span class=\"hljs-string\">&quot;utf-8-sig&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n    f.write(<span class=\"hljs-built_in\">str</span>(mydict))\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x6570;&#x636e;&#x5b57;&#x5178;&#x4fdd;&#x5b58;&#x5b8c;&#x6210;&#xff01;&quot;</span>)\n\n\n<span class=\"hljs-comment\"># &#x5c06;&#x5b57;&#x5178;&#x6587;&#x4ef6;&#x4e2d;&#x7684;&#x6570;&#x636e;&#x52a0;&#x8f7d;&#x5230;mydict&#x5b57;&#x5178;&#x4e2d;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">load_dict</span>():\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(dict_file, <span class=\"hljs-string\">&quot;r&quot;</span>, encoding=<span class=\"hljs-string\">&quot;utf-8-sig&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        lines = f.readlines()\n        new_dict = <span class=\"hljs-built_in\">eval</span>(lines[<span class=\"hljs-number\">0</span>])\n    <span class=\"hljs-keyword\">return</span> new_dict\n\n\n<span class=\"hljs-comment\"># &#x5bf9;&#x8bc4;&#x8bba;&#x6570;&#x636e;&#x8fdb;&#x884c;&#x7f16;&#x7801;</span>\nnew_dict = load_dict()  <span class=\"hljs-comment\"># &#x8c03;&#x7528;&#x51fd;&#x6570;&#x52a0;&#x8f7d;</span>\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(data_file, <span class=\"hljs-string\">&quot;r&quot;</span>, encoding=<span class=\"hljs-string\">&quot;utf-8-sig&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(encoding_file, <span class=\"hljs-string\">&quot;w&quot;</span>, encoding=<span class=\"hljs-string\">&quot;utf-8-sig&quot;</span>) <span class=\"hljs-keyword\">as</span> fw:\n        <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> f.readlines():\n            label = line[<span class=\"hljs-number\">0</span>]  <span class=\"hljs-comment\"># &#x6807;&#x7b7e;</span>\n            remark = line[<span class=\"hljs-number\">1</span>:-<span class=\"hljs-number\">1</span>]  <span class=\"hljs-comment\"># &#x8bc4;&#x8bba;</span>\n\n            <span class=\"hljs-keyword\">for</span> ch <span class=\"hljs-keyword\">in</span> remark:\n                <span class=\"hljs-keyword\">if</span> ch <span class=\"hljs-keyword\">in</span> puncts:  <span class=\"hljs-comment\"># &#x7b26;&#x53f7;&#x4e0d;&#x53c2;&#x4e0e;&#x7f16;&#x7801;</span>\n                    <span class=\"hljs-keyword\">continue</span>\n                <span class=\"hljs-keyword\">else</span>:\n                    fw.write(<span class=\"hljs-built_in\">str</span>(mydict[ch]))\n                    fw.write(<span class=\"hljs-string\">&quot;,&quot;</span>)\n            fw.write(<span class=\"hljs-string\">&quot;\\t&quot;</span> + <span class=\"hljs-built_in\">str</span>(label) + <span class=\"hljs-string\">&quot;\\n&quot;</span>)  <span class=\"hljs-comment\"># &#x5199;&#x5165;tab&#x5206;&#x9694;&#x7b26;&#x3001;&#x6807;&#x7b7e;&#x3001;&#x6362;&#x884c;&#x7b26;</span>\n\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x6570;&#x636e;&#x9884;&#x5904;&#x7406;&#x5b8c;&#x6210;&quot;</span>)\n\n<span class=\"hljs-comment\">################################# &#x6a21;&#x578b;&#x642d;&#x5efa;/&#x8bad;&#x7ec3; ######################################</span>\n<span class=\"hljs-comment\"># &#x83b7;&#x53d6;&#x5b57;&#x5178;&#x7684;&#x957f;&#x5ea6;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_dict_len</span>(<span class=\"hljs-params\">dict_path</span>):\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(dict_path, <span class=\"hljs-string\">&apos;r&apos;</span>, encoding=<span class=\"hljs-string\">&apos;utf-8-sig&apos;</span>) <span class=\"hljs-keyword\">as</span> f:\n        lines = f.readlines()\n        new_dict = <span class=\"hljs-built_in\">eval</span>(lines[<span class=\"hljs-number\">0</span>])\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">len</span>(new_dict.keys())\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x6570;&#x636e;&#x8bfb;&#x53d6;&#x5668;train_reader&#x548c;test_reader</span>\n<span class=\"hljs-comment\"># &#x8fd4;&#x56de;&#x8bc4;&#x8bba;&#x5217;&#x8868;&#x548c;&#x6807;&#x7b7e;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">data_mapper</span>(<span class=\"hljs-params\">sample</span>):\n    dt, lbl = sample\n    val = [<span class=\"hljs-built_in\">int</span>(word) <span class=\"hljs-keyword\">for</span> word <span class=\"hljs-keyword\">in</span> dt.split(<span class=\"hljs-string\">&quot;,&quot;</span>) <span class=\"hljs-keyword\">if</span> word.isdigit()]\n    <span class=\"hljs-keyword\">return</span> val, <span class=\"hljs-built_in\">int</span>(lbl)\n\n<span class=\"hljs-comment\"># &#x968f;&#x673a;&#x4ece;&#x8bad;&#x7ec3;&#x6570;&#x636e;&#x96c6;&#x6587;&#x4ef6;&#x4e2d;&#x53d6;&#x51fa;&#x4e00;&#x884c;&#x6570;&#x636e;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">train_reader</span>(<span class=\"hljs-params\">train_list_path</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">reader</span>():\n        <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(train_list_path, <span class=\"hljs-string\">&quot;r&quot;</span>, encoding=<span class=\"hljs-string\">&apos;utf-8-sig&apos;</span>) <span class=\"hljs-keyword\">as</span> f:\n            lines = f.readlines()\n            np.random.shuffle(lines)  <span class=\"hljs-comment\"># &#x6253;&#x4e71;&#x6570;&#x636e;</span>\n\n            <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> lines:\n                data, label = line.split(<span class=\"hljs-string\">&quot;\\t&quot;</span>)\n                <span class=\"hljs-keyword\">yield</span> data, label\n\n    <span class=\"hljs-comment\"># &#x8fd4;&#x56de;xmap_readers, &#x80fd;&#x591f;&#x4f7f;&#x7528;&#x591a;&#x7ebf;&#x7a0b;&#x65b9;&#x5f0f;&#x8bfb;&#x53d6;&#x6570;&#x636e;</span>\n    <span class=\"hljs-keyword\">return</span> paddle.reader.xmap_readers(data_mapper,  <span class=\"hljs-comment\"># &#x6620;&#x5c04;&#x51fd;&#x6570;</span>\n                                      reader,  <span class=\"hljs-comment\"># &#x8bfb;&#x53d6;&#x6570;&#x636e;&#x5185;&#x5bb9;</span>\n                                      cpu_count(),  <span class=\"hljs-comment\"># &#x7ebf;&#x7a0b;&#x6570;&#x91cf;</span>\n                                      <span class=\"hljs-number\">1024</span>)  <span class=\"hljs-comment\"># &#x8bfb;&#x53d6;&#x6570;&#x636e;&#x961f;&#x5217;&#x5927;&#x5c0f;</span>\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;LSTM&#x7f51;&#x7edc;&#x6a21;&#x578b;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">lstm_net</span>(<span class=\"hljs-params\">ipt, input_dim</span>):\n    ipt = fluid.layers.reshape(ipt, [-<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>], <span class=\"hljs-comment\"># &#x539f;&#x59cb;&#x6570;&#x636e;&#xff0c;&#x5f62;&#x72b6;</span>\n                               inplace=<span class=\"hljs-literal\">True</span>) <span class=\"hljs-comment\"># &#x662f;&#x5426;&#x66ff;&#x6362;&#xff0c;True&#x8868;&#x793a;&#x8f93;&#x5165;&#x548c;&#x8f93;&#x51fa;&#x662f;&#x540c;&#x4e00;&#x4e2a;&#x5bf9;&#x8c61;</span>\n    <span class=\"hljs-comment\"># &#x8bcd;&#x5d4c;&#x5165;&#x5c42;</span>\n    emb = fluid.layers.embedding(<span class=\"hljs-built_in\">input</span>=ipt,\n                                 size=[input_dim, <span class=\"hljs-number\">128</span>],\n                                 is_sparse=<span class=\"hljs-literal\">True</span>) <span class=\"hljs-comment\"># &#x662f;&#x5426;&#x4f7f;&#x7528;&#x7a00;&#x758f;&#x683c;&#x5f0f;</span>\n    <span class=\"hljs-comment\"># &#x7b2c;&#x4e00;&#x4e2a;&#x5168;&#x8fde;&#x63a5;&#x5c42;</span>\n    fc1 = fluid.layers.fc(<span class=\"hljs-built_in\">input</span>=emb, size=<span class=\"hljs-number\">128</span>)\n\n    <span class=\"hljs-comment\"># &#x7b2c;&#x4e00;&#x5206;&#x652f;&#xff1a;LSTM(&#x5229;&#x7528;&#x5faa;&#x73af;&#x795e;&#x7ecf;&#x7f51;&#x7edc;&#x63d0;&#x53d6;&#x5e8f;&#x5217;&#x7279;&#x5f81;)</span>\n    lstm1, _ = fluid.layers.dynamic_lstm(<span class=\"hljs-built_in\">input</span>=fc1, size=<span class=\"hljs-number\">128</span>) <span class=\"hljs-comment\"># LSTM</span>\n    lstm2 = fluid.layers.sequence_pool(<span class=\"hljs-built_in\">input</span>=lstm1, pool_type=<span class=\"hljs-string\">&quot;max&quot;</span>) <span class=\"hljs-comment\"># &#x5e8f;&#x5217;&#x6c60;&#x5316;&#x5c42;</span>\n\n    <span class=\"hljs-comment\"># &#x7b2c;&#x4e8c;&#x5206;&#x652f;&#xff1a;&#x5e8f;&#x5217;&#x6c60;&#x5316;</span>\n    conv = fluid.layers.sequence_pool(<span class=\"hljs-built_in\">input</span>=fc1, pool_type=<span class=\"hljs-string\">&quot;max&quot;</span>)\n\n    <span class=\"hljs-comment\"># &#x8f93;&#x51fa;&#x5c42;</span>\n    out = fluid.layers.fc(<span class=\"hljs-built_in\">input</span>=[conv, lstm2], size=<span class=\"hljs-number\">2</span>, act=<span class=\"hljs-string\">&quot;softmax&quot;</span>)\n\n    <span class=\"hljs-keyword\">return</span> out\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;&#x8f93;&#x5165;&#x6570;&#x636e;&#xff0c;lod_level&#x4e0d;&#x4e3a;0&#x6307;&#x5b9a;&#x8f93;&#x5165;&#x6570;&#x636e;&#x4e3a;&#x5e8f;&#x5217;&#x6570;&#x636e;</span>\ndict_len = get_dict_len(dict_file)  <span class=\"hljs-comment\"># &#x83b7;&#x53d6;&#x6570;&#x636e;&#x5b57;&#x5178;&#x957f;&#x5ea6;</span>\nrmk = fluid.layers.data(name=<span class=\"hljs-string\">&quot;rmk&quot;</span>, shape=[<span class=\"hljs-number\">1</span>], dtype=<span class=\"hljs-string\">&quot;int64&quot;</span>, lod_level=<span class=\"hljs-number\">1</span>)\nlabel = fluid.layers.data(name=<span class=\"hljs-string\">&quot;label&quot;</span>, shape=[<span class=\"hljs-number\">1</span>], dtype=<span class=\"hljs-string\">&quot;int64&quot;</span>)\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;&#x957f;&#x77ed;&#x671f;&#x8bb0;&#x5fc6;&#x7f51;&#x7edc;</span>\nmodel = lstm_net(rmk, dict_len)\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;&#x635f;&#x5931;&#x51fd;&#x6570;&#xff0c;&#x60c5;&#x7eea;&#x5224;&#x65ad;&#x5b9e;&#x9645;&#x662f;&#x4e00;&#x4e2a;&#x5206;&#x7c7b;&#x4efb;&#x52a1;&#xff0c;&#x4f7f;&#x7528;&#x4ea4;&#x53c9;&#x71b5;&#x4f5c;&#x4e3a;&#x635f;&#x5931;&#x51fd;&#x6570;</span>\ncost = fluid.layers.cross_entropy(<span class=\"hljs-built_in\">input</span>=model, label=label)\navg_cost = fluid.layers.mean(cost)  <span class=\"hljs-comment\"># &#x6c42;&#x635f;&#x5931;&#x503c;&#x5e73;&#x5747;&#x6570;</span>\n<span class=\"hljs-comment\"># layers.accuracy&#x63a5;&#x53e3;&#xff0c;&#x7528;&#x6765;&#x8bc4;&#x4f30;&#x9884;&#x6d4b;&#x51c6;&#x786e;&#x7387;</span>\nacc = fluid.layers.accuracy(<span class=\"hljs-built_in\">input</span>=model, label=label)\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;&#x4f18;&#x5316;&#x65b9;&#x6cd5;</span>\n<span class=\"hljs-comment\"># Adagrad(&#x81ea;&#x9002;&#x5e94;&#x5b66;&#x4e60;&#x7387;&#xff0c;&#x524d;&#x671f;&#x653e;&#x5927;&#x68af;&#x5ea6;&#x8c03;&#x8282;&#xff0c;&#x540e;&#x671f;&#x7f29;&#x5c0f;&#x68af;&#x5ea6;&#x8c03;&#x8282;)</span>\noptimizer = fluid.optimizer.AdagradOptimizer(learning_rate=<span class=\"hljs-number\">0.001</span>)\nopt = optimizer.minimize(avg_cost)\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;&#x7f51;&#x7edc;</span>\n<span class=\"hljs-comment\"># place = fluid.CPUPlace()</span>\nplace = fluid.CUDAPlace(<span class=\"hljs-number\">0</span>)\nexe = fluid.Executor(place)\nexe.run(fluid.default_startup_program())  <span class=\"hljs-comment\"># &#x53c2;&#x6570;&#x521d;&#x59cb;&#x5316;</span>\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;reader</span>\nreader = train_reader(encoding_file)\nbatch_train_reader = paddle.batch(reader, batch_size=<span class=\"hljs-number\">128</span>)\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;&#x8f93;&#x5165;&#x6570;&#x636e;&#x7684;&#x7ef4;&#x5ea6;&#xff0c;&#x6570;&#x636e;&#x7684;&#x987a;&#x5e8f;&#x662f;&#x4e00;&#x6761;&#x53e5;&#x5b50;&#x6570;&#x636e;&#x5bf9;&#x5e94;&#x4e00;&#x4e2a;&#x6807;&#x7b7e;</span>\nfeeder = fluid.DataFeeder(place=place, feed_list=[rmk, label])\n\n<span class=\"hljs-keyword\">for</span> pass_id <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">40</span>):\n    <span class=\"hljs-keyword\">for</span> batch_id, data <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(batch_train_reader()):\n        train_cost, train_acc = exe.run(program=fluid.default_main_program(),\n                                        feed=feeder.feed(data),\n                                        fetch_list=[avg_cost, acc])\n\n        <span class=\"hljs-keyword\">if</span> batch_id % <span class=\"hljs-number\">20</span> == <span class=\"hljs-number\">0</span>:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;pass_id: %d, batch_id: %d, cost: %0.5f, acc:%.5f&quot;</span> %\n                  (pass_id, batch_id, train_cost[<span class=\"hljs-number\">0</span>], train_acc))\n\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x6a21;&#x578b;&#x8bad;&#x7ec3;&#x5b8c;&#x6210;......&quot;</span>)\n\n<span class=\"hljs-comment\"># &#x4fdd;&#x5b58;&#x6a21;&#x578b;</span>\nmodel_save_dir = <span class=\"hljs-string\">&quot;model/chn_emotion_analyses.model&quot;</span>\n<span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> os.path.exists(model_save_dir):\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;create model path&quot;</span>)\n    os.makedirs(model_save_dir)\n\nfluid.io.save_inference_model(model_save_dir,  <span class=\"hljs-comment\"># &#x4fdd;&#x5b58;&#x8def;&#x5f84;</span>\n                              feeded_var_names=[rmk.name],\n                              target_vars=[model],\n                              executor=exe)  <span class=\"hljs-comment\"># Executor</span>\n\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x6a21;&#x578b;&#x4fdd;&#x5b58;&#x5b8c;&#x6210;, &#x4fdd;&#x5b58;&#x8def;&#x5f84;: &quot;</span>, model_save_dir)\n\n<span class=\"hljs-comment\">###################################################################</span>\n\n<span class=\"hljs-comment\"># import paddle</span>\n<span class=\"hljs-comment\"># import paddle.fluid as fluid</span>\n<span class=\"hljs-comment\"># import numpy as np</span>\n<span class=\"hljs-comment\"># import os</span>\n<span class=\"hljs-comment\"># import random</span>\n<span class=\"hljs-comment\"># from multiprocessing import cpu_count</span>\n<span class=\"hljs-comment\">#</span>\n<span class=\"hljs-comment\"># data_file = &quot;data/hotel_discuss2.csv&quot;</span>\n<span class=\"hljs-comment\"># dict_file = &quot;data/hotel_dict.txt&quot;</span>\n<span class=\"hljs-comment\"># encoding_file = &quot;data/hotel_encoding.txt&quot;</span>\n<span class=\"hljs-comment\"># model_save_dir = &quot;model/chn_emotion_analyses.model&quot;</span>\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">load_dict</span>():\n    <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(dict_file, <span class=\"hljs-string\">&quot;r&quot;</span>, encoding=<span class=\"hljs-string\">&quot;utf-8-sig&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n        lines = f.readlines()\n        new_dict = <span class=\"hljs-built_in\">eval</span>(lines[<span class=\"hljs-number\">0</span>])\n        <span class=\"hljs-keyword\">return</span> new_dict\n\n<span class=\"hljs-comment\"># &#x6839;&#x636e;&#x5b57;&#x5178;&#x5bf9;&#x5b57;&#x7b26;&#x4e32;&#x8fdb;&#x884c;&#x7f16;&#x7801;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">encode_by_dict</span>(<span class=\"hljs-params\">remark, dict_encoded</span>):\n    remark = remark.strip()\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(remark) &lt;= <span class=\"hljs-number\">0</span>:\n        <span class=\"hljs-keyword\">return</span> []\n\n    ret = []\n    <span class=\"hljs-keyword\">for</span> ch <span class=\"hljs-keyword\">in</span> remark:\n        <span class=\"hljs-keyword\">if</span> ch <span class=\"hljs-keyword\">in</span> dict_encoded:\n            ret.append(dict_encoded[ch])\n        <span class=\"hljs-keyword\">else</span>:\n            ret.append(dict_encoded[<span class=\"hljs-string\">&quot;&lt;unk&gt;&quot;</span>])\n\n    <span class=\"hljs-keyword\">return</span> ret\n\n\n<span class=\"hljs-comment\"># &#x7f16;&#x7801;,&#x9884;&#x6d4b;</span>\nlods = []\nnew_dict = load_dict()\nlods.append(encode_by_dict(<span class=\"hljs-string\">&quot;&#x603b;&#x4f53;&#x6765;&#x8bf4;&#x623f;&#x95f4;&#x975e;&#x5e38;&#x5e72;&#x51c0;,&#x536b;&#x6d74;&#x8bbe;&#x65bd;&#x4e5f;&#x76f8;&#x5f53;&#x4e0d;&#x9519;,&#x4ea4;&#x901a;&#x4e5f;&#x6bd4;&#x8f83;&#x4fbf;&#x5229;&quot;</span>, new_dict))\nlods.append(encode_by_dict(<span class=\"hljs-string\">&quot;&#x9152;&#x5e97;&#x4ea4;&#x901a;&#x65b9;&#x4fbf;&#xff0c;&#x73af;&#x5883;&#x4e5f;&#x4e0d;&#x9519;&#xff0c;&#x6b63;&#x597d;&#x662f;&#x6211;&#x4eec;&#x529e;&#x4e8b;&#x5730;&#x70b9;&#x7684;&#x65c1;&#x8fb9;&#xff0c;&#x611f;&#x89c9;&#x6027;&#x4ef7;&#x6bd4;&#x8fd8;&#x53ef;&#x4ee5;&quot;</span>, new_dict))\nlods.append(encode_by_dict(<span class=\"hljs-string\">&quot;&#x8bbe;&#x65bd;&#x8fd8;&#x53ef;&#x4ee5;&#xff0c;&#x670d;&#x52a1;&#x4eba;&#x5458;&#x6001;&#x5ea6;&#x4e5f;&#x597d;&#xff0c;&#x4ea4;&#x901a;&#x8fd8;&#x7b97;&#x4fbf;&#x5229;&quot;</span>, new_dict))\nlods.append(encode_by_dict(<span class=\"hljs-string\">&quot;&#x9152;&#x5e97;&#x670d;&#x52a1;&#x6001;&#x5ea6;&#x6781;&#x5dee;&#xff0c;&#x8bbe;&#x65bd;&#x5f88;&#x5dee;&quot;</span>, new_dict))\nlods.append(encode_by_dict(<span class=\"hljs-string\">&quot;&#x6211;&#x4f4f;&#x8fc7;&#x7684;&#x6700;&#x4e0d;&#x597d;&#x7684;&#x9152;&#x5e97;,&#x4ee5;&#x540e;&#x51b3;&#x4e0d;&#x4f4f;&#x4e86;&quot;</span>, new_dict))\nlods.append(encode_by_dict(<span class=\"hljs-string\">&quot;&#x8bf4;&#x5b9e;&#x5728;&#x7684;&#x6211;&#x5f88;&#x5931;&#x671b;&#xff0c;&#x6211;&#x60f3;&#x8fd9;&#x5bb6;&#x9152;&#x5e97;&#x4ee5;&#x540e;&#x65e0;&#x8bba;&#x5982;&#x4f55;&#x6211;&#x90fd;&#x4e0d;&#x4f1a;&#x518d;&#x53bb;&#x4e86;&quot;</span>, new_dict))\n\n<span class=\"hljs-comment\"># &#x83b7;&#x53d6;&#x6bcf;&#x53e5;&#x8bdd;&#x7684;&#x5355;&#x8bcd;&#x6570;&#x91cf;</span>\nbase_shape = [[<span class=\"hljs-built_in\">len</span>(c) <span class=\"hljs-keyword\">for</span> c <span class=\"hljs-keyword\">in</span> lods]]\n\n<span class=\"hljs-comment\"># &#x751f;&#x6210;&#x9884;&#x6d4b;&#x6570;&#x636e;</span>\nplace = fluid.CPUPlace()\ninfer_exe = fluid.Executor(place)\ninfer_exe.run(fluid.default_startup_program())\n\ntensor_words = fluid.create_lod_tensor(lods, base_shape, place)\n\ninfer_program, feed_target_names, fetch_targets = \\\n    fluid.io.load_inference_model(dirname=model_save_dir, executor=infer_exe)\n<span class=\"hljs-comment\"># tvar = np.array(fetch_targets, dtype=&quot;int64&quot;)</span>\nresults = infer_exe.run(program=infer_program,\n                  feed={feed_target_names[<span class=\"hljs-number\">0</span>]: tensor_words},\n                  fetch_list=fetch_targets)\n\n<span class=\"hljs-comment\"># &#x6253;&#x5370;&#x6bcf;&#x53e5;&#x8bdd;&#x7684;&#x6b63;&#x8d1f;&#x9762;&#x9884;&#x6d4b;&#x6982;&#x7387;</span>\n<span class=\"hljs-keyword\">for</span> i, r <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(results[<span class=\"hljs-number\">0</span>]):\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x8d1f;&#x9762;: %0.5f, &#x6b63;&#x9762;: %0.5f&quot;</span> % (r[<span class=\"hljs-number\">0</span>], r[<span class=\"hljs-number\">1</span>]))\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6,257"}},{"content":"<pre data-lines=\"258,521\"><code class=\"language-python\"><span class=\"hljs-comment\"># 03_fruits.py</span>\n<span class=\"hljs-comment\"># &#x5229;&#x7528;CNN&#x5b9e;&#x73b0;&#x6c34;&#x679c;&#x8bc6;&#x522b;</span>\n<span class=\"hljs-string\">&quot;&quot;&quot; &#x6570;&#x636e;&#x96c6;&#xff1a;\n&#x722c;&#x866b;&#x4ece;&#x767e;&#x5ea6;&#x56fe;&#x7247;&#x641c;&#x7d22;&#x7ed3;&#x679c;&#x722c;&#x53d6;\n&#x5305;&#x542b;1036&#x5f20;&#x6c34;&#x679c;&#x56fe;&#x7247;\n&#x5171;5&#x4e2a;&#x7c7b;&#x522b;&#xff08;&#x82f9;&#x679c;288&#x5f20;&#x3001;&#x9999;&#x8549;275&#x5f20;&#x3001;&#x8461;&#x8404;216&#x5f20;&#x3001;&#x6a59;&#x5b50;276&#x5f20;&#x3001;&#x68a8;251&#x5f20;&#xff09;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-comment\">####################### &#x6570;&#x636e;&#x9884;&#x5904;&#x7406; ##########################</span>\n<span class=\"hljs-comment\"># &#x5bf9;&#x6570;&#x636e;&#x8fdb;&#x884c;&#x6807;&#x6ce8;&#xff0c;&#x5212;&#x5206;&#x8bad;&#x7ec3;&#x96c6;&#x3001;&#x6d4b;&#x8bd5;&#x96c6;</span>\n<span class=\"hljs-keyword\">import</span> os\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;&#x516c;&#x5171;&#x53d8;&#x91cf;</span>\nname_dict = {<span class=\"hljs-string\">&quot;apple&quot;</span>: <span class=\"hljs-number\">0</span>, <span class=\"hljs-string\">&quot;banana&quot;</span>: <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&quot;grape&quot;</span>: <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">&quot;orange&quot;</span>: <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">&quot;pear&quot;</span>: <span class=\"hljs-number\">4</span>}  <span class=\"hljs-comment\"># &#x540d;&#x79f0;-&#x503c;&#x6620;&#x5c04;&#x5b57;&#x5178;</span>\ndata_root_path = <span class=\"hljs-string\">&quot;data/fruits/&quot;</span>  <span class=\"hljs-comment\"># &#x6837;&#x672c;&#x6570;&#x636e;&#x6240;&#x5728;&#x76ee;&#x5f55;</span>\ntest_file_path = data_root_path + <span class=\"hljs-string\">&quot;test.txt&quot;</span>  <span class=\"hljs-comment\"># &#x6d4b;&#x8bd5;&#x96c6;&#x6587;&#x4ef6;&#x8def;&#x5f84;</span>\ntrain_file_path = data_root_path + <span class=\"hljs-string\">&quot;train.txt&quot;</span>  <span class=\"hljs-comment\"># &#x8bad;&#x7ec3;&#x96c6;&#x6587;&#x4ef6;&#x8def;&#x5f84;</span>\nname_dict_list = {}  <span class=\"hljs-comment\"># &#x8bb0;&#x5f55;&#x6bcf;&#x4e2a;&#x7c7b;&#x522b;&#x6709;&#x54ea;&#x4e9b;&#x56fe;&#x7247; key:&#x6c34;&#x679c;&#x540d;&#x79f0;  value:&#x56fe;&#x7247;&#x8def;&#x5f84;&#x5217;&#x8868;</span>\n\n\n<span class=\"hljs-comment\"># &#x5c06;&#x56fe;&#x7247;&#x8def;&#x5f84;&#x5b58;&#x5165;&#x5230;name_dict_list&#x5b57;&#x5178;&#x4e2d;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">save_train_test_file</span>(<span class=\"hljs-params\">path, name</span>):\n    <span class=\"hljs-keyword\">if</span> name <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">in</span> name_dict_list:  <span class=\"hljs-comment\"># &#x8be5;&#x7c7b;&#x6c34;&#x679c;&#x4e0d;&#x5728;&#x5b57;&#x5178;&#x4e2d;&#xff0c;&#x5219;&#x65b0;&#x5efa;&#x4e00;&#x4e2a;&#x5217;&#x8868;&#x63d2;&#x5165;</span>\n        img_list = []\n        img_list.append(path)  <span class=\"hljs-comment\"># &#x5c06;&#x56fe;&#x7247;&#x8def;&#x5f84;&#x6dfb;&#x52a0;&#x5230;&#x5217;&#x8868;</span>\n        name_dict_list[name] = img_list  <span class=\"hljs-comment\"># &#x5c06;&quot;&#x7c7b;&#x522b;-&#x6587;&#x4ef6;&#x5217;&#x8868;&quot;&#x952e;&#x503c;&#x5bf9;&#x6dfb;&#x52a0;&#x5230;&#x5b57;&#x5178;</span>\n    <span class=\"hljs-keyword\">else</span>:  <span class=\"hljs-comment\"># &#x8be5;&#x7c7b;&#x6c34;&#x679c;&#x5728;&#x5b57;&#x5178;&#x4e2d;&#xff0c;&#x5219;&#x76f4;&#x63a5;&#x5c06;&#x56fe;&#x50cf;&#x8def;&#x5f84;&#x6dfb;&#x52a0;&#x5230;&#x5217;&#x8868;</span>\n        name_dict_list[name].append(path)\n\n\n<span class=\"hljs-comment\"># &#x904d;&#x5386;&#x6570;&#x636e;&#x96c6;&#x4e0b;&#x7684;&#x6bcf;&#x4e2a;&#x5b50;&#x76ee;&#x5f55;&#xff0c;&#x5c06;&#x56fe;&#x7247;&#x8def;&#x5f84;&#x586b;&#x5165;name_dict_list&#x5b57;&#x5178;&#x4e2d;</span>\ndirs = os.listdir(data_root_path)\n<span class=\"hljs-keyword\">for</span> d <span class=\"hljs-keyword\">in</span> dirs:\n    full_path = data_root_path + d  <span class=\"hljs-comment\"># &#x5b8c;&#x6574;&#x8def;&#x5f84;</span>\n\n    <span class=\"hljs-keyword\">if</span> os.path.isdir(full_path):  <span class=\"hljs-comment\"># &#x662f;&#x76ee;&#x5f55;, &#x53d6;&#x51fa;&#x5176;&#x4e2d;&#x7684;&#x56fe;&#x7247;&#x8def;&#x5f84;</span>\n        imgs = os.listdir(full_path)  <span class=\"hljs-comment\"># &#x5217;&#x51fa;&#x5b50;&#x76ee;&#x5f55;&#x4e0b;&#x6240;&#x6709;&#x7684;&#x5185;&#x5bb9;</span>\n        <span class=\"hljs-keyword\">for</span> img <span class=\"hljs-keyword\">in</span> imgs:\n            save_train_test_file(full_path + <span class=\"hljs-string\">&quot;/&quot;</span> + img,  <span class=\"hljs-comment\"># &#x62fc;&#x56fe;&#x7247;&#x5b8c;&#x6574;&#x8def;&#x5f84;</span>\n                                 d)  <span class=\"hljs-comment\"># &#x7c7b;&#x522b;&#x540d;&#x79f0;(&#x91c7;&#x7528;&#x5b50;&#x76ee;&#x5f55;&#x4f5c;&#x4e3a;&#x7c7b;&#x522b;&#x540d;&#x79f0;)</span>\n    <span class=\"hljs-keyword\">else</span>:  <span class=\"hljs-comment\"># &#x6587;&#x4ef6;</span>\n        <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-comment\"># &#x5c06;name_dict_list&#x5b57;&#x5178;&#x4e2d;&#x5185;&#x5bb9;&#x5199;&#x5165;&#x6d4b;&#x8bd5;&#x96c6;&#x3001;&#x8bad;&#x7ec3;&#x96c6;</span>\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(test_file_path, <span class=\"hljs-string\">&quot;w&quot;</span>) <span class=\"hljs-keyword\">as</span> f:  <span class=\"hljs-comment\"># &#x6e05;&#x7a7a;&#x6d4b;&#x8bd5;&#x96c6;&#x6587;&#x4ef6;</span>\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(train_file_path, <span class=\"hljs-string\">&quot;w&quot;</span>) <span class=\"hljs-keyword\">as</span> f:  <span class=\"hljs-comment\"># &#x6e05;&#x7a7a;&#x8bad;&#x7ec3;&#x96c6;&#x6587;&#x4ef6;</span>\n    <span class=\"hljs-keyword\">pass</span>\n\n<span class=\"hljs-comment\"># &#x904d;&#x5386;&#x5b57;&#x5178;&#xff0c;&#x5c06;&#x5176;&#x4e2d;&#x7684;&#x5185;&#x5bb9;&#x5199;&#x5165;&#x6587;&#x4ef6;</span>\n<span class=\"hljs-keyword\">for</span> name, img_list <span class=\"hljs-keyword\">in</span> name_dict_list.items():\n    i = <span class=\"hljs-number\">0</span>\n    num = <span class=\"hljs-built_in\">len</span>(img_list)\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;%s: %d&#x5f20;&quot;</span> % (name, num))\n\n    <span class=\"hljs-comment\"># &#x5199;&#x6d4b;&#x8bd5;&#x96c6;&#x3001;&#x8bad;&#x7ec3;&#x96c6;</span>\n    <span class=\"hljs-keyword\">for</span> img <span class=\"hljs-keyword\">in</span> img_list:\n        <span class=\"hljs-keyword\">if</span> i % <span class=\"hljs-number\">10</span> == <span class=\"hljs-number\">0</span>:  <span class=\"hljs-comment\"># &#x6bcf;10&#x7b14;&#x5199;&#x4e00;&#x7b14;&#x6d4b;&#x8bd5;&#x96c6;</span>\n            <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(test_file_path, <span class=\"hljs-string\">&quot;a&quot;</span>) <span class=\"hljs-keyword\">as</span> f:  <span class=\"hljs-comment\"># &#x8ffd;&#x52a0;&#x6a21;&#x5f0f;&#x6253;&#x5f00;&#x6587;&#x4ef6;</span>\n                line = <span class=\"hljs-string\">&quot;%s\\t%d\\n&quot;</span> % (img, name_dict[name])\n                f.write(line)\n        <span class=\"hljs-keyword\">else</span>:  <span class=\"hljs-comment\"># &#x5199;&#x8bad;&#x7ec3;&#x96c6;</span>\n            <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(train_file_path, <span class=\"hljs-string\">&quot;a&quot;</span>) <span class=\"hljs-keyword\">as</span> f:  <span class=\"hljs-comment\"># &#x8ffd;&#x52a0;&#x6a21;&#x5f0f;&#x6253;&#x5f00;&#x6587;&#x4ef6;</span>\n                line = <span class=\"hljs-string\">&quot;%s\\t%d\\n&quot;</span> % (img, name_dict[name])\n                f.write(line)\n        i += <span class=\"hljs-number\">1</span>  <span class=\"hljs-comment\"># &#x8ba1;&#x6570;&#x5668;+1</span>\n\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x6570;&#x636e;&#x9884;&#x5904;&#x7406;&#x5b8c;&#x6210;!&quot;</span>)\n\n<span class=\"hljs-comment\">##################### &#x6a21;&#x578b;&#x642d;&#x5efa;/&#x8bad;&#x7ec3; #########################</span>\n<span class=\"hljs-keyword\">import</span> paddle\n<span class=\"hljs-keyword\">import</span> paddle.fluid <span class=\"hljs-keyword\">as</span> fluid\n<span class=\"hljs-keyword\">import</span> numpy\n<span class=\"hljs-keyword\">import</span> sys\n<span class=\"hljs-keyword\">import</span> os\n<span class=\"hljs-keyword\">from</span> multiprocessing <span class=\"hljs-keyword\">import</span> cpu_count\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">import</span> matplotlib.pyplot <span class=\"hljs-keyword\">as</span> plt\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">train_mapper</span>(<span class=\"hljs-params\">sample</span>):\n    <span class=\"hljs-string\">&quot;&quot;&quot;\n    &#x4f20;&#x5165;&#x4e00;&#x884c;&#x6837;&#x672c;&#x6570;&#x636e;(&#x4e00;&#x884c;&#x6587;&#x672c;), &#x8bfb;&#x53d6;&#x56fe;&#x50cf;&#x6570;&#x636e;&#x3001;&#x7edf;&#x4e00;&#x8bbe;&#x7f6e;&#x6210;&#x56fa;&#x5b9a;&#x5927;&#x5c0f;&#x3001;&#x5f52;&#x4e00;&#x5316;&#x5e76;&#x8fd4;&#x56de;\n    :param sample: &#x5143;&#x7ec4;, &#x5f62;&#x5982;&#xff1a; (data/fruits/apple/0.jpg, 0)\n    :return: &#x8fd4;&#x56de;&#x56fe;&#x50cf;&#x6570;&#x636e;&#x548c;&#x6240;&#x5c5e;&#x7684;&#x7c7b;&#x522b;\n    &quot;&quot;&quot;</span>\n    img_path, label = sample  <span class=\"hljs-comment\"># &#x5c06;&#x5143;&#x7ec4;&#x8d4b;&#x503c;&#x7ed9;&#x4e24;&#x4e2a;&#x53d8;&#x91cf;,img_path&#x4ee3;&#x8868;&#x56fe;&#x50cf;&#x8def;&#x5f84;, label&#x7c7b;&#x522b;</span>\n    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> os.path.exists(img_path):\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x56fe;&#x7247;&#x4e0d;&#x5b58;&#x5728;:&quot;</span>, img_path)\n\n    <span class=\"hljs-comment\"># &#x8bfb;&#x53d6;&#x56fe;&#x50cf;&#x6570;&#x636e;</span>\n    img = paddle.dataset.image.load_image(img_path)\n    <span class=\"hljs-comment\"># &#x5c06;&#x56fe;&#x50cf;&#x6570;&#x636e;&#x8bbe;&#x7f6e;&#x6210;&#x7edf;&#x4e00;&#x5927;&#x5c0f;</span>\n    img = paddle.dataset.image.simple_transform(im=img, <span class=\"hljs-comment\"># &#x539f;&#x59cb;&#x56fe;&#x50cf;&#x6570;&#x636e;</span>\n                                        resize_size=<span class=\"hljs-number\">100</span>, <span class=\"hljs-comment\"># &#x56fe;&#x50cf;&#x91cd;&#x7f6e;&#x4e3a;100*100(&#x56fe;&#x50cf;&#x4e0d;&#x80fd;&#x592a;&#x5927;)</span>\n                                        crop_size=<span class=\"hljs-number\">100</span>, <span class=\"hljs-comment\"># &#x88c1;&#x526a;&#x56fe;&#x50cf;&#x5927;&#x5c0f;</span>\n                                        is_color=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-comment\"># &#x5f69;&#x8272;&#x56fe;&#x50cf;</span>\n                                        is_train=<span class=\"hljs-literal\">True</span>) <span class=\"hljs-comment\"># is_train&#x5f71;&#x54cd;&#x88c1;&#x526a;&#x7b56;&#x7565;</span>\n    <span class=\"hljs-comment\"># &#x5f52;&#x4e00;&#x5316;,&#x5c06;&#x50cf;&#x7d20;&#x7684;&#x7070;&#x5ea6;&#x503c;&#x7531;0~255&#x8f6c;&#x6362;&#x4e3a;0~1&#x4e4b;&#x95f4;</span>\n    <span class=\"hljs-comment\"># &#x76ee;&#x7684;&#x662f;&#x8ba9;&#x6574;&#x4e2a;CNN&#x8ba1;&#x7b97;&#x66f4;&#x7a33;&#x5b9a;</span>\n    img = img.astype(<span class=\"hljs-string\">&quot;float32&quot;</span>) / <span class=\"hljs-number\">255.0</span>\n\n    <span class=\"hljs-keyword\">return</span> img, label\n\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">train_r</span>(<span class=\"hljs-params\">train_list, buffered_size=<span class=\"hljs-number\">1024</span></span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">reader</span>():\n        <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(train_list, <span class=\"hljs-string\">&quot;r&quot;</span>) <span class=\"hljs-keyword\">as</span> f:\n            lines = [line.strip() <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> f] <span class=\"hljs-comment\"># &#x8bfb;&#x53d6;&#x6240;&#x6709;&#x884c;&#xff0c;&#x5e76;&#x53bb;&#x9664;&#x7a7a;&#x683c;</span>\n            <span class=\"hljs-keyword\">for</span> line <span class=\"hljs-keyword\">in</span> lines:\n                img_path, lab = line.replace(<span class=\"hljs-string\">&quot;\\n&quot;</span>, <span class=\"hljs-string\">&quot;&quot;</span>).split(<span class=\"hljs-string\">&quot;\\t&quot;</span>)\n                <span class=\"hljs-keyword\">yield</span> img_path, <span class=\"hljs-built_in\">int</span>(lab)\n    <span class=\"hljs-keyword\">return</span> paddle.reader.xmap_readers(train_mapper, <span class=\"hljs-comment\"># &#x5c06;reader&#x8bfb;&#x53d6;&#x5230;&#x7684;&#x6570;&#x636e;&#x4ea4;&#x7ed9;&#x8be5;&#x51fd;&#x6570;&#x8fdb;&#x4e00;&#x6b65;&#x5904;&#x7406;</span>\n                                      reader, <span class=\"hljs-comment\"># &#x539f;&#x59cb;&#x8bfb;&#x53d6;&#x5668;&#xff0c;&#x8bfb;&#x53d6;&#x7684;&#x6570;&#x636e;&#x4ea4;&#x7ed9;train_mapper&#x5904;&#x7406;</span>\n                                      cpu_count(), <span class=\"hljs-comment\"># &#x7ebf;&#x7a0b;&#x6570;&#x91cf;(&#x548c;&#x903b;&#x8f91;CPU&#x6570;&#x91cf;&#x4e00;&#x81f4;)</span>\n                                      buffered_size) <span class=\"hljs-comment\"># &#x7f13;&#x51b2;&#x533a;&#x5927;&#x5c0f;</span>\n\n\n<span class=\"hljs-comment\"># &#x51c6;&#x5907;&#x6570;&#x636e;</span>\nBATCH_SIZE = <span class=\"hljs-number\">32</span> <span class=\"hljs-comment\"># &#x6279;&#x6b21;&#x5927;&#x5c0f;</span>\n\ntrain_reader = train_r(train_list=train_file_path) <span class=\"hljs-comment\"># &#x539f;&#x59cb;reader</span>\nrandom_train_reader = paddle.reader.shuffle(reader=train_reader,\n                                            buf_size=<span class=\"hljs-number\">1300</span>) <span class=\"hljs-comment\"># &#x968f;&#x673a;&#x8bfb;&#x53d6;&#x5668;</span>\nbatch_train_reader = paddle.batch(random_train_reader,\n                                  batch_size=BATCH_SIZE) <span class=\"hljs-comment\"># &#x6279;&#x91cf;&#x8bfb;&#x53d6;&#x5668;</span>\n<span class=\"hljs-comment\"># &#x53d8;&#x91cf;</span>\nimage = fluid.layers.data(name=<span class=\"hljs-string\">&quot;image&quot;</span>, shape=[<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">100</span>, <span class=\"hljs-number\">100</span>], dtype=<span class=\"hljs-string\">&quot;float32&quot;</span>)\nlabel = fluid.layers.data(name=<span class=\"hljs-string\">&quot;label&quot;</span>, shape=[<span class=\"hljs-number\">1</span>], dtype=<span class=\"hljs-string\">&quot;int64&quot;</span>)\n\n<span class=\"hljs-comment\"># &#x521b;&#x5efa;VGG&#x6a21;&#x578b;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">vgg_bn_drop</span>(<span class=\"hljs-params\">image, type_size</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">conv_block</span>(<span class=\"hljs-params\">ipt, num_filter, groups, dropouts</span>):\n        <span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x5377;&#x79ef;/batch normal/dropout/pool2d&#x64cd;&#x4f5c;&#x7ec4;</span>\n        <span class=\"hljs-keyword\">return</span> fluid.nets.img_conv_group(<span class=\"hljs-built_in\">input</span>=ipt, <span class=\"hljs-comment\"># &#x8f93;&#x5165;&#x6570;&#x636e;, [N,C,H,W]&#x683c;&#x5f0f;</span>\n                                         pool_stride=<span class=\"hljs-number\">2</span>, <span class=\"hljs-comment\"># &#x6c60;&#x5316;&#x6b65;&#x957f;&#x503c;</span>\n                                         pool_size=<span class=\"hljs-number\">2</span>, <span class=\"hljs-comment\"># &#x6c60;&#x5316;&#x533a;&#x57df;&#x5927;&#x5c0f;</span>\n                                         conv_num_filter=[num_filter]*groups,<span class=\"hljs-comment\">#&#x5377;&#x79ef;&#x6838;&#x6570;&#x91cf;</span>\n                                         conv_filter_size=<span class=\"hljs-number\">3</span>, <span class=\"hljs-comment\"># &#x5377;&#x79ef;&#x6838;&#x5927;&#x5c0f;</span>\n                                         conv_act=<span class=\"hljs-string\">&quot;relu&quot;</span>, <span class=\"hljs-comment\"># &#x6fc0;&#x6d3b;&#x51fd;&#x6570;</span>\n                                         conv_with_batchnorm=<span class=\"hljs-literal\">True</span>, <span class=\"hljs-comment\"># &#x662f;&#x5426;&#x4f7f;&#x7528;batch normal</span>\n                                         pool_type=<span class=\"hljs-string\">&quot;max&quot;</span>) <span class=\"hljs-comment\"># &#x6c60;&#x5316;&#x7c7b;&#x578b;</span>\n    <span class=\"hljs-comment\"># 5&#x7ec4;&#x5377;&#x79ef;&#x6c60;&#x5316;</span>\n    conv1 = conv_block(image, <span class=\"hljs-number\">64</span>, <span class=\"hljs-number\">2</span>, [<span class=\"hljs-number\">0.0</span>, <span class=\"hljs-number\">0</span>])\n    conv2 = conv_block(conv1, <span class=\"hljs-number\">128</span>, <span class=\"hljs-number\">2</span>, [<span class=\"hljs-number\">0.0</span>, <span class=\"hljs-number\">0</span>])\n    conv3 = conv_block(conv2, <span class=\"hljs-number\">256</span>, <span class=\"hljs-number\">3</span>, [<span class=\"hljs-number\">0.0</span>, <span class=\"hljs-number\">0.0</span>, <span class=\"hljs-number\">0.0</span>])\n    conv4 = conv_block(conv3, <span class=\"hljs-number\">512</span>, <span class=\"hljs-number\">3</span>, [<span class=\"hljs-number\">0.0</span>, <span class=\"hljs-number\">0.0</span>, <span class=\"hljs-number\">0.0</span>])\n    conv5 = conv_block(conv4, <span class=\"hljs-number\">512</span>, <span class=\"hljs-number\">3</span>, [<span class=\"hljs-number\">0.0</span>, <span class=\"hljs-number\">0.0</span>, <span class=\"hljs-number\">0.0</span>])\n\n    drop = fluid.layers.dropout(x=conv5, dropout_prob=<span class=\"hljs-number\">0.5</span>) <span class=\"hljs-comment\"># &#x8c03;&#x6574;0.3&#x770b;&#x73b0;&#x8c61;</span>\n    fc1 = fluid.layers.fc(<span class=\"hljs-built_in\">input</span>=drop, size=<span class=\"hljs-number\">512</span>, act=<span class=\"hljs-literal\">None</span>)\n\n    bn = fluid.layers.batch_norm(<span class=\"hljs-built_in\">input</span>=fc1, act=<span class=\"hljs-string\">&quot;relu&quot;</span>) <span class=\"hljs-comment\"># batch normal</span>\n    drop2 = fluid.layers.dropout(x=bn, dropout_prob=<span class=\"hljs-number\">0.0</span>)\n    fc2 = fluid.layers.fc(<span class=\"hljs-built_in\">input</span>=drop2, size=<span class=\"hljs-number\">512</span>, act=<span class=\"hljs-literal\">None</span>)\n    predict = fluid.layers.fc(<span class=\"hljs-built_in\">input</span>=fc2, size=type_size, act=<span class=\"hljs-string\">&quot;softmax&quot;</span>)\n\n    <span class=\"hljs-keyword\">return</span> predict\n\n\n<span class=\"hljs-comment\"># &#x8c03;&#x7528;&#x51fd;&#x6570;&#xff0c;&#x521b;&#x5efa;VGG&#x7f51;&#x7edc;</span>\npredict = vgg_bn_drop(image=image, type_size=<span class=\"hljs-number\">5</span>) <span class=\"hljs-comment\"># &#x8f93;&#x51fa;5&#x4e2a;&#x7c7b;&#x522b;</span>\n<span class=\"hljs-comment\"># &#x635f;&#x5931;&#x51fd;&#x6570;&#xff1a;&#x4ea4;&#x53c9;&#x71b5;</span>\ncost = fluid.layers.cross_entropy(<span class=\"hljs-built_in\">input</span>=predict, <span class=\"hljs-comment\"># &#x9884;&#x6d4b;&#x503c;</span>\n                                  label=label) <span class=\"hljs-comment\"># &#x771f;&#x5b9e;&#x503c;</span>\navg_cost = fluid.layers.mean(cost) <span class=\"hljs-comment\"># &#x6c42;&#x5747;&#x503c;</span>\n<span class=\"hljs-comment\"># &#x51c6;&#x786e;&#x7387;</span>\naccuracy = fluid.layers.accuracy(<span class=\"hljs-built_in\">input</span>=predict, <span class=\"hljs-comment\"># &#x9884;&#x6d4b;&#x503c;</span>\n                                label=label) <span class=\"hljs-comment\"># &#x771f;&#x5b9e;&#x503c;</span>\n<span class=\"hljs-comment\"># &#x4f18;&#x5316;&#x5668;</span>\noptimizer = fluid.optimizer.Adam(learning_rate=<span class=\"hljs-number\">0.001</span>)\noptimizer.minimize(avg_cost) <span class=\"hljs-comment\"># &#x5c06;&#x635f;&#x5931;&#x51fd;&#x6570;&#x5747;&#x503c;&#x4f18;&#x5316;&#x5230;&#x6700;&#x5c0f;</span>\n\n<span class=\"hljs-comment\"># &#x6267;&#x884c;&#x5668;</span>\nplace = fluid.CUDAPlace(<span class=\"hljs-number\">0</span>) <span class=\"hljs-comment\"># GPU&#x8bad;&#x7ec3;</span>\n<span class=\"hljs-comment\"># place = fluid.CPUPlace() # CPU</span>\nexe = fluid.Executor(place)\nexe.run(fluid.default_startup_program())\n\n<span class=\"hljs-comment\"># feeder</span>\nfeeder = fluid.DataFeeder(feed_list=[image, label],\n                          place=place)\n\nmodel_save_dir = <span class=\"hljs-string\">&quot;model/fruits/&quot;</span> <span class=\"hljs-comment\"># &#x6a21;&#x578b;&#x4fdd;&#x5b58;&#x8def;&#x5f84;</span>\ncosts = [] <span class=\"hljs-comment\"># &#x4fdd;&#x5b58;&#x8bad;&#x7ec3;&#x8fc7;&#x7a0b;&#x4e2d;&#x7684;&#x635f;&#x5931;&#x503c;</span>\naccs = []  <span class=\"hljs-comment\"># &#x4fdd;&#x5b58;&#x8bad;&#x7ec3;&#x8fc7;&#x7a0b;&#x4e2d;&#x7684;&#x51c6;&#x786e;&#x7387;</span>\ntimes = <span class=\"hljs-number\">0</span>\nbatches = [] <span class=\"hljs-comment\"># &#x8fed;&#x4ee3;&#x6b21;&#x6570;</span>\n\n<span class=\"hljs-comment\"># &#x5f00;&#x59cb;&#x8bad;&#x7ec3;</span>\n<span class=\"hljs-keyword\">for</span> pass_id <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">3</span>):\n    train_cost = <span class=\"hljs-number\">0</span> <span class=\"hljs-comment\"># &#x4e34;&#x65f6;&#x53d8;&#x91cf;&#xff0c;&#x4fdd;&#x5b58;&#x6bcf;&#x6b21;&#x8bad;&#x7ec3;&#x7684;&#x635f;&#x5931;&#x503c;</span>\n\n    <span class=\"hljs-keyword\">for</span> batch_id, data <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">enumerate</span>(batch_train_reader()): <span class=\"hljs-comment\"># batch_train_reader&#x6279;&#x91cf;&#x8bfb;&#x53d6;&#x5668;</span>\n        times += <span class=\"hljs-number\">1</span>\n        train_cost, train_acc = exe.run(program=fluid.default_main_program(),\n                                        feed=feeder.feed(data),\n                                        fetch_list=[avg_cost, accuracy])<span class=\"hljs-comment\">#&#x83b7;&#x53d6;&#x635f;&#x5931;&#x503c;&#x3001;&#x51c6;&#x786e;&#x7387;</span>\n        <span class=\"hljs-keyword\">if</span> batch_id % <span class=\"hljs-number\">20</span> == <span class=\"hljs-number\">0</span>:\n            <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;pass_id:%d, step:%d, cost:%f, acc:%f&quot;</span> %\n                  (pass_id, batch_id, train_cost[<span class=\"hljs-number\">0</span>], train_acc[<span class=\"hljs-number\">0</span>]))\n            accs.append(train_acc[<span class=\"hljs-number\">0</span>]) <span class=\"hljs-comment\"># &#x8bb0;&#x5f55;&#x51c6;&#x786e;&#x7387;</span>\n            costs.append(train_cost[<span class=\"hljs-number\">0</span>]) <span class=\"hljs-comment\"># &#x8bb0;&#x5f55;&#x635f;&#x5931;&#x503c;</span>\n            batches.append(times) <span class=\"hljs-comment\"># &#x8bb0;&#x5f55;&#x8fed;&#x4ee3;&#x6b21;&#x6570;</span>\n\n<span class=\"hljs-comment\"># &#x8bad;&#x7ec3;&#x7ed3;&#x675f;&#x540e;&#xff0c;&#x4fdd;&#x5b58;&#x6a21;&#x578b;</span>\n<span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> os.path.exists(model_save_dir):\n    os.makedirs(model_save_dir)\nfluid.io.save_inference_model(dirname=model_save_dir,\n                              feeded_var_names=[<span class=\"hljs-string\">&quot;image&quot;</span>],\n                              target_vars=[predict],\n                              executor=exe)\n<span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x8bad;&#x7ec3;&#x4fdd;&#x5b58;&#x6a21;&#x578b;&#x5b8c;&#x6210;!&quot;</span>)\n\n<span class=\"hljs-comment\"># &#x8bad;&#x7ec3;&#x8fc7;&#x7a0b;&#x53ef;&#x89c6;&#x5316;</span>\nplt.title(<span class=\"hljs-string\">&quot;training&quot;</span>, fontsize=<span class=\"hljs-number\">24</span>)\nplt.xlabel(<span class=\"hljs-string\">&quot;iter&quot;</span>, fontsize=<span class=\"hljs-number\">20</span>)\nplt.ylabel(<span class=\"hljs-string\">&quot;cost/acc&quot;</span>, fontsize=<span class=\"hljs-number\">20</span>)\nplt.plot(batches, costs, color=<span class=\"hljs-string\">&apos;red&apos;</span>, label=<span class=\"hljs-string\">&quot;Training Cost&quot;</span>)\nplt.plot(batches, accs, color=<span class=\"hljs-string\">&apos;green&apos;</span>, label=<span class=\"hljs-string\">&quot;Training Acc&quot;</span>)\nplt.legend()\nplt.grid()\nplt.show()\nplt.savefig(<span class=\"hljs-string\">&quot;train.png&quot;</span>)\n\n\n<span class=\"hljs-comment\">######################### &#x9884;&#x6d4b; #############################</span>\n<span class=\"hljs-keyword\">from</span> PIL <span class=\"hljs-keyword\">import</span> Image\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;&#x6267;&#x884c;&#x5668;</span>\nplace = fluid.CPUPlace()\ninfer_exe = fluid.Executor(place)\n\n<span class=\"hljs-comment\"># &#x8bfb;&#x53d6;&#x6307;&#x5b9a;&#x56fe;&#x50cf;&#x6570;&#x636e;</span>\n<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">load_img</span>(<span class=\"hljs-params\">path</span>):\n    img = paddle.dataset.image.load_and_transform(path, <span class=\"hljs-number\">100</span>, <span class=\"hljs-number\">100</span>, <span class=\"hljs-literal\">False</span>).astype(<span class=\"hljs-string\">&quot;float32&quot;</span>)\n    img = img / <span class=\"hljs-number\">255.0</span> <span class=\"hljs-comment\"># &#x5f52;&#x4e00;&#x5316;</span>\n    <span class=\"hljs-keyword\">return</span> img\n\ninfer_imgs = [] <span class=\"hljs-comment\"># &#x5b58;&#x653e;&#x6d4b;&#x8bd5;&#x7684;&#x56fe;&#x50cf;&#x6570;&#x636e;</span>\ntest_img = <span class=\"hljs-string\">&quot;apple_1.png&quot;</span> <span class=\"hljs-comment\"># &#x8bbe;&#x7f6e;&#x5f85;&#x9884;&#x6d4b;&#x7684;&#x56fe;&#x7247;</span>\ninfer_imgs.append(load_img(test_img)) <span class=\"hljs-comment\"># &#x8bfb;&#x53d6;&#x56fe;&#x7247;&#x6570;&#x636e;&#xff0c;&#x5e76;&#x6dfb;&#x52a0;&#x5230;&#x5217;&#x8868;</span>\ninfer_imgs = numpy.array(infer_imgs) <span class=\"hljs-comment\"># &#x8f6c;&#x6362;&#x6210;&#x6570;&#x7ec4;(&#x9884;&#x6d4b;&#x6a21;&#x578b;&#x4e0d;&#x80fd;&#x63a5;&#x6536;&#x5217;&#x8868;)</span>\n\n<span class=\"hljs-comment\"># &#x52a0;&#x8f7d;&#x6a21;&#x578b;</span>\ninfer_program, feed_target_names, fetch_targets = \\\n    fluid.io.load_inference_model(model_save_dir, infer_exe)\n\n<span class=\"hljs-comment\"># &#x6267;&#x884c;&#x9884;&#x6d4b;</span>\nresults = infer_exe.run(infer_program, <span class=\"hljs-comment\"># &#x8fd0;&#x884c;&#x6267;&#x884c;&#x9884;&#x6d4b;&#x7684;program</span>\n                        feed={feed_target_names[<span class=\"hljs-number\">0</span>]:infer_imgs}, <span class=\"hljs-comment\"># &#x4f20;&#x5165;&#x53c2;&#x6570;</span>\n                        fetch_list=fetch_targets) <span class=\"hljs-comment\"># &#x8fd4;&#x56de;&#x7ed3;&#x679c;</span>\n<span class=\"hljs-comment\"># print(results)</span>\nresult = numpy.argmax(results[<span class=\"hljs-number\">0</span>]) <span class=\"hljs-comment\"># &#x53d6;&#x51fa;&#x7b2c;&#x4e00;&#x4e2a;&#x9884;&#x6d4b;&#x7ed3;&#x679c;&#x4e2d;&#xff0c;&#x503c;&#x6700;&#x5927;&#x7684;&#x5143;&#x7d20;&#x7684;&#x7d22;&#x5f15;</span>\n<span class=\"hljs-keyword\">for</span> k, v <span class=\"hljs-keyword\">in</span> name_dict.items(): <span class=\"hljs-comment\"># &#x904d;&#x5386;&#x5b57;&#x5178;&#xff0c;&#x5c06;&#x7c7b;&#x522b;&#x6570;&#x503c;&#x8f6c;&#x6362;&#x4e3a;&#x540d;&#x79f0;</span>\n    <span class=\"hljs-keyword\">if</span> result == v:\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;&#x9884;&#x6d4b;&#x7ed3;&#x679c;:&quot;</span>, k) <span class=\"hljs-comment\"># &#x6253;&#x5370;&#x540d;&#x79f0;</span>\n\n<span class=\"hljs-comment\"># &#x663e;&#x793a;&#x51fa;&#x539f;&#x56fe;&#x50cf;</span>\nimg = Image.<span class=\"hljs-built_in\">open</span>(test_img)\nplt.imshow(img)\nplt.show()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"258,521"}}],"payload":{"tag":"h5","lines":"4,5"}}],"payload":{"tag":"h3","lines":"0,1"}},{})</script>
</body>
</html>
