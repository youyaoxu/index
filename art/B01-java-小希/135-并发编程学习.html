<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"&#x5e76;&#x53d1;&#x7f16;&#x7a0b;&#x5b66;&#x4e60;","children":[{"content":"1.1&#x3001;&#x8fdb;&#x7a0b;&#x4e0e;&#x7ebf;&#x7a0b;","children":[{"content":"<pre data-lines=\"5,25\"><code>&#x8fdb;&#x7a0b;&#xff08;Process&#xff09;&#x662f;&#x7cfb;&#x7edf;&#x8fdb;&#x884c;&#x8d44;&#x6e90;&#x5206;&#x914d;&#x548c;&#x8c03;&#x5ea6;&#x7684;&#x57fa;&#x672c;&#x5355;&#x4f4d;&#xff0c;&#x662f;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x7ed3;&#x6784;&#x7684;&#x57fa;&#x7840;&#x3002;&#x5728;&#x65e9;&#x671f;&#x9762;&#x5411;&#x8fdb;&#x7a0b;&#x8bbe;&#x8ba1;&#x7684;&#x8ba1;&#x7b97;&#x673a;&#x7ed3;&#x6784;&#x4e2d;&#xff0c;&#x8fdb;&#x7a0b;&#x662f;&#x7a0b;&#x5e8f;&#x7684;&#x57fa;&#x672c;&#x6267;&#x884c;&#x5b9e;&#x4f53;&#xff1b;&#x5728;&#x5f53;&#x4ee3;&#x9762;&#x5411;&#x7ebf;&#x7a0b;&#x8bbe;&#x8ba1;&#x7684;&#x8ba1;&#x7b97;&#x673a;&#x7ed3;&#x6784;&#x4e2d;&#xff0c;&#x8fdb;&#x7a0b;&#x662f;&#x7ebf;&#x7a0b;&#x7684;&#x5bb9;&#x5668;&#x3002;\n\n&#x7ebf;&#x7a0b;&#xff08;Thread&#xff09;&#x662f;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x80fd;&#x591f;&#x8fdb;&#x884c;&#x8fd0;&#x7b97;&#x8c03;&#x5ea6;&#x7684;&#x6700;&#x5c0f;&#x5355;&#x4f4d;&#x3002;&#x5b83;&#x88ab;&#x5305;&#x542b;&#x5728;&#x8fdb;&#x7a0b;&#x4e4b;&#x4e2d;&#xff0c;&#x662f;&#x8fdb;&#x7a0b;&#x4e2d;&#x7684;&#x5b9e;&#x9645;&#x8fd0;&#x4f5c;&#x5355;&#x4f4d;&#x3002;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x5c31;&#x662f;&#x4e00;&#x4e2a;&#x6307;&#x4ee4;&#x6d41;&#xff0c;&#x5c06;&#x6307;&#x4ee4;&#x6d41;&#x4e2d;&#x7684;&#x4e00;&#x6761;&#x6761;&#x6307;&#x4ee4;&#x4ee5;&#x4e00;&#x5b9a;&#x7684;&#x987a;&#x5e8f;&#x4ea4;&#x7ed9; CPU &#x6267;&#x884c;&#x3002;\n\n**&#x5728; windows &#x4e0b;&#x67e5;&#x770b;&#x8fdb;&#x7a0b;&#x7684;&#x547d;&#x4ee4;&#xff1a;** \n\n*   &#x67e5;&#x770b;&#x8fdb;&#x7a0b;&#xff1a;`tasklist`\n*   &#x6740;&#x6b7b;&#x8fdb;&#x7a0b;&#xff1a;`taskkill /pid &lt;PID&gt;`\n\n**&#x5728; linux &#x4e0b;&#x67e5;&#x770b;&#x8fdb;&#x7a0b;&#x7684;&#x547d;&#x4ee4;&#xff1a;** \n\n*   &#x67e5;&#x770b;&#x8fdb;&#x7a0b;&#xff1a;`ps -fe`\n*   &#x67e5;&#x770b;&#x7ebf;&#x7a0b;&#xff1a;`top -H -p &lt;PID&gt;`\n*   &#x6740;&#x6b7b;&#x8fdb;&#x7a0b;&#xff1a;`kill &lt;PID&gt;`\n\n**&#x5728; java &#x4e2d;&#x67e5;&#x770b;&#x8fdb;&#x7a0b;&#x7684;&#x547d;&#x4ee4;&#xff1a;** \n\n*   &#x67e5;&#x770b;Java&#x8fdb;&#x7a0b;&#xff1a;`jps`\n*   &#x67e5;&#x770b;Java&#x7ebf;&#x7a0b;&#xff1a;`jstack &lt;PID&gt;`\n*   &#x56fe;&#x5f62;&#x5316;&#x7684;&#x5de5;&#x5177;&#xff1a;`jconsole`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5,25"}}],"payload":{"tag":"h2","lines":"2,4"}},{"content":"1.2&#x3001;&#x5e76;&#x884c;&#x4e0e;&#x5e76;&#x53d1;","children":[{"content":"<pre data-lines=\"29,32\"><code>&#x5355;&#x6838; CPU &#x4e0b;&#xff0c;&#x7ebf;&#x7a0b;&#x5b9e;&#x9645;&#x8fd8;&#x662f; **&#x4e32;&#x884c;&#x6267;&#x884c;** &#x7684;&#x3002;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x4e2d;&#x6709;&#x4e00;&#x4e2a;&#x7ec4;&#x4ef6;&#x53eb;&#x505a;&#x4efb;&#x52a1;&#x8c03;&#x5ea6;&#x5668;&#xff0c;&#x5c06; CPU &#x7684;&#x65f6;&#x95f4;&#x7247;&#xff08;windows&#x4e0b;&#x65f6;&#x95f4;&#x7247;&#x6700;&#x5c0f;&#x7ea6;&#x4e3a; 15 &#x6beb;&#x79d2;&#xff09;&#x5206;&#x7ed9;&#x4e0d;&#x540c;&#x7684;&#x7a0b;&#x5e8f;&#x4f7f;&#x7528;&#xff0c;&#x53ea;&#x662f;&#x7531;&#x4e8e; CPU &#x5728;&#x7ebf;&#x7a0b;&#x95f4;&#x7684;&#x5207;&#x6362;&#x975e;&#x5e38;&#x5feb;&#xff0c;&#x4eba;&#x7c7b;&#x611f;&#x89c9;&#x662f;&#x540c;&#x65f6;&#x8fd0;&#x884c;&#x7684; &#x3002;&#x603b;&#x7ed3;&#x4e3a;&#x4e00;&#x53e5;&#x8bdd;&#x5c31;&#x662f;&#xff1a;&#x5fae;&#x89c2;&#x4e32;&#x884c;&#xff0c;&#x5b8f;&#x89c2;&#x5e76;&#x884c;&#xff0c;&#x4e00;&#x822c;&#x4f1a;&#x5c06;&#x8fd9;&#x79cd;&#x7ebf;&#x7a0b;&#x8f6e;&#x6d41;&#x4f7f;&#x7528; CPU &#x7684;&#x505a;&#x6cd5;&#x79f0;&#x4e3a;&#x5e76;&#x53d1;&#xff08;Concurrent&#xff09;&#x3002;\n\n&#x591a;&#x6838; CPU&#x4e0b;&#xff0c;&#x6bcf;&#x4e2a;&#x6838;&#x90fd;&#x53ef;&#x4ee5;&#x8c03;&#x5ea6;&#x8fd0;&#x884c;&#x7ebf;&#x7a0b;&#xff0c;&#x8fd9;&#x65f6;&#x5019;&#x7ebf;&#x7a0b;&#x53ef;&#x4ee5;&#x662f;&#x5e76;&#x884c;&#xff08;Parallel&#xff09;&#x7684;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"29,32"}}],"payload":{"tag":"h2","lines":"26,28"}},{"content":"1.3&#x3001;&#x540c;&#x6b65;&#x4e0e;&#x5f02;&#x6b65;","children":[{"content":"<pre data-lines=\"36,40\"><code>&#x4ee5;&#x8c03;&#x7528;&#x65b9;&#x89d2;&#x5ea6;&#x6765;&#x8bb2;&#xff1a;\n\n*   &#x9700;&#x8981;&#x7b49;&#x5f85;&#x7ed3;&#x679c;&#x8fd4;&#x56de;&#x540e;&#x624d;&#x80fd;&#x7ee7;&#x7eed;&#x8fd0;&#x884c;&#x5c31;&#x662f;&#x540c;&#x6b65;&#x3002;\n*   &#x4e0d;&#x9700;&#x8981;&#x7b49;&#x5f85;&#x7ed3;&#x679c;&#x8fd4;&#x56de;&#x5c31;&#x80fd;&#x7ee7;&#x7eed;&#x8fd0;&#x884c;&#x5c31;&#x662f;&#x5f02;&#x6b65;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"36,40"}}],"payload":{"tag":"h2","lines":"33,35"}},{"content":"1.4&#x3001;&#x7ebf;&#x7a0b;&#x521b;&#x5efa;&#x65b9;&#x5f0f;","children":[{"content":"<pre data-lines=\"46,57\"><code class=\"language-java\"><span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">thread</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(){\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">run</span><span class=\"hljs-params\">()</span> {\n        System.out.println(<span class=\"hljs-string\">&quot;thread run ...&quot;</span>);\n    }\n};\n\nthread.start();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"46,57"}},{"content":"<pre data-lines=\"60,66\"><code class=\"language-java\"><span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">thread</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; System.out.println(<span class=\"hljs-string\">&quot;thread run ...&quot;</span>));\n\nthread.start();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"60,66"}},{"content":"<pre data-lines=\"67,68\"><code>*   **&#x65b9;&#x5f0f;&#x4e8c;&#xff1a;** \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"67,68"}},{"content":"<pre data-lines=\"69,80\"><code class=\"language-java\"><span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">thread</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Runnable</span>() {\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">run</span><span class=\"hljs-params\">()</span> {\n        System.out.println(<span class=\"hljs-string\">&quot;runnable run ...&quot;</span>);\n    }\n});\n\nthread.start();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"69,80"}},{"content":"<pre data-lines=\"81,82\"><code>&#x7b80;&#x5316;&#x540e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"81,82"}},{"content":"<pre data-lines=\"83,89\"><code class=\"language-java\"><span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">thread</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; System.out.println(<span class=\"hljs-string\">&quot;runnable run ...&quot;</span>));\n\nthread.start();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"83,89"}},{"content":"<pre data-lines=\"90,91\"><code>*   **&#x65b9;&#x5f0f;&#x4e09;&#xff1a;** \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"90,91"}},{"content":"<pre data-lines=\"92,105\"><code class=\"language-java\">Callable&lt;Integer&gt; callable = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Callable</span>() {\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title function_\">call</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        System.out.println(<span class=\"hljs-string\">&quot;callable run ...&quot;</span>);\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">521</span>;\n    }\n};\n<span class=\"hljs-type\">FutureTask</span> <span class=\"hljs-variable\">futureTask</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FutureTask</span>(callable);\n<span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">thread</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(futureTask);\nthread.start();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"92,105"}},{"content":"<pre data-lines=\"106,107\"><code>&#x7b80;&#x5316;&#x540e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"106,107"}},{"content":"<pre data-lines=\"108,117\"><code class=\"language-java\"><span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">thread</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FutureTask</span>(() -&gt; {\n    System.out.println(<span class=\"hljs-string\">&quot;callable run ...&quot;</span>);\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">521</span>;\n}));\n\nthread.start();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"108,117"}}],"payload":{"tag":"h2","lines":"41,43"}},{"content":"1.5&#x3001;&#x7ebf;&#x7a0b;&#x57fa;&#x672c;&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"121,122\"><code>&gt; ps&#xff1a;&#x6807;&#x9ec4;&#x8272;&#x7684;&#x65b9;&#x6cd5;&#x4ee3;&#x8868;&#x662f; `static` &#x65b9;&#x6cd5;&#xff0c;&#x53ef;&#x76f4;&#x63a5;&#x7c7b;&#x540d;&#x8c03;&#x7528;&#xff0c;&#x65e0;&#x9700;&#x521b;&#x5efa;&#x5bf9;&#x8c61;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"121,122"}},{"content":"<table data-lines=\"123,162\">\n<thead data-lines=\"123,124\">\n<tr data-lines=\"123,124\">\n<th>&#x65b9;&#x6cd5;&#x540d;&#x79f0;</th>\n<th>&#x65b9;&#x6cd5;&#x63cf;&#x8ff0;</th>\n<th>&#x6ce8;&#x610f;&#x4e8b;&#x9879;</th>\n</tr>\n</thead>\n<tbody data-lines=\"125,162\">\n<tr data-lines=\"125,126\">\n<td>start()</td>\n<td>&#x542f;&#x52a8;&#x4e00;&#x4e2a;&#x65b0;&#x7ebf;&#x7a0b;&#xff0c;</td>\n<td></td>\n</tr>\n<tr data-lines=\"126,127\">\n<td>&#x5728;&#x65b0;&#x7684;&#x7ebf;&#x7a0b;&#x8fd0;&#x884c; run &#x65b9;&#x6cd5;</td>\n<td>start &#x65b9;&#x6cd5;&#x53ea;&#x662f;&#x8ba9;&#x7ebf;&#x7a0b;&#x8fdb;&#x5165;&#x5c31;&#x7eea;&#xff0c;&#x91cc;&#x9762;&#x4ee3;&#x7801;&#x4e0d;&#x4e00;&#x5b9a;&#x7acb;&#x523b;</td>\n<td></td>\n</tr>\n<tr data-lines=\"127,128\">\n<td>&#x8fd0;&#x884c;&#xff08;CPU &#x7684;&#x65f6;&#x95f4;&#x7247;&#x8fd8;&#x6ca1;&#x5206;&#x7ed9;&#x5b83;&#xff09;&#x3002;&#x6bcf;&#x4e2a;&#x7ebf;&#x7a0b;&#x5bf9;&#x8c61;&#x7684;</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"128,129\">\n<td>start&#x65b9;&#x6cd5;&#x53ea;&#x80fd;&#x8c03;&#x7528;&#x4e00;&#x6b21;&#xff0c;&#x5982;&#x679c;&#x8c03;&#x7528;&#x4e86;&#x591a;&#x6b21;&#x4f1a;&#x51fa;&#x73b0;</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"129,130\">\n<td>IllegalThreadStateException</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"130,131\">\n<td>run()</td>\n<td>&#x65b0;&#x7ebf;&#x7a0b;&#x542f;&#x52a8;&#x540e;&#x4f1a;&#x8c03;&#x7528;&#x7684;&#x65b9;&#x6cd5;</td>\n<td>&#x5982;&#x679c;&#x5728;&#x6784;&#x9020; Thread &#x5bf9;&#x8c61;&#x65f6;&#x4f20;&#x9012;&#x4e86; Runnable &#x53c2;&#x6570;&#xff0c;&#x5219;</td>\n</tr>\n<tr data-lines=\"131,132\">\n<td>&#x7ebf;&#x7a0b;&#x542f;&#x52a8;&#x540e;&#x4f1a;&#x8c03;&#x7528; Runnable &#x4e2d;&#x7684; run &#x65b9;&#x6cd5;&#xff0c;&#x5426;&#x5219;&#x9ed8;</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"132,133\">\n<td>&#x8ba4;&#x4e0d;&#x6267;&#x884c;&#x4efb;&#x4f55;&#x64cd;&#x4f5c;&#x3002;&#x4f46;&#x53ef;&#x4ee5;&#x521b;&#x5efa; Thread &#x7684;&#x5b50;&#x7c7b;&#x5bf9;&#x8c61;&#xff0c;</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"133,134\">\n<td>&#x6765;&#x8986;&#x76d6;&#x9ed8;&#x8ba4;&#x884c;&#x4e3a;</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"134,135\">\n<td>join()</td>\n<td>&#x7b49;&#x5f85;&#x7ebf;&#x7a0b;&#x8fd0;&#x884c;&#x7ed3;&#x675f;</td>\n<td></td>\n</tr>\n<tr data-lines=\"135,136\">\n<td>join(long n)</td>\n<td>&#x7b49;&#x5f85;&#x7ebf;&#x7a0b;&#x8fd0;&#x884c;&#x7ed3;&#x675f;&#xff0c;</td>\n<td></td>\n</tr>\n<tr data-lines=\"136,137\">\n<td>&#x6700;&#x591a;&#x7b49;&#x5f85; n &#x6beb;&#x79d2;</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"137,138\">\n<td>getId()</td>\n<td>&#x83b7;&#x53d6;&#x7ebf;&#x7a0b;&#x957f;&#x6574;&#x578b;&#x7684; id</td>\n<td>id &#x552f;&#x4e00;</td>\n</tr>\n<tr data-lines=\"138,139\">\n<td>getName()</td>\n<td>&#x83b7;&#x53d6;&#x7ebf;&#x7a0b;&#x540d;</td>\n<td></td>\n</tr>\n<tr data-lines=\"139,140\">\n<td>setName(String name)</td>\n<td>&#x4fee;&#x6539;&#x7ebf;&#x7a0b;&#x540d;</td>\n<td></td>\n</tr>\n<tr data-lines=\"140,141\">\n<td>getPriority()</td>\n<td>&#x83b7;&#x53d6;&#x7ebf;&#x7a0b;&#x4f18;&#x5148;&#x7ea7;</td>\n<td></td>\n</tr>\n<tr data-lines=\"141,142\">\n<td>setPriority(int priority)</td>\n<td>&#x4fee;&#x6539;&#x7ebf;&#x7a0b;&#x4f18;&#x5148;&#x7ea7;</td>\n<td>Java &#x4e2d;&#x89c4;&#x5b9a;&#x7ebf;&#x7a0b;&#x4f18;&#x5148;&#x7ea7;&#x662f;1~10 &#x7684;&#x6574;&#x6570;&#xff0c;&#x8f83;&#x5927;&#x7684;&#x4f18;&#x5148;&#x7ea7;</td>\n</tr>\n<tr data-lines=\"142,143\">\n<td>&#x80fd;&#x63d0;&#x9ad8;&#x8be5;&#x7ebf;&#x7a0b;&#x88ab; CPU &#x8c03;&#x5ea6;&#x7684;&#x673a;&#x7387;</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"143,144\">\n<td>getState()</td>\n<td>&#x83b7;&#x53d6;&#x7ebf;&#x7a0b;&#x72b6;&#x6001;</td>\n<td>Java &#x4e2d;&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#x662f;&#x7528; 6 &#x4e2a; enum &#x8868;&#x793a;&#xff0c;&#x5206;&#x522b;&#x4e3a;&#xff1a;</td>\n</tr>\n<tr data-lines=\"144,145\">\n<td>NEW, RUNNABLE, BLOCKED, WAITING,</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"145,146\">\n<td>TIMED_WAITING, TERMINATED</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"146,147\">\n<td>interrupt()</td>\n<td>&#x6253;&#x65ad;&#x7ebf;&#x7a0b;</td>\n<td>&#x5982;&#x679c;&#x88ab;&#x6253;&#x65ad;&#x7ebf;&#x7a0b;&#x6b63;&#x5728; sleep&#xff0c;wait&#xff0c;join &#x4f1a;&#x5bfc;&#x81f4;&#x88ab;</td>\n</tr>\n<tr data-lines=\"147,148\">\n<td>&#x6253;&#x65ad;&#x7684;&#x7ebf;&#x7a0b;&#x629b;&#x51fa; InterruptedException&#xff0c;&#x5e76;&#x6e05;&#x9664;</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"148,149\">\n<td>&#x6253;&#x65ad;&#x6807;&#x8bb0;&#xff1b;&#x5982;&#x679c;&#x6253;&#x65ad;&#x6b63;&#x5728;&#x8fd0;&#x884c;&#x7684;&#x7ebf;&#x7a0b;&#xff0c;&#x5219;&#x4f1a;&#x8bbe;&#x7f6e;</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"149,150\">\n<td>&#x6253;&#x65ad;&#x6807;&#x8bb0;&#xff1b;park &#x7684;&#x7ebf;&#x7a0b;&#x88ab;&#x6253;&#x65ad;&#xff0c;&#x4e5f;&#x4f1a;&#x8bbe;&#x7f6e;&#x6253;&#x65ad;&#x6807;&#x8bb0;</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"150,151\">\n<td>interrupted()</td>\n<td>&#x5224;&#x65ad;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x662f;&#x5426;&#x88ab;&#x6253;&#x65ad;</td>\n<td>&#x4f1a;&#x6e05;&#x9664;&#x6253;&#x65ad;&#x6807;&#x8bb0;</td>\n</tr>\n<tr data-lines=\"151,152\">\n<td>isInterrupted()</td>\n<td>&#x5224;&#x65ad;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x662f;&#x5426;&#x88ab;&#x6253;&#x65ad;</td>\n<td>&#x4e0d;&#x4f1a;&#x6e05;&#x9664;&#x6253;&#x65ad;&#x6807;&#x8bb0;</td>\n</tr>\n<tr data-lines=\"152,153\">\n<td>isAlive()</td>\n<td>&#x5224;&#x65ad;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x662f;&#x5426;&#x5b58;&#x6d3b;</td>\n<td></td>\n</tr>\n<tr data-lines=\"153,154\">\n<td>isDaemon()</td>\n<td>&#x5224;&#x65ad;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x662f;&#x5426;&#x662f;&#x5b88;&#x62a4;&#x7ebf;&#x7a0b;</td>\n<td></td>\n</tr>\n<tr data-lines=\"154,155\">\n<td>setDaemon(boolean on)</td>\n<td>&#x8bbe;&#x7f6e;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x4e3a;&#x5b88;&#x62a4;&#x7ebf;&#x7a0b;</td>\n<td></td>\n</tr>\n<tr data-lines=\"155,156\">\n<td>currentThread()</td>\n<td>&#x83b7;&#x53d6;&#x5f53;&#x524d;&#x6b63;&#x5728;&#x6267;&#x884c;&#x7684;&#x7ebf;&#x7a0b;</td>\n<td></td>\n</tr>\n<tr data-lines=\"156,157\">\n<td>sleep(long n)</td>\n<td>&#x8ba9;&#x5f53;&#x524d;&#x6267;&#x884c;&#x7684;&#x7ebf;&#x7a0b;&#x4f11;&#x7720;n&#x6beb;&#x79d2;&#xff0c;</td>\n<td></td>\n</tr>\n<tr data-lines=\"157,158\">\n<td>&#x4f11;&#x7720;&#x65f6;&#x8ba9;&#x51fa; CPU &#x7684;&#x65f6;&#x95f4;&#x7247;</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"158,159\">\n<td>&#x7ed9;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;</td>\n<td></td>\n<td></td>\n</tr>\n<tr data-lines=\"159,160\">\n<td>yield()</td>\n<td>&#x63d0;&#x793a;&#x7ebf;&#x7a0b;&#x8c03;&#x5ea6;&#x5668;&#x8ba9;&#x51fa;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;</td>\n<td></td>\n</tr>\n<tr data-lines=\"160,161\">\n<td>&#x5bf9; CPU &#x7684;&#x4f7f;&#x7528;</td>\n<td>&#x4e3b;&#x8981;&#x662f;&#x4e3a;&#x4e86;&#x6d4b;&#x8bd5;&#x548c;&#x8c03;&#x8bd5;&#xff0c;&#x5b83;&#x7684;&#x5177;&#x4f53;&#x7684;&#x5b9e;&#x73b0;&#x4f9d;&#x8d56;&#x4e8e;</td>\n<td></td>\n</tr>\n<tr data-lines=\"161,162\">\n<td>&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x7684;&#x4efb;&#x52a1;&#x8c03;&#x5ea6;&#x5668;</td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"123,162"}}],"payload":{"tag":"h2","lines":"118,120"}},{"content":"1.6&#x3001;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;&#x95ee;&#x9898;","children":[{"content":"<pre data-lines=\"166,167\"><code>&#x4e24;&#x4e2a;&#x7ebf;&#x7a0b;&#x5bf9;&#x521d;&#x59cb;&#x503c;&#x4e3a; 0 &#x7684;&#x9759;&#x6001;&#x53d8;&#x91cf;&#x4e00;&#x4e2a;&#x505a;&#x81ea;&#x589e;&#xff0c;&#x4e00;&#x4e2a;&#x505a;&#x81ea;&#x51cf;&#xff0c;&#x5404;&#x505a; 5000 &#x6b21;&#xff0c;&#x7ed3;&#x679c;&#x662f; 0 &#x5417;&#xff1f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"166,167"}},{"content":"<pre data-lines=\"168,190\"><code class=\"language-java\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">counter</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n    <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">5000</span>; i++) {\n            counter++;\n        }\n    }, <span class=\"hljs-string\">&quot;t1&quot;</span>);\n    <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t2</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">5000</span>; i++) {\n            counter--;\n        }\n    }, <span class=\"hljs-string\">&quot;t2&quot;</span>);\n    t1.start();\n    t2.start();\n    t1.join();\n    t2.join();\n    log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, counter);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"168,190"}},{"content":"<pre data-lines=\"191,194\"><code>&#x4ee5;&#x4e0a;&#x7684;&#x7ed3;&#x679c;&#x53ef;&#x80fd;&#x662f;&#x6b63;&#x6570;&#x3001;&#x8d1f;&#x6570;&#x3001;&#x96f6;&#x3002;&#x56e0;&#x4e3a; Java &#x4e2d;&#x5bf9;&#x9759;&#x6001;&#x53d8;&#x91cf;&#x7684;&#x81ea;&#x589e;&#xff0c;&#x81ea;&#x51cf;&#x5e76;&#x4e0d;&#x662f;&#x539f;&#x5b50;&#x64cd;&#x4f5c;&#xff0c;&#x8981;&#x5f7b;&#x5e95;&#x7406;&#x89e3;&#xff0c;&#x5fc5;&#x987b;&#x4ece;&#x5b57;&#x8282;&#x7801;&#x6765;&#x8fdb;&#x884c;&#x5206;&#x6790;&#x3002;\n\n&#x5bf9;&#x4e8e; i++ &#x800c;&#x8a00;&#xff08;i &#x4e3a;&#x9759;&#x6001;&#x53d8;&#x91cf;&#xff09;&#xff0c;&#x5b9e;&#x9645;&#x4f1a;&#x4ea7;&#x751f;&#x5982;&#x4e0b;&#x7684; JVM &#x5b57;&#x8282;&#x7801;&#x6307;&#x4ee4;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"191,194"}},{"content":"<pre data-lines=\"195,202\"><code class=\"language-java\">getstatic i \niconst_1 \t\niadd \t\t\nputstatic i \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"195,202"}},{"content":"<pre data-lines=\"203,204\"><code>&#x5bf9;&#x4e8e; i-- &#x800c;&#x8a00;&#xff08;i &#x4e3a;&#x9759;&#x6001;&#x53d8;&#x91cf;&#xff09;&#xff0c;&#x5b9e;&#x9645;&#x4f1a;&#x4ea7;&#x751f;&#x5982;&#x4e0b;&#x7684; JVM &#x5b57;&#x8282;&#x7801;&#x6307;&#x4ee4;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"203,204"}},{"content":"<pre data-lines=\"205,212\"><code class=\"language-java\">getstatic i \niconst_1 \t\nisub \t\t\nputstatic i \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"205,212"}},{"content":"<pre data-lines=\"213,214\"><code>&#x800c; Java &#x7684;&#x5185;&#x5b58;&#x6a21;&#x578b;&#x5982;&#x4e0b;&#xff0c;&#x5b8c;&#x6210;&#x9759;&#x6001;&#x53d8;&#x91cf;&#x7684;&#x81ea;&#x589e;&#xff0c;&#x81ea;&#x51cf;&#x9700;&#x8981;&#x5728;&#x4e3b;&#x5b58;&#x548c;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e2d;&#x8fdb;&#x884c;&#x6570;&#x636e;&#x4ea4;&#x6362;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"213,214"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/172aef8e7c45edecd978adb46a30ddfe.png\" alt>","children":[],"payload":{"tag":"img","lines":"215,216"}},{"content":"<pre data-lines=\"217,218\"><code>&#x5982;&#x679c;&#x662f;&#x5355;&#x7ebf;&#x7a0b;&#x4ee5;&#x4e0a; 8 &#x884c;&#x4ee3;&#x7801;&#x662f;&#x987a;&#x5e8f;&#x6267;&#x884c;&#xff08;&#x4e0d;&#x4f1a;&#x4ea4;&#x9519;&#xff09;&#x6ca1;&#x6709;&#x95ee;&#x9898;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"217,218"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b2946516dd5b5aa270ee3b79337afe8a.png\" alt>","children":[],"payload":{"tag":"img","lines":"219,220"}},{"content":"<pre data-lines=\"221,224\"><code>&#x4f46;&#x591a;&#x7ebf;&#x7a0b;&#x4e0b;&#x8fd9; 8 &#x884c;&#x4ee3;&#x7801;&#x53ef;&#x80fd;&#x4ea4;&#x9519;&#x8fd0;&#x884c;&#xff1a;\n\n&#x51fa;&#x73b0;&#x8d1f;&#x6570;&#x7684;&#x60c5;&#x51b5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"221,224"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/6c5ee60cd2daa9eb8e1eacaf28abc0a4.png\" alt>","children":[],"payload":{"tag":"img","lines":"225,226"}},{"content":"<pre data-lines=\"227,228\"><code>&#x51fa;&#x73b0;&#x6b63;&#x6570;&#x7684;&#x60c5;&#x51b5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"227,228"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/d015a5c082be1b1ab2409c7673d68111.png\" alt>","children":[],"payload":{"tag":"img","lines":"229,230"}},{"content":"<pre data-lines=\"231,239\"><code>&#x4e00;&#x4e2a;&#x7a0b;&#x5e8f;&#x8fd0;&#x884c;&#x591a;&#x4e2a;&#x7ebf;&#x7a0b;&#x672c;&#x8eab;&#x662f;&#x6ca1;&#x6709;&#x95ee;&#x9898;&#x7684;&#xff0c;&#x95ee;&#x9898;&#x51fa;&#x73b0;&#x5728;&#x591a;&#x4e2a;&#x7ebf;&#x7a0b;&#x8bbf;&#x95ee;&#x5171;&#x4eab;&#x8d44;&#x6e90;&#xff1a;\n\n*   &#x591a;&#x4e2a;&#x7ebf;&#x7a0b;&#x8bfb;&#x5171;&#x4eab;&#x8d44;&#x6e90;&#x5176;&#x5b9e;&#x4e5f;&#x6ca1;&#x6709;&#x95ee;&#x9898;\n*   &#x5728;&#x591a;&#x4e2a;&#x7ebf;&#x7a0b;&#x5bf9;&#x5171;&#x4eab;&#x8d44;&#x6e90;&#x8bfb;&#x5199;&#x64cd;&#x4f5c;&#x65f6;&#x53d1;&#x751f;&#x6307;&#x4ee4;&#x4ea4;&#x9519;&#xff0c;&#x5c31;&#x4f1a;&#x51fa;&#x73b0;&#x95ee;&#x9898;\n\n&#x4e00;&#x6bb5;&#x4ee3;&#x7801;&#x5757;&#x5185;&#x5982;&#x679c;&#x5b58;&#x5728;&#x5bf9;&#x5171;&#x4eab;&#x8d44;&#x6e90;&#x7684;&#x591a;&#x7ebf;&#x7a0b;&#x8bfb;&#x5199;&#x64cd;&#x4f5c;&#xff0c;&#x79f0;&#x8fd9;&#x6bb5;&#x4ee3;&#x7801;&#x5757;&#x4e3a;&#x4e34;&#x754c;&#x533a;&#xff08;Critical Section&#xff09;\n\n&#x4f8b;&#x5982;&#xff0c;&#x4e0b;&#x9762;&#x4ee3;&#x7801;&#x4e2d;&#x7684;&#x4e34;&#x754c;&#x533a;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"231,239"}},{"content":"<pre data-lines=\"240,256\"><code class=\"language-java\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">counter</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n\n<span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">increment</span><span class=\"hljs-params\">()</span>\n\n{\n\tcounter++;\n}\n\n<span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">decrement</span><span class=\"hljs-params\">()</span>\n\n{\n\tcounter--;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"240,256"}},{"content":"<pre data-lines=\"257,272\"><code>&#x591a;&#x4e2a;&#x7ebf;&#x7a0b;&#x5728;&#x4e34;&#x754c;&#x533a;&#x5185;&#x6267;&#x884c;&#xff0c;&#x7531;&#x4e8e;&#x4ee3;&#x7801;&#x7684;&#x6267;&#x884c;&#x5e8f;&#x5217;&#x4e0d;&#x540c;&#x800c;&#x5bfc;&#x81f4;&#x7ed3;&#x679c;&#x65e0;&#x6cd5;&#x9884;&#x6d4b;&#xff0c;&#x79f0;&#x4e4b;&#x4e3a;&#x53d1;&#x751f;&#x4e86;&#x7ade;&#x6001;&#x6761;&#x4ef6;&#xff08;Race Condition&#xff09;\n\n&#x4e3a;&#x4e86;&#x907f;&#x514d;&#x4e34;&#x754c;&#x533a;&#x7684;&#x7ade;&#x6001;&#x6761;&#x4ef6;&#x53d1;&#x751f;&#xff0c;&#x6709;&#x591a;&#x79cd;&#x624b;&#x6bb5;&#x53ef;&#x4ee5;&#x8fbe;&#x5230;&#x76ee;&#x7684;&#x3002;\n\n*   &#x963b;&#x585e;&#x5f0f;&#x7684;&#x89e3;&#x51b3;&#x65b9;&#x6848;&#xff1a;synchronized&#xff0c;Lock\n*   &#x975e;&#x963b;&#x585e;&#x5f0f;&#x7684;&#x89e3;&#x51b3;&#x65b9;&#x6848;&#xff1a;&#x539f;&#x5b50;&#x53d8;&#x91cf;\n\n&#x6211;&#x4eec;&#x4f7f;&#x7528;&#x963b;&#x585e;&#x5f0f;&#x7684;&#x89e3;&#x51b3;&#x65b9;&#x6848;&#xff1a;synchronized&#xff0c;&#x6765;&#x89e3;&#x51b3;&#x4e0a;&#x8ff0;&#x95ee;&#x9898;&#xff0c;&#x5373;&#x4fd7;&#x79f0;&#x7684;&#x3010;&#x5bf9;&#x8c61;&#x9501;&#x3011;&#xff0c;&#x5b83;&#x91c7;&#x7528;&#x4e92;&#x65a5;&#x7684;&#x65b9;&#x5f0f;&#x8ba9;&#x540c;&#x4e00;&#x65f6;&#x523b;&#x81f3;&#x591a;&#x53ea;&#x6709;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x80fd;&#x6301;&#x6709;&#x3010;&#x5bf9;&#x8c61;&#x9501;&#x3011;&#xff0c;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x518d;&#x60f3;&#x83b7;&#x53d6;&#x8fd9;&#x4e2a;&#x3010;&#x5bf9;&#x8c61;&#x9501;&#x3011;&#x65f6;&#x5c31;&#x4f1a;&#x963b;&#x585e;&#x4f4f;&#x3002;&#x8fd9;&#x6837;&#x5c31;&#x80fd;&#x4fdd;&#x8bc1;&#x62e5;&#x6709;&#x9501;&#x7684;&#x7ebf;&#x7a0b;&#x53ef;&#x4ee5;&#x5b89;&#x5168;&#x7684;&#x6267;&#x884c;&#x4e34;&#x754c;&#x533a;&#x5185;&#x7684;&#x4ee3;&#x7801;&#xff0c;&#x4e0d;&#x7528;&#x62c5;&#x5fc3;&#x7ebf;&#x7a0b;&#x4e0a;&#x4e0b;&#x6587;&#x5207;&#x6362;&#xff0c;&#x4ee5;&#x6b64;&#x907f;&#x514d;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;&#x95ee;&#x9898;&#x3002;\n\n&#x867d;&#x7136; Java &#x4e2d;&#x4e92;&#x65a5;&#x548c;&#x540c;&#x6b65;&#x90fd;&#x53ef;&#x4ee5;&#x91c7;&#x7528; synchronized &#x5173;&#x952e;&#x5b57;&#x6765;&#x5b8c;&#x6210;&#xff0c;&#x4f46;&#x5b83;&#x4eec;&#x8fd8;&#x662f;&#x6709;&#x533a;&#x522b;&#x7684;&#xff1a;\n\n*   &#x4e92;&#x65a5;&#x662f;&#x4fdd;&#x8bc1;&#x4e34;&#x754c;&#x533a;&#x7684;&#x7ade;&#x6001;&#x6761;&#x4ef6;&#x53d1;&#x751f;&#xff0c;&#x540c;&#x4e00;&#x65f6;&#x523b;&#x53ea;&#x80fd;&#x6709;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x6267;&#x884c;&#x4e34;&#x754c;&#x533a;&#x4ee3;&#x7801;\n*   &#x540c;&#x6b65;&#x662f;&#x7531;&#x4e8e;&#x7ebf;&#x7a0b;&#x6267;&#x884c;&#x7684;&#x5148;&#x540e;&#x3001;&#x987a;&#x5e8f;&#x4e0d;&#x540c;&#x3001;&#x9700;&#x8981;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x7b49;&#x5f85;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x8fd0;&#x884c;&#x5230;&#x67d0;&#x4e2a;&#x70b9;\n\nsynchronized&#x7684;&#x8bed;&#x6cd5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"257,272"}},{"content":"<pre data-lines=\"273,280\"><code class=\"language-java\"><span class=\"hljs-keyword\">synchronized</span>(&#x5bf9;&#x8c61;)\n{\n\t&#x4e34;&#x754c;&#x533a;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"273,280"}},{"content":"<pre data-lines=\"281,282\"><code>synchronized&#x6539;&#x8fdb;&#x540e;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"281,282"}},{"content":"<pre data-lines=\"283,310\"><code class=\"language-java\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">counter</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n<span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">Object</span> <span class=\"hljs-variable\">room</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Object</span>();\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n    <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">5000</span>; i++) {\n            <span class=\"hljs-keyword\">synchronized</span> (room) {\n                counter++;\n            }\n        }\n    }, <span class=\"hljs-string\">&quot;t1&quot;</span>);\n    <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t2</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">5000</span>; i++) {\n            <span class=\"hljs-keyword\">synchronized</span> (room) {\n                counter--;\n            }\n        }\n    }, <span class=\"hljs-string\">&quot;t2&quot;</span>);\n    t1.start();\n    t2.start();\n    t1.join();\n    t2.join();\n    log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, counter);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"283,310"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/40c8d108bfc07340a8b14cf3d91e8b50.png\" alt>","children":[],"payload":{"tag":"img","lines":"311,312"}},{"content":"<pre data-lines=\"313,316\"><code>synchronized &#x5b9e;&#x9645;&#x662f;&#x7528;&#x5bf9;&#x8c61;&#x9501;&#x4fdd;&#x8bc1;&#x4e86;&#x4e34;&#x754c;&#x533a;&#x5185;&#x4ee3;&#x7801;&#x7684;&#x539f;&#x5b50;&#x6027;&#xff0c;&#x4e34;&#x754c;&#x533a;&#x5185;&#x7684;&#x4ee3;&#x7801;&#x5bf9;&#x5916;&#x662f;&#x4e0d;&#x53ef;&#x5206;&#x5272;&#x7684;&#xff0c;&#x4e0d;&#x4f1a;&#x88ab;&#x7ebf;&#x7a0b;&#x5207;&#x6362;&#x6240;&#x6253;&#x65ad;&#x3002;\n\n&#x65b9;&#x6cd5;&#x4e0a;&#x7684; synchronized\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"313,316"}},{"content":"<pre data-lines=\"317,331\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test</span>{\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">synchronized</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">test</span><span class=\"hljs-params\">()</span> {\n    }\n}\n&#x7b49;&#x4ef7;&#x4e8e;\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test</span>{\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">test</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">synchronized</span>(<span class=\"hljs-built_in\">this</span>) {\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"317,331"}},{"content":"<pre data-lines=\"332,346\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test</span>{\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">synchronized</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">test</span><span class=\"hljs-params\">()</span> {\n    }\n}\n&#x7b49;&#x4ef7;&#x4e8e;\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test</span>{\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">test</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">synchronized</span>(Test.class) {\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"332,346"}},{"content":"<pre data-lines=\"347,360\"><code>&#x6210;&#x5458;&#x53d8;&#x91cf;&#x548c;&#x9759;&#x6001;&#x53d8;&#x91cf;&#x662f;&#x5426;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;&#xff1f;\n\n*   &#x5982;&#x679c;&#x5b83;&#x4eec;&#x6ca1;&#x6709;&#x5171;&#x4eab;&#xff0c;&#x5219;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;\n*   &#x5982;&#x679c;&#x5b83;&#x4eec;&#x88ab;&#x5171;&#x4eab;&#x4e86;&#xff0c;&#x6839;&#x636e;&#x5b83;&#x4eec;&#x7684;&#x72b6;&#x6001;&#x662f;&#x5426;&#x80fd;&#x591f;&#x6539;&#x53d8;&#xff0c;&#x53c8;&#x5206;&#x4e24;&#x79cd;&#x60c5;&#x51b5;\n    *   &#x5982;&#x679c;&#x53ea;&#x6709;&#x8bfb;&#x64cd;&#x4f5c;&#xff0c;&#x5219;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;\n    *   &#x5982;&#x679c;&#x6709;&#x8bfb;&#x5199;&#x64cd;&#x4f5c;&#xff0c;&#x5219;&#x8fd9;&#x6bb5;&#x4ee3;&#x7801;&#x662f;&#x4e34;&#x754c;&#x533a;&#xff0c;&#x9700;&#x8981;&#x8003;&#x8651;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;\n\n&#x5c40;&#x90e8;&#x53d8;&#x91cf;&#x662f;&#x5426;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;&#xff1f;\n\n*   &#x5c40;&#x90e8;&#x53d8;&#x91cf;&#x662f;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;&#x7684;\n*   &#x4f46;&#x5c40;&#x90e8;&#x53d8;&#x91cf;&#x5f15;&#x7528;&#x7684;&#x5bf9;&#x8c61;&#x5219;&#x672a;&#x5fc5;\n    *   &#x5982;&#x679c;&#x8be5;&#x5bf9;&#x8c61;&#x6ca1;&#x6709;&#x9003;&#x79bb;&#x65b9;&#x6cd5;&#x7684;&#x4f5c;&#x7528;&#x8bbf;&#x95ee;&#xff0c;&#x5b83;&#x662f;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;&#x7684;\n    *   &#x5982;&#x679c;&#x8be5;&#x5bf9;&#x8c61;&#x9003;&#x79bb;&#x65b9;&#x6cd5;&#x7684;&#x4f5c;&#x7528;&#x8303;&#x56f4;&#xff0c;&#x9700;&#x8981;&#x8003;&#x8651;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"347,360"}}],"payload":{"tag":"h2","lines":"163,165"}},{"content":"1.7&#x3001;&#x7ebf;&#x7a0b;&#x516b;&#x9501;&#x95ee;&#x9898;","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/5ed6ff3188b10edcc22c7e1d2a2f5f44.png\" alt>","children":[],"payload":{"tag":"img","lines":"364,365"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1ad92faaaca6005de26248db191be508.png\" alt>","children":[],"payload":{"tag":"img","lines":"366,367"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/dda23035130ea5d7e4479a3c60905aaf.png\" alt>","children":[],"payload":{"tag":"img","lines":"368,369"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/7c829f7791958a2656deedf08352022c.png\" alt>","children":[],"payload":{"tag":"img","lines":"370,371"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/85cef48688797eeb2144863554314131.png\" alt>","children":[],"payload":{"tag":"img","lines":"372,373"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/fbddd721152a0da9e493ba988a1f8471.png\" alt>","children":[],"payload":{"tag":"img","lines":"374,375"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/697b0c332cf0ab3e3591e26138173f5b.png\" alt>","children":[],"payload":{"tag":"img","lines":"376,377"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/3893db233469dbb0d65616885660a767.png\" alt>","children":[],"payload":{"tag":"img","lines":"378,379"}}],"payload":{"tag":"h2","lines":"361,363"}},{"content":"2.1&#x3001;monitor&#x539f;&#x7406;","children":[{"content":"<pre data-lines=\"383,386\"><code>&#x5728;&#x5b66;&#x4e60;Monitor&#x4e4b;&#x524d;&#xff0c;&#x6211;&#x4eec;&#x9700;&#x8981;&#x4e86;&#x89e3; Java &#x5bf9;&#x8c61;&#x5934;&#xff0c;Java &#x5bf9;&#x8c61;&#x5934;&#x7684;&#x7ec4;&#x6210;&#xff0c;&#x8fd9;&#x91cc;&#x4ee5;32&#x4f4d;&#x865a;&#x62df;&#x673a;&#x4e3a;&#x4f8b;&#xff1a;\n\n&#x666e;&#x901a;&#x5bf9;&#x8c61;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"383,386"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/8b8182e38ea656b3103701091dbdfdfa.png\" alt>","children":[],"payload":{"tag":"img","lines":"387,388"}},{"content":"<pre data-lines=\"389,390\"><code>&#x6570;&#x7ec4;&#x5bf9;&#x8c61;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"389,390"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/f0eaad1fdd68f691db1ad26acdb39eda.png\" alt>","children":[],"payload":{"tag":"img","lines":"391,392"}},{"content":"<pre data-lines=\"393,394\"><code>&#x5176;&#x4e2d; 32&#x4f4d;&#x865a;&#x62df;&#x673a;&#x7684; Mark Word &#x7ed3;&#x6784;&#x4e3a;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"393,394"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/f8ad0e60ab5ca1a113e4c0f9577de733.png\" alt>","children":[],"payload":{"tag":"img","lines":"395,396"}},{"content":"<pre data-lines=\"397,398\"><code>&#x5176;&#x4e2d; 64&#x4f4d;&#x865a;&#x62df;&#x673a;&#x7684; Mark Word &#x7ed3;&#x6784;&#x4e3a;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"397,398"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/fa29dc91b340e1ea9282240588e64cf5.png\" alt>","children":[],"payload":{"tag":"img","lines":"399,400"}},{"content":"<pre data-lines=\"401,402\"><code>Monitor &#x88ab;&#x7ffb;&#x8bd1;&#x4e3a;&#x76d1;&#x89c6;&#x5668;&#x6216;&#x7ba1;&#x7a0b;&#xff0c;&#x6bcf;&#x4e2a; Java &#x5bf9;&#x8c61;&#x90fd;&#x53ef;&#x4ee5;&#x5173;&#x8054;&#x4e00;&#x4e2a; Monitor &#x5bf9;&#x8c61;&#xff0c;&#x5982;&#x679c;&#x4f7f;&#x7528; synchronized &#x7ed9;&#x5bf9;&#x8c61;&#x4e0a;&#x9501;&#xff08; **&#x91cd;&#x91cf;&#x7ea7;** &#xff09;&#x4e4b;&#x540e;&#xff0c;&#x8be5;&#x5bf9;&#x8c61;&#x5934;&#x7684; Mark Word &#x4e2d;&#x5c31;&#x88ab;&#x8bbe;&#x7f6e;&#x6307;&#x5411; Monitor &#x5bf9;&#x8c61;&#x7684;&#x6307;&#x9488;&#x3002;Monitor &#x7ed3;&#x6784;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"401,402"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/bdde2405ef93284ca9968626687e0f71.png\" alt>","children":[],"payload":{"tag":"img","lines":"403,404"}},{"content":"<pre data-lines=\"405,408\"><code>&#x521a;&#x5f00;&#x59cb; Monitor &#x4e2d; Owner &#x4e3a; null&#xff0c;&#x5f53; Thread-2 &#x6267;&#x884c; synchronized(obj) &#x5c31;&#x4f1a;&#x5c06; Monitor &#x7684;&#x6240;&#x6709;&#x8005; Owner &#x7f6e;&#x4e3a; Thread-2&#xff0c;Monitor&#x4e2d;&#x53ea;&#x80fd;&#x6709;&#x4e00;&#x4e2a; Owner&#xff0c;&#x5728; Thread-2 &#x4e0a;&#x9501;&#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x5982;&#x679c; Thread-3&#xff0c;Thread-4&#xff0c;Thread-5 &#x4e5f;&#x6765;&#x6267;&#x884c; synchronized(obj)&#xff0c;&#x5c31;&#x8fdb;&#x5165;EntryList &#x4e2d;&#x963b;&#x585e;&#x4f4f;&#xff0c;Thread-2 &#x6267;&#x884c;&#x5b8c;&#x540c;&#x6b65;&#x4ee3;&#x7801;&#x5757;&#x7684;&#x5185;&#x5bb9;&#xff0c;&#x7136;&#x540e;&#x5524;&#x9192; EntryList &#x4e2d;&#x7b49;&#x5f85;&#x7684;&#x7ebf;&#x7a0b;&#x6765;&#x7ade;&#x4e89;&#x9501;&#xff0c;&#x7ade;&#x4e89;&#x7684;&#x65f6;&#x5019;&#x662f;&#x975e;&#x516c;&#x5e73;&#x7684;&#xff0c;&#x56fe;&#x4e2d; WaitSet &#x4e2d;&#x7684; Thread-0&#xff0c;Thread-1 &#x662f;&#x4e4b;&#x524d;&#x83b7;&#x5f97;&#x8fc7;&#x9501;&#xff0c;&#x4f46;&#x6761;&#x4ef6;&#x4e0d;&#x6ee1;&#x8db3;&#x5219;&#x8fdb;&#x5165; WAITING &#x7b49;&#x5f85;&#x72b6;&#x6001;&#xff0c;&#x540e;&#x9762;&#x8bb2; wait-notify &#x65f6;&#x4f1a;&#x5206;&#x6790;&#x3002;\n\n&#x6ce8;&#x610f;&#xff1a;synchronized &#x5fc5;&#x987b;&#x662f;&#x8fdb;&#x5165;&#x540c;&#x4e00;&#x4e2a;&#x5bf9;&#x8c61;&#x7684; Monitor &#x624d;&#x6709;&#x4e0a;&#x8ff0;&#x6548;&#x679c;&#xff0c;&#x4e0d;&#x52a0; synchronized &#x7684;&#x5bf9;&#x8c61;&#x4e0d;&#x4f1a;&#x5173;&#x8054;&#x76d1;&#x89c6;&#x5668;&#xff0c;&#x4e0d;&#x9075;&#x4ece;&#x4ee5;&#x4e0a;&#x89c4;&#x5219;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"405,408"}}],"payload":{"tag":"h2","lines":"380,382"}},{"content":"2.2&#x3001;synchronized&#x539f;&#x7406;","children":[{"content":"2.2.1&#x3001;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;","children":[{"content":"<pre data-lines=\"424,427\"><code>&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x7684;&#x4f7f;&#x7528;&#x573a;&#x666f;&#xff1a;&#x5982;&#x679c;&#x4e00;&#x4e2a;&#x5bf9;&#x8c61;&#x867d;&#x7136;&#x6709;&#x591a;&#x7ebf;&#x7a0b;&#x8981;&#x52a0;&#x9501;&#xff0c;&#x4f46;&#x52a0;&#x9501;&#x7684;&#x65f6;&#x95f4;&#x662f;&#x9519;&#x5f00;&#x7684;&#xff08;&#x4e5f;&#x5c31;&#x662f;&#x6ca1;&#x6709;&#x7ade;&#x4e89;&#xff09;&#xff0c;&#x90a3;&#x4e48;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x6765;&#x4f18;&#x5316;&#x3002;  \n&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x5bf9;&#x4f7f;&#x7528;&#x8005;&#x662f;&#x900f;&#x660e;&#x7684;&#xff0c;&#x5373;&#x8bed;&#x6cd5;&#x4ecd;&#x7136;&#x662f; synchronized&#xff0c;Monitor &#x5bf9;&#x5e94;&#x7684;&#x5c31;&#x662f;&#x91cd;&#x91cf;&#x7ea7;&#x9501;&#xff0c;&#x6ce8;&#x610f;&#x9501;&#x7684;&#x72b6;&#x6001;&#x548c; Mark Word &#x540e;&#x4e24;&#x4f4d;&#x6709;&#x5173;&#x3002;  \n&#x5047;&#x8bbe;&#x6709;&#x4e24;&#x4e2a;&#x65b9;&#x6cd5;&#x540c;&#x6b65;&#x5757;&#xff0c;&#x5229;&#x7528;&#x540c;&#x4e00;&#x4e2a;&#x5bf9;&#x8c61;&#x52a0;&#x9501;&#xff0c;&#x6211;&#x4eec;&#x7ed9;&#x51fa;&#x793a;&#x4f8b;&#x4ee3;&#x7801;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"424,427"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/c16ef38e447230d2ac502fff649a9c5d.png\" alt>","children":[],"payload":{"tag":"img","lines":"428,429"}},{"content":"<pre data-lines=\"430,433\"><code>&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x7684;&#x6d41;&#x7a0b;&#x5982;&#x4e0b;&#x6240;&#x793a;&#xff1a;\n\n*   &#x521b;&#x5efa;&#x9501;&#x8bb0;&#x5f55;&#xff08;Lock Record&#xff09;&#x5bf9;&#x8c61;&#xff0c;&#x6bcf;&#x4e2a;&#x7ebf;&#x7a0b;&#x7684;&#x6808;&#x5e27;&#x90fd;&#x4f1a;&#x5305;&#x542b;&#x4e00;&#x4e2a;&#x9501;&#x8bb0;&#x5f55;&#x7684;&#x7ed3;&#x6784;&#xff0c;&#x5185;&#x90e8;&#x53ef;&#x4ee5;&#x5b58;&#x50a8;&#x9501;&#x5b9a;&#x5bf9;&#x8c61;&#x7684;Mark Word&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"430,433"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/87221b82b76c7f124c4d97bfa5a7de84.png\" alt>","children":[],"payload":{"tag":"img","lines":"434,435"}},{"content":"<pre data-lines=\"436,437\"><code>*   &#x8ba9;&#x9501;&#x8bb0;&#x5f55;&#x4e2d; Object reference &#x6307;&#x5411;&#x9501;&#x5bf9;&#x8c61;&#xff0c;&#x5e76;&#x5c1d;&#x8bd5;&#x7528; CAS &#x66ff;&#x6362; Object &#x7684; Mark Word&#xff0c;&#x5c06; Mark Word &#x7684;&#x503c;&#x5b58;&#x5165;&#x9501;&#x8bb0;&#x5f55;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"436,437"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/6271ae412dcab56a1705a1c2eb9381bf.png\" alt>","children":[],"payload":{"tag":"img","lines":"438,439"}},{"content":"<pre data-lines=\"440,441\"><code>*   &#x5982;&#x679c; CAS &#x66ff;&#x6362;&#x6210;&#x529f;&#xff0c;&#x5bf9;&#x8c61;&#x5934;&#x4e2d;&#x5b58;&#x50a8;&#x4e86;&#x9501;&#x8bb0;&#x5f55;&#x5730;&#x5740;&#x548c;&#x72b6;&#x6001; 00 &#xff0c;&#x8868;&#x793a;&#x7531;&#x8be5;&#x7ebf;&#x7a0b;&#x7ed9;&#x5bf9;&#x8c61;&#x52a0;&#x9501;&#xff0c;&#x8fd9;&#x65f6;&#x56fe;&#x793a;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"440,441"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/d8a0487dc8520e30699c5ee24461a9be.png\" alt>","children":[],"payload":{"tag":"img","lines":"442,443"}},{"content":"<pre data-lines=\"444,447\"><code>*   &#x5982;&#x679c; CAS &#x5931;&#x8d25;&#xff0c;&#x6709;&#x4e24;&#x79cd;&#x60c5;&#x51b5;&#xff1a;\n*   &#x5982;&#x679c;&#x662f;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x5df2;&#x7ecf;&#x6301;&#x6709;&#x4e86;&#x8be5; Object &#x7684;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#xff0c;&#x8fd9;&#x65f6;&#x8868;&#x660e;&#x6709;&#x7ade;&#x4e89;&#xff0c;&#x8fdb;&#x5165;&#x9501;&#x81a8;&#x80c0;&#x8fc7;&#x7a0b;&#xff0c;&#x9501;&#x81a8;&#x80c0;&#x540e;&#x8fb9;&#x4ecb;&#x7ecd;\n*   &#x5982;&#x679c;&#x662f;&#x81ea;&#x5df1;&#x6267;&#x884c;&#x4e86; synchronized &#x9501;&#x91cd;&#x5165;&#xff0c;&#x90a3;&#x4e48;&#x518d;&#x6dfb;&#x52a0;&#x4e00;&#x6761; Lock Record &#x4f5c;&#x4e3a;&#x91cd;&#x5165;&#x7684;&#x8ba1;&#x6570;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"444,447"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/314a748f51df4a71a221762be07d14c7.png\" alt>","children":[],"payload":{"tag":"img","lines":"448,449"}},{"content":"<pre data-lines=\"450,451\"><code>*   &#x5f53;&#x9000;&#x51fa; synchronized &#x4ee3;&#x7801;&#x5757;&#xff08;&#x89e3;&#x9501;&#x65f6;&#xff09;&#x5982;&#x679c;&#x6709;&#x53d6;&#x503c;&#x4e3a; null &#x7684;&#x9501;&#x8bb0;&#x5f55;&#xff0c;&#x8868;&#x793a;&#x6709;&#x91cd;&#x5165;&#xff0c;&#x8fd9;&#x65f6;&#x91cd;&#x7f6e;&#x9501;&#x8bb0;&#x5f55;&#xff0c;&#x8868;&#x793a;&#x91cd;&#x5165;&#x8ba1;&#x6570;&#x51cf;&#x4e00;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"450,451"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/bb812c09d4987565d113016969e62ecd.png\" alt>","children":[],"payload":{"tag":"img","lines":"452,453"}},{"content":"<pre data-lines=\"454,457\"><code>*   &#x5f53;&#x9000;&#x51fa; synchronized &#x4ee3;&#x7801;&#x5757;&#xff08;&#x89e3;&#x9501;&#x65f6;&#xff09;&#x9501;&#x8bb0;&#x5f55;&#x7684;&#x503c;&#x4e0d;&#x4e3a; null&#xff0c;&#x8fd9;&#x65f6;&#x4f7f;&#x7528; cas &#x5c06; Mark Word &#x7684;&#x503c;&#x6062;&#x590d;&#x7ed9;&#x5bf9;&#x8c61;&#x5934;&#xff0c;&#x4e5f;&#x5206;&#x4e24;&#x79cd;&#x60c5;&#x51b5;&#xff1a;\n    *   &#x6210;&#x529f;&#xff0c;&#x5219;&#x89e3;&#x9501;&#x6210;&#x529f;\n    *   &#x5931;&#x8d25;&#xff0c;&#x8bf4;&#x660e;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x8fdb;&#x884c;&#x4e86;&#x9501;&#x81a8;&#x80c0;&#x6216;&#x5df2;&#x7ecf;&#x5347;&#x7ea7;&#x4e3a;&#x91cd;&#x91cf;&#x7ea7;&#x9501;&#xff0c;&#x8fdb;&#x5165;&#x91cd;&#x91cf;&#x7ea7;&#x9501;&#x89e3;&#x9501;&#x6d41;&#x7a0b;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"454,457"}}],"payload":{"tag":"h3","lines":"422,423"}},{"content":"2.2.2&#x3001;&#x9501;&#x81a8;&#x80c0;","children":[{"content":"<pre data-lines=\"460,465\"><code>&#x5982;&#x679c;&#x5728;&#x5c1d;&#x8bd5;&#x52a0;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;CAS &#x64cd;&#x4f5c;&#x65e0;&#x6cd5;&#x6210;&#x529f;&#xff0c;&#x8fd9;&#x65f6;&#x4e00;&#x79cd;&#x60c5;&#x51b5;&#x5c31;&#x662f;&#x6709;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x4e3a;&#x6b64;&#x5bf9;&#x8c61;&#x52a0;&#x4e0a;&#x4e86;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#xff08;&#x6709;&#x7ade;&#x4e89;&#xff09;&#xff0c;&#x8fd9;&#x65f6;&#x9700;&#x8981;&#x8fdb;&#x884c;&#x9501;&#x81a8;&#x80c0;&#xff0c;&#x5c06;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x53d8;&#x4e3a;&#x91cd;&#x91cf;&#x7ea7;&#x9501;&#x3002;\n\n&#x9501;&#x81a8;&#x80c0;&#x7684;&#x6d41;&#x7a0b;&#x5982;&#x4e0b;&#x6240;&#x793a;&#xff1a;\n\n*   &#x5f53; Thread-1 &#x8fdb;&#x884c;&#x8f7b;&#x91cf;&#x7ea7;&#x52a0;&#x9501;&#x65f6;&#xff0c;Thread-0 &#x5df2;&#x7ecf;&#x5bf9;&#x8be5;&#x5bf9;&#x8c61;&#x52a0;&#x4e86;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"460,465"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/37e60b6a3b8e475ac0faff36b546b38b.png\" alt>","children":[],"payload":{"tag":"img","lines":"466,467"}},{"content":"<pre data-lines=\"468,469\"><code>*   &#x8fd9;&#x65f6; Thread-1 &#x52a0;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x5931;&#x8d25;&#xff0c;&#x8fdb;&#x5165;&#x9501;&#x81a8;&#x80c0;&#x6d41;&#x7a0b;&#xff0c;&#x5373;&#x4e3a; Object &#x5bf9;&#x8c61;&#x7533;&#x8bf7; Monitor &#x9501;&#xff08;&#x91cd;&#x91cf;&#x7ea7;&#x9501;&#xff09;&#xff0c;&#x8ba9; Object &#x6307;&#x5411;&#x91cd;&#x91cf;&#x7ea7;&#x9501;&#x5730;&#x5740;&#xff0c;&#x7136;&#x540e;&#x81ea;&#x5df1;&#xff08;Thread-1&#xff09;&#x8fdb;&#x5165; Monitor &#x7684; EntryList &#x963b;&#x585e;&#x4f4f;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"468,469"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/a03a1129b20ae4eb82753a1e91d41d0c.png\" alt>","children":[],"payload":{"tag":"img","lines":"470,471"}},{"content":"<pre data-lines=\"472,473\"><code>*   &#x5f53; Thread-0 &#x9000;&#x51fa;&#x540c;&#x6b65;&#x5757;&#x89e3;&#x9501;&#x65f6;&#xff0c;&#x4f7f;&#x7528; CAS &#x5c06; Mark Word &#x7684;&#x503c;&#x6062;&#x590d;&#x7ed9;&#x5bf9;&#x8c61;&#x5934;&#xff0c;&#x80af;&#x5b9a;&#x5931;&#x8d25;&#x3002;&#x8fd9;&#x65f6;&#x4f1a;&#x8fdb;&#x5165;&#x91cd;&#x91cf;&#x7ea7;&#x89e3;&#x9501;&#x6d41;&#x7a0b;&#xff0c;&#x5373;&#x6309;&#x7167; Monitor &#x5730;&#x5740;&#x627e;&#x5230; Monitor &#x5bf9;&#x8c61;&#xff0c;&#x8bbe;&#x7f6e; Owner &#x4e3a; null&#xff0c;&#x5524;&#x9192; EntryList &#x4e2d;&#x88ab;&#x963b;&#x585e;&#x4f4f;&#x7684;&#x7ebf;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"472,473"}}],"payload":{"tag":"h3","lines":"458,459"}},{"content":"2.2.3&#x3001;&#x81ea;&#x65cb;&#x4f18;&#x5316;","children":[{"content":"<pre data-lines=\"476,479\"><code>&#x91cd;&#x91cf;&#x7ea7;&#x9501;&#x7ade;&#x4e89;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x8fd8;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;&#x81ea;&#x65cb;&#x6765;&#x8fdb;&#x884c;&#x4f18;&#x5316;&#xff0c;&#x5982;&#x679c;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x81ea;&#x65cb;&#x6210;&#x529f;&#xff08;&#x5373;&#x8fd9;&#x65f6;&#x5019;&#x6301;&#x9501;&#x7ebf;&#x7a0b;&#x5df2;&#x7ecf;&#x9000;&#x51fa;&#x4e86;&#x540c;&#x6b65;&#x5757;&#xff0c;&#x91ca;&#x653e;&#x4e86;&#x9501;&#xff09;&#xff0c;&#x8fd9;&#x65f6;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x5c31;&#x53ef;&#x4ee5;&#x907f;&#x514d;&#x963b;&#x585e;&#x3002;&#x81ea;&#x65cb;&#x4f1a;&#x5360;&#x7528; CPU &#x65f6;&#x95f4;&#xff0c;&#x5355;&#x6838; CPU &#x81ea;&#x65cb;&#x5c31;&#x662f;&#x6d6a;&#x8d39;&#xff0c;&#x591a;&#x6838; CPU &#x81ea;&#x65cb;&#x624d;&#x80fd;&#x53d1;&#x6325;&#x4f18;&#x52bf;&#x3002;&#x5728; Java 6 &#x4e4b;&#x540e;&#x81ea;&#x65cb;&#x9501;&#x662f;&#x81ea;&#x9002;&#x5e94;&#x7684;&#xff0c;&#x6bd4;&#x5982;&#x5bf9;&#x8c61;&#x521a;&#x521a;&#x7684;&#x4e00;&#x6b21;&#x81ea;&#x65cb;&#x64cd;&#x4f5c;&#x6210;&#x529f;&#x8fc7;&#xff0c;&#x90a3;&#x4e48;&#x8ba4;&#x4e3a;&#x8fd9;&#x6b21;&#x81ea;&#x65cb;&#x6210;&#x529f;&#x7684;&#x53ef;&#x80fd;&#x6027;&#x4f1a;&#x9ad8;&#xff0c;&#x5c31;&#x591a;&#x81ea;&#x65cb;&#x51e0;&#x6b21;&#xff1b;&#x53cd;&#x4e4b;&#xff0c;&#x5c31;&#x5c11;&#x81ea;&#x65cb;&#x751a;&#x81f3;&#x4e0d;&#x81ea;&#x65cb;&#xff0c;&#x603b;&#x4e4b;&#xff0c;&#x6bd4;&#x8f83;&#x667a;&#x80fd;&#x3002;Java 7 &#x4e4b;&#x540e;&#x4e0d;&#x80fd;&#x63a7;&#x5236;&#x662f;&#x5426;&#x5f00;&#x542f;&#x81ea;&#x65cb;&#x529f;&#x80fd;&#x3002;\n\n&#x81ea;&#x65cb;&#x91cd;&#x8bd5;&#x6210;&#x529f;&#x7684;&#x60c5;&#x51b5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"476,479"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/2d71a1474ea81281a50a8dce48a129f6.png\" alt>","children":[],"payload":{"tag":"img","lines":"480,481"}},{"content":"<pre data-lines=\"482,483\"><code>&#x81ea;&#x65cb;&#x91cd;&#x8bd5;&#x5931;&#x8d25;&#x7684;&#x60c5;&#x51b5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"482,483"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/97feb6507174e83a817f5b634965e0f3.png\" alt>","children":[],"payload":{"tag":"img","lines":"484,485"}}],"payload":{"tag":"h3","lines":"474,475"}},{"content":"2.2.4&#x3001;&#x504f;&#x5411;&#x9501;","children":[{"content":"<pre data-lines=\"488,491\"><code>&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x5728;&#x6ca1;&#x6709;&#x7ade;&#x4e89;&#x65f6;&#xff08;&#x5c31;&#x53ea;&#x6709;&#x81ea;&#x5df1;&#x8fd9;&#x4e2a;&#x7ebf;&#x7a0b;&#xff09;&#xff0c;&#x6bcf;&#x6b21;&#x91cd;&#x5165;&#x4ecd;&#x7136;&#x9700;&#x8981;&#x6267;&#x884c; CAS &#x64cd;&#x4f5c;&#x3002;Java 6 &#x4e2d;&#x5f15;&#x5165;&#x4e86;&#x504f;&#x5411;&#x9501;&#x6765;&#x505a;&#x8fdb;&#x4e00;&#x6b65;&#x4f18;&#x5316;&#xff1a;&#x53ea;&#x6709;&#x7b2c;&#x4e00;&#x6b21;&#x4f7f;&#x7528; CAS &#x5c06;&#x7ebf;&#x7a0b; ID &#x8bbe;&#x7f6e;&#x5230;&#x5bf9;&#x8c61;&#x7684; Mark Word &#x5934;&#xff0c;&#x4e4b;&#x540e;&#x53d1;&#x73b0;&#x8fd9;&#x4e2a;&#x7ebf;&#x7a0b; ID &#x662f;&#x81ea;&#x5df1;&#x7684;&#x5c31;&#x8868;&#x793a;&#x6ca1;&#x6709;&#x7ade;&#x4e89;&#xff0c;&#x4e0d;&#x7528;&#x91cd;&#x65b0; CAS&#x3002;&#x4ee5;&#x540e;&#x53ea;&#x8981;&#x4e0d;&#x53d1;&#x751f;&#x7ade;&#x4e89;&#xff0c;&#x8fd9;&#x4e2a;&#x5bf9;&#x8c61;&#x5c31;&#x5f52;&#x8be5;&#x7ebf;&#x7a0b;&#x6240;&#x6709;&#x3002;\n\n&#x4e0b;&#x9762;&#x6211;&#x4eec;&#x7ed9;&#x51fa;&#x4e00;&#x79cd;&#x504f;&#x5411;&#x9501;&#x793a;&#x4f8b;&#x4ee3;&#x7801;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"488,491"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/21dda046004ce1acef47db55070dc9e9.png\" alt>","children":[],"payload":{"tag":"img","lines":"492,493"}},{"content":"<pre data-lines=\"494,495\"><code>&#x4e0b;&#x9762;&#x7ed9;&#x51fa;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x548c;&#x504f;&#x5411;&#x9501;&#x7684;&#x5bf9;&#x6bd4;&#x56fe;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"494,495"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/2b80034c1f2762bd88fd0be0dbe6b6ff.png\" alt>","children":[],"payload":{"tag":"img","lines":"496,497"}},{"content":"<pre data-lines=\"498,499\"><code>&#x6211;&#x5f53;&#x524d;&#x7684;&#x7535;&#x8111;&#x7cfb;&#x7edf;&#x662f; 64 &#x4f4d;&#xff0c;&#x6240;&#x4ee5;&#x5b89;&#x88c5;&#x7684; 64 &#x4f4d;&#x865a;&#x62df;&#x673a;&#xff0c;&#x56de;&#x5fc6;&#x4e00;&#x4e0b; 64 &#x5bf9;&#x8c61;&#x5934;&#x7684;&#x4f4d;Mark Word &#x7ed3;&#x6784;&#x4e3a;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"498,499"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/f6d910b71c762c994afb143cff918810.png\" alt>","children":[],"payload":{"tag":"img","lines":"500,501"}},{"content":"<pre data-lines=\"502,517\"><code>&#x4e00;&#x4e2a;&#x5bf9;&#x8c61;&#x521b;&#x5efa;&#x65f6;&#xff0c;&#x5982;&#x679c;&#x5f00;&#x542f;&#x4e86;&#x504f;&#x5411;&#x9501;&#xff08;&#x9ed8;&#x8ba4;&#x5f00;&#x542f;&#xff09;&#xff0c;&#x90a3;&#x4e48;&#x5bf9;&#x8c61;&#x521b;&#x5efa;&#x540e;&#xff0c;Mark Word &#x503c;&#x4e3a; 0x05 &#x5373;&#x6700;&#x540e; 3 &#x4f4d;&#x4e3a; 101&#xff0c;&#x8fd9;&#x65f6;&#x5b83;&#x7684;thread&#x3001;epoch&#x3001;age &#x90fd;&#x4e3a; 0&#x3002;&#x5904;&#x4e8e;&#x504f;&#x5411;&#x9501;&#x7684;&#x5bf9;&#x8c61;&#x89e3;&#x9501;&#x540e;&#xff0c;&#x7ebf;&#x7a0b; id &#x4ecd;&#x5b58;&#x50a8;&#x4e8e;&#x5bf9;&#x8c61;&#x5934;&#x4e2d;&#x3002;&#x504f;&#x5411;&#x9501;&#x9ed8;&#x8ba4;&#x662f;&#x5ef6;&#x8fdf;&#x7684;&#xff0c;&#x4e0d;&#x4f1a;&#x5728;&#x7a0b;&#x5e8f;&#x542f;&#x52a8;&#x65f6;&#x7acb;&#x5373;&#x751f;&#x6548;&#xff0c;&#x5982;&#x679c;&#x60f3;&#x907f;&#x514d;&#x5ef6;&#x8fdf;&#xff0c;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x6dfb;&#x52a0; VM &#x53c2;&#x6570; `-XX:BiasedLockingStartupDelay=0` &#x6765;&#x7981;&#x7528;&#x5ef6;&#x8fdf;&#x3002;&#x5982;&#x679c;&#x60f3;&#x8981;&#x7981;&#x7528;&#x6389;&#x504f;&#x5411;&#x9501;&#xff0c;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x6dfb;&#x52a0; VM &#x53c2;&#x6570; `-XX:-UseBiasedLocking` &#x6765;&#x7981;&#x7528;&#x504f;&#x5411;&#x9501;&#x3002;&#x5982;&#x679c;&#x6ca1;&#x6709;&#x5f00;&#x542f;&#x504f;&#x5411;&#x9501;&#xff0c;&#x90a3;&#x4e48;&#x5bf9;&#x8c61;&#x521b;&#x5efa;&#x540e;&#xff0c;Mark Word &#x503c;&#x4e3a; 0x01 &#x5373;&#x6700;&#x540e; 3 &#x4f4d;&#x4e3a; 001&#xff0c;&#x8fd9;&#x65f6;&#x5b83;&#x7684; hashcode&#x3001;age &#x90fd;&#x4e3a; 0&#xff0c;&#x5e76;&#x4e14;&#x53ea;&#x6709;&#x7b2c;&#x4e00;&#x6b21;&#x7528;&#x5230; hashcode &#x65f6;&#x624d;&#x4f1a;&#x8d4b;&#x503c;&#x3002;\n\n&#x5207;&#x8bb0;&#x6ce8;&#x610f;&#xff0c;&#x5982;&#x679c;&#x4e00;&#x65e6;&#x8c03;&#x7528;&#x4e86;&#x5bf9;&#x8c61;&#x7684; hashCode&#xff0c;&#x4f1a;&#x5bfc;&#x81f4;&#x504f;&#x5411;&#x9501;&#x88ab;&#x64a4;&#x9500;&#xff0c;&#x8fd9;&#x662f;&#x56e0;&#x4e3a;&#x504f;&#x5411;&#x9501;&#x7684;&#x5bf9;&#x8c61; Mark Word &#x4e2d;&#x5b58;&#x50a8;&#x7684;&#x662f;&#x7ebf;&#x7a0b; id&#xff0c;&#x6839;&#x672c;&#x6ca1;&#x6709;&#x5730;&#x65b9;&#x518d;&#x5b58;&#x50a8; hashCode &#x7684;&#x503c;&#x4e86;&#xff0c;&#x800c;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x4f1a;&#x5728;&#x9501;&#x8bb0;&#x5f55;&#x4e2d;&#x8bb0;&#x5f55; hashCode&#xff0c;&#x91cd;&#x91cf;&#x7ea7;&#x9501;&#x4f1a;&#x5728; Monitor &#x4e2d;&#x8bb0;&#x5f55; hashCode&#x3002;\n\n&#x8fd8;&#x6709;&#x5c31;&#x662f;&#xff0c;&#x5f53;&#x6709;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x4f7f;&#x7528;&#x504f;&#x5411;&#x9501;&#x5bf9;&#x8c61;&#x65f6;&#xff0c;&#x4f1a;&#x5c06;&#x504f;&#x5411;&#x9501;&#x5347;&#x7ea7;&#x4e3a;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#xff0c;&#x5982;&#x679c;&#x7ade;&#x4e89;&#x7ee7;&#x7eed;&#x6fc0;&#x70c8;&#xff0c;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#x4f1a;&#x7ee7;&#x7eed;&#x81a8;&#x80c0;&#x5347;&#x7ea7;&#x5230;&#x91cd;&#x91cf;&#x7ea7;&#x9501;&#x3002;\n\n&#x518d;&#x6709;&#x5c31;&#x662f;&#xff0c;&#x5f53;&#x8c03;&#x7528;&#x5bf9;&#x8c61;&#x7684; wait/notify &#x65b9;&#x6cd5;&#x65f6;&#xff0c;&#x4f1a;&#x5c06;&#x504f;&#x5411;&#x9501;&#x5347;&#x7ea7;&#x4e3a;&#x91cd;&#x91cf;&#x7ea7;&#x9501;&#x3002;\n\n&#x6279;&#x91cf;&#x91cd;&#x504f;&#x5411;\n\n&#x5982;&#x679c;&#x5bf9;&#x8c61;&#x867d;&#x7136;&#x88ab;&#x591a;&#x4e2a;&#x7ebf;&#x7a0b;&#x8bbf;&#x95ee;&#xff0c;&#x4f46;&#x6ca1;&#x6709;&#x7ade;&#x4e89;&#xff0c;&#x8fd9;&#x65f6;&#x504f;&#x5411;&#x4e86;&#x7ebf;&#x7a0b; T1 &#x7684;&#x5bf9;&#x8c61;&#x4ecd;&#x6709;&#x673a;&#x4f1a;&#x91cd;&#x65b0;&#x504f;&#x5411; T2&#xff0c;&#x91cd;&#x504f;&#x5411;&#x4f1a;&#x91cd;&#x7f6e;&#x5bf9;&#x8c61;&#x7684;&#x7ebf;&#x7a0b; id &#xff0c;&#x5f53;&#x64a4;&#x9500;&#x504f;&#x5411;&#x9501;&#x9608;&#x503c;&#x8d85;&#x8fc7; 20 &#x6b21;&#x540e;&#xff0c;jvm &#x4f1a;&#x8fd9;&#x6837;&#x89c9;&#x5f97;&#xff0c;&#x6211;&#x662f;&#x4e0d;&#x662f;&#x504f;&#x5411;&#x9519;&#x4e86;&#x5462;&#xff0c;&#x4e8e;&#x662f;&#x4f1a;&#x5728;&#x7ed9;&#x8fd9;&#x4e9b;&#x5bf9;&#x8c61;&#x52a0;&#x9501;&#x65f6;&#x91cd;&#x65b0;&#x504f;&#x5411;&#x81f3; T2 &#x7ebf;&#x7a0b;&#x3002;\n\n&#x6279;&#x91cf;&#x64a4;&#x9500;\n\n&#x5f53;&#x64a4;&#x9500;&#x504f;&#x5411;&#x9501;&#x9608;&#x503c;&#x8d85;&#x8fc7; 40 &#x6b21;&#x540e;&#xff0c;jvm &#x4f1a;&#x8fd9;&#x6837;&#x89c9;&#x5f97;&#xff0c;&#x81ea;&#x5df1;&#x786e;&#x5b9e;&#x504f;&#x5411;&#x9519;&#x4e86;&#xff0c;&#x6839;&#x672c;&#x5c31;&#x4e0d;&#x8be5;&#x504f;&#x5411;&#x3002;&#x4e8e;&#x662f;&#x6574;&#x4e2a;&#x7c7b;&#x7684;&#x6240;&#x6709;&#x5bf9;&#x8c61;&#x90fd;&#x4f1a;&#x53d8;&#x4e3a;&#x4e0d;&#x53ef;&#x504f;&#x5411;&#x7684;&#xff0c;&#x65b0;&#x5efa;&#x7684;&#x5bf9;&#x8c61;&#x4e5f;&#x662f;&#x4e0d;&#x53ef;&#x504f;&#x5411;&#x7684;&#x3002;&#x90a3;&#x52a0;&#x9501;&#x5219;&#x76f4;&#x63a5;&#x4e3a;&#x8f7b;&#x91cf;&#x7ea7;&#x9501;&#xff0c;&#x64a4;&#x9500;&#x4e86;&#x504f;&#x5411;&#x9501;&#x8fd9;&#x4e2a;&#x6b65;&#x9aa4;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"502,517"}}],"payload":{"tag":"h3","lines":"486,487"}},{"content":"2.2.5&#x3001;&#x9501;&#x6d88;&#x9664;","children":[{"content":"<pre data-lines=\"520,521\"><code>&#x6bd4;&#x5982;&#x6709;&#x5982;&#x4e0b;&#x573a;&#x666f;&#xff0c;&#x6211;&#x5148;&#x6267;&#x884c;&#x65b9;&#x6cd5;a&#xff0c;&#x7136;&#x540e;&#x6267;&#x884c;&#x65b9;&#x6cd5;b&#xff0c;&#x8fd9;&#x662f;&#x540c;&#x6b65;&#x64cd;&#x4f5c;&#xff0c;&#x867d;&#x7136;&#x65b9;&#x6cd5;b&#x6dfb;&#x52a0;&#x4e86;&#x9501;&#xff0c;&#x4f46;&#x662f;&#x5e76;&#x6ca1;&#x6709;&#x8d77;&#x5230;&#x4ec0;&#x4e48;&#x5b9e;&#x8d28;&#x6027;&#x4f5c;&#x7528;&#xff0c;JIT&#x7f16;&#x8bd1;&#x4f1a;&#x5bf9;&#x8fd9;&#x6837;&#x7684;&#x4ee3;&#x7801;&#x8fdb;&#x884c;&#x53bb;&#x9501;&#x4f18;&#x5316;&#xff0c;&#x56e0;&#x4e3a;&#x8fd9;&#x6837;&#x7684;&#x9501;&#x5e76;&#x6ca1;&#x6709;&#x4ec0;&#x4e48;&#x4f5c;&#x7528;&#xff0c;&#x5982;&#x679c;&#x60f3;&#x8981;&#x53d6;&#x6d88;&#x8fd9;&#x4e00;&#x4f18;&#x5316;&#x673a;&#x5236;&#xff0c;&#x53ea;&#x9700;&#x8981;&#x6dfb;&#x52a0;&#x53c2;&#x6570;`-XX:-EliminateLocks`&#x5373;&#x53ef;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"520,521"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/6c77d6628006775da38ae948e83e569b.png\" alt>","children":[],"payload":{"tag":"img","lines":"522,523"}},{"content":"<pre data-lines=\"524,525\"><code>&#x6d4b;&#x8bd5;&#x4e00;&#xff1a;`java -jar benchmarks.jar`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"524,525"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/af8ea804452a4771c17c2ef4a21be36c.png\" alt>","children":[],"payload":{"tag":"img","lines":"526,527"}},{"content":"<pre data-lines=\"528,529\"><code>&#x6d4b;&#x8bd5;&#x4e8c;&#xff1a;`java -XX:-EliminateLocks -jar benchmarks.jar`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"528,529"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/f0c1625aac212967c7c66398794d994d.png\" alt>","children":[],"payload":{"tag":"img","lines":"530,531"}}],"payload":{"tag":"h3","lines":"518,519"}}],"payload":{"tag":"h2","lines":"409,411"}},{"content":"2.3&#x3001;wait &amp; notify&#x539f;&#x7406;","children":[{"content":"2.3.1&#x3001;&#x540c;&#x6b65;&#x6a21;&#x5f0f;&#x4e4b;&#x4fdd;&#x62a4;&#x6027;&#x6682;&#x505c;","children":[{"content":"<pre data-lines=\"550,557\"><code>&#x4fdd;&#x62a4;&#x6027;&#x6682;&#x505c;&#x5373; Guarded Suspension&#xff0c;&#x7528;&#x5728;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x7b49;&#x5f85;&#x53e6;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x7684;&#x6267;&#x884c;&#x7ed3;&#x679c;&#xff0c;&#x56e0;&#x4e3a;&#x8981;&#x7b49;&#x5f85;&#x53e6;&#x4e00;&#x65b9;&#x7684;&#x7ed3;&#x679c;&#xff0c;&#x56e0;&#x6b64;&#x5f52;&#x7c7b;&#x5230;&#x540c;&#x6b65;&#x6a21;&#x5f0f;&#x3002;\n\n&#x6709;&#x4e00;&#x4e2a;&#x7ed3;&#x679c;&#x9700;&#x8981;&#x4ece;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x4f20;&#x9012;&#x5230;&#x53e6;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#xff0c;&#x8ba9;&#x4ed6;&#x4eec;&#x5173;&#x8054;&#x540c;&#x4e00;&#x4e2a; GuardedObject&#xff0c;&#x5982;&#x679c;&#x6709;&#x7ed3;&#x679c;&#x4e0d;&#x65ad;&#x4ece;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x5230;&#x53e6;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#xff0c;&#x90a3;&#x4e48;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;&#x6d88;&#x606f;&#x961f;&#x5217;&#xff08;&#x8be6;&#x60c5;&#x89c1;&#x751f;&#x4ea7;&#x8005;/&#x6d88;&#x8d39;&#x8005;&#xff09;&#x3002;\n\nJDK &#x4e2d;&#xff0c;join &#x7684;&#x5b9e;&#x73b0;&#x3001;Future &#x7684;&#x5b9e;&#x73b0;&#xff0c;&#x91c7;&#x7528;&#x7684;&#x5c31;&#x662f;&#x6b64;&#x6a21;&#x5f0f;&#xff0c;&#x63a5;&#x4e0b;&#x6765;&#x6211;&#x4eec;&#x4f1a;&#x9010;&#x5c42;&#x9012;&#x8fdb;&#xff0c;&#x6765;&#x8fdb;&#x884c;&#x5b66;&#x4e60;&#x3002;\n\n&#x5355;&#x4efb;&#x52a1;&#x7248;&#x672c;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"550,557"}},{"content":"<pre data-lines=\"558,609\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GuardedObject</span> {\n    <span class=\"hljs-keyword\">private</span> Object response;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">Object</span> <span class=\"hljs-variable\">lock</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Object</span>();\n\n    <span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title function_\">get</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">synchronized</span> (lock) {\n            \n            <span class=\"hljs-keyword\">while</span> (response == <span class=\"hljs-literal\">null</span>) {\n                <span class=\"hljs-keyword\">try</span> {\n                    lock.wait();\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            <span class=\"hljs-keyword\">return</span> response;\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">complete</span><span class=\"hljs-params\">(Object response)</span> {\n        <span class=\"hljs-keyword\">synchronized</span> (lock) {\n            \n            <span class=\"hljs-built_in\">this</span>.response = response;\n            log.debug(<span class=\"hljs-string\">&quot;notify...&quot;</span>);\n            lock.notifyAll();\n        }\n    }\n}\n\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test10</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">GuardedObject</span> <span class=\"hljs-variable\">guardedObject</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">GuardedObject</span>();\n        \n        log.debug(<span class=\"hljs-string\">&quot;starting...&quot;</span>);\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                Thread.sleep(<span class=\"hljs-number\">5000</span>);\n                guardedObject.complete(<span class=\"hljs-string\">&quot;done.&quot;</span>);\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }).start();\n        log.debug(<span class=\"hljs-string\">&quot;waiting...&quot;</span>);\n        \n        log.debug(<span class=\"hljs-string\">&quot;get response: {}&quot;</span>, guardedObject.get());\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"558,609"}},{"content":"<pre data-lines=\"610,617\"><code class=\"language-java\">15:49:26.949 [main] DEBUG com.caochenlei.Test10 - starting...\n15:49:27.074 [main] DEBUG com.caochenlei.Test10 - waiting...\n15:49:32.082 [Thread-0] DEBUG com.caochenlei.GuardedObject - notify...\n15:49:32.082 [main] DEBUG com.caochenlei.Test10 - get response: done.\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"610,617"}},{"content":"<pre data-lines=\"618,619\"><code>&#x5e26;&#x8d85;&#x65f6;&#x7248;&#x672c;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"618,619"}},{"content":"<pre data-lines=\"620,684\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GuardedObject</span> {\n    <span class=\"hljs-keyword\">private</span> Object response;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">Object</span> <span class=\"hljs-variable\">lock</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Object</span>();\n\n    <span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title function_\">get</span><span class=\"hljs-params\">(<span class=\"hljs-type\">long</span> millis)</span> {\n        <span class=\"hljs-keyword\">synchronized</span> (lock) {\n            \n            <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">begin</span> <span class=\"hljs-operator\">=</span> System.currentTimeMillis();\n            \n            <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">timePassed</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n            <span class=\"hljs-keyword\">while</span> (response == <span class=\"hljs-literal\">null</span>) {\n                \n                <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">waitTime</span> <span class=\"hljs-operator\">=</span> millis - timePassed;\n                log.debug(<span class=\"hljs-string\">&quot;waitTime: {}&quot;</span>, waitTime);\n                <span class=\"hljs-keyword\">if</span> (waitTime &lt;= <span class=\"hljs-number\">0</span>) {\n                    log.debug(<span class=\"hljs-string\">&quot;break...&quot;</span>);\n                    <span class=\"hljs-keyword\">break</span>;\n                }\n                <span class=\"hljs-keyword\">try</span> {\n                    lock.wait(waitTime);\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                \n                timePassed = System.currentTimeMillis() - begin;\n                log.debug(<span class=\"hljs-string\">&quot;timePassed: {}, object is null {}&quot;</span>, timePassed, response == <span class=\"hljs-literal\">null</span>);\n            }\n            <span class=\"hljs-keyword\">return</span> response;\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">complete</span><span class=\"hljs-params\">(Object response)</span> {\n        <span class=\"hljs-keyword\">synchronized</span> (lock) {\n            \n            <span class=\"hljs-built_in\">this</span>.response = response;\n            log.debug(<span class=\"hljs-string\">&quot;notify...&quot;</span>);\n            lock.notifyAll();\n        }\n    }\n}\n\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test10</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">GuardedObject</span> <span class=\"hljs-variable\">guardedObject</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">GuardedObject</span>();\n        \n        log.debug(<span class=\"hljs-string\">&quot;starting...&quot;</span>);\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                Thread.sleep(<span class=\"hljs-number\">5000</span>);\n                guardedObject.complete(<span class=\"hljs-string\">&quot;done.&quot;</span>);\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }).start();\n        log.debug(<span class=\"hljs-string\">&quot;waiting...&quot;</span>);\n        \n        log.debug(<span class=\"hljs-string\">&quot;get response: {}&quot;</span>, guardedObject.get(<span class=\"hljs-number\">2000</span>));\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"620,684"}},{"content":"<pre data-lines=\"685,696\"><code class=\"language-java\"><span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">47</span>:<span class=\"hljs-number\">17.210</span> [main] DEBUG com.caochenlei.Test10 - starting...\n<span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">47</span>:<span class=\"hljs-number\">17.319</span> [main] DEBUG com.caochenlei.Test10 - waiting...\n<span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">47</span>:<span class=\"hljs-number\">17.319</span> [main] DEBUG com.caochenlei.GuardedObject - waitTime: <span class=\"hljs-number\">2000</span>\n<span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">47</span>:<span class=\"hljs-number\">19.341</span> [main] DEBUG com.caochenlei.GuardedObject - timePassed: <span class=\"hljs-number\">2022</span>, object is <span class=\"hljs-literal\">null</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">47</span>:<span class=\"hljs-number\">19.344</span> [main] DEBUG com.caochenlei.GuardedObject - waitTime: -<span class=\"hljs-number\">22</span>\n<span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">47</span>:<span class=\"hljs-number\">19.344</span> [main] DEBUG com.caochenlei.GuardedObject - <span class=\"hljs-keyword\">break</span>...\n<span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">47</span>:<span class=\"hljs-number\">19.344</span> [main] DEBUG com.caochenlei.Test10 - get response: <span class=\"hljs-literal\">null</span>\n<span class=\"hljs-number\">15</span>:<span class=\"hljs-number\">47</span>:<span class=\"hljs-number\">22.324</span> [Thread-<span class=\"hljs-number\">0</span>] DEBUG com.caochenlei.GuardedObject - notify...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"685,696"}},{"content":"<pre data-lines=\"697,698\"><code>&#x591a;&#x4efb;&#x52a1;&#x7248;&#x672c;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"697,698"}},{"content":"<pre data-lines=\"699,772\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GuardedObject</span> {\n    <span class=\"hljs-keyword\">private</span> Object response;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">Object</span> <span class=\"hljs-variable\">lock</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Object</span>();\n\n    \n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> id;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">GuardedObject</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> id)</span> {\n        <span class=\"hljs-built_in\">this</span>.id = id;\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">getId</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> id;\n    }\n\n    <span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title function_\">get</span><span class=\"hljs-params\">(<span class=\"hljs-type\">long</span> millis)</span> {\n        <span class=\"hljs-keyword\">synchronized</span> (lock) {\n            \n            <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">begin</span> <span class=\"hljs-operator\">=</span> System.currentTimeMillis();\n            \n            <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">timePassed</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n            <span class=\"hljs-keyword\">while</span> (response == <span class=\"hljs-literal\">null</span>) {\n                \n                <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">waitTime</span> <span class=\"hljs-operator\">=</span> millis - timePassed;\n                <span class=\"hljs-keyword\">if</span> (waitTime &lt;= <span class=\"hljs-number\">0</span>) {\n                    <span class=\"hljs-keyword\">break</span>;\n                }\n                <span class=\"hljs-keyword\">try</span> {\n                    lock.wait(waitTime);\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                \n                timePassed = System.currentTimeMillis() - begin;\n            }\n            <span class=\"hljs-keyword\">return</span> response;\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">complete</span><span class=\"hljs-params\">(Object response)</span> {\n        <span class=\"hljs-keyword\">synchronized</span> (lock) {\n            \n            <span class=\"hljs-built_in\">this</span>.response = response;\n            lock.notifyAll();\n        }\n    }\n}\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GuardedObjects</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> Map&lt;Integer, GuardedObject&gt; guardedObjects = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Hashtable</span>&lt;&gt;();\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">id</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span>;\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">synchronized</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">generateId</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> id++;\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> GuardedObject <span class=\"hljs-title function_\">getGuardedObject</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> id)</span> {\n        <span class=\"hljs-keyword\">return</span> guardedObjects.remove(id);\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> GuardedObject <span class=\"hljs-title function_\">createGuardedObject</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-type\">GuardedObject</span> <span class=\"hljs-variable\">go</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">GuardedObject</span>(generateId());\n        guardedObjects.put(go.getId(), go);\n        <span class=\"hljs-keyword\">return</span> go;\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> Set&lt;Integer&gt; <span class=\"hljs-title function_\">getIds</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> guardedObjects.keySet();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"699,772"}},{"content":"<pre data-lines=\"773,774\"><code>&#x8ddf;&#x4e1a;&#x52a1;&#x76f8;&#x5173;&#x7684;&#x4ee3;&#x7801;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"773,774"}},{"content":"<pre data-lines=\"775,806\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">People</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">Thread</span> {\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">run</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-type\">GuardedObject</span> <span class=\"hljs-variable\">guardedObject</span> <span class=\"hljs-operator\">=</span> GuardedObjects.createGuardedObject();\n        log.debug(<span class=\"hljs-string\">&quot;&#x5f00;&#x59cb;&#x6536;&#x4fe1; id:{}&quot;</span>, guardedObject.getId());\n        <span class=\"hljs-type\">Object</span> <span class=\"hljs-variable\">mail</span> <span class=\"hljs-operator\">=</span> guardedObject.get(<span class=\"hljs-number\">5000</span>);\n        log.debug(<span class=\"hljs-string\">&quot;&#x6536;&#x5230;&#x4fe1;&#x4ef6; id:{}, &#x5185;&#x5bb9;:{}&quot;</span>, guardedObject.getId(), mail);\n    }\n}\n\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Postman</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">Thread</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> id;\n    <span class=\"hljs-keyword\">private</span> String mail;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">Postman</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> id, String mail)</span> {\n        <span class=\"hljs-built_in\">this</span>.id = id;\n        <span class=\"hljs-built_in\">this</span>.mail = mail;\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">run</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-type\">GuardedObject</span> <span class=\"hljs-variable\">guardedObject</span> <span class=\"hljs-operator\">=</span> GuardedObjects.getGuardedObject(id);\n        log.debug(<span class=\"hljs-string\">&quot;&#x9001;&#x4fe1; id:{}, &#x5185;&#x5bb9;:{}&quot;</span>, id, mail);\n        guardedObject.complete(mail);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"775,806"}},{"content":"<pre data-lines=\"807,808\"><code>&#x8ddf;&#x6d4b;&#x8bd5;&#x76f8;&#x5173;&#x7684;&#x4ee3;&#x7801;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"807,808"}},{"content":"<pre data-lines=\"809,824\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test10</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">3</span>; i++) {\n            <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">People</span>().start();\n        }\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n        <span class=\"hljs-keyword\">for</span> (Integer id : GuardedObjects.getIds()) {\n            <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Postman</span>(id, <span class=\"hljs-string\">&quot;&#x5185;&#x5bb9;&quot;</span> + id).start();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"809,824"}},{"content":"<pre data-lines=\"825,837\"><code class=\"language-java\">16:12:56.457 [Thread-1] DEBUG com.caochenlei.People - &#x5f00;&#x59cb;&#x6536;&#x4fe1; id:3\n16:12:56.457 [Thread-2] DEBUG com.caochenlei.People - &#x5f00;&#x59cb;&#x6536;&#x4fe1; id:2\n16:12:56.457 [Thread-0] DEBUG com.caochenlei.People - &#x5f00;&#x59cb;&#x6536;&#x4fe1; id:1\n16:12:57.447 [Thread-3] DEBUG com.caochenlei.Postman - &#x9001;&#x4fe1; id:3, &#x5185;&#x5bb9;:&#x5185;&#x5bb9;3\n16:12:57.447 [Thread-1] DEBUG com.caochenlei.People - &#x6536;&#x5230;&#x4fe1;&#x4ef6; id:3, &#x5185;&#x5bb9;:&#x5185;&#x5bb9;3\n16:12:57.447 [Thread-5] DEBUG com.caochenlei.Postman - &#x9001;&#x4fe1; id:1, &#x5185;&#x5bb9;:&#x5185;&#x5bb9;1\n16:12:57.447 [Thread-0] DEBUG com.caochenlei.People - &#x6536;&#x5230;&#x4fe1;&#x4ef6; id:1, &#x5185;&#x5bb9;:&#x5185;&#x5bb9;1\n16:12:57.447 [Thread-4] DEBUG com.caochenlei.Postman - &#x9001;&#x4fe1; id:2, &#x5185;&#x5bb9;:&#x5185;&#x5bb9;2\n16:12:57.447 [Thread-2] DEBUG com.caochenlei.People - &#x6536;&#x5230;&#x4fe1;&#x4ef6; id:2, &#x5185;&#x5bb9;:&#x5185;&#x5bb9;2\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"825,837"}}],"payload":{"tag":"h3","lines":"548,549"}},{"content":"2.3.2&#x3001;&#x5f02;&#x6b65;&#x6a21;&#x5f0f;&#x4e4b;&#x751f;&#x4ea7;&#x8005;/&#x6d88;&#x8d39;&#x8005;","children":[{"content":"<pre data-lines=\"840,841\"><code>&#x4e0e;&#x524d;&#x9762;&#x7684;&#x4fdd;&#x62a4;&#x6027;&#x6682;&#x505c;&#x4e2d;&#x7684; GuardObject &#x4e0d;&#x540c;&#xff0c;&#x4e0d;&#x9700;&#x8981;&#x4ea7;&#x751f;&#x7ed3;&#x679c;&#x548c;&#x6d88;&#x8d39;&#x7ed3;&#x679c;&#x7684;&#x7ebf;&#x7a0b;&#x4e00;&#x4e00;&#x5bf9;&#x5e94;&#x3002;&#x6d88;&#x8d39;&#x961f;&#x5217;&#x53ef;&#x4ee5;&#x7528;&#x6765;&#x5e73;&#x8861;&#x751f;&#x4ea7;&#x548c;&#x6d88;&#x8d39;&#x7684;&#x7ebf;&#x7a0b;&#x8d44;&#x6e90;&#xff0c;&#x751f;&#x4ea7;&#x8005;&#x4ec5;&#x8d1f;&#x8d23;&#x4ea7;&#x751f;&#x7ed3;&#x679c;&#x6570;&#x636e;&#xff0c;&#x4e0d;&#x5173;&#x5fc3;&#x6570;&#x636e;&#x8be5;&#x5982;&#x4f55;&#x5904;&#x7406;&#xff0c;&#x800c;&#x6d88;&#x8d39;&#x8005;&#x4e13;&#x5fc3;&#x5904;&#x7406;&#x7ed3;&#x679c;&#x6570;&#x636e;&#xff0c;&#x6d88;&#x606f;&#x961f;&#x5217;&#x662f;&#x6709;&#x5bb9;&#x91cf;&#x9650;&#x5236;&#x7684;&#xff0c;&#x6ee1;&#x65f6;&#x4e0d;&#x4f1a;&#x518d;&#x52a0;&#x5165;&#x6570;&#x636e;&#xff0c;&#x7a7a;&#x65f6;&#x4e0d;&#x4f1a;&#x518d;&#x6d88;&#x8017;&#x6570;&#x636e;&#x3002;JDK &#x4e2d;&#x5404;&#x79cd;&#x963b;&#x585e;&#x961f;&#x5217;&#xff0c;&#x91c7;&#x7528;&#x7684;&#x5c31;&#x662f;&#x8fd9;&#x79cd;&#x6a21;&#x5f0f;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"840,841"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/32cef70752817177c20692865a6a1f08.png\" alt>","children":[],"payload":{"tag":"img","lines":"842,843"}},{"content":"<pre data-lines=\"844,931\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Message</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> id;\n    <span class=\"hljs-keyword\">private</span> Object message;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">Message</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> id, Object message)</span> {\n        <span class=\"hljs-built_in\">this</span>.id = id;\n        <span class=\"hljs-built_in\">this</span>.message = message;\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">getId</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> id;\n    }\n\n    <span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title function_\">getMessage</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> message;\n    }\n}\n\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MessageQueue</span> {\n    <span class=\"hljs-keyword\">private</span> LinkedList&lt;Message&gt; queue;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> capacity;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">MessageQueue</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> capacity)</span> {\n        <span class=\"hljs-built_in\">this</span>.capacity = capacity;\n        queue = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LinkedList</span>&lt;&gt;();\n    }\n\n    <span class=\"hljs-keyword\">public</span> Message <span class=\"hljs-title function_\">take</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">synchronized</span> (queue) {\n            <span class=\"hljs-keyword\">while</span> (queue.isEmpty()) {\n                log.debug(<span class=\"hljs-string\">&quot;&#x5e93;&#x5b58;&#x6ca1;&#x8d27;&#x4e86;&#xff0c;wait&quot;</span>);\n                <span class=\"hljs-keyword\">try</span> {\n                    queue.wait();\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            <span class=\"hljs-type\">Message</span> <span class=\"hljs-variable\">message</span> <span class=\"hljs-operator\">=</span> queue.removeFirst();\n            queue.notifyAll();\n            <span class=\"hljs-keyword\">return</span> message;\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">put</span><span class=\"hljs-params\">(Message message)</span> {\n        <span class=\"hljs-keyword\">synchronized</span> (queue) {\n            <span class=\"hljs-keyword\">while</span> (queue.size() == capacity) {\n                log.debug(<span class=\"hljs-string\">&quot;&#x5e93;&#x5b58;&#x5df2;&#x4e0a;&#x9650;&#xff0c;wait&quot;</span>);\n                <span class=\"hljs-keyword\">try</span> {\n                    queue.wait();\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            queue.addLast(message);\n            queue.notifyAll();\n        }\n    }\n}\n\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test11</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">MessageQueue</span> <span class=\"hljs-variable\">messageQueue</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MessageQueue</span>(<span class=\"hljs-number\">2</span>);\n        \n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">4</span>; i++) {\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">id</span> <span class=\"hljs-operator\">=</span> i;\n            <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n                log.debug(<span class=\"hljs-string\">&quot;try put message({})&quot;</span>, id);\n                messageQueue.put(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Message</span>(id, <span class=\"hljs-string\">&quot;msg&quot;</span> + id));\n            }, <span class=\"hljs-string\">&quot;&#x751f;&#x4ea7;&#x8005;&quot;</span> + id).start();\n        }\n        \n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">2</span>; i++) {\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">id</span> <span class=\"hljs-operator\">=</span> i;\n            <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n                <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n                    <span class=\"hljs-type\">Message</span> <span class=\"hljs-variable\">message</span> <span class=\"hljs-operator\">=</span> messageQueue.take();\n                    log.debug(<span class=\"hljs-string\">&quot;take message({}): {}&quot;</span>, message.getId(), message.getMessage());\n                }\n            }, <span class=\"hljs-string\">&quot;&#x6d88;&#x8d39;&#x8005;&quot;</span> + id).start();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"844,931"}},{"content":"<pre data-lines=\"932,946\"><code class=\"language-java\">09:<span class=\"hljs-number\">06</span>:<span class=\"hljs-number\">03.284</span> [&#x6d88;&#x8d39;&#x8005;<span class=\"hljs-number\">0</span>] DEBUG com.caochenlei.MessageQueue - &#x5e93;&#x5b58;&#x6ca1;&#x8d27;&#x4e86;&#xff0c;wait\n09:<span class=\"hljs-number\">06</span>:<span class=\"hljs-number\">03.268</span> [&#x751f;&#x4ea7;&#x8005;<span class=\"hljs-number\">0</span>] DEBUG com.caochenlei.Test11 - <span class=\"hljs-keyword\">try</span> put <span class=\"hljs-title function_\">message</span><span class=\"hljs-params\">(<span class=\"hljs-number\">0</span>)</span>\n09:<span class=\"hljs-number\">06</span>:<span class=\"hljs-number\">03.284</span> [&#x751f;&#x4ea7;&#x8005;<span class=\"hljs-number\">3</span>] DEBUG com.caochenlei.Test11 - <span class=\"hljs-keyword\">try</span> put <span class=\"hljs-title function_\">message</span><span class=\"hljs-params\">(<span class=\"hljs-number\">3</span>)</span>\n09:<span class=\"hljs-number\">06</span>:<span class=\"hljs-number\">03.268</span> [&#x751f;&#x4ea7;&#x8005;<span class=\"hljs-number\">2</span>] DEBUG com.caochenlei.Test11 - <span class=\"hljs-keyword\">try</span> put <span class=\"hljs-title function_\">message</span><span class=\"hljs-params\">(<span class=\"hljs-number\">2</span>)</span>\n09:<span class=\"hljs-number\">06</span>:<span class=\"hljs-number\">03.284</span> [&#x6d88;&#x8d39;&#x8005;<span class=\"hljs-number\">0</span>] DEBUG com.caochenlei.Test11 - take <span class=\"hljs-title function_\">message</span><span class=\"hljs-params\">(<span class=\"hljs-number\">0</span>)</span>: msg0\n09:<span class=\"hljs-number\">06</span>:<span class=\"hljs-number\">03.284</span> [&#x6d88;&#x8d39;&#x8005;<span class=\"hljs-number\">0</span>] DEBUG com.caochenlei.Test11 - take <span class=\"hljs-title function_\">message</span><span class=\"hljs-params\">(<span class=\"hljs-number\">3</span>)</span>: msg3\n09:<span class=\"hljs-number\">06</span>:<span class=\"hljs-number\">03.284</span> [&#x6d88;&#x8d39;&#x8005;<span class=\"hljs-number\">0</span>] DEBUG com.caochenlei.Test11 - take <span class=\"hljs-title function_\">message</span><span class=\"hljs-params\">(<span class=\"hljs-number\">2</span>)</span>: msg2\n09:<span class=\"hljs-number\">06</span>:<span class=\"hljs-number\">03.284</span> [&#x6d88;&#x8d39;&#x8005;<span class=\"hljs-number\">0</span>] DEBUG com.caochenlei.MessageQueue - &#x5e93;&#x5b58;&#x6ca1;&#x8d27;&#x4e86;&#xff0c;wait\n09:<span class=\"hljs-number\">06</span>:<span class=\"hljs-number\">03.268</span> [&#x751f;&#x4ea7;&#x8005;<span class=\"hljs-number\">1</span>] DEBUG com.caochenlei.Test11 - <span class=\"hljs-keyword\">try</span> put <span class=\"hljs-title function_\">message</span><span class=\"hljs-params\">(<span class=\"hljs-number\">1</span>)</span>\n09:<span class=\"hljs-number\">06</span>:<span class=\"hljs-number\">03.284</span> [&#x6d88;&#x8d39;&#x8005;<span class=\"hljs-number\">0</span>] DEBUG com.caochenlei.Test11 - take <span class=\"hljs-title function_\">message</span><span class=\"hljs-params\">(<span class=\"hljs-number\">1</span>)</span>: msg1\n09:<span class=\"hljs-number\">06</span>:<span class=\"hljs-number\">03.284</span> [&#x6d88;&#x8d39;&#x8005;<span class=\"hljs-number\">0</span>] DEBUG com.caochenlei.MessageQueue - &#x5e93;&#x5b58;&#x6ca1;&#x8d27;&#x4e86;&#xff0c;wait\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"932,946"}}],"payload":{"tag":"h3","lines":"838,839"}},{"content":"2.3.3&#x3001;&#x540c;&#x6b65;&#x6a21;&#x5f0f;&#x4e4b;&#x56fa;&#x5b9a;&#x987a;&#x5e8f;","children":[{"content":"<pre data-lines=\"949,950\"><code>&#x6bd4;&#x5982;&#xff0c;&#x5fc5;&#x987b;&#x5148; 2 &#x540e; 1 &#x6253;&#x5370;&#x8f93;&#x51fa;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"949,950"}},{"content":"<pre data-lines=\"951,989\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test12</span> {\n    \n    <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">Object</span> <span class=\"hljs-variable\">obj</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Object</span>();\n    \n    <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-variable\">t2runed</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">false</span>;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">synchronized</span> (obj) {\n                \n                <span class=\"hljs-keyword\">while</span> (!t2runed) {\n                    <span class=\"hljs-keyword\">try</span> {\n                        obj.wait();\n                    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n            System.out.println(<span class=\"hljs-number\">1</span>);\n        });\n        \n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t2</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            System.out.println(<span class=\"hljs-number\">2</span>);\n            <span class=\"hljs-keyword\">synchronized</span> (obj) {\n                \n                t2runed = <span class=\"hljs-literal\">true</span>;\n                \n                obj.notifyAll();\n            }\n        });\n        \n        t1.start();\n        t2.start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"951,989"}},{"content":"<pre data-lines=\"990,995\"><code class=\"language-java\">2\n1\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"990,995"}}],"payload":{"tag":"h3","lines":"947,948"}},{"content":"2.3.4&#x3001;&#x540c;&#x6b65;&#x6a21;&#x5f0f;&#x4e4b;&#x4ea4;&#x66ff;&#x8f93;&#x51fa;","children":[{"content":"<pre data-lines=\"998,999\"><code>&#x7ebf;&#x7a0b; 1 &#x8f93;&#x51fa; a 5 &#x6b21;&#xff0c;&#x7ebf;&#x7a0b; 2 &#x8f93;&#x51fa; b 5 &#x6b21;&#xff0c;&#x7ebf;&#x7a0b; 3 &#x8f93;&#x51fa; c 5 &#x6b21;&#x3002;&#x73b0;&#x5728;&#x8981;&#x6c42;&#x8f93;&#x51fa; abcabcabcabcabc &#x600e;&#x4e48;&#x5b9e;&#x73b0;&#xff1f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"998,999"}},{"content":"<pre data-lines=\"1000,1044\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SyncWaitNotify</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> flag;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> loopNumber;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">SyncWaitNotify</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> flag, <span class=\"hljs-type\">int</span> loopNumber)</span> {\n        <span class=\"hljs-built_in\">this</span>.flag = flag;\n        <span class=\"hljs-built_in\">this</span>.loopNumber = loopNumber;\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">print</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> waitFlag, <span class=\"hljs-type\">int</span> nextFlag, String str)</span> {\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; loopNumber; i++) {\n            <span class=\"hljs-keyword\">synchronized</span> (<span class=\"hljs-built_in\">this</span>) {\n                <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-built_in\">this</span>.flag != waitFlag) {\n                    <span class=\"hljs-keyword\">try</span> {\n                        <span class=\"hljs-built_in\">this</span>.wait();\n                    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                System.out.print(str);\n                flag = nextFlag;\n                <span class=\"hljs-built_in\">this</span>.notifyAll();\n            }\n        }\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test13</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">SyncWaitNotify</span> <span class=\"hljs-variable\">syncWaitNotify</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SyncWaitNotify</span>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">5</span>);\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            syncWaitNotify.print(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">&quot;a&quot;</span>);\n        }).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            syncWaitNotify.print(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-string\">&quot;b&quot;</span>);\n        }).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            syncWaitNotify.print(<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&quot;c&quot;</span>);\n        }).start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1000,1044"}},{"content":"<pre data-lines=\"1045,1049\"><code class=\"language-java\">abcabcabcabcabc\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1045,1049"}}],"payload":{"tag":"h3","lines":"996,997"}}],"payload":{"tag":"h2","lines":"532,534"}},{"content":"2.4&#x3001;park &amp; unpark&#x539f;&#x7406;","children":[{"content":"2.4.1&#x3001;&#x540c;&#x6b65;&#x6a21;&#x5f0f;&#x4e4b;&#x56fa;&#x5b9a;&#x987a;&#x5e8f;","children":[{"content":"<pre data-lines=\"1085,1086\"><code>&#x6bd4;&#x5982;&#xff0c;&#x5fc5;&#x987b;&#x5148; 2 &#x540e; 1 &#x6253;&#x5370;&#x8f93;&#x51fa;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1085,1086"}},{"content":"<pre data-lines=\"1087,1104\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test14</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            LockSupport.park();\n            System.out.println(<span class=\"hljs-string\">&quot;1&quot;</span>);\n        });\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t2</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            System.out.println(<span class=\"hljs-string\">&quot;2&quot;</span>);\n            LockSupport.unpark(t1);\n        });\n        t1.start();\n        t2.start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1087,1104"}},{"content":"<pre data-lines=\"1105,1110\"><code class=\"language-java\">2\n1\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1105,1110"}}],"payload":{"tag":"h3","lines":"1083,1084"}},{"content":"2.4.2&#x3001;&#x540c;&#x6b65;&#x6a21;&#x5f0f;&#x4e4b;&#x4ea4;&#x66ff;&#x8f93;&#x51fa;","children":[{"content":"<pre data-lines=\"1113,1114\"><code>&#x7ebf;&#x7a0b; 1 &#x8f93;&#x51fa; a 5 &#x6b21;&#xff0c;&#x7ebf;&#x7a0b; 2 &#x8f93;&#x51fa; b 5 &#x6b21;&#xff0c;&#x7ebf;&#x7a0b; 3 &#x8f93;&#x51fa; c 5 &#x6b21;&#x3002;&#x73b0;&#x5728;&#x8981;&#x6c42;&#x8f93;&#x51fa; abcabcabcabcabc &#x600e;&#x4e48;&#x5b9e;&#x73b0;&#xff1f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1113,1114"}},{"content":"<pre data-lines=\"1115,1178\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SyncPark</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> loopNumber;\n    <span class=\"hljs-keyword\">private</span> Thread[] threads;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">SyncPark</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> loopNumber)</span> {\n        <span class=\"hljs-built_in\">this</span>.loopNumber = loopNumber;\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">setThreads</span><span class=\"hljs-params\">(Thread... threads)</span> {\n        <span class=\"hljs-built_in\">this</span>.threads = threads;\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">print</span><span class=\"hljs-params\">(String str)</span> {\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; loopNumber; i++) {\n            LockSupport.park();\n            System.out.print(str);\n            LockSupport.unpark(nextThread());\n        }\n    }\n\n    <span class=\"hljs-keyword\">private</span> Thread <span class=\"hljs-title function_\">nextThread</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">current</span> <span class=\"hljs-operator\">=</span> Thread.currentThread();\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">index</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; threads.length; i++) {\n            <span class=\"hljs-keyword\">if</span> (threads[i] == current) {\n                index = i;\n                <span class=\"hljs-keyword\">break</span>;\n            }\n        }\n        <span class=\"hljs-keyword\">if</span> (index &lt; threads.length - <span class=\"hljs-number\">1</span>) {\n            <span class=\"hljs-keyword\">return</span> threads[index + <span class=\"hljs-number\">1</span>];\n        } <span class=\"hljs-keyword\">else</span> {\n            <span class=\"hljs-keyword\">return</span> threads[<span class=\"hljs-number\">0</span>];\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">start</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">for</span> (Thread thread : threads) {\n            thread.start();\n        }\n        LockSupport.unpark(threads[<span class=\"hljs-number\">0</span>]);\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test15</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">SyncPark</span> <span class=\"hljs-variable\">syncPark</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SyncPark</span>(<span class=\"hljs-number\">5</span>);\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            syncPark.print(<span class=\"hljs-string\">&quot;a&quot;</span>);\n        });\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t2</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            syncPark.print(<span class=\"hljs-string\">&quot;b&quot;</span>);\n        });\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t3</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            syncPark.print(<span class=\"hljs-string\">&quot;c&quot;</span>);\n        });\n        syncPark.setThreads(t1, t2, t3);\n        syncPark.start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1115,1178"}},{"content":"<pre data-lines=\"1179,1183\"><code class=\"language-java\">abcabcabcabcabc\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1179,1183"}}],"payload":{"tag":"h3","lines":"1111,1112"}}],"payload":{"tag":"h2","lines":"1050,1052"}},{"content":"2.5&#x3001;&#x7ebf;&#x7a0b;&#x7684;&#x72b6;&#x6001;&#x8f6c;&#x6362;","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/f04d32b0b17f6bbc477aca9fd4aa333d.png\" alt>","children":[],"payload":{"tag":"img","lines":"1187,1188"}},{"content":"<pre data-lines=\"1189,1194\"><code>&#x5047;&#x8bbe;&#x6709;&#x7ebf;&#x7a0b; Thread t\n\n**&#x60c5;&#x51b5; 1 NEW --&gt; RUNNABLE**\n\n*   &#x5f53;&#x8c03;&#x7528; t.start() &#x65b9;&#x6cd5;&#x65f6;&#xff0c;&#x7531; NEW --&gt; RUNNABLE\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1189,1194"}},{"content":"<pre data-lines=\"1195,1210\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test06</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">thread</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            System.out.println(<span class=\"hljs-string\">&quot;thread run ...&quot;</span>);\n        });\n\n        log.debug(<span class=\"hljs-string\">&quot;start&#x4e4b;&#x524d;&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, thread.getState());\n        thread.start();\n        log.debug(<span class=\"hljs-string\">&quot;start&#x4e4b;&#x540e;&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, thread.getState());\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1195,1210"}},{"content":"<pre data-lines=\"1211,1217\"><code class=\"language-java\">15:37:44.318 [main] DEBUG com.caochenlei.Test06 - start&#x4e4b;&#x524d;&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;NEW\n15:37:44.327 [main] DEBUG com.caochenlei.Test06 - start&#x4e4b;&#x540e;&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;RUNNABLE\nthread run ...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1211,1217"}},{"content":"<pre data-lines=\"1218,1226\"><code>**&#x60c5;&#x51b5; 2 RUNNABLE &lt;&#x2013;&gt; WAITING**\n\nt &#x7ebf;&#x7a0b;&#x7528; synchronized(obj) &#x83b7;&#x53d6;&#x4e86;&#x5bf9;&#x8c61;&#x9501;&#x540e;\n\n*   &#x8c03;&#x7528; obj.wait() &#x65b9;&#x6cd5;&#x65f6;&#xff0c;t &#x7ebf;&#x7a0b;&#x4ece; RUNNABLE --&gt; WAITING\n*   &#x8c03;&#x7528; obj.notify() &#xff0c;obj.notifyAll()&#xff0c;t.interrupt() &#x65f6;\n    *   &#x7ade;&#x4e89;&#x9501;&#x6210;&#x529f;&#xff0c;t &#x7ebf;&#x7a0b;&#x4ece; WAITING --&gt; RUNNABLE\n    *   &#x7ade;&#x4e89;&#x9501;&#x5931;&#x8d25;&#xff0c;t &#x7ebf;&#x7a0b;&#x4ece; WAITING --&gt; BLOCKED\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1218,1226"}},{"content":"<pre data-lines=\"1227,1276\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test07</span> {\n    <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">Object</span> <span class=\"hljs-variable\">obj</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Object</span>();\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">synchronized</span> (obj) {\n                log.debug(<span class=\"hljs-string\">&quot;&#x6267;&#x884c;....&quot;</span>);\n                <span class=\"hljs-keyword\">try</span> {\n                    obj.wait();\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                log.debug(<span class=\"hljs-string\">&quot;&#x5176;&#x5b83;&#x4ee3;&#x7801;....&quot;</span>); \n                log.debug(<span class=\"hljs-string\">&quot;t1&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, Thread.currentThread().getState());\n            }\n        }, <span class=\"hljs-string\">&quot;t1&quot;</span>);\n        t1.start();\n        log.debug(<span class=\"hljs-string\">&quot;t1&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, t1.getState());\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t2</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">synchronized</span> (obj) {\n                log.debug(<span class=\"hljs-string\">&quot;&#x6267;&#x884c;....&quot;</span>);\n                <span class=\"hljs-keyword\">try</span> {\n                    obj.wait();\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                log.debug(<span class=\"hljs-string\">&quot;&#x5176;&#x5b83;&#x4ee3;&#x7801;....&quot;</span>); \n                log.debug(<span class=\"hljs-string\">&quot;t2&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, Thread.currentThread().getState());\n            }\n        }, <span class=\"hljs-string\">&quot;t2&quot;</span>);\n        t2.start();\n        log.debug(<span class=\"hljs-string\">&quot;t2&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, t2.getState());\n        <span class=\"hljs-keyword\">try</span> {\n            Thread.sleep(<span class=\"hljs-number\">1000</span>);\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            e.printStackTrace();\n        }\n        log.debug(<span class=\"hljs-string\">&quot;&#x5524;&#x9192; obj &#x4e0a;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&quot;</span>);\n        <span class=\"hljs-keyword\">synchronized</span> (obj) {\n            log.debug(<span class=\"hljs-string\">&quot;notifyAll&#x4e4b;&#x524d;t1&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, t1.getState());\n            log.debug(<span class=\"hljs-string\">&quot;notifyAll&#x4e4b;&#x524d;t2&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, t2.getState());\n            obj.notifyAll(); \n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1227,1276"}},{"content":"<pre data-lines=\"1277,1291\"><code class=\"language-java\">15:49:43.641 [main] DEBUG com.caochenlei.Test07 - t1&#x72b6;&#x6001;&#xff1a;RUNNABLE\n15:49:43.645 [t1] DEBUG com.caochenlei.Test07 - &#x6267;&#x884c;....\n15:49:43.650 [main] DEBUG com.caochenlei.Test07 - t2&#x72b6;&#x6001;&#xff1a;RUNNABLE\n15:49:43.651 [t2] DEBUG com.caochenlei.Test07 - &#x6267;&#x884c;....\n15:49:44.662 [main] DEBUG com.caochenlei.Test07 - &#x5524;&#x9192; obj &#x4e0a;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;\n15:49:44.662 [main] DEBUG com.caochenlei.Test07 - notifyAll&#x4e4b;&#x524d;t1&#x72b6;&#x6001;&#xff1a;WAITING\n15:49:44.662 [main] DEBUG com.caochenlei.Test07 - notifyAll&#x4e4b;&#x524d;t2&#x72b6;&#x6001;&#xff1a;WAITING\n15:49:44.662 [t2] DEBUG com.caochenlei.Test07 - &#x5176;&#x5b83;&#x4ee3;&#x7801;....\n15:49:44.662 [t2] DEBUG com.caochenlei.Test07 - t2&#x72b6;&#x6001;&#xff1a;RUNNABLE\n15:49:44.662 [t1] DEBUG com.caochenlei.Test07 - &#x5176;&#x5b83;&#x4ee3;&#x7801;....\n15:49:44.662 [t1] DEBUG com.caochenlei.Test07 - t1&#x72b6;&#x6001;&#xff1a;RUNNABLE\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1277,1291"}},{"content":"<pre data-lines=\"1292,1296\"><code>**&#x60c5;&#x51b5; 3 RUNNABLE &lt;&#x2013;&gt; WAITING**\n\n*   &#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x8c03;&#x7528; t.join() &#x65b9;&#x6cd5;&#x65f6;&#xff0c;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x4ece; RUNNABLE --&gt; WAITING&#xff0c;&#x6ce8;&#x610f;&#x662f;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x5728; t &#x7ebf;&#x7a0b;&#x5bf9;&#x8c61;&#x7684;&#x76d1;&#x89c6;&#x5668;&#x4e0a;&#x7b49;&#x5f85;\n*   t &#x7ebf;&#x7a0b;&#x8fd0;&#x884c;&#x7ed3;&#x675f;&#xff0c;&#x6216;&#x8c03;&#x7528;&#x4e86;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x7684; interrupt() &#x65f6;&#xff0c;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x4ece; WAITING --&gt; RUNNABLE\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1292,1296"}},{"content":"<pre data-lines=\"1297,1332\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test08</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            System.out.println(<span class=\"hljs-string\">&quot;t1 run ...&quot;</span>);\n            <span class=\"hljs-keyword\">try</span> {\n                Thread.sleep(<span class=\"hljs-number\">5000</span>);\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        });\n\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t2</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            System.out.println(<span class=\"hljs-string\">&quot;t2 run ...&quot;</span>);\n            <span class=\"hljs-keyword\">try</span> {\n                t1.join();\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        });\n\n        t1.start();\n        t2.start();\n        log.debug(<span class=\"hljs-string\">&quot;t2&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, t2.getState());\n        <span class=\"hljs-keyword\">try</span> {\n            Thread.sleep(<span class=\"hljs-number\">1000</span>);\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            e.printStackTrace();\n        }\n        log.debug(<span class=\"hljs-string\">&quot;t2&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, t2.getState());\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1297,1332"}},{"content":"<pre data-lines=\"1333,1340\"><code class=\"language-java\">17:03:27.729 [main] DEBUG com.caochenlei.Test08 - t2&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;RUNNABLE\nt1 run ...\nt2 run ...\n17:03:28.744 [main] DEBUG com.caochenlei.Test08 - t2&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;WAITING\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1333,1340"}},{"content":"<pre data-lines=\"1341,1345\"><code>**&#x60c5;&#x51b5; 4 RUNNABLE &lt;&#x2013;&gt; WAITING**\n\n*   &#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x8c03;&#x7528; LockSupport.park() &#x65b9;&#x6cd5;&#x4f1a;&#x8ba9;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x4ece; RUNNABLE --&gt; WAITING\n*   &#x8c03;&#x7528; LockSupport.unpark(&#x76ee;&#x6807;&#x7ebf;&#x7a0b;) &#x6216;&#x8c03;&#x7528;&#x4e86;t&#x7ebf;&#x7a0b;&#x7684; interrupt() &#xff0c;&#x4f1a;&#x8ba9;&#x76ee;&#x6807;&#x7ebf;&#x7a0b;&#x4ece; WAITING --&gt; RUNNABLE\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1341,1345"}},{"content":"<pre data-lines=\"1346,1378\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test09</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">thread</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            log.debug(<span class=\"hljs-string\">&quot;park...&quot;</span>);\n            LockSupport.park();\n            log.debug(<span class=\"hljs-string\">&quot;unpark...&quot;</span>);\n            <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) ;\n        });\n\n        thread.start();\n        log.debug(<span class=\"hljs-string\">&quot;thread&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, thread.getState());\n        <span class=\"hljs-keyword\">try</span> {\n            Thread.sleep(<span class=\"hljs-number\">1000</span>);\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            e.printStackTrace();\n        }\n        log.debug(<span class=\"hljs-string\">&quot;park&#x4e4b;&#x540e;thread&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, thread.getState());\n\n        LockSupport.unpark(thread);\n        \n        <span class=\"hljs-keyword\">try</span> {\n            Thread.sleep(<span class=\"hljs-number\">1000</span>);\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            e.printStackTrace();\n        }\n        log.debug(<span class=\"hljs-string\">&quot;unpark&#x4e4b;&#x540e;thread&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;{}&quot;</span>, thread.getState());\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1346,1378"}},{"content":"<pre data-lines=\"1379,1387\"><code class=\"language-java\">17:05:55.897 [Thread-0] DEBUG com.caochenlei.Test09 - park...\n17:05:55.897 [main] DEBUG com.caochenlei.Test09 - thread&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;RUNNABLE\n17:05:56.916 [main] DEBUG com.caochenlei.Test09 - park&#x4e4b;&#x540e;thread&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;WAITING\n17:05:56.916 [Thread-0] DEBUG com.caochenlei.Test09 - unpark...\n17:05:57.928 [main] DEBUG com.caochenlei.Test09 - unpark&#x4e4b;&#x540e;thread&#x7ebf;&#x7a0b;&#x72b6;&#x6001;&#xff1a;RUNNABLE\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1379,1387"}},{"content":"<pre data-lines=\"1388,1420\"><code>**&#x60c5;&#x51b5; 5 RUNNABLE &lt;&#x2013;&gt; TIMED\\_WAITING**\n\nt &#x7ebf;&#x7a0b;&#x7528; synchronized(obj) &#x83b7;&#x53d6;&#x4e86;&#x5bf9;&#x8c61;&#x9501;&#x540e;\n\n*   &#x8c03;&#x7528; obj.wait(long n) &#x65b9;&#x6cd5;&#x65f6;&#xff0c;t &#x7ebf;&#x7a0b;&#x4ece; RUNNABLE --&gt; TIMED\\_WAITING\n*   t &#x7ebf;&#x7a0b;&#x7b49;&#x5f85;&#x65f6;&#x95f4;&#x8d85;&#x8fc7;&#x4e86; n &#x6beb;&#x79d2;&#xff0c;&#x6216;&#x8c03;&#x7528; obj.notify() &#xff0c; obj.notifyAll() &#xff0c; t.interrupt() &#x65f6;\n    *   &#x7ade;&#x4e89;&#x9501;&#x6210;&#x529f;&#xff0c;t &#x7ebf;&#x7a0b;&#x4ece; TIMED\\_WAITING --&gt; RUNNABLE\n    *   &#x7ade;&#x4e89;&#x9501;&#x5931;&#x8d25;&#xff0c;t &#x7ebf;&#x7a0b;&#x4ece; TIMED\\_WAITING --&gt; BLOCKED\n\n**&#x60c5;&#x51b5; 6 RUNNABLE &lt;&#x2013;&gt; TIMED\\_WAITING**\n\n*   &#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x8c03;&#x7528; t.join(long n) &#x65b9;&#x6cd5;&#x65f6;&#xff0c;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x4ece; RUNNABLE --&gt; TIMED\\_WAITING&#xff0c;&#x6ce8;&#x610f;&#x662f;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x5728; t &#x7ebf;&#x7a0b;&#x5bf9;&#x8c61;&#x7684;&#x76d1;&#x89c6;&#x5668;&#x4e0a;&#x7b49;&#x5f85;\n*   &#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x7b49;&#x5f85;&#x65f6;&#x95f4;&#x8d85;&#x8fc7;&#x4e86; n &#x6beb;&#x79d2;&#xff0c;&#x6216; t &#x7ebf;&#x7a0b;&#x8fd0;&#x884c;&#x7ed3;&#x675f;&#xff0c;&#x6216;&#x8c03;&#x7528;&#x4e86;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x7684; interrupt() &#x65f6;&#xff0c;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x4ece; TIMED\\_WAITING --&gt; RUNNABLE\n\n**&#x60c5;&#x51b5; 7 RUNNABLE &lt;&#x2013;&gt; TIMED\\_WAITING**\n\n*   &#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x8c03;&#x7528; Thread.sleep(long n) &#xff0c;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x4ece; RUNNABLE --&gt; TIMED\\_WAITING\n*   &#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x7b49;&#x5f85;&#x65f6;&#x95f4;&#x8d85;&#x8fc7;&#x4e86; n &#x6beb;&#x79d2;&#xff0c;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x4ece; TIMED\\_WAITING --&gt; RUNNABLE\n\n**&#x60c5;&#x51b5; 8 RUNNABLE &lt;&#x2013;&gt; TIMED\\_WAITING**\n\n*   &#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x8c03;&#x7528; LockSupport.parkNanos(long nanos) &#x6216; LockSupport.parkUntil(long millis) &#x65f6;&#xff0c;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x4ece; RUNNABLE --&gt; TIMED\\_WAITING\n*   &#x8c03;&#x7528; LockSupport.unpark(&#x76ee;&#x6807;&#x7ebf;&#x7a0b;) &#x6216;&#x8c03;&#x7528;&#x4e86;&#x7ebf;&#x7a0b; &#x7684; interrupt() &#xff0c;&#x6216;&#x662f;&#x7b49;&#x5f85;&#x8d85;&#x65f6;&#xff0c;&#x4f1a;&#x8ba9;&#x76ee;&#x6807;&#x7ebf;&#x7a0b;&#x4ece; TIMED\\_WAITING&#x2013;&gt; RUNNABLE\n\n**&#x60c5;&#x51b5; 9 RUNNABLE &lt;&#x2013;&gt; BLOCKED**\n\n*   t &#x7ebf;&#x7a0b;&#x7528; synchronized(obj) &#x83b7;&#x53d6;&#x4e86;&#x5bf9;&#x8c61;&#x9501;&#x65f6;&#x5982;&#x679c;&#x7ade;&#x4e89;&#x5931;&#x8d25;&#xff0c;&#x4ece; RUNNABLE --&gt; BLOCKED\n*   &#x6301; obj &#x9501;&#x7ebf;&#x7a0b;&#x7684;&#x540c;&#x6b65;&#x4ee3;&#x7801;&#x5757;&#x6267;&#x884c;&#x5b8c;&#x6bd5;&#xff0c;&#x4f1a;&#x5524;&#x9192;&#x8be5;&#x5bf9;&#x8c61;&#x4e0a;&#x6240;&#x6709; BLOCKED &#x7684;&#x7ebf;&#x7a0b;&#x91cd;&#x65b0;&#x7ade;&#x4e89;&#xff0c;&#x5982;&#x679c;&#x5176;&#x4e2d; t &#x7ebf;&#x7a0b;&#x7ade;&#x4e89;&#x6210;&#x529f;&#xff0c;&#x4ece; BLOCKED --&gt; RUNNABLE &#xff0c;&#x5176;&#x5b83;&#x5931;&#x8d25;&#x7684;&#x7ebf;&#x7a0b;&#x4ecd;&#x7136; BLOCKED\n\n**&#x60c5;&#x51b5; 10 RUNNABLE &lt;&#x2013;&gt; TERMINATED**\n\n*   &#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x6240;&#x6709;&#x4ee3;&#x7801;&#x8fd0;&#x884c;&#x5b8c;&#x6bd5;&#xff0c;&#x8fdb;&#x5165;TERMINATED\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1388,1420"}}],"payload":{"tag":"h2","lines":"1184,1186"}},{"content":"2.6&#x3001;&#x9501;&#x8fdb;&#x9636;&#x4e4b;&#x591a;&#x628a;&#x9501;","children":[{"content":"<pre data-lines=\"1424,1429\"><code>&#x4e00;&#x95f4;&#x5927;&#x5c4b;&#x5b50;&#x6709;&#x4e24;&#x4e2a;&#x529f;&#x80fd;&#xff1a;&#x7761;&#x89c9;&#x3001;&#x5b66;&#x4e60;&#xff0c;&#x4e92;&#x4e0d;&#x76f8;&#x5e72;&#x3002;\n\n&#x73b0;&#x5728;&#x5c0f;&#x5357;&#x8981;&#x5b66;&#x4e60;&#xff0c;&#x5c0f;&#x5973;&#x8981;&#x7761;&#x89c9;&#xff0c;&#x4f46;&#x5982;&#x679c;&#x53ea;&#x7528;&#x4e00;&#x95f4;&#x5c4b;&#x5b50;&#xff08;&#x4e00;&#x4e2a;&#x5bf9;&#x8c61;&#x9501;&#xff09;&#x7684;&#x8bdd;&#xff0c;&#x90a3;&#x4e48;&#x5e76;&#x53d1;&#x5ea6;&#x5f88;&#x4f4e;&#x3002;\n\n&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x5c06;&#x9501;&#x7684;&#x7c92;&#x5ea6;&#x7ec6;&#x5206;&#xff0c;&#x597d;&#x5904;&#x662f;&#x53ef;&#x4ee5;&#x589e;&#x5f3a;&#x5e76;&#x53d1;&#x5ea6;&#xff0c;&#x574f;&#x5904;&#x662f;&#x5982;&#x679c;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x9700;&#x8981;&#x540c;&#x65f6;&#x83b7;&#x5f97;&#x591a;&#x628a;&#x9501;&#xff0c;&#x5c31;&#x5bb9;&#x6613;&#x53d1;&#x751f;&#x6b7b;&#x9501;&#xff08;&#x540e;&#x8fb9;&#x4ecb;&#x7ecd;&#xff09;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1424,1429"}},{"content":"<pre data-lines=\"1430,1462\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BigRoom</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">Object</span> <span class=\"hljs-variable\">studyRoom</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Object</span>();\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">Object</span> <span class=\"hljs-variable\">bedRoom</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Object</span>();\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">sleep</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">synchronized</span> (bedRoom) {\n            log.debug(<span class=\"hljs-string\">&quot;sleeping 2 &#x5c0f;&#x65f6;&quot;</span>);\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">study</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">synchronized</span> (studyRoom) {\n            log.debug(<span class=\"hljs-string\">&quot;study 1 &#x5c0f;&#x65f6;&quot;</span>);\n        }\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test16</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">BigRoom</span> <span class=\"hljs-variable\">bigRoom</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BigRoom</span>();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            bigRoom.study();\n        }, <span class=\"hljs-string\">&quot;&#x5c0f;&#x5357;&quot;</span>).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            bigRoom.sleep();\n        }, <span class=\"hljs-string\">&quot;&#x5c0f;&#x5973;&quot;</span>).start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1430,1462"}},{"content":"<pre data-lines=\"1463,1468\"><code class=\"language-java\">10:00:13.809 [&#x5c0f;&#x5357;] DEBUG com.caochenlei.BigRoom - study 1 &#x5c0f;&#x65f6;\n10:00:13.809 [&#x5c0f;&#x5973;] DEBUG com.caochenlei.BigRoom - sleeping 2 &#x5c0f;&#x65f6;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1463,1468"}}],"payload":{"tag":"h2","lines":"1421,1423"}},{"content":"2.7&#x3001;&#x9501;&#x8fdb;&#x9636;&#x4e4b;&#x6d3b;&#x8dc3;&#x6027;","children":[{"content":"2.7.1&#x3001;&#x6b7b;&#x9501;","children":[{"content":"<pre data-lines=\"1474,1483\"><code>&#x6709;&#x8fd9;&#x6837;&#x7684;&#x60c5;&#x51b5;&#xff1a;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x9700;&#x8981;&#x540c;&#x65f6;&#x83b7;&#x53d6;&#x591a;&#x628a;&#x9501;&#xff0c;&#x8fd9;&#x65f6;&#x5c31;&#x5bb9;&#x6613;&#x53d1;&#x751f;&#x6b7b;&#x9501;&#x3002;\n\n&#x5047;&#x8bbe;&#xff0c;t1&#x7ebf;&#x7a0b;&#x83b7;&#x5f97;A&#x5bf9;&#x8c61;&#x9501;&#xff0c;&#x63a5;&#x4e0b;&#x6765;&#x60f3;&#x83b7;&#x53d6;B&#x5bf9;&#x8c61;&#x7684;&#x9501;&#xff0c;t2&#x7ebf;&#x7a0b;&#x83b7;&#x5f97;B&#x5bf9;&#x8c61;&#x9501;&#xff0c;&#x63a5;&#x4e0b;&#x6765;&#x60f3;&#x83b7;&#x53d6;A&#x5bf9;&#x8c61;&#x7684;&#x9501;&#xff0c;&#x7ed3;&#x679c;&#x5bfc;&#x81f4;&#x4e92;&#x76f8;&#x7b49;&#x5f85;&#xff0c;&#x9020;&#x6210;&#x6b7b;&#x9501;&#x3002;\n\n&#x68c0;&#x6d4b;&#x6b7b;&#x9501;&#x53ef;&#x4ee5;&#x4f7f;&#x7528; jconsole &#x5de5;&#x5177;&#xff0c;&#x6216;&#x8005;&#x4f7f;&#x7528; jps &#x5b9a;&#x4f4d;&#x8fdb;&#x7a0b; id&#xff0c;&#x518d;&#x7528; jstack &#x5b9a;&#x4f4d;&#x6b7b;&#x9501;&#x3002;\n\n&#x6709;&#x4e00;&#x4e2a;&#x8457;&#x540d;&#x7684;&#x95ee;&#x9898;&#xff0c;&#x54f2;&#x5b66;&#x5bb6;&#x5c31;&#x9910;&#x95ee;&#x9898;&#xff1a;\n\n&#x6709;&#x4e94;&#x4f4d;&#x54f2;&#x5b66;&#x5bb6;&#xff0c;&#x56f4;&#x5750;&#x5728;&#x5706;&#x684c;&#x65c1;&#x3002;&#x4ed6;&#x4eec;&#x53ea;&#x505a;&#x4e24;&#x4ef6;&#x4e8b;&#xff0c;&#x601d;&#x8003;&#x548c;&#x5403;&#x996d;&#xff0c;&#x601d;&#x8003;&#x4e00;&#x4f1a;&#x5403;&#x53e3;&#x996d;&#xff0c;&#x5403;&#x5b8c;&#x996d;&#x540e;&#x63a5;&#x7740;&#x601d;&#x8003;&#x3002;&#x5403;&#x996d;&#x65f6;&#x8981;&#x7528;&#x4e24;&#x6839;&#x7b77;&#x5b50;&#x5403;&#xff0c;&#x684c;&#x4e0a;&#x5171;&#x6709; 5 &#x6839;&#x7b77;&#x5b50;&#xff0c;&#x6bcf;&#x4f4d;&#x54f2;&#x5b66;&#x5bb6;&#x5de6;&#x53f3;&#x624b;&#x8fb9;&#x5404;&#x6709;&#x4e00;&#x6839;&#x7b77;&#x5b50;&#x3002;&#x5982;&#x679c;&#x7b77;&#x5b50;&#x88ab;&#x8eab;&#x8fb9;&#x7684;&#x4eba;&#x62ff;&#x7740;&#xff0c;&#x81ea;&#x5df1;&#x5c31;&#x5f97;&#x7b49;&#x5f85;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1474,1483"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/14803f6c548ef90dcc0fd02bd0b91c9c.png\" alt>","children":[],"payload":{"tag":"img","lines":"1484,1485"}},{"content":"<pre data-lines=\"1486,1549\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Chopstick</span> {\n    String name;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">Chopstick</span><span class=\"hljs-params\">(String name)</span> {\n        <span class=\"hljs-built_in\">this</span>.name = name;\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">toString</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;&#x7b77;&#x5b50;{&quot;</span> + name + <span class=\"hljs-string\">&apos;}&apos;</span>;\n    }\n}\n\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Philosopher</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">Thread</span> {\n    Chopstick left;\n    Chopstick right;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">Philosopher</span><span class=\"hljs-params\">(String name, Chopstick left, Chopstick right)</span> {\n        <span class=\"hljs-built_in\">super</span>(name);\n        <span class=\"hljs-built_in\">this</span>.left = left;\n        <span class=\"hljs-built_in\">this</span>.right = right;\n    }\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">eat</span><span class=\"hljs-params\">()</span> {\n        log.debug(<span class=\"hljs-string\">&quot;eating...&quot;</span>);\n        <span class=\"hljs-keyword\">try</span> {\n            Thread.sleep(<span class=\"hljs-number\">1000</span>);\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">run</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n            <span class=\"hljs-keyword\">synchronized</span> (left) {\n                <span class=\"hljs-keyword\">synchronized</span> (right) {\n                    eat();\n                }\n            } \n        }\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test17</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Chopstick</span> <span class=\"hljs-variable\">c1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Chopstick</span>(<span class=\"hljs-string\">&quot;1&quot;</span>);\n        <span class=\"hljs-type\">Chopstick</span> <span class=\"hljs-variable\">c2</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Chopstick</span>(<span class=\"hljs-string\">&quot;2&quot;</span>);\n        <span class=\"hljs-type\">Chopstick</span> <span class=\"hljs-variable\">c3</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Chopstick</span>(<span class=\"hljs-string\">&quot;3&quot;</span>);\n        <span class=\"hljs-type\">Chopstick</span> <span class=\"hljs-variable\">c4</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Chopstick</span>(<span class=\"hljs-string\">&quot;4&quot;</span>);\n        <span class=\"hljs-type\">Chopstick</span> <span class=\"hljs-variable\">c5</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Chopstick</span>(<span class=\"hljs-string\">&quot;5&quot;</span>);\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Philosopher</span>(<span class=\"hljs-string\">&quot;&#x82cf;&#x683c;&#x62c9;&#x5e95;&quot;</span>, c1, c2).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Philosopher</span>(<span class=\"hljs-string\">&quot;&#x67cf;&#x62c9;&#x56fe;&quot;</span>, c2, c3).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Philosopher</span>(<span class=\"hljs-string\">&quot;&#x4e9a;&#x91cc;&#x58eb;&#x591a;&#x5fb7;&quot;</span>, c3, c4).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Philosopher</span>(<span class=\"hljs-string\">&quot;&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;&quot;</span>, c4, c5).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Philosopher</span>(<span class=\"hljs-string\">&quot;&#x963f;&#x57fa;&#x7c73;&#x5fb7;&quot;</span>, c5, c1).start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1486,1549"}},{"content":"<pre data-lines=\"1550,1558\"><code class=\"language-java\">16:55:42.379 [&#x4e9a;&#x91cc;&#x58eb;&#x591a;&#x5fb7;] DEBUG com.caochenlei.Philosopher - eating...\n16:55:42.380 [&#x82cf;&#x683c;&#x62c9;&#x5e95;] DEBUG com.caochenlei.Philosopher - eating...\n16:55:43.399 [&#x963f;&#x57fa;&#x7c73;&#x5fb7;] DEBUG com.caochenlei.Philosopher - eating...\n16:55:44.407 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n16:55:45.418 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1550,1558"}}],"payload":{"tag":"h3","lines":"1472,1473"}},{"content":"2.7.2&#x3001;&#x6d3b;&#x9501;","children":[{"content":"<pre data-lines=\"1561,1562\"><code>&#x6d3b;&#x9501;&#x51fa;&#x73b0;&#x5728;&#x4e24;&#x4e2a;&#x7ebf;&#x7a0b;&#x4e92;&#x76f8;&#x6539;&#x53d8;&#x5bf9;&#x65b9;&#x7684;&#x7ed3;&#x675f;&#x6761;&#x4ef6;&#xff0c;&#x6700;&#x540e;&#x8c01;&#x4e5f;&#x65e0;&#x6cd5;&#x7ed3;&#x675f;&#xff0c;&#x4f8b;&#x5982;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1561,1562"}},{"content":"<pre data-lines=\"1563,1596\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test18</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">volatile</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">count</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">10</span>;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            \n            <span class=\"hljs-keyword\">while</span> (count &gt; <span class=\"hljs-number\">0</span>) {\n                <span class=\"hljs-keyword\">try</span> {\n                    Thread.sleep(<span class=\"hljs-number\">200</span>);\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                count--;\n                log.debug(<span class=\"hljs-string\">&quot;count: {}&quot;</span>, count);\n            }\n        }, <span class=\"hljs-string\">&quot;t1&quot;</span>).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            \n            <span class=\"hljs-keyword\">while</span> (count &lt; <span class=\"hljs-number\">20</span>) {\n                <span class=\"hljs-keyword\">try</span> {\n                    Thread.sleep(<span class=\"hljs-number\">200</span>);\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                count++;\n                log.debug(<span class=\"hljs-string\">&quot;count: {}&quot;</span>, count);\n            }\n        }, <span class=\"hljs-string\">&quot;t2&quot;</span>).start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1563,1596"}},{"content":"<pre data-lines=\"1597,1613\"><code class=\"language-java\">20:25:55.950 [t2] DEBUG com.caochenlei.Test18 - count: 12\n20:25:55.952 [t1] DEBUG com.caochenlei.Test18 - count: 11\n20:25:56.156 [t1] DEBUG com.caochenlei.Test18 - count: 10\n20:25:56.156 [t2] DEBUG com.caochenlei.Test18 - count: 11\n20:25:56.362 [t2] DEBUG com.caochenlei.Test18 - count: 11\n20:25:56.362 [t1] DEBUG com.caochenlei.Test18 - count: 10\n20:25:56.569 [t1] DEBUG com.caochenlei.Test18 - count: 10\n20:25:56.570 [t2] DEBUG com.caochenlei.Test18 - count: 11\n20:25:56.774 [t2] DEBUG com.caochenlei.Test18 - count: 12\n20:25:56.774 [t1] DEBUG com.caochenlei.Test18 - count: 11\n20:25:56.979 [t2] DEBUG com.caochenlei.Test18 - count: 10\n20:25:56.979 [t1] DEBUG com.caochenlei.Test18 - count: 10\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1597,1613"}}],"payload":{"tag":"h3","lines":"1559,1560"}},{"content":"2.7.3&#x3001;&#x9965;&#x997f;","children":[{"content":"<pre data-lines=\"1616,1617\"><code>&#x5f88;&#x591a;&#x6559;&#x7a0b;&#x4e2d;&#x628a;&#x9965;&#x997f;&#x5b9a;&#x4e49;&#x4e3a;&#xff0c;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x7531;&#x4e8e;&#x4f18;&#x5148;&#x7ea7;&#x592a;&#x4f4e;&#xff0c;&#x59cb;&#x7ec8;&#x5f97;&#x4e0d;&#x5230; CPU &#x8c03;&#x5ea6;&#x6267;&#x884c;&#xff0c;&#x4e5f;&#x4e0d;&#x80fd;&#x591f;&#x7ed3;&#x675f;&#xff0c;&#x9965;&#x997f;&#x7684;&#x60c5;&#x51b5;&#x4e0d;&#x6613;&#x6f14;&#x793a;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1616,1617"}},{"content":"<pre data-lines=\"1618,1635\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test19</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Chopstick</span> <span class=\"hljs-variable\">c1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Chopstick</span>(<span class=\"hljs-string\">&quot;1&quot;</span>);\n        <span class=\"hljs-type\">Chopstick</span> <span class=\"hljs-variable\">c2</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Chopstick</span>(<span class=\"hljs-string\">&quot;2&quot;</span>);\n        <span class=\"hljs-type\">Chopstick</span> <span class=\"hljs-variable\">c3</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Chopstick</span>(<span class=\"hljs-string\">&quot;3&quot;</span>);\n        <span class=\"hljs-type\">Chopstick</span> <span class=\"hljs-variable\">c4</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Chopstick</span>(<span class=\"hljs-string\">&quot;4&quot;</span>);\n        <span class=\"hljs-type\">Chopstick</span> <span class=\"hljs-variable\">c5</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Chopstick</span>(<span class=\"hljs-string\">&quot;5&quot;</span>);\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Philosopher</span>(<span class=\"hljs-string\">&quot;&#x82cf;&#x683c;&#x62c9;&#x5e95;&quot;</span>, c1, c2).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Philosopher</span>(<span class=\"hljs-string\">&quot;&#x67cf;&#x62c9;&#x56fe;&quot;</span>, c2, c3).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Philosopher</span>(<span class=\"hljs-string\">&quot;&#x4e9a;&#x91cc;&#x58eb;&#x591a;&#x5fb7;&quot;</span>, c3, c4).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Philosopher</span>(<span class=\"hljs-string\">&quot;&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;&quot;</span>, c4, c5).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Philosopher</span>(<span class=\"hljs-string\">&quot;&#x963f;&#x57fa;&#x7c73;&#x5fb7;&quot;</span>, c1, c5).start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1618,1635"}},{"content":"<pre data-lines=\"1636,1661\"><code class=\"language-java\">20:34:20.464 [&#x4e9a;&#x91cc;&#x58eb;&#x591a;&#x5fb7;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:20.464 [&#x82cf;&#x683c;&#x62c9;&#x5e95;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:21.481 [&#x963f;&#x57fa;&#x7c73;&#x5fb7;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:21.481 [&#x67cf;&#x62c9;&#x56fe;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:22.495 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:23.503 [&#x4e9a;&#x91cc;&#x58eb;&#x591a;&#x5fb7;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:24.518 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:24.518 [&#x67cf;&#x62c9;&#x56fe;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:25.527 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:25.527 [&#x67cf;&#x62c9;&#x56fe;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:26.538 [&#x82cf;&#x683c;&#x62c9;&#x5e95;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:26.538 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:27.547 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:28.559 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:29.571 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:30.581 [&#x4e9a;&#x91cc;&#x58eb;&#x591a;&#x5fb7;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:31.590 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:32.601 [&#x4e9a;&#x91cc;&#x58eb;&#x591a;&#x5fb7;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:33.609 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:34.611 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n20:34:35.617 [&#x8d6b;&#x62c9;&#x514b;&#x5229;&#x7279;] DEBUG com.caochenlei.Philosopher - eating...\n\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1636,1661"}}],"payload":{"tag":"h3","lines":"1614,1615"}}],"payload":{"tag":"h2","lines":"1469,1471"}},{"content":"2.8&#x3001;ReentrantLock","children":[{"content":"2.8.1&#x3001;&#x9501;&#x4ecb;&#x7ecd;","children":[{"content":"<pre data-lines=\"1667,1676\"><code>ReentrantLock &#x76f8;&#x5bf9;&#x4e8e; synchronized&#xff0c;&#x5b83;&#x5177;&#x5907;&#x5982;&#x4e0b;&#x7279;&#x70b9;&#xff1a;\n\n*   &#x53ef;&#x4e2d;&#x65ad;\n*   &#x53ef;&#x4ee5;&#x8bbe;&#x7f6e;&#x8d85;&#x65f6;&#x65f6;&#x95f4;\n*   &#x53ef;&#x4ee5;&#x8bbe;&#x7f6e;&#x4e3a;&#x516c;&#x5e73;&#x9501;\n*   &#x652f;&#x6301;&#x591a;&#x4e2a;&#x6761;&#x4ef6;&#x53d8;&#x91cf;\n*   &#x4e0e; synchronized &#x4e00;&#x6837;&#xff0c;&#x90fd;&#x652f;&#x6301;&#x53ef;&#x91cd;&#x5165;\n\n&#x57fa;&#x672c;&#x8bed;&#x6cd5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1667,1676"}},{"content":"<pre data-lines=\"1677,1690\"><code class=\"language-java\">\n<span class=\"hljs-type\">ReentrantLock</span> <span class=\"hljs-variable\">reentrantLock</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ReentrantLock</span>();\n\nreentrantLock.lock();\n<span class=\"hljs-keyword\">try</span> {\n    \n} <span class=\"hljs-keyword\">finally</span> {\n    \n    reentrantLock.unlock();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1677,1690"}}],"payload":{"tag":"h3","lines":"1665,1666"}},{"content":"2.8.2&#x3001;&#x53ef;&#x91cd;&#x5165;","children":[{"content":"<pre data-lines=\"1693,1694\"><code>&#x53ef;&#x91cd;&#x5165;&#x662f;&#x6307;&#x540c;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#xff0c;&#x5982;&#x679c;&#x9996;&#x6b21;&#x83b7;&#x5f97;&#x4e86;&#x8fd9;&#x628a;&#x9501;&#xff0c;&#x90a3;&#x4e48;&#x56e0;&#x4e3a;&#x5b83;&#x662f;&#x8fd9;&#x628a;&#x9501;&#x7684;&#x62e5;&#x6709;&#x8005;&#xff0c;&#x56e0;&#x6b64;&#x6709;&#x6743;&#x5229;&#x518d;&#x6b21;&#x83b7;&#x53d6;&#x8fd9;&#x628a;&#x9501;&#xff0c;&#x5982;&#x679c;&#x662f;&#x4e0d;&#x53ef;&#x91cd;&#x5165;&#x9501;&#xff0c;&#x90a3;&#x4e48;&#x7b2c;&#x4e8c;&#x6b21;&#x83b7;&#x5f97;&#x9501;&#x65f6;&#xff0c;&#x81ea;&#x5df1;&#x4e5f;&#x4f1a;&#x88ab;&#x9501;&#x6321;&#x4f4f;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1693,1694"}},{"content":"<pre data-lines=\"1695,1735\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test20</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">ReentrantLock</span> <span class=\"hljs-variable\">lock</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ReentrantLock</span>();\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        method1();\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">method1</span><span class=\"hljs-params\">()</span> {\n        lock.lock();\n        <span class=\"hljs-keyword\">try</span> {\n            log.debug(<span class=\"hljs-string\">&quot;execute method1&quot;</span>);\n            method2();\n        } <span class=\"hljs-keyword\">finally</span> {\n            lock.unlock();\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">method2</span><span class=\"hljs-params\">()</span> {\n        lock.lock();\n        <span class=\"hljs-keyword\">try</span> {\n            log.debug(<span class=\"hljs-string\">&quot;execute method2&quot;</span>);\n            method3();\n        } <span class=\"hljs-keyword\">finally</span> {\n            lock.unlock();\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">method3</span><span class=\"hljs-params\">()</span> {\n        lock.lock();\n        <span class=\"hljs-keyword\">try</span> {\n            log.debug(<span class=\"hljs-string\">&quot;execute method3&quot;</span>);\n        } <span class=\"hljs-keyword\">finally</span> {\n            lock.unlock();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1695,1735"}},{"content":"<pre data-lines=\"1736,1742\"><code class=\"language-java\">21:15:36.111 [main] DEBUG com.caochenlei.Test20 - execute method1\n21:15:36.141 [main] DEBUG com.caochenlei.Test20 - execute method2\n21:15:36.141 [main] DEBUG com.caochenlei.Test20 - execute method3\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1736,1742"}}],"payload":{"tag":"h3","lines":"1691,1692"}},{"content":"2.8.3&#x3001;&#x53ef;&#x6253;&#x65ad;","children":[{"content":"<pre data-lines=\"1745,1746\"><code>ReentrantLock &#x652f;&#x6301;&#x53ef;&#x6253;&#x65ad;&#xff0c;&#x5982;&#x679c;&#x662f;&#x4e0d;&#x53ef;&#x4e2d;&#x65ad;&#x6a21;&#x5f0f;&#xff0c;&#x90a3;&#x4e48;&#x5373;&#x4f7f;&#x4f7f;&#x7528;&#x4e86; interrupt &#x4e5f;&#x4e0d;&#x4f1a;&#x8ba9;&#x7b49;&#x5f85;&#x4e2d;&#x65ad;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1745,1746"}},{"content":"<pre data-lines=\"1747,1784\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test21</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">ReentrantLock</span> <span class=\"hljs-variable\">lock</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ReentrantLock</span>();\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            log.debug(<span class=\"hljs-string\">&quot;&#x542f;&#x52a8;...&quot;</span>);\n            <span class=\"hljs-keyword\">try</span> {\n                lock.lockInterruptibly();\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n                log.debug(<span class=\"hljs-string\">&quot;&#x7b49;&#x9501;&#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#x88ab;&#x6253;&#x65ad;&quot;</span>);\n                <span class=\"hljs-keyword\">return</span>;\n            }\n            <span class=\"hljs-keyword\">try</span> {\n                log.debug(<span class=\"hljs-string\">&quot;&#x83b7;&#x5f97;&#x4e86;&#x9501;&quot;</span>);\n            } <span class=\"hljs-keyword\">finally</span> {\n                lock.unlock();\n            }\n        }, <span class=\"hljs-string\">&quot;t1&quot;</span>);\n        lock.lock();\n        log.debug(<span class=\"hljs-string\">&quot;&#x83b7;&#x5f97;&#x4e86;&#x9501;&quot;</span>);\n        t1.start();\n        <span class=\"hljs-keyword\">try</span> {\n            Thread.sleep(<span class=\"hljs-number\">1000</span>);\n            t1.interrupt();\n            log.debug(<span class=\"hljs-string\">&quot;&#x6267;&#x884c;&#x6253;&#x65ad;&quot;</span>);\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            e.printStackTrace();\n        } <span class=\"hljs-keyword\">finally</span> {\n            lock.unlock();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1747,1784"}},{"content":"<pre data-lines=\"1785,1794\"><code class=\"language-java\">21:19:43.728 [main] DEBUG com.caochenlei.Test21 - &#x83b7;&#x5f97;&#x4e86;&#x9501;\n21:19:43.735 [t1] DEBUG com.caochenlei.Test21 - &#x542f;&#x52a8;...\n21:19:44.744 [main] DEBUG com.caochenlei.Test21 - &#x6267;&#x884c;&#x6253;&#x65ad;\n21:19:44.745 [t1] DEBUG com.caochenlei.Test21 - &#x7b49;&#x9501;&#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#x88ab;&#x6253;&#x65ad;\njava.lang.InterruptedException\n    at com.caochenlei.Test21.lambda&#x24;main&#x24;0(Test21.java:15)\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1785,1794"}}],"payload":{"tag":"h3","lines":"1743,1744"}},{"content":"2.8.4&#x3001;&#x9501;&#x8d85;&#x65f6;","children":[{"content":"<pre data-lines=\"1797,1829\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test22</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">ReentrantLock</span> <span class=\"hljs-variable\">lock</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ReentrantLock</span>();\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            log.debug(<span class=\"hljs-string\">&quot;&#x542f;&#x52a8;...&quot;</span>);\n            <span class=\"hljs-keyword\">if</span> (!lock.tryLock()) {\n                log.debug(<span class=\"hljs-string\">&quot;&#x83b7;&#x53d6;&#x5931;&#x8d25;&#xff0c;&#x8fd4;&#x56de;&quot;</span>);\n                <span class=\"hljs-keyword\">return</span>;\n            }\n            <span class=\"hljs-keyword\">try</span> {\n                log.debug(<span class=\"hljs-string\">&quot;&#x83b7;&#x5f97;&#x4e86;&#x9501;&quot;</span>);\n            } <span class=\"hljs-keyword\">finally</span> {\n                lock.unlock();\n            }\n        }, <span class=\"hljs-string\">&quot;t1&quot;</span>);\n        lock.lock();\n        log.debug(<span class=\"hljs-string\">&quot;&#x83b7;&#x5f97;&#x4e86;&#x9501;&quot;</span>);\n        t1.start();\n        <span class=\"hljs-keyword\">try</span> {\n            Thread.sleep(<span class=\"hljs-number\">2000</span>);\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            e.printStackTrace();\n        } <span class=\"hljs-keyword\">finally</span> {\n            lock.unlock();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1797,1829"}},{"content":"<pre data-lines=\"1830,1836\"><code class=\"language-java\">21:39:41.239 [main] DEBUG com.caochenlei.Test22 - &#x83b7;&#x5f97;&#x4e86;&#x9501;\n21:39:41.247 [t1] DEBUG com.caochenlei.Test22 - &#x542f;&#x52a8;...\n21:39:41.247 [t1] DEBUG com.caochenlei.Test22 - &#x83b7;&#x53d6;&#x5931;&#x8d25;&#xff0c;&#x8fd4;&#x56de;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1830,1836"}}],"payload":{"tag":"h3","lines":"1795,1796"}},{"content":"2.8.5&#x3001;&#x516c;&#x5e73;&#x9501;","children":[{"content":"<pre data-lines=\"1839,1840\"><code>ReentrantLock &#x9ed8;&#x8ba4;&#x662f;&#x4e0d;&#x516c;&#x5e73;&#x7684;&#xff0c;&#x6539;&#x4e3a;&#x516c;&#x5e73;&#x9501;&#x8bed;&#x6cd5;&#x5982;&#x4e0b;&#xff0c;&#x516c;&#x5e73;&#x9501;&#x4e00;&#x822c;&#x6ca1;&#x6709;&#x5fc5;&#x8981;&#xff0c;&#x4f1a;&#x964d;&#x4f4e;&#x5e76;&#x53d1;&#x5ea6;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1839,1840"}},{"content":"<pre data-lines=\"1841,1845\"><code class=\"language-java\"><span class=\"hljs-type\">ReentrantLock</span> <span class=\"hljs-variable\">lock</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ReentrantLock</span>(<span class=\"hljs-literal\">true</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1841,1845"}}],"payload":{"tag":"h3","lines":"1837,1838"}},{"content":"2.8.6&#x3001;&#x6761;&#x4ef6;&#x53d8;&#x91cf;","children":[{"content":"<pre data-lines=\"1848,1856\"><code>synchronized &#x4e2d;&#x4e5f;&#x6709;&#x6761;&#x4ef6;&#x53d8;&#x91cf;&#xff0c;&#x5c31;&#x662f;&#x6211;&#x4eec;&#x8bb2;&#x539f;&#x7406;&#x65f6;&#x90a3;&#x4e2a; waitSet &#x4f11;&#x606f;&#x5ba4;&#xff0c;&#x5f53;&#x6761;&#x4ef6;&#x4e0d;&#x6ee1;&#x8db3;&#x65f6;&#x8fdb;&#x5165; waitSet &#x7b49;&#x5f85;&#xff0c;ReentrantLock &#x7684;&#x6761;&#x4ef6;&#x53d8;&#x91cf;&#x6bd4; synchronized &#x5f3a;&#x5927;&#x4e4b;&#x5904;&#x5728;&#x4e8e;&#xff0c;&#x5b83;&#x662f;&#x652f;&#x6301;&#x591a;&#x4e2a;&#x6761;&#x4ef6;&#x53d8;&#x91cf;&#x7684;&#xff0c;&#x8fd9;&#x5c31;&#x597d;&#x6bd4; synchronized &#x662f;&#x90a3;&#x4e9b;&#x4e0d;&#x6ee1;&#x8db3;&#x6761;&#x4ef6;&#x7684;&#x7ebf;&#x7a0b;&#x90fd;&#x5728;&#x4e00;&#x95f4;&#x4f11;&#x606f;&#x5ba4;&#x7b49;&#x6d88;&#x606f;&#xff0c;&#x800c; ReentrantLock &#x652f;&#x6301;&#x591a;&#x95f4;&#x4f11;&#x606f;&#x5ba4;&#xff0c;&#x6709;&#x4e13;&#x95e8;&#x7b49;&#x70df;&#x7684;&#x4f11;&#x606f;&#x5ba4;&#x3001;&#x4e13;&#x95e8;&#x7b49;&#x65e9;&#x9910;&#x7684;&#x4f11;&#x606f;&#x5ba4;&#x3001;&#x5524;&#x9192;&#x65f6;&#x4e5f;&#x662f;&#x6309;&#x4f11;&#x606f;&#x5ba4;&#x6765;&#x5524;&#x9192;&#x3002;\n\n&#x4f7f;&#x7528;&#x8981;&#x70b9;&#xff1a;\n\n*   await &#x524d;&#x9700;&#x8981;&#x83b7;&#x5f97;&#x9501;\n*   await &#x6267;&#x884c;&#x540e;&#xff0c;&#x4f1a;&#x91ca;&#x653e;&#x9501;&#xff0c;&#x8fdb;&#x5165; conditionObject &#x7b49;&#x5f85;\n*   await &#x7684;&#x7ebf;&#x7a0b;&#x88ab;&#x5524;&#x9192;&#xff08;&#x6216;&#x6253;&#x65ad;&#x3001;&#x6216;&#x8d85;&#x65f6;&#xff09;&#x53bb;&#x91cd;&#x65b0;&#x7ade;&#x4e89; lock &#x9501;\n*   &#x7ade;&#x4e89; lock &#x9501;&#x6210;&#x529f;&#x540e;&#xff0c;&#x4ece; await &#x540e;&#x7ee7;&#x7eed;&#x6267;&#x884c;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1848,1856"}},{"content":"<pre data-lines=\"1857,1927\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test23</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">ReentrantLock</span> <span class=\"hljs-variable\">lock</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ReentrantLock</span>();\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">Condition</span> <span class=\"hljs-variable\">waitCigaretteQueue</span> <span class=\"hljs-operator\">=</span> lock.newCondition();\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">Condition</span> <span class=\"hljs-variable\">waitbreakfastQueue</span> <span class=\"hljs-operator\">=</span> lock.newCondition();\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">volatile</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-variable\">hasCigrette</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">false</span>;\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">volatile</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-variable\">hasBreakfast</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">false</span>;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                lock.lock();\n                <span class=\"hljs-keyword\">while</span> (!hasCigrette) {\n                    <span class=\"hljs-keyword\">try</span> {\n                        waitCigaretteQueue.await();\n                    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                log.debug(<span class=\"hljs-string\">&quot;&#x7b49;&#x5230;&#x4e86;&#x5b83;&#x7684;&#x70df;&quot;</span>);\n            } <span class=\"hljs-keyword\">finally</span> {\n                lock.unlock();\n            }\n        }).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                lock.lock();\n                <span class=\"hljs-keyword\">while</span> (!hasBreakfast) {\n                    <span class=\"hljs-keyword\">try</span> {\n                        waitbreakfastQueue.await();\n                    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                log.debug(<span class=\"hljs-string\">&quot;&#x7b49;&#x5230;&#x4e86;&#x5b83;&#x7684;&#x65e9;&#x9910;&quot;</span>);\n            } <span class=\"hljs-keyword\">finally</span> {\n                lock.unlock();\n            }\n        }).start();\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n        sendBreakfast();\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n        sendCigarette();\n    }\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">sendCigarette</span><span class=\"hljs-params\">()</span> {\n        lock.lock();\n        <span class=\"hljs-keyword\">try</span> {\n            log.debug(<span class=\"hljs-string\">&quot;&#x9001;&#x70df;&#x6765;&#x4e86;&quot;</span>);\n            hasCigrette = <span class=\"hljs-literal\">true</span>;\n            waitCigaretteQueue.signal();\n        } <span class=\"hljs-keyword\">finally</span> {\n            lock.unlock();\n        }\n    }\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">sendBreakfast</span><span class=\"hljs-params\">()</span> {\n        lock.lock();\n        <span class=\"hljs-keyword\">try</span> {\n            log.debug(<span class=\"hljs-string\">&quot;&#x9001;&#x65e9;&#x9910;&#x6765;&#x4e86;&quot;</span>);\n            hasBreakfast = <span class=\"hljs-literal\">true</span>;\n            waitbreakfastQueue.signal();\n        } <span class=\"hljs-keyword\">finally</span> {\n            lock.unlock();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1857,1927"}},{"content":"<pre data-lines=\"1928,1935\"><code class=\"language-java\">21:45:25.187 [main] DEBUG com.caochenlei.Test23 - &#x9001;&#x65e9;&#x9910;&#x6765;&#x4e86;\n21:45:25.192 [Thread-1] DEBUG com.caochenlei.Test23 - &#x7b49;&#x5230;&#x4e86;&#x5b83;&#x7684;&#x65e9;&#x9910;\n21:45:26.195 [main] DEBUG com.caochenlei.Test23 - &#x9001;&#x70df;&#x6765;&#x4e86;\n21:45:26.195 [Thread-0] DEBUG com.caochenlei.Test23 - &#x7b49;&#x5230;&#x4e86;&#x5b83;&#x7684;&#x70df;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1928,1935"}}],"payload":{"tag":"h3","lines":"1846,1847"}},{"content":"2.8.7&#x3001;&#x4ea4;&#x66ff;&#x8f93;&#x51fa;","children":[{"content":"<pre data-lines=\"1938,1939\"><code>&#x7ebf;&#x7a0b; 1 &#x8f93;&#x51fa; a 5 &#x6b21;&#xff0c;&#x7ebf;&#x7a0b; 2 &#x8f93;&#x51fa; b 5 &#x6b21;&#xff0c;&#x7ebf;&#x7a0b; 3 &#x8f93;&#x51fa; c 5 &#x6b21;&#x3002;&#x73b0;&#x5728;&#x8981;&#x6c42;&#x8f93;&#x51fa; abcabcabcabcabc &#x600e;&#x4e48;&#x5b9e;&#x73b0;&#xff1f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1938,1939"}},{"content":"<pre data-lines=\"1940,1993\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AwaitSignal</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">ReentrantLock</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> loopNumber;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">AwaitSignal</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> loopNumber)</span> {\n        <span class=\"hljs-built_in\">this</span>.loopNumber = loopNumber;\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">start</span><span class=\"hljs-params\">(Condition first)</span> {\n        <span class=\"hljs-built_in\">this</span>.lock();\n        <span class=\"hljs-keyword\">try</span> {\n            first.signal();\n        } <span class=\"hljs-keyword\">finally</span> {\n            <span class=\"hljs-built_in\">this</span>.unlock();\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">print</span><span class=\"hljs-params\">(String str, Condition current, Condition next)</span> {\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; loopNumber; i++) {\n            <span class=\"hljs-built_in\">this</span>.lock();\n            <span class=\"hljs-keyword\">try</span> {\n                current.await();\n                System.out.print(str);\n                next.signal();\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            } <span class=\"hljs-keyword\">finally</span> {\n                <span class=\"hljs-built_in\">this</span>.unlock();\n            }\n        }\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test24</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">AwaitSignal</span> <span class=\"hljs-variable\">as</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AwaitSignal</span>(<span class=\"hljs-number\">5</span>);\n        <span class=\"hljs-type\">Condition</span> <span class=\"hljs-variable\">aWaitSet</span> <span class=\"hljs-operator\">=</span> as.newCondition();\n        <span class=\"hljs-type\">Condition</span> <span class=\"hljs-variable\">bWaitSet</span> <span class=\"hljs-operator\">=</span> as.newCondition();\n        <span class=\"hljs-type\">Condition</span> <span class=\"hljs-variable\">cWaitSet</span> <span class=\"hljs-operator\">=</span> as.newCondition();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            as.print(<span class=\"hljs-string\">&quot;a&quot;</span>, aWaitSet, bWaitSet);\n        }).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            as.print(<span class=\"hljs-string\">&quot;b&quot;</span>, bWaitSet, cWaitSet);\n        }).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            as.print(<span class=\"hljs-string\">&quot;c&quot;</span>, cWaitSet, aWaitSet);\n        }).start();\n        as.start(aWaitSet);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1940,1993"}},{"content":"<pre data-lines=\"1994,1998\"><code class=\"language-java\">abcabcabcabcabc\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1994,1998"}}],"payload":{"tag":"h3","lines":"1936,1937"}}],"payload":{"tag":"h2","lines":"1662,1664"}},{"content":"3.1&#x3001;&#x5185;&#x5b58;&#x6a21;&#x578b;","children":[{"content":"<pre data-lines=\"2002,2003\"><code>JMM&#xff0c;&#x5373;&#x4e3a;Java&#x5185;&#x5b58;&#x6a21;&#x578b;&#xff08;java memory model&#xff09;&#x3002;&#x56e0;&#x4e3a;&#x5728;&#x4e0d;&#x540c;&#x7684;&#x786c;&#x4ef6;&#x751f;&#x4ea7;&#x5546;&#x548c;&#x4e0d;&#x540c;&#x7684;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x4e0b;&#xff0c;&#x5185;&#x5b58;&#x7684;&#x8bbf;&#x95ee;&#x903b;&#x8f91;&#x6709;&#x4e00;&#x5b9a;&#x7684;&#x5dee;&#x5f02;&#xff0c;&#x7ed3;&#x679c;&#x5c31;&#x662f;&#x5f53;&#x4f60;&#x7684;&#x4ee3;&#x7801;&#x5728;&#x67d0;&#x4e2a;&#x7cfb;&#x7edf;&#x73af;&#x5883;&#x4e0b;&#x8fd0;&#x884c;&#x826f;&#x597d;&#xff0c;&#x5e76;&#x4e14;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;&#xff0c;&#x4f46;&#x662f;&#x6362;&#x4e86;&#x4e2a;&#x7cfb;&#x7edf;&#x5c31;&#x51fa;&#x73b0;&#x5404;&#x79cd;&#x95ee;&#x9898;&#x3002;Java&#x5185;&#x5b58;&#x6a21;&#x578b;&#xff0c;&#x5c31;&#x662f;&#x4e3a;&#x4e86;&#x5c4f;&#x853d;&#x7cfb;&#x7edf;&#x548c;&#x786c;&#x4ef6;&#x7684;&#x5dee;&#x5f02;&#xff0c;&#x8ba9;&#x4e00;&#x5957;&#x4ee3;&#x7801;&#x5728;&#x4e0d;&#x540c;&#x5e73;&#x53f0;&#x4e0b;&#x80fd;&#x5230;&#x8fbe;&#x76f8;&#x540c;&#x7684;&#x8bbf;&#x95ee;&#x7ed3;&#x679c;&#x3002;JMM&#x4ece;Java 5&#x5f00;&#x59cb;&#x7684;JSR-133&#x53d1;&#x5e03;&#x540e;&#xff0c;&#x5df2;&#x7ecf;&#x6210;&#x719f;&#x548c;&#x5b8c;&#x5584;&#x8d77;&#x6765;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2002,2003"}}],"payload":{"tag":"h2","lines":"1999,2001"}},{"content":"3.2&#x3001;&#x5185;&#x5b58;&#x5212;&#x5206;","children":[{"content":"<pre data-lines=\"2007,2008\"><code>JMM&#x89c4;&#x5b9a;&#x4e86;&#x5185;&#x5b58;&#x4e3b;&#x8981;&#x5212;&#x5206;&#x4e3a;&#x4e3b;&#x5185;&#x5b58;&#x548c;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e24;&#x79cd;&#x3002;&#x6b64;&#x5904;&#x7684;&#x4e3b;&#x5185;&#x5b58;&#x548c;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x8ddf;JVM&#x5185;&#x5b58;&#x5212;&#x5206;&#xff08;&#x5806;&#x3001;&#x6808;&#x3001;&#x65b9;&#x6cd5;&#x533a;&#xff09;&#x662f;&#x5728;&#x4e0d;&#x540c;&#x7684;&#x5c42;&#x6b21;&#x4e0a;&#x8fdb;&#x884c;&#x7684;&#xff0c;&#x5982;&#x679c;&#x975e;&#x8981;&#x5bf9;&#x5e94;&#x8d77;&#x6765;&#xff0c;&#x4e3b;&#x5185;&#x5b58;&#x5bf9;&#x5e94;&#x7684;&#x662f;Java&#x5806;&#x4e2d;&#x7684;&#x5bf9;&#x8c61;&#x5b9e;&#x4f8b;&#x90e8;&#x5206;&#xff0c;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x5bf9;&#x5e94;&#x7684;&#x662f;&#x6808;&#x4e2d;&#x7684;&#x90e8;&#x5206;&#x533a;&#x57df;&#xff0c;&#x4ece;&#x66f4;&#x5e95;&#x5c42;&#x7684;&#x6765;&#x8bf4;&#xff0c;&#x4e3b;&#x5185;&#x5b58;&#x5bf9;&#x5e94;&#x7684;&#x662f;&#x786c;&#x4ef6;&#x7684;&#x7269;&#x7406;&#x5185;&#x5b58;&#xff0c;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x5bf9;&#x5e94;&#x7684;&#x662f;&#x5bc4;&#x5b58;&#x5668;&#x548c;&#x9ad8;&#x901f;&#x7f13;&#x5b58;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2007,2008"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/253212f078b672cb15d02af85a9c8383.png\" alt>","children":[],"payload":{"tag":"img","lines":"2009,2010"}},{"content":"<pre data-lines=\"2011,2012\"><code>JVM&#x5728;&#x8bbe;&#x8ba1;&#x65f6;&#x5019;&#x8003;&#x8651;&#x5230;&#xff0c;&#x5982;&#x679c;Java&#x7ebf;&#x7a0b;&#x6bcf;&#x6b21;&#x8bfb;&#x53d6;&#x548c;&#x5199;&#x5165;&#x53d8;&#x91cf;&#x90fd;&#x76f4;&#x63a5;&#x64cd;&#x4f5c;&#x4e3b;&#x5185;&#x5b58;&#xff0c;&#x5bf9;&#x6027;&#x80fd;&#x5f71;&#x54cd;&#x6bd4;&#x8f83;&#x5927;&#xff0c;&#x6240;&#x4ee5;&#x6bcf;&#x6761;&#x7ebf;&#x7a0b;&#x62e5;&#x6709;&#x5404;&#x81ea;&#x7684;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#xff0c;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e2d;&#x7684;&#x53d8;&#x91cf;&#x662f;&#x4e3b;&#x5185;&#x5b58;&#x4e2d;&#x7684;&#x4e00;&#x4efd;&#x62f7;&#x8d1d;&#xff0c;&#x7ebf;&#x7a0b;&#x5bf9;&#x53d8;&#x91cf;&#x7684;&#x8bfb;&#x53d6;&#x548c;&#x5199;&#x5165;&#xff0c;&#x76f4;&#x63a5;&#x5728;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e2d;&#x64cd;&#x4f5c;&#xff0c;&#x800c;&#x4e0d;&#x80fd;&#x76f4;&#x63a5;&#x53bb;&#x64cd;&#x4f5c;&#x4e3b;&#x5185;&#x5b58;&#x4e2d;&#x7684;&#x53d8;&#x91cf;&#x3002;&#x4f46;&#x662f;&#x8fd9;&#x6837;&#x5c31;&#x4f1a;&#x51fa;&#x73b0;&#x4e00;&#x4e2a;&#x95ee;&#x9898;&#xff0c;&#x5f53;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x4fee;&#x6539;&#x4e86;&#x81ea;&#x5df1;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e2d;&#x53d8;&#x91cf;&#xff0c;&#x5bf9;&#x5176;&#x4ed6;&#x7ebf;&#x7a0b;&#x662f;&#x4e0d;&#x53ef;&#x89c1;&#x7684;&#xff0c;&#x4f1a;&#x5bfc;&#x81f4;&#x7ebf;&#x7a0b;&#x4e0d;&#x5b89;&#x5168;&#x7684;&#x95ee;&#x9898;&#x3002;&#x56e0;&#x4e3a;JMM&#x5236;&#x5b9a;&#x4e86;&#x4e00;&#x5957;&#x6807;&#x51c6;&#x6765;&#x4fdd;&#x8bc1;&#x5f00;&#x53d1;&#x8005;&#x5728;&#x7f16;&#x5199;&#x591a;&#x7ebf;&#x7a0b;&#x7a0b;&#x5e8f;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x80fd;&#x591f;&#x63a7;&#x5236;&#x4ec0;&#x4e48;&#x65f6;&#x5019;&#x5185;&#x5b58;&#x4f1a;&#x88ab;&#x540c;&#x6b65;&#x7ed9;&#x5176;&#x4ed6;&#x7ebf;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2011,2012"}}],"payload":{"tag":"h2","lines":"2004,2006"}},{"content":"3.3&#x3001;&#x5185;&#x5b58;&#x4ea4;&#x4e92;","children":[{"content":"<pre data-lines=\"2016,2037\"><code>&#x5185;&#x5b58;&#x4ea4;&#x4e92;&#x64cd;&#x4f5c;&#x6709;8&#x79cd;&#xff0c;&#x865a;&#x62df;&#x673a;&#x5b9e;&#x73b0;&#x5fc5;&#x987b;&#x4fdd;&#x8bc1;&#x6bcf;&#x4e00;&#x4e2a;&#x64cd;&#x4f5c;&#x90fd;&#x662f;&#x539f;&#x5b50;&#x7684;&#xff0c;&#x4e0d;&#x53ef;&#x5728;&#x5206;&#x7684;&#xff08;&#x5bf9;&#x4e8e;double&#x548c;long&#x7c7b;&#x578b;&#x7684;&#x53d8;&#x91cf;&#x6765;&#x8bf4;&#xff0c;load&#x3001;store&#x3001;read&#x548c;write&#x64cd;&#x4f5c;&#x5728;&#x67d0;&#x4e9b;&#x5e73;&#x53f0;&#x4e0a;&#x5141;&#x8bb8;&#x4f8b;&#x5916;&#xff09;\n\n*   lock &#xff08;&#x9501;&#x5b9a;&#xff09;&#xff1a;&#x4f5c;&#x7528;&#x4e8e;&#x4e3b;&#x5185;&#x5b58;&#x7684;&#x53d8;&#x91cf;&#xff0c;&#x628a;&#x4e00;&#x4e2a;&#x53d8;&#x91cf;&#x6807;&#x8bc6;&#x4e3a;&#x7ebf;&#x7a0b;&#x72ec;&#x5360;&#x72b6;&#x6001;\n*   unlock &#xff08;&#x89e3;&#x9501;&#xff09;&#xff1a;&#x4f5c;&#x7528;&#x4e8e;&#x4e3b;&#x5185;&#x5b58;&#x7684;&#x53d8;&#x91cf;&#xff0c;&#x5b83;&#x628a;&#x4e00;&#x4e2a;&#x5904;&#x4e8e;&#x9501;&#x5b9a;&#x72b6;&#x6001;&#x7684;&#x53d8;&#x91cf;&#x91ca;&#x653e;&#x51fa;&#x6765;&#xff0c;&#x91ca;&#x653e;&#x540e;&#x7684;&#x53d8;&#x91cf;&#x624d;&#x53ef;&#x4ee5;&#x88ab;&#x5176;&#x4ed6;&#x7ebf;&#x7a0b;&#x9501;&#x5b9a;\n*   read &#xff08;&#x8bfb;&#x53d6;&#xff09;&#xff1a;&#x4f5c;&#x7528;&#x4e8e;&#x4e3b;&#x5185;&#x5b58;&#x53d8;&#x91cf;&#xff0c;&#x5b83;&#x628a;&#x4e00;&#x4e2a;&#x53d8;&#x91cf;&#x7684;&#x503c;&#x4ece;&#x4e3b;&#x5185;&#x5b58;&#x4f20;&#x8f93;&#x5230;&#x7ebf;&#x7a0b;&#x7684;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e2d;&#xff0c;&#x4ee5;&#x4fbf;&#x968f;&#x540e;&#x7684;load&#x52a8;&#x4f5c;&#x4f7f;&#x7528;\n*   load &#xff08;&#x8f7d;&#x5165;&#xff09;&#xff1a;&#x4f5c;&#x7528;&#x4e8e;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x7684;&#x53d8;&#x91cf;&#xff0c;&#x5b83;&#x628a;read&#x64cd;&#x4f5c;&#x4ece;&#x4e3b;&#x5b58;&#x4e2d;&#x53d8;&#x91cf;&#x653e;&#x5165;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e2d;\n*   use &#xff08;&#x4f7f;&#x7528;&#xff09;&#xff1a;&#x4f5c;&#x7528;&#x4e8e;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e2d;&#x7684;&#x53d8;&#x91cf;&#xff0c;&#x5b83;&#x628a;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e2d;&#x7684;&#x53d8;&#x91cf;&#x4f20;&#x8f93;&#x7ed9;&#x6267;&#x884c;&#x5f15;&#x64ce;&#xff0c;&#x6bcf;&#x5f53;&#x865a;&#x62df;&#x673a;&#x9047;&#x5230;&#x4e00;&#x4e2a;&#x9700;&#x8981;&#x4f7f;&#x7528;&#x5230;&#x53d8;&#x91cf;&#x7684;&#x503c;&#xff0c;&#x5c31;&#x4f1a;&#x4f7f;&#x7528;&#x5230;&#x8fd9;&#x4e2a;&#x6307;&#x4ee4;\n*   assign &#xff08;&#x8d4b;&#x503c;&#xff09;&#xff1a;&#x4f5c;&#x7528;&#x4e8e;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e2d;&#x7684;&#x53d8;&#x91cf;&#xff0c;&#x5b83;&#x628a;&#x4e00;&#x4e2a;&#x4ece;&#x6267;&#x884c;&#x5f15;&#x64ce;&#x4e2d;&#x63a5;&#x53d7;&#x5230;&#x7684;&#x503c;&#x653e;&#x5165;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x7684;&#x53d8;&#x91cf;&#x526f;&#x672c;&#x4e2d;\n*   store &#xff08;&#x5b58;&#x50a8;&#xff09;&#xff1a;&#x4f5c;&#x7528;&#x4e8e;&#x4e3b;&#x5185;&#x5b58;&#x4e2d;&#x7684;&#x53d8;&#x91cf;&#xff0c;&#x5b83;&#x628a;&#x4e00;&#x4e2a;&#x4ece;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e2d;&#x4e00;&#x4e2a;&#x53d8;&#x91cf;&#x7684;&#x503c;&#x4f20;&#x9001;&#x5230;&#x4e3b;&#x5185;&#x5b58;&#x4e2d;&#xff0c;&#x4ee5;&#x4fbf;&#x540e;&#x7eed;&#x7684;write&#x4f7f;&#x7528;\n*   write &#x3000;&#xff08;&#x5199;&#x5165;&#xff09;&#xff1a;&#x4f5c;&#x7528;&#x4e8e;&#x4e3b;&#x5185;&#x5b58;&#x4e2d;&#x7684;&#x53d8;&#x91cf;&#xff0c;&#x5b83;&#x628a;store&#x64cd;&#x4f5c;&#x4ece;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e2d;&#x5f97;&#x5230;&#x7684;&#x53d8;&#x91cf;&#x7684;&#x503c;&#x653e;&#x5165;&#x4e3b;&#x5185;&#x5b58;&#x7684;&#x53d8;&#x91cf;&#x4e2d;\n\nJMM&#x5bf9;&#x8fd9;&#x516b;&#x79cd;&#x6307;&#x4ee4;&#x7684;&#x4f7f;&#x7528;&#xff0c;&#x5236;&#x5b9a;&#x4e86;&#x5982;&#x4e0b;&#x89c4;&#x5219;&#xff1a;\n\n*   &#x4e0d;&#x5141;&#x8bb8;read&#x548c;load&#x3001;store&#x548c;write&#x64cd;&#x4f5c;&#x4e4b;&#x4e00;&#x5355;&#x72ec;&#x51fa;&#x73b0;&#x3002;&#x5373;&#x4f7f;&#x7528;&#x4e86;read&#x5fc5;&#x987b;load&#xff0c;&#x4f7f;&#x7528;&#x4e86;store&#x5fc5;&#x987b;write\n*   &#x4e0d;&#x5141;&#x8bb8;&#x7ebf;&#x7a0b;&#x4e22;&#x5f03;&#x4ed6;&#x6700;&#x8fd1;&#x7684;assign&#x64cd;&#x4f5c;&#xff0c;&#x5373;&#x5de5;&#x4f5c;&#x53d8;&#x91cf;&#x7684;&#x6570;&#x636e;&#x6539;&#x53d8;&#x4e86;&#x4e4b;&#x540e;&#xff0c;&#x5fc5;&#x987b;&#x544a;&#x77e5;&#x4e3b;&#x5b58;\n*   &#x4e0d;&#x5141;&#x8bb8;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x5c06;&#x6ca1;&#x6709;assign&#x7684;&#x6570;&#x636e;&#x4ece;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x540c;&#x6b65;&#x56de;&#x4e3b;&#x5185;&#x5b58;\n*   &#x4e00;&#x4e2a;&#x65b0;&#x7684;&#x53d8;&#x91cf;&#x5fc5;&#x987b;&#x5728;&#x4e3b;&#x5185;&#x5b58;&#x4e2d;&#x8bde;&#x751f;&#xff0c;&#x4e0d;&#x5141;&#x8bb8;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x76f4;&#x63a5;&#x4f7f;&#x7528;&#x4e00;&#x4e2a;&#x672a;&#x88ab;&#x521d;&#x59cb;&#x5316;&#x7684;&#x53d8;&#x91cf;&#x3002;&#x5c31;&#x662f;&#x5bf9;&#x53d8;&#x91cf;&#x5b9e;&#x65bd;use&#x3001;store&#x64cd;&#x4f5c;&#x4e4b;&#x524d;&#xff0c;&#x5fc5;&#x987b;&#x7ecf;&#x8fc7;assign&#x548c;load&#x64cd;&#x4f5c;\n*   &#x4e00;&#x4e2a;&#x53d8;&#x91cf;&#x540c;&#x4e00;&#x65f6;&#x95f4;&#x53ea;&#x6709;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x80fd;&#x5bf9;&#x5176;&#x8fdb;&#x884c;lock&#x3002;&#x591a;&#x6b21;lock&#x540e;&#xff0c;&#x5fc5;&#x987b;&#x6267;&#x884c;&#x76f8;&#x540c;&#x6b21;&#x6570;&#x7684;unlock&#x624d;&#x80fd;&#x89e3;&#x9501;\n*   &#x5982;&#x679c;&#x5bf9;&#x4e00;&#x4e2a;&#x53d8;&#x91cf;&#x8fdb;&#x884c;lock&#x64cd;&#x4f5c;&#xff0c;&#x4f1a;&#x6e05;&#x7a7a;&#x6240;&#x6709;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x4e2d;&#x6b64;&#x53d8;&#x91cf;&#x7684;&#x503c;&#xff0c;&#x5728;&#x6267;&#x884c;&#x5f15;&#x64ce;&#x4f7f;&#x7528;&#x8fd9;&#x4e2a;&#x53d8;&#x91cf;&#x524d;&#xff0c;&#x5fc5;&#x987b;&#x91cd;&#x65b0;load&#x6216;assign&#x64cd;&#x4f5c;&#x521d;&#x59cb;&#x5316;&#x53d8;&#x91cf;&#x7684;&#x503c;\n*   &#x5982;&#x679c;&#x4e00;&#x4e2a;&#x53d8;&#x91cf;&#x6ca1;&#x6709;&#x88ab;lock&#xff0c;&#x5c31;&#x4e0d;&#x80fd;&#x5bf9;&#x5176;&#x8fdb;&#x884c;unlock&#x64cd;&#x4f5c;&#x3002;&#x4e5f;&#x4e0d;&#x80fd;unlock&#x4e00;&#x4e2a;&#x88ab;&#x5176;&#x4ed6;&#x7ebf;&#x7a0b;&#x9501;&#x4f4f;&#x7684;&#x53d8;&#x91cf;\n*   &#x5bf9;&#x4e00;&#x4e2a;&#x53d8;&#x91cf;&#x8fdb;&#x884c;unlock&#x64cd;&#x4f5c;&#x4e4b;&#x524d;&#xff0c;&#x5fc5;&#x987b;&#x628a;&#x6b64;&#x53d8;&#x91cf;&#x540c;&#x6b65;&#x56de;&#x4e3b;&#x5185;&#x5b58;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2016,2037"}}],"payload":{"tag":"h2","lines":"2013,2015"}},{"content":"3.4&#x3001;&#x6a21;&#x578b;&#x7279;&#x5f81;","children":[{"content":"<pre data-lines=\"2041,2042\"><code>*   **&#x539f;&#x5b50;&#x6027;&#xff1a;**  &#x4f8b;&#x5982;&#x4e0a;&#x9762;&#x516b;&#x9879;&#x64cd;&#x4f5c;&#xff0c;&#x5728;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x91cc;&#x9762;&#x662f;&#x4e0d;&#x53ef;&#x5206;&#x5272;&#x7684;&#x5355;&#x5143;&#x3002;&#x88ab;synchronized&#x5173;&#x952e;&#x5b57;&#x6216;&#x5176;&#x4ed6;&#x9501;&#x5305;&#x88f9;&#x8d77;&#x6765;&#x7684;&#x64cd;&#x4f5c;&#x4e5f;&#x53ef;&#x4ee5;&#x8ba4;&#x4e3a;&#x662f;&#x539f;&#x5b50;&#x7684;&#x3002;&#x4ece;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x89c2;&#x5bdf;&#x53e6;&#x5916;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x770b;&#x5230;&#x7684;&#x90fd;&#x662f;&#x4e00;&#x4e2a;&#x4e2a;&#x539f;&#x5b50;&#x6027;&#x7684;&#x64cd;&#x4f5c;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2041,2042"}},{"content":"<pre data-lines=\"2043,2050\"><code class=\"language-java\"><span class=\"hljs-keyword\">synchronized</span> (<span class=\"hljs-built_in\">this</span>) {\n    a=<span class=\"hljs-number\">1</span>;\n    b=<span class=\"hljs-number\">2</span>;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2043,2050"}},{"content":"<pre data-lines=\"2051,2052\"><code>*   **&#x53ef;&#x89c1;&#x6027;&#xff1a;**  &#x6bcf;&#x4e2a;&#x5de5;&#x4f5c;&#x7ebf;&#x7a0b;&#x90fd;&#x6709;&#x81ea;&#x5df1;&#x7684;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#xff0c;&#x6240;&#x4ee5;&#x5f53;&#x67d0;&#x4e2a;&#x7ebf;&#x7a0b;&#x4fee;&#x6539;&#x5b8c;&#x67d0;&#x4e2a;&#x53d8;&#x91cf;&#x4e4b;&#x540e;&#xff0c;&#x5728;&#x5176;&#x4ed6;&#x7684;&#x7ebf;&#x7a0b;&#x4e2d;&#xff0c;&#x672a;&#x5fc5;&#x80fd;&#x89c2;&#x5bdf;&#x5230;&#x8be5;&#x53d8;&#x91cf;&#x5df2;&#x7ecf;&#x88ab;&#x4fee;&#x6539;&#x3002;volatile&#x5173;&#x952e;&#x5b57;&#x8981;&#x6c42;&#x88ab;&#x4fee;&#x6539;&#x4e4b;&#x540e;&#x7684;&#x53d8;&#x91cf;&#x8981;&#x6c42;&#x7acb;&#x5373;&#x66f4;&#x65b0;&#x5230;&#x4e3b;&#x5185;&#x5b58;&#xff0c;&#x6bcf;&#x6b21;&#x4f7f;&#x7528;&#x524d;&#x4ece;&#x4e3b;&#x5185;&#x5b58;&#x5904;&#x8fdb;&#x884c;&#x8bfb;&#x53d6;&#x3002;&#x56e0;&#x6b64;volatile&#x53ef;&#x4ee5;&#x4fdd;&#x8bc1;&#x53ef;&#x89c1;&#x6027;&#x3002;&#x9664;&#x4e86;volatile&#x4ee5;&#x5916;&#xff0c;synchronized&#x548c;final&#x4e5f;&#x80fd;&#x5b9e;&#x73b0;&#x53ef;&#x89c1;&#x6027;&#x3002;synchronized&#x4fdd;&#x8bc1;unlock&#x4e4b;&#x524d;&#x5fc5;&#x987b;&#x5148;&#x628a;&#x53d8;&#x91cf;&#x5237;&#x65b0;&#x56de;&#x4e3b;&#x5185;&#x5b58;&#x3002;final&#x4fee;&#x9970;&#x7684;&#x5b57;&#x6bb5;&#x5728;&#x6784;&#x9020;&#x5668;&#x4e2d;&#x4e00;&#x65e6;&#x5b8c;&#x6210;&#x521d;&#x59cb;&#x5316;&#xff0c;&#x5e76;&#x4e14;&#x6784;&#x9020;&#x5668;&#x6ca1;&#x6709;this&#x9038;&#x51fa;&#xff0c;&#x90a3;&#x4e48;&#x5176;&#x4ed6;&#x7ebf;&#x7a0b;&#x5c31;&#x80fd;&#x770b;&#x5230;final&#x5b57;&#x6bb5;&#x7684;&#x503c;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2051,2052"}},{"content":"<pre data-lines=\"2053,2077\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test25</span> {\n    \n    \n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">volatile</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-variable\">run</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">true</span>;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        <span class=\"hljs-type\">Thread</span> <span class=\"hljs-variable\">t</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n                <span class=\"hljs-keyword\">if</span> (!run) {\n                    <span class=\"hljs-keyword\">break</span>;\n                }\n            }\n        });\n        t.start();\n\n        \n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n        run = <span class=\"hljs-literal\">false</span>;\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2053,2077"}},{"content":"<pre data-lines=\"2078,2079\"><code>*   **&#x6709;&#x5e8f;&#x6027;&#xff1a;**  Java&#x7684;&#x6709;&#x5e8f;&#x6027;&#x8ddf;&#x7ebf;&#x7a0b;&#x76f8;&#x5173;&#x3002;&#x5982;&#x679c;&#x5728;&#x7ebf;&#x7a0b;&#x5185;&#x90e8;&#x89c2;&#x5bdf;&#xff0c;&#x4f1a;&#x53d1;&#x73b0;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x7684;&#x4e00;&#x5207;&#x64cd;&#x4f5c;&#x90fd;&#x662f;&#x6709;&#x5e8f;&#x7684;&#x3002;&#x5982;&#x679c;&#x5728;&#x7ebf;&#x7a0b;&#x7684;&#x5916;&#x90e8;&#x6765;&#x89c2;&#x5bdf;&#x7684;&#x8bdd;&#xff0c;&#x4f1a;&#x53d1;&#x73b0;&#x7ebf;&#x7a0b;&#x7684;&#x6240;&#x6709;&#x64cd;&#x4f5c;&#x90fd;&#x662f;&#x65e0;&#x5e8f;&#x7684;&#x3002;&#x56e0;&#x4e3a;JMM&#x7684;&#x5de5;&#x4f5c;&#x5185;&#x5b58;&#x548c;&#x4e3b;&#x5185;&#x5b58;&#x4e4b;&#x95f4;&#x5b58;&#x5728;&#x5ef6;&#x8fdf;&#xff0c;&#x800c;&#x4e14;Java&#x4f1a;&#x5bf9;&#x4e00;&#x4e9b;&#x6307;&#x4ee4;&#x8fdb;&#x884c;&#x91cd;&#x65b0;&#x6392;&#x5e8f;&#x3002;volatile&#x548c;synchronized&#x53ef;&#x4ee5;&#x4fdd;&#x8bc1;&#x7a0b;&#x5e8f;&#x7684;&#x6709;&#x5e8f;&#x6027;&#xff0c;&#x5f88;&#x591a;&#x7a0b;&#x5e8f;&#x5458;&#x53ea;&#x7406;&#x89e3;&#x8fd9;&#x4e24;&#x4e2a;&#x5173;&#x952e;&#x5b57;&#x7684;&#x6267;&#x884c;&#x4e92;&#x65a5;&#xff0c;&#x800c;&#x6ca1;&#x6709;&#x5f88;&#x597d;&#x7684;&#x7406;&#x89e3;&#x5230;volatile&#x548c;synchronized&#x4e5f;&#x80fd;&#x4fdd;&#x8bc1;&#x6307;&#x4ee4;&#x4e0d;&#x8fdb;&#x884c;&#x91cd;&#x6392;&#x5e8f;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2078,2079"}}],"payload":{"tag":"h2","lines":"2038,2040"}},{"content":"3.5&#x3001;&#x540c;&#x6b65;&#x6a21;&#x5f0f;&#x4e4b;&#x4efb;&#x52a1;&#x72b9;&#x8c6b;","children":[{"content":"<pre data-lines=\"2083,2084\"><code>Balking&#xff08;&#x72b9;&#x8c6b;&#xff09;&#x6a21;&#x5f0f;&#x7528;&#x5728;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x53d1;&#x73b0;&#x53e6;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x6216;&#x672c;&#x7ebf;&#x7a0b;&#x5df2;&#x7ecf;&#x505a;&#x4e86;&#x67d0;&#x4e00;&#x4ef6;&#x76f8;&#x540c;&#x7684;&#x4e8b;&#xff0c;&#x90a3;&#x4e48;&#x672c;&#x7ebf;&#x7a0b;&#x5c31;&#x65e0;&#x9700;&#x518d;&#x505a;&#x4e86;&#xff0c;&#x76f4;&#x63a5;&#x7ed3;&#x675f;&#x8fd4;&#x56de;&#x5373;&#x53ef;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2083,2084"}},{"content":"<pre data-lines=\"2085,2113\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MonitorService</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">volatile</span> <span class=\"hljs-type\">boolean</span> isStart;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">start</span><span class=\"hljs-params\">()</span> {\n        log.info(<span class=\"hljs-string\">&quot;&#x5c1d;&#x8bd5;&#x542f;&#x52a8;&#x76d1;&#x63a7;&#x7ebf;&#x7a0b;...&quot;</span>);\n        <span class=\"hljs-keyword\">synchronized</span> (<span class=\"hljs-built_in\">this</span>) {\n            <span class=\"hljs-keyword\">if</span> (isStart) {\n                <span class=\"hljs-keyword\">return</span>;\n            }\n            isStart = <span class=\"hljs-literal\">true</span>;\n        }\n        log.info(<span class=\"hljs-string\">&quot;&#x771f;&#x6b63;&#x542f;&#x52a8;&#x76d1;&#x63a7;&#x7ebf;&#x7a0b;...&quot;</span>);\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test27</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">MonitorService</span> <span class=\"hljs-variable\">monitorService</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MonitorService</span>();\n        monitorService.start();\n        monitorService.start();\n        monitorService.start();\n        monitorService.start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2085,2113"}},{"content":"<pre data-lines=\"2114,2122\"><code class=\"language-java\">20:38:10.860 [main] INFO com.caochenlei.MonitorService - &#x5c1d;&#x8bd5;&#x542f;&#x52a8;&#x76d1;&#x63a7;&#x7ebf;&#x7a0b;...\n20:38:10.865 [main] INFO com.caochenlei.MonitorService - &#x771f;&#x6b63;&#x542f;&#x52a8;&#x76d1;&#x63a7;&#x7ebf;&#x7a0b;...\n20:38:10.865 [main] INFO com.caochenlei.MonitorService - &#x5c1d;&#x8bd5;&#x542f;&#x52a8;&#x76d1;&#x63a7;&#x7ebf;&#x7a0b;...\n20:38:10.865 [main] INFO com.caochenlei.MonitorService - &#x5c1d;&#x8bd5;&#x542f;&#x52a8;&#x76d1;&#x63a7;&#x7ebf;&#x7a0b;...\n20:38:10.865 [main] INFO com.caochenlei.MonitorService - &#x5c1d;&#x8bd5;&#x542f;&#x52a8;&#x76d1;&#x63a7;&#x7ebf;&#x7a0b;...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2114,2122"}}],"payload":{"tag":"h2","lines":"2080,2082"}},{"content":"3.6&#x3001;&#x7ec8;&#x6b62;&#x6a21;&#x5f0f;&#x4e4b;&#x4f18;&#x96c5;&#x7ec8;&#x6b62;","children":[{"content":"<pre data-lines=\"2126,2127\"><code>&#x5728;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b; T1 &#x4e2d;&#x5982;&#x4f55;&#x201c;&#x4f18;&#x96c5;&#x201d;&#x7ec8;&#x6b62;&#x7ebf;&#x7a0b; T2&#xff1f;&#x8fd9;&#x91cc;&#x7684;&#x3010;&#x4f18;&#x96c5;&#x3011;&#x6307;&#x7684;&#x662f;&#x7ed9; T2 &#x4e00;&#x4e2a;&#x6599;&#x7406;&#x540e;&#x4e8b;&#x7684;&#x673a;&#x4f1a;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2126,2127"}},{"content":"<pre data-lines=\"2128,2179\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TwoPhaseTermination</span> {\n    <span class=\"hljs-keyword\">private</span> Thread monitorThread;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">volatile</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-variable\">isStart</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">false</span>;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">volatile</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-variable\">isStop</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">false</span>;\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">start</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">synchronized</span> (<span class=\"hljs-built_in\">this</span>) {\n            <span class=\"hljs-keyword\">if</span> (isStart) {\n                <span class=\"hljs-keyword\">return</span>;\n            }\n            isStart = <span class=\"hljs-literal\">true</span>;\n        }\n        monitorThread = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n                \n                <span class=\"hljs-keyword\">if</span> (isStop) {\n                    log.debug(<span class=\"hljs-string\">&quot;&#x505c;&#x6b62;&#x76d1;&#x63a7;&#x8bb0;&#x5f55;&quot;</span>);\n                    <span class=\"hljs-keyword\">break</span>;\n                }\n                \n                <span class=\"hljs-keyword\">try</span> {\n                    Thread.sleep(<span class=\"hljs-number\">1000</span>);\n                    log.debug(<span class=\"hljs-string\">&quot;&#x6267;&#x884c;&#x76d1;&#x63a7;&#x8bb0;&#x5f55;&quot;</span>);\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }, <span class=\"hljs-string\">&quot;monitor&quot;</span>);\n        monitorThread.start();\n    }\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">stop</span><span class=\"hljs-params\">()</span> {\n        isStop = <span class=\"hljs-literal\">true</span>;\n        monitorThread.interrupt();\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test26</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        <span class=\"hljs-type\">TwoPhaseTermination</span> <span class=\"hljs-variable\">tpt</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">TwoPhaseTermination</span>();\n        tpt.start();\n        Thread.sleep(<span class=\"hljs-number\">5000</span>);\n        tpt.stop();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2128,2179"}},{"content":"<pre data-lines=\"2180,2191\"><code class=\"language-java\">20:40:18.956 [monitor] DEBUG com.caochenlei.TwoPhaseTermination - &#x6267;&#x884c;&#x76d1;&#x63a7;&#x8bb0;&#x5f55;\n20:40:19.974 [monitor] DEBUG com.caochenlei.TwoPhaseTermination - &#x6267;&#x884c;&#x76d1;&#x63a7;&#x8bb0;&#x5f55;\n20:40:20.987 [monitor] DEBUG com.caochenlei.TwoPhaseTermination - &#x6267;&#x884c;&#x76d1;&#x63a7;&#x8bb0;&#x5f55;\n20:40:21.993 [monitor] DEBUG com.caochenlei.TwoPhaseTermination - &#x6267;&#x884c;&#x76d1;&#x63a7;&#x8bb0;&#x5f55;\njava.lang.InterruptedException: sleep interrupted\n\tat java.lang.Thread.sleep(Native Method)\n    at com.caochenlei.TwoPhaseTermination.lambda&#x24;start&#x24;0(Test26.java:28)\n20:40:22.950 [monitor] DEBUG com.caochenlei.TwoPhaseTermination - &#x505c;&#x6b62;&#x76d1;&#x63a7;&#x8bb0;&#x5f55;    \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2180,2191"}}],"payload":{"tag":"h2","lines":"2123,2125"}},{"content":"3.7&#x3001;happens-before","children":[{"content":"<pre data-lines=\"2195,2198\"><code>happens-before &#x89c4;&#x5b9a;&#x4e86;&#x5bf9;&#x5171;&#x4eab;&#x53d8;&#x91cf;&#x7684;&#x5199;&#x64cd;&#x4f5c;&#x5bf9;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x7684;&#x8bfb;&#x64cd;&#x4f5c;&#x53ef;&#x89c1;&#xff0c;&#x5b83;&#x662f;&#x53ef;&#x89c1;&#x6027;&#x4e0e;&#x6709;&#x5e8f;&#x6027;&#x7684;&#x4e00;&#x5957;&#x89c4;&#x5219;&#x603b;&#x7ed3;&#xff0c;&#x629b;&#x5f00;&#x4ee5;&#x4e0b; happens-before &#x89c4;&#x5219;&#xff0c;JMM &#x5e76;&#x4e0d;&#x80fd;&#x4fdd;&#x8bc1;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x5bf9;&#x5171;&#x4eab;&#x53d8;&#x91cf;&#x7684;&#x5199;&#xff0c;&#x5bf9;&#x4e8e;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x5bf9;&#x8be5;&#x5171;&#x4eab;&#x53d8;&#x91cf;&#x7684;&#x8bfb;&#x53ef;&#x89c1;&#x3002;\n\n*   &#x7ebf;&#x7a0b;&#x89e3;&#x9501; m &#x4e4b;&#x524d;&#x5bf9;&#x53d8;&#x91cf;&#x7684;&#x5199;&#xff0c;&#x5bf9;&#x4e8e;&#x63a5;&#x4e0b;&#x6765;&#x5bf9; m &#x52a0;&#x9501;&#x7684;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x5bf9;&#x8be5;&#x53d8;&#x91cf;&#x7684;&#x8bfb;&#x53ef;&#x89c1;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2195,2198"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/01b48160e271ab02f4089f035b11c5dd.png\" alt>","children":[],"payload":{"tag":"img","lines":"2199,2200"}},{"content":"<pre data-lines=\"2201,2202\"><code>*   &#x7ebf;&#x7a0b;&#x5bf9; volatile &#x53d8;&#x91cf;&#x7684;&#x5199;&#xff0c;&#x5bf9;&#x63a5;&#x4e0b;&#x6765;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x5bf9;&#x8be5;&#x53d8;&#x91cf;&#x7684;&#x8bfb;&#x53ef;&#x89c1;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2201,2202"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/07765da74c294a236bd138dab3803b93.png\" alt>","children":[],"payload":{"tag":"img","lines":"2203,2204"}},{"content":"<pre data-lines=\"2205,2206\"><code>*   &#x7ebf;&#x7a0b; start &#x524d;&#x5bf9;&#x53d8;&#x91cf;&#x7684;&#x5199;&#xff0c;&#x5bf9;&#x8be5;&#x7ebf;&#x7a0b;&#x5f00;&#x59cb;&#x540e;&#x5bf9;&#x8be5;&#x53d8;&#x91cf;&#x7684;&#x8bfb;&#x53ef;&#x89c1;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2205,2206"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/21b0cd42a2b19dc86781845e5cd8f704.png\" alt>","children":[],"payload":{"tag":"img","lines":"2207,2208"}},{"content":"<pre data-lines=\"2209,2210\"><code>*   &#x7ebf;&#x7a0b;&#x7ed3;&#x675f;&#x524d;&#x5bf9;&#x53d8;&#x91cf;&#x7684;&#x5199;&#xff0c;&#x5bf9;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x5f97;&#x77e5;&#x5b83;&#x7ed3;&#x675f;&#x540e;&#x7684;&#x8bfb;&#x53ef;&#x89c1;&#xff08;&#x6bd4;&#x5982;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x8c03;&#x7528; t1.isAlive() &#x6216; t1.join()&#x7b49;&#x5f85;&#x5b83;&#x7ed3;&#x675f;&#xff09;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2209,2210"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/91db0f27ec22bbd334f7752a6661a369.png\" alt>","children":[],"payload":{"tag":"img","lines":"2211,2212"}},{"content":"<pre data-lines=\"2213,2214\"><code>*   &#x7ebf;&#x7a0b; t1 &#x6253;&#x65ad; t2 &#x524d;&#x5bf9;&#x53d8;&#x91cf;&#x7684;&#x5199;&#xff0c;&#x5bf9;&#x4e8e;&#x5176;&#x4ed6;&#x7ebf;&#x7a0b;&#x5f97;&#x77e5; t2 &#x88ab;&#x6253;&#x65ad;&#x540e;&#x5bf9;&#x53d8;&#x91cf;&#x7684;&#x8bfb;&#x53ef;&#x89c1;&#xff08;&#x901a;&#x8fc7;t2.interrupted &#x6216; t2.isInterrupted&#xff09;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2213,2214"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/6ee74b286cb339b563a5ad9c18f96158.png\" alt>","children":[],"payload":{"tag":"img","lines":"2215,2216"}},{"content":"<pre data-lines=\"2217,2218\"><code>*   &#x5bf9;&#x53d8;&#x91cf;&#xff08;&#x6210;&#x5458;&#x53d8;&#x91cf;&#x6216;&#x9759;&#x6001;&#x6210;&#x5458;&#x53d8;&#x91cf;&#xff09;&#x9ed8;&#x8ba4;&#x503c;&#xff08;0&#xff0c;false&#xff0c;null&#xff09;&#x7684;&#x5199;&#xff0c;&#x5bf9;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x5bf9;&#x8be5;&#x53d8;&#x91cf;&#x7684;&#x8bfb;&#x53ef;&#x89c1;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2217,2218"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/6c6b3d367f9154e44397cc6658adcf23.png\" alt>","children":[],"payload":{"tag":"img","lines":"2219,2220"}}],"payload":{"tag":"h2","lines":"2192,2194"}},{"content":"4.1&#x3001;&#x65e0;&#x9501;&#x793a;&#x4f8b;","children":[{"content":"<pre data-lines=\"2224,2225\"><code>&#x6709;&#x4e00;&#x4e2a;&#x8d26;&#x6237;&#x4f59;&#x989d; 1000 &#x5143;&#xff0c;&#x5f00;&#x542f; 10 &#x4e2a;&#x7ebf;&#x7a0b;&#xff0c;&#x6bcf;&#x4e2a;&#x7ebf;&#x7a0b;&#x51cf;&#x5c11; 100 &#x5143;&#xff0c;&#x6700;&#x7ec8;&#x51cf;&#x5c11;&#x5230; 0 &#x5143;&#x3002;&#x8981;&#x6c42;&#x4f7f;&#x7528; CAS&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2224,2225"}},{"content":"<pre data-lines=\"2226,2281\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Account</span> {\n    <span class=\"hljs-keyword\">private</span> AtomicInteger balance;\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">Account</span><span class=\"hljs-params\">(Integer balance)</span> {\n        <span class=\"hljs-built_in\">this</span>.balance = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AtomicInteger</span>(balance);\n    }\n\n    \n    <span class=\"hljs-keyword\">public</span> Integer <span class=\"hljs-title function_\">getBalance</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> balance.get();\n    }\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">increase</span><span class=\"hljs-params\">(Integer money)</span> {\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">prev</span> <span class=\"hljs-operator\">=</span> balance.get();\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">next</span> <span class=\"hljs-operator\">=</span> prev + money;\n            <span class=\"hljs-keyword\">if</span> (balance.compareAndSet(prev, next)) {\n                <span class=\"hljs-keyword\">break</span>;\n            }\n        }\n    }\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">decrease</span><span class=\"hljs-params\">(Integer money)</span> {\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">prev</span> <span class=\"hljs-operator\">=</span> balance.get();\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">next</span> <span class=\"hljs-operator\">=</span> prev - money;\n            <span class=\"hljs-keyword\">if</span> (balance.compareAndSet(prev, next)) {\n                <span class=\"hljs-keyword\">break</span>;\n            }\n        }\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test28</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        <span class=\"hljs-type\">Account</span> <span class=\"hljs-variable\">account</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Account</span>(<span class=\"hljs-number\">1000</span>);\n        List&lt;Thread&gt; threads = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayList</span>&lt;&gt;();\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">10</span>; i++) {\n            threads.add(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; { account.decrease(<span class=\"hljs-number\">100</span>); }));\n        }\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">10</span>; i++) {\n            threads.get(i).start();\n        }\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">10</span>; i++) {\n            threads.get(i).join();\n        }\n        System.out.println(<span class=\"hljs-string\">&quot;money : &quot;</span> + account.getBalance());\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2226,2281"}},{"content":"<pre data-lines=\"2282,2286\"><code data-lines=\"2282,2286\">money : 0\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2282,2286"}}],"payload":{"tag":"h2","lines":"2221,2223"}},{"content":"4.2&#x3001;&#x539f;&#x5b50;&#x6574;&#x6570;","children":[{"content":"<pre data-lines=\"2290,2291\"><code>*   **AtomicBoolean**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2290,2291"}},{"content":"<pre data-lines=\"2292,2311\"><code class=\"language-java\"><span class=\"hljs-type\">AtomicBoolean</span> <span class=\"hljs-variable\">atomicBoolean</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AtomicBoolean</span>(<span class=\"hljs-literal\">false</span>);\n\n\nSystem.out.println(atomicBoolean.get());\n\n\natomicBoolean.set(<span class=\"hljs-literal\">true</span>);\nSystem.out.println(atomicBoolean.get());\n\n\nSystem.out.println(<span class=\"hljs-string\">&quot;&#x83b7;&#x53d6;&#x5e76;&#x8bbe;&#x7f6e;&#x7ed3;&#x679c;&#xff1a;&quot;</span> + atomicBoolean.getAndSet(<span class=\"hljs-literal\">false</span>));\nSystem.out.println(atomicBoolean.get());\n\n\nSystem.out.println(<span class=\"hljs-string\">&quot;&#x6bd4;&#x8f83;&#x5e76;&#x8bbe;&#x7f6e;&#x7ed3;&#x679c;&#xff1a;&quot;</span> + atomicBoolean.compareAndSet(<span class=\"hljs-literal\">false</span>, <span class=\"hljs-literal\">true</span>));\nSystem.out.println(atomicBoolean.get());\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2292,2311"}},{"content":"<pre data-lines=\"2312,2321\"><code class=\"language-java\"><span class=\"hljs-literal\">false</span>\n<span class=\"hljs-literal\">true</span>\n&#x83b7;&#x53d6;&#x5e76;&#x8bbe;&#x7f6e;&#x7ed3;&#x679c;&#xff1a;<span class=\"hljs-literal\">true</span>\n<span class=\"hljs-literal\">false</span>\n&#x6bd4;&#x8f83;&#x5e76;&#x8bbe;&#x7f6e;&#x7ed3;&#x679c;&#xff1a;<span class=\"hljs-literal\">true</span>\n<span class=\"hljs-literal\">true</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2312,2321"}},{"content":"<pre data-lines=\"2322,2326\"><code>*   **AtomicInteger**\n*   **AtomicLong**\n\n&#x4ee5; AtomicInteger &#x4e3a;&#x4f8b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2322,2326"}},{"content":"<pre data-lines=\"2327,2369\"><code class=\"language-java\"><span class=\"hljs-type\">AtomicInteger</span> <span class=\"hljs-variable\">atomicInteger</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AtomicInteger</span>(<span class=\"hljs-number\">0</span>);\n\n\nSystem.out.println(atomicInteger.getAndIncrement());\n\n\nSystem.out.println(atomicInteger.incrementAndGet());\n\n\nSystem.out.println(atomicInteger.decrementAndGet());\n\n\nSystem.out.println(atomicInteger.getAndDecrement());\n\n\nSystem.out.println(atomicInteger.getAndAdd(<span class=\"hljs-number\">5</span>));\n\n\nSystem.out.println(atomicInteger.addAndGet(-<span class=\"hljs-number\">5</span>));\n\n\n\nSystem.out.println(atomicInteger.getAndUpdate(p -&gt; p - <span class=\"hljs-number\">2</span>));\n\n\n\nSystem.out.println(atomicInteger.updateAndGet(p -&gt; p + <span class=\"hljs-number\">2</span>));\n\n\n\n\n\nSystem.out.println(atomicInteger.getAndAccumulate(<span class=\"hljs-number\">10</span>, (p, x) -&gt; p + x));\n\n\n\n\n\nSystem.out.println(atomicInteger.accumulateAndGet(-<span class=\"hljs-number\">10</span>, (p, x) -&gt; p + x));\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2327,2369"}}],"payload":{"tag":"h2","lines":"2287,2289"}},{"content":"4.3&#x3001;&#x539f;&#x5b50;&#x5f15;&#x7528;","children":[{"content":"<pre data-lines=\"2373,2374\"><code>&#x6709;&#x4e9b;&#x65f6;&#x5019;&#xff0c;&#x6211;&#x4eec;&#x4e0d;&#x4e00;&#x5b9a;&#x4f1a;&#x4f7f;&#x7528;&#x57fa;&#x7840;&#x7c7b;&#x578b;&#x4f5c;&#x4e3a;&#x5171;&#x4eab;&#x53d8;&#x91cf;&#xff0c;&#x4e5f;&#x53ef;&#x80fd;&#x4f1a;&#x4f7f;&#x7528;&#x5bf9;&#x8c61;&#x7c7b;&#x578b;&#x4f5c;&#x4e3a;&#x5171;&#x4eab;&#x53d8;&#x91cf;&#xff0c;&#x5982;&#x4f55;&#x786e;&#x4fdd;&#x5728;&#x591a;&#x7ebf;&#x7a0b;&#x4e0b;&#x7684;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;&#x5462;&#xff1f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2373,2374"}},{"content":"<pre data-lines=\"2377,2432\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BigDecimalAccount</span> {\n    <span class=\"hljs-keyword\">private</span> AtomicReference&lt;BigDecimal&gt; balance;\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">BigDecimalAccount</span><span class=\"hljs-params\">(BigDecimal balance)</span> {\n        <span class=\"hljs-built_in\">this</span>.balance = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AtomicReference</span>&lt;&gt;(balance);\n    }\n\n    \n    <span class=\"hljs-keyword\">public</span> BigDecimal <span class=\"hljs-title function_\">getBalance</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> balance.get();\n    }\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">increase</span><span class=\"hljs-params\">(BigDecimal money)</span> {\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n            <span class=\"hljs-type\">BigDecimal</span> <span class=\"hljs-variable\">prev</span> <span class=\"hljs-operator\">=</span> balance.get();\n            <span class=\"hljs-type\">BigDecimal</span> <span class=\"hljs-variable\">next</span> <span class=\"hljs-operator\">=</span> prev.add(money);\n            <span class=\"hljs-keyword\">if</span> (balance.compareAndSet(prev, next)) {\n                <span class=\"hljs-keyword\">break</span>;\n            }\n        }\n    }\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">decrease</span><span class=\"hljs-params\">(BigDecimal money)</span> {\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n            <span class=\"hljs-type\">BigDecimal</span> <span class=\"hljs-variable\">prev</span> <span class=\"hljs-operator\">=</span> balance.get();\n            <span class=\"hljs-type\">BigDecimal</span> <span class=\"hljs-variable\">next</span> <span class=\"hljs-operator\">=</span> prev.subtract(money);\n            <span class=\"hljs-keyword\">if</span> (balance.compareAndSet(prev, next)) {\n                <span class=\"hljs-keyword\">break</span>;\n            }\n        }\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test31</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        <span class=\"hljs-type\">BigDecimalAccount</span> <span class=\"hljs-variable\">account</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BigDecimalAccount</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BigDecimal</span>(<span class=\"hljs-number\">1000.00</span>));\n        List&lt;Thread&gt; threads = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayList</span>&lt;&gt;();\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">10</span>; i++) {\n            threads.add(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; { account.decrease(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BigDecimal</span>(<span class=\"hljs-number\">100.00</span>)); }));\n        }\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">10</span>; i++) {\n            threads.get(i).start();\n        }\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">10</span>; i++) {\n            threads.get(i).join();\n        }\n        System.out.println(<span class=\"hljs-string\">&quot;money : &quot;</span> + account.getBalance());\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2377,2432"}},{"content":"<pre data-lines=\"2433,2437\"><code class=\"language-java\">money : 0\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2433,2437"}},{"content":"<pre data-lines=\"2438,2441\"><code>compareAndSet&#x65b9;&#x6cd5;&#xff0c;&#x9996;&#x5148;&#x5148;&#x6bd4;&#x8f83;&#x4f20;&#x9012;&#x8fc7;&#x6765;&#x7684;&#x53c2;&#x6570;&#x662f;&#x5426;&#x662f;&#x671f;&#x671b;&#x7684;&#x503c;&#xff0c;&#x5982;&#x679c;&#x662f;&#xff0c;&#x624d;&#x4f1a;&#x4fee;&#x6539;&#xff0c;&#x5982;&#x679c;&#x4e0d;&#x662f;&#xff0c;&#x5219;&#x4fee;&#x6539;&#x5931;&#x8d25;&#x3002;\n\n&#x90a3;&#x6709;&#x6ca1;&#x6709;&#x6709;&#x4e00;&#x79cd;&#x53ef;&#x80fd;&#xff0c;&#x5728; A &#x7ebf;&#x7a0b;&#x7b2c;&#x4e8c;&#x6b21;&#x4fee;&#x6539;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x867d;&#x7136;&#xff0c;&#x4ed6;&#x7684;&#x671f;&#x671b;&#x503c;&#x662f; 10&#xff0c;&#x4f46;&#x662f;&#x8fd9;&#x4e2a; 10&#xff0c;&#x662f;&#x88ab; B &#x7ebf;&#x7a0b;&#x4fee;&#x6539;&#x7684;&#xff0c;&#x4ed6;&#x4ee5;&#x4e3a;&#x522b;&#x4eba;&#x6ca1;&#x6709;&#x52a8;&#x8fc7;&#xff0c;&#x7136;&#x540e;&#x6267;&#x884c;&#x66f4;&#x6539;&#x64cd;&#x4f5c;&#xff0c;&#x5176;&#x5b9e;&#x4e2d;&#x95f4;&#x5df2;&#x7ecf;&#x88ab;&#x66f4;&#x6539;&#x8fc7;&#x4e86;&#xff0c;&#x8fd9;&#x5c31;&#x662f;ABA&#x95ee;&#x9898;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2438,2441"}},{"content":"<pre data-lines=\"2442,2455\"><code class=\"language-java\"><span class=\"hljs-type\">AtomicInteger</span> <span class=\"hljs-variable\">atomicInteger</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AtomicInteger</span>(<span class=\"hljs-number\">10</span>);\n\n\natomicInteger.compareAndSet(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">100</span>);\n\n\natomicInteger.compareAndSet(<span class=\"hljs-number\">100</span>,<span class=\"hljs-number\">10</span>);\n\n\natomicInteger.compareAndSet(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2442,2455"}},{"content":"<pre data-lines=\"2456,2459\"><code>&#x4e3a;&#x4e86;&#x89e3;&#x51b3;&#x8fd9;&#x4e2a;&#x95ee;&#x9898;&#xff0c;&#x6211;&#x4eec;&#x53ea;&#x9700;&#x8981;&#x5728;&#x6bcf;&#x4e00;&#x6b21;&#x7684;&#x4fee;&#x6539;&#x64cd;&#x4f5c;&#x4e0a;&#x52a0;&#x4e00;&#x4e2a;&#x7248;&#x672c;&#x53f7;&#xff0c;&#x8fd9;&#x6837;&#x5373;&#x4f7f;&#x4e2d;&#x95f4;&#x88ab;&#x4fee;&#x6539;&#x8fc7;&#xff0c;&#x4e5f;&#x80fd;&#x77e5;&#x9053;&#xff0c;JDK&#x5c31;&#x63d0;&#x4f9b;&#x4e86;&#x4e00;&#x79cd;&#x5e26;&#x7248;&#x672c;&#x53f7;&#x7684;&#x539f;&#x5b50;&#x5f15;&#x7528;&#x5bf9;&#x8c61;&#x3002;\n\n*   **AtomicStampedReference**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2456,2459"}},{"content":"<pre data-lines=\"2460,2482\"><code class=\"language-java\">AtomicStampedReference&lt;Integer&gt; asr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AtomicStampedReference</span>&lt;&gt;(<span class=\"hljs-number\">10</span>, <span class=\"hljs-number\">0</span>);\n\n\n<span class=\"hljs-type\">Integer</span> <span class=\"hljs-variable\">prev</span> <span class=\"hljs-operator\">=</span> asr.getReference();\n<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">stamp</span> <span class=\"hljs-operator\">=</span> asr.getStamp();\nasr.compareAndSet(prev, <span class=\"hljs-number\">100</span>, stamp, stamp + <span class=\"hljs-number\">1</span>);\nSystem.out.println(asr.getStamp());\n\n\nprev = asr.getReference();\nstamp = asr.getStamp();\nasr.compareAndSet(prev, <span class=\"hljs-number\">10</span>, stamp, stamp + <span class=\"hljs-number\">1</span>);\nSystem.out.println(asr.getStamp());\n\n\nprev = asr.getReference();\nstamp = asr.getStamp();\nasr.compareAndSet(prev, <span class=\"hljs-number\">0</span>, stamp, stamp + <span class=\"hljs-number\">1</span>);\nSystem.out.println(asr.getStamp());\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2460,2482"}},{"content":"<pre data-lines=\"2483,2487\"><code>AtomicStampedReference&#x53ef;&#x4ee5;&#x7ed9;&#x539f;&#x5b50;&#x5f15;&#x7528;&#x52a0;&#x4e0a;&#x7248;&#x672c;&#x53f7;&#xff0c;&#x8ffd;&#x8e2a;&#x539f;&#x5b50;&#x5f15;&#x7528;&#x7684;&#x53d8;&#x5316;&#x8fc7;&#x7a0b;&#xff1a; `A -&gt; B -&gt; A`&#xff0c;&#x901a;&#x8fc7;AtomicStampedReference&#xff0c;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x77e5;&#x9053;&#xff0c;&#x5f15;&#x7528;&#x53d8;&#x91cf;&#x4e2d;&#x9014;&#x88ab;&#x66f4;&#x6539;&#x4e86;&#x51e0;&#x6b21;&#x3002;&#x4f46;&#x662f;&#x6709;&#x65f6;&#x5019;&#xff0c;&#x5e76;&#x4e0d;&#x5173;&#x5fc3;&#x5f15;&#x7528;&#x53d8;&#x91cf;&#x66f4;&#x6539;&#x4e86;&#x51e0;&#x6b21;&#xff0c;&#x53ea;&#x662f;&#x5355;&#x7eaf;&#x7684;&#x5173;&#x5fc3;&#x662f;&#x5426;&#x66f4;&#x6539;&#x8fc7;&#xff0c;&#x6240;&#x4ee5;&#x5c31;&#x6709;&#x4e86;  \nAtomicMarkableReference&#x3002;\n\n*   **AtomicMarkableReference**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2483,2487"}},{"content":"<pre data-lines=\"2488,2510\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">GarbageBag</span> {\n    String desc;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">GarbageBag</span><span class=\"hljs-params\">(String desc)</span> {\n        <span class=\"hljs-built_in\">this</span>.desc = desc;\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test34</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">GarbageBag</span> <span class=\"hljs-variable\">garbageBag</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">GarbageBag</span>(<span class=\"hljs-string\">&quot;&#x5783;&#x573e;&#x5df2;&#x6ee1;&quot;</span>);\n        AtomicMarkableReference&lt;GarbageBag&gt; amr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AtomicMarkableReference</span>&lt;&gt;(garbageBag, <span class=\"hljs-literal\">true</span>);\n\n        \n        <span class=\"hljs-type\">GarbageBag</span> <span class=\"hljs-variable\">prev</span> <span class=\"hljs-operator\">=</span> amr.getReference();\n        System.out.println(amr.compareAndSet(prev, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">GarbageBag</span>(<span class=\"hljs-string\">&quot;&#x5783;&#x573e;&#x5df2;&#x7a7a;&quot;</span>), <span class=\"hljs-literal\">true</span>, <span class=\"hljs-literal\">false</span>));\n        System.out.println(amr.isMarked());\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2488,2510"}},{"content":"<pre data-lines=\"2511,2516\"><code class=\"language-java\"><span class=\"hljs-literal\">true</span>\n<span class=\"hljs-literal\">false</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2511,2516"}}],"payload":{"tag":"h2","lines":"2370,2372"}},{"content":"4.4&#x3001;&#x539f;&#x5b50;&#x6570;&#x7ec4;","children":[{"content":"<pre data-lines=\"2520,2525\"><code>*   **AtomicIntegerArray**\n*   **AtomicLongArray**\n*   **AtomicReferenceArray**\n\n&#x4ee5; AtomicIntegerArray &#x4e3a;&#x4f8b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2520,2525"}},{"content":"<pre data-lines=\"2526,2542\"><code class=\"language-java\"><span class=\"hljs-type\">AtomicIntegerArray</span> <span class=\"hljs-variable\">atomicIntegerArray</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">AtomicIntegerArray</span>(<span class=\"hljs-number\">10</span>);\n\n<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; atomicIntegerArray.length(); i++) {\n    <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">prev</span> <span class=\"hljs-operator\">=</span> atomicIntegerArray.get(i);\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">next</span> <span class=\"hljs-operator\">=</span> prev + i;\n        <span class=\"hljs-keyword\">if</span> (atomicIntegerArray.compareAndSet(i, prev, next)) {\n            <span class=\"hljs-keyword\">break</span>;\n        }\n    }\n}\n\nSystem.out.println(atomicIntegerArray);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2526,2542"}},{"content":"<pre data-lines=\"2543,2547\"><code class=\"language-java\">[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2543,2547"}}],"payload":{"tag":"h2","lines":"2517,2519"}},{"content":"4.5&#x3001;&#x5b57;&#x6bb5;&#x66f4;&#x65b0;&#x5668;","children":[{"content":"<pre data-lines=\"2551,2556\"><code>*   **AtomicIntegerFieldUpdater**\n*   **AtomicLongFieldUpdater**\n*   **AtomicReferenceFieldUpdater**\n\n&#x4ee5; AtomicIntegerFieldUpdater &#x4e3a;&#x4f8b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2551,2556"}},{"content":"<pre data-lines=\"2557,2588\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Person</span> {\n    <span class=\"hljs-keyword\">volatile</span> String name;\n    <span class=\"hljs-keyword\">volatile</span> <span class=\"hljs-type\">int</span> age;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">Person</span><span class=\"hljs-params\">(String name, <span class=\"hljs-type\">int</span> age)</span> {\n        <span class=\"hljs-built_in\">this</span>.name = name;\n        <span class=\"hljs-built_in\">this</span>.age = age;\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">toString</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;Person{&quot;</span> +\n                <span class=\"hljs-string\">&quot;name=&apos;&quot;</span> + name + <span class=\"hljs-string\">&apos;\\&apos;&apos;</span> +\n                <span class=\"hljs-string\">&quot;, age=&quot;</span> + age +\n                <span class=\"hljs-string\">&apos;}&apos;</span>;\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test36</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Person</span> <span class=\"hljs-variable\">person</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Person</span>(<span class=\"hljs-string\">&quot;&#x5f20;&#x4e09;&quot;</span>, <span class=\"hljs-number\">20</span>);\n        System.out.println(person);\n        <span class=\"hljs-type\">AtomicIntegerFieldUpdater</span> <span class=\"hljs-variable\">updater</span> <span class=\"hljs-operator\">=</span> AtomicIntegerFieldUpdater.newUpdater(Person.class, <span class=\"hljs-string\">&quot;age&quot;</span>);\n\n        updater.compareAndSet(person, <span class=\"hljs-number\">20</span>, <span class=\"hljs-number\">18</span>);\n        System.out.println(person);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2557,2588"}},{"content":"<pre data-lines=\"2589,2594\"><code class=\"language-java\">Person{name=<span class=\"hljs-string\">&apos;&#x5f20;&#x4e09;&apos;</span>, age=<span class=\"hljs-number\">20</span>}\nPerson{name=<span class=\"hljs-string\">&apos;&#x5f20;&#x4e09;&apos;</span>, age=<span class=\"hljs-number\">18</span>}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2589,2594"}}],"payload":{"tag":"h2","lines":"2548,2550"}},{"content":"4.6&#x3001;&#x539f;&#x5b50;&#x7d2f;&#x52a0;&#x5668;","children":[{"content":"<pre data-lines=\"2598,2599\"><code>*   **LongAdder**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2598,2599"}},{"content":"<pre data-lines=\"2600,2615\"><code class=\"language-java\"><span class=\"hljs-type\">LongAdder</span> <span class=\"hljs-variable\">longAdder</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LongAdder</span>();\n\nlongAdder.add(<span class=\"hljs-number\">100L</span>);\nlongAdder.add(<span class=\"hljs-number\">200L</span>);\nlongAdder.add(<span class=\"hljs-number\">300L</span>);\nSystem.out.println(longAdder.sum());\n\nlongAdder.increment();\nSystem.out.println(longAdder.sum());\n\nlongAdder.decrement();\nSystem.out.println(longAdder.sum());\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2600,2615"}},{"content":"<pre data-lines=\"2616,2622\"><code class=\"language-java\">600\n601\n600\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2616,2622"}},{"content":"<pre data-lines=\"2625,2634\"><code class=\"language-java\"><span class=\"hljs-type\">DoubleAdder</span> <span class=\"hljs-variable\">doubleAdder</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DoubleAdder</span>();\n\ndoubleAdder.add(<span class=\"hljs-number\">100.00D</span>);\ndoubleAdder.add(<span class=\"hljs-number\">200.00D</span>);\ndoubleAdder.add(<span class=\"hljs-number\">300.00D</span>);\nSystem.out.println(doubleAdder.sum());\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2625,2634"}},{"content":"<pre data-lines=\"2635,2639\"><code class=\"language-java\">600.0\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2635,2639"}}],"payload":{"tag":"h2","lines":"2595,2597"}},{"content":"4.7&#x3001;Unsafe","children":[{"content":"<pre data-lines=\"2643,2646\"><code>Unsafe &#x5bf9;&#x8c61;&#x63d0;&#x4f9b;&#x4e86;&#x975e;&#x5e38;&#x5e95;&#x5c42;&#x7684;&#xff0c;&#x64cd;&#x4f5c;&#x5185;&#x5b58;&#x3001;&#x7ebf;&#x7a0b;&#x7684;&#x65b9;&#x6cd5;&#xff0c;Unsafe &#x5bf9;&#x8c61;&#x4e0d;&#x80fd;&#x76f4;&#x63a5;&#x8c03;&#x7528;&#xff0c;&#x53ea;&#x80fd;&#x901a;&#x8fc7;&#x53cd;&#x5c04;&#x83b7;&#x5f97;&#x3002;&#x4e0d;&#x8981;&#x88ab; Unsafe &#x7684;&#x540d;&#x79f0;&#x8ff7;&#x60d1;&#xff0c;Unsafe &#x662f;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;&#x7684;&#x7c7b;&#xff0c;&#x4ed6;&#x7684;&#x540d;&#x5b57;&#x672c;&#x610f;&#x662f;&#x60f3;&#x544a;&#x8bc9;&#x6211;&#x4eec;&#xff0c;&#x5982;&#x679c;&#x7531;&#x7a0b;&#x5e8f;&#x5458;&#x6765;&#x76f4;&#x63a5;&#x64cd;&#x4f5c;&#x5185;&#x5b58;&#x53ef;&#x80fd;&#x4f1a;&#x6709;&#x9690;&#x60a3;&#x3002;\n\n&#x7f16;&#x5199;&#x5de5;&#x5177;&#x7c7b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2643,2646"}},{"content":"<pre data-lines=\"2647,2667\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">UnsafeAccessor</span> {\n    <span class=\"hljs-keyword\">static</span> Unsafe unsafe;\n\n    <span class=\"hljs-keyword\">static</span> {\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">Field</span> <span class=\"hljs-variable\">theUnsafe</span> <span class=\"hljs-operator\">=</span> Unsafe.class.getDeclaredField(<span class=\"hljs-string\">&quot;theUnsafe&quot;</span>);\n            theUnsafe.setAccessible(<span class=\"hljs-literal\">true</span>);\n            unsafe = (Unsafe) theUnsafe.get(<span class=\"hljs-literal\">null</span>);\n        } <span class=\"hljs-keyword\">catch</span> (NoSuchFieldException | IllegalAccessException e) {\n            <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(e);\n        }\n    }\n\n    <span class=\"hljs-keyword\">static</span> Unsafe <span class=\"hljs-title function_\">getUnsafe</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> unsafe;\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2647,2667"}},{"content":"<pre data-lines=\"2668,2669\"><code>&#x6a21;&#x62df;CAS&#x64cd;&#x4f5c;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2668,2669"}},{"content":"<pre data-lines=\"2670,2702\"><code class=\"language-java\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Student</span> {\n    <span class=\"hljs-keyword\">volatile</span> String name;\n    <span class=\"hljs-keyword\">volatile</span> <span class=\"hljs-type\">int</span> age;\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">toString</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;Student{&quot;</span> +\n                <span class=\"hljs-string\">&quot;name=&apos;&quot;</span> + name + <span class=\"hljs-string\">&apos;\\&apos;&apos;</span> +\n                <span class=\"hljs-string\">&quot;, age=&quot;</span> + age +\n                <span class=\"hljs-string\">&apos;}&apos;</span>;\n    }\n}\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Test39</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> NoSuchFieldException {\n        <span class=\"hljs-type\">Unsafe</span> <span class=\"hljs-variable\">unsafe</span> <span class=\"hljs-operator\">=</span> UnsafeAccessor.getUnsafe();\n        \n        <span class=\"hljs-type\">Field</span> <span class=\"hljs-variable\">name</span> <span class=\"hljs-operator\">=</span> Student.class.getDeclaredField(<span class=\"hljs-string\">&quot;name&quot;</span>);\n        <span class=\"hljs-type\">Field</span> <span class=\"hljs-variable\">age</span> <span class=\"hljs-operator\">=</span> Student.class.getDeclaredField(<span class=\"hljs-string\">&quot;age&quot;</span>);\n        \n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">nameOffset</span> <span class=\"hljs-operator\">=</span> unsafe.objectFieldOffset(name);\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">ageOffset</span> <span class=\"hljs-operator\">=</span> unsafe.objectFieldOffset(age);\n        \n        <span class=\"hljs-type\">Student</span> <span class=\"hljs-variable\">student</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Student</span>();\n        unsafe.compareAndSwapObject(student, nameOffset, <span class=\"hljs-literal\">null</span>, <span class=\"hljs-string\">&quot;&#x5f20;&#x4e09;&quot;</span>); \n        unsafe.compareAndSwapInt(student, ageOffset, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">20</span>); \n        System.out.println(student);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2670,2702"}},{"content":"<pre data-lines=\"2703,2707\"><code class=\"language-java\">Student{name=<span class=\"hljs-string\">&apos;&#x5f20;&#x4e09;&apos;</span>, age=<span class=\"hljs-number\">20</span>}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2703,2707"}}],"payload":{"tag":"h2","lines":"2640,2642"}},{"content":"5.1&#x3001;&#x7ebf;&#x7a0b;&#x6c60;","children":[{"content":"5.1.1&#x3001;&#x81ea;&#x5b9a;&#x4e49;&#x7ebf;&#x7a0b;&#x6c60;","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/03287241660ea357f1282103342ba737.png\" alt>","children":[],"payload":{"tag":"img","lines":"2713,2714"}},{"content":"<pre data-lines=\"2715,2718\"><code>&#x6211;&#x4eec;&#x63a5;&#x4e0b;&#x6765;&#x5c06;&#x8981;&#x81ea;&#x5df1;&#x624b;&#x52a8;&#x8bbe;&#x8ba1;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x6c60;&#xff0c;&#x8fd9;&#x4e2a;&#x7ebf;&#x7a0b;&#x6c60;&#x4e3b;&#x8981;&#x7531;&#x4e24;&#x90e8;&#x5206;&#x7ec4;&#x6210;&#xff1a;&#x7ebf;&#x7a0b;&#x6c60; + &#x963b;&#x585e;&#x961f;&#x5217;\n\n&#x6211;&#x4eec;&#x9996;&#x5148;&#x6765;&#x8bbe;&#x8ba1;&#x4e00;&#x4e0b;&#x963b;&#x585e;&#x961f;&#x5217;&#xff0c;&#x4f5c;&#x7528;&#x5c31;&#x662f;&#xff0c;&#x5f53;&#x7ebf;&#x7a0b;&#x6c60;&#x5bb9;&#x91cf;&#x6ee1;&#x4e86;&#x4ee5;&#x540e;&#xff0c;&#x5982;&#x679c;&#x4e3b;&#x7a0b;&#x5e8f; main &#x8fd8;&#x7ee7;&#x7eed;&#x589e;&#x52a0;&#x4efb;&#x52a1;&#xff0c;&#x5219;&#x4f1a;&#x88ab;&#x653e;&#x5230;&#x963b;&#x585e;&#x961f;&#x5217;&#x4e2d;&#x7b49;&#x5f85;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2715,2718"}},{"content":"<pre data-lines=\"2719,2751\"><code class=\"language-java\">\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BlockingQueue</span>&lt;T&gt; {\n    <span class=\"hljs-keyword\">private</span> Deque&lt;T&gt; deque = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayDeque</span>&lt;&gt;();            \n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">ReentrantLock</span> <span class=\"hljs-variable\">lock</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ReentrantLock</span>();       \n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">Condition</span> <span class=\"hljs-variable\">fullWaitSet</span> <span class=\"hljs-operator\">=</span> lock.newCondition();    \n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">Condition</span> <span class=\"hljs-variable\">emptyWaitSet</span> <span class=\"hljs-operator\">=</span> lock.newCondition();   \n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> capcity;                                    \n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">BlockingQueue</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-built_in\">this</span>.capcity = <span class=\"hljs-number\">4</span>;\n    }\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">BlockingQueue</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> capcity)</span> {\n        <span class=\"hljs-built_in\">this</span>.capcity = capcity;\n    }\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">size</span><span class=\"hljs-params\">()</span> {\n        lock.lock();\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-keyword\">return</span> deque.size();\n        } <span class=\"hljs-keyword\">finally</span> {\n            lock.unlock();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2719,2751"}},{"content":"<pre data-lines=\"2752,2756\"><code>&#x5411;&#x963b;&#x585e;&#x961f;&#x5217;&#x4e2d;&#x6dfb;&#x52a0;&#x4efb;&#x52a1;&#xff1a;\n\n*   &#x5982;&#x679c;&#x5bb9;&#x91cf;&#x5df2;&#x7ecf;&#x6ee1;&#x4e86;&#xff0c;&#x90a3;&#x4e48;&#x8be5;&#x4efb;&#x52a1;&#x8981;&#x963b;&#x585e;\n*   &#x5982;&#x679c;&#x5bb9;&#x91cf;&#x8fd8;&#x6709;&#x5269;&#x4f59;&#xff0c;&#x90a3;&#x4e48;&#x8be5;&#x4efb;&#x52a1;&#x8981;&#x5165;&#x961f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2752,2756"}},{"content":"<pre data-lines=\"2757,2782\"><code class=\"language-java\">\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">put</span><span class=\"hljs-params\">(T task)</span> {\n    lock.lock();\n    <span class=\"hljs-keyword\">try</span> {\n        \n        <span class=\"hljs-keyword\">while</span> (deque.size() == capcity) {\n            <span class=\"hljs-keyword\">try</span> {\n                log.info(<span class=\"hljs-string\">&quot;&#x7b49;&#x5f85;&#x52a0;&#x5165;&#x963b;&#x585e;&#x961f;&#x5217;&#xff1a;{}&quot;</span>, task);\n                fullWaitSet.await();\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n        \n        log.info(<span class=\"hljs-string\">&quot;&#x5df2;&#x7ecf;&#x52a0;&#x5165;&#x963b;&#x585e;&#x961f;&#x5217;&#xff1a;{}&quot;</span>, task);\n        deque.addLast(task);\n        emptyWaitSet.signal();\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n    } <span class=\"hljs-keyword\">finally</span> {\n        lock.unlock();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2757,2782"}},{"content":"<pre data-lines=\"2783,2787\"><code>&#x5411;&#x963b;&#x585e;&#x961f;&#x5217;&#x4e2d;&#x83b7;&#x53d6;&#x4efb;&#x52a1;&#xff1a;\n\n*   &#x5982;&#x679c;&#x5bb9;&#x91cf;&#x5df2;&#x7ecf;&#x7a7a;&#x4e86;&#xff0c;&#x90a3;&#x4e48;&#x8be5;&#x8bf7;&#x6c42;&#x8981;&#x963b;&#x585e;\n*   &#x5982;&#x679c;&#x5bb9;&#x91cf;&#x8fd8;&#x6709;&#x5269;&#x4f59;&#xff0c;&#x90a3;&#x4e48;&#x76f4;&#x63a5;&#x8fd4;&#x56de;&#x4efb;&#x52a1;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2783,2787"}},{"content":"<pre data-lines=\"2788,2811\"><code class=\"language-java\">\n<span class=\"hljs-keyword\">public</span> T <span class=\"hljs-title function_\">take</span><span class=\"hljs-params\">()</span> {\n    lock.lock();\n    <span class=\"hljs-keyword\">try</span> {\n        \n        <span class=\"hljs-keyword\">while</span> (deque.isEmpty()) {\n            <span class=\"hljs-keyword\">try</span> {\n                emptyWaitSet.await();\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n        \n        <span class=\"hljs-type\">T</span> <span class=\"hljs-variable\">task</span> <span class=\"hljs-operator\">=</span> deque.removeFirst();\n        fullWaitSet.signal();\n        <span class=\"hljs-keyword\">return</span> task;\n    } <span class=\"hljs-keyword\">finally</span> {\n        lock.unlock();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2788,2811"}},{"content":"<pre data-lines=\"2812,2816\"><code>&#x5411;&#x963b;&#x585e;&#x961f;&#x5217;&#x4e2d;&#x6dfb;&#x52a0;&#x4efb;&#x52a1;&#xff08;&#x5e26;&#x8d85;&#x65f6;&#x65f6;&#x95f4;&#xff09;&#xff1a;\n\n*   &#x5982;&#x679c;&#x5bb9;&#x91cf;&#x5df2;&#x7ecf;&#x6ee1;&#x4e86;&#xff0c;&#x90a3;&#x4e48;&#x8be5;&#x4efb;&#x52a1;&#x8981;&#x963b;&#x585e;\n*   &#x5982;&#x679c;&#x5bb9;&#x91cf;&#x8fd8;&#x6709;&#x5269;&#x4f59;&#xff0c;&#x90a3;&#x4e48;&#x8be5;&#x4efb;&#x52a1;&#x8981;&#x5165;&#x961f;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2812,2816"}},{"content":"<pre data-lines=\"2817,2845\"><code class=\"language-java\">\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">offer</span><span class=\"hljs-params\">(T task, Long timeout, TimeUnit timeUnit)</span> {\n    lock.lock();\n    <span class=\"hljs-keyword\">try</span> {\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">nanos</span> <span class=\"hljs-operator\">=</span> timeUnit.toNanos(timeout);\n        \n        <span class=\"hljs-keyword\">while</span> (deque.size() == capcity) {\n            <span class=\"hljs-keyword\">try</span> {\n                log.info(<span class=\"hljs-string\">&quot;&#x7b49;&#x5f85;&#x52a0;&#x5165;&#x963b;&#x585e;&#x961f;&#x5217;&#xff1a;{}&quot;</span>, task);\n                \n                <span class=\"hljs-keyword\">if</span> (nanos &lt;= <span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;\n                nanos = fullWaitSet.awaitNanos(nanos);\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n        \n        log.info(<span class=\"hljs-string\">&quot;&#x5df2;&#x7ecf;&#x52a0;&#x5165;&#x963b;&#x585e;&#x961f;&#x5217;&#xff1a;{}&quot;</span>, task);\n        deque.addLast(task);\n        emptyWaitSet.signal();\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n    } <span class=\"hljs-keyword\">finally</span> {\n        lock.unlock();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2817,2845"}},{"content":"<pre data-lines=\"2846,2850\"><code>&#x5411;&#x963b;&#x585e;&#x961f;&#x5217;&#x4e2d;&#x83b7;&#x53d6;&#x4efb;&#x52a1;&#xff08;&#x5e26;&#x8d85;&#x65f6;&#x65f6;&#x95f4;&#xff09;&#xff1a;\n\n*   &#x5982;&#x679c;&#x5bb9;&#x91cf;&#x5df2;&#x7ecf;&#x7a7a;&#x4e86;&#xff0c;&#x90a3;&#x4e48;&#x8be5;&#x8bf7;&#x6c42;&#x8981;&#x963b;&#x585e;\n*   &#x5982;&#x679c;&#x5bb9;&#x91cf;&#x8fd8;&#x6709;&#x5269;&#x4f59;&#xff0c;&#x90a3;&#x4e48;&#x76f4;&#x63a5;&#x8fd4;&#x56de;&#x4efb;&#x52a1;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2846,2850"}},{"content":"<pre data-lines=\"2851,2877\"><code class=\"language-java\">\n<span class=\"hljs-keyword\">public</span> T <span class=\"hljs-title function_\">poll</span><span class=\"hljs-params\">(Long timeout, TimeUnit timeUnit)</span> {\n    lock.lock();\n    <span class=\"hljs-keyword\">try</span> {\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">nanos</span> <span class=\"hljs-operator\">=</span> timeUnit.toNanos(timeout);\n        \n        <span class=\"hljs-keyword\">while</span> (deque.isEmpty()) {\n            <span class=\"hljs-keyword\">try</span> {\n                \n                <span class=\"hljs-keyword\">if</span> (nanos &lt;= <span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;\n                nanos = emptyWaitSet.awaitNanos(nanos);\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n        \n        <span class=\"hljs-type\">T</span> <span class=\"hljs-variable\">task</span> <span class=\"hljs-operator\">=</span> deque.removeFirst();\n        fullWaitSet.signal();\n        <span class=\"hljs-keyword\">return</span> task;\n    } <span class=\"hljs-keyword\">finally</span> {\n        lock.unlock();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2851,2877"}},{"content":"<pre data-lines=\"2878,2879\"><code>&#x963b;&#x585e;&#x961f;&#x5217;&#x5df2;&#x7ecf;&#x8bbe;&#x8ba1;&#x7684;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;&#x4e86;&#xff0c;&#x63a5;&#x4e0b;&#x6765;&#x6211;&#x4eec;&#x5c06;&#x8981;&#x8bbe;&#x8ba1;&#x7ebf;&#x7a0b;&#x6c60;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2878,2879"}},{"content":"<pre data-lines=\"2880,2899\"><code class=\"language-java\">\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ThreadPool</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> coreSize;                                   \n    <span class=\"hljs-keyword\">private</span> Long timeout;                                   \n    <span class=\"hljs-keyword\">private</span> TimeUnit timeUnit;                              \n    <span class=\"hljs-keyword\">private</span> HashSet&lt;Worker&gt; workers = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashSet</span>&lt;&gt;();      \n    <span class=\"hljs-keyword\">private</span> BlockingQueue&lt;Runnable&gt; taskQueue;              \n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">ThreadPool</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> coreSize, Long timeout, TimeUnit timeUnit, <span class=\"hljs-type\">int</span> taskQueueSize)</span> {\n        <span class=\"hljs-built_in\">this</span>.coreSize = coreSize;\n        <span class=\"hljs-built_in\">this</span>.timeout = timeout;\n        <span class=\"hljs-built_in\">this</span>.timeUnit = timeUnit;\n        <span class=\"hljs-built_in\">this</span>.taskQueue = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BlockingQueue</span>&lt;&gt;(taskQueueSize);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2880,2899"}},{"content":"<pre data-lines=\"2900,2901\"><code>&#x6211;&#x4eec;&#x9700;&#x8981;&#x8bbe;&#x8ba1; Worker &#x5de5;&#x4f5c;&#x7ebf;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2900,2901"}},{"content":"<pre data-lines=\"2902,2965\"><code class=\"language-java\">\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ThreadPool</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> coreSize;                                   \n    <span class=\"hljs-keyword\">private</span> Long timeout;                                   \n    <span class=\"hljs-keyword\">private</span> TimeUnit timeUnit;                              \n    <span class=\"hljs-keyword\">private</span> HashSet&lt;Worker&gt; workers = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">HashSet</span>&lt;&gt;();      \n    <span class=\"hljs-keyword\">private</span> BlockingQueue&lt;Runnable&gt; taskQueue;              \n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">ThreadPool</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> coreSize, Long timeout, TimeUnit timeUnit, <span class=\"hljs-type\">int</span> taskQueueSize)</span> {\n        <span class=\"hljs-built_in\">this</span>.coreSize = coreSize;\n        <span class=\"hljs-built_in\">this</span>.timeout = timeout;\n        <span class=\"hljs-built_in\">this</span>.timeUnit = timeUnit;\n        <span class=\"hljs-built_in\">this</span>.taskQueue = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BlockingQueue</span>&lt;&gt;(taskQueueSize);\n    }\n\n    \n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Worker</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">Thread</span> {\n        <span class=\"hljs-keyword\">private</span> Runnable task;\n\n        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">Worker</span><span class=\"hljs-params\">(Runnable task)</span> {\n            <span class=\"hljs-built_in\">this</span>.task = task;\n        }\n\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">run</span><span class=\"hljs-params\">()</span> {\n            \n            <span class=\"hljs-keyword\">while</span> (task != <span class=\"hljs-literal\">null</span> || (task = taskQueue.poll(timeout, timeUnit)) != <span class=\"hljs-literal\">null</span>) {\n                <span class=\"hljs-keyword\">try</span> {\n                    task.run();\n                } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n                    e.printStackTrace();\n                } <span class=\"hljs-keyword\">finally</span> {\n                    task = <span class=\"hljs-literal\">null</span>;\n                }\n            }\n            \n            <span class=\"hljs-keyword\">synchronized</span> (workers) {\n                log.info(<span class=\"hljs-string\">&quot;&#x79fb;&#x9664;&#x7ebf;&#x7a0b;&#xff1a;{}&quot;</span>, <span class=\"hljs-built_in\">this</span>);\n                workers.remove(<span class=\"hljs-built_in\">this</span>);\n            }\n        }\n    }\n\n    \n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">execute</span><span class=\"hljs-params\">(Runnable task)</span> {\n        \n        \n        <span class=\"hljs-keyword\">synchronized</span> (workers) {\n            <span class=\"hljs-keyword\">if</span> (workers.size() &lt; coreSize) {\n                <span class=\"hljs-type\">Worker</span> <span class=\"hljs-variable\">worker</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Worker</span>(task);\n                log.debug(<span class=\"hljs-string\">&quot;&#x65b0;&#x589e; worker &#x6267;&#x884c; {}&quot;</span>, worker, task);\n                workers.add(worker);\n                worker.start();\n            } <span class=\"hljs-keyword\">else</span> {\n                taskQueue.put(task);\n            }\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2902,2965"}},{"content":"<pre data-lines=\"2966,2967\"><code>&#x63a5;&#x4e0b;&#x6765;&#xff0c;&#x6211;&#x4eec;&#x9700;&#x8981;&#x5bf9;&#x81ea;&#x5df1;&#x8bbe;&#x8ba1;&#x7684;&#x81ea;&#x5b9a;&#x4e49;&#x7ebf;&#x7a0b;&#x6c60;&#x8fdb;&#x884c;&#x6d4b;&#x8bd5;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2966,2967"}},{"content":"<pre data-lines=\"2968,2989\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ThreadPoolTest</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">ThreadPool</span> <span class=\"hljs-variable\">threadPool</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ThreadPool</span>(<span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">1000L</span>, TimeUnit.MILLISECONDS, <span class=\"hljs-number\">10</span>);\n\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">10</span>; i++) {\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">info</span> <span class=\"hljs-operator\">=</span> i;\n            threadPool.execute(() -&gt; {\n                <span class=\"hljs-keyword\">try</span> {\n                    Thread.sleep(<span class=\"hljs-number\">2000</span>);\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, info);\n            });\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2968,2989"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/9008cc116ba749c27eb7f0c4bd3b0e07.png\" alt>","children":[],"payload":{"tag":"img","lines":"2990,2991"}},{"content":"<pre data-lines=\"2992,3013\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ThreadPoolTest</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">ThreadPool</span> <span class=\"hljs-variable\">threadPool</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ThreadPool</span>(<span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">1000L</span>, TimeUnit.MILLISECONDS, <span class=\"hljs-number\">1</span>);\n\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">10</span>; i++) {\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">info</span> <span class=\"hljs-operator\">=</span> i;\n            threadPool.execute(() -&gt; {\n                <span class=\"hljs-keyword\">try</span> {\n                    Thread.sleep(<span class=\"hljs-number\">1000</span>);\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, info);\n            });\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2992,3013"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/696ea9779cb28888f69408bc5b599dbf.png\" alt>","children":[],"payload":{"tag":"img","lines":"3014,3015"}},{"content":"<pre data-lines=\"3016,3025\"><code>&#x5f53;&#x4efb;&#x52a1;&#x6570;&#x5df2;&#x7ecf;&#x8d85;&#x8fc7; coreSize &#x65f6;&#xff0c;&#x5c06; task &#x52a0;&#x5165;&#x963b;&#x585e;&#x961f;&#x5217;&#x4e4b;&#x4e2d;&#xff0c;&#x4e00;&#x822c;&#x6765;&#x8bf4;&#xff0c;&#x6211;&#x4eec;&#x4e0d;&#x80fd;&#x4e00;&#x76f4;&#x90fd;&#x7b49;&#x5f85;&#xff0c;&#x4e00;&#x822c;&#x6709;&#x4ee5;&#x4e0b;&#x51e0;&#x79cd;&#x5904;&#x7406;&#x65b9;&#x6848;&#xff1a;\n\n*   &#x6b7b;&#x7b49;\n*   &#x5e26;&#x8d85;&#x65f6;&#x7b49;&#x5f85;\n*   &#x8ba9;&#x8c03;&#x7528;&#x8005;&#x653e;&#x5f03;&#x4efb;&#x52a1;&#x6267;&#x884c;\n*   &#x8ba9;&#x8c03;&#x7528;&#x8005;&#x629b;&#x51fa;&#x5f02;&#x5e38;\n*   &#x8ba9;&#x8c03;&#x7528;&#x8005;&#x81ea;&#x5df1;&#x6267;&#x884c;&#x4efb;&#x52a1;\n\n&#x4e3a;&#x4e86;&#x80fd;&#x591f;&#x652f;&#x6301;&#x4e0d;&#x540c;&#x7684;&#x62d2;&#x7edd;&#x7b56;&#x7565;&#xff0c;&#x6211;&#x4eec;&#x9700;&#x8981;&#x81ea;&#x5df1;&#x8bbe;&#x8ba1;&#x4e00;&#x4e2a;&#x63a5;&#x53e3;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3016,3025"}},{"content":"<pre data-lines=\"3026,3034\"><code class=\"language-java\">\n<span class=\"hljs-meta\">@FunctionalInterface</span>\n<span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title class_\">RejectPolicy</span>&lt;T&gt; {\n    <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">reject</span><span class=\"hljs-params\">(BlockingQueue&lt;T&gt; taskQueue, T task)</span>;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3026,3034"}},{"content":"<pre data-lines=\"3035,3036\"><code>&#x5728; `BlockingQueue` &#x4e2d;&#x6dfb;&#x52a0;&#x4e00;&#x4e2a;&#x5c1d;&#x8bd5;&#x52a0;&#x5165;&#x7684;&#x65b9;&#x6cd5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3035,3036"}},{"content":"<pre data-lines=\"3037,3057\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">tryPut</span><span class=\"hljs-params\">(RejectPolicy&lt;T&gt; rejectPolicy, T task)</span> {\n    lock.lock();\n    <span class=\"hljs-keyword\">try</span> {\n        \n        <span class=\"hljs-keyword\">if</span> (deque.size() == capcity) {\n            rejectPolicy.reject(<span class=\"hljs-built_in\">this</span>, task);\n        } <span class=\"hljs-keyword\">else</span>\n            \n        {\n            log.info(<span class=\"hljs-string\">&quot;&#x5c1d;&#x8bd5;&#x52a0;&#x5165;&#x963b;&#x585e;&#x961f;&#x5217;&#xff1a;{}&quot;</span>, task);\n            deque.addLast(task);\n            emptyWaitSet.signal();\n        }\n    } <span class=\"hljs-keyword\">finally</span> {\n        lock.unlock();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3037,3057"}},{"content":"<pre data-lines=\"3058,3059\"><code>&#x5728; `ThreadPool` &#x4e2d;&#x6dfb;&#x52a0;&#x4e00;&#x4e2a;&#x62d2;&#x7edd;&#x7b56;&#x7565;&#x7684;&#x5c5e;&#x6027;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3058,3059"}},{"content":"<pre data-lines=\"3060,3064\"><code class=\"language-java\"><span class=\"hljs-keyword\">private</span> RejectPolicy&lt;Runnable&gt; rejectPolicy;            \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3060,3064"}},{"content":"<pre data-lines=\"3067,3077\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">ThreadPool</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> coreSize, Long timeout, TimeUnit timeUnit, <span class=\"hljs-type\">int</span> taskQueueSize, RejectPolicy&lt;Runnable&gt; rejectPolicy)</span> {\n    <span class=\"hljs-built_in\">this</span>.coreSize = coreSize;\n    <span class=\"hljs-built_in\">this</span>.timeout = timeout;\n    <span class=\"hljs-built_in\">this</span>.timeUnit = timeUnit;\n    <span class=\"hljs-built_in\">this</span>.taskQueue = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BlockingQueue</span>&lt;&gt;(taskQueueSize);\n    <span class=\"hljs-built_in\">this</span>.rejectPolicy = rejectPolicy;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3067,3077"}},{"content":"<pre data-lines=\"3078,3079\"><code>&#x5728; `ThreadPool` &#x4e2d;&#x4fee;&#x6539;&#x6267;&#x884c; `execute` &#x65b9;&#x6cd5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3078,3079"}},{"content":"<pre data-lines=\"3080,3099\"><code class=\"language-java\">\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">execute</span><span class=\"hljs-params\">(Runnable task)</span> {\n    \n    \n    <span class=\"hljs-keyword\">synchronized</span> (workers) {\n        <span class=\"hljs-keyword\">if</span> (workers.size() &lt; coreSize) {\n            <span class=\"hljs-type\">Worker</span> <span class=\"hljs-variable\">worker</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Worker</span>(task);\n            log.debug(<span class=\"hljs-string\">&quot;&#x65b0;&#x589e; worker &#x6267;&#x884c; {}&quot;</span>, worker, task);\n            workers.add(worker);\n            worker.start();\n        } <span class=\"hljs-keyword\">else</span> {\n            \n            taskQueue.tryPut(rejectPolicy, task);\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3080,3099"}},{"content":"<pre data-lines=\"3100,3101\"><code>&#x7d27;&#x63a5;&#x7740;&#xff0c;&#x6211;&#x4eec;&#x9700;&#x8981;&#x5bf9;&#x81ea;&#x5df1;&#x8bbe;&#x8ba1;&#x7684;&#x81ea;&#x5b9a;&#x4e49;&#x7ebf;&#x7a0b;&#x6c60;&#x8fdb;&#x884c;&#x6d4b;&#x8bd5;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3100,3101"}},{"content":"<pre data-lines=\"3102,3134\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ThreadPoolTest</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">ThreadPool</span> <span class=\"hljs-variable\">threadPool</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ThreadPool</span>(<span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">1000L</span>, TimeUnit.MILLISECONDS, <span class=\"hljs-number\">1</span>, (taskQueue, task) -&gt; {\n            \n            taskQueue.put(task);\n            \n            \n            \n            \n            \n            \n            \n            \n        });\n\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">10</span>; i++) {\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">info</span> <span class=\"hljs-operator\">=</span> i;\n            threadPool.execute(() -&gt; {\n                <span class=\"hljs-keyword\">try</span> {\n                    Thread.sleep(<span class=\"hljs-number\">3000</span>);\n                } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                log.info(<span class=\"hljs-string\">&quot;{}&quot;</span>, info);\n            });\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3102,3134"}}],"payload":{"tag":"h3","lines":"2711,2712"}},{"content":"5.1.2&#x3001;ThreadPoolExecutor","children":[{"content":"5.1.2.1&#x3001;&#x7ebf;&#x7a0b;&#x6c60;&#x72b6;&#x6001;","children":[{"content":"<pre data-lines=\"3139,3140\"><code>ThreadPoolExecutor &#x4f7f;&#x7528; int &#x7684;&#x9ad8; 3 &#x4f4d;&#x6765;&#x8868;&#x793a;&#x7ebf;&#x7a0b;&#x6c60;&#x72b6;&#x6001;&#xff0c;&#x4f4e; 29 &#x4f4d;&#x8868;&#x793a;&#x7ebf;&#x7a0b;&#x6570;&#x91cf;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3139,3140"}},{"content":"<table data-lines=\"3141,3148\">\n<thead data-lines=\"3141,3142\">\n<tr data-lines=\"3141,3142\">\n<th>&#x72b6;&#x6001;&#x540d;</th>\n<th>&#x9ad8;3&#x4f4d;</th>\n<th>&#x63a5;&#x6536;&#x65b0;&#x4efb;&#x52a1;</th>\n<th>&#x5904;&#x7406;&#x963b;&#x585e;&#x4efb;&#x52a1;&#x961f;&#x5217;</th>\n<th>&#x8bf4;&#x660e;</th>\n</tr>\n</thead>\n<tbody data-lines=\"3143,3148\">\n<tr data-lines=\"3143,3144\">\n<td>RUNNING</td>\n<td>111</td>\n<td>Y</td>\n<td>Y</td>\n<td>&#x8fd0;&#x884c;&#x72b6;&#x6001;</td>\n</tr>\n<tr data-lines=\"3144,3145\">\n<td>SHUTDOWN</td>\n<td>000</td>\n<td>N</td>\n<td>Y</td>\n<td>&#x4e0d;&#x4f1a;&#x63a5;&#x6536;&#x65b0;&#x4efb;&#x52a1;&#xff0c;&#x4f46;&#x4f1a;&#x5904;&#x7406;&#x963b;&#x585e;&#x961f;&#x5217;&#x5269;&#x4f59;&#x4efb;&#x52a1;</td>\n</tr>\n<tr data-lines=\"3145,3146\">\n<td>STOP</td>\n<td>001</td>\n<td>N</td>\n<td>N</td>\n<td>&#x4f1a;&#x4e2d;&#x65ad;&#x6b63;&#x5728;&#x6267;&#x884c;&#x7684;&#x4efb;&#x52a1;&#xff0c;&#x5e76;&#x629b;&#x5f03;&#x963b;&#x585e;&#x961f;&#x5217;&#x4efb;&#x52a1;</td>\n</tr>\n<tr data-lines=\"3146,3147\">\n<td>TIDYING</td>\n<td>010</td>\n<td>-</td>\n<td>-</td>\n<td>&#x4efb;&#x52a1;&#x5168;&#x6267;&#x884c;&#x5b8c;&#x6bd5;&#xff0c;&#x6d3b;&#x52a8;&#x7ebf;&#x7a0b;&#x4e3a; 0 &#x5373;&#x5c06;&#x8fdb;&#x5165;&#x7ec8;&#x7ed3;</td>\n</tr>\n<tr data-lines=\"3147,3148\">\n<td>TERMINATED</td>\n<td>011</td>\n<td>-</td>\n<td>-</td>\n<td>&#x7ec8;&#x7ed3;&#x72b6;&#x6001;</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"3141,3148"}},{"content":"<pre data-lines=\"3149,3152\"><code>&#x4ece;&#x6570;&#x5b57;&#x4e0a;&#x6bd4;&#x8f83;&#xff0c;TERMINATED &gt; TIDYING &gt; STOP &gt; SHUTDOWN &gt; RUNNING\n\n&#x8fd9;&#x4e9b;&#x4fe1;&#x606f;&#x5b58;&#x50a8;&#x5728;&#x4e00;&#x4e2a;&#x539f;&#x5b50;&#x53d8;&#x91cf; ctl &#x4e2d;&#xff0c;&#x76ee;&#x7684;&#x662f;&#x5c06;&#x7ebf;&#x7a0b;&#x6c60;&#x72b6;&#x6001;&#x4e0e;&#x7ebf;&#x7a0b;&#x4e2a;&#x6570;&#x5408;&#x4e8c;&#x4e3a;&#x4e00;&#xff0c;&#x8fd9;&#x6837;&#x5c31;&#x53ef;&#x4ee5;&#x7528;&#x4e00;&#x6b21; cas &#x539f;&#x5b50;&#x64cd;&#x4f5c;&#x8fdb;&#x884c;&#x8d4b;&#x503c;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3149,3152"}},{"content":"<pre data-lines=\"3153,3161\"><code class=\"language-java\">\nctl.compareAndSet(c, ctlOf(targetState, workerCountOf(c))));\n\n\n<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">ctlOf</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> rs, <span class=\"hljs-type\">int</span> wc)</span> { <span class=\"hljs-keyword\">return</span> rs | wc; }\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3153,3161"}}],"payload":{"tag":"h4","lines":"3137,3138"}},{"content":"5.1.2.2&#x3001;&#x7ebf;&#x7a0b;&#x6c60;&#x6784;&#x9020;","children":[{"content":"<pre data-lines=\"3164,3174\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">ThreadPoolExecutor</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> corePoolSize,\n                              <span class=\"hljs-type\">int</span> maximumPoolSize,\n                              <span class=\"hljs-type\">long</span> keepAliveTime,\n                              TimeUnit unit,\n                              BlockingQueue&lt;Runnable&gt; workQueue,\n                              ThreadFactory threadFactory,\n                              RejectedExecutionHandler handler)</span>{}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3164,3174"}},{"content":"<pre data-lines=\"3175,3184\"><code>*   corePoolSize&#xff1a;&#x6838;&#x5fc3;&#x7ebf;&#x7a0b;&#x6570;&#x76ee; (&#x6700;&#x591a;&#x4fdd;&#x7559;&#x7684;&#x7ebf;&#x7a0b;&#x6570;)\n*   maximumPoolSize&#xff1a;&#x6700;&#x5927;&#x7ebf;&#x7a0b;&#x6570;&#x76ee;\n*   keepAliveTime&#xff1a;&#x751f;&#x5b58;&#x65f6;&#x95f4; - &#x9488;&#x5bf9;&#x6551;&#x6025;&#x7ebf;&#x7a0b;\n*   unit&#xff1a;&#x65f6;&#x95f4;&#x5355;&#x4f4d; - &#x9488;&#x5bf9;&#x6551;&#x6025;&#x7ebf;&#x7a0b;\n*   workQueue&#xff1a;&#x963b;&#x585e;&#x961f;&#x5217;\n*   threadFactory&#xff1a;&#x7ebf;&#x7a0b;&#x5de5;&#x5382; - &#x53ef;&#x4ee5;&#x4e3a;&#x7ebf;&#x7a0b;&#x521b;&#x5efa;&#x65f6;&#x8d77;&#x4e2a;&#x597d;&#x540d;&#x5b57;\n*   handler&#xff1a;&#x62d2;&#x7edd;&#x7b56;&#x7565;\n\n&#x7ebf;&#x7a0b;&#x6c60;&#x4e2d;&#x521a;&#x5f00;&#x59cb;&#x6ca1;&#x6709;&#x7ebf;&#x7a0b;&#xff0c;&#x5f53;&#x4e00;&#x4e2a;&#x4efb;&#x52a1;&#x63d0;&#x4ea4;&#x7ed9;&#x7ebf;&#x7a0b;&#x6c60;&#x540e;&#xff0c;&#x7ebf;&#x7a0b;&#x6c60;&#x4f1a;&#x521b;&#x5efa;&#x4e00;&#x4e2a;&#x65b0;&#x7ebf;&#x7a0b;&#x6765;&#x6267;&#x884c;&#x4efb;&#x52a1;&#x3002;&#x5f53;&#x7ebf;&#x7a0b;&#x6570;&#x8fbe;&#x5230; corePoolSize &#x5e76;&#x6ca1;&#x6709;&#x7ebf;&#x7a0b;&#x7a7a;&#x95f2;&#xff0c;&#x8fd9;&#x65f6;&#x518d;&#x52a0;&#x5165;&#x4efb;&#x52a1;&#xff0c;&#x65b0;&#x52a0;&#x7684;&#x4efb;&#x52a1;&#x4f1a;&#x88ab;&#x52a0;&#x5165; workQueue &#x961f;&#x5217;&#x6392;&#x961f;&#xff0c;&#x76f4;&#x5230;&#x6709;&#x7a7a;&#x95f2;&#x7684;&#x7ebf;&#x7a0b;&#x3002;&#x5982;&#x679c;&#x961f;&#x5217;&#x9009;&#x62e9;&#x4e86;&#x6709;&#x754c;&#x961f;&#x5217;&#xff0c;&#x90a3;&#x4e48;&#x4efb;&#x52a1;&#x8d85;&#x8fc7;&#x4e86;&#x961f;&#x5217;&#x5927;&#x5c0f;&#x65f6;&#xff0c;&#x4f1a;&#x521b;&#x5efa; maximumPoolSize - corePoolSize &#x6570;&#x76ee;&#x7684;&#x7ebf;&#x7a0b;&#x6765;&#x6551;&#x6025;&#x3002;&#x5982;&#x679c;&#x7ebf;&#x7a0b;&#x5230;&#x8fbe; maximumPoolSize &#x4ecd;&#x7136;&#x6709;&#x65b0;&#x4efb;&#x52a1;&#x8fd9;&#x65f6;&#x4f1a;&#x6267;&#x884c;&#x62d2;&#x7edd;&#x7b56;&#x7565;&#x3002;&#x62d2;&#x7edd;&#x7b56;&#x7565; jdk &#x63d0;&#x4f9b;&#x4e86; 4 &#x79cd;&#x5b9e;&#x73b0;&#xff0c;&#x5176;&#x5b83;&#x8457;&#x540d;&#x6846;&#x67b6;&#x4e5f;&#x63d0;&#x4f9b;&#x4e86;&#x5b9e;&#x73b0;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3175,3184"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/2172e7a7202e79b49722ec7edc317ba5.png\" alt>","children":[],"payload":{"tag":"img","lines":"3185,3186"}},{"content":"<pre data-lines=\"3187,3197\"><code>*   AbortPolicy &#x8ba9;&#x8c03;&#x7528;&#x8005;&#x629b;&#x51fa; RejectedExecutionException &#x5f02;&#x5e38;&#xff0c;&#x8fd9;&#x662f;&#x9ed8;&#x8ba4;&#x7b56;&#x7565;\n*   CallerRunsPolicy &#x8ba9;&#x8c03;&#x7528;&#x8005;&#x8fd0;&#x884c;&#x4efb;&#x52a1;\n*   DiscardOldestPolicy &#x653e;&#x5f03;&#x961f;&#x5217;&#x4e2d;&#x6700;&#x65e9;&#x7684;&#x4efb;&#x52a1;&#xff0c;&#x672c;&#x4efb;&#x52a1;&#x53d6;&#x800c;&#x4ee3;&#x4e4b;\n*   DiscardPolicy &#x653e;&#x5f03;&#x672c;&#x6b21;&#x4efb;&#x52a1;\n*   Dubbo &#x7684;&#x5b9e;&#x73b0;&#xff0c;&#x5728;&#x629b;&#x51fa; RejectedExecutionException &#x5f02;&#x5e38;&#x4e4b;&#x524d;&#x4f1a;&#x8bb0;&#x5f55;&#x65e5;&#x5fd7;&#xff0c;&#x5e76; dump &#x7ebf;&#x7a0b;&#x6808;&#x4fe1;&#x606f;&#xff0c;&#x65b9;&#x4fbf;&#x5b9a;&#x4f4d;&#x95ee;&#x9898;\n*   Netty &#x7684;&#x5b9e;&#x73b0;&#xff0c;&#x662f;&#x521b;&#x5efa;&#x4e00;&#x4e2a;&#x65b0;&#x7ebf;&#x7a0b;&#x6765;&#x6267;&#x884c;&#x4efb;&#x52a1;\n*   ActiveMQ &#x7684;&#x5b9e;&#x73b0;&#xff0c;&#x5e26;&#x8d85;&#x65f6;&#x7b49;&#x5f85;&#xff08;60s&#xff09;&#x5c1d;&#x8bd5;&#x653e;&#x5165;&#x961f;&#x5217;&#xff0c;&#x7c7b;&#x4f3c;&#x6211;&#x4eec;&#x4e4b;&#x524d;&#x81ea;&#x5b9a;&#x4e49;&#x7684;&#x62d2;&#x7edd;&#x7b56;&#x7565;\n*   PinPoint &#x7684;&#x5b9e;&#x73b0;&#xff0c;&#x5b83;&#x4f7f;&#x7528;&#x4e86;&#x4e00;&#x4e2a;&#x62d2;&#x7edd;&#x7b56;&#x7565;&#x94fe;&#xff0c;&#x4f1a;&#x9010;&#x4e00;&#x5c1d;&#x8bd5;&#x7b56;&#x7565;&#x94fe;&#x4e2d;&#x6bcf;&#x79cd;&#x62d2;&#x7edd;&#x7b56;&#x7565;\n\n&#x9ad8;&#x5cf0;&#x8fc7;&#x53bb;&#x540e;&#xff0c;&#x8d85;&#x8fc7; corePoolSize &#x7684;&#x6551;&#x6025;&#x7ebf;&#x7a0b;&#xff0c;&#x5982;&#x679c;&#x4e00;&#x6bb5;&#x65f6;&#x95f4;&#x6ca1;&#x6709;&#x4efb;&#x52a1;&#x505a;&#xff0c;&#x9700;&#x8981;&#x7ed3;&#x675f;&#x8282;&#x7701;&#x8d44;&#x6e90;&#xff0c;&#x8fd9;&#x4e2a;&#x65f6;&#x95f4;&#x7531; keepAliveTime &#x548c; unit &#x63a7;&#x5236;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3187,3197"}}],"payload":{"tag":"h4","lines":"3162,3163"}},{"content":"5.1.2.3&#x3001;&#x7ebf;&#x7a0b;&#x6c60;&#x5de5;&#x5382;&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"3200,3203\"><code>&#x6839;&#x636e;&#x8fd9;&#x4e2a;&#x6784;&#x9020;&#x65b9;&#x6cd5;&#xff0c;JDK Executors &#x7c7b;&#x4e2d;&#x63d0;&#x4f9b;&#x4e86;&#x4f17;&#x591a;&#x5de5;&#x5382;&#x65b9;&#x6cd5;&#x6765;&#x521b;&#x5efa;&#x5404;&#x79cd;&#x7528;&#x9014;&#x7684;&#x7ebf;&#x7a0b;&#x6c60;&#x3002;\n\n**&#xff08;1&#xff09;newFixedThreadPool**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3200,3203"}},{"content":"<pre data-lines=\"3204,3212\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> ExecutorService <span class=\"hljs-title function_\">newFixedThreadPool</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> nThreads)</span> {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ThreadPoolExecutor</span>(nThreads, nThreads,\n                                  <span class=\"hljs-number\">0L</span>, TimeUnit.MILLISECONDS,\n                                  <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LinkedBlockingQueue</span>&lt;Runnable&gt;());\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3204,3212"}},{"content":"<pre data-lines=\"3213,3220\"><code>&#x7279;&#x70b9;&#xff1a;\n\n*   &#x6838;&#x5fc3;&#x7ebf;&#x7a0b;&#x6570; == &#x6700;&#x5927;&#x7ebf;&#x7a0b;&#x6570;&#xff08;&#x6ca1;&#x6709;&#x6551;&#x6025;&#x7ebf;&#x7a0b;&#x88ab;&#x521b;&#x5efa;&#xff09;&#xff0c;&#x56e0;&#x6b64;&#x4e5f;&#x65e0;&#x9700;&#x8d85;&#x65f6;&#x65f6;&#x95f4;\n*   &#x963b;&#x585e;&#x961f;&#x5217;&#x662f;&#x65e0;&#x754c;&#x7684;&#xff0c;&#x53ef;&#x4ee5;&#x653e;&#x4efb;&#x610f;&#x6570;&#x91cf;&#x7684;&#x4efb;&#x52a1;\n*   &#x9002;&#x7528;&#x4e8e;&#x4efb;&#x52a1;&#x91cf;&#x5df2;&#x77e5;&#xff0c;&#x76f8;&#x5bf9;&#x8017;&#x65f6;&#x7684;&#x4efb;&#x52a1;\n\n**&#xff08;2&#xff09;newCachedThreadPool**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3213,3220"}},{"content":"<pre data-lines=\"3221,3229\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> ExecutorService <span class=\"hljs-title function_\">newCachedThreadPool</span><span class=\"hljs-params\">()</span> {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ThreadPoolExecutor</span>(<span class=\"hljs-number\">0</span>, Integer.MAX_VALUE,\n                                  <span class=\"hljs-number\">60L</span>, TimeUnit.SECONDS,\n                                  <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SynchronousQueue</span>&lt;Runnable&gt;());\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3221,3229"}},{"content":"<pre data-lines=\"3230,3237\"><code>&#x7279;&#x70b9;&#xff1a;\n\n*   &#x6838;&#x5fc3;&#x7ebf;&#x7a0b;&#x6570;&#x662f; 0&#xff0c; &#x6700;&#x5927;&#x7ebf;&#x7a0b;&#x6570;&#x662f; Integer.MAX\\_VALUE&#xff0c;&#x6551;&#x6025;&#x7ebf;&#x7a0b;&#x7684;&#x7a7a;&#x95f2;&#x751f;&#x5b58;&#x65f6;&#x95f4;&#x662f; 60s&#xff0c;&#x610f;&#x5473;&#x7740;&#x5168;&#x90e8;&#x90fd;&#x662f;&#x6551;&#x6025;&#x7ebf;&#x7a0b;&#xff08;60s &#x540e;&#x56de;&#x6536;&#xff09;&#xff0c;&#x6551;&#x6025;&#x7ebf;&#x7a0b;&#x53ef;&#x4ee5;&#x65e0;&#x9650;&#x521b;&#x5efa;\n*   &#x6551;&#x6025;&#x7ebf;&#x7a0b;&#x53ef;&#x4ee5;&#x65e0;&#x9650;&#x521b;&#x5efa;&#x961f;&#x5217;&#x91c7;&#x7528;&#x4e86; SynchronousQueue &#x5b9e;&#x73b0;&#x7279;&#x70b9;&#x662f;&#xff0c;&#x5b83;&#x6ca1;&#x6709;&#x5bb9;&#x91cf;&#xff0c;&#x6ca1;&#x6709;&#x7ebf;&#x7a0b;&#x6765;&#x53d6;&#x662f;&#x653e;&#x4e0d;&#x8fdb;&#x53bb;&#x7684;\n*   &#x6574;&#x4e2a;&#x7ebf;&#x7a0b;&#x6c60;&#x8868;&#x73b0;&#x4e3a;&#x7ebf;&#x7a0b;&#x6570;&#x4f1a;&#x6839;&#x636e;&#x4efb;&#x52a1;&#x91cf;&#x4e0d;&#x65ad;&#x589e;&#x957f;&#xff0c;&#x6ca1;&#x6709;&#x4e0a;&#x9650;&#xff0c;&#x5f53;&#x4efb;&#x52a1;&#x6267;&#x884c;&#x5b8c;&#x6bd5;&#xff0c;&#x7a7a;&#x95f2; 1&#x5206;&#x949f;&#x540e;&#x91ca;&#x653e;&#x7ebf;&#x7a0b;&#x3002; &#x9002;&#x5408;&#x4efb;&#x52a1;&#x6570;&#x6bd4;&#x8f83;&#x5bc6;&#x96c6;&#xff0c;&#x4f46;&#x6bcf;&#x4e2a;&#x4efb;&#x52a1;&#x6267;&#x884c;&#x65f6;&#x95f4;&#x8f83;&#x77ed;&#x7684;&#x60c5;&#x51b5;\n\n**&#xff08;3&#xff09;newSingleThreadExecutor**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3230,3237"}},{"content":"<pre data-lines=\"3238,3247\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> ExecutorService <span class=\"hljs-title function_\">newSingleThreadExecutor</span><span class=\"hljs-params\">()</span> {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FinalizableDelegatedExecutorService</span>\n        (<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ThreadPoolExecutor</span>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>,\n                                <span class=\"hljs-number\">0L</span>, TimeUnit.MILLISECONDS,\n                                <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LinkedBlockingQueue</span>&lt;Runnable&gt;()));\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3238,3247"}},{"content":"<pre data-lines=\"3248,3257\"><code>&#x7279;&#x70b9;&#xff1a;\n\n*   &#x5e0c;&#x671b;&#x591a;&#x4e2a;&#x4efb;&#x52a1;&#x6392;&#x961f;&#x6267;&#x884c;&#x3002;&#x7ebf;&#x7a0b;&#x6570;&#x56fa;&#x5b9a;&#x4e3a; 1&#xff0c;&#x4efb;&#x52a1;&#x6570;&#x591a;&#x4e8e; 1 &#x65f6;&#xff0c;&#x4f1a;&#x653e;&#x5165;&#x65e0;&#x754c;&#x961f;&#x5217;&#x6392;&#x961f;&#x3002;&#x4efb;&#x52a1;&#x6267;&#x884c;&#x5b8c;&#x6bd5;&#xff0c;&#x8fd9;&#x552f;&#x4e00;&#x7684;&#x7ebf;&#x7a0b;&#x4e5f;&#x4e0d;&#x4f1a;&#x88ab;&#x91ca;&#x653e;\n*   &#x81ea;&#x5df1;&#x521b;&#x5efa;&#x4e00;&#x4e2a;&#x5355;&#x7ebf;&#x7a0b;&#x4e32;&#x884c;&#x6267;&#x884c;&#x4efb;&#x52a1;&#xff0c;&#x5982;&#x679c;&#x4efb;&#x52a1;&#x6267;&#x884c;&#x5931;&#x8d25;&#x800c;&#x7ec8;&#x6b62;&#x90a3;&#x4e48;&#x6ca1;&#x6709;&#x4efb;&#x4f55;&#x8865;&#x6551;&#x63aa;&#x65bd;&#xff0c;&#x800c;&#x7ebf;&#x7a0b;&#x6c60;&#x4f1a;&#x65b0;&#x5efa;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#xff0c;&#x4fdd;&#x8bc1;&#x6c60;&#x7684;&#x6b63;&#x5e38;&#x5de5;&#x4f5c;\n\n&#x6ce8;&#x610f;&#xff1a;\n\n*   Executors.newSingleThreadExecutor() &#x7ebf;&#x7a0b;&#x4e2a;&#x6570;&#x59cb;&#x7ec8;&#x4e3a;1&#xff0c;&#x4e0d;&#x80fd;&#x4fee;&#x6539;&#xff0c;FinalizableDelegatedExecutorService &#x5e94;&#x7528;&#x7684;&#x662f;&#x88c5;&#x9970;&#x5668;&#x6a21;&#x5f0f;&#xff0c;&#x53ea;&#x5bf9;&#x5916;&#x66b4;&#x9732;&#x4e86; ExecutorService &#x63a5;&#x53e3;&#xff0c;&#x56e0;&#x6b64;&#x4e0d;&#x80fd;&#x8c03;&#x7528; ThreadPoolExecutor &#x4e2d;&#x7279;&#x6709;&#x7684;&#x65b9;&#x6cd5;\n*   Executors.newFixedThreadPool(1) &#x521d;&#x59cb;&#x65f6;&#x4e3a;1&#xff0c;&#x4ee5;&#x540e;&#x8fd8;&#x53ef;&#x4ee5;&#x4fee;&#x6539;&#xff0c;&#x5bf9;&#x5916;&#x66b4;&#x9732;&#x7684;&#x662f; ThreadPoolExecutor &#x5bf9;&#x8c61;&#xff0c;&#x53ef;&#x4ee5;&#x5f3a;&#x8f6c;&#x540e;&#x8c03;&#x7528; setCorePoolSize &#x7b49;&#x65b9;&#x6cd5;&#x8fdb;&#x884c;&#x4fee;&#x6539;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3248,3257"}}],"payload":{"tag":"h4","lines":"3198,3199"}},{"content":"5.1.2.4&#x3001;&#x7ebf;&#x7a0b;&#x6c60;&#x63d0;&#x4ea4;&#x4efb;&#x52a1;","children":[{"content":"<pre data-lines=\"3260,3280\"><code class=\"language-java\">\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">execute</span><span class=\"hljs-params\">(Runnable command)</span>\n\n\n<span class=\"hljs-keyword\">public</span> &lt;T&gt; Future&lt;T&gt; <span class=\"hljs-title function_\">submit</span><span class=\"hljs-params\">(Callable&lt;T&gt; task)</span>\n<span class=\"hljs-keyword\">public</span> Future&lt;?&gt; submit(Runnable task)\n<span class=\"hljs-keyword\">public</span> &lt;T&gt; Future&lt;T&gt; <span class=\"hljs-title function_\">submit</span><span class=\"hljs-params\">(Runnable task, T result)</span>\n\n\n<span class=\"hljs-keyword\">public</span> &lt;T&gt; List&lt;Future&lt;T&gt;&gt; <span class=\"hljs-title function_\">invokeAll</span><span class=\"hljs-params\">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span>\n\n<span class=\"hljs-keyword\">public</span> &lt;T&gt; List&lt;Future&lt;T&gt;&gt; <span class=\"hljs-title function_\">invokeAll</span><span class=\"hljs-params\">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, <span class=\"hljs-type\">long</span> timeout, TimeUnit unit)</span>\n\n\n<span class=\"hljs-keyword\">public</span> &lt;T&gt; T <span class=\"hljs-title function_\">invokeAny</span><span class=\"hljs-params\">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span>\n\n<span class=\"hljs-keyword\">public</span> &lt;T&gt; T <span class=\"hljs-title function_\">invokeAny</span><span class=\"hljs-params\">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, <span class=\"hljs-type\">long</span> timeout, TimeUnit unit)</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3260,3280"}}],"payload":{"tag":"h4","lines":"3258,3259"}},{"content":"5.1.2.5&#x3001;&#x7ebf;&#x7a0b;&#x6c60;&#x5173;&#x95ed;&#x65b9;&#x6cd5;","children":[{"content":"<pre data-lines=\"3283,3296\"><code class=\"language-java\">\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">shutdown</span><span class=\"hljs-params\">()</span>\n\n<span class=\"hljs-keyword\">public</span> List&lt;Runnable&gt; <span class=\"hljs-title function_\">shutdownNow</span><span class=\"hljs-params\">()</span>\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">isShutdown</span><span class=\"hljs-params\">()</span>\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">isTerminated</span><span class=\"hljs-params\">()</span>\n\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">awaitTermination</span><span class=\"hljs-params\">(<span class=\"hljs-type\">long</span> timeout, TimeUnit unit)</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3283,3296"}}],"payload":{"tag":"h4","lines":"3281,3282"}},{"content":"5.1.2.6&#x3001;&#x4efb;&#x52a1;&#x8c03;&#x5ea6;&#x7ebf;&#x7a0b;&#x6c60;","children":[{"content":"<pre data-lines=\"3299,3315\"><code class=\"language-java\"><span class=\"hljs-type\">ScheduledExecutorService</span> <span class=\"hljs-variable\">pool</span> <span class=\"hljs-operator\">=</span> Executors.newScheduledThreadPool(<span class=\"hljs-number\">2</span>);\npool.schedule(() -&gt; {\n    System.out.println(<span class=\"hljs-string\">&quot;&#x6211;&#x6267;&#x884c;&#x5566;1&quot;</span>);\n}, <span class=\"hljs-number\">1000</span>, TimeUnit.MILLISECONDS);\npool.schedule(() -&gt; {\n    System.out.println(<span class=\"hljs-string\">&quot;&#x6211;&#x6267;&#x884c;&#x5566;2&quot;</span>);\n}, <span class=\"hljs-number\">1000</span>, TimeUnit.MILLISECONDS);\npool.schedule(() -&gt; {\n    System.out.println(<span class=\"hljs-string\">&quot;&#x6211;&#x6267;&#x884c;&#x5566;3&quot;</span>);\n}, <span class=\"hljs-number\">1000</span>, TimeUnit.MILLISECONDS);\npool.schedule(() -&gt; {\n    System.out.println(<span class=\"hljs-string\">&quot;&#x6211;&#x6267;&#x884c;&#x5566;4&quot;</span>);\n}, <span class=\"hljs-number\">1000</span>, TimeUnit.MILLISECONDS);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3299,3315"}},{"content":"<pre data-lines=\"3316,3317\"><code>scheduleAtFixedRate&#xff1a;&#xff08;&#x5ef6;&#x65f6;&#x65f6;&#x95f4;&#x3001;&#x95f4;&#x9694;&#x65f6;&#x95f4;&#x3001;&#x65f6;&#x95f4;&#x5355;&#x4f4d;&#xff09;&#xff0c;&#x5982;&#x679c;&#x6267;&#x884c;&#x903b;&#x8f91;&#x65f6;&#x95f4;&#x5927;&#x4e8e;&#x95f4;&#x9694;&#x65f6;&#x95f4;&#xff0c;&#x4ee5;&#x6267;&#x884c;&#x903b;&#x8f91;&#x65f6;&#x95f4;&#x4e3a;&#x51c6;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3316,3317"}},{"content":"<pre data-lines=\"3318,3330\"><code class=\"language-java\"><span class=\"hljs-type\">ScheduledExecutorService</span> <span class=\"hljs-variable\">pool</span> <span class=\"hljs-operator\">=</span> Executors.newScheduledThreadPool(<span class=\"hljs-number\">2</span>);\npool.scheduleAtFixedRate(() -&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n        Thread.sleep(<span class=\"hljs-number\">2000</span>);\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n    log.info(<span class=\"hljs-string\">&quot;&#x6211;&#x6267;&#x884c;&#x5566;&quot;</span>);\n}, <span class=\"hljs-number\">1000</span>, <span class=\"hljs-number\">1000</span>, TimeUnit.MILLISECONDS);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3318,3330"}},{"content":"<pre data-lines=\"3331,3339\"><code class=\"language-java\">16:08:44.178 [pool-1-thread-1] INFO com.caochenlei.Test40 - &#x6211;&#x6267;&#x884c;&#x5566;\n16:08:46.200 [pool-1-thread-1] INFO com.caochenlei.Test40 - &#x6211;&#x6267;&#x884c;&#x5566;\n16:08:48.207 [pool-1-thread-1] INFO com.caochenlei.Test40 - &#x6211;&#x6267;&#x884c;&#x5566;\n16:08:50.215 [pool-1-thread-1] INFO com.caochenlei.Test40 - &#x6211;&#x6267;&#x884c;&#x5566;\n16:08:52.221 [pool-1-thread-1] INFO com.caochenlei.Test40 - &#x6211;&#x6267;&#x884c;&#x5566;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3331,3339"}},{"content":"<pre data-lines=\"3340,3341\"><code>scheduleWithFixedDelay&#xff1a;&#xff08;&#x5ef6;&#x65f6;&#x65f6;&#x95f4;&#x3001;&#x95f4;&#x9694;&#x65f6;&#x95f4;&#x3001;&#x65f6;&#x95f4;&#x5355;&#x4f4d;&#xff09;&#xff0c;&#x5982;&#x679c;&#x6267;&#x884c;&#x903b;&#x8f91;&#x65f6;&#x95f4;&#x5927;&#x4e8e;&#x95f4;&#x9694;&#x65f6;&#x95f4;&#xff0c;&#x4ee5;&#x6267;&#x884c;&#x903b;&#x8f91;&#x65f6;&#x95f4; + &#x95f4;&#x9694;&#x65f6;&#x95f4;&#x4e3a;&#x51c6;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3340,3341"}},{"content":"<pre data-lines=\"3342,3354\"><code class=\"language-java\"><span class=\"hljs-type\">ScheduledExecutorService</span> <span class=\"hljs-variable\">pool</span> <span class=\"hljs-operator\">=</span> Executors.newScheduledThreadPool(<span class=\"hljs-number\">2</span>);\npool.scheduleWithFixedDelay(() -&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n        Thread.sleep(<span class=\"hljs-number\">2000</span>);\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n    log.info(<span class=\"hljs-string\">&quot;&#x6211;&#x6267;&#x884c;&#x5566;&quot;</span>);\n}, <span class=\"hljs-number\">1000</span>, <span class=\"hljs-number\">1000</span>, TimeUnit.MILLISECONDS);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3342,3354"}},{"content":"<pre data-lines=\"3355,3363\"><code class=\"language-java\">16:10:34.122 [pool-1-thread-1] INFO com.caochenlei.Test40 - &#x6211;&#x6267;&#x884c;&#x5566;\n16:10:37.157 [pool-1-thread-1] INFO com.caochenlei.Test40 - &#x6211;&#x6267;&#x884c;&#x5566;\n16:10:40.167 [pool-1-thread-1] INFO com.caochenlei.Test40 - &#x6211;&#x6267;&#x884c;&#x5566;\n16:10:43.174 [pool-1-thread-1] INFO com.caochenlei.Test40 - &#x6211;&#x6267;&#x884c;&#x5566;\n16:10:46.192 [pool-1-thread-1] INFO com.caochenlei.Test40 - &#x6211;&#x6267;&#x884c;&#x5566;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3355,3363"}}],"payload":{"tag":"h4","lines":"3297,3298"}}],"payload":{"tag":"h3","lines":"3135,3136"}},{"content":"5.1.3&#x3001;Fork &amp; Join","children":[{"content":"<pre data-lines=\"3366,3377\"><code>Fork/Join &#x662f; JDK 1.7 &#x52a0;&#x5165;&#x7684;&#x65b0;&#x7684;&#x7ebf;&#x7a0b;&#x6c60;&#x5b9e;&#x73b0;&#xff0c;&#x5b83;&#x4f53;&#x73b0;&#x7684;&#x662f;&#x4e00;&#x79cd;&#x5206;&#x6cbb;&#x601d;&#x60f3;&#xff0c;&#x9002;&#x7528;&#x4e8e;&#x80fd;&#x591f;&#x8fdb;&#x884c;&#x4efb;&#x52a1;&#x62c6;&#x5206;&#x7684; cpu &#x5bc6;&#x96c6;&#x578b;&#x8fd0;&#x7b97;&#x3002;\n\n&#x6240;&#x8c13;&#x7684;&#x4efb;&#x52a1;&#x62c6;&#x5206;&#xff0c;&#x662f;&#x5c06;&#x4e00;&#x4e2a;&#x5927;&#x4efb;&#x52a1;&#x62c6;&#x5206;&#x4e3a;&#x7b97;&#x6cd5;&#x4e0a;&#x76f8;&#x540c;&#x7684;&#x5c0f;&#x4efb;&#x52a1;&#xff0c;&#x76f4;&#x81f3;&#x4e0d;&#x80fd;&#x62c6;&#x5206;&#x53ef;&#x4ee5;&#x76f4;&#x63a5;&#x6c42;&#x89e3;&#x3002;&#x8ddf;&#x9012;&#x5f52;&#x76f8;&#x5173;&#x7684;&#x4e00;&#x4e9b;&#x8ba1;&#x7b97;&#xff0c;&#x5982;&#x5f52;&#x5e76;&#x6392;&#x5e8f;&#x3001;&#x6590;&#x6ce2;&#x90a3;&#x5951;&#x6570;&#x5217;&#x3001;&#x90fd;&#x53ef;&#x4ee5;&#x7528;&#x5206;&#x6cbb;&#x601d;&#x60f3;&#x8fdb;&#x884c;&#x6c42;&#x89e3;&#x3002;\n\nFork/Join &#x5728;&#x5206;&#x6cbb;&#x7684;&#x57fa;&#x7840;&#x4e0a;&#x52a0;&#x5165;&#x4e86;&#x591a;&#x7ebf;&#x7a0b;&#xff0c;&#x53ef;&#x4ee5;&#x628a;&#x6bcf;&#x4e2a;&#x4efb;&#x52a1;&#x7684;&#x5206;&#x89e3;&#x548c;&#x5408;&#x5e76;&#x4ea4;&#x7ed9;&#x4e0d;&#x540c;&#x7684;&#x7ebf;&#x7a0b;&#x6765;&#x5b8c;&#x6210;&#xff0c;&#x8fdb;&#x4e00;&#x6b65;&#x63d0;&#x5347;&#x4e86;&#x8fd0;&#x7b97;&#x6548;&#x7387;&#x3002;\n\nFork/Join &#x9ed8;&#x8ba4;&#x4f1a;&#x521b;&#x5efa;&#x4e0e; cpu &#x6838;&#x5fc3;&#x6570;&#x5927;&#x5c0f;&#x76f8;&#x540c;&#x7684;&#x7ebf;&#x7a0b;&#x6c60;&#x3002;\n\n&#x63d0;&#x4ea4;&#x7ed9; Fork/Join &#x7ebf;&#x7a0b;&#x6c60;&#x7684;&#x4efb;&#x52a1;&#x9700;&#x8981;&#x7ee7;&#x627f; RecursiveTask&#xff08;&#x6709;&#x8fd4;&#x56de;&#x503c;&#xff09;&#x6216; RecursiveAction&#xff08;&#x6ca1;&#x6709;&#x8fd4;&#x56de;&#x503c;&#xff09;&#x3002;\n\n&#x4f8b;&#x5982;&#x4e0b;&#x9762;&#x5b9a;&#x4e49;&#x4e86;&#x4e00;&#x4e2a;&#x5bf9; `1~n` &#x4e4b;&#x95f4;&#x7684;&#x6574;&#x6570;&#x6c42;&#x548c;&#x7684;&#x4efb;&#x52a1;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3366,3377"}},{"content":"<pre data-lines=\"3378,3407\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyTask</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">RecursiveTask</span>&lt;Integer&gt; {\n    <span class=\"hljs-type\">int</span> begin;\n    <span class=\"hljs-type\">int</span> end;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">MyTask</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> begin, <span class=\"hljs-type\">int</span> end)</span> {\n        <span class=\"hljs-built_in\">this</span>.begin = begin;\n        <span class=\"hljs-built_in\">this</span>.end = end;\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">protected</span> Integer <span class=\"hljs-title function_\">compute</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">if</span> (begin == end) {\n            log.info(<span class=\"hljs-string\">&quot;join {}&quot;</span>, begin);\n            <span class=\"hljs-keyword\">return</span> begin;\n        }\n\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">mid</span> <span class=\"hljs-operator\">=</span> (begin + end) / <span class=\"hljs-number\">2</span>;\n        <span class=\"hljs-type\">MyTask</span> <span class=\"hljs-variable\">myTask1</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MyTask</span>(begin, mid);\n        myTask1.fork();\n        <span class=\"hljs-type\">MyTask</span> <span class=\"hljs-variable\">myTask2</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MyTask</span>(mid + <span class=\"hljs-number\">1</span>, end);\n        myTask2.fork();\n\n        <span class=\"hljs-keyword\">return</span> myTask1.join() + myTask2.join();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3378,3407"}},{"content":"<pre data-lines=\"3408,3417\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyTaskTest</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">ForkJoinPool</span> <span class=\"hljs-variable\">pool</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ForkJoinPool</span>(<span class=\"hljs-number\">4</span>);\n        System.out.println(pool.invoke(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MyTask</span>(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">10</span>)));\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3408,3417"}},{"content":"<pre data-lines=\"3418,3432\"><code class=\"language-java\">21:41:05.165 [ForkJoinPool-1-worker-3] INFO com.caochenlei.fj.MyTask - join 6\n21:41:05.165 [ForkJoinPool-1-worker-0] INFO com.caochenlei.fj.MyTask - join 3\n21:41:05.165 [ForkJoinPool-1-worker-2] INFO com.caochenlei.fj.MyTask - join 1\n21:41:05.165 [ForkJoinPool-1-worker-1] INFO com.caochenlei.fj.MyTask - join 4\n21:41:05.174 [ForkJoinPool-1-worker-3] INFO com.caochenlei.fj.MyTask - join 7\n21:41:05.174 [ForkJoinPool-1-worker-1] INFO com.caochenlei.fj.MyTask - join 5\n21:41:05.174 [ForkJoinPool-1-worker-0] INFO com.caochenlei.fj.MyTask - join 2\n21:41:05.174 [ForkJoinPool-1-worker-3] INFO com.caochenlei.fj.MyTask - join 8\n21:41:05.174 [ForkJoinPool-1-worker-3] INFO com.caochenlei.fj.MyTask - join 9\n21:41:05.174 [ForkJoinPool-1-worker-2] INFO com.caochenlei.fj.MyTask - join 10\n55\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3418,3432"}}],"payload":{"tag":"h3","lines":"3364,3365"}}],"payload":{"tag":"h2","lines":"2708,2710"}},{"content":"5.2&#x3001;JUC","children":[{"content":"5.2.1&#x3001;AQS &#x4ecb;&#x7ecd;","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/5cfab6b4ef433cecb744572a51123595.png\" alt>","children":[],"payload":{"tag":"img","lines":"3438,3439"}},{"content":"<pre data-lines=\"3440,3469\"><code>AQS &#x5168;&#x79f0;&#x662f; AbstractQueuedSynchronizer&#xff0c;&#x662f;&#x963b;&#x585e;&#x5f0f;&#x9501;&#x548c;&#x76f8;&#x5173;&#x7684;&#x540c;&#x6b65;&#x5668;&#x5de5;&#x5177;&#x7684;&#x6846;&#x67b6;&#x3002;\n\n&#x65e9;&#x671f;&#x7a0b;&#x5e8f;&#x5458;&#x4f1a;&#x81ea;&#x5df1;&#x901a;&#x8fc7;&#x4e00;&#x79cd;&#x540c;&#x6b65;&#x5668;&#x53bb;&#x5b9e;&#x73b0;&#x53e6;&#x4e00;&#x79cd;&#x76f8;&#x8fd1;&#x7684;&#x540c;&#x6b65;&#x5668;&#xff0c;&#x4f8b;&#x5982;&#x7528;&#x53ef;&#x91cd;&#x5165;&#x9501;&#x53bb;&#x5b9e;&#x73b0;&#x4fe1;&#x53f7;&#x91cf;&#xff0c;&#x6216;&#x53cd;&#x4e4b;&#x3002;&#x8fd9;&#x663e;&#x7136;&#x4e0d;&#x591f;&#x4f18;&#x96c5;&#xff0c;&#x4e8e;&#x662f;&#x5728; JSR166 &#x4e2d;&#x521b;&#x5efa;&#x4e86; AQS&#xff0c;&#x63d0;&#x4f9b;&#x4e86;&#x8fd9;&#x79cd;&#x901a;&#x7528;&#x7684;&#x540c;&#x6b65;&#x5668;&#x673a;&#x5236;&#x3002;\n\nAQS &#x8981;&#x5b9e;&#x73b0;&#x7684;&#x529f;&#x80fd;&#x76ee;&#x6807;&#xff1a;\n\n*   &#x963b;&#x585e;&#x7248;&#x672c;&#x83b7;&#x53d6;&#x9501; acquire &#x548c;&#x975e;&#x963b;&#x585e;&#x7684;&#x7248;&#x672c;&#x5c1d;&#x8bd5;&#x83b7;&#x53d6;&#x9501; tryAcquire\n*   &#x83b7;&#x53d6;&#x9501;&#x8d85;&#x65f6;&#x673a;&#x5236;\n*   &#x901a;&#x8fc7;&#x6253;&#x65ad;&#x53d6;&#x6d88;&#x673a;&#x5236;\n*   &#x72ec;&#x5360;&#x673a;&#x5236;&#x53ca;&#x5171;&#x4eab;&#x673a;&#x5236;\n*   &#x6761;&#x4ef6;&#x4e0d;&#x6ee1;&#x8db3;&#x65f6;&#x7684;&#x7b49;&#x5f85;&#x673a;&#x5236;\n\nAQS &#x7528; state &#x5c5e;&#x6027;&#x6765;&#x8868;&#x793a;&#x8d44;&#x6e90;&#x7684;&#x72b6;&#x6001;&#xff08;&#x5206;&#x72ec;&#x5360;&#x6a21;&#x5f0f;&#x548c;&#x5171;&#x4eab;&#x6a21;&#x5f0f;&#xff0c;&#x72ec;&#x5360;&#x6a21;&#x5f0f;&#x662f;&#x53ea;&#x6709;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x80fd;&#x591f;&#x8bbf;&#x95ee;&#x8d44;&#x6e90;&#xff0c;&#x800c;&#x5171;&#x4eab;&#x6a21;&#x5f0f;&#x53ef;&#x4ee5;&#x5141;&#x8bb8;&#x591a;&#x4e2a;&#x7ebf;&#x7a0b;&#x8bbf;&#x95ee;&#x8d44;&#x6e90;&#xff09;&#xff0c;&#x5b50;&#x7c7b;&#x9700;&#x8981;&#x5b9a;&#x4e49;&#x5982;&#x4f55;&#x7ef4;&#x62a4;&#x8fd9;&#x4e2a;&#x72b6;&#x6001;&#xff0c;&#x63a7;&#x5236;&#x5982;&#x4f55;&#x83b7;&#x53d6;&#x9501;&#x548c;&#x91ca;&#x653e;&#x9501;&#x3002;\n\n*   getState - &#x83b7;&#x53d6; state &#x72b6;&#x6001;\n*   setState - &#x8bbe;&#x7f6e; state &#x72b6;&#x6001;\n*   compareAndSetState - cas &#x673a;&#x5236;&#x8bbe;&#x7f6e; state &#x72b6;&#x6001;\n\nAQS &#x63d0;&#x4f9b;&#x4e86;&#x57fa;&#x4e8e; FIFO &#x7684;&#x7b49;&#x5f85;&#x961f;&#x5217;&#xff0c;&#x7c7b;&#x4f3c;&#x4e8e; Monitor &#x7684; EntryList&#xff0c;&#x6761;&#x4ef6;&#x53d8;&#x91cf;&#x6765;&#x5b9e;&#x73b0;&#x7b49;&#x5f85;&#x3001;&#x5524;&#x9192;&#x673a;&#x5236;&#xff0c;&#x652f;&#x6301;&#x591a;&#x4e2a;&#x6761;&#x4ef6;&#x53d8;&#x91cf;&#xff0c;&#x7c7b;&#x4f3c;&#x4e8e; Monitor &#x7684; WaitSet&#x3002;\n\n&#x5b50;&#x7c7b;&#x4e3b;&#x8981;&#x5b9e;&#x73b0;&#x8fd9;&#x6837;&#x4e00;&#x4e9b;&#x65b9;&#x6cd5;&#xff08;&#x9ed8;&#x8ba4;&#x629b;&#x51fa; UnsupportedOperationException&#xff09;\n\n*   tryAcquire\n*   tryRelease\n*   tryAcquireShared\n*   tryReleaseShared\n*   isHeldExclusively\n\n&#x83b7;&#x53d6;&#x9501;&#x7684;&#x59ff;&#x52bf;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3440,3469"}},{"content":"<pre data-lines=\"3470,3477\"><code class=\"language-java\">\nif (!tryAcquire(arg)) {\n\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3470,3477"}},{"content":"<pre data-lines=\"3478,3479\"><code>&#x91ca;&#x653e;&#x9501;&#x7684;&#x59ff;&#x52bf;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3478,3479"}},{"content":"<pre data-lines=\"3480,3487\"><code class=\"language-java\">\nif (tryRelease(arg)) {\n\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3480,3487"}},{"content":"<pre data-lines=\"3488,3491\"><code>&#x4e3a;&#x4e86;&#x66f4;&#x597d;&#x5730;&#x7406;&#x89e3; AQS &#xff0c;&#x6211;&#x4eec;&#x51c6;&#x5907;&#x81ea;&#x5df1;&#x5b9e;&#x73b0;&#x4e00;&#x4e2a;&#x5b9e;&#x73b0;&#x4e0d;&#x53ef;&#x91cd;&#x5165;&#x9501;&#x3002;\n\n&#x5b9e;&#x73b0;&#x81ea;&#x5b9a;&#x4e49;&#x540c;&#x6b65;&#x5668;&#xff1a;`MySync`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3488,3491"}},{"content":"<pre data-lines=\"3492,3526\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MySync</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">AbstractQueuedSynchronizer</span> {\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">tryAcquire</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> acquires)</span> {\n        <span class=\"hljs-keyword\">if</span> (acquires == <span class=\"hljs-number\">1</span>) {\n            <span class=\"hljs-keyword\">if</span> (compareAndSetState(<span class=\"hljs-number\">0</span>, acquires)) {\n                setExclusiveOwnerThread(Thread.currentThread());\n                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n            }\n        }\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">tryRelease</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> acquires)</span> {\n        <span class=\"hljs-keyword\">if</span> (acquires == <span class=\"hljs-number\">1</span>) {\n            setExclusiveOwnerThread(<span class=\"hljs-literal\">null</span>);\n            setState(<span class=\"hljs-number\">0</span>);\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n        }\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">isHeldExclusively</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> getState() == <span class=\"hljs-number\">1</span>;\n    }\n\n    <span class=\"hljs-keyword\">protected</span> Condition <span class=\"hljs-title function_\">newCondition</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ConditionObject</span>();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3492,3526"}},{"content":"<pre data-lines=\"3527,3528\"><code>&#x81ea;&#x5b9a;&#x4e49;&#x9501;&#xff1a;`MyLock`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3527,3528"}},{"content":"<pre data-lines=\"3529,3565\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyLock</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">Lock</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">MySync</span> <span class=\"hljs-variable\">sync</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySync</span>();\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">lock</span><span class=\"hljs-params\">()</span> {\n        sync.acquire(<span class=\"hljs-number\">1</span>);\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">lockInterruptibly</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        sync.acquireInterruptibly(<span class=\"hljs-number\">1</span>);\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">tryLock</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> sync.tryAcquire(<span class=\"hljs-number\">1</span>);\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">tryLock</span><span class=\"hljs-params\">(<span class=\"hljs-type\">long</span> time, TimeUnit unit)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        <span class=\"hljs-keyword\">return</span> sync.tryAcquireNanos(<span class=\"hljs-number\">1</span>, unit.toNanos(time));\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">unlock</span><span class=\"hljs-params\">()</span> {\n        sync.release(<span class=\"hljs-number\">1</span>);\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> Condition <span class=\"hljs-title function_\">newCondition</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">return</span> sync.newCondition();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3529,3565"}},{"content":"<pre data-lines=\"3566,3567\"><code>&#x6d4b;&#x8bd5;&#x7c7b;&#xff1a;`MyLockTest`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3566,3567"}},{"content":"<pre data-lines=\"3568,3602\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyLockTest</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">MyLock</span> <span class=\"hljs-variable\">lock</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MyLock</span>();\n\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            lock.lock();\n            <span class=\"hljs-keyword\">try</span> {\n                log.info(<span class=\"hljs-string\">&quot;locking...&quot;</span>);\n                Thread.sleep(<span class=\"hljs-number\">2000</span>);\n            } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n                e.printStackTrace();\n            } <span class=\"hljs-keyword\">finally</span> {\n                log.info(<span class=\"hljs-string\">&quot;unlocking...&quot;</span>);\n                lock.unlock();\n            }\n        }, <span class=\"hljs-string\">&quot;t1&quot;</span>).start();\n\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            lock.lock();\n            <span class=\"hljs-keyword\">try</span> {\n                log.info(<span class=\"hljs-string\">&quot;locking...&quot;</span>);\n            } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n                e.printStackTrace();\n            } <span class=\"hljs-keyword\">finally</span> {\n                log.info(<span class=\"hljs-string\">&quot;unlocking...&quot;</span>);\n                lock.unlock();\n            }\n        }, <span class=\"hljs-string\">&quot;t2&quot;</span>).start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3568,3602"}},{"content":"<pre data-lines=\"3603,3610\"><code class=\"language-java\">10:06:17.497 [t1] INFO com.caochenlei.aqs.MyLockTest - locking...\n10:06:19.519 [t1] INFO com.caochenlei.aqs.MyLockTest - unlocking...\n10:06:19.519 [t2] INFO com.caochenlei.aqs.MyLockTest - locking...\n10:06:19.519 [t2] INFO com.caochenlei.aqs.MyLockTest - unlocking...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3603,3610"}}],"payload":{"tag":"h3","lines":"3436,3437"}},{"content":"5.2.2&#x3001;ReentrantLock &#x539f;&#x7406;","children":[{"content":"5.2.2.1&#x3001;&#x975e;&#x516c;&#x5e73;&#x9501;&#x539f;&#x7406;","children":[{"content":"<pre data-lines=\"3615,3616\"><code>&#x5148;&#x4ece;&#x6784;&#x9020;&#x5668;&#x5f00;&#x59cb;&#x770b;&#xff0c;&#x9ed8;&#x8ba4;&#x4e3a;&#x975e;&#x516c;&#x5e73;&#x9501;&#x5b9e;&#x73b0;&#xff0c;`NonfairSync` &#x7ee7;&#x627f;&#x81ea; `Sync` &#x800c; `Sync` &#x7ee7;&#x627f;&#x81ea; `AQS`&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3615,3616"}},{"content":"<pre data-lines=\"3617,3623\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">ReentrantLock</span><span class=\"hljs-params\">()</span> {\n    sync = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NonfairSync</span>();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3617,3623"}},{"content":"<pre data-lines=\"3624,3625\"><code>&#x6211;&#x4eec;&#x63a5;&#x4e0b;&#x6765;&#x6765;&#x770b;&#x4e00;&#x4e0b;&#x975e;&#x516c;&#x5e73;&#x9501;&#x7684;&#x6e90;&#x7801;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3624,3625"}},{"content":"<pre data-lines=\"3626,3643\"><code class=\"language-java\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">NonfairSync</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">Sync</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">serialVersionUID</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">7316153563782823691L</span>;\n\n    <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">lock</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">if</span> (compareAndSetState(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>))\n            setExclusiveOwnerThread(Thread.currentThread());\n        <span class=\"hljs-keyword\">else</span>\n            acquire(<span class=\"hljs-number\">1</span>);\n    }\n\n    <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">tryAcquire</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> acquires)</span> {\n        <span class=\"hljs-keyword\">return</span> nonfairTryAcquire(acquires);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3626,3643"}},{"content":"<pre data-lines=\"3644,3645\"><code>&#x5f53;&#x52a0;&#x9501;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x5982;&#x679c;&#x6ca1;&#x6709;&#x6ca1;&#x6709;&#x7ade;&#x4e89;&#x65f6;&#xff0c;&#x76f4;&#x63a5;&#x5c06;`state`&#x72b6;&#x6001;&#x4fee;&#x6539;&#x4e3a;1&#xff0c;&#x7136;&#x540e;&#x5c06;&#x7ebf;&#x7a0b;&#x62e5;&#x6709;&#x8005;&#x8bbe;&#x7f6e;&#x4e3a;&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3644,3645"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/2c7d7916f8ef9997a4fef30294654cca.png\" alt>","children":[],"payload":{"tag":"img","lines":"3646,3647"}},{"content":"<pre data-lines=\"3648,3649\"><code>&#x5f53;&#x6709;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x51fa;&#x73b0;&#x7ade;&#x4e89;&#x65f6;&#xff0c;&#x6267;&#x884c;`compareAndSetState(0, 1)`&#x5c06;&#x4f1a;&#x5931;&#x8d25;&#xff0c;&#x5219;&#x4f1a;&#x6267;&#x884c;`acquire(1)`&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3648,3649"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/ecb37a4bb3c94d8e73f967bf3266c23c.png\" alt>","children":[],"payload":{"tag":"img","lines":"3650,3651"}},{"content":"<pre data-lines=\"3652,3660\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">acquire</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> arg)</span> {\n    <span class=\"hljs-keyword\">if</span> (!tryAcquire(arg) &amp;&amp;\n        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n        selfInterrupt();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3652,3660"}},{"content":"<pre data-lines=\"3661,3662\"><code>&#x6267;&#x884c;`acquire(1)`&#xff0c;&#x9996;&#x5148;&#x4f1a;&#x5c1d;&#x8bd5;&#x52a0;&#x9501;&#xff0c;`tryAcquire(arg)`&#x6b64;&#x65f6;&#x80af;&#x5b9a;&#x4e3a;false&#xff0c;&#x4e0d;&#x80fd;&#x52a0;&#x9501;&#xff0c;&#x53d6;&#x53cd;&#x540e;&#x4e3a;true&#xff0c;&#x63a5;&#x4e0b;&#x6765;&#xff0c;&#x6211;&#x4eec;&#x5c06;&#x4f1a;&#x6267;&#x884c;&#x7b2c;&#x4e8c;&#x4e2a;&#x5224;&#x65ad;&#x6761;&#x4ef6;&#xff0c;`acquireQueued(addWaiter(Node.EXCLUSIVE), arg))`&#xff0c;&#x5148;&#x6267;&#x884c;`addWaiter(Node.EXCLUSIVE)`&#xff0c;&#x63a5;&#x4e0b;&#x6765;&#x8fdb;&#x5165;`addWaiter`&#x903b;&#x8f91;&#xff0c;&#x6784;&#x9020;`Node`&#x961f;&#x5217;&#x3002;&#x56fe;&#x4e2d;&#x9ec4;&#x8272;&#x4e09;&#x89d2;&#x8868;&#x793a;&#x8be5;`Node`&#x7684;`waitStatus`&#x72b6;&#x6001;&#xff0c;&#x5176;&#x4e2d;`0`&#x4e3a;&#x9ed8;&#x8ba4;&#x6b63;&#x5e38;&#x72b6;&#x6001;&#x3002;Node &#x7684;&#x521b;&#x5efa;&#x662f;&#x61d2;&#x60f0;&#x7684;&#xff0c;&#x5176;&#x4e2d;&#x7b2c;&#x4e00;&#x4e2a;`Node`&#x79f0;&#x4e3a;`Dummy`&#xff08;&#x54d1;&#x5143; &#x3001;&#x54e8;&#x5175;&#x3001;&#x865a;&#x62df;&#x5934;&#x8282;&#x70b9;&#xff09;&#xff0c;&#x7528;&#x6765;&#x5360;&#x4f4d;&#xff0c;&#x5e76;&#x4e0d;&#x5173;&#x8054;&#x7ebf;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3661,3662"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/23696db7dd8274ab2b5854e8a16048e0.png\" alt>","children":[],"payload":{"tag":"img","lines":"3663,3664"}},{"content":"<pre data-lines=\"3665,3689\"><code class=\"language-java\"><span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">acquireQueued</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">final</span> Node node, <span class=\"hljs-type\">int</span> arg)</span> {\n    <span class=\"hljs-type\">boolean</span> <span class=\"hljs-variable\">failed</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">true</span>;\n    <span class=\"hljs-keyword\">try</span> {\n        <span class=\"hljs-type\">boolean</span> <span class=\"hljs-variable\">interrupted</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">false</span>;\n        <span class=\"hljs-keyword\">for</span> (;;) {\n            <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">Node</span> <span class=\"hljs-variable\">p</span> <span class=\"hljs-operator\">=</span> node.predecessor();\n            <span class=\"hljs-keyword\">if</span> (p == head &amp;&amp; tryAcquire(arg)) {\n                setHead(node);\n                p.next = <span class=\"hljs-literal\">null</span>; \n                failed = <span class=\"hljs-literal\">false</span>;\n                <span class=\"hljs-keyword\">return</span> interrupted;\n            }\n            <span class=\"hljs-keyword\">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;\n                parkAndCheckInterrupt())\n                interrupted = <span class=\"hljs-literal\">true</span>;\n        }\n    } <span class=\"hljs-keyword\">finally</span> {\n        <span class=\"hljs-keyword\">if</span> (failed)\n            cancelAcquire(node);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3665,3689"}},{"content":"<pre data-lines=\"3690,3710\"><code>&#x5f53;&#x524d;&#x7ebf;&#x7a0b;&#x8fdb;&#x5165;`acquireQueued`&#x903b;&#x8f91;&#xff1a;\n\n1.  `acquireQueued` &#x4f1a;&#x5728;&#x4e00;&#x4e2a;&#x6b7b;&#x5faa;&#x73af;&#x4e2d;&#x4e0d;&#x65ad;&#x5c1d;&#x8bd5;&#x83b7;&#x5f97;&#x9501;&#xff0c;&#x5931;&#x8d25;&#x540e;&#x8fdb;&#x5165; `park` &#x963b;&#x585e;&#x3002;\n    \n2.  &#x5982;&#x679c;&#x81ea;&#x5df1;&#x662f;&#x7d27;&#x90bb;&#x7740; `head`&#xff08;&#x6392;&#x7b2c;&#x4e8c;&#x4f4d;&#xff09;&#xff0c;&#x90a3;&#x4e48;&#x518d;&#x6b21; `tryAcquire` &#x5c1d;&#x8bd5;&#x83b7;&#x53d6;&#x9501;&#xff0c;&#x5f53;&#x7136;&#x8fd9;&#x65f6; `state` &#x4ecd;&#x4e3a; `1`&#xff0c;&#x5931;&#x8d25;&#x3002;\n    \n3.  &#x8fdb;&#x5165; `shouldParkAfterFailedAcquire` &#x903b;&#x8f91;&#xff0c;&#x5c06;&#x524d;&#x9a71; `node`&#xff0c;&#x5373; `head` &#x7684; `waitStatus` &#x6539;&#x4e3a; `-1`&#xff0c;&#x8fd9;&#x6b21;&#x8fd4;&#x56de; `false`&#x3002;\n    \n    ![](https://img-blog.csdnimg.cn/img_convert/7defad8e1761bb4c3333aa5622eef37b.png)\n    \n4.  `shouldParkAfterFailedAcquire` &#x6267;&#x884c;&#x5b8c;&#x6bd5;&#x56de;&#x5230; `acquireQueued` &#xff0c;&#x518d;&#x6b21; `tryAcquire` &#x5c1d;&#x8bd5;&#x83b7;&#x53d6;&#x9501;&#xff0c;&#x8fd9;&#x65f6; `state` &#x4ecd;&#x4e3a; 1&#xff0c;&#x5931;&#x8d25;&#x3002;\n    \n5.  &#x5f53;&#x518d;&#x6b21;&#x8fdb;&#x5165; `shouldParkAfterFailedAcquire` &#x65f6;&#xff0c;&#x8fd9;&#x65f6;&#x56e0;&#x4e3a;&#x5176;&#x524d;&#x9a71; `node` &#x7684; `waitStatus` &#x5df2;&#x7ecf;&#x662f; `-1`&#xff0c;&#x8fd9;&#x6b21;&#x8fd4;&#x56de; `true`&#x3002;\n    \n6.  &#x8fdb;&#x5165; `parkAndCheckInterrupt`&#xff0c; `Thread-1` `park`&#xff08;&#x7070;&#x8272;&#x8868;&#x793a;&#xff09;&#x3002;\n\n![](https://img-blog.csdnimg.cn/img_convert/4f37aca43fbe140b19368ed26fc8f771.png)\n\n\n&#x518d;&#x6b21;&#x6709;&#x591a;&#x4e2a;&#x7ebf;&#x7a0b;&#x7ecf;&#x5386;&#x4e0a;&#x8ff0;&#x8fc7;&#x7a0b;&#x7ade;&#x4e89;&#x5931;&#x8d25;&#xff0c;&#x53d8;&#x6210;&#x8fd9;&#x4e2a;&#x6837;&#x5b50;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3690,3710"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/3e873704e664be29e951f80b49d7cc76.png\" alt>","children":[],"payload":{"tag":"img","lines":"3711,3712"}},{"content":"<pre data-lines=\"3713,3728\"><code class=\"language-java\"><span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">tryRelease</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> releases)</span> {\n    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">c</span> <span class=\"hljs-operator\">=</span> getState() - releases;\n    <span class=\"hljs-keyword\">if</span> (Thread.currentThread() != getExclusiveOwnerThread())\n        <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">IllegalMonitorStateException</span>();\n    <span class=\"hljs-type\">boolean</span> <span class=\"hljs-variable\">free</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">false</span>;\n    <span class=\"hljs-keyword\">if</span> (c == <span class=\"hljs-number\">0</span>) {\n        free = <span class=\"hljs-literal\">true</span>;\n        setExclusiveOwnerThread(<span class=\"hljs-literal\">null</span>);\n    }\n    setState(c);\n    <span class=\"hljs-keyword\">return</span> free;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3713,3728"}},{"content":"<pre data-lines=\"3729,3733\"><code>`Thread-0` &#x91ca;&#x653e;&#x9501;&#xff0c;&#x8fdb;&#x5165; `tryRelease` &#x6d41;&#x7a0b;&#xff0c;&#x5982;&#x679c;&#x6210;&#x529f;&#x3002;\n\n*   &#x8bbe;&#x7f6e; `exclusiveOwnerThread` &#x4e3a; `null`\n*   `state = 0`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3729,3733"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/8aadd6e6478f9d13d2465ca4c1ae0ac4.png\" alt>","children":[],"payload":{"tag":"img","lines":"3734,3735"}},{"content":"<pre data-lines=\"3736,3741\"><code>&#x5f53;&#x524d;&#x961f;&#x5217;&#x4e0d;&#x4e3a; `null`&#xff0c;&#x5e76;&#x4e14; `head` &#x7684; `waitStatus = -1`&#xff0c;&#x8fdb;&#x5165; `unparkSuccessor` &#x6d41;&#x7a0b;&#x3002;\n\n&#x627e;&#x5230;&#x961f;&#x5217;&#x4e2d;&#x79bb; `head` &#x6700;&#x8fd1;&#x7684;&#x4e00;&#x4e2a; `Node`&#xff08;&#x6ca1;&#x53d6;&#x6d88;&#x7684;&#xff09;&#xff0c;`unpark` &#x6062;&#x590d;&#x5176;&#x8fd0;&#x884c;&#xff0c;&#x672c;&#x4f8b;&#x4e2d;&#x5373;&#x4e3a; `Thread-1`&#x3002;\n\n&#x56de;&#x5230; `Thread-1` &#x7684; `acquireQueued` &#x6d41;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3736,3741"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/c8045e3748d7da84ed7fdac0d770df81.png\" alt>","children":[],"payload":{"tag":"img","lines":"3742,3743"}},{"content":"<pre data-lines=\"3744,3751\"><code>&#x5982;&#x679c;&#x52a0;&#x9501;&#x6210;&#x529f;&#xff08;&#x6ca1;&#x6709;&#x7ade;&#x4e89;&#xff09;&#xff0c;&#x4f1a;&#x8bbe;&#x7f6e;\n\n*   `exclusiveOwnerThread` &#x4e3a; `Thread-1`&#xff0c;`state = 1`\n*   `head` &#x6307;&#x5411;&#x521a;&#x521a; `Thread-1` &#x6240;&#x5728;&#x7684; `Node`&#xff0c;&#x8be5; `Node` &#x6e05;&#x7a7a; `Thread`\n*   &#x539f;&#x672c;&#x7684; `head` &#x56e0;&#x4e3a;&#x4ece;&#x94fe;&#x8868;&#x65ad;&#x5f00;&#xff0c;&#x800c;&#x53ef;&#x88ab;&#x5783;&#x573e;&#x56de;&#x6536;\n\n&#x5982;&#x679c;&#x8fd9;&#x65f6;&#x5019;&#x6709;&#x5176;&#x5b83;&#x7ebf;&#x7a0b;&#x6765;&#x7ade;&#x4e89;&#xff08;&#x975e;&#x516c;&#x5e73;&#x7684;&#x4f53;&#x73b0;&#xff09;&#xff0c;&#x4f8b;&#x5982;&#x8fd9;&#x65f6;&#x6709; `Thread-4` &#x6765;&#x4e86;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3744,3751"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/9622210c5c0624e7d36e2605b4b2564b.png\" alt>","children":[],"payload":{"tag":"img","lines":"3752,3753"}},{"content":"<pre data-lines=\"3754,3758\"><code>&#x5982;&#x679c;&#x4e0d;&#x5de7;&#x53c8;&#x88ab; `Thread-4` &#x5360;&#x4e86;&#x5148;\n\n*   `Thread-4` &#x88ab;&#x8bbe;&#x7f6e;&#x4e3a; `exclusiveOwnerThread`&#xff0c;`state = 1`\n*   `Thread-1` &#x518d;&#x6b21;&#x8fdb;&#x5165; `acquireQueued` &#x6d41;&#x7a0b;&#xff0c;&#x83b7;&#x53d6;&#x9501;&#x5931;&#x8d25;&#xff0c;&#x91cd;&#x65b0;&#x8fdb;&#x5165; `park` &#x963b;&#x585e;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3754,3758"}}],"payload":{"tag":"h4","lines":"3613,3614"}},{"content":"5.2.2.3&#x3001;&#x53ef;&#x91cd;&#x5165;&#x539f;&#x7406;","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/5fbc40388645c0be9e093f2c1a85342b.png\" alt>","children":[],"payload":{"tag":"img","lines":"3761,3762"}}],"payload":{"tag":"h4","lines":"3759,3760"}},{"content":"5.2.2.4&#x3001;&#x53ef;&#x6253;&#x65ad;&#x539f;&#x7406;","children":[{"content":"<pre data-lines=\"3765,3766\"><code>**&#x4e0d;&#x53ef;&#x6253;&#x65ad;&#x6a21;&#x5f0f;** &#xff1a;&#x5728;&#x6b64;&#x6a21;&#x5f0f;&#x4e0b;&#xff0c;&#x5373;&#x4f7f;&#x5b83;&#x88ab;&#x6253;&#x65ad;&#xff0c;&#x4ecd;&#x4f1a;&#x9a7b;&#x7559;&#x5728; AQS &#x961f;&#x5217;&#x4e2d;&#xff0c;&#x4e00;&#x76f4;&#x8981;&#x7b49;&#x5230;&#x83b7;&#x5f97;&#x9501;&#x540e;&#x65b9;&#x80fd;&#x5f97;&#x77e5;&#x81ea;&#x5df1;&#x88ab;&#x6253;&#x65ad;&#x4e86;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3765,3766"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b728ad9b7b4c0471bdd43f67d7261d17.png\" alt>","children":[],"payload":{"tag":"img","lines":"3767,3768"}},{"content":"<pre data-lines=\"3769,3770\"><code>**&#x53ef;&#x6253;&#x65ad;&#x6a21;&#x5f0f;**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3769,3770"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/5d41fb2d6da23216b48aeb24818ef2a0.png\" alt>","children":[],"payload":{"tag":"img","lines":"3771,3772"}}],"payload":{"tag":"h4","lines":"3763,3764"}},{"content":"5.2.2.5&#x3001;&#x516c;&#x5e73;&#x9501;&#x539f;&#x7406;","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1eb9d0159c813bc23522c8c81b4c98bf.png\" alt>","children":[],"payload":{"tag":"img","lines":"3775,3776"}}],"payload":{"tag":"h4","lines":"3773,3774"}},{"content":"5.2.2.6&#x3001;&#x6761;&#x4ef6;&#x53d8;&#x91cf;&#x539f;&#x7406;","children":[{"content":"<pre data-lines=\"3779,3786\"><code>&#x6bcf;&#x4e2a;&#x6761;&#x4ef6;&#x53d8;&#x91cf;&#x5176;&#x5b9e;&#x5c31;&#x5bf9;&#x5e94;&#x7740;&#x4e00;&#x4e2a;&#x7b49;&#x5f85;&#x961f;&#x5217;&#xff0c;&#x5176;&#x5b9e;&#x73b0;&#x7c7b;&#x662f; `ConditionObject`&#x3002;\n\n**await &#x6d41;&#x7a0b;**\n\n&#x5f00;&#x59cb; `Thread-0` &#x6301;&#x6709;&#x9501;&#xff0c;&#x8c03;&#x7528; `await`&#xff0c;&#x8fdb;&#x5165; `ConditionObject` &#x7684; `addConditionWaiter` &#x6d41;&#x7a0b;&#x3002;\n\n&#x521b;&#x5efa;&#x65b0;&#x7684; `Node` &#x72b6;&#x6001;&#x4e3a; `-2`&#xff08;`Node.CONDITION`&#xff09;&#xff0c;&#x5173;&#x8054; `Thread-0`&#xff0c;&#x52a0;&#x5165;&#x7b49;&#x5f85;&#x961f;&#x5217;&#x5c3e;&#x90e8;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3779,3786"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1904297ce56f71940d44360dc2bd0f25.png\" alt>","children":[],"payload":{"tag":"img","lines":"3787,3788"}},{"content":"<pre data-lines=\"3789,3790\"><code>&#x63a5;&#x4e0b;&#x6765;&#x8fdb;&#x5165; `AQS` &#x7684; `fullyRelease` &#x6d41;&#x7a0b;&#xff0c;&#x91ca;&#x653e;&#x540c;&#x6b65;&#x5668;&#x4e0a;&#x7684;&#x9501;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3789,3790"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/592bac49810e41ce48c1a6d4eb63585b.png\" alt>","children":[],"payload":{"tag":"img","lines":"3791,3792"}},{"content":"<pre data-lines=\"3793,3794\"><code>`unpark` AQS &#x961f;&#x5217;&#x4e2d;&#x7684;&#x4e0b;&#x4e00;&#x4e2a;&#x8282;&#x70b9;&#xff0c;&#x7ade;&#x4e89;&#x9501;&#xff0c;&#x5047;&#x8bbe;&#x6ca1;&#x6709;&#x5176;&#x4ed6;&#x7ade;&#x4e89;&#x7ebf;&#x7a0b;&#xff0c;&#x90a3;&#x4e48; `Thread-1` &#x7ade;&#x4e89;&#x6210;&#x529f;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3793,3794"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/649e96b3dcdd12534dd516020246a719.png\" alt>","children":[],"payload":{"tag":"img","lines":"3795,3796"}},{"content":"<pre data-lines=\"3797,3798\"><code>`park` &#x963b;&#x585e; `Thread-0`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3797,3798"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/9fb5a2c9aa55b1d66ef739793624c556.png\" alt>","children":[],"payload":{"tag":"img","lines":"3799,3800"}},{"content":"<pre data-lines=\"3801,3804\"><code>**signal &#x6d41;&#x7a0b;**\n\n&#x5047;&#x8bbe; `Thread-1` &#x8981;&#x6765;&#x5524;&#x9192; `Thread-0`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3801,3804"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/69d30de5b44c3a6ccb05ed5c8ebea363.png\" alt>","children":[],"payload":{"tag":"img","lines":"3805,3806"}},{"content":"<pre data-lines=\"3807,3808\"><code>&#x8fdb;&#x5165; `ConditionObject` &#x7684; `doSignal` &#x6d41;&#x7a0b;&#xff0c;&#x53d6;&#x5f97;&#x7b49;&#x5f85;&#x961f;&#x5217;&#x4e2d;&#x7b2c;&#x4e00;&#x4e2a; `Node`&#xff0c;&#x5373; `Thread-0` &#x6240;&#x5728; `Node`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3807,3808"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/3e92168bc2893cbfdb35420086add44a.png\" alt>","children":[],"payload":{"tag":"img","lines":"3809,3810"}},{"content":"<pre data-lines=\"3811,3812\"><code>&#x6267;&#x884c; `transferForSignal` &#x6d41;&#x7a0b;&#xff0c;&#x5c06;&#x8be5; `Node` &#x52a0;&#x5165; `AQS` &#x961f;&#x5217;&#x5c3e;&#x90e8;&#xff0c;&#x5c06; `Thread-0` &#x7684; `waitStatus` &#x6539;&#x4e3a; `0`&#xff0c;`Thread-3` &#x7684; `waitStatus` &#x6539;&#x4e3a; `-1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3811,3812"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/62417e0248d6a1e7929389779a145c3a.png\" alt>","children":[],"payload":{"tag":"img","lines":"3813,3814"}},{"content":"<pre data-lines=\"3815,3816\"><code>`Thread-1` &#x91ca;&#x653e;&#x9501;&#xff0c;&#x8fdb;&#x5165; `unlock` &#x6d41;&#x7a0b;&#xff0c;&#x7565;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3815,3816"}}],"payload":{"tag":"h4","lines":"3777,3778"}}],"payload":{"tag":"h3","lines":"3611,3612"}},{"content":"5.2.3&#x3001;ReentrantReadWriteLock &#x4ecb;&#x7ecd;","children":[{"content":"<pre data-lines=\"3819,3822\"><code>&#x5f53;&#x8bfb;&#x64cd;&#x4f5c;&#x8fdc;&#x8fdc;&#x9ad8;&#x4e8e;&#x5199;&#x64cd;&#x4f5c;&#x65f6;&#xff0c;&#x8fd9;&#x65f6;&#x5019;&#x4f7f;&#x7528; `&#x8bfb;&#x5199;&#x9501;` &#x8ba9; `&#x8bfb;-&#x8bfb;` &#x53ef;&#x4ee5;&#x5e76;&#x53d1;&#xff0c;&#x63d0;&#x9ad8;&#x6027;&#x80fd;&#x3002;\n\n&#x52a0;&#x89e3;&#x8bfb;&#x9501;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3819,3822"}},{"content":"<pre data-lines=\"3823,3828\"><code class=\"language-java\">rw.readLock().lock();\nrw.readLock().unlock();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3823,3828"}},{"content":"<pre data-lines=\"3829,3830\"><code>&#x52a0;&#x89e3;&#x5199;&#x9501;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3829,3830"}},{"content":"<pre data-lines=\"3831,3836\"><code class=\"language-java\">rw.writeLock().lock();\nrw.writeLock().unlock();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3831,3836"}},{"content":"<pre data-lines=\"3837,3838\"><code>&#x63d0;&#x4f9b;&#x4e00;&#x4e2a; `&#x6570;&#x636e;&#x5bb9;&#x5668;&#x7c7b;` &#x5185;&#x90e8;&#x5206;&#x522b;&#x4f7f;&#x7528;&#x8bfb;&#x9501;&#x4fdd;&#x62a4;&#x6570;&#x636e;&#x7684; `read()` &#x65b9;&#x6cd5;&#xff0c;&#x5199;&#x9501;&#x4fdd;&#x62a4;&#x6570;&#x636e;&#x7684; `write()` &#x65b9;&#x6cd5;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3837,3838"}},{"content":"<pre data-lines=\"3839,3873\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DataContainer</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> data;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">ReentrantReadWriteLock</span> <span class=\"hljs-variable\">rw</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ReentrantReadWriteLock</span>();\n\n    <span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title function_\">read</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        log.info(<span class=\"hljs-string\">&quot;&#x83b7;&#x53d6;&#x8bfb;&#x9501;...&quot;</span>);\n        rw.readLock().lock();\n        <span class=\"hljs-keyword\">try</span> {\n            log.info(<span class=\"hljs-string\">&quot;&#x8bfb;&#x53d6;&quot;</span>);\n            Thread.sleep(<span class=\"hljs-number\">2000</span>);\n            <span class=\"hljs-keyword\">return</span> data;\n        } <span class=\"hljs-keyword\">finally</span> {\n            log.info(<span class=\"hljs-string\">&quot;&#x91ca;&#x653e;&#x8bfb;&#x9501;...&quot;</span>);\n            rw.readLock().unlock();\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">write</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> data)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        log.info(<span class=\"hljs-string\">&quot;&#x83b7;&#x53d6;&#x5199;&#x9501;...&quot;</span>);\n        rw.writeLock().lock();\n        <span class=\"hljs-keyword\">try</span> {\n            log.info(<span class=\"hljs-string\">&quot;&#x5199;&#x5165;&quot;</span>);\n            <span class=\"hljs-built_in\">this</span>.data = data;\n            Thread.sleep(<span class=\"hljs-number\">2000</span>);\n        } <span class=\"hljs-keyword\">finally</span> {\n            log.info(<span class=\"hljs-string\">&quot;&#x91ca;&#x653e;&#x5199;&#x9501;...&quot;</span>);\n            rw.writeLock().unlock();\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3839,3873"}},{"content":"<pre data-lines=\"3874,3875\"><code>&#x6d4b;&#x8bd5;`&#x8bfb;-&#x8bfb;`&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3874,3875"}},{"content":"<pre data-lines=\"3876,3898\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DataContainerTest</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">DataContainer</span> <span class=\"hljs-variable\">dataContainer</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DataContainer</span>();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                dataContainer.read();\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, <span class=\"hljs-string\">&quot;t1&quot;</span>).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                dataContainer.read();\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, <span class=\"hljs-string\">&quot;t2&quot;</span>).start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3876,3898"}},{"content":"<pre data-lines=\"3899,3908\"><code class=\"language-java\">18:36:55.416 [t1] INFO com.caochenlei.rrw.DataContainer - &#x83b7;&#x53d6;&#x8bfb;&#x9501;...\n18:36:55.425 [t1] INFO com.caochenlei.rrw.DataContainer - &#x8bfb;&#x53d6;\n18:36:55.416 [t2] INFO com.caochenlei.rrw.DataContainer - &#x83b7;&#x53d6;&#x8bfb;&#x9501;...\n18:36:55.427 [t2] INFO com.caochenlei.rrw.DataContainer - &#x8bfb;&#x53d6;\n18:36:57.426 [t1] INFO com.caochenlei.rrw.DataContainer - &#x91ca;&#x653e;&#x8bfb;&#x9501;...\n18:36:57.448 [t2] INFO com.caochenlei.rrw.DataContainer - &#x91ca;&#x653e;&#x8bfb;&#x9501;...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3899,3908"}},{"content":"<pre data-lines=\"3909,3910\"><code>&#x6d4b;&#x8bd5;`&#x8bfb;-&#x5199;`&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3909,3910"}},{"content":"<pre data-lines=\"3911,3933\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DataContainerTest</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">DataContainer</span> <span class=\"hljs-variable\">dataContainer</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DataContainer</span>();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                dataContainer.read();\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, <span class=\"hljs-string\">&quot;t1&quot;</span>).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                dataContainer.write(<span class=\"hljs-number\">100</span>);\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, <span class=\"hljs-string\">&quot;t2&quot;</span>).start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3911,3933"}},{"content":"<pre data-lines=\"3934,3943\"><code class=\"language-java\">18:33:51.731 [t2] INFO com.caochenlei.rrw.DataContainer - &#x83b7;&#x53d6;&#x5199;&#x9501;...\n18:33:51.731 [t1] INFO com.caochenlei.rrw.DataContainer - &#x83b7;&#x53d6;&#x8bfb;&#x9501;...\n18:33:51.738 [t2] INFO com.caochenlei.rrw.DataContainer - &#x5199;&#x5165;\n18:33:53.747 [t2] INFO com.caochenlei.rrw.DataContainer - &#x91ca;&#x653e;&#x5199;&#x9501;...\n18:33:53.748 [t1] INFO com.caochenlei.rrw.DataContainer - &#x8bfb;&#x53d6;\n18:33:55.759 [t1] INFO com.caochenlei.rrw.DataContainer - &#x91ca;&#x653e;&#x8bfb;&#x9501;...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3934,3943"}},{"content":"<pre data-lines=\"3944,3945\"><code>&#x6d4b;&#x8bd5;`&#x5199;-&#x5199;`&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3944,3945"}},{"content":"<pre data-lines=\"3946,3968\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DataContainerTest</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">DataContainer</span> <span class=\"hljs-variable\">dataContainer</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DataContainer</span>();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                dataContainer.write(<span class=\"hljs-number\">100</span>);\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, <span class=\"hljs-string\">&quot;t1&quot;</span>).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                dataContainer.write(<span class=\"hljs-number\">100</span>);\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, <span class=\"hljs-string\">&quot;t2&quot;</span>).start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3946,3968"}},{"content":"<pre data-lines=\"3969,3978\"><code class=\"language-java\">18:35:02.095 [t2] INFO com.caochenlei.rrw.DataContainer - &#x83b7;&#x53d6;&#x5199;&#x9501;...\n18:35:02.099 [t1] INFO com.caochenlei.rrw.DataContainer - &#x83b7;&#x53d6;&#x5199;&#x9501;...\n18:35:02.103 [t1] INFO com.caochenlei.rrw.DataContainer - &#x5199;&#x5165;\n18:35:04.115 [t1] INFO com.caochenlei.rrw.DataContainer - &#x91ca;&#x653e;&#x5199;&#x9501;...\n18:35:04.115 [t2] INFO com.caochenlei.rrw.DataContainer - &#x5199;&#x5165;\n18:35:06.131 [t2] INFO com.caochenlei.rrw.DataContainer - &#x91ca;&#x653e;&#x5199;&#x9501;...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3969,3978"}}],"payload":{"tag":"h3","lines":"3817,3818"}},{"content":"5.2.4&#x3001;StampedLock &#x4ecb;&#x7ecd;","children":[{"content":"<pre data-lines=\"3981,3984\"><code>&#x8be5;&#x7c7b;&#x81ea; JDK 8 &#x52a0;&#x5165;&#xff0c;&#x662f;&#x4e3a;&#x4e86;&#x8fdb;&#x4e00;&#x6b65;&#x4f18;&#x5316;&#x8bfb;&#x6027;&#x80fd;&#xff0c;&#x5b83;&#x7684;&#x7279;&#x70b9;&#x662f;&#x5728;&#x4f7f;&#x7528;&#x8bfb;&#x9501;&#x3001;&#x5199;&#x9501;&#x65f6;&#x90fd;&#x5fc5;&#x987b;&#x914d;&#x5408;&#x3010;&#x6233;&#x3011;&#x4f7f;&#x7528;&#x3002;\n\n&#x52a0;&#x89e3;&#x8bfb;&#x9501;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3981,3984"}},{"content":"<pre data-lines=\"3985,3990\"><code class=\"language-java\"><span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">stamp</span> <span class=\"hljs-operator\">=</span> lock.readLock();\nlock.unlockRead(stamp);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3985,3990"}},{"content":"<pre data-lines=\"3991,3992\"><code>&#x52a0;&#x89e3;&#x5199;&#x9501;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3991,3992"}},{"content":"<pre data-lines=\"3993,3998\"><code class=\"language-java\"><span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">stamp</span> <span class=\"hljs-operator\">=</span> lock.writeLock();\nlock.unlockWrite(stamp);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3993,3998"}},{"content":"<pre data-lines=\"3999,4000\"><code>&#x4e50;&#x89c2;&#x8bfb;&#xff0c;StampedLock &#x652f;&#x6301; tryOptimisticRead() &#x65b9;&#x6cd5;&#xff08;&#x4e50;&#x89c2;&#x8bfb;&#xff09;&#xff0c;&#x8bfb;&#x53d6;&#x5b8c;&#x6bd5;&#x540e;&#x9700;&#x8981;&#x505a;&#x4e00;&#x6b21; **&#x6233;&#x6821;&#x9a8c;** &#x5982;&#x679c;&#x6821;&#x9a8c;&#x901a;&#x8fc7;&#xff0c;&#x8868;&#x793a;&#x8fd9;&#x671f;&#x95f4;&#x786e;&#x5b9e;&#x6ca1;&#x6709;&#x5199;&#x64cd;&#x4f5c;&#xff0c;&#x6570;&#x636e;&#x53ef;&#x4ee5;&#x5b89;&#x5168;&#x4f7f;&#x7528;&#xff0c;&#x5982;&#x679c;&#x6821;&#x9a8c;&#x6ca1;&#x901a;&#x8fc7;&#xff0c;&#x9700;&#x8981;&#x91cd;&#x65b0;&#x83b7;&#x53d6;&#x8bfb;&#x9501;&#xff0c;&#x4fdd;&#x8bc1;&#x6570;&#x636e;&#x5b89;&#x5168;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"3999,4000"}},{"content":"<pre data-lines=\"4001,4009\"><code class=\"language-java\"><span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">stamp</span> <span class=\"hljs-operator\">=</span> lock.tryOptimisticRead();\n\n<span class=\"hljs-keyword\">if</span>(!lock.validate(stamp)) {\n    \n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4001,4009"}},{"content":"<pre data-lines=\"4010,4011\"><code>&#x63d0;&#x4f9b;&#x4e00;&#x4e2a; `&#x6570;&#x636e;&#x5bb9;&#x5668;&#x7c7b;` &#x5185;&#x90e8;&#x5206;&#x522b;&#x4f7f;&#x7528;&#x8bfb;&#x9501;&#x4fdd;&#x62a4;&#x6570;&#x636e;&#x7684; `read()` &#x65b9;&#x6cd5;&#xff0c;&#x5199;&#x9501;&#x4fdd;&#x62a4;&#x6570;&#x636e;&#x7684; `write()` &#x65b9;&#x6cd5;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4010,4011"}},{"content":"<pre data-lines=\"4012,4055\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DataContainerStamped</span> {\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-type\">int</span> data;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">StampedLock</span> <span class=\"hljs-variable\">lock</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StampedLock</span>();\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">read</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        \n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">stamp</span> <span class=\"hljs-operator\">=</span> lock.tryOptimisticRead();\n        log.info(<span class=\"hljs-string\">&quot;optimistic read locking...{}&quot;</span>, stamp);\n        Thread.sleep(<span class=\"hljs-number\">2000</span>);\n        <span class=\"hljs-keyword\">if</span> (lock.validate(stamp)) {\n            log.info(<span class=\"hljs-string\">&quot;read finish...{}, data:{}&quot;</span>, stamp, data);\n            <span class=\"hljs-keyword\">return</span> data;\n        }\n        \n        log.info(<span class=\"hljs-string\">&quot;updating to read lock... {}&quot;</span>, stamp);\n        <span class=\"hljs-keyword\">try</span> {\n            stamp = lock.readLock();\n            log.info(<span class=\"hljs-string\">&quot;read lock {}&quot;</span>, stamp);\n            Thread.sleep(<span class=\"hljs-number\">2000</span>);\n            log.info(<span class=\"hljs-string\">&quot;read finish...{}, data:{}&quot;</span>, stamp, data);\n            <span class=\"hljs-keyword\">return</span> data;\n        } <span class=\"hljs-keyword\">finally</span> {\n            log.info(<span class=\"hljs-string\">&quot;read unlock {}&quot;</span>, stamp);\n            lock.unlockRead(stamp);\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">write</span><span class=\"hljs-params\">(<span class=\"hljs-type\">int</span> data)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">stamp</span> <span class=\"hljs-operator\">=</span> lock.writeLock();\n        log.info(<span class=\"hljs-string\">&quot;write lock {}&quot;</span>, stamp);\n        <span class=\"hljs-keyword\">try</span> {\n            Thread.sleep(<span class=\"hljs-number\">2000</span>);\n            <span class=\"hljs-built_in\">this</span>.data = data;\n        } <span class=\"hljs-keyword\">finally</span> {\n            log.info(<span class=\"hljs-string\">&quot;write unlock {}&quot;</span>, stamp);\n            lock.unlockWrite(stamp);\n        }\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4012,4055"}},{"content":"<pre data-lines=\"4056,4057\"><code>&#x6d4b;&#x8bd5;`&#x8bfb;-&#x8bfb;`&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4056,4057"}},{"content":"<pre data-lines=\"4058,4080\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DataContainerStampedTest</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">DataContainerStamped</span> <span class=\"hljs-variable\">dataContainer</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DataContainerStamped</span>();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                dataContainer.read();\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, <span class=\"hljs-string\">&quot;t1&quot;</span>).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                dataContainer.read();\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, <span class=\"hljs-string\">&quot;t2&quot;</span>).start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4058,4080"}},{"content":"<pre data-lines=\"4081,4088\"><code class=\"language-java\">18:27:06.087 [t1] INFO com.caochenlei.sl.DataContainerStamped - optimistic read locking...256\n18:27:06.087 [t2] INFO com.caochenlei.sl.DataContainerStamped - optimistic read locking...256\n18:27:08.105 [t2] INFO com.caochenlei.sl.DataContainerStamped - read finish...256, data:0\n18:27:08.105 [t1] INFO com.caochenlei.sl.DataContainerStamped - read finish...256, data:0\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4081,4088"}},{"content":"<pre data-lines=\"4089,4090\"><code>&#x6d4b;&#x8bd5;`&#x8bfb;-&#x5199;`&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4089,4090"}},{"content":"<pre data-lines=\"4091,4113\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DataContainerStampedTest</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">DataContainerStamped</span> <span class=\"hljs-variable\">dataContainer</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DataContainerStamped</span>();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                dataContainer.read();\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, <span class=\"hljs-string\">&quot;t1&quot;</span>).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                dataContainer.write(<span class=\"hljs-number\">100</span>);\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, <span class=\"hljs-string\">&quot;t2&quot;</span>).start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4091,4113"}},{"content":"<pre data-lines=\"4114,4124\"><code class=\"language-java\">18:28:59.424 [t2] INFO com.caochenlei.sl.DataContainerStamped - write lock 384\n18:28:59.424 [t1] INFO com.caochenlei.sl.DataContainerStamped - optimistic read locking...256\n18:29:01.445 [t2] INFO com.caochenlei.sl.DataContainerStamped - write unlock 384\n18:29:01.445 [t1] INFO com.caochenlei.sl.DataContainerStamped - updating to read lock... 256\n18:29:01.446 [t1] INFO com.caochenlei.sl.DataContainerStamped - read lock 513\n18:29:03.454 [t1] INFO com.caochenlei.sl.DataContainerStamped - read finish...513, data:100\n18:29:03.455 [t1] INFO com.caochenlei.sl.DataContainerStamped - read unlock 513\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4114,4124"}},{"content":"<pre data-lines=\"4125,4126\"><code>&#x6d4b;&#x8bd5;`&#x5199;-&#x5199;`&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4125,4126"}},{"content":"<pre data-lines=\"4127,4149\"><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DataContainerStampedTest</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">DataContainerStamped</span> <span class=\"hljs-variable\">dataContainer</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DataContainerStamped</span>();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                dataContainer.write(<span class=\"hljs-number\">100</span>);\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, <span class=\"hljs-string\">&quot;t1&quot;</span>).start();\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                dataContainer.write(<span class=\"hljs-number\">100</span>);\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, <span class=\"hljs-string\">&quot;t2&quot;</span>).start();\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4127,4149"}},{"content":"<pre data-lines=\"4150,4157\"><code class=\"language-java\">18:29:48.046 [t1] INFO com.caochenlei.sl.DataContainerStamped - write lock 384\n18:29:50.072 [t1] INFO com.caochenlei.sl.DataContainerStamped - write unlock 384\n18:29:50.072 [t2] INFO com.caochenlei.sl.DataContainerStamped - write lock 640\n18:29:52.086 [t2] INFO com.caochenlei.sl.DataContainerStamped - write unlock 640\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4150,4157"}}],"payload":{"tag":"h3","lines":"3979,3980"}},{"content":"5.2.5&#x3001;Semaphore &#x4ecb;&#x7ecd;","children":[{"content":"<pre data-lines=\"4160,4163\"><code>Semaphore&#x4fe1;&#x53f7;&#x91cf;&#xff0c;&#x7528;&#x6765;&#x9650;&#x5236;&#x80fd;&#x540c;&#x65f6;&#x8bbf;&#x95ee;&#x5171;&#x4eab;&#x8d44;&#x6e90;&#x7684;&#x7ebf;&#x7a0b;&#x4e0a;&#x9650;&#x3002;\n\n&#x573a;&#x666f;&#xff1a;&#x6211;&#x4eec;&#x73b0;&#x5728;&#x6709;6&#x4e2a;&#x7ebf;&#x7a0b;&#xff0c;&#x4f46;&#x662f;&#x6211;&#x4eec;&#x6bcf;&#x6b21;&#x8981;&#x6c42;&#x53ea;&#x6709;2&#x4e2a;&#x7ebf;&#x7a0b;&#x8fd0;&#x884c;&#xff0c;&#x8fd9;&#x65f6;&#x5019;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;&#x4fe1;&#x53f7;&#x91cf;&#xff0c;&#x6765;&#x9650;&#x5236;&#x80fd;&#x540c;&#x65f6;&#x8bbf;&#x95ee;&#x5171;&#x4eab;&#x8d44;&#x6e90;&#x7684;&#x7ebf;&#x7a0b;&#x4e0a;&#x9650;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4160,4163"}},{"content":"<pre data-lines=\"4164,4182\"><code class=\"language-java\"><span class=\"hljs-type\">Semaphore</span> <span class=\"hljs-variable\">semaphore</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Semaphore</span>(<span class=\"hljs-number\">2</span>);\n<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">6</span>; i++) {\n    <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n        <span class=\"hljs-keyword\">try</span> {\n            semaphore.acquire();\n            log.debug(<span class=\"hljs-string\">&quot;running...&quot;</span>);\n            Thread.sleep(<span class=\"hljs-number\">2000</span>);\n            log.debug(<span class=\"hljs-string\">&quot;end...&quot;</span>);\n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n            e.printStackTrace();\n        } <span class=\"hljs-keyword\">finally</span> {\n            semaphore.release();\n        }\n    }).start();\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4164,4182"}},{"content":"<pre data-lines=\"4183,4198\"><code class=\"language-java\">15:54:30.286 [Thread-1] DEBUG com.caochenlei.Test41 - running...\n15:54:30.286 [Thread-0] DEBUG com.caochenlei.Test41 - running...\n15:54:32.301 [Thread-1] DEBUG com.caochenlei.Test41 - end...\n15:54:32.301 [Thread-0] DEBUG com.caochenlei.Test41 - end...\n15:54:32.301 [Thread-2] DEBUG com.caochenlei.Test41 - running...\n15:54:32.301 [Thread-3] DEBUG com.caochenlei.Test41 - running...\n15:54:34.317 [Thread-3] DEBUG com.caochenlei.Test41 - end...\n15:54:34.317 [Thread-2] DEBUG com.caochenlei.Test41 - end...\n15:54:34.317 [Thread-4] DEBUG com.caochenlei.Test41 - running...\n15:54:34.317 [Thread-5] DEBUG com.caochenlei.Test41 - running...\n15:54:36.332 [Thread-5] DEBUG com.caochenlei.Test41 - end...\n15:54:36.332 [Thread-4] DEBUG com.caochenlei.Test41 - end...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4183,4198"}}],"payload":{"tag":"h3","lines":"4158,4159"}},{"content":"5.2.5&#x3001;CountDownLatch &#x4ecb;&#x7ecd;","children":[{"content":"<pre data-lines=\"4201,4204\"><code>CountdownLatch&#x7528;&#x6765;&#x8fdb;&#x884c;&#x7ebf;&#x7a0b;&#x540c;&#x6b65;&#x534f;&#x4f5c;&#xff0c;&#x7b49;&#x5f85;&#x6240;&#x6709;&#x7ebf;&#x7a0b;&#x5b8c;&#x6210;&#x5012;&#x8ba1;&#x65f6;&#x3002;\n\n&#x5176;&#x4e2d;&#x6784;&#x9020;&#x53c2;&#x6570;&#x7528;&#x6765;&#x521d;&#x59cb;&#x5316;&#x7b49;&#x5f85;&#x8ba1;&#x6570;&#x503c;&#xff0c;await() &#x7528;&#x6765;&#x7b49;&#x5f85;&#x8ba1;&#x6570;&#x5f52;&#x96f6;&#xff0c;countDown() &#x7528;&#x6765;&#x8ba9;&#x8ba1;&#x6570;&#x51cf;&#x4e00;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4201,4204"}},{"content":"<pre data-lines=\"4205,4242\"><code class=\"language-java\"><span class=\"hljs-type\">CountDownLatch</span> <span class=\"hljs-variable\">latch</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">CountDownLatch</span>(<span class=\"hljs-number\">3</span>);\n<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n        log.debug(<span class=\"hljs-string\">&quot;begin...&quot;</span>);\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n        latch.countDown();\n        log.debug(<span class=\"hljs-string\">&quot;end...{}&quot;</span>, latch.getCount());\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n}).start();\n<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n        log.debug(<span class=\"hljs-string\">&quot;begin...&quot;</span>);\n        Thread.sleep(<span class=\"hljs-number\">2000</span>);\n        latch.countDown();\n        log.debug(<span class=\"hljs-string\">&quot;end...{}&quot;</span>, latch.getCount());\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n}).start();\n<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n        log.debug(<span class=\"hljs-string\">&quot;begin...&quot;</span>);\n        Thread.sleep(<span class=\"hljs-number\">3000</span>);\n        latch.countDown();\n        log.debug(<span class=\"hljs-string\">&quot;end...{}&quot;</span>, latch.getCount());\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n}).start();\nlog.debug(<span class=\"hljs-string\">&quot;waiting...&quot;</span>);\nlatch.await();\nlog.debug(<span class=\"hljs-string\">&quot;wait end...&quot;</span>);\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4205,4242"}},{"content":"<pre data-lines=\"4243,4254\"><code class=\"language-java\">16:30:00.046 [main] DEBUG com.caochenlei.Test42 - waiting...\n16:30:00.064 [Thread-0] DEBUG com.caochenlei.Test42 - begin...\n16:30:00.064 [Thread-1] DEBUG com.caochenlei.Test42 - begin...\n16:30:00.066 [Thread-2] DEBUG com.caochenlei.Test42 - begin...\n16:30:01.066 [Thread-0] DEBUG com.caochenlei.Test42 - end...2\n16:30:02.074 [Thread-1] DEBUG com.caochenlei.Test42 - end...1\n16:30:03.080 [Thread-2] DEBUG com.caochenlei.Test42 - end...0\n16:30:03.080 [main] DEBUG com.caochenlei.Test42 - wait end...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4243,4254"}}],"payload":{"tag":"h3","lines":"4199,4200"}},{"content":"5.2.6&#x3001;CyclicBarrier &#x4ecb;&#x7ecd;","children":[{"content":"<pre data-lines=\"4257,4260\"><code>CyclicBarrier&#x5faa;&#x73af;&#x6805;&#x680f;&#xff0c;&#x7528;&#x6765;&#x8fdb;&#x884c;&#x7ebf;&#x7a0b;&#x540c;&#x6b65;&#x534f;&#x4f5c;&#xff0c;&#x7b49;&#x5f85;&#x7ebf;&#x7a0b;&#x6ee1;&#x8db3;&#x67d0;&#x4e2a;&#x8ba1;&#x6570;&#x3002;\n\n&#x6784;&#x9020;&#x65f6;&#x8bbe;&#x7f6e;&#x300e;&#x8ba1;&#x6570;&#x4e2a;&#x6570;&#x300f;&#xff0c;&#x6bcf;&#x4e2a;&#x7ebf;&#x7a0b;&#x6267;&#x884c;&#x5230;&#x67d0;&#x4e2a;&#x9700;&#x8981;&#x201c;&#x540c;&#x6b65;&#x201d;&#x7684;&#x65f6;&#x523b;&#x8c03;&#x7528; await() &#x65b9;&#x6cd5;&#x8fdb;&#x884c;&#x7b49;&#x5f85;&#xff0c;&#x5f53;&#x7b49;&#x5f85;&#x7684;&#x7ebf;&#x7a0b;&#x6570;&#x6ee1;&#x8db3;&#x300e;&#x8ba1;&#x6570;&#x4e2a;&#x6570;&#x300f;&#x65f6;&#xff0c;&#x7ee7;&#x7eed;&#x6267;&#x884c;&#x3002;&#x4ed6;&#x53ef;&#x4ee5;&#x7528;&#x4e8e;&#x591a;&#x7ebf;&#x7a0b;&#x8ba1;&#x7b97;&#x6570;&#x636e;&#xff0c;&#x6700;&#x540e;&#x5408;&#x5e76;&#x8ba1;&#x7b97;&#x7ed3;&#x679c;&#x7684;&#x573a;&#x666f;&#x3002;CountDownLatch &#x662f;&#x4e00;&#x6b21;&#x6027;&#x7684;&#xff0c;CyclicBarrier &#x662f;&#x53ef;&#x5faa;&#x73af;&#x5229;&#x7528;&#x7684;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4257,4260"}},{"content":"<pre data-lines=\"4261,4289\"><code class=\"language-java\"><span class=\"hljs-type\">ExecutorService</span> <span class=\"hljs-variable\">service</span> <span class=\"hljs-operator\">=</span> Executors.newFixedThreadPool(<span class=\"hljs-number\">2</span>);\n<span class=\"hljs-type\">CyclicBarrier</span> <span class=\"hljs-variable\">barrier</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">CyclicBarrier</span>(<span class=\"hljs-number\">2</span>, () -&gt; {\n    log.debug(<span class=\"hljs-string\">&quot;task1, task2 finish...&quot;</span>);\n});\n<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">4</span>; i++) {\n    service.submit(() -&gt; {\n        log.debug(<span class=\"hljs-string\">&quot;task1 begin...&quot;</span>);\n        <span class=\"hljs-keyword\">try</span> {\n            Thread.sleep(<span class=\"hljs-number\">1000</span>);\n            barrier.await(); \n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException | BrokenBarrierException e) {\n            e.printStackTrace();\n        }\n    });\n    service.submit(() -&gt; {\n        log.debug(<span class=\"hljs-string\">&quot;task2 begin...&quot;</span>);\n        <span class=\"hljs-keyword\">try</span> {\n            Thread.sleep(<span class=\"hljs-number\">2000</span>);\n            barrier.await(); \n        } <span class=\"hljs-keyword\">catch</span> (InterruptedException | BrokenBarrierException e) {\n            e.printStackTrace();\n        }\n    });\n}\nservice.shutdown();\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4261,4289"}},{"content":"<pre data-lines=\"4290,4305\"><code class=\"language-java\">16:55:45.871 [pool-1-thread-2] DEBUG com.caochenlei.Test43 - task2 begin...\n16:55:45.871 [pool-1-thread-1] DEBUG com.caochenlei.Test43 - task1 begin...\n16:55:47.882 [pool-1-thread-2] DEBUG com.caochenlei.Test43 - task1, task2 finish...\n16:55:47.882 [pool-1-thread-2] DEBUG com.caochenlei.Test43 - task1 begin...\n16:55:47.882 [pool-1-thread-1] DEBUG com.caochenlei.Test43 - task2 begin...\n16:55:49.888 [pool-1-thread-1] DEBUG com.caochenlei.Test43 - task1, task2 finish...\n16:55:49.888 [pool-1-thread-1] DEBUG com.caochenlei.Test43 - task1 begin...\n16:55:49.889 [pool-1-thread-2] DEBUG com.caochenlei.Test43 - task2 begin...\n16:55:51.900 [pool-1-thread-2] DEBUG com.caochenlei.Test43 - task1, task2 finish...\n16:55:51.901 [pool-1-thread-2] DEBUG com.caochenlei.Test43 - task1 begin...\n16:55:51.901 [pool-1-thread-1] DEBUG com.caochenlei.Test43 - task2 begin...\n16:55:53.903 [pool-1-thread-1] DEBUG com.caochenlei.Test43 - task1, task2 finish...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4290,4305"}}],"payload":{"tag":"h3","lines":"4255,4256"}}],"payload":{"tag":"h2","lines":"3433,3435"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
