<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"<a href=\"#patch\">#</a> patch","children":[{"content":"&#x8ba4;&#x8bc6;","children":[{"content":"<pre data-lines=\"6,9\"><code>&#x901a;&#x8fc7;&#x524d;&#x4e00;&#x7ae0;&#x7684;&#x5206;&#x6790;&#x6211;&#x4eec;&#x77e5;&#x9053;&#xff0c;&#x5f53;&#x6211;&#x4eec;&#x901a;&#x8fc7; `createComponent` &#x521b;&#x5efa;&#x4e86;&#x7ec4;&#x4ef6; VNode&#xff0c;&#x63a5;&#x4e0b;&#x6765;&#x4f1a;&#x8d70;&#x5230; `vm._update`&#xff0c;&#x6267;&#x884c; `vm.__patch__` &#x53bb;&#x628a; VNode &#x8f6c;&#x6362;&#x6210;&#x771f;&#x6b63;&#x7684; DOM &#x8282;&#x70b9;&#x3002;&#x8fd9;&#x4e2a;&#x8fc7;&#x7a0b;&#x6211;&#x4eec;&#x5728;&#x524d;&#x4e00;&#x7ae0;&#x5df2;&#x7ecf;&#x5206;&#x6790;&#x8fc7;&#x4e86;&#xff0c;&#x4f46;&#x662f;&#x9488;&#x5bf9;&#x4e00;&#x4e2a;&#x666e;&#x901a;&#x7684; VNode &#x8282;&#x70b9;&#xff0c;&#x63a5;&#x4e0b;&#x6765;&#x6211;&#x4eec;&#x6765;&#x770b;&#x770b;&#x7ec4;&#x4ef6;&#x7684; VNode &#x4f1a;&#x6709;&#x54ea;&#x4e9b;&#x4e0d;&#x4e00;&#x6837;&#x7684;&#x5730;&#x65b9;&#x3002;\n\npatch &#x7684;&#x8fc7;&#x7a0b;&#x4f1a;&#x8c03;&#x7528; `createElm` &#x521b;&#x5efa;&#x5143;&#x7d20;&#x8282;&#x70b9;&#xff0c;&#x56de;&#x987e;&#x4e00;&#x4e0b; `createElm` &#x7684;&#x5b9e;&#x73b0;&#xff0c;&#x5b83;&#x7684;&#x5b9a;&#x4e49;&#x5728; `src/core/vdom/patch.js` &#x4e2d;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6,9"}},{"content":"<pre data-lines=\"10,27\"><code data-lines=\"10,27\">function createElm (\n<span class=\"hljs-built_in\">  vnode,</span>\n<span class=\"hljs-built_in\">  insertedVnodeQueue,</span>\n<span class=\"hljs-built_in\">  parentElm,</span>\n<span class=\"hljs-built_in\">  refElm,</span>\n<span class=\"hljs-built_in\">  nested,</span>\n<span class=\"hljs-built_in\">  ownerArray,</span>\n  index\n) {\n  // ...\n  if (createComponent(vnode, insertedVnodeQueue, parentElm, refElm)) {\n    <span class=\"hljs-keyword\">return</span>\n  }\n  // ...\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"10,27"}}],"payload":{"tag":"h2","lines":"3,5"}},{"content":"<a href=\"#createcomponent\">#</a> createComponent","children":[{"content":"<pre data-lines=\"31,32\"><code>&#x6211;&#x4eec;&#x5220;&#x6389;&#x591a;&#x4f59;&#x7684;&#x4ee3;&#x7801;&#xff0c;&#x53ea;&#x4fdd;&#x7559;&#x5173;&#x952e;&#x7684;&#x903b;&#x8f91;&#xff0c;&#x8fd9;&#x91cc;&#x4f1a;&#x5224;&#x65ad; `createComponent(vnode, insertedVnodeQueue, parentElm, refElm)` &#x7684;&#x8fd4;&#x56de;&#x503c;&#xff0c;&#x5982;&#x679c;&#x4e3a; `true` &#x5219;&#x76f4;&#x63a5;&#x7ed3;&#x675f;&#xff0c;&#x90a3;&#x4e48;&#x63a5;&#x4e0b;&#x6765;&#x770b;&#x4e00;&#x4e0b; `createComponent` &#x65b9;&#x6cd5;&#x7684;&#x5b9e;&#x73b0;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"31,32"}},{"content":"<pre data-lines=\"33,56\"><code data-lines=\"33,56\">function createComponent (vnode, insertedVnodeQueue, parentElm, refElm) {\n  let <span class=\"hljs-selector-tag\">i</span> = vnode<span class=\"hljs-selector-class\">.data</span>\n  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">isDef</span>(i)) {\n    const isReactivated = <span class=\"hljs-built_in\">isDef</span>(vnode.componentInstance) &amp;&amp; <span class=\"hljs-selector-tag\">i</span><span class=\"hljs-selector-class\">.keepAlive</span>\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">isDef</span>(<span class=\"hljs-selector-tag\">i</span> = <span class=\"hljs-selector-tag\">i</span>.hook) &amp;&amp; <span class=\"hljs-built_in\">isDef</span>(<span class=\"hljs-selector-tag\">i</span> = <span class=\"hljs-selector-tag\">i</span>.init)) {\n      <span class=\"hljs-selector-tag\">i</span>(vnode, false <span class=\"hljs-comment\">/* hydrating */</span>)\n    }\n    <span class=\"hljs-comment\">// after calling the init hook, if the vnode is a child component</span>\n    <span class=\"hljs-comment\">// it should&apos;ve created a child instance and mounted it. the child</span>\n    <span class=\"hljs-comment\">// component also has set the placeholder vnode&apos;s elm.</span>\n    <span class=\"hljs-comment\">// in that case we can just return the element and be done.</span>\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">isDef</span>(vnode.componentInstance)) {\n      <span class=\"hljs-built_in\">initComponent</span>(vnode, insertedVnodeQueue)\n      <span class=\"hljs-built_in\">insert</span>(parentElm, vnode<span class=\"hljs-selector-class\">.elm</span>, refElm)\n      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">isTrue</span>(isReactivated)) {\n        <span class=\"hljs-built_in\">reactivateComponent</span>(vnode, insertedVnodeQueue, parentElm, refElm)\n      }\n      return true\n    }\n  }\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"33,56"}},{"content":"<pre data-lines=\"57,58\"><code>`createComponent` &#x51fd;&#x6570;&#x4e2d;&#xff0c;&#x9996;&#x5148;&#x5bf9; `vnode.data` &#x505a;&#x4e86;&#x4e00;&#x4e9b;&#x5224;&#x65ad;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"57,58"}},{"content":"<pre data-lines=\"59,70\"><code data-lines=\"59,70\">let <span class=\"hljs-selector-tag\">i</span> = vnode<span class=\"hljs-selector-class\">.data</span>\n<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">isDef</span>(i)) {\n  <span class=\"hljs-comment\">// ...</span>\n  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">isDef</span>(<span class=\"hljs-selector-tag\">i</span> = <span class=\"hljs-selector-tag\">i</span>.hook) &amp;&amp; <span class=\"hljs-built_in\">isDef</span>(<span class=\"hljs-selector-tag\">i</span> = <span class=\"hljs-selector-tag\">i</span>.init)) {\n    <span class=\"hljs-selector-tag\">i</span>(vnode, false <span class=\"hljs-comment\">/* hydrating */</span>)\n    <span class=\"hljs-comment\">// ...</span>\n  }\n  <span class=\"hljs-comment\">// ..</span>\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"59,70"}},{"content":"<pre data-lines=\"71,72\"><code>&#x5982;&#x679c; `vnode` &#x662f;&#x4e00;&#x4e2a;&#x7ec4;&#x4ef6; VNode&#xff0c;&#x90a3;&#x4e48;&#x6761;&#x4ef6;&#x4f1a;&#x6ee1;&#x8db3;&#xff0c;&#x5e76;&#x4e14;&#x5f97;&#x5230; `i` &#x5c31;&#x662f; `init` &#x94a9;&#x5b50;&#x51fd;&#x6570;&#xff0c;&#x56de;&#x987e;&#x4e0a;&#x8282;&#x6211;&#x4eec;&#x5728;&#x521b;&#x5efa;&#x7ec4;&#x4ef6; VNode &#x7684;&#x65f6;&#x5019;&#x5408;&#x5e76;&#x94a9;&#x5b50;&#x51fd;&#x6570;&#x4e2d;&#x5c31;&#x5305;&#x542b; `init` &#x94a9;&#x5b50;&#x51fd;&#x6570;&#xff0c;&#x5b9a;&#x4e49;&#x5728; `src/core/vdom/create-component.js` &#x4e2d;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"71,72"}},{"content":"<pre data-lines=\"73,92\"><code data-lines=\"73,92\"><span class=\"hljs-title function_ invoke__\">init</span> (<span class=\"hljs-attr\">vnode</span>: VNodeWithData, <span class=\"hljs-attr\">hydrating</span>: <span class=\"hljs-keyword\">boolean</span>): ?<span class=\"hljs-keyword\">boolean</span> {\n  <span class=\"hljs-keyword\">if</span> (\n    vnode.componentInstance &amp;&amp;\n    !vnode.componentInstance._isDestroyed &amp;&amp;\n    vnode.data.keepAlive\n  ) {\n    <span class=\"hljs-comment\">// kept-alive components, treat as a patch</span>\n    <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">mountedNode</span>: any = vnode <span class=\"hljs-comment\">// work around flow</span>\n    componentVNodeHooks.<span class=\"hljs-title function_ invoke__\">prepatch</span>(mountedNode, mountedNode)\n  } <span class=\"hljs-keyword\">else</span> {\n    <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">child</span> = vnode.componentInstance = <span class=\"hljs-title function_ invoke__\">createComponentInstanceForVnode</span>(\n      vnode,\n      activeInstance\n    )\n    child.<span class=\"hljs-variable\">&#x24;mount</span>(hydrating ? vnode.elm : undefined, hydrating)\n  }\n}, \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"73,92"}},{"content":"<pre data-lines=\"93,94\"><code>`init` &#x94a9;&#x5b50;&#x51fd;&#x6570;&#x6267;&#x884c;&#x4e5f;&#x5f88;&#x7b80;&#x5355;&#xff0c;&#x6211;&#x4eec;&#x5148;&#x4e0d;&#x8003;&#x8651; `keepAlive` &#x7684;&#x60c5;&#x51b5;&#xff0c;&#x5b83;&#x662f;&#x901a;&#x8fc7; `createComponentInstanceForVnode` &#x521b;&#x5efa;&#x4e00;&#x4e2a; Vue &#x7684;&#x5b9e;&#x4f8b;&#xff0c;&#x7136;&#x540e;&#x8c03;&#x7528; `&#x24;mount` &#x65b9;&#x6cd5;&#x6302;&#x8f7d;&#x5b50;&#x7ec4;&#x4ef6;&#xff0c; &#x5148;&#x6765;&#x770b;&#x4e00;&#x4e0b; `createComponentInstanceForVnode` &#x7684;&#x5b9e;&#x73b0;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"93,94"}},{"content":"<pre data-lines=\"95,114\"><code data-lines=\"95,114\">export function createComponentInstanceForVnode (\n  vnode: <span class=\"hljs-keyword\">any</span>, <span class=\"hljs-comment\">// we know it&apos;s MountedComponentVNode but flow doesn&apos;t</span>\n  parent: <span class=\"hljs-keyword\">any</span>, <span class=\"hljs-comment\">// activeInstance in lifecycle state</span>\n): Component {\n  const <span class=\"hljs-keyword\">options</span>: InternalComponentOptions = {\n    _isComponent: <span class=\"hljs-keyword\">true</span>,\n    _parentVnode: vnode,\n    parent\n  }\n  <span class=\"hljs-comment\">// check inline-template render functions</span>\n  const inlineTemplate = vnode.data.inlineTemplate\n  <span class=\"hljs-keyword\">if</span> (isDef(inlineTemplate)) {\n    <span class=\"hljs-keyword\">options</span>.render = inlineTemplate.render\n    <span class=\"hljs-keyword\">options</span>.staticRenderFns = inlineTemplate.staticRenderFns\n  }\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> vnode.componentOptions.Ctor(<span class=\"hljs-keyword\">options</span>)\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"95,114"}},{"content":"<pre data-lines=\"115,118\"><code>`createComponentInstanceForVnode` &#x51fd;&#x6570;&#x6784;&#x9020;&#x7684;&#x4e00;&#x4e2a;&#x5185;&#x90e8;&#x7ec4;&#x4ef6;&#x7684;&#x53c2;&#x6570;&#xff0c;&#x7136;&#x540e;&#x6267;&#x884c; `new vnode.componentOptions.Ctor(options)`&#x3002;&#x8fd9;&#x91cc;&#x7684; `vnode.componentOptions.Ctor` &#x5bf9;&#x5e94;&#x7684;&#x5c31;&#x662f;&#x5b50;&#x7ec4;&#x4ef6;&#x7684;&#x6784;&#x9020;&#x51fd;&#x6570;&#xff0c;&#x6211;&#x4eec;&#x4e0a;&#x4e00;&#x8282;&#x5206;&#x6790;&#x4e86;&#x5b83;&#x5b9e;&#x9645;&#x4e0a;&#x662f;&#x7ee7;&#x627f;&#x4e8e; Vue &#x7684;&#x4e00;&#x4e2a;&#x6784;&#x9020;&#x5668; `Sub`&#xff0c;&#x76f8;&#x5f53;&#x4e8e; `new Sub(options)` &#x8fd9;&#x91cc;&#x6709;&#x51e0;&#x4e2a;&#x5173;&#x952e;&#x53c2;&#x6570;&#x8981;&#x6ce8;&#x610f;&#x51e0;&#x4e2a;&#x70b9;&#xff0c;`_isComponent` &#x4e3a; `true` &#x8868;&#x793a;&#x5b83;&#x662f;&#x4e00;&#x4e2a;&#x7ec4;&#x4ef6;&#xff0c;`parent` &#x8868;&#x793a;&#x5f53;&#x524d;&#x6fc0;&#x6d3b;&#x7684;&#x7ec4;&#x4ef6;&#x5b9e;&#x4f8b;&#xff08;&#x6ce8;&#x610f;&#xff0c;&#x8fd9;&#x91cc;&#x6bd4;&#x8f83;&#x6709;&#x610f;&#x601d;&#x7684;&#x662f;&#x5982;&#x4f55;&#x62ff;&#x5230;&#x7ec4;&#x4ef6;&#x5b9e;&#x4f8b;&#xff0c;&#x540e;&#x9762;&#x4f1a;&#x4ecb;&#x7ecd;&#x3002;\n\n&#x6240;&#x4ee5;&#x5b50;&#x7ec4;&#x4ef6;&#x7684;&#x5b9e;&#x4f8b;&#x5316;&#x5b9e;&#x9645;&#x4e0a;&#x5c31;&#x662f;&#x5728;&#x8fd9;&#x4e2a;&#x65f6;&#x673a;&#x6267;&#x884c;&#x7684;&#xff0c;&#x5e76;&#x4e14;&#x5b83;&#x4f1a;&#x6267;&#x884c;&#x5b9e;&#x4f8b;&#x7684; `_init` &#x65b9;&#x6cd5;&#xff0c;&#x8fd9;&#x4e2a;&#x8fc7;&#x7a0b;&#x6709;&#x4e00;&#x4e9b;&#x548c;&#x4e4b;&#x524d;&#x4e0d;&#x540c;&#x7684;&#x5730;&#x65b9;&#x9700;&#x8981;&#x6311;&#x51fa;&#x6765;&#x8bf4;&#xff0c;&#x4ee3;&#x7801;&#x5728; `src/core/instance/init.js` &#x4e2d;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"115,118"}},{"content":"<pre data-lines=\"119,141\"><code data-lines=\"119,141\">Vue.prototype._init = function (<span class=\"hljs-keyword\">options</span>?: Object) {\n  const vm: Component = this\n  <span class=\"hljs-comment\">// merge options</span>\n  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">options</span> &amp;&amp; <span class=\"hljs-keyword\">options</span>._isComponent) {\n    <span class=\"hljs-comment\">// optimize internal component instantiation</span>\n    <span class=\"hljs-comment\">// since dynamic options merging is pretty slow, and none of the</span>\n    <span class=\"hljs-comment\">// internal component options needs special treatment.</span>\n    initInternalComponent(vm, <span class=\"hljs-keyword\">options</span>)\n  } <span class=\"hljs-keyword\">else</span> {\n    vm.<span class=\"hljs-symbol\">&#x24;</span><span class=\"hljs-keyword\">options</span> = mergeOptions(\n      resolveConstructorOptions(vm.constructor),\n      <span class=\"hljs-keyword\">options</span> || {},\n      vm\n    )\n  }\n  <span class=\"hljs-comment\">// ...</span>\n  <span class=\"hljs-keyword\">if</span> (vm.<span class=\"hljs-symbol\">&#x24;</span><span class=\"hljs-keyword\">options</span>.el) {\n    vm.<span class=\"hljs-symbol\">&#x24;</span>mount(vm.<span class=\"hljs-symbol\">&#x24;</span><span class=\"hljs-keyword\">options</span>.el)\n  } \n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"119,141"}},{"content":"<pre data-lines=\"142,143\"><code>&#x8fd9;&#x91cc;&#x9996;&#x5148;&#x662f;&#x5408;&#x5e76; `options` &#x7684;&#x8fc7;&#x7a0b;&#x6709;&#x53d8;&#x5316;&#xff0c;`_isComponent` &#x4e3a; true&#xff0c;&#x6240;&#x4ee5;&#x8d70;&#x5230;&#x4e86; `initInternalComponent` &#x8fc7;&#x7a0b;&#xff0c;&#x8fd9;&#x4e2a;&#x51fd;&#x6570;&#x7684;&#x5b9e;&#x73b0;&#x4e5f;&#x7b80;&#x5355;&#x770b;&#x4e00;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"142,143"}},{"content":"<pre data-lines=\"144,164\"><code data-lines=\"144,164\">export function initInternalComponent (vm: Component, options: InternalComponentOptions) {\n  const opts = vm.<span class=\"hljs-variable\">&#x24;options</span> = Object<span class=\"hljs-selector-class\">.create</span>(vm<span class=\"hljs-selector-class\">.constructor</span>.options)\n  <span class=\"hljs-comment\">// doing this because it&apos;s faster than dynamic enumeration.</span>\n  const parentVnode = options._parentVnode\n  opts<span class=\"hljs-selector-class\">.parent</span> = options<span class=\"hljs-selector-class\">.parent</span>\n  opts._parentVnode = parentVnode\n\n  const vnodeComponentOptions = parentVnode<span class=\"hljs-selector-class\">.componentOptions</span>\n  opts<span class=\"hljs-selector-class\">.propsData</span> = vnodeComponentOptions<span class=\"hljs-selector-class\">.propsData</span>\n  opts._parentListeners = vnodeComponentOptions<span class=\"hljs-selector-class\">.listeners</span>\n  opts._renderChildren = vnodeComponentOptions<span class=\"hljs-selector-class\">.children</span>\n  opts._componentTag = vnodeComponentOptions<span class=\"hljs-selector-class\">.tag</span>\n\n  <span class=\"hljs-keyword\">if</span> (options.render) {\n    opts<span class=\"hljs-selector-class\">.render</span> = options<span class=\"hljs-selector-class\">.render</span>\n    opts<span class=\"hljs-selector-class\">.staticRenderFns</span> = options<span class=\"hljs-selector-class\">.staticRenderFns</span>\n  }\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"144,164"}},{"content":"<pre data-lines=\"165,168\"><code>&#x8fd9;&#x4e2a;&#x8fc7;&#x7a0b;&#x6211;&#x4eec;&#x91cd;&#x70b9;&#x8bb0;&#x4f4f;&#x4ee5;&#x4e0b;&#x51e0;&#x4e2a;&#x70b9;&#x5373;&#x53ef;&#xff1a;`opts.parent = options.parent`&#x3001;`opts._parentVnode = parentVnode`&#xff0c;&#x5b83;&#x4eec;&#x662f;&#x628a;&#x4e4b;&#x524d;&#x6211;&#x4eec;&#x901a;&#x8fc7; `createComponentInstanceForVnode` &#x51fd;&#x6570;&#x4f20;&#x5165;&#x7684;&#x51e0;&#x4e2a;&#x53c2;&#x6570;&#x5408;&#x5e76;&#x5230;&#x5185;&#x90e8;&#x7684;&#x9009;&#x9879; `&#x24;options` &#x91cc;&#x4e86;&#x3002;\n\n&#x518d;&#x6765;&#x770b;&#x4e00;&#x4e0b; `_init` &#x51fd;&#x6570;&#x6700;&#x540e;&#x6267;&#x884c;&#x7684;&#x4ee3;&#x7801;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"165,168"}},{"content":"<pre data-lines=\"169,174\"><code data-lines=\"169,174\"><span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">vm</span>.&#x24;<span class=\"hljs-keyword\">options</span>.<span class=\"hljs-keyword\">el</span>) {\n   <span class=\"hljs-keyword\">vm</span>.&#x24;mount(<span class=\"hljs-keyword\">vm</span>.&#x24;<span class=\"hljs-keyword\">options</span>.<span class=\"hljs-keyword\">el</span>)\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"169,174"}},{"content":"<pre data-lines=\"175,176\"><code>&#x7531;&#x4e8e;&#x7ec4;&#x4ef6;&#x521d;&#x59cb;&#x5316;&#x7684;&#x65f6;&#x5019;&#x662f;&#x4e0d;&#x4f20; el &#x7684;&#xff0c;&#x56e0;&#x6b64;&#x7ec4;&#x4ef6;&#x662f;&#x81ea;&#x5df1;&#x63a5;&#x7ba1;&#x4e86; `&#x24;mount` &#x7684;&#x8fc7;&#x7a0b;&#xff0c;&#x8fd9;&#x4e2a;&#x8fc7;&#x7a0b;&#x7684;&#x4e3b;&#x8981;&#x6d41;&#x7a0b;&#x5728;&#x4e0a;&#x4e00;&#x7ae0;&#x4ecb;&#x7ecd;&#x8fc7;&#x4e86;&#xff0c;&#x56de;&#x5230;&#x7ec4;&#x4ef6; `init` &#x7684;&#x8fc7;&#x7a0b;&#xff0c;`componentVNodeHooks` &#x7684; `init` &#x94a9;&#x5b50;&#x51fd;&#x6570;&#xff0c;&#x5728;&#x5b8c;&#x6210;&#x5b9e;&#x4f8b;&#x5316;&#x7684; `_init` &#x540e;&#xff0c;&#x63a5;&#x7740;&#x4f1a;&#x6267;&#x884c; `child.&#x24;mount(hydrating ? vnode.elm : undefined, hydrating)` &#x3002;&#x8fd9;&#x91cc; `hydrating` &#x4e3a; true &#x4e00;&#x822c;&#x662f;&#x670d;&#x52a1;&#x7aef;&#x6e32;&#x67d3;&#x7684;&#x60c5;&#x51b5;&#xff0c;&#x6211;&#x4eec;&#x53ea;&#x8003;&#x8651;&#x5ba2;&#x6237;&#x7aef;&#x6e32;&#x67d3;&#xff0c;&#x6240;&#x4ee5;&#x8fd9;&#x91cc; `&#x24;mount` &#x76f8;&#x5f53;&#x4e8e;&#x6267;&#x884c; `child.&#x24;mount(undefined, false)`&#xff0c;&#x5b83;&#x6700;&#x7ec8;&#x4f1a;&#x8c03;&#x7528; `mountComponent` &#x65b9;&#x6cd5;&#xff0c;&#x8fdb;&#x800c;&#x6267;&#x884c; `vm._render()` &#x65b9;&#x6cd5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"175,176"}},{"content":"<pre data-lines=\"177,198\"><code data-lines=\"177,198\"><span class=\"hljs-title class_\">Vue</span>.<span class=\"hljs-property\"><span class=\"hljs-keyword\">prototype</span></span>.<span class=\"hljs-property\">_render</span> = <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>): <span class=\"hljs-title class_\">VNode</span> {\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">vm</span>: <span class=\"hljs-title class_\">Component</span> = <span class=\"hljs-variable language_\">this</span>\n  <span class=\"hljs-keyword\">const</span> { render, _parentVnode } = vm.<span class=\"hljs-property\">&#x24;options</span>\n\n  \n  <span class=\"hljs-comment\">// set parent vnode. this allows render functions to have access</span>\n  <span class=\"hljs-comment\">// to the data on the placeholder node.</span>\n  vm.<span class=\"hljs-property\">&#x24;vnode</span> = _parentVnode\n  <span class=\"hljs-comment\">// render self</span>\n  <span class=\"hljs-keyword\">let</span> vnode\n  <span class=\"hljs-keyword\">try</span> {\n    vnode = render.<span class=\"hljs-title function_\">call</span>(vm.<span class=\"hljs-property\">_renderProxy</span>, vm.<span class=\"hljs-property\">&#x24;createElement</span>)\n  } <span class=\"hljs-keyword\">catch</span> (e) {\n    <span class=\"hljs-comment\">// ...</span>\n  }\n  <span class=\"hljs-comment\">// set parent</span>\n  vnode.<span class=\"hljs-property\">parent</span> = _parentVnode\n  <span class=\"hljs-keyword\">return</span> vnode\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"177,198"}},{"content":"<pre data-lines=\"199,202\"><code>&#x6211;&#x4eec;&#x53ea;&#x4fdd;&#x7559;&#x5173;&#x952e;&#x90e8;&#x5206;&#x7684;&#x4ee3;&#x7801;&#xff0c;&#x8fd9;&#x91cc;&#x7684; `_parentVnode` &#x5c31;&#x662f;&#x5f53;&#x524d;&#x7ec4;&#x4ef6;&#x7684;&#x7236; VNode&#xff0c;&#x800c; `render` &#x51fd;&#x6570;&#x751f;&#x6210;&#x7684; `vnode` &#x5f53;&#x524d;&#x7ec4;&#x4ef6;&#x7684;&#x6e32;&#x67d3; `vnode`&#xff0c;`vnode` &#x7684; `parent` &#x6307;&#x5411;&#x4e86; `_parentVnode`&#xff0c;&#x4e5f;&#x5c31;&#x662f; `vm.&#x24;vnode`&#xff0c;&#x5b83;&#x4eec;&#x662f;&#x4e00;&#x79cd;&#x7236;&#x5b50;&#x7684;&#x5173;&#x7cfb;&#x3002;\n\n&#x6211;&#x4eec;&#x77e5;&#x9053;&#x5728;&#x6267;&#x884c;&#x5b8c; `vm._render` &#x751f;&#x6210; VNode &#x540e;&#xff0c;&#x63a5;&#x4e0b;&#x6765;&#x5c31;&#x8981;&#x6267;&#x884c; `vm._update` &#x53bb;&#x6e32;&#x67d3; VNode &#x4e86;&#x3002;&#x6765;&#x770b;&#x4e00;&#x4e0b;&#x7ec4;&#x4ef6;&#x6e32;&#x67d3;&#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#x6709;&#x54ea;&#x4e9b;&#x9700;&#x8981;&#x6ce8;&#x610f;&#x7684;&#xff0c;`vm._update` &#x7684;&#x5b9a;&#x4e49;&#x5728; `src/core/instance/lifecycle.js` &#x4e2d;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"199,202"}},{"content":"<pre data-lines=\"203,237\"><code data-lines=\"203,237\">export let activeInstance: any = <span class=\"hljs-literal\">null</span>\nVue.prototype._update = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">vnode: VNode, hydrating?: <span class=\"hljs-keyword\">boolean</span></span>) </span>{\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">vm</span>: Component = this\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">prevEl</span> = vm.<span class=\"hljs-variable\">&#x24;el</span>\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">prevVnode</span> = vm._vnode\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">prevActiveInstance</span> = activeInstance\n  activeInstance = vm\n  vm._vnode = vnode\n  <span class=\"hljs-comment\">// Vue.prototype.__patch__ is injected in entry points</span>\n  <span class=\"hljs-comment\">// based on the rendering backend used.</span>\n  <span class=\"hljs-keyword\">if</span> (!prevVnode) {\n    <span class=\"hljs-comment\">// initial render</span>\n    vm.<span class=\"hljs-variable\">&#x24;el</span> = vm.<span class=\"hljs-title function_ invoke__\">__patch__</span>(vm.<span class=\"hljs-variable\">&#x24;el</span>, vnode, hydrating, <span class=\"hljs-literal\">false</span> <span class=\"hljs-comment\">/* removeOnly */</span>)\n  } <span class=\"hljs-keyword\">else</span> {\n    <span class=\"hljs-comment\">// updates</span>\n    vm.<span class=\"hljs-variable\">&#x24;el</span> = vm.<span class=\"hljs-title function_ invoke__\">__patch__</span>(prevVnode, vnode)\n  }\n  activeInstance = prevActiveInstance\n  <span class=\"hljs-comment\">// update __vue__ reference</span>\n  <span class=\"hljs-keyword\">if</span> (prevEl) {\n    prevEl.__vue__ = <span class=\"hljs-literal\">null</span>\n  }\n  <span class=\"hljs-keyword\">if</span> (vm.<span class=\"hljs-variable\">&#x24;el</span>) {\n    vm.<span class=\"hljs-variable\">&#x24;el</span>.__vue__ = vm\n  }\n  <span class=\"hljs-comment\">// if parent is an HOC, update its &#x24;el as well</span>\n  <span class=\"hljs-keyword\">if</span> (vm.<span class=\"hljs-variable\">&#x24;vnode</span> &amp;&amp; vm.<span class=\"hljs-variable\">&#x24;parent</span> &amp;&amp; vm.<span class=\"hljs-variable\">&#x24;vnode</span> === vm.<span class=\"hljs-variable\">&#x24;parent</span>._vnode) {\n    vm.<span class=\"hljs-variable\">&#x24;parent</span>.<span class=\"hljs-variable\">&#x24;el</span> = vm.<span class=\"hljs-variable\">&#x24;el</span>\n  }\n  <span class=\"hljs-comment\">// updated hook is called by the scheduler to ensure that children are</span>\n  <span class=\"hljs-comment\">// updated in a parent&apos;s updated hook.</span>\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"203,237"}},{"content":"<pre data-lines=\"238,239\"><code>`_update` &#x8fc7;&#x7a0b;&#x4e2d;&#x6709;&#x51e0;&#x4e2a;&#x5173;&#x952e;&#x7684;&#x4ee3;&#x7801;&#xff0c;&#x9996;&#x5148; `vm._vnode = vnode` &#x7684;&#x903b;&#x8f91;&#xff0c;&#x8fd9;&#x4e2a; `vnode` &#x662f;&#x901a;&#x8fc7; `vm._render()` &#x8fd4;&#x56de;&#x7684;&#x7ec4;&#x4ef6;&#x6e32;&#x67d3; VNode&#xff0c;`vm._vnode` &#x548c; `vm.&#x24;vnode` &#x7684;&#x5173;&#x7cfb;&#x5c31;&#x662f;&#x4e00;&#x79cd;&#x7236;&#x5b50;&#x5173;&#x7cfb;&#xff0c;&#x7528;&#x4ee3;&#x7801;&#x8868;&#x8fbe;&#x5c31;&#x662f; `vm._vnode.parent === vm.&#x24;vnode`&#x3002;&#x8fd8;&#x6709;&#x4e00;&#x6bb5;&#x6bd4;&#x8f83;&#x6709;&#x610f;&#x601d;&#x7684;&#x4ee3;&#x7801;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"238,239"}},{"content":"<pre data-lines=\"240,257\"><code data-lines=\"240,257\">export let activeInstance: any = <span class=\"hljs-literal\">null</span>\nVue.prototype._update = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">vnode: VNode, hydrating?: <span class=\"hljs-keyword\">boolean</span></span>) </span>{\n    <span class=\"hljs-comment\">// ...</span>\n    <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">prevActiveInstance</span> = activeInstance\n    activeInstance = vm\n    <span class=\"hljs-keyword\">if</span> (!prevVnode) {\n      <span class=\"hljs-comment\">// initial render</span>\n      vm.<span class=\"hljs-variable\">&#x24;el</span> = vm.<span class=\"hljs-title function_ invoke__\">__patch__</span>(vm.<span class=\"hljs-variable\">&#x24;el</span>, vnode, hydrating, <span class=\"hljs-literal\">false</span> <span class=\"hljs-comment\">/* removeOnly */</span>)\n    } <span class=\"hljs-keyword\">else</span> {\n      <span class=\"hljs-comment\">// updates</span>\n      vm.<span class=\"hljs-variable\">&#x24;el</span> = vm.<span class=\"hljs-title function_ invoke__\">__patch__</span>(prevVnode, vnode)\n    }\n    activeInstance = prevActiveInstance\n    <span class=\"hljs-comment\">// ...</span>\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"240,257"}},{"content":"<pre data-lines=\"258,259\"><code>&#x8fd9;&#x4e2a; `activeInstance` &#x4f5c;&#x7528;&#x5c31;&#x662f;&#x4fdd;&#x6301;&#x5f53;&#x524d;&#x4e0a;&#x4e0b;&#x6587;&#x7684; Vue &#x5b9e;&#x4f8b;&#xff0c;&#x5b83;&#x662f;&#x5728; `lifecycle` &#x6a21;&#x5757;&#x7684;&#x5168;&#x5c40;&#x53d8;&#x91cf;&#xff0c;&#x5b9a;&#x4e49;&#x662f; `export let activeInstance: any = null`&#xff0c;&#x5e76;&#x4e14;&#x5728;&#x4e4b;&#x524d;&#x6211;&#x4eec;&#x8c03;&#x7528; `createComponentInstanceForVnode` &#x65b9;&#x6cd5;&#x7684;&#x65f6;&#x5019;&#x4ece; `lifecycle` &#x6a21;&#x5757;&#x83b7;&#x53d6;&#xff0c;&#x5e76;&#x4e14;&#x4f5c;&#x4e3a;&#x53c2;&#x6570;&#x4f20;&#x5165;&#x7684;&#x3002;&#x56e0;&#x4e3a;&#x5b9e;&#x9645;&#x4e0a; JavaScript &#x662f;&#x4e00;&#x4e2a;&#x5355;&#x7ebf;&#x7a0b;&#xff0c;Vue &#x6574;&#x4e2a;&#x521d;&#x59cb;&#x5316;&#x662f;&#x4e00;&#x4e2a;&#x6df1;&#x5ea6;&#x904d;&#x5386;&#x7684;&#x8fc7;&#x7a0b;&#xff0c;&#x5728;&#x5b9e;&#x4f8b;&#x5316;&#x5b50;&#x7ec4;&#x4ef6;&#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x5b83;&#x9700;&#x8981;&#x77e5;&#x9053;&#x5f53;&#x524d;&#x4e0a;&#x4e0b;&#x6587;&#x7684; Vue &#x5b9e;&#x4f8b;&#x662f;&#x4ec0;&#x4e48;&#xff0c;&#x5e76;&#x628a;&#x5b83;&#x4f5c;&#x4e3a;&#x5b50;&#x7ec4;&#x4ef6;&#x7684;&#x7236; Vue &#x5b9e;&#x4f8b;&#x3002;&#x4e4b;&#x524d;&#x6211;&#x4eec;&#x63d0;&#x5230;&#x8fc7;&#x5bf9;&#x5b50;&#x7ec4;&#x4ef6;&#x7684;&#x5b9e;&#x4f8b;&#x5316;&#x8fc7;&#x7a0b;&#x5148;&#x4f1a;&#x8c03;&#x7528; `initInternalComponent(vm, options)` &#x5408;&#x5e76; `options`&#xff0c;&#x628a; `parent` &#x5b58;&#x50a8;&#x5728; `vm.&#x24;options` &#x4e2d;&#xff0c;&#x5728; `&#x24;mount` &#x4e4b;&#x524d;&#x4f1a;&#x8c03;&#x7528; `initLifecycle(vm)` &#x65b9;&#x6cd5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"258,259"}},{"content":"<pre data-lines=\"260,277\"><code data-lines=\"260,277\">export function initLifecycle (vm: Component) {\n  const <span class=\"hljs-keyword\">options</span> = vm.<span class=\"hljs-symbol\">&#x24;</span><span class=\"hljs-keyword\">options</span>\n\n  <span class=\"hljs-comment\">// locate first non-abstract parent</span>\n  let parent = <span class=\"hljs-keyword\">options</span>.parent\n  <span class=\"hljs-keyword\">if</span> (parent &amp;&amp; !<span class=\"hljs-keyword\">options</span>.abstract) {\n    <span class=\"hljs-keyword\">while</span> (parent.<span class=\"hljs-symbol\">&#x24;</span><span class=\"hljs-keyword\">options</span>.abstract &amp;&amp; parent.<span class=\"hljs-symbol\">&#x24;</span>parent) {\n      parent = parent.<span class=\"hljs-symbol\">&#x24;</span>parent\n    }\n    parent.<span class=\"hljs-symbol\">&#x24;</span>children.push(vm)\n  }\n\n  vm.<span class=\"hljs-symbol\">&#x24;</span>parent = parent\n  <span class=\"hljs-comment\">// ...</span>\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"260,277"}},{"content":"<pre data-lines=\"278,283\"><code>&#x53ef;&#x4ee5;&#x770b;&#x5230; `vm.&#x24;parent` &#x5c31;&#x662f;&#x7528;&#x6765;&#x4fdd;&#x7559;&#x5f53;&#x524d; `vm` &#x7684;&#x7236;&#x5b9e;&#x4f8b;&#xff0c;&#x5e76;&#x4e14;&#x901a;&#x8fc7; `parent.&#x24;children.push(vm)` &#x6765;&#x628a;&#x5f53;&#x524d;&#x7684; `vm` &#x5b58;&#x50a8;&#x5230;&#x7236;&#x5b9e;&#x4f8b;&#x7684; `&#x24;children` &#x4e2d;&#x3002;\n\n&#x5728; `vm._update` &#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x628a;&#x5f53;&#x524d;&#x7684; `vm` &#x8d4b;&#x503c;&#x7ed9; `activeInstance`&#xff0c;&#x540c;&#x65f6;&#x901a;&#x8fc7; `const prevActiveInstance = activeInstance` &#x7528; `prevActiveInstance` &#x4fdd;&#x7559;&#x4e0a;&#x4e00;&#x6b21;&#x7684; `activeInstance`&#x3002;&#x5b9e;&#x9645;&#x4e0a;&#xff0c;`prevActiveInstance` &#x548c;&#x5f53;&#x524d;&#x7684; `vm` &#x662f;&#x4e00;&#x4e2a;&#x7236;&#x5b50;&#x5173;&#x7cfb;&#xff0c;&#x5f53;&#x4e00;&#x4e2a; `vm` &#x5b9e;&#x4f8b;&#x5b8c;&#x6210;&#x5b83;&#x7684;&#x6240;&#x6709;&#x5b50;&#x6811;&#x7684; patch &#x6216;&#x8005; update &#x8fc7;&#x7a0b;&#x540e;&#xff0c;`activeInstance` &#x4f1a;&#x56de;&#x5230;&#x5b83;&#x7684;&#x7236;&#x5b9e;&#x4f8b;&#xff0c;&#x8fd9;&#x6837;&#x5c31;&#x5b8c;&#x7f8e;&#x5730;&#x4fdd;&#x8bc1;&#x4e86; `createComponentInstanceForVnode` &#x6574;&#x4e2a;&#x6df1;&#x5ea6;&#x904d;&#x5386;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x6211;&#x4eec;&#x5728;&#x5b9e;&#x4f8b;&#x5316;&#x5b50;&#x7ec4;&#x4ef6;&#x7684;&#x65f6;&#x5019;&#x80fd;&#x4f20;&#x5165;&#x5f53;&#x524d;&#x5b50;&#x7ec4;&#x4ef6;&#x7684;&#x7236; Vue &#x5b9e;&#x4f8b;&#xff0c;&#x5e76;&#x5728; `_init` &#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x901a;&#x8fc7; `vm.&#x24;parent` &#x628a;&#x8fd9;&#x4e2a;&#x7236;&#x5b50;&#x5173;&#x7cfb;&#x4fdd;&#x7559;&#x3002;\n\n&#x90a3;&#x4e48;&#x56de;&#x5230; `_update`&#xff0c;&#x6700;&#x540e;&#x5c31;&#x662f;&#x8c03;&#x7528; `__patch__` &#x6e32;&#x67d3; VNode &#x4e86;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"278,283"}},{"content":"<pre data-lines=\"284,302\"><code data-lines=\"284,302\">vm.<span class=\"hljs-variable\">&#x24;el</span> = vm.<span class=\"hljs-title function_ invoke__\">__patch__</span>(vm.<span class=\"hljs-variable\">&#x24;el</span>, vnode, hydrating, <span class=\"hljs-literal\">false</span> <span class=\"hljs-comment\">/* removeOnly */</span>)\n \n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">patch</span> (<span class=\"hljs-params\">oldVnode, vnode, hydrating, removeOnly</span>) </span>{\n  <span class=\"hljs-comment\">// ...</span>\n  let isInitialPatch = <span class=\"hljs-literal\">false</span>\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">insertedVnodeQueue</span> = []\n\n  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title function_ invoke__\">isUndef</span>(oldVnode)) {\n    <span class=\"hljs-comment\">// empty mount (likely as component), create new root element</span>\n    isInitialPatch = <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-title function_ invoke__\">createElm</span>(vnode, insertedVnodeQueue)\n  } <span class=\"hljs-keyword\">else</span> {\n    <span class=\"hljs-comment\">// ...</span>\n  }\n  <span class=\"hljs-comment\">// ...</span>\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"284,302"}},{"content":"<pre data-lines=\"303,304\"><code>&#x8fd9;&#x91cc;&#x53c8;&#x56de;&#x5230;&#x4e86;&#x672c;&#x8282;&#x5f00;&#x59cb;&#x7684;&#x8fc7;&#x7a0b;&#xff0c;&#x4e4b;&#x524d;&#x5206;&#x6790;&#x8fc7;&#x8d1f;&#x8d23;&#x6e32;&#x67d3;&#x6210; DOM &#x7684;&#x51fd;&#x6570;&#x662f; `createElm`&#xff0c;&#x6ce8;&#x610f;&#x8fd9;&#x91cc;&#x6211;&#x4eec;&#x53ea;&#x4f20;&#x4e86; 2 &#x4e2a;&#x53c2;&#x6570;&#xff0c;&#x6240;&#x4ee5;&#x5bf9;&#x5e94;&#x7684; `parentElm` &#x662f; `undefined`&#x3002;&#x6211;&#x4eec;&#x518d;&#x6765;&#x770b;&#x770b;&#x5b83;&#x7684;&#x5b9a;&#x4e49;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"303,304"}},{"content":"<pre data-lines=\"305,352\"><code data-lines=\"305,352\">function createElm (\n  vnode,\n  insertedVnodeQueue,\n  parentElm,\n  refElm,\n  nested,\n  ownerArray,\n  index\n) {\n  <span class=\"hljs-comment\">// ...</span>\n  <span class=\"hljs-keyword\">if</span> (createComponent(vnode, insertedVnodeQueue, parentElm, refElm)) {\n    <span class=\"hljs-keyword\">return</span>\n  }\n\n  const <span class=\"hljs-built_in\">data</span> = vnode.<span class=\"hljs-built_in\">data</span>\n  const children = vnode.children\n  const <span class=\"hljs-built_in\">tag</span> = vnode.<span class=\"hljs-built_in\">tag</span>\n  <span class=\"hljs-keyword\">if</span> (isDef(<span class=\"hljs-built_in\">tag</span>)) {\n    <span class=\"hljs-comment\">// ...</span>\n\n    vnode.elm = vnode.ns\n      ? nodeOps.createElementNS(vnode.ns, <span class=\"hljs-built_in\">tag</span>)\n      : nodeOps.createElement(<span class=\"hljs-built_in\">tag</span>, vnode)\n    setScope(vnode)\n\n    <span class=\"hljs-comment\">/* istanbul ignore if */</span>\n    <span class=\"hljs-keyword\">if</span> (__WEEX__) {\n      <span class=\"hljs-comment\">// ...</span>\n    } <span class=\"hljs-keyword\">else</span> {\n      createChildren(vnode, children, insertedVnodeQueue)\n      <span class=\"hljs-keyword\">if</span> (isDef(<span class=\"hljs-built_in\">data</span>)) {\n        invokeCreateHooks(vnode, insertedVnodeQueue)\n      }\n      insert(parentElm, vnode.elm, refElm)\n    }\n    \n    <span class=\"hljs-comment\">// ...</span>\n  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (isTrue(vnode.isComment)) {\n    vnode.elm = nodeOps.createComment(vnode.text)\n    insert(parentElm, vnode.elm, refElm)\n  } <span class=\"hljs-keyword\">else</span> {\n    vnode.elm = nodeOps.createTextNode(vnode.text)\n    insert(parentElm, vnode.elm, refElm)\n  }\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"305,352"}},{"content":"<pre data-lines=\"353,356\"><code>&#x6ce8;&#x610f;&#xff0c;&#x8fd9;&#x91cc;&#x6211;&#x4eec;&#x4f20;&#x5165;&#x7684; `vnode` &#x662f;&#x7ec4;&#x4ef6;&#x6e32;&#x67d3;&#x7684; `vnode`&#xff0c;&#x4e5f;&#x5c31;&#x662f;&#x6211;&#x4eec;&#x4e4b;&#x524d;&#x8bf4;&#x7684; `vm._vnode`&#xff0c;&#x5982;&#x679c;&#x7ec4;&#x4ef6;&#x7684;&#x6839;&#x8282;&#x70b9;&#x662f;&#x4e2a;&#x666e;&#x901a;&#x5143;&#x7d20;&#xff0c;&#x90a3;&#x4e48; `vm._vnode` &#x4e5f;&#x662f;&#x666e;&#x901a;&#x7684; `vnode`&#xff0c;&#x8fd9;&#x91cc; `createComponent(vnode, insertedVnodeQueue, parentElm, refElm)` &#x7684;&#x8fd4;&#x56de;&#x503c;&#x662f; false&#x3002;&#x63a5;&#x4e0b;&#x6765;&#x7684;&#x8fc7;&#x7a0b;&#x5c31;&#x548c;&#x6211;&#x4eec;&#x4e0a;&#x4e00;&#x7ae0;&#x4e00;&#x6837;&#x4e86;&#xff0c;&#x5148;&#x521b;&#x5efa;&#x4e00;&#x4e2a;&#x7236;&#x8282;&#x70b9;&#x5360;&#x4f4d;&#x7b26;&#xff0c;&#x7136;&#x540e;&#x518d;&#x904d;&#x5386;&#x6240;&#x6709;&#x5b50; VNode &#x9012;&#x5f52;&#x8c03;&#x7528; `createElm`&#xff0c;&#x5728;&#x904d;&#x5386;&#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x5982;&#x679c;&#x9047;&#x5230;&#x5b50; VNode &#x662f;&#x4e00;&#x4e2a;&#x7ec4;&#x4ef6;&#x7684; VNode&#xff0c;&#x5219;&#x91cd;&#x590d;&#x672c;&#x8282;&#x5f00;&#x59cb;&#x7684;&#x8fc7;&#x7a0b;&#xff0c;&#x8fd9;&#x6837;&#x901a;&#x8fc7;&#x4e00;&#x4e2a;&#x9012;&#x5f52;&#x7684;&#x65b9;&#x5f0f;&#x5c31;&#x53ef;&#x4ee5;&#x5b8c;&#x6574;&#x5730;&#x6784;&#x5efa;&#x4e86;&#x6574;&#x4e2a;&#x7ec4;&#x4ef6;&#x6811;&#x3002;\n\n&#x7531;&#x4e8e;&#x6211;&#x4eec;&#x8fd9;&#x4e2a;&#x65f6;&#x5019;&#x4f20;&#x5165;&#x7684; `parentElm` &#x662f;&#x7a7a;&#xff0c;&#x6240;&#x4ee5;&#x5bf9;&#x7ec4;&#x4ef6;&#x7684;&#x63d2;&#x5165;&#xff0c;&#x5728; `createComponent` &#x6709;&#x8fd9;&#x4e48;&#x4e00;&#x6bb5;&#x903b;&#x8f91;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"353,356"}},{"content":"<pre data-lines=\"357,377\"><code data-lines=\"357,377\">function createComponent (vnode, insertedVnodeQueue, parentElm, refElm) {\n  let <span class=\"hljs-selector-tag\">i</span> = vnode<span class=\"hljs-selector-class\">.data</span>\n  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">isDef</span>(i)) {\n    <span class=\"hljs-comment\">// ....</span>\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">isDef</span>(<span class=\"hljs-selector-tag\">i</span> = <span class=\"hljs-selector-tag\">i</span>.hook) &amp;&amp; <span class=\"hljs-built_in\">isDef</span>(<span class=\"hljs-selector-tag\">i</span> = <span class=\"hljs-selector-tag\">i</span>.init)) {\n      <span class=\"hljs-selector-tag\">i</span>(vnode, false <span class=\"hljs-comment\">/* hydrating */</span>)\n    }\n    <span class=\"hljs-comment\">// ...</span>\n    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">isDef</span>(vnode.componentInstance)) {\n      <span class=\"hljs-built_in\">initComponent</span>(vnode, insertedVnodeQueue)\n      <span class=\"hljs-built_in\">insert</span>(parentElm, vnode<span class=\"hljs-selector-class\">.elm</span>, refElm)\n      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">isTrue</span>(isReactivated)) {\n        <span class=\"hljs-built_in\">reactivateComponent</span>(vnode, insertedVnodeQueue, parentElm, refElm)\n      }\n      return true\n    }\n  }\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"357,377"}},{"content":"<pre data-lines=\"378,379\"><code>&#x5728;&#x5b8c;&#x6210;&#x7ec4;&#x4ef6;&#x7684;&#x6574;&#x4e2a; `patch` &#x8fc7;&#x7a0b;&#x540e;&#xff0c;&#x6700;&#x540e;&#x6267;&#x884c; `insert(parentElm, vnode.elm, refElm)` &#x5b8c;&#x6210;&#x7ec4;&#x4ef6;&#x7684; DOM &#x63d2;&#x5165;&#xff0c;&#x5982;&#x679c;&#x7ec4;&#x4ef6; `patch` &#x8fc7;&#x7a0b;&#x4e2d;&#x53c8;&#x521b;&#x5efa;&#x4e86;&#x5b50;&#x7ec4;&#x4ef6;&#xff0c;&#x90a3;&#x4e48;DOM &#x7684;&#x63d2;&#x5165;&#x987a;&#x5e8f;&#x662f;&#x5148;&#x5b50;&#x540e;&#x7236;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"378,379"}}],"payload":{"tag":"h2","lines":"28,30"}},{"content":"<a href=\"#%E6%80%BB%E7%BB%93\">#</a> &#x603b;&#x7ed3;","children":[{"content":"<pre data-lines=\"383,384\"><code>&#x90a3;&#x4e48;&#x5230;&#x6b64;&#xff0c;&#x4e00;&#x4e2a;&#x7ec4;&#x4ef6;&#x7684; VNode &#x662f;&#x5982;&#x4f55;&#x521b;&#x5efa;&#x3001;&#x521d;&#x59cb;&#x5316;&#x3001;&#x6e32;&#x67d3;&#x7684;&#x8fc7;&#x7a0b;&#x4e5f;&#x5c31;&#x4ecb;&#x7ecd;&#x5b8c;&#x6bd5;&#x4e86;&#x3002;&#x5728;&#x5bf9;&#x7ec4;&#x4ef6;&#x5316;&#x7684;&#x5b9e;&#x73b0;&#x6709;&#x4e00;&#x4e2a;&#x5927;&#x6982;&#x4e86;&#x89e3;&#x540e;&#xff0c;&#x63a5;&#x4e0b;&#x6765;&#x6211;&#x4eec;&#x6765;&#x4ecb;&#x7ecd;&#x4e00;&#x4e0b;&#x8fd9;&#x5176;&#x4e2d;&#x7684;&#x4e00;&#x4e9b;&#x7ec6;&#x8282;&#x3002;&#x6211;&#x4eec;&#x77e5;&#x9053;&#x7f16;&#x5199;&#x4e00;&#x4e2a;&#x7ec4;&#x4ef6;&#x5b9e;&#x9645;&#x4e0a;&#x662f;&#x7f16;&#x5199;&#x4e00;&#x4e2a; JavaScript &#x5bf9;&#x8c61;&#xff0c;&#x5bf9;&#x8c61;&#x7684;&#x63cf;&#x8ff0;&#x5c31;&#x662f;&#x5404;&#x79cd;&#x914d;&#x7f6e;&#xff0c;&#x4e4b;&#x524d;&#x6211;&#x4eec;&#x63d0;&#x5230;&#x5728; `_init` &#x7684;&#x6700;&#x521d;&#x9636;&#x6bb5;&#x6267;&#x884c;&#x7684;&#x5c31;&#x662f; `merge options` &#x7684;&#x903b;&#x8f91;&#xff0c;&#x90a3;&#x4e48;&#x4e0b;&#x4e00;&#x8282;&#x6211;&#x4eec;&#x4ece;&#x6e90;&#x7801;&#x89d2;&#x5ea6;&#x6765;&#x5206;&#x6790;&#x5408;&#x5e76;&#x914d;&#x7f6e;&#x7684;&#x8fc7;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"383,384"}}],"payload":{"tag":"h2","lines":"380,382"}}],"payload":{"tag":"h1","lines":"0,2"}},{})</script>
</body>
</html>
