<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"<a href=\"#update\">#</a> update","children":[{"content":"&#x8ba4;&#x8bc6;","children":[{"content":"<pre data-lines=\"5,6\"><code>Vue &#x7684; `_update` &#x662f;&#x5b9e;&#x4f8b;&#x7684;&#x4e00;&#x4e2a;&#x79c1;&#x6709;&#x65b9;&#x6cd5;&#xff0c;&#x5b83;&#x88ab;&#x8c03;&#x7528;&#x7684;&#x65f6;&#x673a;&#x6709; 2 &#x4e2a;&#xff0c;&#x4e00;&#x4e2a;&#x662f;&#x9996;&#x6b21;&#x6e32;&#x67d3;&#xff0c;&#x4e00;&#x4e2a;&#x662f;&#x6570;&#x636e;&#x66f4;&#x65b0;&#x7684;&#x65f6;&#x5019;&#xff1b;&#x7531;&#x4e8e;&#x6211;&#x4eec;&#x8fd9;&#x4e00;&#x7ae0;&#x8282;&#x53ea;&#x5206;&#x6790;&#x9996;&#x6b21;&#x6e32;&#x67d3;&#x90e8;&#x5206;&#xff0c;&#x6570;&#x636e;&#x66f4;&#x65b0;&#x90e8;&#x5206;&#x4f1a;&#x5728;&#x4e4b;&#x540e;&#x5206;&#x6790;&#x54cd;&#x5e94;&#x5f0f;&#x539f;&#x7406;&#x7684;&#x65f6;&#x5019;&#x6d89;&#x53ca;&#x3002;`_update` &#x65b9;&#x6cd5;&#x7684;&#x4f5c;&#x7528;&#x662f;&#x628a; VNode &#x6e32;&#x67d3;&#x6210;&#x771f;&#x5b9e;&#x7684; DOM&#xff0c;&#x5b83;&#x7684;&#x5b9a;&#x4e49;&#x5728; `src/core/instance/lifecycle.js` &#x4e2d;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5,6"}},{"content":"<pre data-lines=\"7,40\"><code data-lines=\"7,40\">Vue.prototype._update = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">vnode: VNode, hydrating?: <span class=\"hljs-keyword\">boolean</span></span>) </span>{\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">vm</span>: Component = this\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">prevEl</span> = vm.<span class=\"hljs-variable\">&#x24;el</span>\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">prevVnode</span> = vm._vnode\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-variable constant_\">prevActiveInstance</span> = activeInstance\n  activeInstance = vm\n  vm._vnode = vnode\n  <span class=\"hljs-comment\">// Vue.prototype.__patch__ is injected in entry points</span>\n  <span class=\"hljs-comment\">// based on the rendering backend used.</span>\n  <span class=\"hljs-keyword\">if</span> (!prevVnode) {\n    <span class=\"hljs-comment\">// initial render</span>\n    vm.<span class=\"hljs-variable\">&#x24;el</span> = vm.<span class=\"hljs-title function_ invoke__\">__patch__</span>(vm.<span class=\"hljs-variable\">&#x24;el</span>, vnode, hydrating, <span class=\"hljs-literal\">false</span> <span class=\"hljs-comment\">/* removeOnly */</span>)\n  } <span class=\"hljs-keyword\">else</span> {\n    <span class=\"hljs-comment\">// updates</span>\n    vm.<span class=\"hljs-variable\">&#x24;el</span> = vm.<span class=\"hljs-title function_ invoke__\">__patch__</span>(prevVnode, vnode)\n  }\n  activeInstance = prevActiveInstance\n  <span class=\"hljs-comment\">// update __vue__ reference</span>\n  <span class=\"hljs-keyword\">if</span> (prevEl) {\n    prevEl.__vue__ = <span class=\"hljs-literal\">null</span>\n  }\n  <span class=\"hljs-keyword\">if</span> (vm.<span class=\"hljs-variable\">&#x24;el</span>) {\n    vm.<span class=\"hljs-variable\">&#x24;el</span>.__vue__ = vm\n  }\n  <span class=\"hljs-comment\">// if parent is an HOC, update its &#x24;el as well</span>\n  <span class=\"hljs-keyword\">if</span> (vm.<span class=\"hljs-variable\">&#x24;vnode</span> &amp;&amp; vm.<span class=\"hljs-variable\">&#x24;parent</span> &amp;&amp; vm.<span class=\"hljs-variable\">&#x24;vnode</span> === vm.<span class=\"hljs-variable\">&#x24;parent</span>._vnode) {\n    vm.<span class=\"hljs-variable\">&#x24;parent</span>.<span class=\"hljs-variable\">&#x24;el</span> = vm.<span class=\"hljs-variable\">&#x24;el</span>\n  }\n  <span class=\"hljs-comment\">// updated hook is called by the scheduler to ensure that children are</span>\n  <span class=\"hljs-comment\">// updated in a parent&apos;s updated hook.</span>\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"7,40"}},{"content":"<pre data-lines=\"41,42\"><code>`_update` &#x7684;&#x6838;&#x5fc3;&#x5c31;&#x662f;&#x8c03;&#x7528; `vm.__patch__` &#x65b9;&#x6cd5;&#xff0c;&#x8fd9;&#x4e2a;&#x65b9;&#x6cd5;&#x5b9e;&#x9645;&#x4e0a;&#x5728;&#x4e0d;&#x540c;&#x7684;&#x5e73;&#x53f0;&#xff0c;&#x6bd4;&#x5982; web &#x548c; weex &#x4e0a;&#x7684;&#x5b9a;&#x4e49;&#x662f;&#x4e0d;&#x4e00;&#x6837;&#x7684;&#xff0c;&#x56e0;&#x6b64;&#x5728; web &#x5e73;&#x53f0;&#x4e2d;&#x5b83;&#x7684;&#x5b9a;&#x4e49;&#x5728; `src/platforms/web/runtime/index.js` &#x4e2d;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"41,42"}},{"content":"<pre data-lines=\"43,46\"><code data-lines=\"43,46\"><span class=\"hljs-type\">Vue</span>.proto<span class=\"hljs-keyword\">type</span>.__patch__ = inBrowser ? patch : noop \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"43,46"}},{"content":"<pre data-lines=\"47,48\"><code>&#x53ef;&#x4ee5;&#x770b;&#x5230;&#xff0c;&#x751a;&#x81f3;&#x5728; web &#x5e73;&#x53f0;&#x4e0a;&#xff0c;&#x662f;&#x5426;&#x662f;&#x670d;&#x52a1;&#x7aef;&#x6e32;&#x67d3;&#x4e5f;&#x4f1a;&#x5bf9;&#x8fd9;&#x4e2a;&#x65b9;&#x6cd5;&#x4ea7;&#x751f;&#x5f71;&#x54cd;&#x3002;&#x56e0;&#x4e3a;&#x5728;&#x670d;&#x52a1;&#x7aef;&#x6e32;&#x67d3;&#x4e2d;&#xff0c;&#x6ca1;&#x6709;&#x771f;&#x5b9e;&#x7684;&#x6d4f;&#x89c8;&#x5668; DOM &#x73af;&#x5883;&#xff0c;&#x6240;&#x4ee5;&#x4e0d;&#x9700;&#x8981;&#x628a; VNode &#x6700;&#x7ec8;&#x8f6c;&#x6362;&#x6210; DOM&#xff0c;&#x56e0;&#x6b64;&#x662f;&#x4e00;&#x4e2a;&#x7a7a;&#x51fd;&#x6570;&#xff0c;&#x800c;&#x5728;&#x6d4f;&#x89c8;&#x5668;&#x7aef;&#x6e32;&#x67d3;&#x4e2d;&#xff0c;&#x5b83;&#x6307;&#x5411;&#x4e86; `patch` &#x65b9;&#x6cd5;&#xff0c;&#x5b83;&#x7684;&#x5b9a;&#x4e49;&#x5728; `src/platforms/web/runtime/patch.js`&#x4e2d;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"47,48"}},{"content":"<pre data-lines=\"49,61\"><code data-lines=\"49,61\"><span class=\"hljs-keyword\">import</span> * <span class=\"hljs-keyword\">as</span> nodeOps <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;web/runtime/node-ops&apos;</span>\n<span class=\"hljs-keyword\">import</span> { createPatchFunction } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;core/vdom/patch&apos;</span>\n<span class=\"hljs-keyword\">import</span> baseModules <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;core/vdom/modules/index&apos;</span>\n<span class=\"hljs-keyword\">import</span> platformModules <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;web/runtime/modules/index&apos;</span>\n\n<span class=\"hljs-comment\">// the directive module should be applied last, after all</span>\n<span class=\"hljs-comment\">// built-in modules have been applied.</span>\n<span class=\"hljs-keyword\">const</span> modules = platformModules.<span class=\"hljs-title function_\">concat</span>(baseModules)\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">patch</span>: <span class=\"hljs-title class_\">Function</span> = <span class=\"hljs-title function_\">createPatchFunction</span>({ nodeOps, modules }) \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"49,61"}},{"content":"<pre data-lines=\"62,63\"><code>&#x8be5;&#x65b9;&#x6cd5;&#x7684;&#x5b9a;&#x4e49;&#x662f;&#x8c03;&#x7528; `createPatchFunction` &#x65b9;&#x6cd5;&#x7684;&#x8fd4;&#x56de;&#x503c;&#xff0c;&#x8fd9;&#x91cc;&#x4f20;&#x5165;&#x4e86;&#x4e00;&#x4e2a;&#x5bf9;&#x8c61;&#xff0c;&#x5305;&#x542b; `nodeOps` &#x53c2;&#x6570;&#x548c; `modules` &#x53c2;&#x6570;&#x3002;&#x5176;&#x4e2d;&#xff0c;`nodeOps` &#x5c01;&#x88c5;&#x4e86;&#x4e00;&#x7cfb;&#x5217; DOM &#x64cd;&#x4f5c;&#x7684;&#x65b9;&#x6cd5;&#xff0c;`modules` &#x5b9a;&#x4e49;&#x4e86;&#x4e00;&#x4e9b;&#x6a21;&#x5757;&#x7684;&#x94a9;&#x5b50;&#x51fd;&#x6570;&#x7684;&#x5b9e;&#x73b0;&#xff0c;&#x6211;&#x4eec;&#x8fd9;&#x91cc;&#x5148;&#x4e0d;&#x8be6;&#x7ec6;&#x4ecb;&#x7ecd;&#xff0c;&#x6765;&#x770b;&#x4e00;&#x4e0b; `createPatchFunction` &#x7684;&#x5b9e;&#x73b0;&#xff0c;&#x5b83;&#x5b9a;&#x4e49;&#x5728; `src/core/vdom/patch.js` &#x4e2d;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"62,63"}},{"content":"<pre data-lines=\"64,189\"><code data-lines=\"64,189\"><span class=\"hljs-keyword\">const</span> hooks = [<span class=\"hljs-string\">&apos;create&apos;</span>, <span class=\"hljs-string\">&apos;activate&apos;</span>, <span class=\"hljs-string\">&apos;update&apos;</span>, <span class=\"hljs-string\">&apos;remove&apos;</span>, <span class=\"hljs-string\">&apos;destroy&apos;</span>]\n\n<span class=\"hljs-function\">export function <span class=\"hljs-title\">createPatchFunction</span> (<span class=\"hljs-params\">backend</span>)</span> {\n  <span class=\"hljs-keyword\">let</span> i, j\n  <span class=\"hljs-keyword\">const</span> cbs = {}\n\n  <span class=\"hljs-keyword\">const</span> { modules, nodeOps } = <span class=\"hljs-function\">backend\n\n  <span class=\"hljs-title\">for</span> (<span class=\"hljs-params\">i = <span class=\"hljs-number\">0</span>; i &lt; hooks.length; ++i</span>)</span> {\n    cbs[hooks[i]] = []\n    <span class=\"hljs-keyword\">for</span> (j = <span class=\"hljs-number\">0</span>; j &lt; modules.length; ++j) {\n      <span class=\"hljs-keyword\">if</span> (isDef(modules[j][hooks[i]])) {\n        cbs[hooks[i]].push(modules[j][hooks[i]])\n      }\n    }\n  }\n\n  <span class=\"hljs-comment\">// ...</span>\n\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\">function <span class=\"hljs-title\">patch</span> (<span class=\"hljs-params\">oldVnode, vnode, hydrating, removeOnly</span>)</span> {\n    <span class=\"hljs-keyword\">if</span> (isUndef(vnode)) {\n      <span class=\"hljs-keyword\">if</span> (isDef(oldVnode)) invokeDestroyHook(oldVnode)\n      <span class=\"hljs-keyword\">return</span>\n    }\n\n    <span class=\"hljs-keyword\">let</span> isInitialPatch = <span class=\"hljs-literal\">false</span>\n    <span class=\"hljs-keyword\">const</span> insertedVnodeQueue = []\n\n    <span class=\"hljs-keyword\">if</span> (isUndef(oldVnode)) {\n      <span class=\"hljs-comment\">// empty mount (likely as component), create new root element</span>\n      isInitialPatch = <span class=\"hljs-function\"><span class=\"hljs-literal\">true</span>\n      <span class=\"hljs-title\">createElm</span>(<span class=\"hljs-params\">vnode, insertedVnodeQueue</span>)\n    } <span class=\"hljs-keyword\">else</span></span> {\n      <span class=\"hljs-keyword\">const</span> isRealElement = isDef(oldVnode.nodeType)\n      <span class=\"hljs-keyword\">if</span> (!isRealElement &amp;&amp; sameVnode(oldVnode, vnode)) {\n        <span class=\"hljs-comment\">// patch existing root node</span>\n        patchVnode(oldVnode, vnode, insertedVnodeQueue, removeOnly)\n      } <span class=\"hljs-keyword\">else</span> {\n        <span class=\"hljs-keyword\">if</span> (isRealElement) {\n          <span class=\"hljs-comment\">// mounting to a real element</span>\n          <span class=\"hljs-comment\">// check if this is server-rendered content and if we can perform</span>\n          <span class=\"hljs-comment\">// a successful hydration.</span>\n          <span class=\"hljs-keyword\">if</span> (oldVnode.nodeType === <span class=\"hljs-number\">1</span> &amp;&amp; oldVnode.hasAttribute(SSR_ATTR)) {\n            oldVnode.removeAttribute(SSR_ATTR)\n            hydrating = <span class=\"hljs-literal\">true</span>\n          }\n          <span class=\"hljs-keyword\">if</span> (isTrue(hydrating)) {\n            <span class=\"hljs-keyword\">if</span> (hydrate(oldVnode, vnode, insertedVnodeQueue)) {\n              invokeInsertHook(vnode, insertedVnodeQueue, <span class=\"hljs-literal\">true</span>)\n              <span class=\"hljs-keyword\">return</span> oldVnode\n            } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (process.env.NODE_ENV !== <span class=\"hljs-string\">&apos;production&apos;</span>) {\n              warn(\n                <span class=\"hljs-string\">&apos;The client-side rendered virtual DOM tree is not matching &apos;</span> +\n                <span class=\"hljs-string\">&apos;server-rendered content. This is likely caused by incorrect &apos;</span> +\n                <span class=\"hljs-string\">&apos;HTML markup, for example nesting block-level elements inside &apos;</span> +\n                <span class=\"hljs-string\">&apos;&lt;p&gt;, or missing &lt;tbody&gt;. Bailing hydration and performing &apos;</span> +\n                <span class=\"hljs-string\">&apos;full client-side render.&apos;</span>\n              )\n            }\n          }\n          <span class=\"hljs-comment\">// either not server-rendered, or hydration failed.</span>\n          <span class=\"hljs-comment\">// create an empty node and replace it</span>\n          oldVnode = emptyNodeAt(oldVnode)\n        }\n\n        <span class=\"hljs-comment\">// replacing existing element</span>\n        <span class=\"hljs-keyword\">const</span> oldElm = oldVnode.elm\n        <span class=\"hljs-keyword\">const</span> parentElm = nodeOps.parentNode(oldElm)\n\n        <span class=\"hljs-comment\">// create new node</span>\n        createElm(\n          vnode,\n          insertedVnodeQueue,\n          <span class=\"hljs-comment\">// extremely rare edge case: do not insert if old element is in a</span>\n          <span class=\"hljs-comment\">// leaving transition. Only happens when combining transition +</span>\n          <span class=\"hljs-comment\">// keep-alive + HOCs. (#4590)</span>\n          oldElm._leaveCb ? <span class=\"hljs-literal\">null</span> : parentElm,\n          nodeOps.nextSibling(oldElm)\n        )\n\n        <span class=\"hljs-comment\">// update parent placeholder node element, recursively</span>\n        <span class=\"hljs-keyword\">if</span> (isDef(vnode.parent)) {\n          <span class=\"hljs-keyword\">let</span> ancestor = vnode.parent\n          <span class=\"hljs-keyword\">const</span> patchable = isPatchable(vnode)\n          <span class=\"hljs-keyword\">while</span> (ancestor) {\n            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; cbs.destroy.length; ++i) {\n              cbs.destroy[i](ancestor)\n            }\n            ancestor.elm = vnode.<span class=\"hljs-function\">elm\n            <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">patchable</span>)</span> {\n              <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; cbs.create.length; ++i) {\n                cbs.create[i](emptyNode, ancestor)\n              }\n              <span class=\"hljs-comment\">// #6513</span>\n              <span class=\"hljs-comment\">// invoke insert hooks that may have been merged by create hooks.</span>\n              <span class=\"hljs-comment\">// e.g. for directives that uses the &quot;inserted&quot; hook.</span>\n              <span class=\"hljs-keyword\">const</span> insert = ancestor.data.hook.<span class=\"hljs-function\">insert\n              <span class=\"hljs-title\">if</span> (<span class=\"hljs-params\">insert.merged</span>)</span> {\n                <span class=\"hljs-comment\">// start at index 1 to avoid re-invoking component mounted hook</span>\n                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">1</span>; i &lt; insert.fns.length; i++) {\n                  insert.fns[i]()\n                }\n              }\n            } <span class=\"hljs-keyword\">else</span> {\n              registerRef(ancestor)\n            }\n            ancestor = ancestor.parent\n          }\n        }\n\n        <span class=\"hljs-comment\">// destroy old node</span>\n        <span class=\"hljs-keyword\">if</span> (isDef(parentElm)) {\n          removeVnodes(parentElm, [oldVnode], <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>)\n        } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (isDef(oldVnode.tag)) {\n          invokeDestroyHook(oldVnode)\n        }\n      }\n    }\n\n    invokeInsertHook(vnode, insertedVnodeQueue, isInitialPatch)\n    <span class=\"hljs-keyword\">return</span> vnode.elm\n  }\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"64,189"}},{"content":"<pre data-lines=\"190,203\"><code>`createPatchFunction` &#x5185;&#x90e8;&#x5b9a;&#x4e49;&#x4e86;&#x4e00;&#x7cfb;&#x5217;&#x7684;&#x8f85;&#x52a9;&#x65b9;&#x6cd5;&#xff0c;&#x6700;&#x7ec8;&#x8fd4;&#x56de;&#x4e86;&#x4e00;&#x4e2a; `patch` &#x65b9;&#x6cd5;&#xff0c;&#x8fd9;&#x4e2a;&#x65b9;&#x6cd5;&#x5c31;&#x8d4b;&#x503c;&#x7ed9;&#x4e86; `vm._update` &#x51fd;&#x6570;&#x91cc;&#x8c03;&#x7528;&#x7684; `vm.__patch__`&#x3002;\n\n&#x5728;&#x4ecb;&#x7ecd; `patch` &#x7684;&#x65b9;&#x6cd5;&#x5b9e;&#x73b0;&#x4e4b;&#x524d;&#xff0c;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x601d;&#x8003;&#x4e00;&#x4e0b;&#x4e3a;&#x4f55; Vue.js &#x6e90;&#x7801;&#x7ed5;&#x4e86;&#x8fd9;&#x4e48;&#x4e00;&#x5927;&#x5708;&#xff0c;&#x628a;&#x76f8;&#x5173;&#x4ee3;&#x7801;&#x5206;&#x6563;&#x5230;&#x5404;&#x4e2a;&#x76ee;&#x5f55;&#x3002;&#x56e0;&#x4e3a;&#x524d;&#x9762;&#x4ecb;&#x7ecd;&#x8fc7;&#xff0c;`patch` &#x662f;&#x5e73;&#x53f0;&#x76f8;&#x5173;&#x7684;&#xff0c;&#x5728; Web &#x548c; Weex &#x73af;&#x5883;&#xff0c;&#x5b83;&#x4eec;&#x628a;&#x865a;&#x62df; DOM &#x6620;&#x5c04;&#x5230; &#x201c;&#x5e73;&#x53f0; DOM&#x201d; &#x7684;&#x65b9;&#x6cd5;&#x662f;&#x4e0d;&#x540c;&#x7684;&#xff0c;&#x5e76;&#x4e14;&#x5bf9; &#x201c;DOM&#x201d; &#x5305;&#x62ec;&#x7684;&#x5c5e;&#x6027;&#x6a21;&#x5757;&#x521b;&#x5efa;&#x548c;&#x66f4;&#x65b0;&#x4e5f;&#x4e0d;&#x5c3d;&#x76f8;&#x540c;&#x3002;&#x56e0;&#x6b64;&#x6bcf;&#x4e2a;&#x5e73;&#x53f0;&#x90fd;&#x6709;&#x5404;&#x81ea;&#x7684; `nodeOps` &#x548c; `modules`&#xff0c;&#x5b83;&#x4eec;&#x7684;&#x4ee3;&#x7801;&#x9700;&#x8981;&#x6258;&#x7ba1;&#x5728; `src/platforms` &#x8fd9;&#x4e2a;&#x5927;&#x76ee;&#x5f55;&#x4e0b;&#x3002;\n\n&#x800c;&#x4e0d;&#x540c;&#x5e73;&#x53f0;&#x7684; `patch` &#x7684;&#x4e3b;&#x8981;&#x903b;&#x8f91;&#x90e8;&#x5206;&#x662f;&#x76f8;&#x540c;&#x7684;&#xff0c;&#x6240;&#x4ee5;&#x8fd9;&#x90e8;&#x5206;&#x516c;&#x5171;&#x7684;&#x90e8;&#x5206;&#x6258;&#x7ba1;&#x5728; `core` &#x8fd9;&#x4e2a;&#x5927;&#x76ee;&#x5f55;&#x4e0b;&#x3002;&#x5dee;&#x5f02;&#x5316;&#x90e8;&#x5206;&#x53ea;&#x9700;&#x8981;&#x901a;&#x8fc7;&#x53c2;&#x6570;&#x6765;&#x533a;&#x522b;&#xff0c;&#x8fd9;&#x91cc;&#x7528;&#x5230;&#x4e86;&#x4e00;&#x4e2a;&#x51fd;&#x6570;&#x67ef;&#x91cc;&#x5316;&#x7684;&#x6280;&#x5de7;&#xff0c;&#x901a;&#x8fc7; `createPatchFunction` &#x628a;&#x5dee;&#x5f02;&#x5316;&#x53c2;&#x6570;&#x63d0;&#x524d;&#x56fa;&#x5316;&#xff0c;&#x8fd9;&#x6837;&#x4e0d;&#x7528;&#x6bcf;&#x6b21;&#x8c03;&#x7528; `patch` &#x7684;&#x65f6;&#x5019;&#x90fd;&#x4f20;&#x9012; `nodeOps` &#x548c; `modules` &#x4e86;&#xff0c;&#x8fd9;&#x79cd;&#x7f16;&#x7a0b;&#x6280;&#x5de7;&#x4e5f;&#x975e;&#x5e38;&#x503c;&#x5f97;&#x5b66;&#x4e60;&#x3002;\n\n&#x5728;&#x8fd9;&#x91cc;&#xff0c;`nodeOps` &#x8868;&#x793a;&#x5bf9; &#x201c;&#x5e73;&#x53f0; DOM&#x201d; &#x7684;&#x4e00;&#x4e9b;&#x64cd;&#x4f5c;&#x65b9;&#x6cd5;&#xff0c;`modules` &#x8868;&#x793a;&#x5e73;&#x53f0;&#x7684;&#x4e00;&#x4e9b;&#x6a21;&#x5757;&#xff0c;&#x5b83;&#x4eec;&#x4f1a;&#x5728;&#x6574;&#x4e2a; `patch` &#x8fc7;&#x7a0b;&#x7684;&#x4e0d;&#x540c;&#x9636;&#x6bb5;&#x6267;&#x884c;&#x76f8;&#x5e94;&#x7684;&#x94a9;&#x5b50;&#x51fd;&#x6570;&#x3002;&#x8fd9;&#x4e9b;&#x4ee3;&#x7801;&#x7684;&#x5177;&#x4f53;&#x5b9e;&#x73b0;&#x4f1a;&#x5728;&#x4e4b;&#x540e;&#x7684;&#x7ae0;&#x8282;&#x4ecb;&#x7ecd;&#x3002;\n\n&#x56de;&#x5230; `patch` &#x65b9;&#x6cd5;&#x672c;&#x8eab;&#xff0c;&#x5b83;&#x63a5;&#x6536; 4&#x4e2a;&#x53c2;&#x6570;&#xff0c;`oldVnode` &#x8868;&#x793a;&#x65e7;&#x7684; VNode &#x8282;&#x70b9;&#xff0c;&#x5b83;&#x4e5f;&#x53ef;&#x4ee5;&#x4e0d;&#x5b58;&#x5728;&#x6216;&#x8005;&#x662f;&#x4e00;&#x4e2a; DOM &#x5bf9;&#x8c61;&#xff1b;`vnode` &#x8868;&#x793a;&#x6267;&#x884c; `_render` &#x540e;&#x8fd4;&#x56de;&#x7684; VNode &#x7684;&#x8282;&#x70b9;&#xff1b;`hydrating` &#x8868;&#x793a;&#x662f;&#x5426;&#x662f;&#x670d;&#x52a1;&#x7aef;&#x6e32;&#x67d3;&#xff1b;`removeOnly` &#x662f;&#x7ed9; `transition-group` &#x7528;&#x7684;&#xff0c;&#x4e4b;&#x540e;&#x4f1a;&#x4ecb;&#x7ecd;&#x3002;\n\n`patch` &#x7684;&#x903b;&#x8f91;&#x770b;&#x4e0a;&#x53bb;&#x76f8;&#x5bf9;&#x590d;&#x6742;&#xff0c;&#x56e0;&#x4e3a;&#x5b83;&#x6709;&#x7740;&#x975e;&#x5e38;&#x591a;&#x7684;&#x5206;&#x652f;&#x903b;&#x8f91;&#xff0c;&#x4e3a;&#x4e86;&#x65b9;&#x4fbf;&#x7406;&#x89e3;&#xff0c;&#x6211;&#x4eec;&#x5e76;&#x4e0d;&#x4f1a;&#x5728;&#x8fd9;&#x91cc;&#x4ecb;&#x7ecd;&#x6240;&#x6709;&#x7684;&#x903b;&#x8f91;&#xff0c;&#x4ec5;&#x4f1a;&#x9488;&#x5bf9;&#x6211;&#x4eec;&#x4e4b;&#x524d;&#x7684;&#x4f8b;&#x5b50;&#x5206;&#x6790;&#x5b83;&#x7684;&#x6267;&#x884c;&#x903b;&#x8f91;&#x3002;&#x4e4b;&#x540e;&#x6211;&#x4eec;&#x5bf9;&#x5176;&#x5b83;&#x573a;&#x666f;&#x505a;&#x6e90;&#x7801;&#x5206;&#x6790;&#x7684;&#x65f6;&#x5019;&#x4f1a;&#x518d;&#x6b21;&#x56de;&#x987e; `patch` &#x65b9;&#x6cd5;&#x3002;\n\n&#x5148;&#x6765;&#x56de;&#x987e;&#x6211;&#x4eec;&#x7684;&#x4f8b;&#x5b50;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"190,203"}},{"content":"<pre data-lines=\"204,219\"><code data-lines=\"204,219\"><span class=\"hljs-keyword\">var</span> app = <span class=\"hljs-keyword\">new</span> Vue({\n  el: <span class=\"hljs-string\">&apos;#app&apos;</span>,\n  render: <span class=\"hljs-keyword\">function</span> (createElement) {\n    <span class=\"hljs-keyword\">return</span> createElement(<span class=\"hljs-string\">&apos;div&apos;</span>, {\n      attrs: {\n        <span class=\"hljs-variable language_\">id</span>: <span class=\"hljs-string\">&apos;app&apos;</span>\n      },\n    }, this.<span class=\"hljs-variable language_\">message</span>)\n  },\n  data: {\n    <span class=\"hljs-variable language_\">message</span>: <span class=\"hljs-string\">&apos;Hello Vue!&apos;</span>\n  }\n}) \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"204,219"}},{"content":"<pre data-lines=\"220,221\"><code>&#x7136;&#x540e;&#x6211;&#x4eec;&#x5728; `vm._update` &#x7684;&#x65b9;&#x6cd5;&#x91cc;&#x662f;&#x8fd9;&#x4e48;&#x8c03;&#x7528; `patch` &#x65b9;&#x6cd5;&#x7684;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"220,221"}},{"content":"<pre data-lines=\"222,226\"><code data-lines=\"222,226\"><span class=\"hljs-comment\">// initial render</span>\nvm.<span class=\"hljs-variable\">&#x24;el</span> = vm<span class=\"hljs-number\">.__</span>patch__(vm.<span class=\"hljs-variable\">&#x24;el</span>, vnode, hydrating, <span class=\"hljs-literal\">false</span> <span class=\"hljs-comment\">/* removeOnly */</span>) \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"222,226"}},{"content":"<pre data-lines=\"227,230\"><code>&#x7ed3;&#x5408;&#x6211;&#x4eec;&#x7684;&#x4f8b;&#x5b50;&#xff0c;&#x6211;&#x4eec;&#x7684;&#x573a;&#x666f;&#x662f;&#x9996;&#x6b21;&#x6e32;&#x67d3;&#xff0c;&#x6240;&#x4ee5;&#x5728;&#x6267;&#x884c; `patch` &#x51fd;&#x6570;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4f20;&#x5165;&#x7684; `vm.&#x24;el` &#x5bf9;&#x5e94;&#x7684;&#x662f;&#x4f8b;&#x5b50;&#x4e2d; id &#x4e3a; `app` &#x7684; DOM &#x5bf9;&#x8c61;&#xff0c;&#x8fd9;&#x4e2a;&#x4e5f;&#x5c31;&#x662f;&#x6211;&#x4eec;&#x5728; index.html &#x6a21;&#x677f;&#x4e2d;&#x5199;&#x7684; `&lt;div id=&quot;app&quot;&gt;`&#xff0c; `vm.&#x24;el` &#x7684;&#x8d4b;&#x503c;&#x662f;&#x5728;&#x4e4b;&#x524d; `mountComponent` &#x51fd;&#x6570;&#x505a;&#x7684;&#xff0c;`vnode` &#x5bf9;&#x5e94;&#x7684;&#x662f;&#x8c03;&#x7528; `render` &#x51fd;&#x6570;&#x7684;&#x8fd4;&#x56de;&#x503c;&#xff0c;`hydrating` &#x5728;&#x975e;&#x670d;&#x52a1;&#x7aef;&#x6e32;&#x67d3;&#x60c5;&#x51b5;&#x4e0b;&#x4e3a; false&#xff0c;`removeOnly` &#x4e3a; false&#x3002;\n\n&#x786e;&#x5b9a;&#x4e86;&#x8fd9;&#x4e9b;&#x5165;&#x53c2;&#x540e;&#xff0c;&#x6211;&#x4eec;&#x56de;&#x5230; `patch` &#x51fd;&#x6570;&#x7684;&#x6267;&#x884c;&#x8fc7;&#x7a0b;&#xff0c;&#x770b;&#x51e0;&#x4e2a;&#x5173;&#x952e;&#x6b65;&#x9aa4;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"227,230"}},{"content":"<pre data-lines=\"231,280\"><code data-lines=\"231,280\">const isRealElement = isDef(oldVnode.nodeType)\n<span class=\"hljs-keyword\">if</span> (!isRealElement &amp;&amp; sameVnode(oldVnode, vnode)) {\n  // patch existing root node\n  patchVnode(oldVnode, vnode, insertedVnodeQueue, removeOnly)\n} <span class=\"hljs-keyword\">else</span> {\n  <span class=\"hljs-keyword\">if</span> (isRealElement) {\n    // mounting <span class=\"hljs-keyword\">to</span> a <span class=\"hljs-type\">real</span> element\n    // <span class=\"hljs-keyword\">check</span> <span class=\"hljs-keyword\">if</span> this <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">server</span>-rendered content <span class=\"hljs-keyword\">and</span> <span class=\"hljs-keyword\">if</span> we can <span class=\"hljs-keyword\">perform</span>\n    // a successful hydration.\n    <span class=\"hljs-keyword\">if</span> (oldVnode.nodeType === <span class=\"hljs-number\">1</span> &amp;&amp; oldVnode.hasAttribute(SSR_ATTR)) {\n      oldVnode.removeAttribute(SSR_ATTR)\n      hydrating = <span class=\"hljs-keyword\">true</span>\n    }\n    <span class=\"hljs-keyword\">if</span> (isTrue(hydrating)) {\n      <span class=\"hljs-keyword\">if</span> (hydrate(oldVnode, vnode, insertedVnodeQueue)) {\n        invokeInsertHook(vnode, insertedVnodeQueue, <span class=\"hljs-keyword\">true</span>)\n        <span class=\"hljs-keyword\">return</span> oldVnode\n      } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (process.env.NODE_ENV !== <span class=\"hljs-string\">&apos;production&apos;</span>) {\n        warn(\n          <span class=\"hljs-string\">&apos;The client-side rendered virtual DOM tree is not matching &apos;</span> +\n          <span class=\"hljs-string\">&apos;server-rendered content. This is likely caused by incorrect &apos;</span> +\n          <span class=\"hljs-string\">&apos;HTML markup, for example nesting block-level elements inside &apos;</span> +\n          <span class=\"hljs-string\">&apos;&lt;p&gt;, or missing &lt;tbody&gt;. Bailing hydration and performing &apos;</span> +\n          <span class=\"hljs-string\">&apos;full client-side render.&apos;</span>\n        )\n      }\n    }      \n    // either <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">server</span>-rendered, <span class=\"hljs-keyword\">or</span> hydration failed.\n    // <span class=\"hljs-keyword\">create</span> an empty node <span class=\"hljs-keyword\">and</span> replace it\n    oldVnode = emptyNodeAt(oldVnode)\n  }\n\n  // replacing existing element\n  const oldElm = oldVnode.elm\n  const parentElm = nodeOps.parentNode(oldElm)\n\n  // <span class=\"hljs-keyword\">create</span> <span class=\"hljs-built_in\">new</span> node\n  createElm(\n    vnode,\n    insertedVnodeQueue,\n    // extremely rare edge <span class=\"hljs-keyword\">case</span>: <span class=\"hljs-keyword\">do</span> <span class=\"hljs-keyword\">not</span> <span class=\"hljs-keyword\">insert</span> <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">old</span> element <span class=\"hljs-keyword\">is</span> <span class=\"hljs-keyword\">in</span> a\n    // leaving transition. <span class=\"hljs-keyword\">Only</span> happens <span class=\"hljs-keyword\">when</span> combining transition +\n    // keep-alive + HOCs. (#<span class=\"hljs-number\">4590</span>)\n    oldElm._leaveCb ? <span class=\"hljs-keyword\">null</span> : parentElm,\n    nodeOps.nextSibling(oldElm)\n  )\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"231,280"}},{"content":"<pre data-lines=\"281,282\"><code>&#x7531;&#x4e8e;&#x6211;&#x4eec;&#x4f20;&#x5165;&#x7684; `oldVnode` &#x5b9e;&#x9645;&#x4e0a;&#x662f;&#x4e00;&#x4e2a; DOM container&#xff0c;&#x6240;&#x4ee5; `isRealElement` &#x4e3a; true&#xff0c;&#x63a5;&#x4e0b;&#x6765;&#x53c8;&#x901a;&#x8fc7; `emptyNodeAt` &#x65b9;&#x6cd5;&#x628a; `oldVnode` &#x8f6c;&#x6362;&#x6210; `VNode` &#x5bf9;&#x8c61;&#xff0c;&#x7136;&#x540e;&#x518d;&#x8c03;&#x7528; `createElm` &#x65b9;&#x6cd5;&#xff0c;&#x8fd9;&#x4e2a;&#x65b9;&#x6cd5;&#x5728;&#x8fd9;&#x91cc;&#x975e;&#x5e38;&#x91cd;&#x8981;&#xff0c;&#x6765;&#x770b;&#x4e00;&#x4e0b;&#x5b83;&#x7684;&#x5b9e;&#x73b0;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"281,282"}},{"content":"<pre data-lines=\"283,353\"><code data-lines=\"283,353\">function createElm (\n  vnode,\n  insertedVnodeQueue,\n  parentElm,\n  refElm,\n  nested,\n  ownerArray,\n  index\n) {\n  <span class=\"hljs-keyword\">if</span> (isDef(vnode.elm) &amp;&amp; isDef(ownerArray)) {\n    <span class=\"hljs-comment\">// This vnode was used in a previous render!</span>\n    <span class=\"hljs-comment\">// now it&apos;s used as a new node, overwriting its elm would cause</span>\n    <span class=\"hljs-comment\">// potential patch errors down the road when it&apos;s used as an insertion</span>\n    <span class=\"hljs-comment\">// reference node. Instead, we clone the node on-demand before creating</span>\n    <span class=\"hljs-comment\">// associated DOM element for it.</span>\n    vnode = ownerArray[index] = cloneVNode(vnode)\n  }\n\n  vnode.isRootInsert = !nested <span class=\"hljs-comment\">// for transition enter check</span>\n  <span class=\"hljs-keyword\">if</span> (createComponent(vnode, insertedVnodeQueue, parentElm, refElm)) {\n    <span class=\"hljs-keyword\">return</span>\n  }\n\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">data</span> = vnode.<span class=\"hljs-keyword\">data</span>\n  <span class=\"hljs-keyword\">const</span> children = vnode.children\n  <span class=\"hljs-keyword\">const</span> tag = vnode.tag\n  <span class=\"hljs-keyword\">if</span> (isDef(tag)) {\n    <span class=\"hljs-keyword\">if</span> (process.env.NODE_ENV !== <span class=\"hljs-string\">&apos;production&apos;</span>) {\n      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">data</span> &amp;&amp; <span class=\"hljs-keyword\">data</span>.pre) {\n        creatingElmInVPre++\n      }\n      <span class=\"hljs-keyword\">if</span> (isUnknownElement(vnode, creatingElmInVPre)) {\n        warn(\n          <span class=\"hljs-string\">&apos;Unknown custom element: &lt;&apos;</span> + tag + <span class=\"hljs-string\">&apos;&gt; - did you &apos;</span> +\n          <span class=\"hljs-string\">&apos;register the component correctly? For recursive components, &apos;</span> +\n          <span class=\"hljs-string\">&apos;make sure to provide the &quot;name&quot; option.&apos;</span>,\n          vnode.context\n        )\n      }\n    }\n\n    vnode.elm = vnode.ns\n      ? nodeOps.createElementNS(vnode.ns, tag)\n      : nodeOps.createElement(tag, vnode)\n    setScope(vnode)\n\n    <span class=\"hljs-comment\">/* istanbul ignore if */</span>\n    <span class=\"hljs-keyword\">if</span> (__WEEX__) {\n      <span class=\"hljs-comment\">// ...</span>\n    } <span class=\"hljs-keyword\">else</span> {\n      createChildren(vnode, children, insertedVnodeQueue)\n      <span class=\"hljs-keyword\">if</span> (isDef(<span class=\"hljs-keyword\">data</span>)) {\n        invokeCreateHooks(vnode, insertedVnodeQueue)\n      }\n      insert(parentElm, vnode.elm, refElm)\n    }\n\n    <span class=\"hljs-keyword\">if</span> (process.env.NODE_ENV !== <span class=\"hljs-string\">&apos;production&apos;</span> &amp;&amp; <span class=\"hljs-keyword\">data</span> &amp;&amp; <span class=\"hljs-keyword\">data</span>.pre) {\n      creatingElmInVPre--\n    }\n  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (isTrue(vnode.isComment)) {\n    vnode.elm = nodeOps.createComment(vnode.text)\n    insert(parentElm, vnode.elm, refElm)\n  } <span class=\"hljs-keyword\">else</span> {\n    vnode.elm = nodeOps.createTextNode(vnode.text)\n    insert(parentElm, vnode.elm, refElm)\n  }\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"283,353"}},{"content":"<pre data-lines=\"354,355\"><code>`createElm` &#x7684;&#x4f5c;&#x7528;&#x662f;&#x901a;&#x8fc7;&#x865a;&#x62df;&#x8282;&#x70b9;&#x521b;&#x5efa;&#x771f;&#x5b9e;&#x7684; DOM &#x5e76;&#x63d2;&#x5165;&#x5230;&#x5b83;&#x7684;&#x7236;&#x8282;&#x70b9;&#x4e2d;&#x3002; &#x6211;&#x4eec;&#x6765;&#x770b;&#x4e00;&#x4e0b;&#x5b83;&#x7684;&#x4e00;&#x4e9b;&#x5173;&#x952e;&#x903b;&#x8f91;&#xff0c;`createComponent` &#x65b9;&#x6cd5;&#x76ee;&#x7684;&#x662f;&#x5c1d;&#x8bd5;&#x521b;&#x5efa;&#x5b50;&#x7ec4;&#x4ef6;&#xff0c;&#x8fd9;&#x4e2a;&#x903b;&#x8f91;&#x5728;&#x4e4b;&#x540e;&#x7ec4;&#x4ef6;&#x7684;&#x7ae0;&#x8282;&#x4f1a;&#x8be6;&#x7ec6;&#x4ecb;&#x7ecd;&#xff0c;&#x5728;&#x5f53;&#x524d;&#x8fd9;&#x4e2a; case &#x4e0b;&#x5b83;&#x7684;&#x8fd4;&#x56de;&#x503c;&#x4e3a; false&#xff1b;&#x63a5;&#x4e0b;&#x6765;&#x5224;&#x65ad; `vnode` &#x662f;&#x5426;&#x5305;&#x542b; tag&#xff0c;&#x5982;&#x679c;&#x5305;&#x542b;&#xff0c;&#x5148;&#x7b80;&#x5355;&#x5bf9; tag &#x7684;&#x5408;&#x6cd5;&#x6027;&#x5728;&#x975e;&#x751f;&#x4ea7;&#x73af;&#x5883;&#x4e0b;&#x505a;&#x6821;&#x9a8c;&#xff0c;&#x770b;&#x662f;&#x5426;&#x662f;&#x4e00;&#x4e2a;&#x5408;&#x6cd5;&#x6807;&#x7b7e;&#xff1b;&#x7136;&#x540e;&#x518d;&#x53bb;&#x8c03;&#x7528;&#x5e73;&#x53f0; DOM &#x7684;&#x64cd;&#x4f5c;&#x53bb;&#x521b;&#x5efa;&#x4e00;&#x4e2a;&#x5360;&#x4f4d;&#x7b26;&#x5143;&#x7d20;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"354,355"}},{"content":"<pre data-lines=\"356,361\"><code data-lines=\"356,361\">vnode.elm = vnode.ns\n  ? nodeOps.createElementNS(vnode.ns, <span class=\"hljs-keyword\">tag</span>)\n  : nodeOps.createElement(<span class=\"hljs-keyword\">tag</span>, vnode) \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"356,361"}},{"content":"<pre data-lines=\"362,363\"><code>&#x63a5;&#x4e0b;&#x6765;&#x8c03;&#x7528; `createChildren` &#x65b9;&#x6cd5;&#x53bb;&#x521b;&#x5efa;&#x5b50;&#x5143;&#x7d20;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"362,363"}},{"content":"<pre data-lines=\"364,380\"><code data-lines=\"364,380\">createChildren(vnode, <span class=\"hljs-built_in\">children</span>, insertedVnodeQueue)\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">createChildren</span> <span class=\"hljs-params\">(vnode, children, insertedVnodeQueue)</span> {</span>\n  <span class=\"hljs-keyword\">if</span> (Array.isArray(<span class=\"hljs-built_in\">children</span>)) {\n    <span class=\"hljs-keyword\">if</span> (process.env.NODE_ENV !== &apos;production&apos;) {\n      checkDuplicateKeys(<span class=\"hljs-built_in\">children</span>)\n    }\n    <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-built_in\">let</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-built_in\">children</span>.length; ++i) {\n      createElm(<span class=\"hljs-built_in\">children</span>[i], insertedVnodeQueue, vnode.elm, null, <span class=\"hljs-literal\">true</span>, <span class=\"hljs-built_in\">children</span>, i)\n    }\n  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (isPrimitive(vnode.<span class=\"hljs-built_in\">text</span>)) {\n    nodeOps.appendChild(vnode.elm, nodeOps.createTextNode(String(vnode.<span class=\"hljs-built_in\">text</span>)))\n  }\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"364,380"}},{"content":"<pre data-lines=\"381,384\"><code>`createChildren` &#x7684;&#x903b;&#x8f91;&#x5f88;&#x7b80;&#x5355;&#xff0c;&#x5b9e;&#x9645;&#x4e0a;&#x662f;&#x904d;&#x5386;&#x5b50;&#x865a;&#x62df;&#x8282;&#x70b9;&#xff0c;&#x9012;&#x5f52;&#x8c03;&#x7528; `createElm`&#xff0c;&#x8fd9;&#x662f;&#x4e00;&#x79cd;&#x5e38;&#x7528;&#x7684;&#x6df1;&#x5ea6;&#x4f18;&#x5148;&#x7684;&#x904d;&#x5386;&#x7b97;&#x6cd5;&#xff0c;&#x8fd9;&#x91cc;&#x8981;&#x6ce8;&#x610f;&#x7684;&#x4e00;&#x70b9;&#x662f;&#x5728;&#x904d;&#x5386;&#x8fc7;&#x7a0b;&#x4e2d;&#x4f1a;&#x628a; `vnode.elm` &#x4f5c;&#x4e3a;&#x7236;&#x5bb9;&#x5668;&#x7684; DOM &#x8282;&#x70b9;&#x5360;&#x4f4d;&#x7b26;&#x4f20;&#x5165;&#x3002;\n\n&#x63a5;&#x7740;&#x518d;&#x8c03;&#x7528; `invokeCreateHooks` &#x65b9;&#x6cd5;&#x6267;&#x884c;&#x6240;&#x6709;&#x7684; create &#x7684;&#x94a9;&#x5b50;&#x5e76;&#x628a; `vnode` push &#x5230; `insertedVnodeQueue` &#x4e2d;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"381,384"}},{"content":"<pre data-lines=\"385,401\"><code data-lines=\"385,401\"> <span class=\"hljs-keyword\">if</span> (isDef(data)) {\n  invokeCreateHooks(vnode, insertedVnodeQueue)\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">invokeCreateHooks</span> <span class=\"hljs-params\">(vnode, insertedVnodeQueue)</span></span> {\n  <span class=\"hljs-keyword\">for</span> (let i = <span class=\"hljs-number\">0</span>; i &lt; cbs.<span class=\"hljs-built_in\">create</span>.length; ++i) {\n    cbs.<span class=\"hljs-built_in\">create</span>[i](emptyNode, vnode)\n  }\n  i = vnode.data.hook // Reuse variable\n  <span class=\"hljs-keyword\">if</span> (isDef(i)) {\n    <span class=\"hljs-keyword\">if</span> (isDef(i.<span class=\"hljs-built_in\">create</span>)) i.<span class=\"hljs-built_in\">create</span>(emptyNode, vnode)\n    <span class=\"hljs-keyword\">if</span> (isDef(i.<span class=\"hljs-built_in\">insert</span>)) insertedVnodeQueue.push(vnode)\n  }\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"385,401"}},{"content":"<pre data-lines=\"402,403\"><code>&#x6700;&#x540e;&#x8c03;&#x7528; `insert` &#x65b9;&#x6cd5;&#x628a; `DOM` &#x63d2;&#x5165;&#x5230;&#x7236;&#x8282;&#x70b9;&#x4e2d;&#xff0c;&#x56e0;&#x4e3a;&#x662f;&#x9012;&#x5f52;&#x8c03;&#x7528;&#xff0c;&#x5b50;&#x5143;&#x7d20;&#x4f1a;&#x4f18;&#x5148;&#x8c03;&#x7528; `insert`&#xff0c;&#x6240;&#x4ee5;&#x6574;&#x4e2a; `vnode` &#x6811;&#x8282;&#x70b9;&#x7684;&#x63d2;&#x5165;&#x987a;&#x5e8f;&#x662f;&#x5148;&#x5b50;&#x540e;&#x7236;&#x3002;&#x6765;&#x770b;&#x4e00;&#x4e0b; `insert` &#x65b9;&#x6cd5;&#xff0c;&#x5b83;&#x7684;&#x5b9a;&#x4e49;&#x5728; `src/core/vdom/patch.js` &#x4e0a;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"402,403"}},{"content":"<pre data-lines=\"404,419\"><code data-lines=\"404,419\"><span class=\"hljs-keyword\">insert</span>(parentElm, vnode.elm, refElm)\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-keyword\">insert</span> (parent, elm, <span class=\"hljs-keyword\">ref</span>) {\n  <span class=\"hljs-keyword\">if</span> (isDef(parent)) {\n    <span class=\"hljs-keyword\">if</span> (isDef(<span class=\"hljs-keyword\">ref</span>)) {\n      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">ref</span>.parentNode === parent) {\n        nodeOps.insertBefore(parent, elm, <span class=\"hljs-keyword\">ref</span>)\n      }\n    } <span class=\"hljs-keyword\">else</span> {\n      nodeOps.appendChild(parent, elm)\n    }\n  }\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"404,419"}},{"content":"<pre data-lines=\"420,421\"><code>`insert` &#x903b;&#x8f91;&#x5f88;&#x7b80;&#x5355;&#xff0c;&#x8c03;&#x7528;&#x4e00;&#x4e9b; `nodeOps` &#x628a;&#x5b50;&#x8282;&#x70b9;&#x63d2;&#x5165;&#x5230;&#x7236;&#x8282;&#x70b9;&#x4e2d;&#xff0c;&#x8fd9;&#x4e9b;&#x8f85;&#x52a9;&#x65b9;&#x6cd5;&#x5b9a;&#x4e49;&#x5728; `src/platforms/web/runtime/node-ops.js` &#x4e2d;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"420,421"}},{"content":"<pre data-lines=\"422,431\"><code data-lines=\"422,431\">export function insertBefore (parentNode: <span class=\"hljs-keyword\">Node</span><span class=\"hljs-title\">, newNode</span>: <span class=\"hljs-keyword\">Node</span><span class=\"hljs-title\">, referenceNode</span>: <span class=\"hljs-keyword\">Node</span><span class=\"hljs-title\">) {\n  parentNode</span>.insertBefore(newNode, referenceNode)\n}\n\nexport function appendChild (<span class=\"hljs-keyword\">node</span><span class=\"hljs-title\">: Node</span>, child: <span class=\"hljs-keyword\">Node</span><span class=\"hljs-title\">) {\n  node</span>.appendChild(child)\n} \n</code></pre>","children":[],"payload":{"tag":"pre","lines":"422,431"}},{"content":"<pre data-lines=\"432,439\"><code>&#x5176;&#x5b9e;&#x5c31;&#x662f;&#x8c03;&#x7528;&#x539f;&#x751f; DOM &#x7684; API &#x8fdb;&#x884c; DOM &#x64cd;&#x4f5c;&#xff0c;&#x770b;&#x5230;&#x8fd9;&#x91cc;&#xff0c;&#x5f88;&#x591a;&#x540c;&#x5b66;&#x604d;&#x7136;&#x5927;&#x609f;&#xff0c;&#x539f;&#x6765; Vue &#x662f;&#x8fd9;&#x6837;&#x52a8;&#x6001;&#x521b;&#x5efa;&#x7684; DOM&#x3002;\n\n&#x5728; `createElm` &#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x5982;&#x679c; `vnode` &#x8282;&#x70b9;&#x4e0d;&#x5305;&#x542b; `tag`&#xff0c;&#x5219;&#x5b83;&#x6709;&#x53ef;&#x80fd;&#x662f;&#x4e00;&#x4e2a;&#x6ce8;&#x91ca;&#x6216;&#x8005;&#x7eaf;&#x6587;&#x672c;&#x8282;&#x70b9;&#xff0c;&#x53ef;&#x4ee5;&#x76f4;&#x63a5;&#x63d2;&#x5165;&#x5230;&#x7236;&#x5143;&#x7d20;&#x4e2d;&#x3002;&#x5728;&#x6211;&#x4eec;&#x8fd9;&#x4e2a;&#x4f8b;&#x5b50;&#x4e2d;&#xff0c;&#x6700;&#x5185;&#x5c42;&#x5c31;&#x662f;&#x4e00;&#x4e2a;&#x6587;&#x672c; `vnode`&#xff0c;&#x5b83;&#x7684; `text` &#x503c;&#x53d6;&#x7684;&#x5c31;&#x662f;&#x4e4b;&#x524d;&#x7684; `this.message` &#x7684;&#x503c; `Hello Vue!`&#x3002;\n\n&#x518d;&#x56de;&#x5230; `patch` &#x65b9;&#x6cd5;&#xff0c;&#x9996;&#x6b21;&#x6e32;&#x67d3;&#x6211;&#x4eec;&#x8c03;&#x7528;&#x4e86; `createElm` &#x65b9;&#x6cd5;&#xff0c;&#x8fd9;&#x91cc;&#x4f20;&#x5165;&#x7684; `parentElm` &#x662f; `oldVnode.elm` &#x7684;&#x7236;&#x5143;&#x7d20;&#xff0c;&#x5728;&#x6211;&#x4eec;&#x7684;&#x4f8b;&#x5b50;&#x662f; id &#x4e3a; `#app` div &#x7684;&#x7236;&#x5143;&#x7d20;&#xff0c;&#x4e5f;&#x5c31;&#x662f; Body&#xff1b;&#x5b9e;&#x9645;&#x4e0a;&#x6574;&#x4e2a;&#x8fc7;&#x7a0b;&#x5c31;&#x662f;&#x9012;&#x5f52;&#x521b;&#x5efa;&#x4e86;&#x4e00;&#x4e2a;&#x5b8c;&#x6574;&#x7684; DOM &#x6811;&#x5e76;&#x63d2;&#x5165;&#x5230; Body &#x4e0a;&#x3002;\n\n&#x6700;&#x540e;&#xff0c;&#x6211;&#x4eec;&#x6839;&#x636e;&#x4e4b;&#x524d;&#x9012;&#x5f52; `createElm` &#x751f;&#x6210;&#x7684; `vnode` &#x63d2;&#x5165;&#x987a;&#x5e8f;&#x961f;&#x5217;&#xff0c;&#x6267;&#x884c;&#x76f8;&#x5173;&#x7684; `insert` &#x94a9;&#x5b50;&#x51fd;&#x6570;&#xff0c;&#x8fd9;&#x90e8;&#x5206;&#x5185;&#x5bb9;&#x6211;&#x4eec;&#x4e4b;&#x540e;&#x4f1a;&#x8be6;&#x7ec6;&#x4ecb;&#x7ecd;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"432,439"}}],"payload":{"tag":"h2","lines":"3,5"}},{"content":"<a href=\"#%E6%80%BB%E7%BB%93\">#</a> &#x603b;&#x7ed3;","children":[{"content":"<pre data-lines=\"443,444\"><code>&#x90a3;&#x4e48;&#x81f3;&#x6b64;&#x6211;&#x4eec;&#x4ece;&#x4e3b;&#x7ebf;&#x4e0a;&#x628a;&#x6a21;&#x677f;&#x548c;&#x6570;&#x636e;&#x5982;&#x4f55;&#x6e32;&#x67d3;&#x6210;&#x6700;&#x7ec8;&#x7684; DOM &#x7684;&#x8fc7;&#x7a0b;&#x5206;&#x6790;&#x5b8c;&#x6bd5;&#x4e86;&#xff0c;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x4e0b;&#x56fe;&#x66f4;&#x76f4;&#x89c2;&#x5730;&#x770b;&#x5230;&#x4ece;&#x521d;&#x59cb;&#x5316; Vue &#x5230;&#x6700;&#x7ec8;&#x6e32;&#x67d3;&#x7684;&#x6574;&#x4e2a;&#x8fc7;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"443,444"}},{"content":"<img src=\"https://ustbhuangyi.github.io/vue-analysis/assets/new-vue.png\" alt>","children":[],"payload":{"tag":"img","lines":"445,446"}},{"content":"<pre data-lines=\"447,448\"><code>&#x6211;&#x4eec;&#x8fd9;&#x91cc;&#x53ea;&#x662f;&#x5206;&#x6790;&#x4e86;&#x6700;&#x7b80;&#x5355;&#x548c;&#x6700;&#x57fa;&#x7840;&#x7684;&#x573a;&#x666f;&#xff0c;&#x5728;&#x5b9e;&#x9645;&#x9879;&#x76ee;&#x4e2d;&#xff0c;&#x6211;&#x4eec;&#x662f;&#x628a;&#x9875;&#x9762;&#x62c6;&#x6210;&#x5f88;&#x591a;&#x7ec4;&#x4ef6;&#x7684;&#xff0c;Vue &#x53e6;&#x4e00;&#x4e2a;&#x6838;&#x5fc3;&#x601d;&#x60f3;&#x5c31;&#x662f;&#x7ec4;&#x4ef6;&#x5316;&#x3002;&#x90a3;&#x4e48;&#x4e0b;&#x4e00;&#x7ae0;&#x6211;&#x4eec;&#x5c31;&#x6765;&#x5206;&#x6790; Vue &#x7684;&#x7ec4;&#x4ef6;&#x5316;&#x8fc7;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"447,448"}}],"payload":{"tag":"h2","lines":"440,442"}}],"payload":{"tag":"h1","lines":"0,2"}},{})</script>
</body>
</html>
