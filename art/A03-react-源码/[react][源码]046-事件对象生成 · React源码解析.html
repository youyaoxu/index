<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"&#x4e8b;&#x4ef6;&#x5bf9;&#x8c61;&#x751f;&#x6210;","children":[{"content":"<pre data-lines=\"2,5\"><code>&#x5728;&#x89e6;&#x53d1;&#x4e8b;&#x4ef6;&#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x6211;&#x4eec;&#x4f1a;&#x8c03;&#x7528;&#x6bcf;&#x4e2a;&#x63d2;&#x4ef6;&#x7684;`extractEvents`&#x65b9;&#x6cd5;&#x6765;&#x521b;&#x5efa;&#x5bf9;&#x5e94;&#x7684;&#x4e8b;&#x4ef6;&#xff0c;&#x8fd9;&#x91cc;&#x6211;&#x4eec;&#x5c31;&#x770b;&#x770b;&#x4e8b;&#x4ef6;&#x521b;&#x5efa;&#x7684;&#x8fc7;&#x7a0b;&#x3002;&#x8fd9;&#x91cc;&#x6211;&#x4eec;&#x62ff;&#x6700;&#x5e38;&#x7528;&#x7684;&#x4e8b;&#x4ef6;&#x4e4b;&#x4e00;`onChange`&#x6765;&#x4e3e;&#x4f8b;&#xff0c;&#x4e3b;&#x8981;&#x770b;&#x7684;&#x662f;`ChangeEventPlugin.js`\n\n&#x6839;&#x636e;&#x4e0d;&#x540c;&#x7684;&#x60c5;&#x51b5;&#x8bbe;&#x7f6e;`getTargetInstFunc`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2,5"}},{"content":"<pre data-lines=\"6,13\"><code data-lines=\"6,13\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">shouldUseChangeEvent</span>(elem) {\n  const nodeName = elem.nodeName &amp;&amp; elem.nodeName.toLowerCase()\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-type\">nodeName</span> === <span class=\"hljs-symbol\">&apos;select</span>&apos; || (nodeName === <span class=\"hljs-symbol\">&apos;input</span>&apos; &amp;&amp; elem.<span class=\"hljs-keyword\">type</span> <span class=\"hljs-type\">=== </span><span class=\"hljs-symbol\">&apos;file</span>&apos;)\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6,13"}},{"content":"<pre data-lines=\"14,15\"><code>`isTextInputElement`&#x5224;&#x65ad;`input`&#x6807;&#x7b7e;&#x7684;`type`&#x662f;&#x5426;&#x5408;&#x7406;&#xff0c;&#x5982;&#x679c;&#x662f;`textarea`&#x5219;&#x76f4;&#x63a5;&#x8fd4;&#x56de;`true`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"14,15"}},{"content":"<pre data-lines=\"16,27\"><code data-lines=\"16,27\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">shouldUseClickEvent</span>(elem) {\n  const nodeName = elem.nodeName\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-type\">(</span>\n    nodeName &amp;&amp;\n    nodeName.toLowerCase() === <span class=\"hljs-symbol\">&apos;input</span>&apos; &amp;&amp;\n    (elem.<span class=\"hljs-keyword\">type</span> <span class=\"hljs-type\">=== </span><span class=\"hljs-symbol\">&apos;checkbox</span>&apos; || elem.<span class=\"hljs-keyword\">type</span> <span class=\"hljs-type\">=== </span><span class=\"hljs-symbol\">&apos;radio</span>&apos;)\n  )\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"16,27"}},{"content":"<pre data-lines=\"28,31\"><code>&#x5bf9;&#x4e8e;`checkbox`&#x548c;`radio`&#x4f7f;&#x7528;`click`&#x76d1;&#x542c;\n\n&#x8fd9;&#x4e9b;&#x65b9;&#x6cd5;&#x7684;&#x533a;&#x522b;&#x5c31;&#x662f;&#x5224;&#x65ad;&#x672c;&#x6b21;&#x4e8b;&#x4ef6;&#x7684;&#x5177;&#x4f53;&#x7c7b;&#x578b;&#x4e0d;&#x540c;&#xff0c;&#x6700;&#x7ec8;&#x8c03;&#x7528;&#x7684;&#x90fd;&#x662f;`getInstIfValueChanged`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"28,31"}},{"content":"<pre data-lines=\"32,41\"><code data-lines=\"32,41\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getInstIfValueChanged</span>(targetInst) {\n  const targetNode = getNodeFromInstance(targetInst)\n  if (inputValueTracking.updateValueIfChanged(targetNode)) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-type\">targetInst</span>\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"32,41"}},{"content":"<pre data-lines=\"42,43\"><code>&#x4f7f;&#x7528;`track`&#x5224;&#x65ad;`input`&#x7684;&#x503c;&#x6709;&#x6ca1;&#x6709;&#x53d8;&#x5316;&#xff0c;&#x5982;&#x679c;&#x6709;&#x53d8;&#x5316;&#x5219;&#x5219;&#x8fd4;&#x56de;&#xff0c;&#x6ca1;&#x6709;&#x4e0d;&#x8fd4;&#x56de;&#xff0c;&#x4e5f;&#x5c31;&#x4e0d;&#x9700;&#x8981;&#x751f;&#x6210;&#x4e8b;&#x4ef6;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"42,43"}},{"content":"<pre data-lines=\"44,108\"><code data-lines=\"44,108\">extractEvents = <span class=\"hljs-keyword\">function</span>(\n  topLevelType,\n  targetInst,\n  nativeEvent,\n  nativeEventTarget,\n) {\n  const targetNode = targetInst ? getNodeFromInstance(targetInst) : <span class=\"hljs-type\">window</span>\n\n  let getTargetInstFunc, handleEventFunc\n  <span class=\"hljs-keyword\">if</span> (shouldUseChangeEvent(targetNode)) {\n    getTargetInstFunc = getTargetInstForChangeEvent\n  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (isTextInputElement(targetNode)) {\n    <span class=\"hljs-keyword\">if</span> (isInputEventSupported) {\n      getTargetInstFunc = getTargetInstForInputOrChangeEvent\n    } <span class=\"hljs-keyword\">else</span> {\n      getTargetInstFunc = getTargetInstForInputEventPolyfill\n      handleEventFunc = handleEventsForInputEventPolyfill\n    }\n  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (shouldUseClickEvent(targetNode)) {\n    getTargetInstFunc = getTargetInstForClickEvent\n  }\n\n  <span class=\"hljs-keyword\">if</span> (getTargetInstFunc) {\n    const inst = getTargetInstFunc(topLevelType, targetInst)\n    <span class=\"hljs-keyword\">if</span> (inst) {\n      const event = createAndAccumulateChangeEvent(\n        inst,\n        nativeEvent,\n        nativeEventTarget,\n      )\n      <span class=\"hljs-keyword\">return</span> event\n    }\n  }\n\n  <span class=\"hljs-keyword\">if</span> (handleEventFunc) {\n    handleEventFunc(topLevelType, targetNode, targetInst)\n  }\n\n  \n  <span class=\"hljs-keyword\">if</span> (topLevelType === TOP_BLUR) {\n    handleControlledInputBlur(targetNode)\n  }\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getTargetInstForChangeEvent</span>(topLevelType, targetInst) {\n  if (topLevelType === TOP_CHANGE) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-type\">targetInst</span>\n  }\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getTargetInstForInputOrChangeEvent</span>(topLevelType, targetInst) {\n  if (topLevelType === TOP_INPUT || topLevelType === TOP_CHANGE) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-type\">getInstIfValueChanged(targetInst)</span>\n  }\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getTargetInstForClickEvent</span>(topLevelType, targetInst) {\n  if (topLevelType === TOP_CLICK) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-type\">getInstIfValueChanged(targetInst)</span>\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"44,108"}},{"content":"<pre data-lines=\"109,117\"><code>&#x4ece;&#x8fd9;&#x91cc;&#x5f00;&#x59cb;&#x6784;&#x5efa;&#x4e8b;&#x4ef6;&#xff0c;&#x9996;&#x5148; React &#x7684;&#x4e8b;&#x4ef6;&#x6709;&#x4e00;&#x4e2a;`pool`&#xff0c;&#x53ef;&#x4ee5;&#x590d;&#x7528;&#x4e8b;&#x4ef6;&#x5bf9;&#x8c61;&#xff0c;&#x4e0d;&#x9700;&#x8981;&#x6bcf;&#x6b21;&#x90fd;&#x91cd;&#x65b0;&#x521b;&#x5efa;&#xff0c;&#x7136;&#x540e;&#x8c03;&#x7528;`accumulateTwoPhaseDispatches`&#x5f00;&#x59cb;&#x4e3a;&#x4e8b;&#x4ef6;&#x5bf9;&#x8c61;&#x6302;&#x8f7d;&#x4e24;&#x4e2a;&#x9636;&#x6bb5;&#x7684;&#x76d1;&#x542c;&#x8005;&#xff1a;\n\n*   &#x6355;&#x83b7;&#x9636;&#x6bb5;\n*   &#x5192;&#x6ce1;&#x9636;&#x6bb5;\n\n`forEachAccumulated`&#x8ddf;&#x8c03;&#x7528;&#x4e8b;&#x4ef6;&#x7684;&#x65f6;&#x5019;&#x4e00;&#x6837;&#xff0c;&#x5176;&#x5b9e;&#x5c31;&#x662f;&#x4e3a;&#x6bcf;&#x4e2a;&#x4e8b;&#x4ef6;&#x8c03;&#x7528;`accumulateTwoPhaseDispatchesSingle`\n\n`traverseTwoPhase`&#x5411;&#x4e0a;&#x904d;&#x5386;&#x6811;&#x627e;&#x5230;&#x6240;&#x6709;`HostComponent`&#xff0c;&#x5e76;&#x5bf9;&#x6bcf;&#x4e00;&#x4e2a;&#x8282;&#x70b9;&#x8c03;&#x7528;`accumulateDirectionalDispatches`&#xff0c;`listenerAtPhase`&#x4ee3;&#x7801;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"109,117"}},{"content":"<pre data-lines=\"118,145\"><code data-lines=\"118,145\">function listenerAtPhase(inst, event, propagationPhase: PropagationPhases) {\n  <span class=\"hljs-keyword\">const</span> registrationName =\n    event.dispatchConfig.phasedRegistrationNames[propagationPhase]\n  return getListener(inst, registrationName)\n}\n\nexport function getListener(inst: Fiber, registrationName: string) {\n  let listener\n\n  <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">state</span>Node = inst.<span class=\"hljs-keyword\">state</span>Node\n  if (!<span class=\"hljs-keyword\">state</span>Node) {\n    return null\n  }\n  <span class=\"hljs-keyword\">const</span> props = getFiberCurrentPropsFromNode(<span class=\"hljs-keyword\">state</span>Node)\n  if (!props) {\n    return null\n  }\n  listener = props[registrationName]\n  if (shouldPreventMouseEvent(registrationName, inst.type, props)) {\n    return null\n  }\n  \n  return listener\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"118,145"}},{"content":"<pre data-lines=\"146,149\"><code>&#x901a;&#x8fc7;&#x5bf9;`HostComponent`&#x7684;`Fiber`&#x5bf9;&#x8c61;&#x4e0a;&#x83b7;&#x53d6;`props`&#xff0c;&#x5e76;&#x5224;&#x65ad;&#x65f6;&#x5019;&#x6709;&#x4e8b;&#x4ef6;&#x76d1;&#x542c;&#x7684;`props`&#xff0c;&#x6bd4;&#x5982;`onChange`&#xff0c;`onChangeCapture`&#xff0c;&#x5982;&#x679c;&#x6709;&#x5c31;&#x8fd4;&#x56de;&#x5904;&#x7406;&#x51fd;&#x6570;&#x3002;&#x5728;`accumulateDirectionalDispatches`&#x5c31;&#x4f1a;&#x8d4b;&#x503c;&#x5728;\n\n&#x5728;&#x8fd9;&#x91cc;&#x5e76;&#x6ca1;&#x6709;&#x533a;&#x5206;&#x4e0d;&#x540c;&#x9636;&#x6bb5;&#x7684;&#x4e8b;&#x4ef6;&#xff0c;&#x4f46;&#x662f;&#x5728;&#x653e;&#x5230;`_dispatchListeners`&#x91cc;&#x9762;&#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x4f1a;&#x76f4;&#x63a5;&#x5b89;&#x6392;&#x597d;&#x987a;&#x5e8f;&#xff0c;&#x6ce8;&#x610f;`traverseTwoPhase`&#x4e2d;&#x7684;&#x4e24;&#x4e2a;&#x904d;&#x5386;&#x7684;&#x987a;&#x5e8f;&#xff0c;&#x7b2c;&#x4e00;&#x4e2a;&#x662f;&#x53cd;&#x5411;&#x7684;&#xff0c;&#x4e5f;&#x5c31;&#x662f;&#x4ece;&#x6700;&#x9876;&#x70b9;&#x7684;&#x8282;&#x70b9;&#x5f00;&#x59cb;&#x3002;&#x901a;&#x8fc7;&#x8fd9;&#x6837;&#x6765;&#x4fdd;&#x8bc1;&#x4e8b;&#x4ef6;&#x89e6;&#x53d1;&#x662f;&#x6309;&#x7167;&#x987a;&#x5e8f;&#x6765;&#x7684;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"146,149"}},{"content":"<pre data-lines=\"150,203\"><code data-lines=\"150,203\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">createAndAccumulateChangeEvent</span><span class=\"hljs-params\">(inst, nativeEvent, target)</span></span> {\n  const event = SyntheticEvent.getPooled(\n    eventTypes.change,\n    inst,\n    nativeEvent,\n    target,\n  )\n  event.<span class=\"hljs-built_in\">type</span> = <span class=\"hljs-string\">&apos;change&apos;</span>\n\n  \n  enqueueStateRestore(target)\n  accumulateTwoPhaseDispatches(event)\n  <span class=\"hljs-keyword\">return</span> event\n}\n\nexport <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">accumulateTwoPhaseDispatches</span><span class=\"hljs-params\">(events)</span></span> {\n  forEachAccumulated(events, accumulateTwoPhaseDispatchesSingle)\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">accumulateTwoPhaseDispatchesSingle</span><span class=\"hljs-params\">(event)</span></span> {\n  <span class=\"hljs-keyword\">if</span> (event &amp;&amp; event.dispatchConfig.phasedRegistrationNames) {\n    traverseTwoPhase(event._targetInst, accumulateDirectionalDispatches, event)\n  }\n}\n\nexport <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">traverseTwoPhase</span><span class=\"hljs-params\">(inst, fn, arg)</span></span> {\n  const <span class=\"hljs-built_in\">path</span> = []\n  <span class=\"hljs-keyword\">while</span> (inst) {\n    <span class=\"hljs-built_in\">path</span>.push(inst)\n    inst = getParent(inst)\n  }\n  let i\n  <span class=\"hljs-keyword\">for</span> (i = <span class=\"hljs-built_in\">path</span>.length; i<span class=\"hljs-comment\">-- &gt; 0; ) {</span>\n    fn(<span class=\"hljs-built_in\">path</span>[i], <span class=\"hljs-string\">&apos;captured&apos;</span>, <span class=\"hljs-built_in\">arg</span>)\n  }\n  <span class=\"hljs-keyword\">for</span> (i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-built_in\">path</span>.length; i++) {\n    fn(<span class=\"hljs-built_in\">path</span>[i], <span class=\"hljs-string\">&apos;bubbled&apos;</span>, <span class=\"hljs-built_in\">arg</span>)\n  }\n}\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">accumulateDirectionalDispatches</span><span class=\"hljs-params\">(inst, phase, event)</span></span> {\n  const listener = listenerAtPhase(inst, event, phase)\n  <span class=\"hljs-keyword\">if</span> (listener) {\n    event._dispatchListeners = accumulateInto(\n      event._dispatchListeners,\n      listener,\n    )\n    event._dispatchInstances = accumulateInto(event._dispatchInstances, inst)\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"150,203"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"204,205"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"208,209"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
