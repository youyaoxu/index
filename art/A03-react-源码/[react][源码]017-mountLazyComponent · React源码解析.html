<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"mountLazyComponent","children":[{"content":"<pre data-lines=\"2,7\"><code>&#x4e3a;&#x4ec0;&#x4e48;&#x8981;&#x53eb;`mount`&#x800c;&#x4e0d;&#x662f;`update`&#x5462;&#xff1f;&#x56e0;&#x4e3a;`lazy`&#x7ec4;&#x4ef6;&#x53ea;&#x6709;&#x5728;&#x52a0;&#x8f7d;&#x7684;&#x7ec4;&#x4ef6;&#x8fd8;&#x6ca1;&#x5b8c;&#x6210;&#x4e4b;&#x524d;&#x624d;&#x4f1a;&#x88ab;&#x6267;&#x884c;&#xff0c;&#x7b49;&#x5230;&#x52a0;&#x8f7d;&#x5b8c;&#x6210;&#x4e86;&#xff0c;&#x90a3;&#x4e48;&#x5c31;&#x53d8;&#x6210;&#x52a0;&#x8f7d;&#x4e4b;&#x540e;&#x7684;&#x7ec4;&#x4ef6;&#x4e86;&#xff0c;&#x6c38;&#x8fdc;&#x4e0d;&#x4f1a;&#x6267;&#x884c;&#x5230;&#x81ea;&#x5df1;&#x7684;&#x66f4;&#x65b0;&#x3002;\n\n&#x8fd9;&#x4e5f;&#x662f;&#x4e00;&#x5f00;&#x59cb;&#x5224;&#x65ad;`current`&#x662f;&#x5426;&#x5b58;&#x5728;&#x7684;&#x539f;&#x56e0;&#xff0c;&#x5982;&#x679c;&#x5b58;&#x5728;&#x5219;&#x4e0d;&#x7b26;&#x5408;&#x7ec4;&#x4ef6;&#x7684;&#x671f;&#x671b;&#xff0c;&#x9700;&#x8981;&#x91cd;&#x65b0;&#x6309;&#x7167;`current`&#x4e0d;&#x5b58;&#x5728;&#x7684;&#x65b9;&#x5f0f;&#x8fdb;&#x884c;&#x66f4;&#x65b0;&#x3002;\n\n&#x6838;&#x5fc3;&#x65b9;&#x6cd5;&#x662f;`readLazyComponentType`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2,7"}},{"content":"<pre data-lines=\"8,62\"><code data-lines=\"8,62\">export function readLazyComponentType&lt;T&gt;(lazyComponent: LazyComponent&lt;T&gt;): T {\n  <span class=\"hljs-keyword\">const</span> status = lazyComponent._status;\n  <span class=\"hljs-keyword\">const</span> result = lazyComponent._result;\n  <span class=\"hljs-keyword\">switch</span> (status) {\n    <span class=\"hljs-keyword\">case</span> Resolved: {\n      <span class=\"hljs-keyword\">const</span> Component: T = result;\n      <span class=\"hljs-keyword\">return</span> Component;\n    }\n    <span class=\"hljs-keyword\">case</span> Rejected: {\n      <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">error</span>: mixed = result;\n      <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">error</span>;\n    }\n    <span class=\"hljs-keyword\">case</span> Pending: {\n      <span class=\"hljs-keyword\">const</span> thenable: Thenable&lt;T, mixed&gt; = result;\n      <span class=\"hljs-keyword\">throw</span> thenable;\n    }\n    <span class=\"hljs-keyword\">default</span>: {\n      lazyComponent._status = Pending;\n      <span class=\"hljs-keyword\">const</span> ctor = lazyComponent._ctor;\n      <span class=\"hljs-keyword\">const</span> thenable = ctor();\n      thenable.then(\n        moduleObject =&gt; {\n          <span class=\"hljs-keyword\">if</span> (lazyComponent._status === Pending) {\n            <span class=\"hljs-keyword\">const</span> defaultExport = moduleObject.<span class=\"hljs-keyword\">default</span>;\n            <span class=\"hljs-keyword\">if</span> (__DEV__) {\n              <span class=\"hljs-keyword\">if</span> (defaultExport === undefined) {\n                <span class=\"hljs-keyword\">warning</span>(\n                  <span class=\"hljs-keyword\">false</span>,\n                  <span class=\"hljs-string\">&apos;lazy: Expected the result of a dynamic import() call. &apos;</span> +\n                    <span class=\"hljs-string\">&apos;Instead received: %s\\n\\nYour code should look like: \\n  &apos;</span> +\n                    <span class=\"hljs-string\">&quot;const MyComponent = lazy(() =&gt; import(&apos;./MyComponent&apos;))&quot;</span>,\n                  moduleObject,\n                );\n              }\n            }\n            lazyComponent._status = Resolved;\n            lazyComponent._result = defaultExport;\n          }\n        },\n        <span class=\"hljs-keyword\">error</span> =&gt; {\n          <span class=\"hljs-keyword\">if</span> (lazyComponent._status === Pending) {\n            lazyComponent._status = Rejected;\n            lazyComponent._result = <span class=\"hljs-keyword\">error</span>;\n          }\n        },\n      );\n      lazyComponent._result = thenable;\n      <span class=\"hljs-keyword\">throw</span> thenable;\n    }\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"8,62"}},{"content":"<pre data-lines=\"63,66\"><code>&#x9ed8;&#x8ba4;`status`&#x662f;`-1`&#xff0c;&#x6267;&#x884c;&#x4f20;&#x5165;&#x7684;&#x65b9;&#x6cd5;&#x5f97;&#x5230;`thenable`&#x65b9;&#x6cd5;&#xff0c;&#x6839;&#x636e;`thenable`&#x7684;&#x7ed3;&#x679c;&#x66f4;&#x65b0;&#x7ec4;&#x4ef6;&#x7684;&#x72b6;&#x6001;&#xff0c;&#x5e76;&#x4e14;&#x628a;`resolve`&#x7684;&#x7ec4;&#x4ef6;&#x8fdb;&#x884c;&#x8fd4;&#x56de;\n\n&#x8fd4;&#x56de;&#x7ec4;&#x4ef6;&#x4e4b;&#x540e;&#x6267;&#x884c;&#x4e86;&#x4ee5;&#x4e0b;&#x51e0;&#x53e5;&#x4ee3;&#x7801;&#xff0c;&#x975e;&#x5e38;&#x91cd;&#x8981;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"63,66"}},{"content":"<pre data-lines=\"67,72\"><code data-lines=\"67,72\">workInProgress.type <span class=\"hljs-operator\">=</span> Component<span class=\"hljs-comment\">;</span>\nconst resolvedTag <span class=\"hljs-operator\">=</span> (workInProgress.tag <span class=\"hljs-operator\">=</span> resolveLazyComponentTag(Component))<span class=\"hljs-comment\">;</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"67,72"}},{"content":"<pre data-lines=\"73,74\"><code>&#x4ed6;&#x628a;`lazy`&#x7ec4;&#x4ef6;&#x7684;`Fiber`&#x5bf9;&#x8c61;&#x7684;`tag`&#x548c;`type`&#x90fd;&#x6539;&#x53d8;&#x4e86;&#xff0c;&#x4e0b;&#x6b21;&#x6267;&#x884c;&#x5230;&#x8fd9;&#x4e2a;`Fiber`&#x7684;&#x66f4;&#x65b0;&#xff0c;&#x5219;&#x4f1a;&#x76f4;&#x63a5;&#x66f4;&#x65b0;&#x8fd4;&#x56de;&#x7684;`type`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"73,74"}},{"content":"<pre data-lines=\"75,155\"><code data-lines=\"75,155\">\nfunction mountLazyComponent(\n<span class=\"hljs-built_in\">  _current,</span>\n<span class=\"hljs-built_in\">  workInProgress,</span>\n<span class=\"hljs-built_in\">  elementType,</span>\n<span class=\"hljs-built_in\">  updateExpirationTime,</span>\n<span class=\"hljs-built_in\">  renderExpirationTime,</span>\n) {\n  if (_current !== null) {\n    \n    \n    \n    \n    _current.alternate = null<span class=\"hljs-comment\">;</span>\n    workInProgress.alternate = null<span class=\"hljs-comment\">;</span>\n    \n    workInProgress.effectTag |= Placement<span class=\"hljs-comment\">;</span>\n  }\n\n  const props = workInProgress.pendingProps<span class=\"hljs-comment\">;</span>\n  \n  \n  cancelWorkTimer(workInProgress)<span class=\"hljs-comment\">;</span>\n  let Component = readLazyComponentType(elementType)<span class=\"hljs-comment\">;</span>\n  \n  workInProgress.type = Component<span class=\"hljs-comment\">;</span>\n  const resolvedTag = (workInProgress.tag = resolveLazyComponentTag(Component))<span class=\"hljs-comment\">;</span>\n  startWorkTimer(workInProgress)<span class=\"hljs-comment\">;</span>\n  const resolvedProps = resolveDefaultProps(Component, props)<span class=\"hljs-comment\">;</span>\n  let child<span class=\"hljs-comment\">;</span>\n  switch (resolvedTag) {\n<span class=\"hljs-title\">    case FunctionComponent:</span> {\n      child = updateFunctionComponent(\n<span class=\"hljs-built_in\">        null,</span>\n<span class=\"hljs-built_in\">        workInProgress,</span>\n<span class=\"hljs-built_in\">        Component,</span>\n<span class=\"hljs-built_in\">        resolvedProps,</span>\n<span class=\"hljs-built_in\">        renderExpirationTime,</span>\n      )<span class=\"hljs-comment\">;</span>\n      <span class=\"hljs-keyword\">break</span><span class=\"hljs-comment\">;</span>\n    }\n<span class=\"hljs-title\">    case ClassComponent:</span> {\n      child = updateClassComponent(\n<span class=\"hljs-built_in\">        null,</span>\n<span class=\"hljs-built_in\">        workInProgress,</span>\n<span class=\"hljs-built_in\">        Component,</span>\n<span class=\"hljs-built_in\">        resolvedProps,</span>\n<span class=\"hljs-built_in\">        renderExpirationTime,</span>\n      )<span class=\"hljs-comment\">;</span>\n      <span class=\"hljs-keyword\">break</span><span class=\"hljs-comment\">;</span>\n    }\n<span class=\"hljs-title\">    case ForwardRef:</span> {\n      child = updateForwardRef(\n<span class=\"hljs-built_in\">        null,</span>\n<span class=\"hljs-built_in\">        workInProgress,</span>\n<span class=\"hljs-built_in\">        Component,</span>\n<span class=\"hljs-built_in\">        resolvedProps,</span>\n<span class=\"hljs-built_in\">        renderExpirationTime,</span>\n      )<span class=\"hljs-comment\">;</span>\n      <span class=\"hljs-keyword\">break</span><span class=\"hljs-comment\">;</span>\n    }\n<span class=\"hljs-title\">    case MemoComponent:</span> {\n      child = updateMemoComponent(\n<span class=\"hljs-built_in\">        null,</span>\n<span class=\"hljs-built_in\">        workInProgress,</span>\n<span class=\"hljs-built_in\">        Component,</span>\n        resolveDefaultProps(Component.type, resolvedProps), \n<span class=\"hljs-built_in\">        updateExpirationTime,</span>\n<span class=\"hljs-built_in\">        renderExpirationTime,</span>\n      )<span class=\"hljs-comment\">;</span>\n      <span class=\"hljs-keyword\">break</span><span class=\"hljs-comment\">;</span>\n    }\n<span class=\"hljs-title\">    default:</span> {\n    }\n  }\n  <span class=\"hljs-keyword\">return</span> child<span class=\"hljs-comment\">;</span>\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"75,155"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"156,157"}},{"content":"<img src=\"https://static.coursebetter.com/202112/Jokcy%E7%9A%84%E4%BA%8C%E7%BB%B4%E7%A0%81.png\" alt>","children":[],"payload":{"tag":"img","lines":"160,161"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
