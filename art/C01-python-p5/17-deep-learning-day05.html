<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"Deep-Learning","children":[{"content":"&#x793a;&#x4f8b;","children":[{"content":"<pre data-lines=\"6,196\"><code class=\"language-python\"><span class=\"hljs-comment\"># 01_fashion_mnist.py</span>\n<span class=\"hljs-comment\"># &#x5229;&#x7528;CNN&#x5b9e;&#x73b0;&#x670d;&#x9970;&#x8bc6;&#x522b;&#x793a;&#x4f8b;</span>\n<span class=\"hljs-keyword\">import</span> tensorflow <span class=\"hljs-keyword\">as</span> tf\n<span class=\"hljs-keyword\">from</span> tensorflow.contrib.learn.python.learn.datasets.mnist <span class=\"hljs-keyword\">import</span> read_data_sets\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">FashionMnist</span>():\n    out_features1 = <span class=\"hljs-number\">12</span>  <span class=\"hljs-comment\"># &#x7b2c;&#x4e00;&#x4e2a;&#x5377;&#x79ef;&#x6c60;&#x5316;&#x5c42;&#x8f93;&#x51fa;&#x7279;&#x5f81;&#x6570;&#x91cf;(&#x7b49;&#x4e8e;&#x7b2c;&#x4e00;&#x4e2a;&#x5377;&#x79ef;&#x6c60;&#x5316;&#x5c42;&#x5377;&#x79ef;&#x6838;&#x6570;&#x91cf;)</span>\n    out_features2 = <span class=\"hljs-number\">24</span>  <span class=\"hljs-comment\"># &#x7b2c;&#x4e8c;&#x4e2a;&#x5377;&#x79ef;&#x6c60;&#x5316;&#x5c42;&#x8f93;&#x51fa;&#x7279;&#x5f81;&#x6570;&#x91cf;(&#x7b49;&#x4e8e;&#x7b2c;&#x4e8c;&#x4e2a;&#x5377;&#x79ef;&#x6c60;&#x5316;&#x5c42;&#x5377;&#x79ef;&#x6838;&#x6570;&#x91cf;)</span>\n    con_neurons = <span class=\"hljs-number\">512</span>  <span class=\"hljs-comment\"># &#x5168;&#x8fde;&#x63a5;&#x5c42;&#x795e;&#x7ecf;&#x5143;&#x6570;&#x91cf;</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">__init__</span>(<span class=\"hljs-params\">self, path</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &#x6784;&#x9020;&#x65b9;&#x6cd5;\n        :param path: &#x6570;&#x636e;&#x96c6;&#x6240;&#x5728;&#x8def;&#x5f84;\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-variable language_\">self</span>.sess = tf.Session()  <span class=\"hljs-comment\"># Session</span>\n        <span class=\"hljs-variable language_\">self</span>.data = read_data_sets(path, one_hot=<span class=\"hljs-literal\">True</span>)  <span class=\"hljs-comment\"># &#x8bfb;&#x53d6;&#x6837;&#x672c;&#x6587;&#x4ef6;&#x5bf9;&#x8c61;</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">init_weight_variable</span>(<span class=\"hljs-params\">self, shape</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &#x6839;&#x636e;&#x6307;&#x5b9a;&#x7684;&#x5f62;&#x72b6;&#x521d;&#x59cb;&#x5316;&#x6743;&#x91cd;\n        :param shape: &#x6307;&#x5b9a;&#x6743;&#x91cd;&#x503c;&#x7684;&#x5f62;&#x72b6;\n        :return: &#x7ecf;&#x8fc7;&#x521d;&#x59cb;&#x5316;&#x7684;&#x5f20;&#x91cf;\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-comment\"># &#x622a;&#x5c3e;&#x6b63;&#x6001;&#x5206;&#x5e03;, &#x622a;&#x6389;2&#x4e2a;&#x6807;&#x51c6;&#x5dee;&#x5916;&#x7684;&#x6570;&#x636e;</span>\n        <span class=\"hljs-comment\"># &#x6743;&#x91cd;&#x4e00;&#x822c;&#x91c7;&#x7528;&#x968f;&#x673a;&#x503c;(&#x6ce8;&#x610f;&#x4e0d;&#x80fd;&#x521d;&#x59cb;&#x5316;&#x4e3a;0&#xff0c;&#x4f1a;&#x5bfc;&#x81f4;&#x8ba1;&#x7b97;&#x4e0a;&#x7684;&#x95ee;&#x9898;)</span>\n        inital = tf.truncated_normal(shape, stddev=<span class=\"hljs-number\">0.1</span>)\n        <span class=\"hljs-keyword\">return</span> tf.Variable(inital)  <span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x53d8;&#x91cf;&#x5e76;&#x8fd4;&#x56de;</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">init_bias_variable</span>(<span class=\"hljs-params\">self, shape</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &#x521d;&#x59cb;&#x5316;&#x504f;&#x7f6e;\n        :param shape:&#x6307;&#x5b9a;&#x6743;&#x91cd;&#x503c;&#x7684;&#x5f62;&#x72b6;\n        :return:&#x7ecf;&#x8fc7;&#x521d;&#x59cb;&#x5316;&#x7684;&#x5f20;&#x91cf;\n        &quot;&quot;&quot;</span>\n        inital = tf.constant(<span class=\"hljs-number\">1.0</span>, shape=shape)\n        <span class=\"hljs-keyword\">return</span> tf.Variable(inital)  <span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x53d8;&#x91cf;&#x5e76;&#x8fd4;&#x56de;</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">conv2d</span>(<span class=\"hljs-params\">self, x, w</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &#x4e8c;&#x7ef4;&#x5377;&#x79ef;&#x8fd0;&#x7b97;&#x65b9;&#x6cd5;\n        :param x: &#x539f;&#x59cb;&#x5f20;&#x91cf;\n        :param w: &#x5377;&#x79ef;&#x6838;\n        :return: &#x8fd4;&#x56de;&#x5377;&#x79ef;&#x540e;&#x7684;&#x7ed3;&#x679c;\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">return</span> tf.nn.conv2d(x,  <span class=\"hljs-comment\"># &#x539f;&#x59cb;&#x6570;&#x636e;</span>\n                            w,  <span class=\"hljs-comment\"># &#x5377;&#x79ef;&#x6838;</span>\n                            strides=[<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>],  <span class=\"hljs-comment\"># &#x5404;&#x4e2a;&#x7ef4;&#x5ea6;&#x65b9;&#x5411;&#x4e0a;&#x7684;&#x6b65;&#x957f;&#x503c;(N,H,W,C)</span>\n                            padding=<span class=\"hljs-string\">&quot;SAME&quot;</span>)  <span class=\"hljs-comment\"># SAME&#x8868;&#x793a;&#x8f93;&#x51fa;&#x77e9;&#x9635;&#x548c;&#x8f93;&#x5165;&#x77e9;&#x9635;&#x5927;&#x5c0f;&#x76f8;&#x540c;</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">max_pool_2x2</span>(<span class=\"hljs-params\">self, x</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &#x6700;&#x5927;&#x6c60;&#x5316;&#x51fd;&#x6570;\n        :param x: &#x539f;&#x59cb;&#x6570;&#x636e;\n        :return: &#x8fd4;&#x56de;&#x7ecf;&#x8fc7;&#x6c60;&#x5316;&#x8ba1;&#x7b97;&#x540e;&#x7684;&#x7ed3;&#x679c;\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-keyword\">return</span> tf.nn.max_pool(x,  <span class=\"hljs-comment\"># &#x539f;&#x59cb;&#x6570;&#x636e;</span>\n                              ksize=[<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">1</span>],  <span class=\"hljs-comment\"># &#x6c60;&#x5316;&#x533a;&#x57df;&#x5927;&#x5c0f; 2*2</span>\n                              strides=[<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">1</span>],  <span class=\"hljs-comment\"># &#x5404;&#x7ef4;&#x5ea6;&#x7684;&#x6b65;&#x957f;&#x503c;</span>\n                              padding=<span class=\"hljs-string\">&quot;SAME&quot;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">create_conv_pool_layer</span>(<span class=\"hljs-params\">self, <span class=\"hljs-built_in\">input</span>, input_features, out_features</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &#x5c01;&#x88c5;&#x5377;&#x79ef;&#x3001;&#x6fc0;&#x6d3b;&#x3001;&#x6c60;&#x5316;&#x8ba1;&#x7b97;&#x5c42;\n        :param input: &#x539f;&#x59cb;&#x6570;&#x636e;\n        :param input_features: &#x8f93;&#x5165;&#x7279;&#x5f81;&#x6570;&#x91cf;\n        :param out_features: &#x8f93;&#x51fa;&#x7279;&#x5f81;&#x6570;&#x91cf;\n        :return: &#x7ecf;&#x8fc7;&#x5377;&#x79ef;&#x3001;&#x6fc0;&#x6d3b;&#x3001;&#x6c60;&#x5316;&#x8ba1;&#x7b97;&#x5c42;&#x7ed3;&#x679c;\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-comment\"># &#x521d;&#x59cb;&#x5316;&#x5377;&#x79ef;&#x6838;</span>\n        <span class=\"hljs-built_in\">filter</span> = <span class=\"hljs-variable language_\">self</span>.init_weight_variable([<span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">5</span>, input_features, out_features])\n        <span class=\"hljs-comment\"># &#x521d;&#x59cb;&#x5316;&#x504f;&#x7f6e;</span>\n        b_conv = <span class=\"hljs-variable language_\">self</span>.init_bias_variable([out_features])  <span class=\"hljs-comment\"># &#x6570;&#x91cf;&#x548c;&#x5377;&#x79ef;&#x8fd0;&#x7b97;&#x8f93;&#x51fa;&#x5927;&#x5c0f;&#x4e00;&#x81f4;</span>\n\n        h_conv = tf.nn.relu(<span class=\"hljs-variable language_\">self</span>.conv2d(<span class=\"hljs-built_in\">input</span>, <span class=\"hljs-built_in\">filter</span>) + b_conv)  <span class=\"hljs-comment\"># &#x5377;&#x79ef;&#x6fc0;&#x6d3b;&#x8fd0;&#x7b97;</span>\n        h_pool = <span class=\"hljs-variable language_\">self</span>.max_pool_2x2(h_conv)  <span class=\"hljs-comment\"># &#x5bf9;&#x5377;&#x79ef;&#x6fc0;&#x6d3b;&#x8fd0;&#x7b97;&#x7ed3;&#x679c;&#x505a;&#x6c60;&#x5316;</span>\n\n        <span class=\"hljs-keyword\">return</span> h_pool\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">create_fc_layer</span>(<span class=\"hljs-params\">self, h_pool_flat, input_features, con_neurons</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &#x521b;&#x5efa;&#x5168;&#x8fde;&#x63a5;&#x5c42;\n        :param h_pool_flat: &#x8f93;&#x5165;&#x6570;&#x636e;&#xff0c;&#x7ecf;&#x8fc7;&#x62c9;&#x5347;&#x540e;&#x4e00;&#x7ef4;&#x5f20;&#x91cf;\n        :param input_features:&#x8f93;&#x5165;&#x7279;&#x5f81;&#x5927;&#x5c0f;\n        :param out_features:&#x8f93;&#x51fa;&#x7279;&#x5f81;&#x5927;&#x5c0f;\n        :return:&#x7ecf;&#x8fc7;&#x5168;&#x8fde;&#x63a5;&#x8ba1;&#x7b97;&#x7ed3;&#x679c;\n        &quot;&quot;&quot;</span>\n        w_fc = <span class=\"hljs-variable language_\">self</span>.init_weight_variable([input_features, con_neurons])  <span class=\"hljs-comment\"># &#x521d;&#x59cb;&#x5316;&#x6743;&#x91cd;</span>\n        b_fc = <span class=\"hljs-variable language_\">self</span>.init_bias_variable([con_neurons])  <span class=\"hljs-comment\"># &#x504f;&#x7f6e;</span>\n        h_fc1 = tf.nn.relu(tf.matmul(h_pool_flat, w_fc) + b_fc)  <span class=\"hljs-comment\"># &#x6267;&#x884c;wx+b&#x8ba1;&#x7b97;&#x5e76;&#x6fc0;&#x6d3b;</span>\n\n        <span class=\"hljs-keyword\">return</span> h_fc1\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">build</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &#x7ec4;&#x5efa;CNN\n        :return: &#x7ed3;&#x679c;CNN&#x8ba1;&#x7b97;&#x540e;&#x7684;&#x5f20;&#x91cf;\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-variable language_\">self</span>.x = tf.placeholder(tf.float32, shape=[<span class=\"hljs-literal\">None</span>, <span class=\"hljs-number\">784</span>])\n        <span class=\"hljs-comment\"># &#x53d8;&#x7ef4;&#xff1a;28*28&#x5355;&#x901a;&#x9053;&#x56fe;&#x50cf;, -1&#x8868;&#x793a;&#x81ea;&#x9002;&#x5e94;(&#x6839;&#x636e;&#x5143;&#x7d20;&#x4e2a;&#x6570;&#x8ba1;&#x7b97;&#x5f97;&#x6765;)</span>\n        x_image = tf.reshape(<span class=\"hljs-variable language_\">self</span>.x, [-<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">28</span>, <span class=\"hljs-number\">28</span>, <span class=\"hljs-number\">1</span>])\n        <span class=\"hljs-variable language_\">self</span>.y_ = tf.placeholder(tf.float32, shape=[<span class=\"hljs-literal\">None</span>, <span class=\"hljs-number\">10</span>])  <span class=\"hljs-comment\"># &#x6807;&#x7b7e;</span>\n\n        <span class=\"hljs-comment\"># &#x7b2c;&#x4e00;&#x7ec4;&#x5377;&#x79ef;&#x3001;&#x6fc0;&#x6d3b;&#x3001;&#x6c60;&#x5316;</span>\n        h_pool1 = <span class=\"hljs-variable language_\">self</span>.create_conv_pool_layer(x_image,  <span class=\"hljs-comment\"># &#x539f;&#x59cb;&#x56fe;&#x50cf;&#x6570;&#x636e;</span>\n                                              <span class=\"hljs-number\">1</span>,  <span class=\"hljs-comment\"># &#x8f93;&#x5165;&#x901a;&#x9053;&#x6570;</span>\n                                              <span class=\"hljs-variable language_\">self</span>.out_features1)  <span class=\"hljs-comment\"># &#x8f93;&#x51fa;&#x901a;&#x9053;&#x6570;</span>\n        <span class=\"hljs-comment\"># &#x7b2c;&#x4e8c;&#x7ec4;&#x5377;&#x79ef;&#x3001;&#x6fc0;&#x6d3b;&#x3001;&#x6c60;&#x5316;</span>\n        h_pool2 = <span class=\"hljs-variable language_\">self</span>.create_conv_pool_layer(h_pool1,  <span class=\"hljs-comment\"># &#x8f93;&#x5165;&#x6570;&#x636e;&#xff1a;&#x4e0a;&#x4e00;&#x5c42;&#x7684;&#x8f93;&#x51fa;&#x4f5c;&#x4e3a;&#x8f93;&#x5165;</span>\n                                              <span class=\"hljs-variable language_\">self</span>.out_features1,  <span class=\"hljs-comment\"># &#x7b49;&#x4e8e;&#x4e0a;&#x4e00;&#x5c42;&#x8f93;&#x51fa;&#x901a;&#x9053;&#x6570;</span>\n                                              <span class=\"hljs-variable language_\">self</span>.out_features2)  <span class=\"hljs-comment\"># &#x672c;&#x5c42;&#x8f93;&#x51fa;&#x901a;&#x9053;&#x6570;</span>\n        <span class=\"hljs-comment\"># &#x5168;&#x8fde;&#x63a5;&#x5c42;(&#x8f93;&#x5165;&#x5168;&#x8fde;&#x63a5;&#x5c42;&#x4e4b;&#x524d;&#x9700;&#x8981;&#x53d8;&#x7ef4;&#xff0c;&#x62c9;&#x4f38;&#x6210;&#x4e00;&#x7ef4;)</span>\n        h_pool2_flat_featrues = <span class=\"hljs-number\">7</span> * <span class=\"hljs-number\">7</span> * <span class=\"hljs-variable language_\">self</span>.out_features2  <span class=\"hljs-comment\"># &#x8ba1;&#x7b97;&#x7279;&#x5f81;&#x70b9;&#x6570;&#x91cf;</span>\n        h_pool2_flat = tf.reshape(h_pool2, [-<span class=\"hljs-number\">1</span>, h_pool2_flat_featrues])  <span class=\"hljs-comment\"># &#x53d8;&#x6210;&#x4e00;&#x7ef4;</span>\n\n        h_fc = <span class=\"hljs-variable language_\">self</span>.create_fc_layer(h_pool2_flat,  <span class=\"hljs-comment\"># &#x8f93;&#x5165;&#x6570;&#x636e;</span>\n                                    h_pool2_flat_featrues,  <span class=\"hljs-comment\"># &#x8f93;&#x5165;&#x6570;&#x636e;&#x7279;&#x5f81;&#x6570;&#x91cf;</span>\n                                    <span class=\"hljs-variable language_\">self</span>.con_neurons)  <span class=\"hljs-comment\"># &#x8f93;&#x51fa;&#x7279;&#x5f81;&#x6570;&#x91cf;</span>\n        <span class=\"hljs-comment\"># dropout&#x5c42;</span>\n        <span class=\"hljs-variable language_\">self</span>.keep_prob = tf.placeholder(<span class=\"hljs-string\">&quot;float&quot;</span>)  <span class=\"hljs-comment\"># &#x4e22;&#x5f03;&#x7387;</span>\n        h_fc1_drop = tf.nn.dropout(h_fc, <span class=\"hljs-variable language_\">self</span>.keep_prob)  <span class=\"hljs-comment\"># dropout&#x8ba1;&#x7b97;</span>\n\n        <span class=\"hljs-comment\"># &#x8f93;&#x51fa;&#x5c42;</span>\n        w_fc = <span class=\"hljs-variable language_\">self</span>.init_weight_variable([<span class=\"hljs-variable language_\">self</span>.con_neurons, <span class=\"hljs-number\">10</span>])  <span class=\"hljs-comment\"># 512&#x884c;10&#x5217;&#xff0c;&#x4ea7;&#x751f;10&#x4e2a;&#x8f93;&#x51fa;</span>\n        b_fc = <span class=\"hljs-variable language_\">self</span>.init_bias_variable([<span class=\"hljs-number\">10</span>])  <span class=\"hljs-comment\"># 10&#x4e2a;&#x504f;&#x7f6e;</span>\n        y_conv = tf.matmul(h_fc1_drop, w_fc) + b_fc  <span class=\"hljs-comment\"># &#x8ba1;&#x7b97;&#x5168;&#x8fde;&#x63a5;&#xff0c;&#x5f97;&#x5230;&#x7684;&#x7ed3;&#x679c;&#x4e3a;&#x9884;&#x6d4b;&#x7ed3;&#x679c;</span>\n\n        <span class=\"hljs-comment\"># &#x8bc4;&#x4ef7;</span>\n        correct_prediction = tf.equal(tf.argmax(y_conv, <span class=\"hljs-number\">1</span>),\n                                      tf.argmax(<span class=\"hljs-variable language_\">self</span>.y_, <span class=\"hljs-number\">1</span>))  <span class=\"hljs-comment\"># &#x6bd4;&#x8f83;&#x9884;&#x6d4b;&#x3001;&#x771f;&#x5b9e;&#x7ed3;&#x679c;</span>\n        <span class=\"hljs-variable language_\">self</span>.accuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))  <span class=\"hljs-comment\"># &#x8ba1;&#x7b97;&#x51c6;&#x786e;&#x7387;</span>\n\n        <span class=\"hljs-comment\"># &#x635f;&#x5931;&#x51fd;&#x6570;</span>\n        loss_func = tf.nn.softmax_cross_entropy_with_logits(labels=<span class=\"hljs-variable language_\">self</span>.y_,  <span class=\"hljs-comment\"># &#x771f;&#x5b9e;&#x7ed3;&#x679c;</span>\n                                                            logits=y_conv)  <span class=\"hljs-comment\"># &#x9884;&#x6d4b;&#x7ed3;&#x679c;</span>\n        cross_entropy = tf.reduce_mean(loss_func)  <span class=\"hljs-comment\"># &#x6c42;&#x5747;&#x503c;</span>\n        <span class=\"hljs-comment\"># &#x4f18;&#x5316;&#x5668;</span>\n        optimizer = tf.train.AdamOptimizer(<span class=\"hljs-number\">0.001</span>)  <span class=\"hljs-comment\"># &#x81ea;&#x9002;&#x5e94;&#x68af;&#x5ea6;&#x4e0b;&#x964d;&#x4f18;&#x5316;&#x5668;(&#x8c03;&#x6574;&#x5b66;&#x4e60;&#x7387;)</span>\n        <span class=\"hljs-variable language_\">self</span>.train_step = optimizer.minimize(cross_entropy)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">train</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;\n        &#x8bad;&#x7ec3;\n        :return:\n        &quot;&quot;&quot;</span>\n        <span class=\"hljs-variable language_\">self</span>.sess.run(tf.global_variables_initializer())  <span class=\"hljs-comment\"># &#x521d;&#x59cb;&#x5316;</span>\n        merged = tf.summary.merge_all()  <span class=\"hljs-comment\"># &#x6458;&#x8981;&#x4fe1;&#x606f;&#x5408;&#x5e76;&#x64cd;&#x4f5c;</span>\n\n        batch_size = <span class=\"hljs-number\">100</span>  <span class=\"hljs-comment\"># &#x6279;&#x6b21;&#x5927;&#x5c0f;</span>\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;begin trainging...&quot;</span>)\n\n        <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">20</span>):\n            total_batch = <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-variable language_\">self</span>.data.train.num_examples / batch_size)  <span class=\"hljs-comment\"># &#x8ba1;&#x7b97;&#x6bcf;&#x8f6e;&#x8bad;&#x7ec3;&#x6279;&#x6b21;&#x6570;</span>\n\n            <span class=\"hljs-keyword\">for</span> j <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(total_batch):\n                batch = <span class=\"hljs-variable language_\">self</span>.data.train.next_batch(batch_size)  <span class=\"hljs-comment\"># &#x4ece;&#x8bad;&#x7ec3;&#x96c6;&#x83b7;&#x53d6;&#x4e00;&#x4e2a;&#x6279;&#x6b21;&#x6837;&#x672c;</span>\n                params = {<span class=\"hljs-variable language_\">self</span>.x: batch[<span class=\"hljs-number\">0</span>], <span class=\"hljs-variable language_\">self</span>.y_: batch[<span class=\"hljs-number\">1</span>],  <span class=\"hljs-comment\"># &#x56fe;&#x50cf;&#x3001;&#x771f;&#x5b9e;&#x7c7b;&#x522b;</span>\n                          <span class=\"hljs-variable language_\">self</span>.keep_prob: <span class=\"hljs-number\">0.5</span>}  <span class=\"hljs-comment\"># &#x4e22;&#x5f03;&#x7387;</span>\n\n                t, acc = <span class=\"hljs-variable language_\">self</span>.sess.run([<span class=\"hljs-variable language_\">self</span>.train_step, <span class=\"hljs-variable language_\">self</span>.accuracy],  <span class=\"hljs-comment\"># &#x8981;&#x6267;&#x884c;&#x7684;op</span>\n                                       params)  <span class=\"hljs-comment\"># &#x53c2;&#x6570;</span>\n\n                <span class=\"hljs-keyword\">if</span> j % <span class=\"hljs-number\">100</span> == <span class=\"hljs-number\">0</span>:\n                    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;epoch:%d, pass:%d, acc:%f&quot;</span> % (i, j, acc))\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">eval</span>(<span class=\"hljs-params\">self, x, y, keep_prob</span>):\n        params = {<span class=\"hljs-variable language_\">self</span>.x: x, <span class=\"hljs-variable language_\">self</span>.y_: y, <span class=\"hljs-variable language_\">self</span>.keep_prob: keep_prob}\n        test_acc = <span class=\"hljs-variable language_\">self</span>.sess.run(<span class=\"hljs-variable language_\">self</span>.accuracy, params)  <span class=\"hljs-comment\"># &#x8bc4;&#x4f30;&#x53ea;&#x6267;&#x884c;accuracy&#x64cd;&#x4f5c;</span>\n\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&quot;Test Accuracy:%f&quot;</span> % test_acc)\n        <span class=\"hljs-keyword\">return</span> test_acc\n\n    <span class=\"hljs-comment\"># &#x5173;&#x95ed;&#x4f1a;&#x8bdd;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">close</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-variable language_\">self</span>.sess.close()\n\n\n<span class=\"hljs-keyword\">if</span> __name__ == <span class=\"hljs-string\">&quot;__main__&quot;</span>:\n    mnist = FashionMnist(<span class=\"hljs-string\">&apos;FASHION_MNIST_data/&apos;</span>)\n    mnist.build()  <span class=\"hljs-comment\"># &#x7ec4;&#x5efa;CNN</span>\n    mnist.train()  <span class=\"hljs-comment\"># &#x8bad;&#x7ec3;</span>\n\n    <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;\\n----- Test -----&apos;</span>)\n    xs, ys = mnist.data.test.next_batch(<span class=\"hljs-number\">100</span>)  <span class=\"hljs-comment\"># &#x4ece;&#x6d4b;&#x8bd5;&#x96c6;&#x4e2d;&#x8bfb;&#x53d6;100&#x4e2a;&#x6837;&#x672c;</span>\n    mnist.<span class=\"hljs-built_in\">eval</span>(xs, ys, <span class=\"hljs-number\">0.5</span>)  <span class=\"hljs-comment\"># &#x8bc4;&#x4f30;&#x6a21;&#x578b;</span>\n    mnist.close()\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6,196"}},{"content":"<pre data-lines=\"197,213\"><code class=\"language-python\"><span class=\"hljs-comment\"># 02_paddle_add.py</span>\n<span class=\"hljs-comment\"># Paddle&#x7684;&#x7b2c;&#x4e00;&#x4e2a;&#x793a;&#x4f8b;&#xff1a;&#x4e24;&#x4e2a;&#x5f20;&#x91cf;&#x76f8;&#x52a0;</span>\n<span class=\"hljs-keyword\">import</span> paddle.fluid <span class=\"hljs-keyword\">as</span> fluid\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;&#x4e24;&#x4e2a;&#x5e38;&#x91cf;&#x6267;&#x884c;&#x76f8;&#x52a0;</span>\nx = fluid.layers.fill_constant(shape=[<span class=\"hljs-number\">1</span>], dtype=<span class=\"hljs-string\">&quot;int64&quot;</span>, value=<span class=\"hljs-number\">5</span>)\ny = fluid.layers.fill_constant(shape=[<span class=\"hljs-number\">1</span>], dtype=<span class=\"hljs-string\">&quot;int64&quot;</span>, value=<span class=\"hljs-number\">1</span>)\nz = x + y  <span class=\"hljs-comment\"># z&#x662f;&#x4e00;&#x4e2a;&#x64cd;&#x4f5c;&#xff0c;&#x6ca1;&#x6709;run&#xff0c;&#x6240;&#x4ee5;&#x6ca1;&#x6709;&#x503c;</span>\n\nplace = fluid.CPUPlace() <span class=\"hljs-comment\"># &#x6307;&#x5b9a;&#x8fd0;&#x884c;&#x5728;CPU&#x4e0a;</span>\nexe = fluid.Executor(place) <span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x6267;&#x884c;&#x5668;</span>\nresult = exe.run(fluid.default_main_program(), <span class=\"hljs-comment\"># &#x6307;&#x5b9a;&#x8fd0;&#x884c;&#x90a3;&#x4e2a;program, &#x4f1a;&#x6267;&#x884c;program&#x4e2d;&#x7684;&#x6240;&#x6709;&#x64cd;&#x4f5c;</span>\n                 fetch_list=[z]) <span class=\"hljs-comment\"># &#x6307;&#x5b9a;&#x9700;&#x8981;&#x8fd4;&#x56de;&#x4ec0;&#x4e48;&#x7ed3;&#x679c;</span>\n<span class=\"hljs-built_in\">print</span>(result)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"197,213"}},{"content":"<pre data-lines=\"214,242\"><code class=\"language-python\"><span class=\"hljs-comment\"># 03_tensor_add.py</span>\n<span class=\"hljs-comment\"># &#x9ad8;&#x7eac;&#x5ea6;&#x5f20;&#x91cf;&#x76f8;&#x52a0;&#x793a;&#x4f8b;</span>\n<span class=\"hljs-keyword\">import</span> paddle.fluid <span class=\"hljs-keyword\">as</span> fluid\n<span class=\"hljs-keyword\">import</span> numpy\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;&#x4e24;&#x4e2a;&#x53d8;&#x91cf;</span>\nx = fluid.layers.data(name=<span class=\"hljs-string\">&quot;x&quot;</span>, shape=[<span class=\"hljs-number\">1</span>], dtype=<span class=\"hljs-string\">&quot;float32&quot;</span>)\ny = fluid.layers.data(name=<span class=\"hljs-string\">&quot;y&quot;</span>, shape=[<span class=\"hljs-number\">1</span>], dtype=<span class=\"hljs-string\">&quot;float32&quot;</span>)\nresult = fluid.layers.elementwise_add(x, y)  <span class=\"hljs-comment\"># &#x5f20;&#x91cf;&#x6309;&#x5143;&#x7d20;&#x76f8;&#x52a0;</span>\n\nplace = fluid.CPUPlace()  <span class=\"hljs-comment\"># &#x6307;&#x5b9a;&#x8fd0;&#x884c;&#x5728;CPU&#x4e0a;</span>\nexe = fluid.Executor(place)  <span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x6267;&#x884c;&#x5668;</span>\nexe.run(fluid.default_startup_program()) <span class=\"hljs-comment\"># &#x521d;&#x59cb;&#x5316;</span>\n\n<span class=\"hljs-comment\"># a = numpy.array([1, 2, 3])</span>\n<span class=\"hljs-comment\"># b = numpy.array([4, 5, 6])</span>\na = numpy.array([[<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>], [<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">2</span>]])\nb = numpy.array([[<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">3</span>], [<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">4</span>]])\nparams = {<span class=\"hljs-string\">&quot;x&quot;</span>: a, <span class=\"hljs-string\">&quot;y&quot;</span>: b}\n\nout = exe.run(fluid.default_main_program(),  <span class=\"hljs-comment\"># &#x6307;&#x5b9a;&#x8fd0;&#x884c;&#x90a3;&#x4e2a;program, &#x4f1a;&#x6267;&#x884c;program&#x4e2d;&#x7684;&#x6240;&#x6709;&#x64cd;&#x4f5c;</span>\n              feed=params, <span class=\"hljs-comment\"># &#x5582;&#x5165;&#x53c2;&#x6570;</span>\n              fetch_list=[result])  <span class=\"hljs-comment\"># &#x6307;&#x5b9a;&#x9700;&#x8981;&#x8fd4;&#x56de;&#x4ec0;&#x4e48;&#x7ed3;&#x679c;</span>\n\n<span class=\"hljs-built_in\">print</span>(out)\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"214,242"}},{"content":"<pre data-lines=\"243,314\"><code class=\"language-python\"><span class=\"hljs-comment\"># 04_paddle_lr.py</span>\n<span class=\"hljs-comment\"># &#x5229;&#x7528;PaddlePaddle&#x5b9e;&#x73b0;&#x7ebf;&#x6027;&#x56de;&#x5f52;</span>\n<span class=\"hljs-keyword\">import</span> paddle\n<span class=\"hljs-keyword\">import</span> paddle.fluid <span class=\"hljs-keyword\">as</span> fluid\n<span class=\"hljs-keyword\">import</span> numpy <span class=\"hljs-keyword\">as</span> np\n<span class=\"hljs-keyword\">import</span> matplotlib.pyplot <span class=\"hljs-keyword\">as</span> plt\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;&#x6570;&#x636e;</span>\ntrain_data = np.array([[<span class=\"hljs-number\">0.5</span>], [<span class=\"hljs-number\">0.6</span>], [<span class=\"hljs-number\">0.8</span>], [<span class=\"hljs-number\">1.1</span>], [<span class=\"hljs-number\">1.4</span>]]).astype(<span class=\"hljs-string\">&quot;float32&quot;</span>)\ny_true = np.array([[<span class=\"hljs-number\">5.0</span>], [<span class=\"hljs-number\">5.5</span>], [<span class=\"hljs-number\">6.0</span>], [<span class=\"hljs-number\">6.8</span>], [<span class=\"hljs-number\">6.8</span>]]).astype(<span class=\"hljs-string\">&quot;float32&quot;</span>)\n\nx = fluid.layers.data(name=<span class=\"hljs-string\">&quot;x&quot;</span>, shape=[<span class=\"hljs-number\">1</span>], dtype=<span class=\"hljs-string\">&quot;float32&quot;</span>)\ny = fluid.layers.data(name=<span class=\"hljs-string\">&quot;y&quot;</span>, shape=[<span class=\"hljs-number\">1</span>], dtype=<span class=\"hljs-string\">&quot;float32&quot;</span>)\n\n<span class=\"hljs-comment\"># &#x5b9a;&#x4e49;&#x7f51;&#x7edc;&#x6a21;&#x578b;&#x3001;&#x635f;&#x5931;&#x51fd;&#x6570;&#x3001;&#x6267;&#x884c;&#x5668;&#x3001;&#x4f18;&#x5316;&#x5668;</span>\ny_predict = fluid.layers.fc(<span class=\"hljs-built_in\">input</span>=x, <span class=\"hljs-comment\"># &#x8f93;&#x5165;&#x6570;&#x636e;</span>\n                            size=<span class=\"hljs-number\">1</span>, <span class=\"hljs-comment\"># &#x8f93;&#x51fa;&#x503c;&#x7684;&#x4e2a;&#x6570;(&#x56de;&#x5f52;&#x95ee;&#x9898;&#xff0c;&#x6240;&#x4ee5;&#x8f93;&#x51fa;&#x4e00;&#x4e2a;&#x503c;)</span>\n                            act=<span class=\"hljs-literal\">None</span>) <span class=\"hljs-comment\"># &#x6fc0;&#x6d3b;&#x51fd;&#x6570;(&#x56de;&#x5f52;&#x95ee;&#x9898;&#x4e0d;&#x4f7f;&#x7528;&#x6fc0;&#x6d3b;&#x51fd;&#x6570;)</span>\n<span class=\"hljs-comment\"># &#x635f;&#x5931;&#x51fd;&#x6570;</span>\ncost = fluid.layers.square_error_cost(<span class=\"hljs-built_in\">input</span>=y_predict, <span class=\"hljs-comment\"># &#x9884;&#x6d4b;&#x503c;</span>\n                                      label=y) <span class=\"hljs-comment\"># &#x771f;&#x5b9e;&#x503c;</span>\navg_cost = fluid.layers.mean(cost) <span class=\"hljs-comment\"># &#x5bf9;&#x5dee;&#x503c;&#x5e73;&#x65b9;&#x8ba1;&#x7b97;&#x5e73;&#x5747;&#x503c;(&#x5747;&#x65b9;&#x5dee;)</span>\noptimizer = fluid.optimizer.SGD(learning_rate=<span class=\"hljs-number\">0.01</span>) <span class=\"hljs-comment\"># &#x968f;&#x673a;&#x68af;&#x5ea6;&#x4e0b;&#x964d;&#x4f18;&#x5316;&#x5668;</span>\noptimizer.minimize(avg_cost) <span class=\"hljs-comment\"># &#x6700;&#x5c0f;&#x5316;&#x635f;&#x5931;&#x51fd;&#x6570;&#x503c;</span>\n\nplace = fluid.CPUPlace()\nexe = fluid.Executor(place)\nexe.run(fluid.default_startup_program()) <span class=\"hljs-comment\"># &#x521d;&#x59cb;&#x5316;</span>\n\n<span class=\"hljs-comment\"># &#x8bad;&#x7ec3;&#x3001;&#x8fc7;&#x7a0b;&#x53ef;&#x89c6;&#x5316;</span>\ncosts = [] <span class=\"hljs-comment\"># &#x8bb0;&#x5f55;&#x635f;&#x5931;&#x503c;</span>\niters = [] <span class=\"hljs-comment\"># &#x8bb0;&#x5f55;&#x8fed;&#x4ee3;&#x6b21;&#x6570;</span>\nparams = {<span class=\"hljs-string\">&quot;x&quot;</span>:train_data, <span class=\"hljs-string\">&quot;y&quot;</span>:y_true} <span class=\"hljs-comment\"># &#x5582;&#x5165;&#x7684;&#x53c2;&#x6570;</span>\n\n<span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">10</span>):\n    outs = exe.run(feed=params, <span class=\"hljs-comment\"># &#x5582;&#x5165;&#x53c2;&#x6570;</span>\n                   fetch_list=[y_predict.name, avg_cost.name]) <span class=\"hljs-comment\"># &#x83b7;&#x53d6;&#x54ea;&#x4e9b;&#x7ed3;&#x679c;</span>\n    iters.append(i) <span class=\"hljs-comment\"># &#x8bb0;&#x5f55;&#x8fed;&#x4ee3;&#x6b21;&#x6570;</span>\n    costs.append(outs[<span class=\"hljs-number\">1</span>][<span class=\"hljs-number\">0</span>]) <span class=\"hljs-comment\"># &#x8bb0;&#x5f55;&#x6bcf;&#x6b21;&#x635f;&#x5931;&#x51fd;&#x6570;&#x7684;&#x503c;&#xff0c;&#x56e0;&#x4e3a;outs&#x4e2d;&#x653e;&#x4e86;&#x591a;&#x4e2a;&#x7ed3;&#x679c;&#xff0c;&#x6240;&#x4ee5;&#x901a;&#x8fc7;&#x4e0b;&#x6807;&#x83b7;&#x53d6;</span>\n\n<span class=\"hljs-comment\"># &#x53ef;&#x89c6;&#x5316;</span>\n<span class=\"hljs-comment\"># &#x7ebf;&#x6027;&#x6a21;&#x578b;&#x53ef;&#x89c6;&#x5316;</span>\ntmp = np.random.rand(<span class=\"hljs-number\">10</span>, <span class=\"hljs-number\">1</span>)\ntmp = tmp * <span class=\"hljs-number\">2</span>\ntmp.sort(axis=<span class=\"hljs-number\">0</span>)\nx_test = np.array(tmp).astype(<span class=\"hljs-string\">&quot;float32&quot;</span>)\nparams = {<span class=\"hljs-string\">&quot;x&quot;</span>: x_test, <span class=\"hljs-string\">&quot;y&quot;</span>:x_test}\ny_out = exe.run(feed=params, fetch_list=[y_predict.name])\ny_test = y_out[<span class=\"hljs-number\">0</span>]\n\n<span class=\"hljs-comment\"># &#x635f;&#x5931;&#x51fd;&#x6570;&#x53ef;&#x89c6;&#x5316;</span>\nplt.figure(<span class=\"hljs-string\">&quot;Trainging&quot;</span>)\nplt.title(<span class=\"hljs-string\">&quot;Training Cost&quot;</span>, fontsize=<span class=\"hljs-number\">24</span>)\nplt.xlabel(<span class=\"hljs-string\">&quot;Iter&quot;</span>, fontsize=<span class=\"hljs-number\">14</span>)\nplt.ylabel(<span class=\"hljs-string\">&quot;Cost&quot;</span>, fontsize=<span class=\"hljs-number\">14</span>)\nplt.plot(iters, costs, color=<span class=\"hljs-string\">&quot;red&quot;</span>, label=<span class=\"hljs-string\">&quot;Training Cost&quot;</span>)\nplt.grid()\nplt.savefig(<span class=\"hljs-string\">&quot;cost.png&quot;</span>)\n\n<span class=\"hljs-comment\"># &#x7ebf;&#x6027;&#x6a21;&#x578b;&#x53ef;&#x89c6;&#x5316;</span>\nplt.figure(<span class=\"hljs-string\">&quot;Inference&quot;</span>)\nplt.title(<span class=\"hljs-string\">&quot;Linear Regression&quot;</span>, fontsize=<span class=\"hljs-number\">24</span>)\nplt.plot(x_test, y_test, color=<span class=\"hljs-string\">&quot;red&quot;</span>, label=<span class=\"hljs-string\">&quot;inference&quot;</span>)\nplt.scatter(train_data, y_true)\nplt.savefig(<span class=\"hljs-string\">&quot;linear.png&quot;</span>)\n\nplt.legend()\nplt.grid()\nplt.show()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"243,314"}}],"payload":{"tag":"h5","lines":"4,5"}}],"payload":{"tag":"h3","lines":"0,1"}},{})</script>
</body>
</html>
