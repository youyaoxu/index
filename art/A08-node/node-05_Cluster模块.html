<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"Cluster&#x6a21;&#x5757;","children":[{"content":"&#x8ba4;&#x8bc6;","children":[{"content":"<pre data-lines=\"4,20\"><code data-lines=\"4,20\">&#x76ee;&#x5f55;\n&#x6982;&#x8ff0;\n    &#x57fa;&#x672c;&#x7528;&#x6cd5;\n    <span class=\"hljs-variable\">worker</span>&#x5bf9;&#x8c61;\n    <span class=\"hljs-variable\">cluster.workers</span>&#x5bf9;&#x8c61;\n<span class=\"hljs-variable\">cluster</span>&#x6a21;&#x5757;&#x7684;&#x5c5e;&#x6027;&#x4e0e;&#x65b9;&#x6cd5;\n    <span class=\"hljs-variable\">isMaster</span>&#xff0c;<span class=\"hljs-variable\">isWorker</span>\n    <span class=\"hljs-function\"><span class=\"hljs-title\">fork</span>()</span>\n    <span class=\"hljs-function\"><span class=\"hljs-title\">kill</span>()</span>\n    <span class=\"hljs-variable\">listening</span>&#x4e8b;&#x4ef6;\n&#x4e0d;&#x4e2d;&#x65ad;&#x5730;&#x91cd;&#x542f;<span class=\"hljs-variable\">Node</span>&#x670d;&#x52a1;\n    &#x601d;&#x8def;\n    &#x5b9e;&#x4f8b;\n<span class=\"hljs-variable\">PM2</span>&#x6a21;&#x5757;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"4,20"}}],"payload":{"tag":"h2","lines":"2,3"}},{"content":"&#x6982;&#x8ff0;","children":[{"content":"&#x57fa;&#x672c;&#x7528;&#x6cd5;","children":[{"content":"<pre data-lines=\"25,28\"><code>Node.js&#x9ed8;&#x8ba4;&#x5355;&#x8fdb;&#x7a0b;&#x8fd0;&#x884c;&#xff0c;&#x5bf9;&#x4e8e;32&#x4f4d;&#x7cfb;&#x7edf;&#x6700;&#x9ad8;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;512MB&#x5185;&#x5b58;&#xff0c;&#x5bf9;&#x4e8e;64&#x4f4d;&#x6700;&#x9ad8;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;1GB&#x5185;&#x5b58;&#x3002;&#x5bf9;&#x4e8e;&#x591a;&#x6838;CPU&#x7684;&#x8ba1;&#x7b97;&#x673a;&#x6765;&#x8bf4;&#xff0c;&#x8fd9;&#x6837;&#x505a;&#x6548;&#x7387;&#x5f88;&#x4f4e;&#xff0c;&#x56e0;&#x4e3a;&#x53ea;&#x6709;&#x4e00;&#x4e2a;&#x6838;&#x5728;&#x8fd0;&#x884c;&#xff0c;&#x5176;&#x4ed6;&#x6838;&#x90fd;&#x5728;&#x95f2;&#x7f6e;&#x3002;cluster&#x6a21;&#x5757;&#x5c31;&#x662f;&#x4e3a;&#x4e86;&#x89e3;&#x51b3;&#x8fd9;&#x4e2a;&#x95ee;&#x9898;&#x800c;&#x63d0;&#x51fa;&#x7684;&#x3002;\n\ncluster&#x6a21;&#x5757;&#x5141;&#x8bb8;&#x8bbe;&#x7acb;&#x4e00;&#x4e2a;&#x4e3b;&#x8fdb;&#x7a0b;&#x548c;&#x82e5;&#x5e72;&#x4e2a;worker&#x8fdb;&#x7a0b;&#xff0c;&#x7531;&#x4e3b;&#x8fdb;&#x7a0b;&#x76d1;&#x63a7;&#x548c;&#x534f;&#x8c03;worker&#x8fdb;&#x7a0b;&#x7684;&#x8fd0;&#x884c;&#x3002;worker&#x4e4b;&#x95f4;&#x91c7;&#x7528;&#x8fdb;&#x7a0b;&#x95f4;&#x901a;&#x4fe1;&#x4ea4;&#x6362;&#x6d88;&#x606f;&#xff0c;cluster&#x6a21;&#x5757;&#x5185;&#x7f6e;&#x4e00;&#x4e2a;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x5668;&#xff0c;&#x91c7;&#x7528;Round-robin&#x7b97;&#x6cd5;&#x534f;&#x8c03;&#x5404;&#x4e2a;worker&#x8fdb;&#x7a0b;&#x4e4b;&#x95f4;&#x7684;&#x8d1f;&#x8f7d;&#x3002;&#x8fd0;&#x884c;&#x65f6;&#xff0c;&#x6240;&#x6709;&#x65b0;&#x5efa;&#x7acb;&#x7684;&#x94fe;&#x63a5;&#x90fd;&#x7531;&#x4e3b;&#x8fdb;&#x7a0b;&#x5b8c;&#x6210;&#xff0c;&#x7136;&#x540e;&#x4e3b;&#x8fdb;&#x7a0b;&#x518d;&#x628a;TCP&#x8fde;&#x63a5;&#x5206;&#x914d;&#x7ed9;&#x6307;&#x5b9a;&#x7684;worker&#x8fdb;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"25,28"}},{"content":"<pre data-lines=\"29,44\"><code class=\"language-js\"><span class=\"hljs-keyword\">var</span> cluster = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&apos;cluster&apos;</span>);\n<span class=\"hljs-keyword\">var</span> os = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&apos;os&apos;</span>);\n\n<span class=\"hljs-keyword\">if</span> (cluster.<span class=\"hljs-property\">isMaster</span>){\n  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">0</span>, n = os.<span class=\"hljs-title function_\">cpus</span>().<span class=\"hljs-property\">length</span>; i &lt; n; i += <span class=\"hljs-number\">1</span>){\n    cluster.<span class=\"hljs-title function_\">fork</span>();\n  }\n} <span class=\"hljs-keyword\">else</span> {\n  http.<span class=\"hljs-title function_\">createServer</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">req, res</span>) {\n    res.<span class=\"hljs-title function_\">writeHead</span>(<span class=\"hljs-number\">200</span>);\n    res.<span class=\"hljs-title function_\">end</span>(<span class=\"hljs-string\">&quot;hello world\\n&quot;</span>);\n  }).<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">8000</span>);\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"29,44"}},{"content":"<pre data-lines=\"45,48\"><code>&#x4e0a;&#x9762;&#x4ee3;&#x7801;&#x5148;&#x5224;&#x65ad;&#x5f53;&#x524d;&#x8fdb;&#x7a0b;&#x662f;&#x5426;&#x4e3a;&#x4e3b;&#x8fdb;&#x7a0b;&#xff08;cluster.isMaster&#xff09;&#xff0c;&#x5982;&#x679c;&#x662f;&#x7684;&#xff0c;&#x5c31;&#x6309;&#x7167;CPU&#x7684;&#x6838;&#x6570;&#xff0c;&#x65b0;&#x5efa;&#x82e5;&#x5e72;&#x4e2a;worker&#x8fdb;&#x7a0b;&#xff1b;&#x5982;&#x679c;&#x4e0d;&#x662f;&#xff0c;&#x8bf4;&#x660e;&#x5f53;&#x524d;&#x8fdb;&#x7a0b;&#x662f;worker&#x8fdb;&#x7a0b;&#xff0c;&#x5219;&#x5728;&#x8be5;&#x8fdb;&#x7a0b;&#x542f;&#x52a8;&#x4e00;&#x4e2a;&#x670d;&#x52a1;&#x5668;&#x7a0b;&#x5e8f;&#x3002;\n\n&#x4e0a;&#x9762;&#x8fd9;&#x6bb5;&#x4ee3;&#x7801;&#x6709;&#x4e00;&#x4e2a;&#x7f3a;&#x70b9;&#xff0c;&#x5c31;&#x662f;&#x4e00;&#x65e6;work&#x8fdb;&#x7a0b;&#x6302;&#x4e86;&#xff0c;&#x4e3b;&#x8fdb;&#x7a0b;&#x65e0;&#x6cd5;&#x77e5;&#x9053;&#x3002;&#x4e3a;&#x4e86;&#x89e3;&#x51b3;&#x8fd9;&#x4e2a;&#x95ee;&#x9898;&#xff0c;&#x53ef;&#x4ee5;&#x5728;&#x4e3b;&#x8fdb;&#x7a0b;&#x90e8;&#x7f72;online&#x4e8b;&#x4ef6;&#x548c;exit&#x4e8b;&#x4ef6;&#x7684;&#x76d1;&#x542c;&#x51fd;&#x6570;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"45,48"}},{"content":"<pre data-lines=\"49,71\"><code class=\"language-js\"><span class=\"hljs-keyword\">var</span> cluster = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&apos;cluster&apos;</span>);\n\n<span class=\"hljs-keyword\">if</span>(cluster.<span class=\"hljs-property\">isMaster</span>) {\n  <span class=\"hljs-keyword\">var</span> numWorkers = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&apos;os&apos;</span>).<span class=\"hljs-title function_\">cpus</span>().<span class=\"hljs-property\">length</span>;\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;Master cluster setting up &apos;</span> + numWorkers + <span class=\"hljs-string\">&apos; workers...&apos;</span>);\n\n  <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">var</span> i = <span class=\"hljs-number\">0</span>; i &lt; numWorkers; i++) {\n    cluster.<span class=\"hljs-title function_\">fork</span>();\n  }\n\n  cluster.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&apos;online&apos;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">worker</span>) {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;Worker &apos;</span> + worker.<span class=\"hljs-property\">process</span>.<span class=\"hljs-property\">pid</span> + <span class=\"hljs-string\">&apos; is online&apos;</span>);\n  });\n\n  cluster.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&apos;exit&apos;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">worker, code, signal</span>) {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;Worker &apos;</span> + worker.<span class=\"hljs-property\">process</span>.<span class=\"hljs-property\">pid</span> + <span class=\"hljs-string\">&apos; died with code: &apos;</span> + code + <span class=\"hljs-string\">&apos;, and signal: &apos;</span> + signal);\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;Starting a new worker&apos;</span>);\n    cluster.<span class=\"hljs-title function_\">fork</span>();\n  });\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"49,71"}},{"content":"<pre data-lines=\"72,73\"><code>&#x4e0a;&#x9762;&#x4ee3;&#x7801;&#x4e2d;&#xff0c;&#x4e3b;&#x8fdb;&#x7a0b;&#x4e00;&#x65e6;&#x76d1;&#x542c;&#x5230;worker&#x8fdb;&#x7a0b;&#x7684;exit&#x4e8b;&#x4ef6;&#xff0c;&#x5c31;&#x4f1a;&#x91cd;&#x542f;&#x4e00;&#x4e2a;worker&#x8fdb;&#x7a0b;&#x3002;worker&#x8fdb;&#x7a0b;&#x4e00;&#x65e6;&#x542f;&#x52a8;&#x6210;&#x529f;&#xff0c;&#x53ef;&#x4ee5;&#x6b63;&#x5e38;&#x8fd0;&#x884c;&#x4e86;&#xff0c;&#x5c31;&#x4f1a;&#x53d1;&#x51fa;online&#x4e8b;&#x4ef6;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"72,73"}}],"payload":{"tag":"h3","lines":"23,24"}},{"content":"worker&#x5bf9;&#x8c61;","children":[{"content":"<pre data-lines=\"76,91\"><code>worker&#x5bf9;&#x8c61;&#x662f;cluster.fork()&#x7684;&#x8fd4;&#x56de;&#x503c;&#xff0c;&#x4ee3;&#x8868;&#x4e00;&#x4e2a;worker&#x8fdb;&#x7a0b;&#x3002;\n\n&#x5b83;&#x7684;&#x5c5e;&#x6027;&#x548c;&#x65b9;&#x6cd5;&#x5982;&#x4e0b;&#x3002;\n\n**&#xff08;1&#xff09;worker.id**\n\nworker.id&#x8fd4;&#x56de;&#x5f53;&#x524d;worker&#x7684;&#x72ec;&#x4e00;&#x65e0;&#x4e8c;&#x7684;&#x8fdb;&#x7a0b;&#x7f16;&#x53f7;&#x3002;&#x8fd9;&#x4e2a;&#x7f16;&#x53f7;&#x4e5f;&#x662f;cluster.workers&#x4e2d;&#x6307;&#x5411;&#x5f53;&#x524d;&#x8fdb;&#x7a0b;&#x7684;&#x7d22;&#x5f15;&#x503c;&#x3002;\n\n**&#xff08;2&#xff09;worker.process**\n\n&#x6240;&#x6709;&#x7684;worker&#x8fdb;&#x7a0b;&#x90fd;&#x662f;&#x7528;child_process.fork()&#x751f;&#x6210;&#x7684;&#x3002;child_process.fork()&#x8fd4;&#x56de;&#x7684;&#x5bf9;&#x8c61;&#xff0c;&#x5c31;&#x88ab;&#x4fdd;&#x5b58;&#x5728;worker.process&#x4e4b;&#x4e2d;&#x3002;&#x901a;&#x8fc7;&#x8fd9;&#x4e2a;&#x5c5e;&#x6027;&#xff0c;&#x53ef;&#x4ee5;&#x83b7;&#x53d6;worker&#x6240;&#x5728;&#x7684;&#x8fdb;&#x7a0b;&#x5bf9;&#x8c61;&#x3002;\n\n**&#xff08;3&#xff09;worker.send()**\n\n&#x8be5;&#x65b9;&#x6cd5;&#x7528;&#x4e8e;&#x5728;&#x4e3b;&#x8fdb;&#x7a0b;&#x4e2d;&#xff0c;&#x5411;&#x5b50;&#x8fdb;&#x7a0b;&#x53d1;&#x9001;&#x4fe1;&#x606f;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"76,91"}},{"content":"<pre data-lines=\"92,102\"><code class=\"language-js\"><span class=\"hljs-keyword\">if</span> (cluster.<span class=\"hljs-property\">isMaster</span>) {\n  <span class=\"hljs-keyword\">var</span> worker = cluster.<span class=\"hljs-title function_\">fork</span>();\n  worker.<span class=\"hljs-title function_\">send</span>(<span class=\"hljs-string\">&apos;hi there&apos;</span>);\n} <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (cluster.<span class=\"hljs-property\">isWorker</span>) {\n  process.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&apos;message&apos;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">msg</span>) {\n    process.<span class=\"hljs-title function_\">send</span>(msg);\n  });\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"92,102"}},{"content":"<pre data-lines=\"103,106\"><code>&#x4e0a;&#x9762;&#x4ee3;&#x7801;&#x7684;&#x4f5c;&#x7528;&#x662f;&#xff0c;worker&#x8fdb;&#x7a0b;&#x5bf9;&#x4e3b;&#x8fdb;&#x7a0b;&#x53d1;&#x51fa;&#x7684;&#x6bcf;&#x4e2a;&#x6d88;&#x606f;&#xff0c;&#x90fd;&#x505a;&#x56de;&#x58f0;&#x3002;\n\n&#x5728;worker&#x8fdb;&#x7a0b;&#x4e2d;&#xff0c;&#x8981;&#x5411;&#x4e3b;&#x8fdb;&#x7a0b;&#x53d1;&#x9001;&#x6d88;&#x606f;&#xff0c;&#x4f7f;&#x7528;process.send(message)&#xff1b;&#x8981;&#x76d1;&#x542c;&#x4e3b;&#x8fdb;&#x7a0b;&#x53d1;&#x51fa;&#x7684;&#x6d88;&#x606f;&#xff0c;&#x4f7f;&#x7528;&#x4e0b;&#x9762;&#x7684;&#x4ee3;&#x7801;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"103,106"}},{"content":"<pre data-lines=\"107,112\"><code class=\"language-js\">process.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&apos;message&apos;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">message</span>) {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(message);\n});\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"107,112"}},{"content":"<pre data-lines=\"113,114\"><code>&#x53d1;&#x51fa;&#x7684;&#x6d88;&#x606f;&#x53ef;&#x4ee5;&#x5b57;&#x7b26;&#x4e32;&#xff0c;&#x4e5f;&#x53ef;&#x4ee5;&#x662f;JSON&#x5bf9;&#x8c61;&#x3002;&#x4e0b;&#x9762;&#x662f;&#x4e00;&#x4e2a;&#x53d1;&#x9001;JSON&#x5bf9;&#x8c61;&#x7684;&#x4f8b;&#x5b50;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"113,114"}},{"content":"<pre data-lines=\"115,124\"><code class=\"language-js\">worker.<span class=\"hljs-title function_\">send</span>({\n  <span class=\"hljs-attr\">type</span>: <span class=\"hljs-string\">&apos;task 1&apos;</span>,\n  <span class=\"hljs-attr\">from</span>: <span class=\"hljs-string\">&apos;master&apos;</span>,\n  <span class=\"hljs-attr\">data</span>: {\n    <span class=\"hljs-comment\">// the data that you want to transfer</span>\n  }\n});\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"115,124"}}],"payload":{"tag":"h3","lines":"74,75"}}],"payload":{"tag":"h2","lines":"21,22"}},{"content":"cluster.workers&#x5bf9;&#x8c61;","children":[{"content":"<pre data-lines=\"127,128\"><code>&#x8be5;&#x5bf9;&#x8c61;&#x53ea;&#x6709;&#x4e3b;&#x8fdb;&#x7a0b;&#x624d;&#x6709;&#xff0c;&#x5305;&#x542b;&#x4e86;&#x6240;&#x6709;worker&#x8fdb;&#x7a0b;&#x3002;&#x6bcf;&#x4e2a;&#x6210;&#x5458;&#x7684;&#x952e;&#x503c;&#x5c31;&#x662f;&#x4e00;&#x4e2a;worker&#x8fdb;&#x7a0b;&#x5bf9;&#x8c61;&#xff0c;&#x952e;&#x540d;&#x5c31;&#x662f;&#x8be5;worker&#x8fdb;&#x7a0b;&#x7684;worker.id&#x5c5e;&#x6027;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"127,128"}},{"content":"<pre data-lines=\"129,139\"><code class=\"language-js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">eachWorker</span>(<span class=\"hljs-params\">callback</span>) {\n  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> id <span class=\"hljs-keyword\">in</span> cluster.<span class=\"hljs-property\">workers</span>) {\n    <span class=\"hljs-title function_\">callback</span>(cluster.<span class=\"hljs-property\">workers</span>[id]);\n  }\n}\n<span class=\"hljs-title function_\">eachWorker</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">worker</span>) {\n  worker.<span class=\"hljs-title function_\">send</span>(<span class=\"hljs-string\">&apos;big announcement to all workers&apos;</span>);\n});\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"129,139"}},{"content":"<pre data-lines=\"140,143\"><code>&#x4e0a;&#x9762;&#x4ee3;&#x7801;&#x7528;&#x6765;&#x904d;&#x5386;&#x6240;&#x6709;worker&#x8fdb;&#x7a0b;&#x3002;\n\n&#x5f53;&#x524d;socket&#x7684;data&#x4e8b;&#x4ef6;&#xff0c;&#x4e5f;&#x53ef;&#x4ee5;&#x7528;id&#x5c5e;&#x6027;&#x8bc6;&#x522b;worker&#x8fdb;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"140,143"}},{"content":"<pre data-lines=\"144,149\"><code class=\"language-js\">socket.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&apos;data&apos;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">id</span>) {\n  <span class=\"hljs-keyword\">var</span> worker = cluster.<span class=\"hljs-property\">workers</span>[id];\n});\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"144,149"}}],"payload":{"tag":"h2","lines":"125,126"}},{"content":"cluster&#x6a21;&#x5757;&#x7684;&#x5c5e;&#x6027;&#x4e0e;&#x65b9;&#x6cd5;","children":[{"content":"isMaster&#xff0c;isWorker","children":[{"content":"<pre data-lines=\"154,157\"><code>isMaster&#x5c5e;&#x6027;&#x8fd4;&#x56de;&#x4e00;&#x4e2a;&#x5e03;&#x5c14;&#x503c;&#xff0c;&#x8868;&#x793a;&#x5f53;&#x524d;&#x8fdb;&#x7a0b;&#x662f;&#x5426;&#x4e3a;&#x4e3b;&#x8fdb;&#x7a0b;&#x3002;&#x8fd9;&#x4e2a;&#x5c5e;&#x6027;&#x7531;process.env.NODE_UNIQUE_ID&#x51b3;&#x5b9a;&#xff0c;&#x5982;&#x679c;process.env.NODE_UNIQUE_ID&#x4e3a;&#x672a;&#x5b9a;&#x4e49;&#xff0c;&#x5c31;&#x8868;&#x793a;&#x8be5;&#x8fdb;&#x7a0b;&#x662f;&#x4e3b;&#x8fdb;&#x7a0b;&#x3002;\n\nisWorker&#x5c5e;&#x6027;&#x8fd4;&#x56de;&#x4e00;&#x4e2a;&#x5e03;&#x5c14;&#x503c;&#xff0c;&#x8868;&#x793a;&#x5f53;&#x524d;&#x8fdb;&#x7a0b;&#x662f;&#x5426;&#x4e3a;work&#x8fdb;&#x7a0b;&#x3002;&#x5b83;&#x4e0e;isMaster&#x5c5e;&#x6027;&#x7684;&#x503c;&#x6b63;&#x597d;&#x76f8;&#x53cd;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"154,157"}}],"payload":{"tag":"h3","lines":"152,153"}},{"content":"fork()","children":[{"content":"<pre data-lines=\"160,163\"><code>fork&#x65b9;&#x6cd5;&#x7528;&#x4e8e;&#x65b0;&#x5efa;&#x4e00;&#x4e2a;worker&#x8fdb;&#x7a0b;&#xff0c;&#x4e0a;&#x4e0b;&#x6587;&#x90fd;&#x590d;&#x5236;&#x4e3b;&#x8fdb;&#x7a0b;&#x3002;&#x53ea;&#x6709;&#x4e3b;&#x8fdb;&#x7a0b;&#x624d;&#x80fd;&#x8c03;&#x7528;&#x8fd9;&#x4e2a;&#x65b9;&#x6cd5;&#x3002;\n\n&#x8be5;&#x65b9;&#x6cd5;&#x8fd4;&#x56de;&#x4e00;&#x4e2a;worker&#x5bf9;&#x8c61;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"160,163"}}],"payload":{"tag":"h3","lines":"158,159"}},{"content":"kill()","children":[{"content":"<pre data-lines=\"166,171\"><code>kill&#x65b9;&#x6cd5;&#x7528;&#x4e8e;&#x7ec8;&#x6b62;worker&#x8fdb;&#x7a0b;&#x3002;&#x5b83;&#x53ef;&#x4ee5;&#x63a5;&#x53d7;&#x4e00;&#x4e2a;&#x53c2;&#x6570;&#xff0c;&#x8868;&#x793a;&#x7cfb;&#x7edf;&#x4fe1;&#x53f7;&#x3002;\n\n&#x5982;&#x679c;&#x5f53;&#x524d;&#x662f;&#x4e3b;&#x8fdb;&#x7a0b;&#xff0c;&#x5c31;&#x4f1a;&#x7ec8;&#x6b62;&#x4e0e;worker.process&#x7684;&#x8054;&#x7edc;&#xff0c;&#x7136;&#x540e;&#x5c06;&#x7cfb;&#x7edf;&#x4fe1;&#x53f7;&#x6cd5;&#x53d1;&#x5411;worker&#x8fdb;&#x7a0b;&#x3002;&#x5982;&#x679c;&#x5f53;&#x524d;&#x662f;worker&#x8fdb;&#x7a0b;&#xff0c;&#x5c31;&#x4f1a;&#x7ec8;&#x6b62;&#x4e0e;&#x4e3b;&#x8fdb;&#x7a0b;&#x7684;&#x901a;&#x4fe1;&#xff0c;&#x7136;&#x540e;&#x9000;&#x51fa;&#xff0c;&#x8fd4;&#x56de;0&#x3002;\n\n&#x5728;&#x4ee5;&#x524d;&#x7684;&#x7248;&#x672c;&#x4e2d;&#xff0c;&#x8be5;&#x65b9;&#x6cd5;&#x4e5f;&#x53eb;&#x505a; worker.destroy() &#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"166,171"}}],"payload":{"tag":"h3","lines":"164,165"}},{"content":"listening&#x4e8b;&#x4ef6;","children":[{"content":"<pre data-lines=\"174,177\"><code>worker&#x8fdb;&#x7a0b;&#x8c03;&#x7528;listening&#x65b9;&#x6cd5;&#x4ee5;&#x540e;&#xff0c;&#x201c;listening&#x201d;&#x4e8b;&#x4ef6;&#x5c31;&#x4f20;&#x5411;&#x8be5;&#x8fdb;&#x7a0b;&#x7684;&#x670d;&#x52a1;&#x5668;&#xff0c;&#x7136;&#x540e;&#x4f20;&#x5411;&#x4e3b;&#x8fdb;&#x7a0b;&#x3002;\n\n&#x8be5;&#x4e8b;&#x4ef6;&#x7684;&#x56de;&#x8c03;&#x51fd;&#x6570;&#x63a5;&#x53d7;&#x4e24;&#x4e2a;&#x53c2;&#x6570;&#xff0c;&#x4e00;&#x4e2a;&#x662f;&#x5f53;&#x524d;worker&#x5bf9;&#x8c61;&#xff0c;&#x53e6;&#x4e00;&#x4e2a;&#x662f;&#x5730;&#x5740;&#x5bf9;&#x8c61;&#xff0c;&#x5305;&#x542b;&#x7f51;&#x5740;&#x3001;&#x7aef;&#x53e3;&#x3001;&#x5730;&#x5740;&#x7c7b;&#x578b;&#xff08;IPv4&#x3001;IPv6&#x3001;Unix socket&#x3001;UDP&#xff09;&#x7b49;&#x4fe1;&#x606f;&#x3002;&#x8fd9;&#x5bf9;&#x4e8e;&#x90a3;&#x4e9b;&#x670d;&#x52a1;&#x591a;&#x4e2a;&#x7f51;&#x5740;&#x7684;Node&#x5e94;&#x7528;&#x7a0b;&#x5e8f;&#x975e;&#x5e38;&#x6709;&#x7528;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"174,177"}},{"content":"<pre data-lines=\"178,183\"><code class=\"language-js\">cluster.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&apos;listening&apos;</span>, <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">worker, address</span>) {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;A worker is now connected to &quot;</span> + address.<span class=\"hljs-property\">address</span> + <span class=\"hljs-string\">&quot;:&quot;</span> + address.<span class=\"hljs-property\">port</span>);\n});\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"178,183"}}],"payload":{"tag":"h3","lines":"172,173"}}],"payload":{"tag":"h2","lines":"150,151"}},{"content":"&#x4e0d;&#x4e2d;&#x65ad;&#x5730;&#x91cd;&#x542f;Node&#x670d;&#x52a1;","children":[{"content":"&#x601d;&#x8def;","children":[{"content":"<pre data-lines=\"188,194\"><code>&#x91cd;&#x542f;&#x670d;&#x52a1;&#x9700;&#x8981;&#x5173;&#x95ed;&#x540e;&#x518d;&#x542f;&#x52a8;&#xff0c;&#x5229;&#x7528;cluster&#x6a21;&#x5757;&#xff0c;&#x53ef;&#x4ee5;&#x505a;&#x5230;&#x5148;&#x542f;&#x52a8;&#x4e00;&#x4e2a;worker&#x8fdb;&#x7a0b;&#xff0c;&#x518d;&#x628a;&#x539f;&#x6709;&#x7684;&#x6240;&#x6709;work&#x8fdb;&#x7a0b;&#x5173;&#x95ed;&#x3002;&#x8fd9;&#x6837;&#x5c31;&#x80fd;&#x5b9e;&#x73b0;&#x4e0d;&#x4e2d;&#x65ad;&#x5730;&#x91cd;&#x542f;Node&#x670d;&#x52a1;&#x3002;\n\n&#x9996;&#x5148;&#xff0c;&#x4e3b;&#x8fdb;&#x7a0b;&#x5411;worker&#x8fdb;&#x7a0b;&#x53d1;&#x51fa;&#x91cd;&#x542f;&#x4fe1;&#x53f7;&#x3002;\n\nworkers[wid].send({type: &apos;shutdown&apos;, from: &apos;master&apos;});\nworker&#x8fdb;&#x7a0b;&#x76d1;&#x542c;message&#x4e8b;&#x4ef6;&#xff0c;&#x4e00;&#x65e6;&#x53d1;&#x73b0;&#x5185;&#x5bb9;&#x662f;shutdown&#xff0c;&#x5c31;&#x9000;&#x51fa;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"188,194"}},{"content":"<pre data-lines=\"195,202\"><code class=\"language-js\">process.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&apos;message&apos;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">message</span>) {\n  <span class=\"hljs-keyword\">if</span>(message.<span class=\"hljs-property\">type</span> === <span class=\"hljs-string\">&apos;shutdown&apos;</span>) {\n    process.<span class=\"hljs-title function_\">exit</span>(<span class=\"hljs-number\">0</span>);\n  }\n});\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"195,202"}},{"content":"<pre data-lines=\"203,204\"><code>&#x4e0b;&#x9762;&#x662f;&#x4e00;&#x4e2a;&#x5173;&#x95ed;&#x6240;&#x6709;worker&#x8fdb;&#x7a0b;&#x7684;&#x51fd;&#x6570;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"203,204"}},{"content":"<pre data-lines=\"205,225\"><code class=\"language-js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">restartWorkers</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">var</span> wid, workerIds = [];\n  <span class=\"hljs-keyword\">for</span>(wid <span class=\"hljs-keyword\">in</span> cluster.<span class=\"hljs-property\">workers</span>) {\n    workerIds.<span class=\"hljs-title function_\">push</span>(wid);\n  }\n\n  workerIds.<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">wid</span>) {\n    cluster.<span class=\"hljs-property\">workers</span>[wid].<span class=\"hljs-title function_\">send</span>({\n      <span class=\"hljs-attr\">text</span>: <span class=\"hljs-string\">&apos;shutdown&apos;</span>,\n      <span class=\"hljs-attr\">from</span>: <span class=\"hljs-string\">&apos;master&apos;</span>\n     });\n    <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) {\n      <span class=\"hljs-keyword\">if</span>(cluster.<span class=\"hljs-property\">workers</span>[wid]) {\n        cluster.<span class=\"hljs-property\">workers</span>[wid].<span class=\"hljs-title function_\">kill</span>(<span class=\"hljs-string\">&apos;SIGKILL&apos;</span>);\n      }\n    }, <span class=\"hljs-number\">5000</span>);\n  });\n};\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"205,225"}},{"content":"<pre data-lines=\"226,228\"><code>&#x5b9e;&#x4f8b;\n&#x4e0b;&#x9762;&#x662f;&#x4e00;&#x4e2a;&#x5b8c;&#x6574;&#x7684;&#x5b9e;&#x4f8b;&#xff0c;&#x5148;&#x662f;&#x4e3b;&#x8fdb;&#x7a0b;&#x7684;&#x4ee3;&#x7801;master.js&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"226,228"}},{"content":"<pre data-lines=\"229,249\"><code class=\"language-js\"><span class=\"hljs-keyword\">var</span> cluster = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&apos;cluster&apos;</span>);\n\n<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;started master with &apos;</span> + process.<span class=\"hljs-property\">pid</span>);\n\n<span class=\"hljs-comment\">// &#x65b0;&#x5efa;&#x4e00;&#x4e2a;worker&#x8fdb;&#x7a0b;</span>\ncluster.<span class=\"hljs-title function_\">fork</span>();\n\nprocess.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&apos;SIGHUP&apos;</span>, <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;Reloading...&apos;</span>);\n  <span class=\"hljs-keyword\">var</span> new_worker = cluster.<span class=\"hljs-title function_\">fork</span>();\n  new_worker.<span class=\"hljs-title function_\">once</span>(<span class=\"hljs-string\">&apos;listening&apos;</span>, <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) {\n    <span class=\"hljs-comment\">// &#x5173;&#x95ed;&#x6240;&#x6709;&#x5176;&#x4ed6;worker&#x8fdb;&#x7a0b;</span>\n    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">var</span> id <span class=\"hljs-keyword\">in</span> cluster.<span class=\"hljs-property\">workers</span>) {\n      <span class=\"hljs-keyword\">if</span> (id === new_worker.<span class=\"hljs-property\">id</span>.<span class=\"hljs-title function_\">toString</span>()) <span class=\"hljs-keyword\">continue</span>;\n      cluster.<span class=\"hljs-property\">workers</span>[id].<span class=\"hljs-title function_\">kill</span>(<span class=\"hljs-string\">&apos;SIGTERM&apos;</span>);\n    }\n  });\n});\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"229,249"}},{"content":"<pre data-lines=\"250,253\"><code>&#x4e0a;&#x9762;&#x4ee3;&#x7801;&#x4e2d;&#xff0c;&#x4e3b;&#x8fdb;&#x7a0b;&#x76d1;&#x542c;SIGHUP&#x4e8b;&#x4ef6;&#xff0c;&#x5982;&#x679c;&#x53d1;&#x751f;&#x8be5;&#x4e8b;&#x4ef6;&#x5c31;&#x5173;&#x95ed;&#x5176;&#x4ed6;&#x6240;&#x6709;worker&#x8fdb;&#x7a0b;&#x3002;&#x4e4b;&#x6240;&#x4ee5;&#x662f;SIGHUP&#x4e8b;&#x4ef6;&#xff0c;&#x662f;&#x56e0;&#x4e3a;nginx&#x670d;&#x52a1;&#x5668;&#x76d1;&#x542c;&#x5230;&#x8fd9;&#x4e2a;&#x4fe1;&#x53f7;&#xff0c;&#x4f1a;&#x521b;&#x9020;&#x4e00;&#x4e2a;&#x65b0;&#x7684;worker&#x8fdb;&#x7a0b;&#xff0c;&#x91cd;&#x65b0;&#x52a0;&#x8f7d;&#x914d;&#x7f6e;&#x6587;&#x4ef6;&#x3002;&#x53e6;&#x5916;&#xff0c;&#x5173;&#x95ed;worker&#x8fdb;&#x7a0b;&#x65f6;&#xff0c;&#x4e3b;&#x8fdb;&#x7a0b;&#x53d1;&#x9001;SIGTERM&#x4fe1;&#x53f7;&#xff0c;&#x8fd9;&#x662f;&#x56e0;&#x4e3a;Node&#x5141;&#x8bb8;&#x591a;&#x4e2a;worker&#x8fdb;&#x7a0b;&#x76d1;&#x542c;&#x540c;&#x4e00;&#x4e2a;&#x7aef;&#x53e3;&#x3002;\n\n&#x4e0b;&#x9762;&#x662f;worker&#x8fdb;&#x7a0b;&#x7684;&#x4ee3;&#x7801;server.js&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"250,253"}},{"content":"<pre data-lines=\"254,274\"><code class=\"language-js\"><span class=\"hljs-keyword\">var</span> cluster = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&apos;cluster&apos;</span>);\n\n<span class=\"hljs-keyword\">if</span> (cluster.<span class=\"hljs-property\">isMaster</span>) {\n  <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&apos;./master&apos;</span>);\n  <span class=\"hljs-keyword\">return</span>;\n}\n\n<span class=\"hljs-keyword\">var</span> express = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&apos;express&apos;</span>);\n<span class=\"hljs-keyword\">var</span> http = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&apos;http&apos;</span>);\n<span class=\"hljs-keyword\">var</span> app = <span class=\"hljs-title function_\">express</span>();\n\napp.<span class=\"hljs-title function_\">get</span>(<span class=\"hljs-string\">&apos;/&apos;</span>, <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">req, res</span>) {\n  res.<span class=\"hljs-title function_\">send</span>(<span class=\"hljs-string\">&apos;ha fsdgfds gfds gfd!&apos;</span>);\n});\n\nhttp.<span class=\"hljs-title function_\">createServer</span>(app).<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">8080</span>, <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&apos;http://localhost:8080&apos;</span>);\n});\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"254,274"}},{"content":"<pre data-lines=\"275,276\"><code>&#x4f7f;&#x7528;&#x65f6;&#x4ee3;&#x7801;&#x5982;&#x4e0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"275,276"}},{"content":"<pre data-lines=\"277,282\"><code class=\"language-bash\">&#x24; node server.js\nstarted master with 10538\nhttp://localhost:8080\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"277,282"}},{"content":"<pre data-lines=\"283,284\"><code>&#x7136;&#x540e;&#xff0c;&#x5411;&#x4e3b;&#x8fdb;&#x7a0b;&#x8fde;&#x7eed;&#x53d1;&#x51fa;&#x4e24;&#x6b21;SIGHUP&#x4fe1;&#x53f7;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"283,284"}},{"content":"<pre data-lines=\"285,289\"><code class=\"language-bash\">&#x24; <span class=\"hljs-built_in\">kill</span> -SIGHUP 10538\n&#x24; <span class=\"hljs-built_in\">kill</span> -SIGHUP 10538\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"285,289"}},{"content":"<pre data-lines=\"289,290\"><code>&#x4e3b;&#x8fdb;&#x7a0b;&#x4f1a;&#x8fde;&#x7eed;&#x4e24;&#x6b21;&#x65b0;&#x5efa;&#x4e00;&#x4e2a;worker&#x8fdb;&#x7a0b;&#xff0c;&#x7136;&#x540e;&#x5173;&#x95ed;&#x6240;&#x6709;&#x5176;&#x4ed6;worker&#x8fdb;&#x7a0b;&#xff0c;&#x663e;&#x793a;&#x5982;&#x4e0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"289,290"}},{"content":"<pre data-lines=\"291,297\"><code class=\"language-bash\">Reloading...\nhttp://localhost:8080\nReloading...\nhttp://localhost:8080\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"291,297"}},{"content":"<pre data-lines=\"298,299\"><code>&#x6700;&#x540e;&#xff0c;&#x5411;&#x4e3b;&#x8fdb;&#x7a0b;&#x53d1;&#x51fa;SIGTERM&#x4fe1;&#x53f7;&#xff0c;&#x5173;&#x95ed;&#x4e3b;&#x8fdb;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"298,299"}},{"content":"<pre data-lines=\"300,303\"><code class=\"language-bash\">&#x24; <span class=\"hljs-built_in\">kill</span> 10538\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"300,303"}}],"payload":{"tag":"h3","lines":"186,187"}}],"payload":{"tag":"h2","lines":"184,185"}},{"content":"PM2&#x6a21;&#x5757;","children":[{"content":"<pre data-lines=\"306,307\"><code>PM2&#x6a21;&#x5757;&#x662f;cluster&#x6a21;&#x5757;&#x7684;&#x4e00;&#x4e2a;&#x5305;&#x88c5;&#x5c42;&#x3002;&#x5b83;&#x7684;&#x4f5c;&#x7528;&#x662f;&#x5c3d;&#x91cf;&#x5c06;cluster&#x6a21;&#x5757;&#x62bd;&#x8c61;&#x6389;&#xff0c;&#x8ba9;&#x7528;&#x6237;&#x50cf;&#x4f7f;&#x7528;&#x5355;&#x8fdb;&#x7a0b;&#x4e00;&#x6837;&#xff0c;&#x90e8;&#x7f72;&#x591a;&#x8fdb;&#x7a0b;Node&#x5e94;&#x7528;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"306,307"}},{"content":"<pre data-lines=\"308,317\"><code class=\"language-js\"><span class=\"hljs-comment\">// app.js</span>\n<span class=\"hljs-keyword\">var</span> http = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&apos;http&apos;</span>);\n\nhttp.<span class=\"hljs-title function_\">createServer</span>(<span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">req, res</span>) {\n  res.<span class=\"hljs-title function_\">writeHead</span>(<span class=\"hljs-number\">200</span>);\n  res.<span class=\"hljs-title function_\">end</span>(<span class=\"hljs-string\">&quot;hello world&quot;</span>);\n}).<span class=\"hljs-title function_\">listen</span>(<span class=\"hljs-number\">8080</span>);\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"308,317"}},{"content":"<pre data-lines=\"318,319\"><code>&#x4e0a;&#x9762;&#x4ee3;&#x7801;&#x662f;&#x6807;&#x51c6;&#x7684;Node&#x67b6;&#x8bbe;Web&#x670d;&#x52a1;&#x5668;&#x7684;&#x65b9;&#x5f0f;&#xff0c;&#x7136;&#x540e;&#x7528;PM2&#x4ece;&#x547d;&#x4ee4;&#x884c;&#x542f;&#x52a8;&#x8fd9;&#x6bb5;&#x4ee3;&#x7801;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"318,319"}},{"content":"<pre data-lines=\"320,323\"><code class=\"language-bash\">&#x24; pm2 start app.js -i 4\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"320,323"}},{"content":"<pre data-lines=\"324,327\"><code>&#x4e0a;&#x9762;&#x4ee3;&#x7801;&#x7684;i&#x53c2;&#x6570;&#x544a;&#x8bc9;PM2&#xff0c;&#x8fd9;&#x6bb5;&#x4ee3;&#x7801;&#x5e94;&#x8be5;&#x5728;cluster_mode&#x542f;&#x52a8;&#xff0c;&#x4e14;&#x65b0;&#x5efa;worker&#x8fdb;&#x7a0b;&#x7684;&#x6570;&#x91cf;&#x662f;4&#x4e2a;&#x3002;&#x5982;&#x679c;i&#x53c2;&#x6570;&#x7684;&#x503c;&#x662f;0&#xff0c;&#x90a3;&#x4e48;&#x5f53;&#x524d;&#x673a;&#x5668;&#x6709;&#x51e0;&#x4e2a;CPU&#x5185;&#x6838;&#xff0c;PM2&#x5c31;&#x4f1a;&#x542f;&#x52a8;&#x51e0;&#x4e2a;worker&#x8fdb;&#x7a0b;&#x3002;\n\n&#x5982;&#x679c;&#x4e00;&#x4e2a;worker&#x8fdb;&#x7a0b;&#x7531;&#x4e8e;&#x67d0;&#x79cd;&#x539f;&#x56e0;&#x6302;&#x6389;&#x4e86;&#xff0c;&#x4f1a;&#x7acb;&#x523b;&#x91cd;&#x542f;&#x8be5;worker&#x8fdb;&#x7a0b;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"324,327"}},{"content":"<pre data-lines=\"328,332\"><code class=\"language-bash\"><span class=\"hljs-comment\"># &#x91cd;&#x542f;&#x6240;&#x6709;worker&#x8fdb;&#x7a0b;</span>\n&#x24; pm2 reload all\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"328,332"}},{"content":"<pre data-lines=\"333,334\"><code>&#x6bcf;&#x4e2a;worker&#x8fdb;&#x7a0b;&#x90fd;&#x6709;&#x4e00;&#x4e2a;id&#xff0c;&#x53ef;&#x4ee5;&#x7528;&#x4e0b;&#x9762;&#x7684;&#x547d;&#x4ee4;&#x67e5;&#x770b;&#x5355;&#x4e2a;worker&#x8fdb;&#x7a0b;&#x7684;&#x8be6;&#x60c5;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"333,334"}},{"content":"<pre data-lines=\"335,338\"><code class=\"language-bash\">&#x24; pm2 show &lt;worker <span class=\"hljs-built_in\">id</span>&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"335,338"}},{"content":"<pre data-lines=\"339,340\"><code>&#x6b63;&#x786e;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;PM2&#x91c7;&#x7528;fork&#x6a21;&#x5f0f;&#x65b0;&#x5efa;worker&#x8fdb;&#x7a0b;&#xff0c;&#x5373;&#x4e3b;&#x8fdb;&#x7a0b;fork&#x81ea;&#x8eab;&#xff0c;&#x4ea7;&#x751f;&#x4e00;&#x4e2a;worker&#x8fdb;&#x7a0b;&#x3002;pm2 reload&#x547d;&#x4ee4;&#x5219;&#x4f1a;&#x7528;spawn&#x65b9;&#x5f0f;&#x542f;&#x52a8;&#xff0c;&#x5373;&#x4e00;&#x4e2a;&#x63a5;&#x4e00;&#x4e2a;&#x542f;&#x52a8;worker&#x8fdb;&#x7a0b;&#xff0c;&#x4e00;&#x4e2a;&#x65b0;&#x7684;worker&#x542f;&#x52a8;&#x6210;&#x529f;&#xff0c;&#x518d;&#x6740;&#x6b7b;&#x4e00;&#x4e2a;&#x65e7;&#x7684;worker&#x8fdb;&#x7a0b;&#x3002;&#x91c7;&#x7528;&#x8fd9;&#x79cd;&#x65b9;&#x5f0f;&#xff0c;&#x91cd;&#x65b0;&#x90e8;&#x7f72;&#x65b0;&#x7248;&#x672c;&#x65f6;&#xff0c;&#x670d;&#x52a1;&#x5668;&#x5c31;&#x4e0d;&#x4f1a;&#x4e2d;&#x65ad;&#x670d;&#x52a1;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"339,340"}},{"content":"<pre data-lines=\"341,344\"><code class=\"language-bash\">&#x24; pm2 reload &lt;&#x811a;&#x672c;&#x6587;&#x4ef6;&#x540d;&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"341,344"}},{"content":"<pre data-lines=\"345,346\"><code>&#x5173;&#x95ed;worker&#x8fdb;&#x7a0b;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x53ef;&#x4ee5;&#x90e8;&#x7f72;&#x4e0b;&#x9762;&#x7684;&#x4ee3;&#x7801;&#xff0c;&#x8ba9;worker&#x8fdb;&#x7a0b;&#x76d1;&#x542c;shutdown&#x6d88;&#x606f;&#x3002;&#x4e00;&#x65e6;&#x6536;&#x5230;&#x8fd9;&#x4e2a;&#x6d88;&#x606f;&#xff0c;&#x8fdb;&#x884c;&#x5b8c;&#x6bd5;&#x6536;&#x5c3e;&#x6e05;&#x7406;&#x5de5;&#x4f5c;&#x518d;&#x5173;&#x95ed;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"345,346"}},{"content":"<pre data-lines=\"347,357\"><code class=\"language-js\">process.<span class=\"hljs-title function_\">on</span>(<span class=\"hljs-string\">&apos;message&apos;</span>, <span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">msg</span>) {\n  <span class=\"hljs-keyword\">if</span> (msg === <span class=\"hljs-string\">&apos;shutdown&apos;</span>) {\n    <span class=\"hljs-title function_\">close_all_connections</span>();\n    <span class=\"hljs-title function_\">delete_logs</span>();\n    server.<span class=\"hljs-title function_\">close</span>();\n    process.<span class=\"hljs-title function_\">exit</span>(<span class=\"hljs-number\">0</span>);\n  }\n});\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"347,357"}},{"content":"<pre data-lines=\"358,374\"><code data-lines=\"358,374\">&#x76ee;&#x5f55;\n&#x6982;&#x8ff0;\n    &#x57fa;&#x672c;&#x7528;&#x6cd5;\n    <span class=\"hljs-variable\">worker</span>&#x5bf9;&#x8c61;\n    <span class=\"hljs-variable\">cluster.workers</span>&#x5bf9;&#x8c61;\n<span class=\"hljs-variable\">cluster</span>&#x6a21;&#x5757;&#x7684;&#x5c5e;&#x6027;&#x4e0e;&#x65b9;&#x6cd5;\n    <span class=\"hljs-variable\">isMaster</span>&#xff0c;<span class=\"hljs-variable\">isWorker</span>\n    <span class=\"hljs-function\"><span class=\"hljs-title\">fork</span>()</span>\n    <span class=\"hljs-function\"><span class=\"hljs-title\">kill</span>()</span>\n    <span class=\"hljs-variable\">listening</span>&#x4e8b;&#x4ef6;\n&#x4e0d;&#x4e2d;&#x65ad;&#x5730;&#x91cd;&#x542f;<span class=\"hljs-variable\">Node</span>&#x670d;&#x52a1;\n    &#x601d;&#x8def;\n    &#x5b9e;&#x4f8b;\n<span class=\"hljs-variable\">PM2</span>&#x6a21;&#x5757;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"358,374"}}],"payload":{"tag":"h2","lines":"304,305"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
