<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"&#x5206;&#x5e03;&#x5f0f;&#x4e8b;&#x52a1;&#x7ba1;&#x7406;&#xff1a;Seata","children":[{"content":"1.1&#x3001;<a href=\"https://so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1&amp;spm=1001.2101.3001.7020\">&#x5206;&#x5e03;&#x5f0f;&#x4e8b;&#x52a1;</a>","children":[{"content":"<pre data-lines=\"5,10\"><code>&#x4e8b;&#x52a1;&#x662f;&#x6570;&#x636e;&#x5e93;&#x7684;&#x6982;&#x5ff5;&#xff0c;&#x6570;&#x636e;&#x5e93;&#x4e8b;&#x52a1;&#xff08;ACID&#xff1a;&#x539f;&#x5b50;&#x6027;&#x3001;&#x4e00;&#x81f4;&#x6027;&#x3001;&#x9694;&#x79bb;&#x6027;&#x548c;&#x6301;&#x4e45;&#x6027;&#xff09;&#x3002;\n\n&#x5206;&#x5e03;&#x5f0f;&#x4e8b;&#x52a1;&#x7684;&#x4ea7;&#x751f;&#xff0c;&#x662f;&#x7531;&#x4e8e;&#x6570;&#x636e;&#x5e93;&#x7684;&#x62c6;&#x5206;&#x548c;&#x5206;&#x5e03;&#x5f0f;&#x67b6;&#x6784;(&#x5fae;&#x670d;&#x52a1;)&#x5e26;&#x6765;&#x7684;&#xff0c;&#x5728;&#x5e38;&#x89c4;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;&#x6211;&#x4eec;&#x5728;&#x4e00;&#x4e2a;&#x8fdb;&#x7a0b;&#x4e2d;&#x64cd;&#x4f5c;&#x4e00;&#x4e2a;&#x6570;&#x636e;&#x5e93;&#xff0c;&#x8fd9;&#x5c5e;&#x4e8e;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#xff0c;&#x5982;&#x679c;&#x5728;&#x4e00;&#x4e2a;&#x8fdb;&#x7a0b;&#x4e2d;&#x64cd;&#x4f5c;&#x591a;&#x4e2a;&#x6570;&#x636e;&#x5e93;&#xff0c;&#x6216;&#x8005;&#x5728;&#x591a;&#x4e2a;&#x8fdb;&#x7a0b;&#x4e2d;&#x64cd;&#x4f5c;&#x4e00;&#x4e2a;&#x6216;&#x591a;&#x4e2a;&#x6570;&#x636e;&#x5e93;&#xff0c;&#x5c31;&#x4ea7;&#x751f;&#x4e86;&#x5206;&#x5e03;&#x5f0f;&#x4e8b;&#x52a1;&#xff1b;\n\n&#xff08;1&#xff09;&#x6570;&#x636e;&#x5e93;&#x5206;&#x5e93;&#x5206;&#x8868;&#x5c31;&#x4ea7;&#x751f;&#x4e86;&#x5206;&#x5e03;&#x5f0f;&#x4e8b;&#x52a1;&#xff1b;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"5,10"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/dbc8c0093e60d97cfdcbb8e457f73bcd.png\" alt>","children":[],"payload":{"tag":"img","lines":"11,12"}},{"content":"<pre data-lines=\"13,14\"><code>&#xff08;2&#xff09;&#x9879;&#x76ee;&#x62c6;&#x5206;&#x670d;&#x52a1;&#x5316;&#x4e5f;&#x4ea7;&#x751f;&#x4e86;&#x5206;&#x5e03;&#x5f0f;&#x4e8b;&#x52a1;&#xff1b;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"13,14"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b491c392f96a3e536985d4c03aa8e30d.png\" alt>","children":[],"payload":{"tag":"img","lines":"15,16"}}],"payload":{"tag":"h2","lines":"2,4"}},{"content":"1.2&#x3001;Seata&#x662f;&#x4ec0;&#x4e48;","children":[{"content":"<pre data-lines=\"20,34\"><code>Seata&#x662f;&#x4e00;&#x6b3e;&#x5f00;&#x6e90;&#x7684;&#x5206;&#x5e03;&#x5f0f;&#x4e8b;&#x52a1;&#x89e3;&#x51b3;&#x65b9;&#x6848;&#xff0c;&#x81f4;&#x529b;&#x4e8e;&#x5728;&#x5fae;&#x670d;&#x52a1;&#x67b6;&#x6784;&#x4e0b;&#x63d0;&#x4f9b;&#x9ad8;&#x6027;&#x80fd;&#x548c;&#x7b80;&#x5355;&#x6613;&#x7528;&#x7684;&#x5206;&#x5e03;&#x5f0f;&#x4e8b;&#x52a1;&#x670d;&#x52a1;&#x3002;\n\nSeata&#x4e3a;&#x7528;&#x6237;&#x63d0;&#x4f9b;&#x4e86;AT&#x3001;TCC&#x3001;SAGA&#x548c;XA&#x4e8b;&#x52a1;&#x6a21;&#x5f0f;&#xff0c;&#x4e3a;&#x7528;&#x6237;&#x6253;&#x9020;&#x4e00;&#x7ad9;&#x5f0f;&#x7684;&#x5206;&#x5e03;&#x5f0f;&#x89e3;&#x51b3;&#x65b9;&#x6848;&#x3002;\n\n&#x56db;&#x79cd;&#x4e8b;&#x52a1;&#x6a21;&#x5f0f;&#x4e2d;&#xff0c;&#x76ee;&#x524d;&#x4f7f;&#x7528;&#x7684;&#x6d41;&#x884c;&#x5ea6;&#x60c5;&#x51b5;&#x662f;&#xff1a;AT &gt; TCC &gt; Saga&#x3001;XA&#x3002;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x53c2;&#x770b;Seata&#x5404;&#x516c;&#x53f8;&#x4f7f;&#x7528;&#x5217;&#x8868;&#xff1a;https://github.com/seata/seata/issues/1246\n\n&#x56e0;&#x6b64;&#xff0c;&#x6211;&#x4eec;&#x6559;&#x5b66;&#x7684;&#x91cd;&#x70b9;&#x548c;&#x5b66;&#x4e60;&#x7684;&#x91cd;&#x70b9;&#x5c06;&#x4f1a;&#x653e;&#x5230;AT&#x6a21;&#x5f0f;&#x548c;TCC&#x6a21;&#x5f0f;&#x7684;&#x8bb2;&#x89e3;&#x4e0a;&#xff0c;Seata&#x9ed8;&#x8ba4;&#x5c31;&#x662f;AT&#x6a21;&#x5f0f;&#xff0c;&#x7b80;&#x5355;&#x7684;&#x4e00;&#x53e5;&#x8bdd;&#x6765;&#x8bf4;&#x8fd9;&#x4e24;&#x79cd;&#x6a21;&#x5f0f;&#x7684;&#x533a;&#x522b;&#xff08;&#x540e;&#x8fb9;&#x4f1a;&#x6df1;&#x5165;&#x8bb2;&#x89e3;&#xff09;&#xff1a;\n\n*   AT&#x6a21;&#x5f0f;&#xff1a;&#x53ef;&#x4ee5;&#x5bf9;&#x6570;&#x636e;&#x6e90;&#x662f;mysql&#x3001;oracle&#x7b49;&#x5173;&#x7cfb;&#x578b;&#x6570;&#x636e;&#x5e93;&#x7684;&#x60c5;&#x51b5;&#x8fdb;&#x884c;&#x5931;&#x8d25;&#x56de;&#x6eda;&#x3002;\n*   TCC&#x6a21;&#x5f0f;&#xff1a;&#x4e0d;&#x4ec5;&#x53ef;&#x4ee5;&#x5bf9;&#x6570;&#x636e;&#x6e90;&#x662f;mysql&#x3001;oracle&#x7b49;&#x5173;&#x7cfb;&#x578b;&#x6570;&#x636e;&#x5e93;&#x7684;&#x60c5;&#x51b5;&#x8fdb;&#x884c;&#x5931;&#x8d25;&#x56de;&#x6eda;&#x3002;&#x8fd8;&#x53ef;&#x4ee5;&#x5bf9;&#x6d88;&#x606f;&#x4e2d;&#x95f4;&#x4ef6;&#x3001;&#x975e;&#x5173;&#x7cfb;&#x578b;&#x6570;&#x636e;&#x5e93;&#x5982;&#xff1a;redis&#x3001;mongodb&#x7b49;&#x6570;&#x636e;&#x5e93;&#x8fdb;&#x884c;&#x5931;&#x8d25;&#x56de;&#x6eda;&#x3002;\n\n&#x4ece;&#x4e0a;&#x8fb9;&#x76f4;&#x89c2;&#x7684;&#x6765;&#x770b;&#xff0c;&#x611f;&#x89c9;TCC&#x6a21;&#x5f0f;&#x66f4;&#x5389;&#x5bb3;&#x4e00;&#x70b9;&#xff0c;&#x5b9e;&#x9645;&#x4e0a;&#xff0c;Seata&#x9ed8;&#x8ba4;&#x7684;AT&#x6a21;&#x5f0f;&#xff0c;&#x4e8b;&#x52a1;&#x5931;&#x8d25;&#x56de;&#x6eda;&#x5e76;&#x4e0d;&#x7528;&#x7a0b;&#x5e8f;&#x5458;&#x81ea;&#x5df1;&#x6765;&#x505a;&#xff0c;&#x800c;&#x662f;&#x7531;Seata&#x6846;&#x67b6;&#x672c;&#x8eab;&#x6765;&#x5b8c;&#x6210;&#x7684;&#xff0c;&#x800c;TCC&#x6a21;&#x5f0f;&#x7684;&#x4e8b;&#x52a1;&#x5931;&#x8d25;&#x56de;&#x6eda;&#x7b49;&#x64cd;&#x4f5c;&#xff0c;&#x5168;&#x90e8;&#x9700;&#x8981;&#x624b;&#x52a8;&#x5b9e;&#x73b0;&#xff0c;&#x56e0;&#x6b64;&#xff0c;AT&#x6a21;&#x5f0f;&#x5728;&#x5b9e;&#x9645;&#x751f;&#x4ea7;&#x73af;&#x5883;&#x4e2d;&#x7528;&#x7684;&#x66f4;&#x591a;&#x4e00;&#x70b9;&#xff0c;&#x4e5f;&#x66f4;&#x65b9;&#x4fbf;&#x4e00;&#x70b9;&#xff0c;&#x9664;&#x4e86;&#x7279;&#x5b9a;&#x573a;&#x666f;&#x4e0b;&#x7684;&#x7279;&#x6b8a;&#x9700;&#x8981;&#xff0c;AT&#x6a21;&#x5f0f;&#x57fa;&#x672c;&#x90fd;&#x80fd;&#x6ee1;&#x8db3;&#x3002;\n\n&#x5f53;&#x7136;&#x4e86;&#xff0c;&#x8fd9;&#x91cc;&#x63d0;&#x524d;&#x8bf4;&#x4e00;&#x4e0b;&#xff0c;&#x6211;&#x4eec;&#x63a5;&#x4e0b;&#x6765;&#x4f1a;&#x5b66;&#x4e60;Seata&#x7684;&#x5355;&#x673a;&#x7248;&#x90e8;&#x7f72;&#x548c;&#x9ad8;&#x53ef;&#x7528;&#x96c6;&#x7fa4;&#x7248;&#x90e8;&#x7f72;&#xff0c;&#x800c;&#x6b63;&#x597d;&#xff0c;&#x6211;&#x4eec;&#x8981;&#x5b66;&#x4e60;AT&#x548c;TCC&#x4e24;&#x79cd;&#x6a21;&#x5f0f;&#xff0c;&#x6211;&#x4eec;&#x5728;&#x5b66;&#x4e60;AT&#x6a21;&#x5f0f;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4f7f;&#x7528;Seata&#x5355;&#x673a;&#x7248;&#x73af;&#x5883;&#x3001;&#x800c;&#x5728;&#x5b66;&#x4e60;TCC&#x6a21;&#x5f0f;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4f7f;&#x7528;Seata&#x7684;&#x9ad8;&#x53ef;&#x7528;&#x96c6;&#x7fa4;&#x7248;&#x7684;&#x73af;&#x5883;&#xff0c;&#x4e00;&#x5b9a;&#x6ce8;&#x610f;&#xff0c;&#x8fd9;&#x4e48;&#x5b89;&#x6392;&#x5b58;&#x7cb9;&#x662f;&#x4e3a;&#x4e86;&#x6559;&#x5b66;&#x65b9;&#x4fbf;&#xff0c;&#x5b9e;&#x9645;&#x4e0a;AT&#x4e5f;&#x80fd;&#x7528;&#x9ad8;&#x53ef;&#x7528;&#x96c6;&#x7fa4;&#x7248;&#x73af;&#x5883;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"20,34"}}],"payload":{"tag":"h2","lines":"17,19"}},{"content":"1.3&#x3001;Seata&#x7684;&#x672f;&#x8bed;","children":[{"content":"<pre data-lines=\"38,41\"><code>&#x5b98;&#x65b9;&#x6587;&#x6863;&#xff1a;http://seata.io/zh-cn/\n\n&#x5728;Seata&#x7684;&#x67b6;&#x6784;&#x4e2d;&#xff0c;&#x4e00;&#x5171;&#x6709;&#x4e09;&#x4e2a;&#x89d2;&#x8272;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"38,41"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/53fd02c56708cceaf153815154441595.png\" alt>","children":[],"payload":{"tag":"img","lines":"42,43"}},{"content":"<pre data-lines=\"44,59\"><code>**TC (Transaction Coordinator) - &#x4e8b;&#x52a1;&#x534f;&#x8c03;&#x8005;**\n\n&#x7ef4;&#x62a4;&#x5168;&#x5c40;&#x548c;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x7684;&#x72b6;&#x6001;&#xff0c;&#x9a71;&#x52a8;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x63d0;&#x4ea4;&#x6216;&#x56de;&#x6eda;&#x3002;\n\n**TM (Transaction Manager) - &#x4e8b;&#x52a1;&#x7ba1;&#x7406;&#x5668;**\n\n&#x5b9a;&#x4e49;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x7684;&#x8303;&#x56f4;&#xff1a;&#x5f00;&#x59cb;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x3001;&#x63d0;&#x4ea4;&#x6216;&#x56de;&#x6eda;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x3002;\n\n**RM (Resource Manager) - &#x8d44;&#x6e90;&#x7ba1;&#x7406;&#x5668;**\n\n&#x7ba1;&#x7406;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x5904;&#x7406;&#x7684;&#x8d44;&#x6e90;&#xff0c;&#x4e0e;TC&#x4ea4;&#x8c08;&#x4ee5;&#x6ce8;&#x518c;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x548c;&#x62a5;&#x544a;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x7684;&#x72b6;&#x6001;&#xff0c;&#x5e76;&#x9a71;&#x52a8;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x63d0;&#x4ea4;&#x6216;&#x56de;&#x6eda;&#x3002;\n\n&#x5176;&#x4e2d;TC&#x4e3a;&#x5355;&#x72ec;&#x90e8;&#x7f72;&#x7684; Server &#x670d;&#x52a1;&#x7aef;&#xff0c;TM&#x548c;RM&#x4e3a;&#x5d4c;&#x5165;&#x5230;&#x5e94;&#x7528;&#x4e2d;&#x7684; Client &#x5ba2;&#x6237;&#x7aef;&#xff0c;&#x9664;&#x4e86;&#x4ee5;&#x4e0a;&#x4e09;&#x79cd;&#x89d2;&#x8272;&#x5916;&#xff0c;&#x8fd8;&#x6709;&#x4e00;&#x4e2a;&#x5168;&#x5c40;&#x4e8b;&#x52a1;id&#xff1a;Transaction ID **XID** &#x3002;\n\n&#x5728;Seata&#x4e2d;&#xff0c;&#x4e00;&#x4e2a;&#x5206;&#x5e03;&#x5f0f;&#x4e8b;&#x52a1;&#x7684;&#x751f;&#x547d;&#x5468;&#x671f;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"44,59"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/4e33b6e3740ac2b74dbc7f23c4b1272f.png\" alt>","children":[],"payload":{"tag":"img","lines":"60,61"}},{"content":"<pre data-lines=\"62,71\"><code>1.  TM &#x5411; TC &#x7533;&#x8bf7;&#x5f00;&#x542f;&#x4e00;&#x4e2a;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#xff0c;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x521b;&#x5efa;&#x6210;&#x529f;&#x5e76;&#x751f;&#x6210;&#x4e00;&#x4e2a;&#x5168;&#x5c40;&#x552f;&#x4e00;&#x7684; XID&#xff1b;\n\t\n2.  XID &#x5728;&#x5fae;&#x670d;&#x52a1;&#x8c03;&#x7528;&#x94fe;&#x8def;&#x7684;&#x4e0a;&#x4e0b;&#x6587;&#x4e2d;&#x4f20;&#x64ad;&#xff1b;\n\t\n3.  RM &#x5411; TC &#x6ce8;&#x518c;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#xff0c;&#x5c06;&#x5176;&#x7eb3;&#x5165; XID &#x5bf9;&#x5e94;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x7684;&#x7ba1;&#x8f96;&#xff1b;\n\t\n4.  TM &#x5411; TC &#x53d1;&#x8d77;&#x9488;&#x5bf9; XID &#x7684;&#x5168;&#x5c40;&#x63d0;&#x4ea4;&#x6216;&#x56de;&#x6eda;&#x51b3;&#x8bae;&#xff1b;\n\t\n5.  TC &#x8c03;&#x5ea6; XID &#x4e0b;&#x7ba1;&#x8f96;&#x7684;&#x5168;&#x90e8;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x5b8c;&#x6210;&#x63d0;&#x4ea4;&#x6216;&#x56de;&#x6eda;&#x8bf7;&#x6c42;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"62,71"}}],"payload":{"tag":"h2","lines":"35,37"}},{"content":"2.1&#x3001;&#x4e0b;&#x8f7d;Seata","children":[{"content":"<pre data-lines=\"76,85\"><code>&#x6211;&#x4eec;&#x5148;&#x90e8;&#x7f72;&#x5355;&#x673a;&#x73af;&#x5883;&#x7684; Seata TC Server&#xff0c;&#x7528;&#x4e8e;&#x5b66;&#x4e60;&#x6216;&#x6d4b;&#x8bd5;&#xff0c;&#x5728;&#x751f;&#x4ea7;&#x73af;&#x5883;&#x4e2d;&#x8981;&#x90e8;&#x7f72;&#x96c6;&#x7fa4;&#x73af;&#x5883;&#xff1b;\n\n&#x56e0;&#x4e3a;TC&#x9700;&#x8981;&#x8fdb;&#x884c;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x548c;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x7684;&#x8bb0;&#x5f55;&#xff0c;&#x6240;&#x4ee5;&#x9700;&#x8981;&#x5bf9;&#x5e94;&#x7684;&#x5b58;&#x50a8;&#xff0c;&#x76ee;&#x524d;&#xff0c;TC&#x6709;&#x4e09;&#x79cd;&#x5b58;&#x50a8;&#x6a21;&#x5f0f;( store.mode )&#xff1a;\n\n*   file&#x6a21;&#x5f0f;&#xff1a;&#x9002;&#x5408;&#x5355;&#x673a;&#x6a21;&#x5f0f;&#xff0c;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x4f1a;&#x8bdd;&#x4fe1;&#x606f;&#x5728;&#x5185;&#x5b58;&#x4e2d;&#x8bfb;&#x5199;&#xff0c;&#x5e76;&#x6301;&#x4e45;&#x5316;&#x672c;&#x5730;&#x6587;&#x4ef6; root.data&#xff0c;&#x6027;&#x80fd;&#x8f83;&#x9ad8;&#xff1b;&#xff08; **&#x9ed8;&#x8ba4;** &#xff09;\n*   db&#x6a21;&#x5f0f;&#xff1a;&#x9002;&#x5408;&#x96c6;&#x7fa4;&#x6a21;&#x5f0f;&#xff0c;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x4f1a;&#x8bdd;&#x4fe1;&#x606f;&#x901a;&#x8fc7; db &#x5171;&#x4eab;&#xff0c;&#x76f8;&#x5bf9;&#x6027;&#x80fd;&#x5dee;&#x70b9;&#xff1b;\n*   redis&#x6a21;&#x5f0f;&#xff1a;&#x89e3;&#x51b3;db&#x5b58;&#x50a8;&#x7684;&#x6027;&#x80fd;&#x95ee;&#x9898;&#xff1b;\n\n&#x6211;&#x4eec;&#x5148;&#x91c7;&#x7528;file&#x6a21;&#x5f0f;&#xff0c;&#x6700;&#x7ec8;&#x6211;&#x4eec;&#x90e8;&#x7f72;&#x5355;&#x673a;TC Server&#x5982;&#x4e0b;&#x56fe;&#x6240;&#x793a;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"76,85"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/af0d082d8c80dde1e7166e69abeb4d16.png\" alt>","children":[],"payload":{"tag":"img","lines":"86,87"}},{"content":"<pre data-lines=\"88,91\"><code>&#x622a;&#x6b62;&#x5230;2021&#x5e74;2&#x6708;24&#x65e5;&#xff0c;&#x5b98;&#x65b9;&#x6700;&#x65b0;&#x53d1;&#x5e03;&#x7684;&#x7248;&#x672c;&#x4e3a;`1.4.1`&#xff0c;&#x4f46;&#x662f;&#x6211;&#x4eec;&#x4e0d;&#x80fd;&#x4e0b;&#x8f7d;&#x6700;&#x65b0;&#x7684;&#x8fd9;&#x4e2a;&#x7248;&#x672c;&#x6765;&#x8fdb;&#x884c;&#x5b66;&#x4e60;&#xff0c;&#x56e0;&#x4e3a;&#x5728;&#x5f15;&#x5165;`spring-cloud-starter-alibaba-seata`&#x4f9d;&#x8d56;&#x4ee5;&#x540e;&#xff0c;&#x5185;&#x7f6e;&#x81ea;&#x5e26;&#x7684;&#x7248;&#x672c;&#x4e3a;`1.3.0`&#xff0c;&#x56e0;&#x6b64;&#xff0c;&#x6211;&#x4eec;&#x9700;&#x8981;&#x4fdd;&#x6301;&#x7248;&#x672c;&#x4e00;&#x81f4;&#xff0c;&#x6240;&#x4ee5;&#xff0c;&#x6211;&#x4eec;&#x9700;&#x8981;&#x4e0b;&#x8f7d;`1.3.0`&#x3002;\n\n&#x4e0b;&#x8f7d;&#x5730;&#x5740;&#xff1a;https://github.com/seata/seata/releases/download/v1.3.0/seata-server-1.3.0.zip\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"88,91"}}],"payload":{"tag":"h2","lines":"73,75"}},{"content":"2.2&#x3001;&#x89e3;&#x538b;Seata","children":[{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b0fd2e1d82b85960dda437f714794344.png\" alt>","children":[],"payload":{"tag":"img","lines":"95,96"}}],"payload":{"tag":"h2","lines":"92,94"}},{"content":"2.3&#x3001;&#x8fd0;&#x884c;Seata","children":[{"content":"<pre data-lines=\"100,101\"><code>&#x53cc;&#x51fb;&#x8fd0;&#x884c;&#xff1a;`bin\\seata-server.bat`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"100,101"}}],"payload":{"tag":"h2","lines":"97,99"}},{"content":"3.1&#x3001;&#x4f7f;&#x7528;&#x524d;&#x63d0;","children":[{"content":"&#x57fa;&#x4e8e;&#x652f;&#x6301;&#x672c;&#x5730; ACID &#x4e8b;&#x52a1;&#x7684;&#x5173;&#x7cfb;&#x578b;&#x6570;&#x636e;&#x5e93;&#x3002;&#x4f8b;&#x5982;&#xff1a;mysql&#x3001;oracle","children":[],"payload":{"tag":"li","lines":"105,106"}},{"content":"Java &#x5e94;&#x7528;&#xff0c;&#x901a;&#x8fc7; JDBC &#x8bbf;&#x95ee;&#x6570;&#x636e;&#x5e93;&#x3002;","children":[],"payload":{"tag":"li","lines":"106,108"}}],"payload":{"tag":"h2","lines":"102,104"}},{"content":"3.2&#x3001;&#x6574;&#x4f53;&#x673a;&#x5236;","children":[{"content":"<pre data-lines=\"111,119\"><code>&#x4e24;&#x9636;&#x6bb5;&#x63d0;&#x4ea4;&#x534f;&#x8bae;&#x7684;&#x6f14;&#x53d8;&#xff1a;\n\n*   &#x4e00;&#x9636;&#x6bb5;&#xff1a;&#x4e1a;&#x52a1;&#x6570;&#x636e;&#x548c;**&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8bb0;&#x5f55;**&#xff08;&#x4e00;&#x5f20;&#x5355;&#x72ec;&#x7684;&#x6570;&#x636e;&#x8868;&#xff09;&#x5728;&#x540c;&#x4e00;&#x4e2a;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x4e2d;&#x63d0;&#x4ea4;&#xff0c;&#x91ca;&#x653e;&#x672c;&#x5730;&#x9501;&#x548c;&#x8fde;&#x63a5;&#x8d44;&#x6e90;&#x3002;\n*   &#x4e8c;&#x9636;&#x6bb5;&#xff1a;\n\t*   &#x63d0;&#x4ea4;&#x5f02;&#x6b65;&#x5316;&#xff0c;&#x975e;&#x5e38;&#x5feb;&#x901f;&#x5730;&#x5b8c;&#x6210;&#x3002;\n\t*   &#x56de;&#x6eda;&#x901a;&#x8fc7;&#x4e00;&#x9636;&#x6bb5;&#x7684;&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8fdb;&#x884c;&#x53cd;&#x5411;&#x8865;&#x507f;&#x3002;\n\n&gt; &#x53cd;&#x5411;&#x8865;&#x507f;&#xff1a;&#x7b80;&#x5355;&#x8bf4;&#x5c31;&#x662f;&#x7ed9;&#x67d0;&#x4e00;&#x4e2a;&#x5b57;&#x6bb5;&#x52a0;&#x4e86;10&#xff0c;&#x53cd;&#x5411;&#x8865;&#x507f;&#x5c31;&#x51cf;&#x53bb;10&#xff0c;&#x8fd9;&#x6837;&#x6570;&#x636e;&#x4fdd;&#x6301;&#x4e0d;&#x53d8;&#x3002;&#x65b0;&#x589e;&#x4e00;&#x6761;&#x8bb0;&#x5f55;&#xff0c;&#x53cd;&#x5411;&#x8865;&#x507f;&#x5c31;&#x5220;&#x9664;&#x4ee5;&#x524d;&#x65b0;&#x589e;&#x7684;&#x90a3;&#x6761;&#x8bb0;&#x5f55;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"111,119"}}],"payload":{"tag":"h2","lines":"108,110"}},{"content":"3.3&#x3001;&#x8bfb;&#x5199;&#x9694;&#x79bb;","children":[{"content":"3.3.1&#x3001;&#x5199;&#x9694;&#x79bb;","children":[{"content":"<pre data-lines=\"125,134\"><code>*   &#x4e00;&#x9636;&#x6bb5;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x63d0;&#x4ea4;&#x524d;&#xff0c;&#x9700;&#x8981;&#x786e;&#x4fdd;&#x5148;&#x62ff;&#x5230; **&#x5168;&#x5c40;&#x9501;** &#x3002;\n*   &#x62ff;&#x4e0d;&#x5230; **&#x5168;&#x5c40;&#x9501;** &#xff0c;&#x4e0d;&#x80fd;&#x63d0;&#x4ea4;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x3002;\n*   &#x62ff; **&#x5168;&#x5c40;&#x9501;** &#x7684;&#x5c1d;&#x8bd5;&#x88ab;&#x9650;&#x5236;&#x5728;&#x4e00;&#x5b9a;&#x8303;&#x56f4;&#x5185;&#xff0c;&#x8d85;&#x51fa;&#x8303;&#x56f4;&#x5c06;&#x653e;&#x5f03;&#xff0c;&#x5e76;&#x56de;&#x6eda;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#xff0c;&#x91ca;&#x653e;&#x672c;&#x5730;&#x9501;&#x3002;\n\n&#x4ee5;&#x4e00;&#x4e2a;&#x793a;&#x4f8b;&#x6765;&#x8bf4;&#x660e;&#xff1a;\n\n&#x4e24;&#x4e2a;&#x5168;&#x5c40;&#x4e8b;&#x52a1; tx1 &#x548c; tx2&#xff0c;&#x5206;&#x522b;&#x5bf9; a &#x8868;&#x7684; m &#x5b57;&#x6bb5;&#x8fdb;&#x884c;&#x66f4;&#x65b0;&#x64cd;&#x4f5c;&#xff0c;m &#x7684;&#x521d;&#x59cb;&#x503c; 1000&#x3002;\n\ntx1 &#x5148;&#x5f00;&#x59cb;&#xff0c;&#x5f00;&#x542f;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#xff0c;&#x62ff;&#x5230;&#x672c;&#x5730;&#x9501;&#xff0c;&#x66f4;&#x65b0;&#x64cd;&#x4f5c; m = 1000 - 100 = 900&#x3002;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x63d0;&#x4ea4;&#x524d;&#xff0c;&#x5148;&#x62ff;&#x5230;&#x8be5;&#x8bb0;&#x5f55;&#x7684; **&#x5168;&#x5c40;&#x9501;** &#xff0c;&#x672c;&#x5730;&#x63d0;&#x4ea4;&#x91ca;&#x653e;&#x672c;&#x5730;&#x9501;&#x3002; tx2 &#x540e;&#x5f00;&#x59cb;&#xff0c;&#x5f00;&#x542f;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#xff0c;&#x62ff;&#x5230;&#x672c;&#x5730;&#x9501;&#xff0c;&#x66f4;&#x65b0;&#x64cd;&#x4f5c; m = 900 - 100 = 800&#x3002;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x63d0;&#x4ea4;&#x524d;&#xff0c;&#x5c1d;&#x8bd5;&#x62ff;&#x8be5;&#x8bb0;&#x5f55;&#x7684; **&#x5168;&#x5c40;&#x9501;** &#xff0c;tx1 &#x5168;&#x5c40;&#x63d0;&#x4ea4;&#x524d;&#xff0c;&#x8be5;&#x8bb0;&#x5f55;&#x7684;&#x5168;&#x5c40;&#x9501;&#x88ab; tx1 &#x6301;&#x6709;&#xff0c;tx2 &#x9700;&#x8981;&#x91cd;&#x8bd5;&#x7b49;&#x5f85; **&#x5168;&#x5c40;&#x9501;** &#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"125,134"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/a66f63dc7b442f309abbd90574203323.png\" alt>","children":[],"payload":{"tag":"img","lines":"135,136"}},{"content":"<pre data-lines=\"137,138\"><code>tx1 &#x4e8c;&#x9636;&#x6bb5;&#x5168;&#x5c40;&#x63d0;&#x4ea4;&#xff0c;&#x91ca;&#x653e; **&#x5168;&#x5c40;&#x9501;** &#x3002;tx2 &#x62ff;&#x5230; **&#x5168;&#x5c40;&#x9501;** &#x63d0;&#x4ea4;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"137,138"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1ef0faca65bcbbaf0279d83854bf908d.png\" alt>","children":[],"payload":{"tag":"img","lines":"139,140"}},{"content":"<pre data-lines=\"141,146\"><code>&#x5982;&#x679c; tx1 &#x7684;&#x4e8c;&#x9636;&#x6bb5;&#x5168;&#x5c40;&#x56de;&#x6eda;&#xff0c;&#x5219; tx1 &#x9700;&#x8981;&#x91cd;&#x65b0;&#x83b7;&#x53d6;&#x8be5;&#x6570;&#x636e;&#x7684;&#x672c;&#x5730;&#x9501;&#xff0c;&#x8fdb;&#x884c;&#x53cd;&#x5411;&#x8865;&#x507f;&#x7684;&#x66f4;&#x65b0;&#x64cd;&#x4f5c;&#xff0c;&#x5b9e;&#x73b0;&#x5206;&#x652f;&#x7684;&#x56de;&#x6eda;&#x3002;\n\n&#x6b64;&#x65f6;&#xff0c;&#x5982;&#x679c; tx2 &#x4ecd;&#x5728;&#x7b49;&#x5f85;&#x8be5;&#x6570;&#x636e;&#x7684; **&#x5168;&#x5c40;&#x9501;**&#xff0c;&#x540c;&#x65f6;&#x6301;&#x6709;&#x672c;&#x5730;&#x9501;&#xff0c;&#x5219; tx1 &#x7684;&#x5206;&#x652f;&#x56de;&#x6eda;&#x4f1a;&#x5931;&#x8d25;&#x3002;&#x5206;&#x652f;&#x7684;&#x56de;&#x6eda;&#x4f1a;&#x4e00;&#x76f4;&#x91cd;&#x8bd5;&#xff0c;&#x76f4;&#x5230; tx2 &#x7684; **&#x5168;&#x5c40;&#x9501;** &#x7b49;&#x9501;&#x8d85;&#x65f6;&#xff0c;&#x653e;&#x5f03; **&#x5168;&#x5c40;&#x9501;** &#x5e76;&#x56de;&#x6eda;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x91ca;&#x653e;&#x672c;&#x5730;&#x9501;&#xff0c;tx1 &#x7684;&#x5206;&#x652f;&#x56de;&#x6eda;&#x6700;&#x7ec8;&#x6210;&#x529f;&#x3002;\n\n&#x56e0;&#x4e3a;&#x6574;&#x4e2a;&#x8fc7;&#x7a0b; **&#x5168;&#x5c40;&#x9501;** &#x5728; tx1 &#x7ed3;&#x675f;&#x524d;&#x4e00;&#x76f4;&#x662f;&#x88ab; tx1 &#x6301;&#x6709;&#x7684;&#xff0c;&#x6240;&#x4ee5;&#x4e0d;&#x4f1a;&#x53d1;&#x751f; **&#x810f;&#x5199;** &#x7684;&#x95ee;&#x9898;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"141,146"}}],"payload":{"tag":"h3","lines":"123,124"}},{"content":"3.3.2&#x3001;&#x8bfb;&#x9694;&#x79bb;","children":[{"content":"<pre data-lines=\"149,154\"><code>&#x5982;&#x679c;&#x4e0d;&#x8003;&#x8651;&#x4e8b;&#x52a1;&#x7684;&#x9694;&#x79bb;&#x6027;&#xff0c;&#x53ef;&#x80fd;&#x4f1a;&#x5f15;&#x53d1;&#x8bfb;&#x5b89;&#x5168;&#x6027;&#x95ee;&#x9898;&#xff1a;\n\n*   &#x810f;&#x8bfb;&#xff1a;&#x4e00;&#x4e2a;&#x4e8b;&#x52a1;&#x8bfb;&#x5230;&#x4e86;&#x53e6;&#x4e00;&#x4e2a;&#x4e8b;&#x52a1;&#x672a;&#x63d0;&#x4ea4;&#x7684;&#x6570;&#x636e;\n*   &#x4e0d;&#x53ef;&#x91cd;&#x590d;&#x8bfb;&#xff1a;&#x4e00;&#x4e2a;&#x4e8b;&#x52a1;&#x8bfb;&#x5230;&#x4e86;&#x53e6;&#x4e00;&#x4e2a;&#x4e8b;&#x52a1;&#x5df2;&#x7ecf;&#x63d0;&#x4ea4;&#x7684; update &#x7684;&#x6570;&#x636e;&#xff0c;&#x5bfc;&#x81f4;&#x591a;&#x6b21;&#x67e5;&#x8be2;&#x7ed3;&#x679c;&#x4e0d;&#x4e00;&#x81f4;\n*   &#x5e7b;&#x8bfb; / &#x865a;&#x8bfb;&#xff1a;&#x4e00;&#x4e2a;&#x4e8b;&#x52a1;&#x8bfb;&#x5230;&#x4e86;&#x53e6;&#x4e00;&#x4e2a;&#x4e8b;&#x52a1;&#x5df2;&#x7ecf;&#x63d0;&#x4ea4;&#x7684; insert &#x7684;&#x6570;&#x636e;&#xff0c;&#x5bfc;&#x81f4;&#x591a;&#x6b21;&#x67e5;&#x8be2;&#x7ed3;&#x679c;&#x4e0d;&#x4e00;&#x81f4;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"149,154"}},{"content":"<table data-lines=\"155,161\">\n<thead data-lines=\"155,156\">\n<tr data-lines=\"155,156\">\n<th>&#x9694;&#x79bb;&#x7ea7;&#x522b;</th>\n<th>&#x4e2d;&#x6587;&#x8bf4;&#x660e;</th>\n<th>&#x8bf4;&#x660e;</th>\n</tr>\n</thead>\n<tbody data-lines=\"157,161\">\n<tr data-lines=\"157,158\">\n<td>READ UNCOMMITTED</td>\n<td>&#x8bfb;&#x672a;&#x63d0;&#x4ea4;</td>\n<td>&#x4e0d;&#x80fd;&#x89e3;&#x51b3;&#x4ee5;&#x4e0a;&#x6240;&#x6709;&#x8bfb;&#x95ee;&#x9898;&#xff0c;&#x6548;&#x7387;&#x6700;&#x9ad8;&#xff0c;&#x5b89;&#x5168;&#x6027;&#x6700;&#x4f4e;&#xff0c;&#x4e00;&#x822c;&#x4e0d;&#x7528;</td>\n</tr>\n<tr data-lines=\"158,159\">\n<td>READ COMMITTED</td>\n<td>&#x8bfb;&#x5df2;&#x63d0;&#x4ea4;</td>\n<td>&#x907f;&#x514d;&#x810f;&#x8bfb;&#xff0c;&#x4e0d;&#x53ef;&#x91cd;&#x590d;&#x8bfb;&#x548c;&#x5e7b;&#x8bfb;&#x6709;&#x53ef;&#x80fd;&#x53d1;&#x751f;&#xff0c;Oracle&#x9ed8;&#x8ba4;&#x7684;&#x9694;&#x79bb;&#x7ea7;&#x522b;</td>\n</tr>\n<tr data-lines=\"159,160\">\n<td>REPEATABLE READ</td>\n<td>&#x53ef;&#x91cd;&#x590d;&#x8bfb;</td>\n<td>&#x907f;&#x514d;&#x810f;&#x8bfb;&#x3001;&#x4e0d;&#x53ef;&#x91cd;&#x590d;&#x8bfb;&#xff0c;&#x5e7b;&#x8bfb;&#x6709;&#x53ef;&#x80fd;&#x53d1;&#x751f;&#xff0c;MySQL&#x9ed8;&#x8ba4;&#x7684;&#x9694;&#x79bb;&#x7ea7;&#x522b;</td>\n</tr>\n<tr data-lines=\"160,161\">\n<td>SERIALIZABLE</td>\n<td>&#x4e32;&#x884c;&#x5316;</td>\n<td>&#x53ef;&#x4ee5;&#x89e3;&#x51b3;&#x4ee5;&#x4e0a;&#x6240;&#x6709;&#x8bfb;&#x95ee;&#x9898;&#xff0c;&#x6548;&#x7387;&#x6700;&#x5dee;&#xff0c;&#x5b89;&#x5168;&#x6027;&#x6700;&#x9ad8;&#xff0c;&#x4e00;&#x822c;&#x4e0d;&#x7528;</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"155,161"}},{"content":"<pre data-lines=\"162,165\"><code>&#x5728;&#x6570;&#x636e;&#x5e93;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x9694;&#x79bb;&#x7ea7;&#x522b; **&#x8bfb;&#x5df2;&#x63d0;&#x4ea4;&#xff08;Read Committed&#xff09;** &#x6216;&#x4ee5;&#x4e0a;&#x7684;&#x57fa;&#x7840;&#x4e0a;&#xff0c;Seata&#xff08;AT &#x6a21;&#x5f0f;&#xff09;&#x7684;&#x9ed8;&#x8ba4;&#x5168;&#x5c40;&#x9694;&#x79bb;&#x7ea7;&#x522b;&#x662f; **&#x8bfb;&#x672a;&#x63d0;&#x4ea4;&#xff08;Read Uncommitted&#xff09;** &#x3002;\n\n&#x5982;&#x679c;&#x5e94;&#x7528;&#x5728;&#x7279;&#x5b9a;&#x573a;&#x666f;&#x4e0b;&#xff0c;&#x5fc5;&#x9700;&#x8981;&#x6c42;&#x5168;&#x5c40;&#x7684; **&#x8bfb;&#x5df2;&#x63d0;&#x4ea4;** &#xff0c;&#x76ee;&#x524d; Seata &#x7684;&#x65b9;&#x5f0f;&#x662f;&#x901a;&#x8fc7; `SELECT FOR UPDATE` &#x8bed;&#x53e5;&#x7684;&#x4ee3;&#x7406;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"162,165"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/2890dcb60566b04e986add1283dee4cd.png\" alt>","children":[],"payload":{"tag":"img","lines":"166,167"}},{"content":"<pre data-lines=\"168,171\"><code>SELECT FOR UPDATE &#x8bed;&#x53e5;&#x7684;&#x6267;&#x884c;&#x4f1a;&#x7533;&#x8bf7; **&#x5168;&#x5c40;&#x9501;** &#xff0c;&#x5982;&#x679c; **&#x5168;&#x5c40;&#x9501;** &#x88ab;&#x5176;&#x4ed6;&#x4e8b;&#x52a1;&#x6301;&#x6709;&#xff0c;&#x5219;&#x91ca;&#x653e;&#x672c;&#x5730;&#x9501;&#xff08;&#x56de;&#x6eda; SELECT FOR UPDATE &#x8bed;&#x53e5;&#x7684;&#x672c;&#x5730;&#x6267;&#x884c;&#xff09;&#x5e76;&#x91cd;&#x8bd5;&#x3002;&#x8fd9;&#x4e2a;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x67e5;&#x8be2;&#x662f;&#x88ab; block &#x4f4f;&#x7684;&#xff0c;&#x76f4;&#x5230; **&#x5168;&#x5c40;&#x9501;** &#x62ff;&#x5230;&#xff0c;&#x5373;&#x8bfb;&#x53d6;&#x7684;&#x76f8;&#x5173;&#x6570;&#x636e;&#x662f; **&#x5df2;&#x63d0;&#x4ea4;** &#x7684;&#xff0c;&#x624d;&#x8fd4;&#x56de;&#x3002;\n\n&#x51fa;&#x4e8e;&#x603b;&#x4f53;&#x6027;&#x80fd;&#x4e0a;&#x7684;&#x8003;&#x8651;&#xff0c;Seata &#x76ee;&#x524d;&#x7684;&#x65b9;&#x6848;&#x5e76;&#x6ca1;&#x6709;&#x5bf9;&#x6240;&#x6709; SELECT &#x8bed;&#x53e5;&#x90fd;&#x8fdb;&#x884c;&#x4ee3;&#x7406;&#xff0c;&#x4ec5;&#x9488;&#x5bf9; FOR UPDATE &#x7684; SELECT &#x8bed;&#x53e5;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"168,171"}}],"payload":{"tag":"h3","lines":"147,148"}}],"payload":{"tag":"h2","lines":"120,122"}},{"content":"3.4&#x3001;&#x5de5;&#x4f5c;&#x673a;&#x5236;","children":[{"content":"3.4.1&#x3001;&#x4e00;&#x9636;&#x6bb5;","children":[{"content":"<pre data-lines=\"194,198\"><code>&#x8fc7;&#x7a0b;&#xff1a;\n\n*   1&#x3001;&#x89e3;&#x6790; SQL&#xff1a;&#x5f97;&#x5230; SQL &#x7684;&#x7c7b;&#x578b;&#xff08;UPDATE&#xff09;&#xff0c;&#x8868;&#xff08;product&#xff09;&#xff0c;&#x6761;&#x4ef6;&#xff08;where name = &#x2018;TXC&#x2019;&#xff09;&#x7b49;&#x76f8;&#x5173;&#x7684;&#x4fe1;&#x606f;&#x3002;\n*   2&#x3001;&#x67e5;&#x8be2;&#x524d;&#x955c;&#x50cf;&#xff1a;&#x6839;&#x636e;&#x89e3;&#x6790;&#x5f97;&#x5230;&#x7684;&#x6761;&#x4ef6;&#x4fe1;&#x606f;&#xff0c;&#x751f;&#x6210;&#x67e5;&#x8be2;&#x8bed;&#x53e5;&#xff0c;&#x5b9a;&#x4f4d;&#x6570;&#x636e;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"194,198"}},{"content":"<pre data-lines=\"199,203\"><code class=\"language-sql\"><span class=\"hljs-keyword\">select</span> id, name, since <span class=\"hljs-keyword\">from</span> product <span class=\"hljs-keyword\">where</span> name <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&apos;TXC&apos;</span>;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"199,203"}},{"content":"<pre data-lines=\"204,208\"><code>&#x5f97;&#x5230;&#x524d;&#x955c;&#x50cf;&#xff1a;\n\n*   3&#x3001;&#x6267;&#x884c;&#x4e1a;&#x52a1; SQL&#xff1a;&#x66f4;&#x65b0;&#x8fd9;&#x6761;&#x8bb0;&#x5f55;&#x7684; name &#x4e3a; &#x2018;GTS&#x2019;&#x3002;\n*   4&#x3001;&#x67e5;&#x8be2;&#x540e;&#x955c;&#x50cf;&#xff1a;&#x6839;&#x636e;&#x524d;&#x955c;&#x50cf;&#x7684;&#x7ed3;&#x679c;&#xff0c;&#x901a;&#x8fc7; **&#x4e3b;&#x952e;** &#x5b9a;&#x4f4d;&#x6570;&#x636e;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"204,208"}},{"content":"<pre data-lines=\"209,213\"><code class=\"language-sql\"><span class=\"hljs-keyword\">select</span> id, name, since <span class=\"hljs-keyword\">from</span> product <span class=\"hljs-keyword\">where</span> id <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span>`;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"209,213"}},{"content":"<pre data-lines=\"214,217\"><code>&#x5f97;&#x5230;&#x540e;&#x955c;&#x50cf;&#xff1a;\n\n*   5&#x3001;&#x63d2;&#x5165;&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#xff1a;&#x628a;&#x524d;&#x540e;&#x955c;&#x50cf;&#x6570;&#x636e;&#x4ee5;&#x53ca;&#x4e1a;&#x52a1; SQL &#x76f8;&#x5173;&#x7684;&#x4fe1;&#x606f;&#x7ec4;&#x6210;&#x4e00;&#x6761;&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8bb0;&#x5f55;&#xff0c;&#x63d2;&#x5165;&#x5230; `UNDO_LOG` &#x8868;&#x4e2d;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"214,217"}},{"content":"<pre data-lines=\"218,264\"><code class=\"language-json\"><span class=\"hljs-punctuation\">{</span>\n\t<span class=\"hljs-attr\">&quot;branchId&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">641789253</span><span class=\"hljs-punctuation\">,</span>\n\t<span class=\"hljs-attr\">&quot;undoItems&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t<span class=\"hljs-attr\">&quot;afterImage&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;rows&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;fields&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;id&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">4</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;value&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">1</span>\n\t\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;name&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">12</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;value&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;GTS&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;since&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">12</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;value&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;2014&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;tableName&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;product&quot;</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;beforeImage&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t<span class=\"hljs-attr\">&quot;rows&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t\t<span class=\"hljs-attr\">&quot;fields&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">{</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;id&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">4</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;value&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">1</span>\n\t\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;name&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">12</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;value&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;TXC&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-punctuation\">{</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;name&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;since&quot;</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;type&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">12</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t\t\t<span class=\"hljs-attr\">&quot;value&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;2014&quot;</span>\n\t\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span>\n\t\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t\t\t<span class=\"hljs-attr\">&quot;tableName&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;product&quot;</span>\n\t\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n\t\t<span class=\"hljs-attr\">&quot;sqlType&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;UPDATE&quot;</span>\n\t<span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n\t<span class=\"hljs-attr\">&quot;xid&quot;</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">&quot;xid:xxx&quot;</span>\n<span class=\"hljs-punctuation\">}</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"218,264"}},{"content":"<pre data-lines=\"265,268\"><code>*   6&#x3001;&#x63d0;&#x4ea4;&#x524d;&#xff0c;&#x5411; TC &#x6ce8;&#x518c;&#x5206;&#x652f;&#xff1a;&#x7533;&#x8bf7; `product` &#x8868;&#x4e2d;&#xff0c;&#x4e3b;&#x952e;&#x503c;&#x7b49;&#x4e8e; 1 &#x7684;&#x8bb0;&#x5f55;&#x7684; **&#x5168;&#x5c40;&#x9501;** &#x3002;\n*   7&#x3001;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x63d0;&#x4ea4;&#xff1a;&#x4e1a;&#x52a1;&#x6570;&#x636e;&#x7684;&#x66f4;&#x65b0;&#x548c;&#x524d;&#x9762;&#x6b65;&#x9aa4;&#x4e2d;&#x751f;&#x6210;&#x7684; UNDO LOG &#x4e00;&#x5e76;&#x63d0;&#x4ea4;&#x3002;\n*   8&#x3001;&#x5c06;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x63d0;&#x4ea4;&#x7684;&#x7ed3;&#x679c;&#x4e0a;&#x62a5;&#x7ed9; TC&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"265,268"}}],"payload":{"tag":"h3","lines":"192,193"}},{"content":"3.4.2&#x3001;&#x4e8c;&#x9636;&#x6bb5;-&#x56de;&#x6eda;","children":[{"content":"<pre data-lines=\"271,275\"><code>*   1&#x3001;&#x6536;&#x5230; TC &#x7684;&#x5206;&#x652f;&#x56de;&#x6eda;&#x8bf7;&#x6c42;&#xff0c;&#x5f00;&#x542f;&#x4e00;&#x4e2a;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#xff0c;&#x6267;&#x884c;&#x5982;&#x4e0b;&#x64cd;&#x4f5c;&#x3002;\n*   2&#x3001;&#x901a;&#x8fc7; XID &#x548c; Branch ID &#x67e5;&#x627e;&#x5230;&#x76f8;&#x5e94;&#x7684; UNDO LOG &#x8bb0;&#x5f55;&#x3002;\n*   3&#x3001;&#x6570;&#x636e;&#x6821;&#x9a8c;&#xff1a;&#x62ff; UNDO LOG &#x4e2d;&#x7684;&#x540e;&#x955c;&#x4e0e;&#x5f53;&#x524d;&#x6570;&#x636e;&#x8fdb;&#x884c;&#x6bd4;&#x8f83;&#xff0c;&#x5982;&#x679c;&#x6709;&#x4e0d;&#x540c;&#xff0c;&#x8bf4;&#x660e;&#x6570;&#x636e;&#x88ab;&#x5f53;&#x524d;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x4e4b;&#x5916;&#x7684;&#x52a8;&#x4f5c;&#x505a;&#x4e86;&#x4fee;&#x6539;&#x3002;&#x8fd9;&#x79cd;&#x60c5;&#x51b5;&#xff0c;&#x9700;&#x8981;&#x6839;&#x636e;&#x914d;&#x7f6e;&#x7b56;&#x7565;&#x6765;&#x505a;&#x5904;&#x7406;&#xff0c;&#x8be6;&#x7ec6;&#x7684;&#x8bf4;&#x660e;&#x5728;&#x53e6;&#x5916;&#x7684;&#x6587;&#x6863;&#x4e2d;&#x4ecb;&#x7ecd;&#x3002;\n*   4&#x3001;&#x6839;&#x636e; UNDO LOG &#x4e2d;&#x7684;&#x524d;&#x955c;&#x50cf;&#x548c;&#x4e1a;&#x52a1; SQL &#x7684;&#x76f8;&#x5173;&#x4fe1;&#x606f;&#x751f;&#x6210;&#x5e76;&#x6267;&#x884c;&#x56de;&#x6eda;&#x7684;&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"271,275"}},{"content":"<pre data-lines=\"276,280\"><code class=\"language-sql\"><span class=\"hljs-keyword\">update</span> product <span class=\"hljs-keyword\">set</span> name <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&apos;TXC&apos;</span> <span class=\"hljs-keyword\">where</span> id <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span>;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"276,280"}},{"content":"<pre data-lines=\"281,282\"><code>*   5&#x3001;&#x63d0;&#x4ea4;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x3002;&#x5e76;&#x628a;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x7684;&#x6267;&#x884c;&#x7ed3;&#x679c;&#xff08;&#x5373;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x56de;&#x6eda;&#x7684;&#x7ed3;&#x679c;&#xff09;&#x4e0a;&#x62a5;&#x7ed9; TC&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"281,282"}}],"payload":{"tag":"h3","lines":"269,270"}},{"content":"3.4.3&#x3001;&#x4e8c;&#x9636;&#x6bb5;-&#x63d0;&#x4ea4;","children":[{"content":"<pre data-lines=\"285,287\"><code>*   1&#x3001;&#x6536;&#x5230; TC &#x7684;&#x5206;&#x652f;&#x63d0;&#x4ea4;&#x8bf7;&#x6c42;&#xff0c;&#x628a;&#x8bf7;&#x6c42;&#x653e;&#x5165;&#x4e00;&#x4e2a;&#x5f02;&#x6b65;&#x4efb;&#x52a1;&#x7684;&#x961f;&#x5217;&#x4e2d;&#xff0c;&#x9a6c;&#x4e0a;&#x8fd4;&#x56de;&#x63d0;&#x4ea4;&#x6210;&#x529f;&#x7684;&#x7ed3;&#x679c;&#x7ed9; TC&#x3002;\n*   2&#x3001;&#x5f02;&#x6b65;&#x4efb;&#x52a1;&#x9636;&#x6bb5;&#x7684;&#x5206;&#x652f;&#x63d0;&#x4ea4;&#x8bf7;&#x6c42;&#x5c06;&#x5f02;&#x6b65;&#x548c;&#x6279;&#x91cf;&#x5730;&#x5220;&#x9664;&#x76f8;&#x5e94; UNDO LOG &#x8bb0;&#x5f55;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"285,287"}}],"payload":{"tag":"h3","lines":"283,284"}}],"payload":{"tag":"h2","lines":"172,174"}},{"content":"3.5&#x3001;&#x9644;&#x5f55;&#x7ae0;&#x8282;","children":[{"content":"<pre data-lines=\"291,296\"><code>&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;\n\nUNDO\\_LOG Table&#xff1a;&#x4e0d;&#x540c;&#x6570;&#x636e;&#x5e93;&#x5728;&#x7c7b;&#x578b;&#x4e0a;&#x4f1a;&#x7565;&#x6709;&#x5dee;&#x522b;&#x3002;\n\n&#x4ee5; MySQL &#x4e3a;&#x4f8b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"291,296"}},{"content":"<table data-lines=\"297,306\">\n<thead data-lines=\"297,298\">\n<tr data-lines=\"297,298\">\n<th>Field</th>\n<th>Type</th>\n</tr>\n</thead>\n<tbody data-lines=\"299,306\">\n<tr data-lines=\"299,300\">\n<td>branch_id</td>\n<td>bigint PK</td>\n</tr>\n<tr data-lines=\"300,301\">\n<td>xid</td>\n<td>varchar(100)</td>\n</tr>\n<tr data-lines=\"301,302\">\n<td>context</td>\n<td>varchar(128)</td>\n</tr>\n<tr data-lines=\"302,303\">\n<td>rollback_info</td>\n<td>longblob</td>\n</tr>\n<tr data-lines=\"303,304\">\n<td>log_status</td>\n<td>tinyint</td>\n</tr>\n<tr data-lines=\"304,305\">\n<td>log_created</td>\n<td>datetime</td>\n</tr>\n<tr data-lines=\"305,306\">\n<td>log_modified</td>\n<td>datetime</td>\n</tr>\n</tbody>\n</table>","children":[],"payload":{"tag":"table","lines":"297,306"}},{"content":"<pre data-lines=\"307,323\"><code class=\"language-sql\">\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"307,323"}}],"payload":{"tag":"h2","lines":"288,290"}},{"content":"4.1&#x3001;&#x5bfc;&#x5165;&#x6570;&#x636e;","children":[{"content":"4.1.1&#x3001;&#x521b;&#x5efa;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"329,330\"><code>&#x6570;&#x636e;&#x5e93;&#x73af;&#x5883;&#x4e3a;`mysql 5.7.33`&#xff0c;&#x8bf7;&#x91cd;&#x65b0;&#x5bfc;&#x5165;&#x8fd0;&#x884c;&#x4ee5;&#x4e0b;sql&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"329,330"}},{"content":"<pre data-lines=\"331,352\"><code class=\"language-sql\"><span class=\"hljs-keyword\">DROP</span> DATABASE IF <span class=\"hljs-keyword\">EXISTS</span> `seata_account`;\n<span class=\"hljs-keyword\">CREATE</span> DATABASE `seata_account`;\n\nUSE `seata_account`;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> `t_account`;\n<span class=\"hljs-keyword\">CREATE TABLE</span> `t_account` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&apos;&#x4e3b;&#x952e;id&apos;</span>,\n  `user_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x7528;&#x6237;id&apos;</span>,\n  `total` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x603b;&#x989d;&#x5ea6;&apos;</span>,\n  `used` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x5df2;&#x7528;&#x4f59;&#x989d;&apos;</span>,\n  `residue` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-string\">&apos;0&apos;</span> COMMENT <span class=\"hljs-string\">&apos;&#x5269;&#x4f59;&#x989d;&#x5ea6;&apos;</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8 COMMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&apos;&#x8d26;&#x6237;&#x8868;&apos;</span>;\n\n<span class=\"hljs-keyword\">insert  into</span> `t_account`(`id`,`user_id`,`total`,`used`,`residue`) <span class=\"hljs-keyword\">values</span> (<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-string\">&apos;1000&apos;</span>,<span class=\"hljs-string\">&apos;0&apos;</span>,<span class=\"hljs-string\">&apos;1000&apos;</span>);\n\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> `seata_account`.`t_account` LIMIT <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>; \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"331,352"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/ffcb56a03ee5020343b63087c9436442.png\" alt>","children":[],"payload":{"tag":"img","lines":"353,354"}}],"payload":{"tag":"h3","lines":"327,328"}},{"content":"4.1.2&#x3001;&#x521b;&#x5efa;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"357,358\"><code>&#x6570;&#x636e;&#x5e93;&#x73af;&#x5883;&#x4e3a;`mysql 5.7.33`&#xff0c;&#x8bf7;&#x91cd;&#x65b0;&#x5bfc;&#x5165;&#x8fd0;&#x884c;&#x4ee5;&#x4e0b;sql&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"357,358"}},{"content":"<pre data-lines=\"359,380\"><code class=\"language-sql\"><span class=\"hljs-keyword\">DROP</span> DATABASE IF <span class=\"hljs-keyword\">EXISTS</span> `seata_storage`;\n<span class=\"hljs-keyword\">CREATE</span> DATABASE `seata_storage`;\n\nUSE `seata_storage`;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> `t_storage`;\n<span class=\"hljs-keyword\">CREATE TABLE</span> `t_storage` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&apos;&#x4e3b;&#x952e;id&apos;</span>,\n  `product_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x4ea7;&#x54c1;id&apos;</span>,\n  `total` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x603b;&#x5e93;&#x5b58;&apos;</span>,\n  `used` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x5df2;&#x7528;&#x5e93;&#x5b58;&apos;</span>,\n  `residue` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x5269;&#x4f59;&#x5e93;&#x5b58;&apos;</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8 COMMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&apos;&#x5e93;&#x5b58;&#x8868;&apos;</span>;\n\n<span class=\"hljs-keyword\">insert  into</span> `t_storage`(`id`,`product_id`,`total`,`used`,`residue`) <span class=\"hljs-keyword\">values</span> (<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">100</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">100</span>);\n\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> `seata_storage`.`t_storage` LIMIT <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>; \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"359,380"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/3a64c46d9b40939ada4eb56c96b2ca7e.png\" alt>","children":[],"payload":{"tag":"img","lines":"381,382"}}],"payload":{"tag":"h3","lines":"355,356"}},{"content":"4.1.3&#x3001;&#x521b;&#x5efa;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"385,386\"><code>&#x6570;&#x636e;&#x5e93;&#x73af;&#x5883;&#x4e3a;`mysql 5.7.33`&#xff0c;&#x8bf7;&#x91cd;&#x65b0;&#x5bfc;&#x5165;&#x8fd0;&#x884c;&#x4ee5;&#x4e0b;sql&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"385,386"}},{"content":"<pre data-lines=\"387,407\"><code class=\"language-sql\"><span class=\"hljs-keyword\">DROP</span> DATABASE `seata_order`;\n<span class=\"hljs-keyword\">CREATE</span> DATABASE `seata_order`;\n\nUSE `seata_order`;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> `t_order`;\n<span class=\"hljs-keyword\">CREATE TABLE</span> `t_order` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&apos;&#x4e3b;&#x952e;id&apos;</span>,\n  `user_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x7528;&#x6237;id&apos;</span>,\n  `product_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x4ea7;&#x54c1;id&apos;</span>,\n  `count` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x6570;&#x91cf;&apos;</span>,\n  `money` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">11</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x91d1;&#x989d;&apos;</span>,\n  `status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x72b6;&#x6001;&apos;</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8 COMMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&apos;&#x8ba2;&#x5355;&#x8868;&apos;</span>;\n\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> `seata_order`.`t_order` LIMIT <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>; \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"387,407"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/6597624956655a2576f922744f0024a6.png\" alt>","children":[],"payload":{"tag":"img","lines":"408,409"}}],"payload":{"tag":"h3","lines":"383,384"}}],"payload":{"tag":"h2","lines":"324,326"}},{"content":"4.2&#x3001;&#x5bfc;&#x5165;&#x5de5;&#x7a0b;","children":[{"content":"<pre data-lines=\"413,414\"><code>&#x5728;&#x684c;&#x9762;&#x91cd;&#x65b0;&#x521b;&#x5efa;&#x4e00;&#x4e2a;&#x6587;&#x4ef6;&#x5939;&#xff0c;&#x540d;&#x5b57;&#x65e0;&#x6240;&#x8c13;&#xff0c;&#x62f7;&#x8d1d;&#x914d;&#x5957;&#x8d44;&#x6599;&#x4e2d;&#x7684;`&#x5355;&#x4f53;&#x7248;\\single-app-seata-at-study`&#x5230;&#x6b64;&#x6587;&#x4ef6;&#x5939;&#xff0c;&#x7136;&#x540e;&#x4f7f;&#x7528;`idea`&#x6253;&#x5f00;&#x5373;&#x53ef;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"413,414"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b7010a1a5a52859eeac3ffc7367a08e2.png\" alt>","children":[],"payload":{"tag":"img","lines":"415,416"}},{"content":"<pre data-lines=\"417,418\"><code>`single-app-seata-at-study`&#x5df2;&#x7ecf;&#x5b9e;&#x73b0;&#x4e86;&#x57fa;&#x672c;&#x7684;&#x4ee3;&#x7801;&#x6d41;&#x7a0b;&#xff0c;&#x975e;&#x5e38;&#x7b80;&#x5355;&#xff0c;&#x76f8;&#x4fe1;&#x4f60;&#x4e00;&#x5b9a;&#x80fd;&#x770b;&#x61c2;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"417,418"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/88616562175c127bf226bb71ce768530.png\" alt>","children":[],"payload":{"tag":"img","lines":"419,420"}},{"content":"<pre data-lines=\"421,422\"><code>`single-app-seata-at-study`&#x662f;&#x4e00;&#x4e2a;&#x7eaf;&#x7cb9;&#x7684;`Spring Boot`&#x5355;&#x4f53;&#x5e94;&#x7528;&#xff0c;&#x8fde;&#x63a5;&#x7740;&#x4e09;&#x4e2a;&#x6570;&#x636e;&#x6e90;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"421,422"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/537e878bcdc925d68161e12bdf6eb079.png\" alt>","children":[],"payload":{"tag":"img","lines":"423,424"}},{"content":"<pre data-lines=\"425,426\"><code>&#x552f;&#x4e00;&#x9700;&#x8981;&#x4f60;&#x6ce8;&#x610f;&#x7684;&#x662f;&#xff0c;&#x6253;&#x5f00;`application.yaml`&#xff0c;&#x67e5;&#x770b;&#x8fde;&#x63a5;&#x6570;&#x636e;&#x6e90;&#x7684;&#x8d26;&#x6237;&#x5bc6;&#x7801;&#x662f;&#x5426;&#x6b63;&#x786e;&#xff0c;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"425,426"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/07c1d29ba8094728ad05fb81ffc90400.png\" alt>","children":[],"payload":{"tag":"img","lines":"427,428"}}],"payload":{"tag":"h2","lines":"410,412"}},{"content":"4.3&#x3001;&#x6b63;&#x5e38;&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"432,433\"><code>&#x8bf7;&#x542f;&#x52a8;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x7136;&#x540e;&#x8f93;&#x5165;&#x4e0b;&#x5355;&#x5730;&#x5740;&#x6d4b;&#x8bd5;&#xff1a;`http://localhost:9000/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100&amp;status=1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"432,433"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/119f2d34e8a82b1f98872f4c6adf6d5e.png\" alt>","children":[],"payload":{"tag":"img","lines":"434,435"}},{"content":"<pre data-lines=\"436,437\"><code>&#x8bf7;&#x6253;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8868;&#xff0c;&#x67e5;&#x770b;&#x4e0b;&#x5355;&#x4e4b;&#x540e;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#xff0c;&#x4f9d;&#x6b21;&#x662f;&#xff1a;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;&#x8868;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"436,437"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/037c27397c9c2d1a417466c1f91c452e.png\" alt>","children":[],"payload":{"tag":"img","lines":"438,439"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b5fffa396d3eed4505a0eb50fee0f202.png\" alt>","children":[],"payload":{"tag":"img","lines":"440,441"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/7a7f8d4daee4a10edf08f2cf7f31f37f.png\" alt>","children":[],"payload":{"tag":"img","lines":"442,443"}}],"payload":{"tag":"h2","lines":"429,431"}},{"content":"4.4&#x3001;&#x5f02;&#x5e38;&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"447,448\"><code>&#x4fee;&#x6539;`com.caochenlei.service.impl.AccountServiceImpl`&#x4ee3;&#x7801;&#x6dfb;&#x52a0;&#x5f02;&#x5e38;&#xff0c;&#x4ee3;&#x7801;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"447,448"}},{"content":"<pre data-lines=\"449,457\"><code class=\"language-java\"><span class=\"hljs-meta\">@Override</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">decrease</span><span class=\"hljs-params\">(Long userId, BigDecimal money)</span> {\n    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span> / <span class=\"hljs-number\">0</span>; \n    accountMapper.decrease(userId, money);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"449,457"}},{"content":"<pre data-lines=\"458,459\"><code>&#x8bf7;&#x91cd;&#x542f;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x7136;&#x540e;&#x8f93;&#x5165;&#x4e0b;&#x5355;&#x5730;&#x5740;&#x6d4b;&#x8bd5;&#xff1a;`http://localhost:9000/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100&amp;status=1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"458,459"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/cce9c5ce5db45657011bc2eac25e72e1.png\" alt>","children":[],"payload":{"tag":"img","lines":"460,461"}},{"content":"<pre data-lines=\"462,463\"><code>&#x8bf7;&#x6253;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8868;&#xff0c;&#x67e5;&#x770b;&#x4e0b;&#x5355;&#x4e4b;&#x540e;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#xff0c;&#x4f9d;&#x6b21;&#x662f;&#xff1a;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;&#x8868;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"462,463"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1a9552642561d49962a83b4c1443c125.png\" alt>","children":[],"payload":{"tag":"img","lines":"464,465"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b5fffa396d3eed4505a0eb50fee0f202.png\" alt>","children":[],"payload":{"tag":"img","lines":"466,467"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/7a7f8d4daee4a10edf08f2cf7f31f37f.png\" alt>","children":[],"payload":{"tag":"img","lines":"468,469"}},{"content":"<pre data-lines=\"470,471\"><code>&#x6211;&#x4eec;&#x53d1;&#x73b0;&#x8ba2;&#x5355;&#x4e0b;&#x5355;&#x5931;&#x8d25;&#xff0c;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x4e2d;&#x591a;&#x4e86;&#x4e00;&#x6761;&#x8ba2;&#x5355;&#x8bb0;&#x5f55;&#xff0c;&#x5b9e;&#x9645;&#x4e0a;&#x8fd9;&#x6761;&#x8bb0;&#x5f55;&#x4e0d;&#x5e94;&#x8be5;&#x6709;&#xff0c;&#x800c;&#x4e14;&#x8d26;&#x6237;&#x5bf9;&#x5e94;&#x7684;&#x4f59;&#x989d;&#x548c;&#x5e93;&#x5b58;&#x5e76;&#x6ca1;&#x6709;&#x51cf;&#x5c11;&#xff0c;&#x8fd9;&#x4e2a;&#x95ee;&#x9898;&#x662f;&#x5341;&#x5206;&#x53ef;&#x6015;&#x7684;&#x3002;&#x56e0;&#x4e3a;&#x6ca1;&#x6709;&#x4e8b;&#x52a1;&#x7684;&#x652f;&#x6301;&#xff0c;&#x4e0d;&#x80fd;&#x505a;&#x5230;&#x8981;&#x4e0d;&#x5168;&#x90e8;&#x6267;&#x884c;&#xff0c;&#x8981;&#x4e0d;&#x5168;&#x90e8;&#x5931;&#x8d25;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"470,471"}}],"payload":{"tag":"h2","lines":"444,446"}},{"content":"4.5&#x3001;&#x6dfb;&#x52a0;&#x65b0;&#x8868;","children":[{"content":"<pre data-lines=\"475,476\"><code>&#x5728;`&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;`&#x6dfb;&#x52a0;`&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;`&#xff0c;sql&#x8bed;&#x53e5;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"475,476"}},{"content":"<pre data-lines=\"477,494\"><code class=\"language-sql\">USE `seata_account`;\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"477,494"}},{"content":"<pre data-lines=\"495,496\"><code>&#x5728;`&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;`&#x6dfb;&#x52a0;`&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;`&#xff0c;sql&#x8bed;&#x53e5;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"495,496"}},{"content":"<pre data-lines=\"497,514\"><code class=\"language-sql\">USE `seata_storage`;\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"497,514"}},{"content":"<pre data-lines=\"515,516\"><code>&#x5728;`&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;`&#x6dfb;&#x52a0;`&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;`&#xff0c;sql&#x8bed;&#x53e5;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"515,516"}},{"content":"<pre data-lines=\"517,534\"><code class=\"language-sql\">USE `seata_order`;\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"517,534"}},{"content":"<pre data-lines=\"535,536\"><code>&#x6700;&#x7ec8;&#x5b8c;&#x6210;&#x4ee5;&#x540e;&#x7684;&#x6548;&#x679c;&#x5982;&#x4e0b;&#x56fe;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"535,536"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/eaa14b0d44d5b30da3e2d1120b4c0647.png\" alt>","children":[],"payload":{"tag":"img","lines":"537,538"}}],"payload":{"tag":"h2","lines":"472,474"}},{"content":"4.6&#x3001;&#x6dfb;&#x52a0;&#x4f9d;&#x8d56;","children":[{"content":"<pre data-lines=\"542,543\"><code>&#x5728;`pom.xml`&#x4e2d;&#x65b0;&#x589e;&#x4f9d;&#x8d56;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"542,543"}},{"content":"<pre data-lines=\"544,552\"><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.seata<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>seata-spring-boot-starter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.3.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"544,552"}}],"payload":{"tag":"h2","lines":"539,541"}},{"content":"4.7&#x3001;&#x6dfb;&#x52a0;&#x914d;&#x7f6e;","children":[{"content":"<pre data-lines=\"556,557\"><code>&#x5728;`application.yaml`&#x4e2d;&#x65b0;&#x589e;&#x914d;&#x7f6e;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"556,557"}},{"content":"<pre data-lines=\"558,612\"><code class=\"language-yaml\"><span class=\"hljs-attr\">server:</span>\n  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">9000</span>\n\n<span class=\"hljs-attr\">management:</span>\n  <span class=\"hljs-attr\">endpoints:</span>\n    <span class=\"hljs-attr\">web:</span>\n      <span class=\"hljs-attr\">exposure:</span>\n        <span class=\"hljs-attr\">include:</span> <span class=\"hljs-string\">&apos;*&apos;</span>\n\n<span class=\"hljs-attr\">spring:</span>\n  <span class=\"hljs-attr\">application:</span>\n    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">single-app-seata-at-study</span>\n  <span class=\"hljs-attr\">datasource:</span>\n    <span class=\"hljs-attr\">dynamic:</span>\n      <span class=\"hljs-attr\">primary:</span> <span class=\"hljs-string\">ordere-ds</span>\n      <span class=\"hljs-attr\">datasource:</span>\n        \n        <span class=\"hljs-attr\">account-ds:</span>\n          <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span>\n          <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:mysql://localhost:3306/seata_account?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false</span>\n          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">root</span> \n          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-number\">123456</span> \n        \n        <span class=\"hljs-attr\">storage-ds:</span>\n          <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span>\n          <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:mysql://localhost:3306/seata_storage?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false</span>\n          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">root</span> \n          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-number\">123456</span> \n        \n        <span class=\"hljs-attr\">ordere-ds:</span>\n          <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span>\n          <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:mysql://localhost:3306/seata_order?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false</span>\n          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">root</span> \n          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-number\">123456</span> \n      <span class=\"hljs-attr\">seata:</span> <span class=\"hljs-literal\">true</span> \n      <span class=\"hljs-attr\">seata-mode:</span> <span class=\"hljs-string\">at</span> \n\n\n<span class=\"hljs-attr\">seata:</span>\n  <span class=\"hljs-attr\">application-id:</span> <span class=\"hljs-string\">myapp</span> \n  <span class=\"hljs-attr\">tx-service-group:</span> <span class=\"hljs-string\">myapp-group</span> \n  <span class=\"hljs-attr\">service:</span>\n    <span class=\"hljs-attr\">vgroup-mapping:</span>\n      <span class=\"hljs-attr\">myapp-group:</span> <span class=\"hljs-string\">guangzhou</span> \n    <span class=\"hljs-attr\">group-list:</span>\n      <span class=\"hljs-attr\">guangzhou:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8091</span> \n      <span class=\"hljs-attr\">shanghai:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8091</span> \n  <span class=\"hljs-attr\">config:</span>\n    <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">file</span> \n  <span class=\"hljs-attr\">registry:</span>\n    <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">file</span> \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"558,612"}},{"content":"<pre data-lines=\"613,622\"><code>&#x4e8b;&#x52a1;&#x5206;&#x7ec4;&#x4e0e;&#x9ad8;&#x53ef;&#x7528;&#xff0c;&#x6700;&#x4f73;&#x5b9e;&#x8df5;1&#xff1a;TC&#x7684;&#x5f02;&#x5730;&#x591a;&#x673a;&#x623f;&#x5bb9;&#x707e;&#x5982;&#x4e0b;&#xff0c;&#x66f4;&#x591a;&#x6700;&#x4f73;&#x5b9e;&#x8df5;&#x8bf7;&#x8bbf;&#x95ee;&#xff1a;http://seata.io/zh-cn/docs/user/txgroup/transaction-group-and-ha.html\n\n*   &#x5047;&#x5b9a;TC&#x96c6;&#x7fa4;&#x90e8;&#x7f72;&#x5728;&#x4e24;&#x4e2a;&#x673a;&#x623f;&#xff1a;guangzhou&#x673a;&#x623f;&#xff08;&#x4e3b;&#xff09;&#x548c;shanghai&#x673a;&#x623f;&#xff08;&#x5907;&#xff09;&#x5404;&#x4e24;&#x4e2a;&#x5b9e;&#x4f8b;\n*   &#x4e00;&#x6574;&#x5957;&#x5fae;&#x670d;&#x52a1;&#x67b6;&#x6784;&#x9879;&#x76ee;&#xff1a;projectA\n*   projectA&#x5185;&#x6709;&#x5fae;&#x670d;&#x52a1;&#xff1a;serviceA&#x3001;serviceB&#x3001;serviceC &#x548c; serviceD\n\n&#x5176;&#x4e2d;&#xff0c;projectA&#x6240;&#x6709;&#x5fae;&#x670d;&#x52a1;&#x7684;&#x4e8b;&#x52a1;&#x5206;&#x7ec4;tx-transaction-group&#x8bbe;&#x7f6e;&#x4e3a;&#xff1a;projectA&#xff0c;projectA&#x6b63;&#x5e38;&#x60c5;&#x51b5;&#x4e0b;&#x4f7f;&#x7528;guangzhou&#x7684;TC&#x96c6;&#x7fa4;&#xff08;&#x4e3b;&#xff09;\n\n&#x90a3;&#x4e48;&#x6b63;&#x5e38;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;client&#x7aef;&#x7684;&#x914d;&#x7f6e;&#x5982;&#x4e0b;&#x6240;&#x793a;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"613,622"}},{"content":"<pre data-lines=\"623,628\"><code class=\"language-properties\">seata.tx-service-group=projectA\nseata.service.vgroup-mapping.projectA=Guangzhou\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"623,628"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/5a669e439f8921f09dba27516edcf28e.png\" alt>","children":[],"payload":{"tag":"img","lines":"629,630"}},{"content":"<pre data-lines=\"631,632\"><code>&#x5047;&#x5982;&#x6b64;&#x65f6;guangzhou&#x96c6;&#x7fa4;&#x5206;&#x7ec4;&#x6574;&#x4e2a;down&#x6389;&#xff0c;&#x6216;&#x8005;&#x56e0;&#x4e3a;&#x7f51;&#x7edc;&#x539f;&#x56e0;projectA&#x6682;&#x65f6;&#x65e0;&#x6cd5;&#x4e0e;Guangzhou&#x673a;&#x623f;&#x901a;&#x8baf;&#xff0c;&#x90a3;&#x4e48;&#x6211;&#x4eec;&#x5c06;&#x914d;&#x7f6e;&#x4e2d;&#x5fc3;&#x4e2d;&#x7684;Guangzhou&#x96c6;&#x7fa4;&#x5206;&#x7ec4;&#x6539;&#x4e3a;Shanghai&#xff0c;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"631,632"}},{"content":"<pre data-lines=\"633,637\"><code class=\"language-properties\">seata.service.vgroup-mapping.projectA=Shanghai\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"633,637"}},{"content":"<pre data-lines=\"638,639\"><code>&#x5e76;&#x63a8;&#x9001;&#x5230;&#x5404;&#x4e2a;&#x5fae;&#x670d;&#x52a1;&#xff0c;&#x4fbf;&#x5b8c;&#x6210;&#x4e86;&#x5bf9;&#x6574;&#x4e2a;projectA&#x9879;&#x76ee;&#x7684;TC&#x96c6;&#x7fa4;&#x52a8;&#x6001;&#x5207;&#x6362;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"638,639"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/d971c008c220f6ae645df8fe5e28e824.png\" alt>","children":[],"payload":{"tag":"img","lines":"640,641"}}],"payload":{"tag":"h2","lines":"553,555"}},{"content":"4.8&#x3001;&#x6dfb;&#x52a0;&#x6ce8;&#x89e3;","children":[{"content":"<pre data-lines=\"645,646\"><code>&#x4fee;&#x6539;`com.caochenlei.service.impl.OrderServiceImpl`&#x5f00;&#x542f;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x7ba1;&#x7406;&#xff0c;&#x4ee3;&#x7801;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"645,646"}},{"content":"<pre data-lines=\"647,658\"><code class=\"language-java\"><span class=\"hljs-meta\">@DS(&quot;order-ds&quot;)</span>\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-meta\">@Service</span>\n<span class=\"hljs-meta\">@GlobalTransactional</span> \n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OrderServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">OrderService</span> {\n    ...\n    ...\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"647,658"}}],"payload":{"tag":"h2","lines":"642,644"}},{"content":"4.9&#x3001;&#x5f02;&#x5e38;&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"662,663\"><code>&#x8bf7;&#x91cd;&#x542f;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x7136;&#x540e;&#x8f93;&#x5165;&#x4e0b;&#x5355;&#x5730;&#x5740;&#x6d4b;&#x8bd5;&#xff1a;`http://localhost:9000/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100&amp;status=1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"662,663"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/f152c534333938d4375c15e7792c2646.png\" alt>","children":[],"payload":{"tag":"img","lines":"664,665"}},{"content":"<pre data-lines=\"666,667\"><code>&#x8bf7;&#x6253;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8868;&#xff0c;&#x67e5;&#x770b;&#x4e0b;&#x5355;&#x4e4b;&#x540e;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#xff0c;&#x4f9d;&#x6b21;&#x662f;&#xff1a;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;&#x8868;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"666,667"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/fa4dec3576db00fc84edd887eabce80c.png\" alt>","children":[],"payload":{"tag":"img","lines":"668,669"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/25d243fdeacc9e9da968b1ce03e2fd7e.png\" alt>","children":[],"payload":{"tag":"img","lines":"670,671"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/ebc01b6efa9a008ad0bef0c94434d9f8.png\" alt>","children":[],"payload":{"tag":"img","lines":"672,673"}},{"content":"<pre data-lines=\"674,677\"><code>&#x6211;&#x4eec;&#x53d1;&#x73b0;&#x867d;&#x7136;&#x4e0b;&#x5355;&#x5931;&#x8d25;&#x4e86;&#xff0c;&#x4f46;&#x662f;&#x5e76;&#x6ca1;&#x6709;&#x5f80;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x63d2;&#x5165;&#x8ba2;&#x5355;&#x4fe1;&#x606f;&#xff0c;&#x8d26;&#x6237;&#x4f59;&#x989d;&#x548c;&#x5e93;&#x5b58;&#x4e5f;&#x6ca1;&#x6709;&#x51cf;&#x5c11;&#xff0c;&#x8fd9;&#x7b26;&#x5408;&#x6211;&#x4eec;&#x7684;&#x4e1a;&#x52a1;&#x903b;&#x8f91;&#xff0c;&#x591a;&#x6570;&#x636e;&#x6e90;&#x7684;&#x4e8b;&#x52a1;&#x7ba1;&#x7406;&#x5b8c;&#x7f8e;&#x89e3;&#x51b3;&#x3002;\n\n&gt; &#x6ce8;&#x610f;&#xff1a;&#x6d4b;&#x8bd5;&#x5b8c;&#x6bd5;&#xff0c;&#x8bf7;&#x5173;&#x95ed;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x9632;&#x6b62;&#x5f71;&#x54cd;&#x5176;&#x4ed6;&#x9879;&#x76ee;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"674,677"}}],"payload":{"tag":"h2","lines":"659,661"}},{"content":"5.1&#x3001;&#x5bfc;&#x5165;&#x6570;&#x636e;","children":[{"content":"5.1.1&#x3001;&#x91cd;&#x7f6e;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"683,684\"><code>&#x6570;&#x636e;&#x5e93;&#x73af;&#x5883;&#x4e3a;`mysql 5.7.33`&#xff0c;&#x8bf7;&#x91cd;&#x65b0;&#x5bfc;&#x5165;&#x8fd0;&#x884c;&#x4ee5;&#x4e0b;sql&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"683,684"}},{"content":"<pre data-lines=\"685,706\"><code class=\"language-sql\"><span class=\"hljs-keyword\">DROP</span> DATABASE IF <span class=\"hljs-keyword\">EXISTS</span> `seata_account`;\n<span class=\"hljs-keyword\">CREATE</span> DATABASE `seata_account`;\n\nUSE `seata_account`;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> `t_account`;\n<span class=\"hljs-keyword\">CREATE TABLE</span> `t_account` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&apos;&#x4e3b;&#x952e;id&apos;</span>,\n  `user_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x7528;&#x6237;id&apos;</span>,\n  `total` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x603b;&#x989d;&#x5ea6;&apos;</span>,\n  `used` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x5df2;&#x7528;&#x4f59;&#x989d;&apos;</span>,\n  `residue` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-string\">&apos;0&apos;</span> COMMENT <span class=\"hljs-string\">&apos;&#x5269;&#x4f59;&#x989d;&#x5ea6;&apos;</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8 COMMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&apos;&#x8d26;&#x6237;&#x8868;&apos;</span>;\n\n<span class=\"hljs-keyword\">insert  into</span> `t_account`(`id`,`user_id`,`total`,`used`,`residue`) <span class=\"hljs-keyword\">values</span> (<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-string\">&apos;1000&apos;</span>,<span class=\"hljs-string\">&apos;0&apos;</span>,<span class=\"hljs-string\">&apos;1000&apos;</span>);\n\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> `seata_account`.`t_account` LIMIT <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>; \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"685,706"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/ffcb56a03ee5020343b63087c9436442.png\" alt>","children":[],"payload":{"tag":"img","lines":"707,708"}}],"payload":{"tag":"h3","lines":"681,682"}},{"content":"5.1.2&#x3001;&#x91cd;&#x7f6e;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"711,712\"><code>&#x6570;&#x636e;&#x5e93;&#x73af;&#x5883;&#x4e3a;`mysql 5.7.33`&#xff0c;&#x8bf7;&#x91cd;&#x65b0;&#x5bfc;&#x5165;&#x8fd0;&#x884c;&#x4ee5;&#x4e0b;sql&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"711,712"}},{"content":"<pre data-lines=\"713,734\"><code class=\"language-sql\"><span class=\"hljs-keyword\">DROP</span> DATABASE IF <span class=\"hljs-keyword\">EXISTS</span> `seata_storage`;\n<span class=\"hljs-keyword\">CREATE</span> DATABASE `seata_storage`;\n\nUSE `seata_storage`;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> `t_storage`;\n<span class=\"hljs-keyword\">CREATE TABLE</span> `t_storage` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&apos;&#x4e3b;&#x952e;id&apos;</span>,\n  `product_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x4ea7;&#x54c1;id&apos;</span>,\n  `total` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x603b;&#x5e93;&#x5b58;&apos;</span>,\n  `used` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x5df2;&#x7528;&#x5e93;&#x5b58;&apos;</span>,\n  `residue` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x5269;&#x4f59;&#x5e93;&#x5b58;&apos;</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8 COMMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&apos;&#x5e93;&#x5b58;&#x8868;&apos;</span>;\n\n<span class=\"hljs-keyword\">insert  into</span> `t_storage`(`id`,`product_id`,`total`,`used`,`residue`) <span class=\"hljs-keyword\">values</span> (<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">100</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">100</span>);\n\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> `seata_storage`.`t_storage` LIMIT <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>; \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"713,734"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/3a64c46d9b40939ada4eb56c96b2ca7e.png\" alt>","children":[],"payload":{"tag":"img","lines":"735,736"}}],"payload":{"tag":"h3","lines":"709,710"}},{"content":"5.1.3&#x3001;&#x91cd;&#x7f6e;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"739,740\"><code>&#x6570;&#x636e;&#x5e93;&#x73af;&#x5883;&#x4e3a;`mysql 5.7.33`&#xff0c;&#x8bf7;&#x91cd;&#x65b0;&#x5bfc;&#x5165;&#x8fd0;&#x884c;&#x4ee5;&#x4e0b;sql&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"739,740"}},{"content":"<pre data-lines=\"741,761\"><code class=\"language-sql\"><span class=\"hljs-keyword\">DROP</span> DATABASE `seata_order`;\n<span class=\"hljs-keyword\">CREATE</span> DATABASE `seata_order`;\n\nUSE `seata_order`;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> `t_order`;\n<span class=\"hljs-keyword\">CREATE TABLE</span> `t_order` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&apos;&#x4e3b;&#x952e;id&apos;</span>,\n  `user_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x7528;&#x6237;id&apos;</span>,\n  `product_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x4ea7;&#x54c1;id&apos;</span>,\n  `count` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x6570;&#x91cf;&apos;</span>,\n  `money` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">11</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x91d1;&#x989d;&apos;</span>,\n  `status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x72b6;&#x6001;&apos;</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8 COMMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&apos;&#x8ba2;&#x5355;&#x8868;&apos;</span>;\n\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> `seata_order`.`t_order` LIMIT <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>; \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"741,761"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/6597624956655a2576f922744f0024a6.png\" alt>","children":[],"payload":{"tag":"img","lines":"762,763"}}],"payload":{"tag":"h3","lines":"737,738"}}],"payload":{"tag":"h2","lines":"678,680"}},{"content":"5.2&#x3001;&#x5bfc;&#x5165;&#x5de5;&#x7a0b;","children":[{"content":"<pre data-lines=\"767,768\"><code>&#x5728;&#x684c;&#x9762;&#x91cd;&#x65b0;&#x521b;&#x5efa;&#x4e00;&#x4e2a;&#x6587;&#x4ef6;&#x5939;&#xff0c;&#x540d;&#x5b57;&#x65e0;&#x6240;&#x8c13;&#xff0c;&#x62f7;&#x8d1d;&#x914d;&#x5957;&#x8d44;&#x6599;&#x4e2d;&#x7684;`&#x5206;&#x5e03;&#x5f0f;\\distributed-seata-at-study`&#x5230;&#x6b64;&#x6587;&#x4ef6;&#x5939;&#xff0c;&#x7136;&#x540e;&#x4f7f;&#x7528;`idea`&#x6253;&#x5f00;&#x5373;&#x53ef;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"767,768"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/4725670c7b4bf3c1a53b001c0124f50f.png\" alt>","children":[],"payload":{"tag":"img","lines":"769,770"}},{"content":"<pre data-lines=\"771,772\"><code>`distributed-seata-at-study`&#x5df2;&#x7ecf;&#x5b9e;&#x73b0;&#x4e86;&#x57fa;&#x672c;&#x7684;&#x4ee3;&#x7801;&#x6d41;&#x7a0b;&#xff0c;&#x975e;&#x5e38;&#x7b80;&#x5355;&#xff0c;&#x76f8;&#x4fe1;&#x4f60;&#x4e00;&#x5b9a;&#x80fd;&#x770b;&#x61c2;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"771,772"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/28059b7849792b0b86f8a037518eb082.png\" alt>","children":[],"payload":{"tag":"img","lines":"773,774"}},{"content":"<pre data-lines=\"775,776\"><code>`distributed-seata-at-study`&#x662f;&#x4e00;&#x4e2a;&#x5178;&#x578b;&#x7684;&#x5fae;&#x670d;&#x52a1;&#x5e94;&#x7528;&#xff0c;&#x4e00;&#x5171;&#x6709;&#x4e09;&#x4e2a;&#x670d;&#x52a1;&#xff0c;&#x6bcf;&#x4e2a;&#x670d;&#x52a1;&#x90fd;&#x5b9e;&#x73b0;&#x4e86;&#x57fa;&#x672c;&#x7684;&#x4ee3;&#x7801;&#x903b;&#x8f91;&#xff0c;&#x5e76;&#x4e14;&#x90fd;&#x5bf9;&#x5e94;&#x4e00;&#x4e2a;&#x6570;&#x636e;&#x6e90;&#xff0c;&#x67b6;&#x6784;&#x5982;&#x4e0b;&#x56fe;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"775,776"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b94f50232328dcbed337836e5e390c4b.png\" alt>","children":[],"payload":{"tag":"img","lines":"777,778"}},{"content":"<pre data-lines=\"779,782\"><code>&#x552f;&#x4e00;&#x9700;&#x8981;&#x4f60;&#x6ce8;&#x610f;&#x7684;&#x662f;&#xff0c;&#x6253;&#x5f00;`application.yaml`&#xff0c;&#x67e5;&#x770b;&#x8fde;&#x63a5;&#x6570;&#x636e;&#x6e90;&#x7684;&#x8d26;&#x6237;&#x5bc6;&#x7801;&#x662f;&#x5426;&#x6b63;&#x786e;&#xff0c;&#x5e76;&#x4e14;&#x6211;&#x4eec;&#x9700;&#x8981;&#x4f60;&#x542f;&#x52a8;`nacos`&#x670d;&#x52a1;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;&#xff0c;&#x5982;&#x4e0b;&#xff1a;\n\n**service-account**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"779,782"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/c68b8b3ecd46b7a3aa8662c7c6b4cf8c.png\" alt>","children":[],"payload":{"tag":"img","lines":"783,784"}},{"content":"<pre data-lines=\"785,786\"><code>**service-storage**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"785,786"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/dec017c35078ea0c377123da8c70611d.png\" alt>","children":[],"payload":{"tag":"img","lines":"787,788"}},{"content":"<pre data-lines=\"789,790\"><code>**service-order**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"789,790"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/810032c2697b8f33e036d185ac85a53b.png\" alt>","children":[],"payload":{"tag":"img","lines":"791,792"}}],"payload":{"tag":"h2","lines":"764,766"}},{"content":"5.3&#x3001;&#x6b63;&#x5e38;&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"796,799\"><code>&#x786e;&#x4fdd;&#x542f;&#x52a8;`nacos`&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;&#x3002;\n\n&#x8bf7;&#x542f;&#x52a8;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x7136;&#x540e;&#x8f93;&#x5165;&#x4e0b;&#x5355;&#x5730;&#x5740;&#x6d4b;&#x8bd5;&#xff1a;`http://localhost:9003/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100&amp;status=1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"796,799"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/7355e94f5ff7b983196c7dc333d3a78b.png\" alt>","children":[],"payload":{"tag":"img","lines":"800,801"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/ba2759a75dc714bcc13eaf1d7b9621e8.png\" alt>","children":[],"payload":{"tag":"img","lines":"802,803"}},{"content":"<pre data-lines=\"804,805\"><code>&#x8bf7;&#x6253;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8868;&#xff0c;&#x67e5;&#x770b;&#x4e0b;&#x5355;&#x4e4b;&#x540e;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#xff0c;&#x4f9d;&#x6b21;&#x662f;&#xff1a;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;&#x8868;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"804,805"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/037c27397c9c2d1a417466c1f91c452e.png\" alt>","children":[],"payload":{"tag":"img","lines":"806,807"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b5fffa396d3eed4505a0eb50fee0f202.png\" alt>","children":[],"payload":{"tag":"img","lines":"808,809"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/7a7f8d4daee4a10edf08f2cf7f31f37f.png\" alt>","children":[],"payload":{"tag":"img","lines":"810,811"}}],"payload":{"tag":"h2","lines":"793,795"}},{"content":"5.4&#x3001;&#x5f02;&#x5e38;&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"815,816\"><code>&#x6253;&#x5f00;&#x5de5;&#x7a0b;`service-account`&#x4fee;&#x6539;`com.caochenlei.service.impl.AccountServiceImpl`&#x4ee3;&#x7801;&#x6dfb;&#x52a0;&#x5f02;&#x5e38;&#xff0c;&#x4ee3;&#x7801;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"815,816"}},{"content":"<pre data-lines=\"817,825\"><code class=\"language-java\"><span class=\"hljs-meta\">@Override</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">decrease</span><span class=\"hljs-params\">(Long userId, BigDecimal money)</span> {\n    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span> / <span class=\"hljs-number\">0</span>; \n    accountMapper.decrease(userId, money);\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"817,825"}},{"content":"<pre data-lines=\"826,827\"><code>&#x8bf7;&#x91cd;&#x542f;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x7136;&#x540e;&#x8f93;&#x5165;&#x4e0b;&#x5355;&#x5730;&#x5740;&#x6d4b;&#x8bd5;&#xff1a;`http://localhost:9003/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100&amp;status=1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"826,827"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/2728844759fed7d445f2dc806da9dc2f.png\" alt>","children":[],"payload":{"tag":"img","lines":"828,829"}},{"content":"<pre data-lines=\"830,831\"><code>&#x8bf7;&#x6253;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8868;&#xff0c;&#x67e5;&#x770b;&#x4e0b;&#x5355;&#x4e4b;&#x540e;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#xff0c;&#x4f9d;&#x6b21;&#x662f;&#xff1a;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;&#x8868;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"830,831"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1a9552642561d49962a83b4c1443c125.png\" alt>","children":[],"payload":{"tag":"img","lines":"832,833"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b5fffa396d3eed4505a0eb50fee0f202.png\" alt>","children":[],"payload":{"tag":"img","lines":"834,835"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/7a7f8d4daee4a10edf08f2cf7f31f37f.png\" alt>","children":[],"payload":{"tag":"img","lines":"836,837"}},{"content":"<pre data-lines=\"838,839\"><code>&#x6211;&#x4eec;&#x53d1;&#x73b0;&#x8ba2;&#x5355;&#x4e0b;&#x5355;&#x5931;&#x8d25;&#xff0c;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x4e2d;&#x591a;&#x4e86;&#x4e00;&#x6761;&#x8ba2;&#x5355;&#x8bb0;&#x5f55;&#xff0c;&#x5b9e;&#x9645;&#x4e0a;&#x8fd9;&#x6761;&#x8bb0;&#x5f55;&#x4e0d;&#x5e94;&#x8be5;&#x6709;&#xff0c;&#x800c;&#x4e14;&#x8d26;&#x6237;&#x5bf9;&#x5e94;&#x7684;&#x4f59;&#x989d;&#x548c;&#x5e93;&#x5b58;&#x5e76;&#x6ca1;&#x6709;&#x51cf;&#x5c11;&#xff0c;&#x8fd9;&#x4e2a;&#x95ee;&#x9898;&#x662f;&#x5341;&#x5206;&#x53ef;&#x6015;&#x7684;&#x3002;&#x56e0;&#x4e3a;&#x6ca1;&#x6709;&#x4e8b;&#x52a1;&#x7684;&#x652f;&#x6301;&#xff0c;&#x4e0d;&#x80fd;&#x505a;&#x5230;&#x8981;&#x4e0d;&#x5168;&#x90e8;&#x6267;&#x884c;&#xff0c;&#x8981;&#x4e0d;&#x5168;&#x90e8;&#x5931;&#x8d25;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"838,839"}}],"payload":{"tag":"h2","lines":"812,814"}},{"content":"5.5&#x3001;&#x6dfb;&#x52a0;&#x65b0;&#x8868;","children":[{"content":"<pre data-lines=\"843,844\"><code>&#x5728;`&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;`&#x6dfb;&#x52a0;`&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;`&#xff0c;sql&#x8bed;&#x53e5;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"843,844"}},{"content":"<pre data-lines=\"845,862\"><code class=\"language-sql\">USE `seata_account`;\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"845,862"}},{"content":"<pre data-lines=\"863,864\"><code>&#x5728;`&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;`&#x6dfb;&#x52a0;`&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;`&#xff0c;sql&#x8bed;&#x53e5;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"863,864"}},{"content":"<pre data-lines=\"865,882\"><code class=\"language-sql\">USE `seata_storage`;\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"865,882"}},{"content":"<pre data-lines=\"883,884\"><code>&#x5728;`&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;`&#x6dfb;&#x52a0;`&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;`&#xff0c;sql&#x8bed;&#x53e5;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"883,884"}},{"content":"<pre data-lines=\"885,902\"><code class=\"language-sql\">USE `seata_order`;\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"885,902"}},{"content":"<pre data-lines=\"903,904\"><code>&#x6700;&#x7ec8;&#x5b8c;&#x6210;&#x4ee5;&#x540e;&#x7684;&#x6548;&#x679c;&#x5982;&#x4e0b;&#x56fe;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"903,904"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/eaa14b0d44d5b30da3e2d1120b4c0647.png\" alt>","children":[],"payload":{"tag":"img","lines":"905,906"}}],"payload":{"tag":"h2","lines":"840,842"}},{"content":"5.6&#x3001;&#x6dfb;&#x52a0;&#x4f9d;&#x8d56;","children":[{"content":"<pre data-lines=\"910,911\"><code>&#x5728;`service-order`&#x7684;`pom.xml`&#x4e2d;&#x65b0;&#x589e;&#x4f9d;&#x8d56;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"910,911"}},{"content":"<pre data-lines=\"912,919\"><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"912,919"}}],"payload":{"tag":"h2","lines":"907,909"}},{"content":"5.7&#x3001;&#x6dfb;&#x52a0;&#x914d;&#x7f6e;","children":[{"content":"<pre data-lines=\"923,924\"><code>&#x5728;`service-order`&#x7684;`application.yaml`&#x4e2d;&#x65b0;&#x589e;&#x914d;&#x7f6e;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"923,924"}},{"content":"<pre data-lines=\"925,972\"><code class=\"language-yaml\"><span class=\"hljs-attr\">server:</span>\n  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">9003</span>\n\n<span class=\"hljs-attr\">management:</span>\n  <span class=\"hljs-attr\">endpoints:</span>\n    <span class=\"hljs-attr\">web:</span>\n      <span class=\"hljs-attr\">exposure:</span>\n        <span class=\"hljs-attr\">include:</span> <span class=\"hljs-string\">&apos;*&apos;</span>\n\n<span class=\"hljs-attr\">spring:</span>\n  <span class=\"hljs-attr\">application:</span>\n    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">service-order</span>\n  <span class=\"hljs-attr\">cloud:</span>\n    <span class=\"hljs-attr\">nacos:</span>\n      <span class=\"hljs-attr\">discovery:</span>\n        <span class=\"hljs-attr\">server-addr:</span> <span class=\"hljs-string\">http://localhost:8848</span>\n  <span class=\"hljs-attr\">datasource:</span>\n    <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span>\n    <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:mysql://localhost:3306/seata_order?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false</span>\n    <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">root</span> \n    <span class=\"hljs-attr\">password:</span> <span class=\"hljs-number\">123456</span> \n\n\n<span class=\"hljs-attr\">feign:</span>\n  <span class=\"hljs-attr\">client:</span>\n    <span class=\"hljs-attr\">config:</span>\n      <span class=\"hljs-attr\">default:</span>\n        <span class=\"hljs-attr\">connect-timeout:</span> <span class=\"hljs-number\">5000</span>\n        <span class=\"hljs-attr\">read-timeout:</span> <span class=\"hljs-number\">5000</span>\n\n\n<span class=\"hljs-attr\">seata:</span>\n  <span class=\"hljs-attr\">application-id:</span> <span class=\"hljs-string\">myapp</span> \n  <span class=\"hljs-attr\">tx-service-group:</span> <span class=\"hljs-string\">myapp-group</span> \n  <span class=\"hljs-attr\">service:</span>\n    <span class=\"hljs-attr\">vgroup-mapping:</span>\n      <span class=\"hljs-attr\">myapp-group:</span> <span class=\"hljs-string\">guangzhou</span> \n    <span class=\"hljs-attr\">group-list:</span>\n      <span class=\"hljs-attr\">guangzhou:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8091</span> \n      <span class=\"hljs-attr\">shanghai:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8091</span> \n  <span class=\"hljs-attr\">config:</span>\n    <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">file</span> \n  <span class=\"hljs-attr\">registry:</span>\n    <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">file</span> \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"925,972"}}],"payload":{"tag":"h2","lines":"920,922"}},{"content":"5.8&#x3001;&#x6dfb;&#x52a0;&#x6ce8;&#x89e3;","children":[{"content":"<pre data-lines=\"976,977\"><code>&#x6253;&#x5f00;`service-order`&#x4fee;&#x6539;`com.caochenlei.service.impl.OrderServiceImpl`&#x5f00;&#x542f;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x7ba1;&#x7406;&#xff0c;&#x4ee3;&#x7801;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"976,977"}},{"content":"<pre data-lines=\"978,988\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-meta\">@Service</span>\n<span class=\"hljs-meta\">@GlobalTransactional</span> \n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OrderServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">OrderService</span> {\n    ...\n    ...\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"978,988"}}],"payload":{"tag":"h2","lines":"973,975"}},{"content":"5.9&#x3001;&#x5f02;&#x5e38;&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"992,993\"><code>&#x8bf7;&#x91cd;&#x542f;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x7136;&#x540e;&#x8f93;&#x5165;&#x4e0b;&#x5355;&#x5730;&#x5740;&#x6d4b;&#x8bd5;&#xff1a;`http://localhost:9003/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100&amp;status=1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"992,993"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1f54f4726bdbdbf22665e05956997bad.png\" alt>","children":[],"payload":{"tag":"img","lines":"994,995"}},{"content":"<pre data-lines=\"996,997\"><code>&#x8bf7;&#x6253;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8868;&#xff0c;&#x67e5;&#x770b;&#x4e0b;&#x5355;&#x4e4b;&#x540e;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#xff0c;&#x4f9d;&#x6b21;&#x662f;&#xff1a;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;&#x8868;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"996,997"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/fa4dec3576db00fc84edd887eabce80c.png\" alt>","children":[],"payload":{"tag":"img","lines":"998,999"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/25d243fdeacc9e9da968b1ce03e2fd7e.png\" alt>","children":[],"payload":{"tag":"img","lines":"1000,1001"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/ebc01b6efa9a008ad0bef0c94434d9f8.png\" alt>","children":[],"payload":{"tag":"img","lines":"1002,1003"}},{"content":"<pre data-lines=\"1004,1007\"><code>&#x6211;&#x4eec;&#x53d1;&#x73b0;&#x867d;&#x7136;&#x4e0b;&#x5355;&#x5931;&#x8d25;&#x4e86;&#xff0c;&#x4f46;&#x662f;&#x5e76;&#x6ca1;&#x6709;&#x5f80;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x63d2;&#x5165;&#x8ba2;&#x5355;&#x4fe1;&#x606f;&#xff0c;&#x8d26;&#x6237;&#x4f59;&#x989d;&#x548c;&#x5e93;&#x5b58;&#x4e5f;&#x6ca1;&#x6709;&#x51cf;&#x5c11;&#xff0c;&#x8fd9;&#x7b26;&#x5408;&#x6211;&#x4eec;&#x7684;&#x4e1a;&#x52a1;&#x903b;&#x8f91;&#xff0c;&#x5206;&#x5e03;&#x5f0f;&#x4e0b;&#x7684;&#x4e8b;&#x52a1;&#x7ba1;&#x7406;&#x5b8c;&#x7f8e;&#x89e3;&#x51b3;&#x3002;\n\n&gt; &#x6ce8;&#x610f;&#xff1a;&#x6d4b;&#x8bd5;&#x5b8c;&#x6bd5;&#xff0c;&#x8bf7;&#x5173;&#x95ed;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x9632;&#x6b62;&#x5f71;&#x54cd;&#x5176;&#x4ed6;&#x9879;&#x76ee;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1004,1007"}}],"payload":{"tag":"h2","lines":"989,991"}},{"content":"6.1&#x3001;&#x5173;&#x95ed;&#x5355;&#x673a;&#x7248;","children":[{"content":"<pre data-lines=\"1011,1012\"><code>&#x5173;&#x95ed;&#x5355;&#x673a;&#x7248;&#x7684;&#x547d;&#x4ee4;&#x884c;&#x7a97;&#x53e3;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1011,1012"}}],"payload":{"tag":"h2","lines":"1008,1010"}},{"content":"6.2&#x3001;&#x521b;&#x5efa;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"1016,1019\"><code>&#x9996;&#x5148;&#x521d;&#x59cb;&#x5316;&#x6570;&#x636e;&#x5e93;&#xff1a;`CREATE DATABASE seata; USE seata;`\n\n&#x83b7;&#x53d6;&#x8fd0;&#x884c;&#x811a;&#x672c;&#x5730;&#x5740;&#xff1a;https://github.com/seata/seata/tree/develop/script/server/db\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1016,1019"}},{"content":"<pre data-lines=\"1020,1079\"><code class=\"language-sql\">\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> IF <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">EXISTS</span> `global_table`\n(\n    `xid`                       <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n    `transaction_id`            <span class=\"hljs-type\">BIGINT</span>,\n    `status`                    TINYINT      <span class=\"hljs-keyword\">NOT NULL</span>,\n    `application_id`            <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">32</span>),\n    `transaction_service_group` <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">32</span>),\n    `transaction_name`          <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">128</span>),\n    `timeout`                   <span class=\"hljs-type\">INT</span>,\n    `begin_time`                <span class=\"hljs-type\">BIGINT</span>,\n    `application_data`          <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">2000</span>),\n    `gmt_create`                DATETIME,\n    `gmt_modified`              DATETIME,\n    <span class=\"hljs-keyword\">PRIMARY KEY</span> (`xid`),\n    KEY `idx_gmt_modified_status` (`gmt_modified`, `status`),\n    KEY `idx_transaction_id` (`transaction_id`)\n) ENGINE <span class=\"hljs-operator\">=</span> InnoDB\n  <span class=\"hljs-keyword\">DEFAULT</span> CHARSET <span class=\"hljs-operator\">=</span> utf8;\n\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> IF <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">EXISTS</span> `branch_table`\n(\n    `branch_id`         <span class=\"hljs-type\">BIGINT</span>       <span class=\"hljs-keyword\">NOT NULL</span>,\n    `xid`               <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n    `transaction_id`    <span class=\"hljs-type\">BIGINT</span>,\n    `resource_group_id` <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">32</span>),\n    `resource_id`       <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">256</span>),\n    `branch_type`       <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">8</span>),\n    `status`            TINYINT,\n    `client_id`         <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">64</span>),\n    `application_data`  <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">2000</span>),\n    `gmt_create`        DATETIME(<span class=\"hljs-number\">6</span>),\n    `gmt_modified`      DATETIME(<span class=\"hljs-number\">6</span>),\n    <span class=\"hljs-keyword\">PRIMARY KEY</span> (`branch_id`),\n    KEY `idx_xid` (`xid`)\n) ENGINE <span class=\"hljs-operator\">=</span> InnoDB\n  <span class=\"hljs-keyword\">DEFAULT</span> CHARSET <span class=\"hljs-operator\">=</span> utf8;\n\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> IF <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">EXISTS</span> `lock_table`\n(\n    `row_key`        <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n    `xid`            <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">96</span>),\n    `transaction_id` <span class=\"hljs-type\">BIGINT</span>,\n    `branch_id`      <span class=\"hljs-type\">BIGINT</span>       <span class=\"hljs-keyword\">NOT NULL</span>,\n    `resource_id`    <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">256</span>),\n    `table_name`     <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">32</span>),\n    `pk`             <span class=\"hljs-type\">VARCHAR</span>(<span class=\"hljs-number\">36</span>),\n    `gmt_create`     DATETIME,\n    `gmt_modified`   DATETIME,\n    <span class=\"hljs-keyword\">PRIMARY KEY</span> (`row_key`),\n    KEY `idx_branch_id` (`branch_id`)\n) ENGINE <span class=\"hljs-operator\">=</span> InnoDB\n  <span class=\"hljs-keyword\">DEFAULT</span> CHARSET <span class=\"hljs-operator\">=</span> utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1020,1079"}}],"payload":{"tag":"h2","lines":"1013,1015"}},{"content":"6.3&#x3001;&#x4fee;&#x6539;&#x5b58;&#x50a8;&#x6a21;&#x5f0f;","children":[{"content":"<pre data-lines=\"1083,1084\"><code>&#x627e;&#x5230;`seata\\conf\\file.conf`&#xff0c;&#x628a;&#x5b58;&#x50a8;&#x6a21;&#x5f0f;&#x4fee;&#x6539;&#x4e3a;`db`&#x5e76;&#x4fee;&#x6539;&#x6570;&#x636e;&#x6e90;&#x8fde;&#x63a5;&#xff0c;&#x4fee;&#x6539;&#x540e;&#x4fdd;&#x5b58;&#xff0c;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1083,1084"}},{"content":"<pre data-lines=\"1085,1139\"><code class=\"language-bash\">\nstore {\n  \n  mode = <span class=\"hljs-string\">&quot;db&quot;</span>\n\n  \n  file {\n    \n    <span class=\"hljs-built_in\">dir</span> = <span class=\"hljs-string\">&quot;sessionStore&quot;</span>\n    \n    maxBranchSessionSize = 16384\n    \n    maxGlobalSessionSize = 512\n    \n    fileWriteBufferCacheSize = 16384\n    \n    sessionReloadReadSize = 100\n    \n    flushDiskMode = async\n  }\n\n  \n  db {\n    \n    datasource = <span class=\"hljs-string\">&quot;druid&quot;</span>\n    \n    dbType = <span class=\"hljs-string\">&quot;mysql&quot;</span>\n    driverClassName = <span class=\"hljs-string\">&quot;com.mysql.jdbc.Driver&quot;</span>\n    url = <span class=\"hljs-string\">&quot;jdbc:mysql://127.0.0.1:3306/seata?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false&quot;</span>\n    user = <span class=\"hljs-string\">&quot;root&quot;</span>\n    password = <span class=\"hljs-string\">&quot;123456&quot;</span>\n    minConn = 5\n    maxConn = 30\n    globalTable = <span class=\"hljs-string\">&quot;global_table&quot;</span>\n    branchTable = <span class=\"hljs-string\">&quot;branch_table&quot;</span>\n    lockTable = <span class=\"hljs-string\">&quot;lock_table&quot;</span>\n    queryLimit = 100\n    maxWait = 5000\n  }\n\n  \n  redis {\n    host = <span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>\n    port = <span class=\"hljs-string\">&quot;6379&quot;</span>\n    password = <span class=\"hljs-string\">&quot;&quot;</span>\n    database = <span class=\"hljs-string\">&quot;0&quot;</span>\n    minConn = 1\n    maxConn = 10\n    queryLimit = 100\n  }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1085,1139"}}],"payload":{"tag":"h2","lines":"1080,1082"}},{"content":"6.4&#x3001;&#x4fee;&#x6539;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;","children":[{"content":"<pre data-lines=\"1143,1144\"><code>&#x627e;&#x5230;`seata\\conf\\registry.conf`&#xff0c;&#x628a;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;&#x4fee;&#x6539;&#x4e3a;`nacos`&#x5e76;&#x4fee;&#x6539;&#x767b;&#x5f55;&#x914d;&#x7f6e;&#xff0c;&#x4fee;&#x6539;&#x540e;&#x4fdd;&#x5b58;&#xff0c;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1143,1144"}},{"content":"<pre data-lines=\"1145,1206\"><code class=\"language-bash\">registry {\n  \n  <span class=\"hljs-built_in\">type</span> = <span class=\"hljs-string\">&quot;nacos&quot;</span>\n\n  nacos {\n    application = <span class=\"hljs-string\">&quot;seata-server&quot;</span>\n    serverAddr = <span class=\"hljs-string\">&quot;127.0.0.1:8848&quot;</span>\n    group = <span class=\"hljs-string\">&quot;SEATA_GROUP&quot;</span>\n    namespace = <span class=\"hljs-string\">&quot;public&quot;</span>\n    cluster = <span class=\"hljs-string\">&quot;default&quot;</span>\n    username = <span class=\"hljs-string\">&quot;nacos&quot;</span>\n    password = <span class=\"hljs-string\">&quot;nacos&quot;</span>\n  }\n  eureka {\n    serviceUrl = <span class=\"hljs-string\">&quot;http://localhost:8761/eureka&quot;</span>\n    application = <span class=\"hljs-string\">&quot;default&quot;</span>\n    weight = <span class=\"hljs-string\">&quot;1&quot;</span>\n  }\n  redis {\n    serverAddr = <span class=\"hljs-string\">&quot;localhost:6379&quot;</span>\n    db = 0\n    password = <span class=\"hljs-string\">&quot;&quot;</span>\n    cluster = <span class=\"hljs-string\">&quot;default&quot;</span>\n    <span class=\"hljs-built_in\">timeout</span> = 0\n  }\n  zk {\n    cluster = <span class=\"hljs-string\">&quot;default&quot;</span>\n    serverAddr = <span class=\"hljs-string\">&quot;127.0.0.1:2181&quot;</span>\n    sessionTimeout = 6000\n    connectTimeout = 2000\n    username = <span class=\"hljs-string\">&quot;&quot;</span>\n    password = <span class=\"hljs-string\">&quot;&quot;</span>\n  }\n  consul {\n    cluster = <span class=\"hljs-string\">&quot;default&quot;</span>\n    serverAddr = <span class=\"hljs-string\">&quot;127.0.0.1:8500&quot;</span>\n  }\n  etcd3 {\n    cluster = <span class=\"hljs-string\">&quot;default&quot;</span>\n    serverAddr = <span class=\"hljs-string\">&quot;http://localhost:2379&quot;</span>\n  }\n  sofa {\n    serverAddr = <span class=\"hljs-string\">&quot;127.0.0.1:9603&quot;</span>\n    application = <span class=\"hljs-string\">&quot;default&quot;</span>\n    region = <span class=\"hljs-string\">&quot;DEFAULT_ZONE&quot;</span>\n    datacenter = <span class=\"hljs-string\">&quot;DefaultDataCenter&quot;</span>\n    cluster = <span class=\"hljs-string\">&quot;default&quot;</span>\n    group = <span class=\"hljs-string\">&quot;SEATA_GROUP&quot;</span>\n    addressWaitTime = <span class=\"hljs-string\">&quot;3000&quot;</span>\n  }\n  file {\n    name = <span class=\"hljs-string\">&quot;file.conf&quot;</span>\n  }\n}\n...\n...\n...\n...\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1145,1206"}}],"payload":{"tag":"h2","lines":"1140,1142"}},{"content":"6.5&#x3001;&#x542f;&#x52a8;&#x4e24;&#x4e2a;&#x5b9e;&#x4f8b;","children":[{"content":"<pre data-lines=\"1210,1216\"><code>&#x542f;&#x52a8;&#x7b2c;&#x4e00;&#x4e2a;&#x5b9e;&#x4f8b;&#xff1a;`C:\\DevTools\\seata\\bin&gt;seata-server.bat -p 18901 -n 1`\n\n&#x542f;&#x52a8;&#x7b2c;&#x4e8c;&#x4e2a;&#x5b9e;&#x4f8b;&#xff1a;`C:\\DevTools\\seata\\bin&gt;seata-server.bat -p 28901 -n 2`\n\n*   \\-p&#xff1a;Seata TC Server &#x76d1;&#x542c;&#x7684;&#x7aef;&#x53e3;&#xff1b;\n*   \\-n&#xff1a;Server node&#xff0c;&#x5728;&#x591a;&#x4e2a; TC Server &#x65f6;&#xff0c;&#x9700;&#x533a;&#x5206;&#x5404;&#x81ea;&#x8282;&#x70b9;&#xff0c;&#x7528;&#x4e8e;&#x751f;&#x6210;&#x4e0d;&#x540c;&#x533a;&#x95f4;&#x7684; transactionId &#x4e8b;&#x52a1;&#x7f16;&#x53f7;&#xff0c;&#x4ee5;&#x514d;&#x51b2;&#x7a81;&#xff1b;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1210,1216"}}],"payload":{"tag":"h2","lines":"1207,1209"}},{"content":"6.6&#x3001;&#x67e5;&#x770b;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;","children":[{"content":"<pre data-lines=\"1220,1221\"><code>&#x6253;&#x5f00;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;&#xff1a;http://localhost:8848/nacos/&#xff0c;&#x767b;&#x5f55;&#x8d26;&#x6237;&#xff1a;nacos&#xff0c;&#x767b;&#x5f55;&#x5bc6;&#x7801;&#xff1a;nacos\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1220,1221"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/8c54ecae66fd04809da928615bfec8a9.png\" alt>","children":[],"payload":{"tag":"img","lines":"1222,1223"}},{"content":"<pre data-lines=\"1224,1228\"><code>&#x56de;&#x987e;&#x603b;&#x89c8;&#x4e2d;&#x7684;&#x63cf;&#x8ff0;&#xff1a;&#x4e00;&#x4e2a;&#x5206;&#x5e03;&#x5f0f;&#x7684;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#xff0c;&#x6574;&#x4f53;&#x662f; **&#x4e24;&#x9636;&#x6bb5;&#x63d0;&#x4ea4;** &#x7684;&#x6a21;&#x578b;&#x3002;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x662f;&#x7531;&#x82e5;&#x5e72;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x7ec4;&#x6210;&#x7684;&#xff0c;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x8981;&#x6ee1;&#x8db3; **&#x4e24;&#x9636;&#x6bb5;&#x63d0;&#x4ea4;** &#x7684;&#x6a21;&#x578b;&#x8981;&#x6c42;&#xff0c;&#x5373;&#x9700;&#x8981;&#x6bcf;&#x4e2a;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x90fd;&#x5177;&#x5907;&#x81ea;&#x5df1;&#x7684;&#xff1a;\n\n*   &#x4e00;&#x9636;&#x6bb5; prepare &#x884c;&#x4e3a;\n*   &#x4e8c;&#x9636;&#x6bb5; commit &#x6216; rollback &#x884c;&#x4e3a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1224,1228"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/d1ef95fccfeb5a65da806bc80eb8ffd4.png\" alt>","children":[],"payload":{"tag":"img","lines":"1229,1230"}},{"content":"<pre data-lines=\"1231,1248\"><code>&#x6839;&#x636e;&#x4e24;&#x9636;&#x6bb5;&#x884c;&#x4e3a;&#x6a21;&#x5f0f;&#x7684;&#x4e0d;&#x540c;&#xff0c;&#x6211;&#x4eec;&#x5c06;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x5212;&#x5206;&#x4e3a; **Automatic (Branch) Transaction Mode** &#x548c; **TCC (Branch) Transaction Mode**.\n\nAT &#x6a21;&#x5f0f;&#xff08;[&#x53c2;&#x8003;&#x94fe;&#x63a5; TBD](http://seata.io/zh-cn/docs/dev/mode/tcc-mode.html)&#xff09;&#x57fa;&#x4e8e; **&#x652f;&#x6301;&#x672c;&#x5730; ACID &#x4e8b;&#x52a1;** &#x7684; **&#x5173;&#x7cfb;&#x578b;&#x6570;&#x636e;&#x5e93;**&#xff1a;\n\n*   &#x4e00;&#x9636;&#x6bb5; prepare &#x884c;&#x4e3a;&#xff1a;&#x5728;&#x672c;&#x5730;&#x4e8b;&#x52a1;&#x4e2d;&#xff0c;&#x4e00;&#x5e76;&#x63d0;&#x4ea4;&#x4e1a;&#x52a1;&#x6570;&#x636e;&#x66f4;&#x65b0;&#x548c;&#x76f8;&#x5e94;&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8bb0;&#x5f55;&#x3002;\n*   &#x4e8c;&#x9636;&#x6bb5; commit &#x884c;&#x4e3a;&#xff1a;&#x9a6c;&#x4e0a;&#x6210;&#x529f;&#x7ed3;&#x675f;&#xff0c;**&#x81ea;&#x52a8;** &#x5f02;&#x6b65;&#x6279;&#x91cf;&#x6e05;&#x7406;&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x3002;\n*   &#x4e8c;&#x9636;&#x6bb5; rollback &#x884c;&#x4e3a;&#xff1a;&#x901a;&#x8fc7;&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#xff0c;**&#x81ea;&#x52a8;** &#x751f;&#x6210;&#x8865;&#x507f;&#x64cd;&#x4f5c;&#xff0c;&#x5b8c;&#x6210;&#x6570;&#x636e;&#x56de;&#x6eda;&#x3002;\n\n&#x76f8;&#x5e94;&#x7684;&#xff0c;TCC &#x6a21;&#x5f0f;&#xff0c;&#x4e0d;&#x4f9d;&#x8d56;&#x4e8e;&#x5e95;&#x5c42;&#x6570;&#x636e;&#x8d44;&#x6e90;&#x7684;&#x4e8b;&#x52a1;&#x652f;&#x6301;&#xff1a;\n\n*   &#x4e00;&#x9636;&#x6bb5; prepare &#x884c;&#x4e3a;&#xff1a;&#x8c03;&#x7528; **&#x81ea;&#x5b9a;&#x4e49;** &#x7684; prepare &#x903b;&#x8f91;&#x3002;\n*   &#x4e8c;&#x9636;&#x6bb5; commit &#x884c;&#x4e3a;&#xff1a;&#x8c03;&#x7528; **&#x81ea;&#x5b9a;&#x4e49;** &#x7684; commit &#x903b;&#x8f91;&#x3002;\n*   &#x4e8c;&#x9636;&#x6bb5; rollback &#x884c;&#x4e3a;&#xff1a;&#x8c03;&#x7528; **&#x81ea;&#x5b9a;&#x4e49;** &#x7684; rollback &#x903b;&#x8f91;&#x3002;\n\n&#x6240;&#x8c13; TCC &#x6a21;&#x5f0f;&#xff0c;&#x662f;&#x6307;&#x652f;&#x6301;&#x628a; **&#x81ea;&#x5b9a;&#x4e49;** &#x7684;&#x5206;&#x652f;&#x4e8b;&#x52a1;&#x7eb3;&#x5165;&#x5230;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x7684;&#x7ba1;&#x7406;&#x4e2d;&#x3002;\n\n&#x6211;&#x4eec;&#x5176;&#x5b9e;&#x53ef;&#x4ee5;&#x7406;&#x89e3;&#xff0c;TCC&#x6a21;&#x5f0f;&#x6240;&#x6709;&#x9636;&#x6bb5;&#x7684;&#x4ee3;&#x7801;&#x90fd;&#x662f;&#x81ea;&#x5df1;&#x5b9e;&#x73b0;&#x7684;&#xff0c;&#x6240;&#x4ee5;&#x5b83;&#x80fd;&#x591f;&#x66f4;&#x52a0;&#x7075;&#x6d3b;&#x7684;&#x56de;&#x6eda;&#x5404;&#x79cd;&#x5173;&#x7cfb;&#x578b;&#x6570;&#x636e;&#x5e93;&#x3001;&#x975e;&#x5173;&#x7cfb;&#x578b;&#x6570;&#x636e;&#x5e93;&#x3001;&#x6d88;&#x606f;&#x4e2d;&#x95f4;&#x4ef6;&#x7b49;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1231,1248"}}],"payload":{"tag":"h2","lines":"1217,1219"}},{"content":"8.1&#x3001;&#x5bfc;&#x5165;&#x6570;&#x636e;","children":[{"content":"8.1.1&#x3001;&#x91cd;&#x7f6e;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"1254,1255\"><code>&#x6570;&#x636e;&#x5e93;&#x73af;&#x5883;&#x4e3a;`mysql 5.7.33`&#xff0c;&#x8bf7;&#x91cd;&#x65b0;&#x5bfc;&#x5165;&#x8fd0;&#x884c;&#x4ee5;&#x4e0b;sql&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1254,1255"}},{"content":"<pre data-lines=\"1256,1277\"><code class=\"language-sql\"><span class=\"hljs-keyword\">DROP</span> DATABASE IF <span class=\"hljs-keyword\">EXISTS</span> `seata_account`;\n<span class=\"hljs-keyword\">CREATE</span> DATABASE `seata_account`;\n\nUSE `seata_account`;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> `t_account`;\n<span class=\"hljs-keyword\">CREATE TABLE</span> `t_account` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&apos;&#x4e3b;&#x952e;id&apos;</span>,\n  `user_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x7528;&#x6237;id&apos;</span>,\n  `total` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x603b;&#x989d;&#x5ea6;&apos;</span>,\n  `used` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x5df2;&#x7528;&#x4f59;&#x989d;&apos;</span>,\n  `residue` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-string\">&apos;0&apos;</span> COMMENT <span class=\"hljs-string\">&apos;&#x5269;&#x4f59;&#x989d;&#x5ea6;&apos;</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8 COMMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&apos;&#x8d26;&#x6237;&#x8868;&apos;</span>;\n\n<span class=\"hljs-keyword\">insert  into</span> `t_account`(`id`,`user_id`,`total`,`used`,`residue`) <span class=\"hljs-keyword\">values</span> (<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-string\">&apos;1000&apos;</span>,<span class=\"hljs-string\">&apos;0&apos;</span>,<span class=\"hljs-string\">&apos;1000&apos;</span>);\n\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> `seata_account`.`t_account` LIMIT <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>; \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1256,1277"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/ffcb56a03ee5020343b63087c9436442.png\" alt>","children":[],"payload":{"tag":"img","lines":"1278,1279"}}],"payload":{"tag":"h3","lines":"1252,1253"}},{"content":"8.1.2&#x3001;&#x91cd;&#x7f6e;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"1282,1283\"><code>&#x6570;&#x636e;&#x5e93;&#x73af;&#x5883;&#x4e3a;`mysql 5.7.33`&#xff0c;&#x8bf7;&#x91cd;&#x65b0;&#x5bfc;&#x5165;&#x8fd0;&#x884c;&#x4ee5;&#x4e0b;sql&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1282,1283"}},{"content":"<pre data-lines=\"1284,1305\"><code class=\"language-sql\"><span class=\"hljs-keyword\">DROP</span> DATABASE IF <span class=\"hljs-keyword\">EXISTS</span> `seata_storage`;\n<span class=\"hljs-keyword\">CREATE</span> DATABASE `seata_storage`;\n\nUSE `seata_storage`;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> `t_storage`;\n<span class=\"hljs-keyword\">CREATE TABLE</span> `t_storage` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&apos;&#x4e3b;&#x952e;id&apos;</span>,\n  `product_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x4ea7;&#x54c1;id&apos;</span>,\n  `total` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x603b;&#x5e93;&#x5b58;&apos;</span>,\n  `used` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x5df2;&#x7528;&#x5e93;&#x5b58;&apos;</span>,\n  `residue` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x5269;&#x4f59;&#x5e93;&#x5b58;&apos;</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8 COMMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&apos;&#x5e93;&#x5b58;&#x8868;&apos;</span>;\n\n<span class=\"hljs-keyword\">insert  into</span> `t_storage`(`id`,`product_id`,`total`,`used`,`residue`) <span class=\"hljs-keyword\">values</span> (<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">100</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">100</span>);\n\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> `seata_storage`.`t_storage` LIMIT <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>; \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1284,1305"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/3a64c46d9b40939ada4eb56c96b2ca7e.png\" alt>","children":[],"payload":{"tag":"img","lines":"1306,1307"}}],"payload":{"tag":"h3","lines":"1280,1281"}},{"content":"8.1.3&#x3001;&#x91cd;&#x7f6e;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"1310,1311\"><code>&#x6570;&#x636e;&#x5e93;&#x73af;&#x5883;&#x4e3a;`mysql 5.7.33`&#xff0c;&#x8bf7;&#x91cd;&#x65b0;&#x5bfc;&#x5165;&#x8fd0;&#x884c;&#x4ee5;&#x4e0b;sql&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1310,1311"}},{"content":"<pre data-lines=\"1312,1332\"><code class=\"language-sql\"><span class=\"hljs-keyword\">DROP</span> DATABASE `seata_order`;\n<span class=\"hljs-keyword\">CREATE</span> DATABASE `seata_order`;\n\nUSE `seata_order`;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> `t_order`;\n<span class=\"hljs-keyword\">CREATE TABLE</span> `t_order` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&apos;&#x4e3b;&#x952e;id&apos;</span>,\n  `user_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x7528;&#x6237;id&apos;</span>,\n  `product_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x4ea7;&#x54c1;id&apos;</span>,\n  `count` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x6570;&#x91cf;&apos;</span>,\n  `money` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">11</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x91d1;&#x989d;&apos;</span>,\n  `status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x72b6;&#x6001;&apos;</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8 COMMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&apos;&#x8ba2;&#x5355;&#x8868;&apos;</span>;\n\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> `seata_order`.`t_order` LIMIT <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>; \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1312,1332"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/6597624956655a2576f922744f0024a6.png\" alt>","children":[],"payload":{"tag":"img","lines":"1333,1334"}}],"payload":{"tag":"h3","lines":"1308,1309"}}],"payload":{"tag":"h2","lines":"1249,1251"}},{"content":"8.2&#x3001;&#x5bfc;&#x5165;&#x5de5;&#x7a0b;","children":[{"content":"<pre data-lines=\"1338,1339\"><code>&#x5728;&#x684c;&#x9762;&#x91cd;&#x65b0;&#x521b;&#x5efa;&#x4e00;&#x4e2a;&#x6587;&#x4ef6;&#x5939;&#xff0c;&#x540d;&#x5b57;&#x65e0;&#x6240;&#x8c13;&#xff0c;&#x62f7;&#x8d1d;&#x914d;&#x5957;&#x8d44;&#x6599;&#x4e2d;&#x7684;`&#x5355;&#x4f53;&#x7248;\\single-app-seata-tcc-study`&#x5230;&#x6b64;&#x6587;&#x4ef6;&#x5939;&#xff0c;&#x7136;&#x540e;&#x4f7f;&#x7528;`idea`&#x6253;&#x5f00;&#x5373;&#x53ef;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1338,1339"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/865e09b9de1a3871eb1c40b51504913e.png\" alt>","children":[],"payload":{"tag":"img","lines":"1340,1341"}},{"content":"<pre data-lines=\"1342,1343\"><code>`single-app-seata-tcc-study`&#x5df2;&#x7ecf;&#x5b9e;&#x73b0;&#x4e86;&#x57fa;&#x672c;&#x7684;&#x4ee3;&#x7801;&#x6d41;&#x7a0b;&#xff0c;&#x975e;&#x5e38;&#x7b80;&#x5355;&#xff0c;&#x76f8;&#x4fe1;&#x4f60;&#x4e00;&#x5b9a;&#x80fd;&#x770b;&#x61c2;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1342,1343"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/e9b3f0c8b695d81bf3051204b50bf6b9.png\" alt>","children":[],"payload":{"tag":"img","lines":"1344,1345"}},{"content":"<pre data-lines=\"1346,1347\"><code>`single-app-seata-tcc-study`&#x662f;&#x4e00;&#x4e2a;&#x7eaf;&#x7cb9;&#x7684;`Spring Boot`&#x5355;&#x4f53;&#x5e94;&#x7528;&#xff0c;&#x8fde;&#x63a5;&#x7740;&#x4e09;&#x4e2a;&#x6570;&#x636e;&#x6e90;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1346,1347"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/01333185c5faaf276d8280592d7156fb.png\" alt>","children":[],"payload":{"tag":"img","lines":"1348,1349"}},{"content":"<pre data-lines=\"1350,1351\"><code>&#x552f;&#x4e00;&#x9700;&#x8981;&#x4f60;&#x6ce8;&#x610f;&#x7684;&#x662f;&#xff0c;&#x6253;&#x5f00;`application.yaml`&#xff0c;&#x67e5;&#x770b;&#x8fde;&#x63a5;&#x6570;&#x636e;&#x6e90;&#x7684;&#x8d26;&#x6237;&#x5bc6;&#x7801;&#x662f;&#x5426;&#x6b63;&#x786e;&#xff0c;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1350,1351"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/3ae371ac38ec4029d5dca8ac82028a18.png\" alt>","children":[],"payload":{"tag":"img","lines":"1352,1353"}}],"payload":{"tag":"h2","lines":"1335,1337"}},{"content":"8.3&#x3001;&#x6b63;&#x5e38;&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"1357,1358\"><code>&#x8bf7;&#x542f;&#x52a8;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x7136;&#x540e;&#x8f93;&#x5165;&#x4e0b;&#x5355;&#x5730;&#x5740;&#x6d4b;&#x8bd5;&#xff1a;`http://localhost:9000/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100&amp;status=1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1357,1358"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/119f2d34e8a82b1f98872f4c6adf6d5e.png\" alt>","children":[],"payload":{"tag":"img","lines":"1359,1360"}},{"content":"<pre data-lines=\"1361,1362\"><code>&#x8bf7;&#x6253;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8868;&#xff0c;&#x67e5;&#x770b;&#x4e0b;&#x5355;&#x4e4b;&#x540e;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#xff0c;&#x4f9d;&#x6b21;&#x662f;&#xff1a;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;&#x8868;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1361,1362"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/037c27397c9c2d1a417466c1f91c452e.png\" alt>","children":[],"payload":{"tag":"img","lines":"1363,1364"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b5fffa396d3eed4505a0eb50fee0f202.png\" alt>","children":[],"payload":{"tag":"img","lines":"1365,1366"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/7a7f8d4daee4a10edf08f2cf7f31f37f.png\" alt>","children":[],"payload":{"tag":"img","lines":"1367,1368"}}],"payload":{"tag":"h2","lines":"1354,1356"}},{"content":"8.4&#x3001;&#x5f02;&#x5e38;&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"1372,1373\"><code>&#x4fee;&#x6539;`com.caochenlei.service.impl.OrderServiceImpl`&#x4ee3;&#x7801;&#x6dfb;&#x52a0;&#x5f02;&#x5e38;&#xff0c;&#x4ee3;&#x7801;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1372,1373"}},{"content":"<pre data-lines=\"1374,1408\"><code class=\"language-java\"><span class=\"hljs-meta\">@DS(&quot;order-ds&quot;)</span>\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-meta\">@Service</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OrderServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">OrderService</span> {\n    <span class=\"hljs-meta\">@Resource</span>\n    <span class=\"hljs-keyword\">private</span> OrderMapper orderMapper;\n    <span class=\"hljs-meta\">@Resource</span>\n    <span class=\"hljs-keyword\">private</span> AccountService accountService;\n    <span class=\"hljs-meta\">@Resource</span>\n    <span class=\"hljs-keyword\">private</span> StorageService storageService;\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">create</span><span class=\"hljs-params\">(Order order)</span> {\n        \n        log.info(<span class=\"hljs-string\">&quot;-----&gt;&#x65b0;&#x5efa;&#x8ba2;&#x5355;&#x5f00;&#x59cb;&quot;</span>);\n        orderMapper.create(order);\n        log.info(<span class=\"hljs-string\">&quot;-----&gt;&#x65b0;&#x5efa;&#x8ba2;&#x5355;&#x7ed3;&#x675f;&quot;</span>);\n\n        \n        log.info(<span class=\"hljs-string\">&quot;-----&gt;&#x6263;&#x51cf;&#x4f59;&#x989d;&#x5f00;&#x59cb;&quot;</span>);\n        accountService.decrease(order.getUserId(), order.getMoney());\n        log.info(<span class=\"hljs-string\">&quot;-----&gt;&#x6263;&#x51cf;&#x4f59;&#x989d;&#x7ed3;&#x675f;&quot;</span>);\n        \n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span> / <span class=\"hljs-number\">0</span>; \n\n        \n        log.info(<span class=\"hljs-string\">&quot;-----&gt;&#x6263;&#x51cf;&#x5e93;&#x5b58;&#x5f00;&#x59cb;&quot;</span>);\n        storageService.decrease(order.getProductId(), order.getCount());\n        log.info(<span class=\"hljs-string\">&quot;-----&gt;&#x6263;&#x51cf;&#x5e93;&#x5b58;&#x7ed3;&#x675f;&quot;</span>);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1374,1408"}},{"content":"<pre data-lines=\"1409,1410\"><code>&#x8bf7;&#x91cd;&#x542f;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x7136;&#x540e;&#x8f93;&#x5165;&#x4e0b;&#x5355;&#x5730;&#x5740;&#x6d4b;&#x8bd5;&#xff1a;`http://localhost:9000/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100&amp;status=1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1409,1410"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/2a7048d8c2add9240ac9e8aac4462304.png\" alt>","children":[],"payload":{"tag":"img","lines":"1411,1412"}},{"content":"<pre data-lines=\"1413,1414\"><code>&#x8bf7;&#x6253;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8868;&#xff0c;&#x67e5;&#x770b;&#x4e0b;&#x5355;&#x4e4b;&#x540e;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#xff0c;&#x4f9d;&#x6b21;&#x662f;&#xff1a;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;&#x8868;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1413,1414"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1a9552642561d49962a83b4c1443c125.png\" alt>","children":[],"payload":{"tag":"img","lines":"1415,1416"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/bb9b8935e3290f4cd33975775c44fdc1.png\" alt>","children":[],"payload":{"tag":"img","lines":"1417,1418"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/7a7f8d4daee4a10edf08f2cf7f31f37f.png\" alt>","children":[],"payload":{"tag":"img","lines":"1419,1420"}},{"content":"<pre data-lines=\"1421,1422\"><code>&#x6211;&#x4eec;&#x53d1;&#x73b0;&#x8ba2;&#x5355;&#x4e0b;&#x5355;&#x5931;&#x8d25;&#xff0c;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x4e2d;&#x591a;&#x4e86;&#x4e00;&#x6761;&#x8ba2;&#x5355;&#x8bb0;&#x5f55;&#xff0c;&#x5b9e;&#x9645;&#x4e0a;&#x8fd9;&#x6761;&#x8bb0;&#x5f55;&#x4e0d;&#x5e94;&#x8be5;&#x6709;&#xff0c;&#x540c;&#x65f6;&#xff0c;&#x8d26;&#x6237;&#x7684;&#x4f59;&#x989d;&#x4e5f;&#x51cf;&#x5c11;&#x4e86;&#xff0c;&#x4f46;&#x662f;&#xff0c;&#x5e93;&#x5b58;&#x5e76;&#x6ca1;&#x6709;&#x51cf;&#x5c11;&#xff0c;&#x8fd9;&#x4e2a;&#x95ee;&#x9898;&#x662f;&#x5341;&#x5206;&#x53ef;&#x6015;&#x7684;&#x3002;&#x56e0;&#x4e3a;&#x6ca1;&#x6709;&#x4e8b;&#x52a1;&#x7684;&#x652f;&#x6301;&#xff0c;&#x4e0d;&#x80fd;&#x505a;&#x5230;&#x8981;&#x4e0d;&#x5168;&#x90e8;&#x6267;&#x884c;&#xff0c;&#x8981;&#x4e0d;&#x5168;&#x90e8;&#x5931;&#x8d25;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1421,1422"}}],"payload":{"tag":"h2","lines":"1369,1371"}},{"content":"8.5&#x3001;&#x6dfb;&#x52a0;&#x65b0;&#x8868;","children":[{"content":"<pre data-lines=\"1426,1427\"><code>&#x5728;`&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;`&#x6dfb;&#x52a0;`&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;`&#xff0c;sql&#x8bed;&#x53e5;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1426,1427"}},{"content":"<pre data-lines=\"1428,1445\"><code class=\"language-sql\">USE `seata_account`;\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1428,1445"}},{"content":"<pre data-lines=\"1446,1447\"><code>&#x5728;`&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;`&#x6dfb;&#x52a0;`&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;`&#xff0c;sql&#x8bed;&#x53e5;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1446,1447"}},{"content":"<pre data-lines=\"1448,1465\"><code class=\"language-sql\">USE `seata_storage`;\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1448,1465"}},{"content":"<pre data-lines=\"1466,1467\"><code>&#x5728;`&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;`&#x6dfb;&#x52a0;`&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;`&#xff0c;sql&#x8bed;&#x53e5;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1466,1467"}},{"content":"<pre data-lines=\"1468,1485\"><code class=\"language-sql\">USE `seata_order`;\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1468,1485"}},{"content":"<pre data-lines=\"1486,1487\"><code>&#x6700;&#x7ec8;&#x5b8c;&#x6210;&#x4ee5;&#x540e;&#x7684;&#x6548;&#x679c;&#x5982;&#x4e0b;&#x56fe;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1486,1487"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/eaa14b0d44d5b30da3e2d1120b4c0647.png\" alt>","children":[],"payload":{"tag":"img","lines":"1488,1489"}}],"payload":{"tag":"h2","lines":"1423,1425"}},{"content":"8.6&#x3001;&#x6dfb;&#x52a0;&#x4f9d;&#x8d56;","children":[{"content":"<pre data-lines=\"1493,1494\"><code>&#x5728;`pom.xml`&#x4e2d;&#x65b0;&#x589e;&#x4f9d;&#x8d56;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1493,1494"}},{"content":"<pre data-lines=\"1495,1508\"><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.seata<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>seata-spring-boot-starter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.3.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.nacos<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>nacos-client<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.3.2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1495,1508"}}],"payload":{"tag":"h2","lines":"1490,1492"}},{"content":"8.7&#x3001;&#x6dfb;&#x52a0;&#x914d;&#x7f6e;","children":[{"content":"<pre data-lines=\"1512,1513\"><code>&#x5728;`application.yaml`&#x4e2d;&#x65b0;&#x589e;&#x914d;&#x7f6e;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1512,1513"}},{"content":"<pre data-lines=\"1514,1573\"><code class=\"language-yaml\"><span class=\"hljs-attr\">server:</span>\n  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">9000</span>\n\n<span class=\"hljs-attr\">management:</span>\n  <span class=\"hljs-attr\">endpoints:</span>\n    <span class=\"hljs-attr\">web:</span>\n      <span class=\"hljs-attr\">exposure:</span>\n        <span class=\"hljs-attr\">include:</span> <span class=\"hljs-string\">&apos;*&apos;</span>\n\n<span class=\"hljs-attr\">spring:</span>\n  <span class=\"hljs-attr\">application:</span>\n    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">single-app-seata-tcc-study</span>\n  <span class=\"hljs-attr\">datasource:</span>\n    <span class=\"hljs-attr\">dynamic:</span>\n      <span class=\"hljs-attr\">primary:</span> <span class=\"hljs-string\">ordere-ds</span>\n      <span class=\"hljs-attr\">datasource:</span>\n        \n        <span class=\"hljs-attr\">account-ds:</span>\n          <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span>\n          <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:mysql://localhost:3306/seata_account?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false</span>\n          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">root</span> \n          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-number\">123456</span> \n        \n        <span class=\"hljs-attr\">storage-ds:</span>\n          <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span>\n          <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:mysql://localhost:3306/seata_storage?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false</span>\n          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">root</span> \n          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-number\">123456</span> \n        \n        <span class=\"hljs-attr\">ordere-ds:</span>\n          <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span>\n          <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:mysql://localhost:3306/seata_order?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false</span>\n          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">root</span> \n          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-number\">123456</span> \n      <span class=\"hljs-attr\">seata:</span> <span class=\"hljs-literal\">true</span> \n      <span class=\"hljs-attr\">seata-mode:</span> <span class=\"hljs-string\">at</span> \n\n\n<span class=\"hljs-attr\">seata:</span>\n  <span class=\"hljs-attr\">application-id:</span> <span class=\"hljs-string\">myapp</span> \n  <span class=\"hljs-attr\">tx-service-group:</span> <span class=\"hljs-string\">myapp-group</span> \n  <span class=\"hljs-attr\">service:</span>\n    <span class=\"hljs-attr\">vgroup-mapping:</span>\n      <span class=\"hljs-attr\">myapp-group:</span> <span class=\"hljs-string\">default</span> \n  <span class=\"hljs-attr\">config:</span>\n    <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">file</span> \n  <span class=\"hljs-attr\">registry:</span>\n    <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">nacos</span> \n    <span class=\"hljs-attr\">nacos:</span>\n      <span class=\"hljs-attr\">application:</span> <span class=\"hljs-string\">seata-server</span>\n      <span class=\"hljs-attr\">server-addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8848</span>\n      <span class=\"hljs-attr\">group:</span> <span class=\"hljs-string\">SEATA_GROUP</span>\n      <span class=\"hljs-attr\">namespace:</span> <span class=\"hljs-string\">public</span>\n      <span class=\"hljs-attr\">cluster:</span> <span class=\"hljs-string\">default</span>\n      <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">nacos</span>\n      <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">nacos</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1514,1573"}}],"payload":{"tag":"h2","lines":"1509,1511"}},{"content":"8.8&#x3001;&#x6dfb;&#x52a0;&#x6ce8;&#x89e3;","children":[{"content":"<pre data-lines=\"1577,1578\"><code>&#x4fee;&#x6539;`com.caochenlei.service.impl.OrderServiceImpl`&#x5f00;&#x542f;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x7ba1;&#x7406;&#xff0c;&#x4ee3;&#x7801;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1577,1578"}},{"content":"<pre data-lines=\"1579,1590\"><code class=\"language-java\"><span class=\"hljs-meta\">@DS(&quot;order-ds&quot;)</span>\n<span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-meta\">@Service</span>\n<span class=\"hljs-meta\">@GlobalTransactional</span> \n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OrderServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">OrderService</span> {\n    ...\n    ...\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1579,1590"}}],"payload":{"tag":"h2","lines":"1574,1576"}},{"content":"8.9&#x3001;&#x8d26;&#x6237;&#x670d;&#x52a1;","children":[{"content":"<pre data-lines=\"1594,1595\"><code>&#x4fee;&#x6539;&#x63a5;&#x53e3;&#xff1a;`com.caochenlei.service.AccountService`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1594,1595"}},{"content":"<pre data-lines=\"1596,1612\"><code class=\"language-java\"><span class=\"hljs-meta\">@LocalTCC</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title class_\">AccountService</span> {\n    \n    <span class=\"hljs-meta\">@TwoPhaseBusinessAction(name = &quot;decreaseMoney&quot;, commitMethod = &quot;commitDecreaseMoney&quot;, rollbackMethod = &quot;rollbackDecreaseMoney&quot;)</span>\n    <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">decrease</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@BusinessActionContextParameter(paramName = &quot;userId&quot;)</span> Long userId,\n                  <span class=\"hljs-meta\">@BusinessActionContextParameter(paramName = &quot;money&quot;)</span> BigDecimal money)</span>;\n\n    \n    <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">commitDecreaseMoney</span><span class=\"hljs-params\">(BusinessActionContext context)</span>;\n\n    \n    <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">rollbackDecreaseMoney</span><span class=\"hljs-params\">(BusinessActionContext context)</span>;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1596,1612"}},{"content":"<pre data-lines=\"1613,1614\"><code>&#x4fee;&#x6539;&#x5b9e;&#x73b0;&#xff1a;`com.caochenlei.service.impl.AccountServiceImpl`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1613,1614"}},{"content":"<pre data-lines=\"1615,1651\"><code class=\"language-java\"><span class=\"hljs-meta\">@DS(&quot;account-ds&quot;)</span>\n<span class=\"hljs-meta\">@Service</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AccountServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">AccountService</span> {\n    <span class=\"hljs-meta\">@Resource</span>\n    <span class=\"hljs-keyword\">private</span> AccountMapper accountMapper;\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">decrease</span><span class=\"hljs-params\">(Long userId, BigDecimal money)</span> {\n        accountMapper.decrease(userId, money);\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">commitDecreaseMoney</span><span class=\"hljs-params\">(BusinessActionContext context)</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">rollbackDecreaseMoney</span><span class=\"hljs-params\">(BusinessActionContext context)</span> {\n        \n\n        \n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">userId</span> <span class=\"hljs-operator\">=</span> context.getActionContext(<span class=\"hljs-string\">&quot;userId&quot;</span>).toString();\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">money</span> <span class=\"hljs-operator\">=</span> context.getActionContext(<span class=\"hljs-string\">&quot;money&quot;</span>).toString();\n\n        \n        accountMapper.increase(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Long</span>(userId), <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BigDecimal</span>(money));\n\n        \n        System.out.println(<span class=\"hljs-string\">&quot;&#x6570;&#x636e;&#x56de;&#x6eda;&#x4e86;&#xff0c;&#x8fd9;&#x53ef;&#x771f;&#x7684;&#x597d;&quot;</span>);\n\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1615,1651"}},{"content":"<pre data-lines=\"1652,1653\"><code>&#x4fee;&#x6539;&#x6620;&#x5c04;&#xff1a;`com.caochenlei.mapper.AccountMapper`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1652,1653"}},{"content":"<pre data-lines=\"1654,1667\"><code class=\"language-java\"><span class=\"hljs-meta\">@Mapper</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title class_\">AccountMapper</span> {\n    \n    <span class=\"hljs-meta\">@Update(&quot;update t_account set used=used+#{money},residue=residue-#{money} where user_id=#{userId};&quot;)</span>\n    <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">decrease</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@Param(&quot;userId&quot;)</span> Long userId, <span class=\"hljs-meta\">@Param(&quot;money&quot;)</span> BigDecimal money)</span>;\n\n    \n    <span class=\"hljs-meta\">@Update(&quot;update t_account set used=used-#{money},residue=residue+#{money} where user_id=#{userId};&quot;)</span>\n    <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">increase</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@Param(&quot;userId&quot;)</span> Long userId, <span class=\"hljs-meta\">@Param(&quot;money&quot;)</span> BigDecimal money)</span>;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1654,1667"}}],"payload":{"tag":"h2","lines":"1591,1593"}},{"content":"8.10&#x3001;&#x5f02;&#x5e38;&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"1671,1672\"><code>&#x8bf7;&#x91cd;&#x542f;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x7136;&#x540e;&#x8f93;&#x5165;&#x4e0b;&#x5355;&#x5730;&#x5740;&#x6d4b;&#x8bd5;&#xff1a;`http://localhost:9000/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100&amp;status=1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1671,1672"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/513a2302863eb791e439f937f725b00d.png\" alt>","children":[],"payload":{"tag":"img","lines":"1673,1674"}},{"content":"<pre data-lines=\"1675,1676\"><code>&#x8bf7;&#x6253;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8868;&#xff0c;&#x67e5;&#x770b;&#x4e0b;&#x5355;&#x4e4b;&#x540e;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#xff0c;&#x4f9d;&#x6b21;&#x662f;&#xff1a;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;&#x8868;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1675,1676"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1a9552642561d49962a83b4c1443c125.png\" alt>","children":[],"payload":{"tag":"img","lines":"1677,1678"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/bb9b8935e3290f4cd33975775c44fdc1.png\" alt>","children":[],"payload":{"tag":"img","lines":"1679,1680"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/7a7f8d4daee4a10edf08f2cf7f31f37f.png\" alt>","children":[],"payload":{"tag":"img","lines":"1681,1682"}},{"content":"<pre data-lines=\"1683,1684\"><code>&#x6211;&#x4eec;&#x53d1;&#x73b0;&#x867d;&#x7136;&#x4e0b;&#x5355;&#x5931;&#x8d25;&#x4e86;&#xff0c;&#x4f46;&#x662f;&#x5e76;&#x6ca1;&#x6709;&#x5f80;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x63d2;&#x5165;&#x8ba2;&#x5355;&#x4fe1;&#x606f;&#xff0c;&#x8d26;&#x6237;&#x4f59;&#x989d;&#x548c;&#x5e93;&#x5b58;&#x4e5f;&#x6ca1;&#x6709;&#x51cf;&#x5c11;&#xff0c;&#x8fd9;&#x7b26;&#x5408;&#x6211;&#x4eec;&#x7684;&#x4e1a;&#x52a1;&#x903b;&#x8f91;&#xff0c;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x8fd9;&#x79cd;&#x65b9;&#x5f0f;&#x5b9e;&#x73b0;&#x4e2d;&#x95f4;&#x4ef6;&#x3001;&#x975e;&#x5173;&#x7cfb;&#x578b;&#x6570;&#x636e;&#x5e93;&#x7684;&#x56de;&#x6eda;&#x64cd;&#x4f5c;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1683,1684"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1e67b995f09b38caf94e3fce5eefcc45.png\" alt>","children":[],"payload":{"tag":"img","lines":"1685,1686"}},{"content":"<pre data-lines=\"1687,1690\"><code>&#x800c;&#x8d26;&#x6237;&#x4f59;&#x989d;&#x7684;&#x56de;&#x6eda;&#x64cd;&#x4f5c;&#x5219;&#x662f;&#x4f7f;&#x7528;&#x7684;&#x662f;TCC&#x6a21;&#x5f0f;&#x4e0b;&#xff0c;&#x6211;&#x4eec;&#x81ea;&#x5b9a;&#x4e49;&#x7684;&#x7b2c;&#x4e8c;&#x9636;&#x6bb5;&#x56de;&#x6eda;&#x65b9;&#x6cd5;&#x3002;\n\n&gt; &#x6ce8;&#x610f;&#xff1a;&#x6d4b;&#x8bd5;&#x5b8c;&#x6bd5;&#xff0c;&#x8bf7;&#x5173;&#x95ed;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x9632;&#x6b62;&#x5f71;&#x54cd;&#x5176;&#x4ed6;&#x9879;&#x76ee;&#x3002;&#x6b63;&#x5e38;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;&#x6bcf;&#x4e00;&#x4e2a;&#x670d;&#x52a1;&#x90fd;&#x9700;&#x8981;&#x914d;&#x7f6e;seata&#xff0c;&#x6211;&#x8fd9;&#x91cc;&#x5077;&#x61d2;&#x4e86;&#xff0c;&#x5927;&#x5bb6;&#x8981;&#x6ce8;&#x610f;&#x4e00;&#x4e0b;&#xff01;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1687,1690"}}],"payload":{"tag":"h2","lines":"1668,1670"}},{"content":"9.1&#x3001;&#x5bfc;&#x5165;&#x6570;&#x636e;","children":[{"content":"9.1.1&#x3001;&#x91cd;&#x7f6e;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"1696,1697\"><code>&#x6570;&#x636e;&#x5e93;&#x73af;&#x5883;&#x4e3a;`mysql 5.7.33`&#xff0c;&#x8bf7;&#x91cd;&#x65b0;&#x5bfc;&#x5165;&#x8fd0;&#x884c;&#x4ee5;&#x4e0b;sql&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1696,1697"}},{"content":"<pre data-lines=\"1698,1719\"><code class=\"language-sql\"><span class=\"hljs-keyword\">DROP</span> DATABASE IF <span class=\"hljs-keyword\">EXISTS</span> `seata_account`;\n<span class=\"hljs-keyword\">CREATE</span> DATABASE `seata_account`;\n\nUSE `seata_account`;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> `t_account`;\n<span class=\"hljs-keyword\">CREATE TABLE</span> `t_account` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&apos;&#x4e3b;&#x952e;id&apos;</span>,\n  `user_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x7528;&#x6237;id&apos;</span>,\n  `total` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x603b;&#x989d;&#x5ea6;&apos;</span>,\n  `used` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x5df2;&#x7528;&#x4f59;&#x989d;&apos;</span>,\n  `residue` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">10</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-string\">&apos;0&apos;</span> COMMENT <span class=\"hljs-string\">&apos;&#x5269;&#x4f59;&#x989d;&#x5ea6;&apos;</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8 COMMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&apos;&#x8d26;&#x6237;&#x8868;&apos;</span>;\n\n<span class=\"hljs-keyword\">insert  into</span> `t_account`(`id`,`user_id`,`total`,`used`,`residue`) <span class=\"hljs-keyword\">values</span> (<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-string\">&apos;1000&apos;</span>,<span class=\"hljs-string\">&apos;0&apos;</span>,<span class=\"hljs-string\">&apos;1000&apos;</span>);\n\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> `seata_account`.`t_account` LIMIT <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>; \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1698,1719"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/ffcb56a03ee5020343b63087c9436442.png\" alt>","children":[],"payload":{"tag":"img","lines":"1720,1721"}}],"payload":{"tag":"h3","lines":"1694,1695"}},{"content":"9.1.2&#x3001;&#x91cd;&#x7f6e;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"1724,1725\"><code>&#x6570;&#x636e;&#x5e93;&#x73af;&#x5883;&#x4e3a;`mysql 5.7.33`&#xff0c;&#x8bf7;&#x91cd;&#x65b0;&#x5bfc;&#x5165;&#x8fd0;&#x884c;&#x4ee5;&#x4e0b;sql&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1724,1725"}},{"content":"<pre data-lines=\"1726,1747\"><code class=\"language-sql\"><span class=\"hljs-keyword\">DROP</span> DATABASE IF <span class=\"hljs-keyword\">EXISTS</span> `seata_storage`;\n<span class=\"hljs-keyword\">CREATE</span> DATABASE `seata_storage`;\n\nUSE `seata_storage`;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> `t_storage`;\n<span class=\"hljs-keyword\">CREATE TABLE</span> `t_storage` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&apos;&#x4e3b;&#x952e;id&apos;</span>,\n  `product_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x4ea7;&#x54c1;id&apos;</span>,\n  `total` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x603b;&#x5e93;&#x5b58;&apos;</span>,\n  `used` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x5df2;&#x7528;&#x5e93;&#x5b58;&apos;</span>,\n  `residue` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x5269;&#x4f59;&#x5e93;&#x5b58;&apos;</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8 COMMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&apos;&#x5e93;&#x5b58;&#x8868;&apos;</span>;\n\n<span class=\"hljs-keyword\">insert  into</span> `t_storage`(`id`,`product_id`,`total`,`used`,`residue`) <span class=\"hljs-keyword\">values</span> (<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">100</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">100</span>);\n\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> `seata_storage`.`t_storage` LIMIT <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>; \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1726,1747"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/3a64c46d9b40939ada4eb56c96b2ca7e.png\" alt>","children":[],"payload":{"tag":"img","lines":"1748,1749"}}],"payload":{"tag":"h3","lines":"1722,1723"}},{"content":"9.1.3&#x3001;&#x91cd;&#x7f6e;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;","children":[{"content":"<pre data-lines=\"1752,1753\"><code>&#x6570;&#x636e;&#x5e93;&#x73af;&#x5883;&#x4e3a;`mysql 5.7.33`&#xff0c;&#x8bf7;&#x91cd;&#x65b0;&#x5bfc;&#x5165;&#x8fd0;&#x884c;&#x4ee5;&#x4e0b;sql&#x8bed;&#x53e5;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1752,1753"}},{"content":"<pre data-lines=\"1754,1774\"><code class=\"language-sql\"><span class=\"hljs-keyword\">DROP</span> DATABASE `seata_order`;\n<span class=\"hljs-keyword\">CREATE</span> DATABASE `seata_order`;\n\nUSE `seata_order`;\n\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> IF <span class=\"hljs-keyword\">EXISTS</span> `t_order`;\n<span class=\"hljs-keyword\">CREATE TABLE</span> `t_order` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT COMMENT <span class=\"hljs-string\">&apos;&#x4e3b;&#x952e;id&apos;</span>,\n  `user_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x7528;&#x6237;id&apos;</span>,\n  `product_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x4ea7;&#x54c1;id&apos;</span>,\n  `count` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x6570;&#x91cf;&apos;</span>,\n  `money` <span class=\"hljs-type\">decimal</span>(<span class=\"hljs-number\">11</span>,<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x91d1;&#x989d;&apos;</span>,\n  `status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">1</span>) <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">NULL</span> COMMENT <span class=\"hljs-string\">&apos;&#x72b6;&#x6001;&apos;</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8 COMMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&apos;&#x8ba2;&#x5355;&#x8868;&apos;</span>;\n\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> `seata_order`.`t_order` LIMIT <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1000</span>; \n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1754,1774"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/6597624956655a2576f922744f0024a6.png\" alt>","children":[],"payload":{"tag":"img","lines":"1775,1776"}}],"payload":{"tag":"h3","lines":"1750,1751"}}],"payload":{"tag":"h2","lines":"1691,1693"}},{"content":"9.2&#x3001;&#x5bfc;&#x5165;&#x5de5;&#x7a0b;","children":[{"content":"<pre data-lines=\"1780,1781\"><code>&#x5728;&#x684c;&#x9762;&#x91cd;&#x65b0;&#x521b;&#x5efa;&#x4e00;&#x4e2a;&#x6587;&#x4ef6;&#x5939;&#xff0c;&#x540d;&#x5b57;&#x65e0;&#x6240;&#x8c13;&#xff0c;&#x62f7;&#x8d1d;&#x914d;&#x5957;&#x8d44;&#x6599;&#x4e2d;&#x7684;`&#x5206;&#x5e03;&#x5f0f;\\distributed-seata-tcc-study`&#x5230;&#x6b64;&#x6587;&#x4ef6;&#x5939;&#xff0c;&#x7136;&#x540e;&#x4f7f;&#x7528;`idea`&#x6253;&#x5f00;&#x5373;&#x53ef;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1780,1781"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/31d2ac2ff6b209afc155d0a2c5489dcf.png\" alt>","children":[],"payload":{"tag":"img","lines":"1782,1783"}},{"content":"<pre data-lines=\"1784,1785\"><code>`distributed-seata-tcc-study`&#x5df2;&#x7ecf;&#x5b9e;&#x73b0;&#x4e86;&#x57fa;&#x672c;&#x7684;&#x4ee3;&#x7801;&#x6d41;&#x7a0b;&#xff0c;&#x975e;&#x5e38;&#x7b80;&#x5355;&#xff0c;&#x76f8;&#x4fe1;&#x4f60;&#x4e00;&#x5b9a;&#x80fd;&#x770b;&#x61c2;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1784,1785"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/6d7aabc184f3576afc44791c04cd65e6.png\" alt>","children":[],"payload":{"tag":"img","lines":"1786,1787"}},{"content":"<pre data-lines=\"1788,1789\"><code>`distributed-seata-tcc-study`&#x662f;&#x4e00;&#x4e2a;&#x5178;&#x578b;&#x7684;&#x5fae;&#x670d;&#x52a1;&#x5e94;&#x7528;&#xff0c;&#x4e00;&#x5171;&#x6709;&#x4e09;&#x4e2a;&#x670d;&#x52a1;&#xff0c;&#x6bcf;&#x4e2a;&#x670d;&#x52a1;&#x90fd;&#x5b9e;&#x73b0;&#x4e86;&#x57fa;&#x672c;&#x7684;&#x4ee3;&#x7801;&#x903b;&#x8f91;&#xff0c;&#x5e76;&#x4e14;&#x90fd;&#x5bf9;&#x5e94;&#x4e00;&#x4e2a;&#x6570;&#x636e;&#x6e90;&#xff0c;&#x67b6;&#x6784;&#x5982;&#x4e0b;&#x56fe;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1788,1789"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b94f50232328dcbed337836e5e390c4b.png\" alt>","children":[],"payload":{"tag":"img","lines":"1790,1791"}},{"content":"<pre data-lines=\"1792,1795\"><code>&#x552f;&#x4e00;&#x9700;&#x8981;&#x4f60;&#x6ce8;&#x610f;&#x7684;&#x662f;&#xff0c;&#x6253;&#x5f00;`application.yaml`&#xff0c;&#x67e5;&#x770b;&#x8fde;&#x63a5;&#x6570;&#x636e;&#x6e90;&#x7684;&#x8d26;&#x6237;&#x5bc6;&#x7801;&#x662f;&#x5426;&#x6b63;&#x786e;&#xff0c;&#x5e76;&#x4e14;&#x6211;&#x4eec;&#x9700;&#x8981;&#x4f60;&#x542f;&#x52a8;`nacos`&#x670d;&#x52a1;&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;&#xff0c;&#x5982;&#x4e0b;&#xff1a;\n\n**service-account**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1792,1795"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/c68b8b3ecd46b7a3aa8662c7c6b4cf8c.png\" alt>","children":[],"payload":{"tag":"img","lines":"1796,1797"}},{"content":"<pre data-lines=\"1798,1799\"><code>**service-storage**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1798,1799"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/dec017c35078ea0c377123da8c70611d.png\" alt>","children":[],"payload":{"tag":"img","lines":"1800,1801"}},{"content":"<pre data-lines=\"1802,1803\"><code>**service-order**\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1802,1803"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/810032c2697b8f33e036d185ac85a53b.png\" alt>","children":[],"payload":{"tag":"img","lines":"1804,1805"}}],"payload":{"tag":"h2","lines":"1777,1779"}},{"content":"9.3&#x3001;&#x6b63;&#x5e38;&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"1809,1812\"><code>&#x786e;&#x4fdd;&#x542f;&#x52a8;`nacos`&#x6ce8;&#x518c;&#x4e2d;&#x5fc3;&#x3002;\n\n&#x8bf7;&#x542f;&#x52a8;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x7136;&#x540e;&#x8f93;&#x5165;&#x4e0b;&#x5355;&#x5730;&#x5740;&#x6d4b;&#x8bd5;&#xff1a;`http://localhost:9003/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100&amp;status=1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1809,1812"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/7355e94f5ff7b983196c7dc333d3a78b.png\" alt>","children":[],"payload":{"tag":"img","lines":"1813,1814"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/ba2759a75dc714bcc13eaf1d7b9621e8.png\" alt>","children":[],"payload":{"tag":"img","lines":"1815,1816"}},{"content":"<pre data-lines=\"1817,1818\"><code>&#x8bf7;&#x6253;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8868;&#xff0c;&#x67e5;&#x770b;&#x4e0b;&#x5355;&#x4e4b;&#x540e;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#xff0c;&#x4f9d;&#x6b21;&#x662f;&#xff1a;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;&#x8868;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1817,1818"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/037c27397c9c2d1a417466c1f91c452e.png\" alt>","children":[],"payload":{"tag":"img","lines":"1819,1820"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/b5fffa396d3eed4505a0eb50fee0f202.png\" alt>","children":[],"payload":{"tag":"img","lines":"1821,1822"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/7a7f8d4daee4a10edf08f2cf7f31f37f.png\" alt>","children":[],"payload":{"tag":"img","lines":"1823,1824"}}],"payload":{"tag":"h2","lines":"1806,1808"}},{"content":"9.4&#x3001;&#x5f02;&#x5e38;&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"1828,1829\"><code>&#x6253;&#x5f00;&#x5de5;&#x7a0b;`service-order`&#x4fee;&#x6539;`com.caochenlei.service.impl.OrderServiceImpl`&#x4ee3;&#x7801;&#x6dfb;&#x52a0;&#x5f02;&#x5e38;&#xff0c;&#x4ee3;&#x7801;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1828,1829"}},{"content":"<pre data-lines=\"1830,1863\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-meta\">@Service</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OrderServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">OrderService</span> {\n    <span class=\"hljs-meta\">@Resource</span>\n    <span class=\"hljs-keyword\">private</span> OrderMapper orderMapper;\n    <span class=\"hljs-meta\">@Resource</span>\n    <span class=\"hljs-keyword\">private</span> AccountService accountService;\n    <span class=\"hljs-meta\">@Resource</span>\n    <span class=\"hljs-keyword\">private</span> StorageService storageService;\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">create</span><span class=\"hljs-params\">(Order order)</span> {\n        \n        log.info(<span class=\"hljs-string\">&quot;-----&gt;&#x65b0;&#x5efa;&#x8ba2;&#x5355;&#x5f00;&#x59cb;&quot;</span>);\n        orderMapper.create(order);\n        log.info(<span class=\"hljs-string\">&quot;-----&gt;&#x65b0;&#x5efa;&#x8ba2;&#x5355;&#x7ed3;&#x675f;&quot;</span>);\n\n        \n        log.info(<span class=\"hljs-string\">&quot;-----&gt;&#x6263;&#x51cf;&#x4f59;&#x989d;&#x5f00;&#x59cb;&quot;</span>);\n        accountService.decrease(order.getUserId(), order.getMoney());\n        log.info(<span class=\"hljs-string\">&quot;-----&gt;&#x6263;&#x51cf;&#x4f59;&#x989d;&#x7ed3;&#x675f;&quot;</span>);\n        \n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span> / <span class=\"hljs-number\">0</span>; \n\n        \n        log.info(<span class=\"hljs-string\">&quot;-----&gt;&#x6263;&#x51cf;&#x5e93;&#x5b58;&#x5f00;&#x59cb;&quot;</span>);\n        storageService.decrease(order.getProductId(), order.getCount());\n        log.info(<span class=\"hljs-string\">&quot;-----&gt;&#x6263;&#x51cf;&#x5e93;&#x5b58;&#x7ed3;&#x675f;&quot;</span>);\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1830,1863"}},{"content":"<pre data-lines=\"1864,1865\"><code>&#x8bf7;&#x91cd;&#x542f;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x7136;&#x540e;&#x8f93;&#x5165;&#x4e0b;&#x5355;&#x5730;&#x5740;&#x6d4b;&#x8bd5;&#xff1a;`http://localhost:9003/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100&amp;status=1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1864,1865"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/513a2302863eb791e439f937f725b00d.png\" alt>","children":[],"payload":{"tag":"img","lines":"1866,1867"}},{"content":"<pre data-lines=\"1868,1869\"><code>&#x8bf7;&#x6253;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8868;&#xff0c;&#x67e5;&#x770b;&#x4e0b;&#x5355;&#x4e4b;&#x540e;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#xff0c;&#x4f9d;&#x6b21;&#x662f;&#xff1a;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;&#x8868;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1868,1869"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/1a9552642561d49962a83b4c1443c125.png\" alt>","children":[],"payload":{"tag":"img","lines":"1870,1871"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/bb9b8935e3290f4cd33975775c44fdc1.png\" alt>","children":[],"payload":{"tag":"img","lines":"1872,1873"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/7a7f8d4daee4a10edf08f2cf7f31f37f.png\" alt>","children":[],"payload":{"tag":"img","lines":"1874,1875"}},{"content":"<pre data-lines=\"1876,1877\"><code>&#x6211;&#x4eec;&#x53d1;&#x73b0;&#x8ba2;&#x5355;&#x4e0b;&#x5355;&#x5931;&#x8d25;&#xff0c;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x4e2d;&#x591a;&#x4e86;&#x4e00;&#x6761;&#x8ba2;&#x5355;&#x8bb0;&#x5f55;&#xff0c;&#x5b9e;&#x9645;&#x4e0a;&#x8fd9;&#x6761;&#x8bb0;&#x5f55;&#x4e0d;&#x5e94;&#x8be5;&#x6709;&#xff0c;&#x540c;&#x65f6;&#xff0c;&#x8d26;&#x6237;&#x7684;&#x4f59;&#x989d;&#x4e5f;&#x51cf;&#x5c11;&#x4e86;&#xff0c;&#x4f46;&#x662f;&#xff0c;&#x5e93;&#x5b58;&#x5e76;&#x6ca1;&#x6709;&#x51cf;&#x5c11;&#xff0c;&#x8fd9;&#x4e2a;&#x95ee;&#x9898;&#x662f;&#x5341;&#x5206;&#x53ef;&#x6015;&#x7684;&#x3002;&#x56e0;&#x4e3a;&#x6ca1;&#x6709;&#x4e8b;&#x52a1;&#x7684;&#x652f;&#x6301;&#xff0c;&#x4e0d;&#x80fd;&#x505a;&#x5230;&#x8981;&#x4e0d;&#x5168;&#x90e8;&#x6267;&#x884c;&#xff0c;&#x8981;&#x4e0d;&#x5168;&#x90e8;&#x5931;&#x8d25;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1876,1877"}}],"payload":{"tag":"h2","lines":"1825,1827"}},{"content":"9.5&#x3001;&#x6dfb;&#x52a0;&#x65b0;&#x8868;","children":[{"content":"<pre data-lines=\"1881,1882\"><code>&#x5728;`&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;`&#x6dfb;&#x52a0;`&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;`&#xff0c;sql&#x8bed;&#x53e5;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1881,1882"}},{"content":"<pre data-lines=\"1883,1900\"><code class=\"language-sql\">USE `seata_account`;\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1883,1900"}},{"content":"<pre data-lines=\"1901,1902\"><code>&#x5728;`&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;`&#x6dfb;&#x52a0;`&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;`&#xff0c;sql&#x8bed;&#x53e5;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1901,1902"}},{"content":"<pre data-lines=\"1903,1920\"><code class=\"language-sql\">USE `seata_storage`;\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1903,1920"}},{"content":"<pre data-lines=\"1921,1922\"><code>&#x5728;`&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;`&#x6dfb;&#x52a0;`&#x56de;&#x6eda;&#x65e5;&#x5fd7;&#x8868;`&#xff0c;sql&#x8bed;&#x53e5;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1921,1922"}},{"content":"<pre data-lines=\"1923,1940\"><code class=\"language-sql\">USE `seata_order`;\n\n<span class=\"hljs-keyword\">CREATE TABLE</span> `undo_log` (\n  `id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span> AUTO_INCREMENT,\n  `branch_id` <span class=\"hljs-type\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `xid` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">100</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `context` <span class=\"hljs-type\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `rollback_info` longblob <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_status` <span class=\"hljs-type\">int</span>(<span class=\"hljs-number\">11</span>) <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_created` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  `log_modified` datetime <span class=\"hljs-keyword\">NOT NULL</span>,\n  <span class=\"hljs-keyword\">PRIMARY KEY</span> (`id`),\n  <span class=\"hljs-keyword\">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)\n) ENGINE<span class=\"hljs-operator\">=</span>InnoDB AUTO_INCREMENT<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">DEFAULT</span> CHARSET<span class=\"hljs-operator\">=</span>utf8;\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1923,1940"}},{"content":"<pre data-lines=\"1941,1942\"><code>&#x6700;&#x7ec8;&#x5b8c;&#x6210;&#x4ee5;&#x540e;&#x7684;&#x6548;&#x679c;&#x5982;&#x4e0b;&#x56fe;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1941,1942"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/eaa14b0d44d5b30da3e2d1120b4c0647.png\" alt>","children":[],"payload":{"tag":"img","lines":"1943,1944"}}],"payload":{"tag":"h2","lines":"1878,1880"}},{"content":"9.6&#x3001;&#x6dfb;&#x52a0;&#x4f9d;&#x8d56;","children":[{"content":"<pre data-lines=\"1948,1949\"><code>&#x5728;`service-order`&#x3001;`service-account`&#x7684;`pom.xml`&#x4e2d;&#x65b0;&#x589e;&#x4f9d;&#x8d56;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1948,1949"}},{"content":"<pre data-lines=\"1950,1957\"><code class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1950,1957"}}],"payload":{"tag":"h2","lines":"1945,1947"}},{"content":"9.7&#x3001;&#x6dfb;&#x52a0;&#x914d;&#x7f6e;","children":[{"content":"<pre data-lines=\"1961,1962\"><code>&#x5728;`service-order`&#x3001;`service-account`&#x7684;`application.yaml`&#x4e2d;&#x65b0;&#x589e;&#x914d;&#x7f6e;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1961,1962"}},{"content":"<pre data-lines=\"1963,1987\"><code class=\"language-yaml\"><span class=\"hljs-string\">...</span>\n<span class=\"hljs-string\">...</span>\n\n<span class=\"hljs-attr\">seata:</span>\n  <span class=\"hljs-attr\">application-id:</span> <span class=\"hljs-string\">myapp</span> \n  <span class=\"hljs-attr\">tx-service-group:</span> <span class=\"hljs-string\">myapp-group</span> \n  <span class=\"hljs-attr\">service:</span>\n    <span class=\"hljs-attr\">vgroup-mapping:</span>\n      <span class=\"hljs-attr\">myapp-group:</span> <span class=\"hljs-string\">default</span> \n  <span class=\"hljs-attr\">config:</span>\n    <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">file</span> \n  <span class=\"hljs-attr\">registry:</span>\n    <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">nacos</span> \n    <span class=\"hljs-attr\">nacos:</span>\n      <span class=\"hljs-attr\">application:</span> <span class=\"hljs-string\">seata-server</span>\n      <span class=\"hljs-attr\">server-addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8848</span>\n      <span class=\"hljs-attr\">group:</span> <span class=\"hljs-string\">SEATA_GROUP</span>\n      <span class=\"hljs-attr\">namespace:</span> <span class=\"hljs-string\">public</span>\n      <span class=\"hljs-attr\">cluster:</span> <span class=\"hljs-string\">default</span>\n      <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">nacos</span>\n      <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">nacos</span>\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1963,1987"}}],"payload":{"tag":"h2","lines":"1958,1960"}},{"content":"9.8&#x3001;&#x6dfb;&#x52a0;&#x6ce8;&#x89e3;","children":[{"content":"<pre data-lines=\"1991,1992\"><code>&#x6253;&#x5f00;`service-order`&#x4fee;&#x6539;`com.caochenlei.service.impl.OrderServiceImpl`&#x5f00;&#x542f;&#x5168;&#x5c40;&#x4e8b;&#x52a1;&#x7ba1;&#x7406;&#xff0c;&#x4ee3;&#x7801;&#x5982;&#x4e0b;&#xff1a;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1991,1992"}},{"content":"<pre data-lines=\"1993,2003\"><code class=\"language-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-meta\">@Service</span>\n<span class=\"hljs-meta\">@GlobalTransactional</span> \n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OrderServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">OrderService</span> {\n    ...\n    ...\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"1993,2003"}}],"payload":{"tag":"h2","lines":"1988,1990"}},{"content":"9.9&#x3001;&#x8d26;&#x6237;&#x670d;&#x52a1;","children":[{"content":"<pre data-lines=\"2007,2008\"><code>&#x6253;&#x5f00;`service-account`&#x4fee;&#x6539;&#x63a5;&#x53e3;&#xff1a;`com.caochenlei.service.AccountService`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2007,2008"}},{"content":"<pre data-lines=\"2009,2025\"><code class=\"language-java\"><span class=\"hljs-meta\">@LocalTCC</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title class_\">AccountService</span> {\n    \n    <span class=\"hljs-meta\">@TwoPhaseBusinessAction(name = &quot;decreaseMoney&quot;, commitMethod = &quot;commitDecreaseMoney&quot;, rollbackMethod = &quot;rollbackDecreaseMoney&quot;)</span>\n    <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">decrease</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@BusinessActionContextParameter(paramName = &quot;userId&quot;)</span> Long userId,\n                  <span class=\"hljs-meta\">@BusinessActionContextParameter(paramName = &quot;money&quot;)</span> BigDecimal money)</span>;\n\n    \n    <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">commitDecreaseMoney</span><span class=\"hljs-params\">(BusinessActionContext context)</span>;\n\n    \n    <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">rollbackDecreaseMoney</span><span class=\"hljs-params\">(BusinessActionContext context)</span>;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2009,2025"}},{"content":"<pre data-lines=\"2026,2027\"><code>&#x6253;&#x5f00;`service-account`&#x4fee;&#x6539;&#x5b9e;&#x73b0;&#xff1a;`com.caochenlei.service.impl.AccountServiceImpl`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2026,2027"}},{"content":"<pre data-lines=\"2028,2063\"><code class=\"language-java\"><span class=\"hljs-meta\">@Service</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AccountServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">AccountService</span> {\n    <span class=\"hljs-meta\">@Resource</span>\n    <span class=\"hljs-keyword\">private</span> AccountMapper accountMapper;\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">decrease</span><span class=\"hljs-params\">(Long userId, BigDecimal money)</span> {\n        accountMapper.decrease(userId, money);\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">commitDecreaseMoney</span><span class=\"hljs-params\">(BusinessActionContext context)</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">rollbackDecreaseMoney</span><span class=\"hljs-params\">(BusinessActionContext context)</span> {\n        \n\n        \n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">userId</span> <span class=\"hljs-operator\">=</span> context.getActionContext(<span class=\"hljs-string\">&quot;userId&quot;</span>).toString();\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">money</span> <span class=\"hljs-operator\">=</span> context.getActionContext(<span class=\"hljs-string\">&quot;money&quot;</span>).toString();\n\n        \n        accountMapper.increase(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Long</span>(userId), <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BigDecimal</span>(money));\n\n        \n        System.out.println(<span class=\"hljs-string\">&quot;&#x6570;&#x636e;&#x56de;&#x6eda;&#x4e86;&#xff0c;&#x8fd9;&#x53ef;&#x771f;&#x7684;&#x597d;&quot;</span>);\n\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n    }\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2028,2063"}},{"content":"<pre data-lines=\"2064,2065\"><code>&#x6253;&#x5f00;`service-account`&#x4fee;&#x6539;&#x6620;&#x5c04;&#xff1a;`com.caochenlei.mapper.AccountMapper`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2064,2065"}},{"content":"<pre data-lines=\"2066,2079\"><code class=\"language-java\"><span class=\"hljs-meta\">@Mapper</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title class_\">AccountMapper</span> {\n    \n    <span class=\"hljs-meta\">@Update(&quot;update t_account set used=used+#{money},residue=residue-#{money} where user_id=#{userId};&quot;)</span>\n    <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">decrease</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@Param(&quot;userId&quot;)</span> Long userId, <span class=\"hljs-meta\">@Param(&quot;money&quot;)</span> BigDecimal money)</span>;\n\n    \n    <span class=\"hljs-meta\">@Update(&quot;update t_account set used=used-#{money},residue=residue+#{money} where user_id=#{userId};&quot;)</span>\n    <span class=\"hljs-type\">int</span> <span class=\"hljs-title function_\">increase</span><span class=\"hljs-params\">(<span class=\"hljs-meta\">@Param(&quot;userId&quot;)</span> Long userId, <span class=\"hljs-meta\">@Param(&quot;money&quot;)</span> BigDecimal money)</span>;\n}\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2066,2079"}}],"payload":{"tag":"h2","lines":"2004,2006"}},{"content":"9.10&#x3001;&#x5f02;&#x5e38;&#x6d4b;&#x8bd5;","children":[{"content":"<pre data-lines=\"2083,2086\"><code>&#x8bf7;&#x91cd;&#x542f;`service-order`&#x3001;`service-account`&#x5de5;&#x7a0b;\n\n&#x7136;&#x540e;&#x8f93;&#x5165;&#x4e0b;&#x5355;&#x5730;&#x5740;&#x6d4b;&#x8bd5;&#xff1a;`http://localhost:9003/order/create?userId=1&amp;productId=1&amp;count=10&amp;money=100&amp;status=1`\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2083,2086"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/513a2302863eb791e439f937f725b00d.png\" alt>","children":[],"payload":{"tag":"img","lines":"2087,2088"}},{"content":"<pre data-lines=\"2089,2090\"><code>&#x8bf7;&#x6253;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8868;&#xff0c;&#x67e5;&#x770b;&#x4e0b;&#x5355;&#x4e4b;&#x540e;&#x6570;&#x636e;&#x7684;&#x53d8;&#x5316;&#xff0c;&#x4f9d;&#x6b21;&#x662f;&#xff1a;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x8d26;&#x6237;&#x6570;&#x636e;&#x5e93;&#x8868;&#x3001;&#x5e93;&#x5b58;&#x6570;&#x636e;&#x5e93;&#x8868;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2089,2090"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/fa4dec3576db00fc84edd887eabce80c.png\" alt>","children":[],"payload":{"tag":"img","lines":"2091,2092"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/25d243fdeacc9e9da968b1ce03e2fd7e.png\" alt>","children":[],"payload":{"tag":"img","lines":"2093,2094"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/ebc01b6efa9a008ad0bef0c94434d9f8.png\" alt>","children":[],"payload":{"tag":"img","lines":"2095,2096"}},{"content":"<pre data-lines=\"2097,2098\"><code>&#x6211;&#x4eec;&#x53d1;&#x73b0;&#x867d;&#x7136;&#x4e0b;&#x5355;&#x5931;&#x8d25;&#x4e86;&#xff0c;&#x4f46;&#x662f;&#x5e76;&#x6ca1;&#x6709;&#x5f80;&#x8ba2;&#x5355;&#x6570;&#x636e;&#x5e93;&#x63d2;&#x5165;&#x8ba2;&#x5355;&#x4fe1;&#x606f;&#xff0c;&#x8d26;&#x6237;&#x4f59;&#x989d;&#x548c;&#x5e93;&#x5b58;&#x4e5f;&#x6ca1;&#x6709;&#x51cf;&#x5c11;&#xff0c;&#x8fd9;&#x7b26;&#x5408;&#x6211;&#x4eec;&#x7684;&#x4e1a;&#x52a1;&#x903b;&#x8f91;&#xff0c;&#x5206;&#x5e03;&#x5f0f;&#x4e0b;&#x7684;&#x4e8b;&#x52a1;&#x7ba1;&#x7406;&#x5b8c;&#x7f8e;&#x89e3;&#x51b3;&#x3002;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2097,2098"}},{"content":"<img src=\"https://img-blog.csdnimg.cn/img_convert/629819b8ceef990e5d5d45173f4c7cce.png\" alt>","children":[],"payload":{"tag":"img","lines":"2099,2100"}},{"content":"<pre data-lines=\"2101,2104\"><code>&#x800c;&#x8d26;&#x6237;&#x4f59;&#x989d;&#x7684;&#x56de;&#x6eda;&#x64cd;&#x4f5c;&#x5219;&#x662f;&#x4f7f;&#x7528;&#x7684;&#x662f;TCC&#x6a21;&#x5f0f;&#x4e0b;&#xff0c;&#x6211;&#x4eec;&#x81ea;&#x5b9a;&#x4e49;&#x7684;&#x7b2c;&#x4e8c;&#x9636;&#x6bb5;&#x56de;&#x6eda;&#x65b9;&#x6cd5;&#x3002;\n\n&gt; &#x6ce8;&#x610f;&#xff1a;&#x6d4b;&#x8bd5;&#x5b8c;&#x6bd5;&#xff0c;&#x8bf7;&#x5173;&#x95ed;&#x5f53;&#x524d;&#x5de5;&#x7a0b;&#xff0c;&#x9632;&#x6b62;&#x5f71;&#x54cd;&#x5176;&#x4ed6;&#x9879;&#x76ee;&#x3002;&#x6b63;&#x5e38;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;&#x6bcf;&#x4e00;&#x4e2a;&#x670d;&#x52a1;&#x90fd;&#x9700;&#x8981;&#x914d;&#x7f6e;seata&#xff0c;&#x6211;&#x8fd9;&#x91cc;&#x5077;&#x61d2;&#x4e86;&#xff0c;&#x5927;&#x5bb6;&#x8981;&#x6ce8;&#x610f;&#x4e00;&#x4e0b;&#xff01;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"2101,2104"}}],"payload":{"tag":"h2","lines":"2080,2082"}}],"payload":{"tag":"h1","lines":"0,1"}},{})</script>
</body>
</html>
