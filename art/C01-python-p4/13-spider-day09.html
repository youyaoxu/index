<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.18.10/dist/browser/index.js"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.18.10/dist/index.js"></script><script>(r => {
              setTimeout(r);
            })(function renderToolbar() {
  const {
    markmap,
    mm
  } = window;
  const {
    el
  } = markmap.Toolbar.create(mm);
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, root2, jsonOptions) => {
              const markmap = getMarkmap();
              window.mm = markmap.Markmap.create(
                "svg#mindmap",
                (getOptions || markmap.deriveOptions)(jsonOptions),
                root2
              );
            })(() => window.markmap,null,{"content":"","children":[{"content":"Day08&#x56de;&#x987e;","children":[{"content":"scrapy&#x6846;&#x67b6;","children":[{"content":"&#x4e94;&#x5927;&#x7ec4;&#x4ef6;+&#x5de5;&#x4f5c;&#x6d41;&#x7a0b;+&#x5e38;&#x7528;&#x547d;&#x4ee4;","children":[{"content":"<pre data-lines=\"6,29\"><code class=\"language-python\">&#x3010;1&#x3011;&#x4e94;&#x5927;&#x7ec4;&#x4ef6;\n    1.1) &#x5f15;&#x64ce;&#xff08;Engine&#xff09;\n    1.2) &#x722c;&#x866b;&#x7a0b;&#x5e8f;&#xff08;Spider&#xff09;\n    1.3) &#x8c03;&#x5ea6;&#x5668;&#xff08;Scheduler&#xff09;\n    1.4) &#x4e0b;&#x8f7d;&#x5668;&#xff08;Downloader&#xff09;\n    1.5) &#x7ba1;&#x9053;&#x6587;&#x4ef6;&#xff08;Pipeline&#xff09;\n    1.6) &#x4e0b;&#x8f7d;&#x5668;&#x4e2d;&#x95f4;&#x4ef6;&#xff08;Downloader Middlewares&#xff09;\n    1.7) &#x8718;&#x86db;&#x4e2d;&#x95f4;&#x4ef6;&#xff08;Spider Middlewares&#xff09;\n    \n&#x3010;2&#x3011;&#x5de5;&#x4f5c;&#x6d41;&#x7a0b;\n    2.1) Engine&#x5411;Spider&#x7d22;&#x8981;URL,&#x4ea4;&#x7ed9;Scheduler&#x5165;&#x961f;&#x5217;\n    2.2) Scheduler&#x5904;&#x7406;&#x540e;&#x51fa;&#x961f;&#x5217;,&#x901a;&#x8fc7;Downloader Middlewares&#x4ea4;&#x7ed9;Downloader&#x53bb;&#x4e0b;&#x8f7d;\n    2.3) Downloader&#x5f97;&#x5230;&#x54cd;&#x5e94;&#x540e;,&#x901a;&#x8fc7;Spider Middlewares&#x4ea4;&#x7ed9;Spider\n    2.4) Spider&#x6570;&#x636e;&#x63d0;&#x53d6;&#xff1a;\n       a) &#x6570;&#x636e;&#x4ea4;&#x7ed9;Pipeline&#x5904;&#x7406;\n       b) &#x9700;&#x8981;&#x8ddf;&#x8fdb;URL,&#x7ee7;&#x7eed;&#x4ea4;&#x7ed9;Scheduler&#x5165;&#x961f;&#x5217;&#xff0c;&#x4f9d;&#x6b21;&#x5faa;&#x73af;\n    \n&#x3010;3&#x3011;&#x5e38;&#x7528;&#x547d;&#x4ee4;\n    3.1) scrapy startproject &#x9879;&#x76ee;&#x540d;\n    3.2) scrapy genspider &#x722c;&#x866b;&#x540d; &#x57df;&#x540d;\n    3.3) scrapy crawl &#x722c;&#x866b;&#x540d;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"6,29"}}],"payload":{"tag":"h3","lines":"4,5"}}],"payload":{"tag":"h2","lines":"2,3"}},{"content":"&#x5b8c;&#x6210;scrapy&#x9879;&#x76ee;&#x5b8c;&#x6574;&#x6d41;&#x7a0b;","children":[{"content":"&#x5b8c;&#x6574;&#x6d41;&#x7a0b;","children":[{"content":"<pre data-lines=\"34,71\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;crapy startproject Tencent\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;cd Tencent\n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;scrapy genspider tencent tencent.com\n&#x3010;<span class=\"hljs-number\">4</span>&#x3011;items.py(&#x5b9a;&#x4e49;&#x722c;&#x53d6;&#x6570;&#x636e;&#x7ed3;&#x6784;)\n    <span class=\"hljs-keyword\">import</span> scrapy\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TencentItem</span>(scrapy.Item):\n        name = scrapy.Field()\n        address = scrapy.Field()\n    \n&#x3010;<span class=\"hljs-number\">5</span>&#x3011;tencent.py&#xff08;&#x5199;&#x722c;&#x866b;&#x6587;&#x4ef6;&#xff09;\n    <span class=\"hljs-keyword\">import</span> scrapy\n    <span class=\"hljs-keyword\">from</span> ..items <span class=\"hljs-keyword\">import</span> TencentItem\n    \n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TencentSpider</span>(scrapy.Spider):\n        name = <span class=\"hljs-string\">&apos;tencent&apos;</span>\n        allowed_domains = [<span class=\"hljs-string\">&apos;tencent.com&apos;</span>]\n        start_urls = [<span class=\"hljs-string\">&apos;http://tencent.com/&apos;</span>]\n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse</span>(<span class=\"hljs-params\">self,response</span>):\n            item = TencentItem()\n            xxx\n            <span class=\"hljs-keyword\">yield</span> item\n\n&#x3010;<span class=\"hljs-number\">6</span>&#x3011;pipelines.py(&#x6570;&#x636e;&#x5904;&#x7406;)\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TencentPipeline</span>(<span class=\"hljs-title class_ inherited__\">object</span>):\n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">process_item</span>(<span class=\"hljs-params\">self,item,spider</span>):\n            <span class=\"hljs-keyword\">return</span> item\n        \n&#x3010;<span class=\"hljs-number\">7</span>&#x3011;settings.py(&#x5168;&#x5c40;&#x914d;&#x7f6e;)\n    LOG_LEVEL = <span class=\"hljs-string\">&apos;&apos;</span>  <span class=\"hljs-comment\"># DEBUG &lt; INFO &lt; WARNING &lt; ERROR &lt; CRITICAL</span>\n    LOG_FILE = <span class=\"hljs-string\">&apos;&apos;</span>\n    FEED_EXPORT_ENCODING = <span class=\"hljs-string\">&apos;&apos;</span>\n    \n&#x3010;<span class=\"hljs-number\">8</span>&#x3011;run.py \n    <span class=\"hljs-keyword\">from</span> scrapy <span class=\"hljs-keyword\">import</span> cmdline\n    cmdline.execute(<span class=\"hljs-string\">&apos;scrapy crawl tencnet&apos;</span>.split())\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"34,71"}}],"payload":{"tag":"h3","lines":"32,33"}}],"payload":{"tag":"h2","lines":"30,31"}},{"content":"&#x6211;&#x4eec;&#x5fc5;&#x987b;&#x8bb0;&#x4f4f;","children":[{"content":"&#x719f;&#x7ec3;&#x8bb0;&#x4f4f;","children":[{"content":"<pre data-lines=\"76,113\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x54cd;&#x5e94;&#x5bf9;&#x8c61;response&#x5c5e;&#x6027;&#x53ca;&#x65b9;&#x6cd5;\n    <span class=\"hljs-number\">1.1</span>) response.text &#xff1a;&#x83b7;&#x53d6;&#x54cd;&#x5e94;&#x5185;&#x5bb9; - &#x5b57;&#x7b26;&#x4e32;\n    <span class=\"hljs-number\">1.2</span>) response.body &#xff1a;&#x83b7;&#x53d6;<span class=\"hljs-built_in\">bytes</span>&#x6570;&#x636e;&#x7c7b;&#x578b;\n    <span class=\"hljs-number\">1.3</span>) response.xpath(<span class=\"hljs-string\">&apos;&apos;</span>)\n    <span class=\"hljs-number\">1.4</span>) response.xpath(<span class=\"hljs-string\">&apos;&apos;</span>).extract() &#xff1a;&#x63d0;&#x53d6;&#x6587;&#x672c;&#x5185;&#x5bb9;,&#x5c06;&#x5217;&#x8868;&#x4e2d;&#x6240;&#x6709;&#x5143;&#x7d20;&#x5e8f;&#x5217;&#x5316;&#x4e3a;Unicode&#x5b57;&#x7b26;&#x4e32;\n    <span class=\"hljs-number\">1.5</span>) response.xpath(<span class=\"hljs-string\">&apos;&apos;</span>).extract_first() &#xff1a;&#x5e8f;&#x5217;&#x5316;&#x63d0;&#x53d6;&#x5217;&#x8868;&#x4e2d;&#x7b2c;<span class=\"hljs-number\">1</span>&#x4e2a;&#x6587;&#x672c;&#x5185;&#x5bb9;\n    <span class=\"hljs-number\">1.6</span>) response.xpath(<span class=\"hljs-string\">&apos;&apos;</span>).get() &#xff1a; &#x63d0;&#x53d6;&#x5217;&#x8868;&#x4e2d;&#x7b2c;<span class=\"hljs-number\">1</span>&#x4e2a;&#x6587;&#x672c;&#x5185;&#x5bb9;(&#x7b49;&#x540c;&#x4e8e;extract_first())\n    \n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;settings.py&#x4e2d;&#x5e38;&#x7528;&#x53d8;&#x91cf;\n    <span class=\"hljs-number\">2.1</span>) &#x8bbe;&#x7f6e;&#x65e5;&#x5fd7;&#x7ea7;&#x522b;\n         LOG_LEVEL = <span class=\"hljs-string\">&apos;&apos;</span>\n    <span class=\"hljs-number\">2.2</span>) &#x4fdd;&#x5b58;&#x5230;&#x65e5;&#x5fd7;&#x6587;&#x4ef6;(&#x4e0d;&#x5728;&#x7ec8;&#x7aef;&#x8f93;&#x51fa;)\n         LOG_FILE = <span class=\"hljs-string\">&apos;xxx.log&apos;</span>\n    <span class=\"hljs-number\">2.3</span>) &#x8bbe;&#x7f6e;&#x6570;&#x636e;&#x5bfc;&#x51fa;&#x7f16;&#x7801;(&#x4e3b;&#x8981;&#x9488;&#x5bf9;&#x4e8e;json&#x6587;&#x4ef6;)\n         FEED_EXPORT_ENCODING = <span class=\"hljs-string\">&apos;utf-8&apos;</span>\n    <span class=\"hljs-number\">2.4</span>) &#x8bbe;&#x7f6e;User-Agent\n         USER_AGENT = <span class=\"hljs-string\">&apos;Mozilla/5.0&apos;</span>\n    <span class=\"hljs-number\">2.5</span>) &#x8bbe;&#x7f6e;&#x6700;&#x5927;&#x5e76;&#x53d1;&#x6570;(&#x9ed8;&#x8ba4;&#x4e3a;<span class=\"hljs-number\">16</span>)\n         CONCURRENT_REQUESTS = <span class=\"hljs-number\">32</span>\n    <span class=\"hljs-number\">2.6</span>) &#x4e0b;&#x8f7d;&#x5ef6;&#x8fdf;&#x65f6;&#x95f4;(&#x6bcf;&#x9694;&#x591a;&#x957f;&#x65f6;&#x95f4;&#x8bf7;&#x6c42;&#x4e00;&#x4e2a;&#x7f51;&#x9875;)\n         DOWNLOAD_DELAY = <span class=\"hljs-number\">0.1</span>\n    <span class=\"hljs-number\">2.7</span>) &#x8bf7;&#x6c42;&#x5934;\n         DEFAULT_REQUEST_HEADERS = {<span class=\"hljs-string\">&apos;Cookie&apos;</span>:<span class=\"hljs-string\">&apos;&apos;</span>,<span class=\"hljs-string\">&apos;User-Agent&apos;</span>:<span class=\"hljs-string\">&apos;&apos;</span>}\n    <span class=\"hljs-number\">2.8</span>) &#x6dfb;&#x52a0;&#x9879;&#x76ee;&#x7ba1;&#x9053;\n         ITEM_PIPELINES = {<span class=\"hljs-string\">&apos;&#x9879;&#x76ee;&#x76ee;&#x5f55;&#x540d;.pipelines.&#x7c7b;&#x540d;&apos;</span> : <span class=\"hljs-number\">200</span>}\n    <span class=\"hljs-number\">2.9</span>) cookie(&#x9ed8;&#x8ba4;&#x7981;&#x7528;,&#x53d6;&#x6d88;&#x6ce8;&#x91ca;-<span class=\"hljs-literal\">True</span>|<span class=\"hljs-literal\">False</span>&#x90fd;&#x4e3a;&#x5f00;&#x542f;)\n         COOKIES_ENABLED = <span class=\"hljs-literal\">False</span>\n    <span class=\"hljs-number\">2.10</span>) &#x975e;&#x7ed3;&#x6784;&#x5316;&#x6570;&#x636e;&#x5b58;&#x50a8;&#x8def;&#x5f84;\n         IMAGES_STORE = <span class=\"hljs-string\">&apos;/home/tarena/images/&apos;</span>\n         FILES_STORE = <span class=\"hljs-string\">&apos;/home/tarena/files/&apos;</span>\n    <span class=\"hljs-number\">2.11</span>) &#x6dfb;&#x52a0;&#x4e0b;&#x8f7d;&#x5668;&#x4e2d;&#x95f4;&#x4ef6;\n         DOWNLOADER_MIDDLEWARES = {<span class=\"hljs-string\">&apos;&#x9879;&#x76ee;&#x76ee;&#x5f55;&#x540d;.middlewares.&#x7c7b;&#x540d;&apos;</span> : <span class=\"hljs-number\">200</span>}\n    \n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;&#x65e5;&#x5fd7;&#x7ea7;&#x522b;\n    DEBUG &lt; INFO &lt; WARNING &lt; ERROR &lt; CRITICAL\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"76,113"}}],"payload":{"tag":"h3","lines":"74,75"}}],"payload":{"tag":"h2","lines":"72,73"}},{"content":"&#x722c;&#x866b;&#x9879;&#x76ee;&#x542f;&#x52a8;&#x65b9;&#x5f0f;","children":[{"content":"&#x542f;&#x52a8;&#x65b9;&#x5f0f;","children":[{"content":"<pre data-lines=\"118,129\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x65b9;&#x5f0f;&#x4e00;:&#x57fa;&#x4e8e;start_urls\n    <span class=\"hljs-number\">1.1</span>) &#x4ece;&#x722c;&#x866b;&#x6587;&#x4ef6;(spider)&#x7684;start_urls&#x53d8;&#x91cf;&#x4e2d;&#x904d;&#x5386;URL&#x5730;&#x5740;&#x4ea4;&#x7ed9;&#x8c03;&#x5ea6;&#x5668;&#x5165;&#x961f;&#x5217;,\n    <span class=\"hljs-number\">1.2</span>) &#x628a;&#x4e0b;&#x8f7d;&#x5668;&#x8fd4;&#x56de;&#x7684;&#x54cd;&#x5e94;&#x5bf9;&#x8c61;&#xff08;response&#xff09;&#x4ea4;&#x7ed9;&#x722c;&#x866b;&#x6587;&#x4ef6;&#x7684;parse(<span class=\"hljs-variable language_\">self</span>,response)&#x51fd;&#x6570;&#x5904;&#x7406;\n\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;&#x65b9;&#x5f0f;&#x4e8c;\n    &#x91cd;&#x5199;start_requests()&#x65b9;&#x6cd5;&#xff0c;&#x4ece;&#x6b64;&#x65b9;&#x6cd5;&#x4e2d;&#x83b7;&#x53d6;URL&#xff0c;&#x4ea4;&#x7ed9;&#x6307;&#x5b9a;&#x7684;callback&#x89e3;&#x6790;&#x51fd;&#x6570;&#x5904;&#x7406;\n    <span class=\"hljs-number\">2.1</span>) &#x53bb;&#x6389;start_urls&#x53d8;&#x91cf;\n    <span class=\"hljs-number\">2.2</span>) <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">start_requests</span>(<span class=\"hljs-params\">self</span>):\n             <span class=\"hljs-comment\"># &#x751f;&#x6210;&#x8981;&#x722c;&#x53d6;&#x7684;URL&#x5730;&#x5740;&#xff0c;&#x5229;&#x7528;scrapy.Request()&#x65b9;&#x6cd5;&#x4ea4;&#x7ed9;&#x8c03;&#x5ea6;&#x5668;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"118,129"}}],"payload":{"tag":"h3","lines":"116,117"}}],"payload":{"tag":"h2","lines":"114,115"}},{"content":"&#x6570;&#x636e;&#x6301;&#x4e45;&#x5316;&#x5b58;&#x50a8;","children":[{"content":"MySQL-MongoDB-Json-csv","children":[{"content":"<pre data-lines=\"134,160\"><code class=\"language-python\">*&#x5b58;&#x5165;MySQL&#x3001;MongoDB\n\n&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x5728;setting.py&#x4e2d;&#x5b9a;&#x4e49;&#x76f8;&#x5173;&#x53d8;&#x91cf;\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;pipelines.py&#x4e2d;&#x65b0;&#x5efa;&#x7ba1;&#x9053;&#x7c7b;&#xff0c;&#x5e76;&#x5bfc;&#x5165;settings&#x6a21;&#x5757;\n\t<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">open_spider</span>(<span class=\"hljs-params\">self,spider</span>):\n\t\t<span class=\"hljs-comment\"># &#x722c;&#x866b;&#x5f00;&#x59cb;&#x6267;&#x884c;1&#x6b21;,&#x7528;&#x4e8e;&#x6570;&#x636e;&#x5e93;&#x8fde;&#x63a5;</span>\n        \n\t<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">process_item</span>(<span class=\"hljs-params\">self,item,spider</span>):\n        <span class=\"hljs-comment\"># &#x7528;&#x4e8e;&#x5904;&#x7406;&#x6293;&#x53d6;&#x7684;item&#x6570;&#x636e;</span>\n        <span class=\"hljs-keyword\">return</span> item\n    \n\t<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">close_spider</span>(<span class=\"hljs-params\">self,spider</span>):\n\t\t<span class=\"hljs-comment\"># &#x722c;&#x866b;&#x7ed3;&#x675f;&#x65f6;&#x6267;&#x884c;1&#x6b21;,&#x7528;&#x4e8e;&#x65ad;&#x5f00;&#x6570;&#x636e;&#x5e93;&#x8fde;&#x63a5;</span>\n        \n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;settings.py&#x4e2d;&#x6dfb;&#x52a0;&#x6b64;&#x7ba1;&#x9053;\n\tITEM_PIPELINES = {<span class=\"hljs-string\">&apos;&apos;</span>:<span class=\"hljs-number\">200</span>}\n\n&#x3010;&#x6ce8;&#x610f;&#x3011; process_item() &#x51fd;&#x6570;&#x4e2d;&#x4e00;&#x5b9a;&#x8981; <span class=\"hljs-keyword\">return</span> item\n\n&#x5b58;&#x5165;JSON&#x3001;CSV&#x6587;&#x4ef6;*\nscrapy crawl maoyan -o maoyan.csv\nscrapy crawl maoyan -o maoyan.json\n&#x3010;&#x6ce8;&#x610f;&#x3011;\n    &#x5b58;&#x5165;json&#x6587;&#x4ef6;&#x65f6;&#x5019;&#x9700;&#x8981;&#x6dfb;&#x52a0;&#x53d8;&#x91cf;(settings.py) : FEED_EXPORT_ENCODING = <span class=\"hljs-string\">&apos;utf-8&apos;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"134,160"}}],"payload":{"tag":"h3","lines":"132,133"}}],"payload":{"tag":"h2","lines":"130,131"}},{"content":"&#x591a;&#x7ea7;&#x9875;&#x9762;&#x6293;&#x53d6;&#x4e4b;&#x722c;&#x866b;&#x6587;&#x4ef6;","children":[{"content":"&#x591a;&#x7ea7;&#x9875;&#x9762;&#x653b;&#x7565;","children":[{"content":"<pre data-lines=\"165,267\"><code class=\"language-python\">&#x3010;&#x573a;&#x666f;<span class=\"hljs-number\">1</span>&#x3011;&#x53ea;&#x6293;&#x53d6;&#x4e00;&#x7ea7;&#x9875;&#x9762;&#x7684;&#x60c5;&#x51b5;\n<span class=\"hljs-string\">&quot;&quot;&quot;\n&#x4e00;&#x7ea7;&#x9875;&#x9762;: &#x540d;&#x79f0;(name)&#x3001;&#x7231;&#x597d;(likes)\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">import</span> scrapy\n<span class=\"hljs-keyword\">from</span> ..items <span class=\"hljs-keyword\">import</span> OneItem\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">OneSpider</span>(scrapy.Spider):\n    name = <span class=\"hljs-string\">&apos;One&apos;</span>\n    allowed_domains = [<span class=\"hljs-string\">&apos;www.one.com&apos;</span>]\n    start_urls = [<span class=\"hljs-string\">&apos;http://www.one.com&apos;</span>]\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse</span>(<span class=\"hljs-params\">self,response</span>):\n        dd_list = response.xpath(<span class=\"hljs-string\">&apos;//dd&apos;</span>)\n        <span class=\"hljs-keyword\">for</span> dd <span class=\"hljs-keyword\">in</span> dd_list:\n            <span class=\"hljs-comment\"># &#x521b;&#x5efa;item&#x5bf9;&#x8c61;</span>\n        \titem = OneItem()\n            item[<span class=\"hljs-string\">&apos;name&apos;</span>] = dd.xpath(<span class=\"hljs-string\">&apos;./text()&apos;</span>).get()\n            item[<span class=\"hljs-string\">&apos;likes&apos;</span>] = dd.xpath(<span class=\"hljs-string\">&apos;./text()&apos;</span>).get()\n            \n            <span class=\"hljs-keyword\">yield</span> item\n\n\n&#x3010;&#x573a;&#x666f;<span class=\"hljs-number\">2</span>&#x3011;&#x4e8c;&#x7ea7;&#x9875;&#x9762;&#x6570;&#x636e;&#x6293;&#x53d6;\n<span class=\"hljs-string\">&quot;&quot;&quot;\n&#x4e00;&#x7ea7;&#x9875;&#x9762;: &#x540d;&#x79f0;(name)&#x3001;&#x8be6;&#x60c5;&#x9875;&#x94fe;&#x63a5;(url)-&#x9700;&#x8981;&#x7ee7;&#x7eed;&#x8ddf;&#x8fdb;\n&#x4e8c;&#x7ea7;&#x9875;&#x9762;: &#x8be6;&#x60c5;&#x9875;&#x5185;&#x5bb9;(content)\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">import</span> scrapy\n<span class=\"hljs-keyword\">from</span> ..items <span class=\"hljs-keyword\">import</span> TwoItem\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TwoSpider</span>(scrapy.Spider):\n    name = <span class=\"hljs-string\">&apos;two&apos;</span>\n    allowed_domains = [<span class=\"hljs-string\">&apos;www.two.com&apos;</span>]\n    start_urls = [<span class=\"hljs-string\">&apos;http://www.two.com/&apos;</span>]\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse</span>(<span class=\"hljs-params\">self,response</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x4e00;&#x7ea7;&#x9875;&#x9762;&#x89e3;&#x6790;&#x51fd;&#x6570;,&#x63d0;&#x53d6; name &#x548c; url(&#x8be6;&#x60c5;&#x9875;&#x94fe;&#x63a5;,&#x9700;&#x8981;&#x7ee7;&#x7eed;&#x8bf7;&#x6c42;)&quot;&quot;&quot;</span>\n        dd_list = response.xpath(<span class=\"hljs-string\">&apos;//dd&apos;</span>)\n        <span class=\"hljs-keyword\">for</span> dd <span class=\"hljs-keyword\">in</span> dd_list:\n            <span class=\"hljs-comment\"># &#x6709;&#x7ee7;&#x7eed;&#x4ea4;&#x7ed9;&#x8c03;&#x5ea6;&#x5668;&#x5165;&#x961f;&#x5217;&#x7684;&#x8bf7;&#x6c42;,&#x5c31;&#x8981;&#x521b;&#x5efa;item&#x5bf9;&#x8c61;</span>\n            item = TwoItem()\n            item[<span class=\"hljs-string\">&apos;name&apos;</span>] = dd.xpath(<span class=\"hljs-string\">&apos;./text()&apos;</span>).get()\n            item[<span class=\"hljs-string\">&apos;url&apos;</span>] = dd.xpath(<span class=\"hljs-string\">&apos;./@href&apos;</span>).get()\n            \n            <span class=\"hljs-keyword\">yield</span> scrapy.Request(\n                url=item[<span class=\"hljs-string\">&apos;url&apos;</span>],meta={<span class=\"hljs-string\">&apos;item&apos;</span>:item},callback=<span class=\"hljs-variable language_\">self</span>.detail_page)\n            \n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">detail_page</span>(<span class=\"hljs-params\">self,response</span>):\n        item = response.meta[<span class=\"hljs-string\">&apos;item&apos;</span>]\n        item[<span class=\"hljs-string\">&apos;content&apos;</span>] = response.xpath(<span class=\"hljs-string\">&apos;//text()&apos;</span>).get()\n        \n        <span class=\"hljs-keyword\">yield</span> item\n        \n            \n&#x3010;&#x573a;&#x666f;<span class=\"hljs-number\">3</span>&#x3011;&#x4e09;&#x7ea7;&#x9875;&#x9762;&#x6293;&#x53d6;\n<span class=\"hljs-string\">&quot;&quot;&quot;\n&#x4e00;&#x7ea7;&#x9875;&#x9762;: &#x540d;&#x79f0;(one_name)&#x3001;&#x8be6;&#x60c5;&#x9875;&#x94fe;&#x63a5;(one_url)-&#x9700;&#x8981;&#x7ee7;&#x7eed;&#x8ddf;&#x8fdb;\n&#x4e8c;&#x7ea7;&#x9875;&#x9762;: &#x540d;&#x79f0;(two_name)&#x3001;&#x4e0b;&#x8f7d;&#x9875;&#x94fe;&#x63a5;(two_url)-&#x9700;&#x8981;&#x7ee7;&#x7eed;&#x8ddf;&#x8fdb;\n&#x4e09;&#x7ea7;&#x9875;&#x9762;: &#x5177;&#x4f53;&#x6240;&#x9700;&#x5185;&#x5bb9;(content)\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">import</span> scrapy\n<span class=\"hljs-keyword\">from</span> ..items <span class=\"hljs-keyword\">import</span> ThreeItem\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ThreeSpider</span>(scrapy.Spider):\n    name = <span class=\"hljs-string\">&apos;three&apos;</span>\n    allowed_domains = [<span class=\"hljs-string\">&apos;www.three.com&apos;</span>]\n    start_urls = [<span class=\"hljs-string\">&apos;http://www.three.com/&apos;</span>]\n    \n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse</span>(<span class=\"hljs-params\">self,response</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x4e00;&#x7ea7;&#x9875;&#x9762;&#x89e3;&#x6790;&#x51fd;&#x6570; - one_name&#x3001;one_url&quot;&quot;&quot;</span>\n        dd_list = response.xpath(<span class=\"hljs-string\">&apos;//dd&apos;</span>)\n        <span class=\"hljs-keyword\">for</span> dd <span class=\"hljs-keyword\">in</span> dd_list:\n            <span class=\"hljs-comment\"># &#x6709;&#x7ee7;&#x7eed;&#x53d1;&#x5f80;&#x8c03;&#x5ea6;&#x5668;&#x7684;&#x8bf7;&#x6c42;,&#x521b;&#x5efa;item&#x5bf9;&#x8c61;&#x7684;&#x65f6;&#x523b;&#x5230;&#x5566;&#xff01;&#xff01;&#xff01;</span>\n            item = ThreeItem()\n            item[<span class=\"hljs-string\">&apos;one_name&apos;</span>] = dd.xpath(<span class=\"hljs-string\">&apos;./text()&apos;</span>).get()\n            item[<span class=\"hljs-string\">&apos;one_url&apos;</span>] = dd.xpath(<span class=\"hljs-string\">&apos;./@href&apos;</span>).get()\n            <span class=\"hljs-keyword\">yield</span> scrapy.Request(\n                url=item[<span class=\"hljs-string\">&apos;one_url&apos;</span>],meta={<span class=\"hljs-string\">&apos;meta_1&apos;</span>:item},callback=<span class=\"hljs-variable language_\">self</span>.parse_two)\n            \n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse_two</span>(<span class=\"hljs-params\">self,response</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x4e8c;&#x7ea7;&#x9875;&#x9762;&#x89e3;&#x6790;&#x51fd;&#x6570;: two_name&#x3001;two_url&quot;&quot;&quot;</span>\n        meta1_item = response.meta[<span class=\"hljs-string\">&apos;meta_1&apos;</span>]\n        li_list = response.xpath(<span class=\"hljs-string\">&apos;//li&apos;</span>)\n        <span class=\"hljs-keyword\">for</span> li <span class=\"hljs-keyword\">in</span> li_list:\n            <span class=\"hljs-comment\"># &#x6709;&#x7ee7;&#x7eed;&#x4ea4;&#x7ed9;&#x8c03;&#x5ea6;&#x5668;&#x5165;&#x961f;&#x5217;&#x7684;&#x8bf7;&#x6c42;&#x5566;&#xff0c;&#x6240;&#x4ee5;&#x521b;&#x5efa;item&#x5bf9;&#x8c61;&#x7684;&#x65f6;&#x523b;&#x6765;&#x4e34;&#x4e86;&#xff01;&#xff01;&#xff01;</span>\n            item = ThreeItem()\n            item[<span class=\"hljs-string\">&apos;two_name&apos;</span>] = li.xpath(<span class=\"hljs-string\">&apos;./text()&apos;</span>).get()\n            item[<span class=\"hljs-string\">&apos;two_url&apos;</span>] = li.xpath(<span class=\"hljs-string\">&apos;./@href&apos;</span>).get()\n            item[<span class=\"hljs-string\">&apos;one_name&apos;</span>] = meta1_item[<span class=\"hljs-string\">&apos;one_name&apos;</span>]\n            item[<span class=\"hljs-string\">&apos;one_url&apos;</span>] = meta1_item[<span class=\"hljs-string\">&apos;one_url&apos;</span>]\n            <span class=\"hljs-comment\"># &#x4ea4;&#x7ed9;&#x8c03;&#x5ea6;&#x5668;&#x5165;&#x961f;&#x5217;</span>\n            <span class=\"hljs-keyword\">yield</span> scrapy.Request(\n                url=item[<span class=\"hljs-string\">&apos;two_url&apos;</span>],meta={<span class=\"hljs-string\">&apos;meta_2&apos;</span>:item},callback=<span class=\"hljs-variable language_\">self</span>.detail_page)\n            \n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">detail_page</span>(<span class=\"hljs-params\">self,response</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x4e09;&#x7ea7;&#x9875;&#x9762;&#x89e3;&#x6790;: &#x5177;&#x4f53;&#x5185;&#x5bb9;content&quot;&quot;&quot;</span>\n        item = response.meta[<span class=\"hljs-string\">&apos;meta_2&apos;</span>]\n        <span class=\"hljs-comment\"># &#x592a;&#x597d;&#x4e86;&#xff01;&#x63d0;&#x5177;&#x4f53;&#x5185;&#x5bb9;&#x4e86;,&#x6ca1;&#x6709;&#x7ee7;&#x7eed;&#x4ea4;&#x7ed9;&#x8c03;&#x5ea6;&#x5668;&#x7684;&#x8bf7;&#x6c42;&#x4e86;&#xff01;&#x6240;&#x4ee5;,&#x6211;&#x4e0d;&#x7528;&#x518d;&#x53bb;&#x521b;&#x5efa;item&#x5bf9;&#x8c61;&#x5566;</span>\n        item[<span class=\"hljs-string\">&apos;content&apos;</span>] = response.xpath(<span class=\"hljs-string\">&apos;//text()&apos;</span>).get()\n        \n        <span class=\"hljs-comment\"># &#x4ea4;&#x7ed9;&#x7ba1;&#x9053;&#x6587;&#x4ef6;&#x5904;&#x7406;</span>\n        <span class=\"hljs-keyword\">yield</span> item\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"165,267"}}],"payload":{"tag":"h3","lines":"163,164"}}],"payload":{"tag":"h2","lines":"161,162"}}],"payload":{"tag":"h1","lines":"0,1"}},{"content":"Day09&#x7b14;&#x8bb0;","children":[{"content":"&#x65b0;&#x6d6a;&#x65b0;&#x95fb;&#x5168;&#x7ad9;&#x6293;&#x53d6;","children":[{"content":"&#x76ee;&#x6807;","children":[{"content":"<pre data-lines=\"274,281\"><code class=\"language-python\">&#x3010;1&#x3011;&#x6293;&#x53d6;&#x65b0;&#x6d6a;&#x65b0;&#x95fb;&#x4e0b;&#x7684;&#x6240;&#x6709;&#x5206;&#x7c7b;&#x7684;&#x6240;&#x6709;&#x65b0;&#x95fb;&#xff0c;&#x4fdd;&#x5b58;&#x5230;&#x672c;&#x5730;\n&#x3010;2&#x3011;URL: &#x65b0;&#x6d6a;&#x5b98;&#x7f51; - &#x66f4;&#x591a; - &#x5bfc;&#x822a;  \n    http://news.sina.com.cn/guide/\n&#x3010;3&#x3011;&#x8981;&#x6c42;\n    &#x5c06;&#x4fe1;&#x606f;&#x4fdd;&#x5b58;&#x5230;scrapy&#x9879;&#x76ee;&#x76ee;&#x5f55;&#x7684; data &#x6587;&#x4ef6;&#x5939;&#x4e2d;,&#x5e76;&#x6309;&#x7167;&#x5206;&#x7c7b;&#x540d;&#x79f0;&#x521b;&#x5efa;&#x5b50;&#x6587;&#x4ef6;&#x5939;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"274,281"}}],"payload":{"tag":"h3","lines":"272,273"}},{"content":"&#x5b9e;&#x73b0;&#x6b65;&#x9aa4;","children":[{"content":"&#x6b65;&#x9aa4;1 - &#x521b;&#x5efa;&#x9879;&#x76ee;&#x548c;&#x722c;&#x866b;&#x6587;&#x4ef6;","children":[{"content":"<pre data-lines=\"286,291\"><code class=\"language-python\">scrapy startproject Sina\ncd Sina\nscrapy genspider sina news.sina.com.cn\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"286,291"}}],"payload":{"tag":"h4","lines":"284,285"}},{"content":"&#x6b65;&#x9aa4;2 - &#x5b9a;&#x4e49;&#x8981;&#x6293;&#x53d6;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;&#xff08;items.py)","children":[{"content":"<pre data-lines=\"294,310\"><code class=\"language-python\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SinaItem</span>(scrapy.Item):\n    <span class=\"hljs-comment\"># define the fields for your item here like:</span>\n    <span class=\"hljs-comment\"># &#x4e00;&#x7ea7;&#x9875;&#x9762;: &#x5927;&#x7c7b;&#x540d;&#x79f0;&#x3001;&#x5927;&#x7c7b;URL&#x3001;&#x5c0f;&#x7c7b;&#x540d;&#x79f0;&#x3001;&#x5c0f;&#x7c7b;URL</span>\n    parent_name = scrapy.Field()\n    parent_url = scrapy.Field()\n    son_name = scrapy.Field()\n    son_url = scrapy.Field()\n    <span class=\"hljs-comment\"># &#x4e8c;&#x7ea7;&#x9875;&#x9762;: &#x65b0;&#x95fb;&#x94fe;&#x63a5;</span>\n    news_url = scrapy.Field()\n    <span class=\"hljs-comment\"># &#x4e09;&#x7ea7;&#x9875;&#x9762;: &#x65b0;&#x95fb;&#x6807;&#x9898;&#x3001;&#x65b0;&#x95fb;&#x5185;&#x5bb9;</span>\n    news_head = scrapy.Field()\n    news_content = scrapy.Field()\n    <span class=\"hljs-comment\"># &#x8def;&#x5f84;: ./data/&#x4f53;&#x80b2;/NBA/</span>\n    son_directory = scrapy.Field()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"294,310"}}],"payload":{"tag":"h4","lines":"292,293"}},{"content":"&#x6b65;&#x9aa4;3 - &#x722c;&#x866b;&#x6587;&#x4ef6;&#x8fdb;&#x884c;&#x6570;&#x636e;&#x89e3;&#x6790;&#x63d0;&#x53d6;(sina.py)","children":[{"content":"<pre data-lines=\"313,381\"><code class=\"language-python\"><span class=\"hljs-comment\"># -*- coding: utf-8 -*-</span>\n<span class=\"hljs-keyword\">import</span> scrapy\n<span class=\"hljs-keyword\">from</span> ..items <span class=\"hljs-keyword\">import</span> SinaItem\n<span class=\"hljs-keyword\">import</span> os\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SinaSpider</span>(scrapy.Spider):\n    name = <span class=\"hljs-string\">&apos;sina&apos;</span>\n    allowed_domains = [<span class=\"hljs-string\">&apos;sina.com.cn&apos;</span>]\n    start_urls = [<span class=\"hljs-string\">&apos;http://news.sina.com.cn/guide/&apos;</span>]\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse</span>(<span class=\"hljs-params\">self, response</span>):\n        <span class=\"hljs-comment\"># &#x57fa;&#x51c6;xpath: &#x63d0;&#x53d6;&#x6240;&#x6709;&#x5927;&#x5206;&#x7c7b;&#x7684;&#x8282;&#x70b9;&#x5bf9;&#x8c61;&#x5217;&#x8868;</span>\n        div_list = response.xpath(<span class=\"hljs-string\">&apos;//div[@id=&quot;tab01&quot;]/div&apos;</span>)\n        <span class=\"hljs-keyword\">for</span> div <span class=\"hljs-keyword\">in</span> div_list:\n            <span class=\"hljs-comment\"># &#x5927;&#x5206;&#x7c7b;&#x540d;&#x79f0;+URL</span>\n            <span class=\"hljs-comment\"># xpath&#x8868;&#x8fbe;&#x5f0f;&#x6216; | , &#x5339;&#x914d;&#x5730;&#x65b9;&#x7ad9;(./h3/span/text())</span>\n            parent_name = div.xpath(<span class=\"hljs-string\">&apos;./h3/a/text() | ./h3/span/text()&apos;</span>).get()\n            parent_url = div.xpath(<span class=\"hljs-string\">&apos;./h3/a/@href&apos;</span>).get()\n            <span class=\"hljs-comment\"># &#x5730;&#x65b9;&#x7ad9;&#x60c5;&#x51b5;&#x7279;&#x6b8a;,&#x6ca1;&#x6709;&#x5927;&#x94fe;&#x63a5;</span>\n            <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> parent_url:\n                parent_url = <span class=\"hljs-string\">&apos;http://&apos;</span>\n\n            <span class=\"hljs-comment\"># &#x5c0f;&#x5206;&#x7c7b;&#x7684; li &#x8282;&#x70b9;&#x5bf9;&#x8c61;&#x5217;&#x8868;</span>\n            li_list = div.xpath(<span class=\"hljs-string\">&apos;./ul/li&apos;</span>)\n            <span class=\"hljs-keyword\">for</span> li <span class=\"hljs-keyword\">in</span> li_list:\n                <span class=\"hljs-comment\"># &#x521b;&#x5efa;item&#x5bf9;&#x8c61;: &#x7ee7;&#x7eed;&#x4ea4;&#x7ed9;&#x8c03;&#x5ea6;&#x5668;&#x5165;&#x961f;&#x5217;&#x7684;&#x8bf7;&#x6c42;&#x5bf9;&#x8c61;</span>\n                item = SinaItem()\n                item[<span class=\"hljs-string\">&apos;son_name&apos;</span>] = li.xpath(<span class=\"hljs-string\">&apos;./a/text()&apos;</span>).get()\n                item[<span class=\"hljs-string\">&apos;son_url&apos;</span>] = li.xpath(<span class=\"hljs-string\">&apos;./a/@href&apos;</span>).get()\n                item[<span class=\"hljs-string\">&apos;parent_name&apos;</span>] = parent_name\n                item[<span class=\"hljs-string\">&apos;parent_url&apos;</span>] = parent_url\n                <span class=\"hljs-comment\"># son_directory: ./data/&#x4f53;&#x80b2;/NBA/</span>\n                son_directory = <span class=\"hljs-string\">&apos;./data/{}/{}/&apos;</span>.<span class=\"hljs-built_in\">format</span>(item[<span class=\"hljs-string\">&apos;parent_name&apos;</span>],item[<span class=\"hljs-string\">&apos;son_name&apos;</span>])\n                item[<span class=\"hljs-string\">&apos;son_directory&apos;</span>] = son_directory\n                <span class=\"hljs-comment\"># &#x521b;&#x5efa;&#x5bf9;&#x5e94;&#x7684;&#x76ee;&#x5f55;&#x7ed3;&#x6784;</span>\n                <span class=\"hljs-keyword\">if</span> <span class=\"hljs-keyword\">not</span> os.path.exists(son_directory):\n                    os.makedirs(son_directory)\n\n                <span class=\"hljs-keyword\">yield</span> scrapy.Request(url=item[<span class=\"hljs-string\">&apos;son_url&apos;</span>],meta={<span class=\"hljs-string\">&apos;meta1&apos;</span>:item},callback=<span class=\"hljs-variable language_\">self</span>.parse_son_url)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse_son_url</span>(<span class=\"hljs-params\">self,response</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x89e3;&#x6790;1&#x4e2a;&#x5c0f;&#x5206;&#x7c7b;&#x7684;&#x51fd;&#x6570; - &#x63d0;&#x53d6;&#x65b0;&#x95fb;&#x94fe;&#x63a5;&quot;&quot;&quot;</span>\n        meta1_item = response.meta[<span class=\"hljs-string\">&apos;meta1&apos;</span>]\n        <span class=\"hljs-comment\"># &#x901a;&#x8fc7;&#x89c2;&#x5bdf;URL&#x5730;&#x5740;&#x89c4;&#x5f8b;,&#x65b0;&#x95fb;&#x94fe;&#x63a5;&#x57fa;&#x672c;&#x4e0a;&#x90fd;&#x662f;&#x4ee5; &#x5927;&#x5206;&#x7c7b;URL&#x5f00;&#x5934;,&#x4e14;&#x4ee5;.shtml&#x7ed3;&#x5c3e;</span>\n        news_url_list = response.xpath(<span class=\"hljs-string\">&apos;//a/@href&apos;</span>).extract()\n        <span class=\"hljs-keyword\">for</span> news_url <span class=\"hljs-keyword\">in</span> news_url_list:\n            <span class=\"hljs-keyword\">if</span> news_url.startswith(meta1_item[<span class=\"hljs-string\">&apos;parent_url&apos;</span>]) <span class=\"hljs-keyword\">and</span> news_url.endswith(<span class=\"hljs-string\">&apos;.shtml&apos;</span>):\n                <span class=\"hljs-comment\"># &#x53ea;&#x8981;&#x4f60;&#x60f3;&#x628a;URL&#x5730;&#x5740;&#x4ea4;&#x7ed9;&#x8c03;&#x5ea6;&#x5668;&#x5165;&#x961f;&#x5217;&#x4e86;,&#x8bf4;&#x660e;&#x4f60;&#x521b;&#x5efa;item&#x5bf9;&#x8c61;&#x7684;&#x65f6;&#x523b;&#x5230;&#x4e86;</span>\n                item = SinaItem()\n                item[<span class=\"hljs-string\">&apos;news_url&apos;</span>] = news_url\n                item[<span class=\"hljs-string\">&apos;parent_name&apos;</span>] = meta1_item[<span class=\"hljs-string\">&apos;parent_name&apos;</span>]\n                item[<span class=\"hljs-string\">&apos;parent_url&apos;</span>] = meta1_item[<span class=\"hljs-string\">&apos;parent_url&apos;</span>]\n                item[<span class=\"hljs-string\">&apos;son_name&apos;</span>] = meta1_item[<span class=\"hljs-string\">&apos;son_name&apos;</span>]\n                item[<span class=\"hljs-string\">&apos;son_url&apos;</span>] = meta1_item[<span class=\"hljs-string\">&apos;son_url&apos;</span>]\n                item[<span class=\"hljs-string\">&apos;son_directory&apos;</span>] = meta1_item[<span class=\"hljs-string\">&apos;son_directory&apos;</span>]\n\n                <span class=\"hljs-keyword\">yield</span> scrapy.Request(url=item[<span class=\"hljs-string\">&apos;news_url&apos;</span>],meta={<span class=\"hljs-string\">&apos;meta2&apos;</span>:item},callback=<span class=\"hljs-variable language_\">self</span>.get_content)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_content</span>(<span class=\"hljs-params\">self,response</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x63d0;&#x53d6;&#x5177;&#x4f53;&#x65b0;&#x95fb;&#x5185;&#x5bb9;&#x7684;&#x51fd;&#x6570;&quot;&quot;&quot;</span>\n        item = response.meta[<span class=\"hljs-string\">&apos;meta2&apos;</span>]\n        <span class=\"hljs-comment\"># &#x6b64;&#x5904;&#x589e;&#x52a0;&#x4e86;&#x51e0;&#x4e2a;&#x7c7b;&#x522b;&#x7684;xpath&#x5339;&#x914d;,&#x56e0;&#x4e3a;&#x6709;&#x4e9b;&#x7c7b;&#x522b;&#x7684;&#x65b0;&#x95fb; xpath &#x4e0d;&#x4e00;&#x6837;</span>\n        item[<span class=\"hljs-string\">&apos;news_head&apos;</span>] = response.xpath(<span class=\"hljs-string\">&apos;//h1[@class=&quot;main-title&quot;]/text() | //span[@class=&quot;location&quot;]/h1/text()&apos;</span>).get()\n        item[<span class=\"hljs-string\">&apos;news_content&apos;</span>] = <span class=\"hljs-string\">&apos;\\n&apos;</span>.join(response.xpath(<span class=\"hljs-string\">&apos;//div[@class=&quot;article&quot;]/p/text() | //div[@id=&quot;artibody&quot;]//p/text()&apos;</span>).extract())\n\n        <span class=\"hljs-keyword\">yield</span> item\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"313,381"}}],"payload":{"tag":"h4","lines":"311,312"}},{"content":"&#x6b65;&#x9aa4;4 - &#x6570;&#x636e;&#x5904;&#x7406;(pipelines.py)","children":[{"content":"<pre data-lines=\"384,398\"><code class=\"language-python\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SinaPipeline</span>(<span class=\"hljs-title class_ inherited__\">object</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">process_item</span>(<span class=\"hljs-params\">self, item, spider</span>):\n        <span class=\"hljs-comment\"># url: http://dl.sina.com.cn/zt/auto/sinadlcyh/index.shtml</span>\n        <span class=\"hljs-comment\"># &#x6587;&#x4ef6;&#x540d;&#x4f7f;&#x7528;url&#x5730;&#x5740;&#x7684;&#x4e2d;&#x95f4;(&#x5373;&#x53bb;&#x6389;&#x534f;&#x8bae;&#x548c;&#x540e;&#x7f00;.shtml)</span>\n        filename = item[<span class=\"hljs-string\">&apos;news_url&apos;</span>][<span class=\"hljs-number\">7</span>:-<span class=\"hljs-number\">6</span>].replace(<span class=\"hljs-string\">&apos;/&apos;</span>,<span class=\"hljs-string\">&apos;-&apos;</span>)\n        filename_ = item[<span class=\"hljs-string\">&apos;son_directory&apos;</span>] + filename + <span class=\"hljs-string\">&apos;.txt&apos;</span>\n        <span class=\"hljs-comment\"># &#x5199;&#x5165;&#x672c;&#x5730;&#x6587;&#x4ef6;</span>\n        <span class=\"hljs-keyword\">with</span> <span class=\"hljs-built_in\">open</span>(filename_,<span class=\"hljs-string\">&apos;w&apos;</span>,encoding=<span class=\"hljs-string\">&apos;utf-8&apos;</span>) <span class=\"hljs-keyword\">as</span> f:\n            f.write(item[<span class=\"hljs-string\">&apos;news_content&apos;</span>])\n\n        <span class=\"hljs-keyword\">return</span> item\n\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"384,398"}}],"payload":{"tag":"h4","lines":"382,383"}},{"content":"&#x6b65;&#x9aa4;5 - &#x5168;&#x5c40;&#x914d;&#x7f6e;(settings.py)","children":[{"content":"<pre data-lines=\"401,414\"><code class=\"language-python\"><span class=\"hljs-string\">&quot;&quot;&quot;settings.py&quot;&quot;&quot;</span>\nROBOTSTXT_OBEY = <span class=\"hljs-literal\">False</span>\nDOWNLOAD_DELAY = <span class=\"hljs-number\">1</span>\nDEFAULT_REQUEST_HEADERS = {\n  <span class=\"hljs-string\">&apos;Accept&apos;</span>: <span class=\"hljs-string\">&apos;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&apos;</span>,\n  <span class=\"hljs-string\">&apos;Accept-Language&apos;</span>: <span class=\"hljs-string\">&apos;en&apos;</span>,\n  <span class=\"hljs-string\">&apos;User-Agent&apos;</span>: <span class=\"hljs-string\">&apos;Mozilla/5.0&apos;</span>,\n}\nITEM_PIPELINES = {\n   <span class=\"hljs-string\">&apos;Sina.pipelines.SinaPipeline&apos;</span>: <span class=\"hljs-number\">300</span>,\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"401,414"}}],"payload":{"tag":"h4","lines":"399,400"}}],"payload":{"tag":"h3","lines":"282,283"}}],"payload":{"tag":"h2","lines":"270,271"}},{"content":"&#x56fe;&#x7247;&#x7ba1;&#x9053;(360&#x56fe;&#x7247;&#x6293;&#x53d6;&#x6848;&#x4f8b;)","children":[{"content":"&#x76ee;&#x6807;","children":[{"content":"<pre data-lines=\"426,434\"><code class=\"language-python\">&#x3010;1&#x3011;URL&#x5730;&#x5740;\n    1.1) www.so.com -&gt; &#x56fe;&#x7247; -&gt; &#x7f8e;&#x5973;\n    1.2) &#x5373;: https://image.so.com/z?ch=beauty\n\n&#x3010;2&#x3011;&#x56fe;&#x7247;&#x4fdd;&#x5b58;&#x8def;&#x5f84;\n    ./images/xxx.jpg\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"426,434"}}],"payload":{"tag":"h3","lines":"424,425"}},{"content":"&#x6293;&#x53d6;&#x7f51;&#x7edc;&#x6570;&#x636e;&#x5305;","children":[{"content":"<pre data-lines=\"437,447\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x901a;&#x8fc7;&#x5206;&#x6790;&#xff0c;&#x8be5;&#x7f51;&#x7ad9;&#x4e3a;Ajax&#x52a8;&#x6001;&#x52a0;&#x8f7d;\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;F12&#x6293;&#x5305;&#xff0c;&#x6293;&#x53d6;&#x5230;json&#x5730;&#x5740; &#x548c; &#x67e5;&#x8be2;&#x53c2;&#x6570;(QueryString)\n    <span class=\"hljs-number\">2.1</span>) url = <span class=\"hljs-string\">&apos;https://image.so.com/zjl?ch=beauty&amp;sn={}&amp;listtype=new&amp;temp=1&apos;</span>\n    <span class=\"hljs-number\">2.2</span>) &#x67e5;&#x8be2;&#x53c2;&#x6570;\n         ch: beauty\n         sn: <span class=\"hljs-number\">0</span> <span class=\"hljs-comment\"># &#x53d1;&#x73b0;sn&#x7684;&#x503c;&#x5728;&#x53d8;,0 30 60 90 120 ... ...</span>\n         listtype: new\n         temp: <span class=\"hljs-number\">1</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"437,447"}}],"payload":{"tag":"h3","lines":"435,436"}},{"content":"&#x9879;&#x76ee;&#x5b9e;&#x73b0;","children":[{"content":"1&#x3001;&#x521b;&#x5efa;&#x722c;&#x866b;&#x9879;&#x76ee;&#x548c;&#x722c;&#x866b;&#x6587;&#x4ef6;","children":[{"content":"<pre data-lines=\"452,457\"><code class=\"language-python\">scrapy startproject So\ncd So\nscrapy genspider so image.so.com\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"452,457"}}],"payload":{"tag":"h4","lines":"450,451"}},{"content":"2&#x3001;&#x5b9a;&#x4e49;&#x8981;&#x722c;&#x53d6;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;(items.py)","children":[{"content":"<pre data-lines=\"460,464\"><code class=\"language-python\">img_url = scrapy.Field()\nimg_title = scrapy.Field()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"460,464"}}],"payload":{"tag":"h4","lines":"458,459"}},{"content":"3&#x3001;&#x722c;&#x866b;&#x6587;&#x4ef6;&#x5b9e;&#x73b0;&#x56fe;&#x7247;&#x94fe;&#x63a5;+&#x540d;&#x5b57;&#x6293;&#x53d6;","children":[{"content":"<pre data-lines=\"467,493\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> scrapy\n<span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">from</span> ..items <span class=\"hljs-keyword\">import</span> SoItem\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SoSpider</span>(scrapy.Spider):\n    name = <span class=\"hljs-string\">&apos;so&apos;</span>\n    allowed_domains = [<span class=\"hljs-string\">&apos;image.so.com&apos;</span>]\n    <span class=\"hljs-comment\"># &#x91cd;&#x5199;start_requests()&#x65b9;&#x6cd5;</span>\n    url = <span class=\"hljs-string\">&apos;https://image.so.com/zjl?ch=beauty&amp;sn={}&amp;listtype=new&amp;temp=1&apos;</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">start_requests</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-keyword\">for</span> sn <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">91</span>,<span class=\"hljs-number\">30</span>):\n            full_url = <span class=\"hljs-variable language_\">self</span>.url.<span class=\"hljs-built_in\">format</span>(sn)\n            <span class=\"hljs-comment\"># &#x6254;&#x7ed9;&#x8c03;&#x5ea6;&#x5668;&#x5165;&#x961f;&#x5217;</span>\n            <span class=\"hljs-keyword\">yield</span> scrapy.Request(url=full_url,callback=<span class=\"hljs-variable language_\">self</span>.parse_image)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse_image</span>(<span class=\"hljs-params\">self,response</span>):\n        html = json.loads(response.text)\n        item = SoItem()\n        <span class=\"hljs-keyword\">for</span> img_dict <span class=\"hljs-keyword\">in</span> html[<span class=\"hljs-string\">&apos;list&apos;</span>]:\n            item[<span class=\"hljs-string\">&apos;img_url&apos;</span>] = img_dict[<span class=\"hljs-string\">&apos;qhimg_url&apos;</span>]\n            item[<span class=\"hljs-string\">&apos;img_title&apos;</span>] = img_dict[<span class=\"hljs-string\">&apos;title&apos;</span>]\n\n            <span class=\"hljs-keyword\">yield</span> item\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"467,493"}}],"payload":{"tag":"h4","lines":"465,466"}},{"content":"4&#x3001;&#x7ba1;&#x9053;&#x6587;&#x4ef6;&#xff08;pipelines.py&#xff09;","children":[{"content":"<pre data-lines=\"496,512\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> scrapy.pipelines.images <span class=\"hljs-keyword\">import</span> ImagesPipeline\n<span class=\"hljs-keyword\">import</span> scrapy\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">SoPipeline</span>(<span class=\"hljs-title class_ inherited__\">ImagesPipeline</span>):\n    <span class=\"hljs-comment\"># &#x91cd;&#x5199;get_media_requests()&#x65b9;&#x6cd5;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_media_requests</span>(<span class=\"hljs-params\">self, item, info</span>):\n        <span class=\"hljs-keyword\">yield</span> scrapy.Request(url=item[<span class=\"hljs-string\">&apos;img_url&apos;</span>],meta={<span class=\"hljs-string\">&apos;name&apos;</span>:item[<span class=\"hljs-string\">&apos;img_title&apos;</span>]})\n\n    <span class=\"hljs-comment\"># &#x91cd;&#x5199;file_path()&#x65b9;&#x6cd5;,&#x81ea;&#x5b9a;&#x4e49;&#x6587;&#x4ef6;&#x540d;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">file_path</span>(<span class=\"hljs-params\">self, request, response=<span class=\"hljs-literal\">None</span>, info=<span class=\"hljs-literal\">None</span></span>):\n        img_link = request.url\n        <span class=\"hljs-comment\"># request.meta&#x5c5e;&#x6027;</span>\n        filename = request.meta[<span class=\"hljs-string\">&apos;name&apos;</span>] + <span class=\"hljs-string\">&apos;.&apos;</span> + img_link.split(<span class=\"hljs-string\">&apos;.&apos;</span>)[-<span class=\"hljs-number\">1</span>]\n        <span class=\"hljs-keyword\">return</span> filename\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"496,512"}}],"payload":{"tag":"h4","lines":"494,495"}},{"content":"5&#x3001;&#x5168;&#x5c40;&#x914d;&#x7f6e;(settings.py)","children":[{"content":"<pre data-lines=\"515,528\"><code class=\"language-python\">ROBOTSTXT_OBEY = <span class=\"hljs-literal\">False</span>\nDOWNLOAD_DELAY = <span class=\"hljs-number\">0.1</span>\nDEFAULT_REQUEST_HEADERS = {\n  <span class=\"hljs-string\">&apos;Accept&apos;</span>: <span class=\"hljs-string\">&apos;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&apos;</span>,\n  <span class=\"hljs-string\">&apos;Accept-Language&apos;</span>: <span class=\"hljs-string\">&apos;en&apos;</span>,\n  <span class=\"hljs-string\">&apos;User-Agent&apos;</span>: <span class=\"hljs-string\">&apos;Mozilla/5.0&apos;</span>,\n}\nITEM_PIPELINES = {\n   <span class=\"hljs-string\">&apos;So.pipelines.SoPipeline&apos;</span>: <span class=\"hljs-number\">300</span>,\n}\nIMAGES_STORE = <span class=\"hljs-string\">&apos;D:/AID1910/spider_day09_code/So/images/&apos;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"515,528"}}],"payload":{"tag":"h4","lines":"513,514"}},{"content":"6&#x3001;&#x8fd0;&#x884c;&#x722c;&#x866b;(run.py)","children":[{"content":"<pre data-lines=\"531,536\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> scrapy <span class=\"hljs-keyword\">import</span> cmdline\n\ncmdline.execute(<span class=\"hljs-string\">&apos;scrapy crawl so&apos;</span>.split())\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"531,536"}}],"payload":{"tag":"h4","lines":"529,530"}}],"payload":{"tag":"h3","lines":"448,449"}},{"content":"&#x56fe;&#x7247;&#x7ba1;&#x9053;&#x4f7f;&#x7528;&#x65b9;&#x6cd5;&#x603b;&#x7ed3;","children":[{"content":"<pre data-lines=\"539,553\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x722c;&#x866b;&#x6587;&#x4ef6;: &#x5c06;&#x56fe;&#x7247;&#x94fe;&#x63a5;<span class=\"hljs-keyword\">yield</span>&#x5230;&#x7ba1;&#x9053;\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;&#x7ba1;&#x9053;&#x6587;&#x4ef6;:\n   <span class=\"hljs-keyword\">from</span> scrapy.pipelines.images <span class=\"hljs-keyword\">import</span> ImagesPipeline\n   <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">XxxPipeline</span>(<span class=\"hljs-title class_ inherited__\">ImagesPipeline</span>):\n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_media_requests</span>(<span class=\"hljs-params\">self,xxx</span>):\n            <span class=\"hljs-keyword\">pass</span>\n        \n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">file_path</span>(<span class=\"hljs-params\">self,xxx</span>):\n            <span class=\"hljs-keyword\">pass</span>\n        \n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;settings.py&#x4e2d;:\n   IMAGES_STORE = <span class=\"hljs-string\">&apos;&#x8def;&#x5f84;&apos;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"539,553"}}],"payload":{"tag":"h3","lines":"537,538"}},{"content":"&#x6587;&#x4ef6;&#x7ba1;&#x9053;&#x4f7f;&#x7528;&#x65b9;&#x6cd5;&#x603b;&#x7ed3;","children":[{"content":"<pre data-lines=\"556,570\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x722c;&#x866b;&#x6587;&#x4ef6;: &#x5c06;&#x6587;&#x4ef6;&#x94fe;&#x63a5;<span class=\"hljs-keyword\">yield</span>&#x5230;&#x7ba1;&#x9053;\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;&#x7ba1;&#x9053;&#x6587;&#x4ef6;:\n   <span class=\"hljs-keyword\">from</span> scrapy.pipelines.files <span class=\"hljs-keyword\">import</span> FilesPipeline\n   <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">XxxPipeline</span>(<span class=\"hljs-title class_ inherited__\">FilesPipeline</span>):\n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_media_requests</span>(<span class=\"hljs-params\">self,xxx</span>):\n            <span class=\"hljs-keyword\">pass</span>\n        \n        <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">file_path</span>(<span class=\"hljs-params\">self,xxx</span>):\n            <span class=\"hljs-keyword\">return</span> filename\n        \n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;settings.py&#x4e2d;:\n   FILES_STORE = <span class=\"hljs-string\">&apos;&#x8def;&#x5f84;&apos;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"556,570"}}],"payload":{"tag":"h3","lines":"554,555"}}],"payload":{"tag":"h2","lines":"422,423"}},{"content":"scrapy - post&#x8bf7;&#x6c42;","children":[{"content":"&#x65b9;&#x6cd5;+&#x53c2;&#x6570;","children":[{"content":"<pre data-lines=\"575,582\"><code class=\"language-python\">scrapy.FormRequest(\n    url=posturl,\n    formdata=formdata,\n    callback=<span class=\"hljs-variable language_\">self</span>.parse\n)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"575,582"}}],"payload":{"tag":"h3","lines":"573,574"}},{"content":"&#x6293;&#x53d6;&#x5168;&#x56fd;&#x6240;&#x6709;&#x57ce;&#x5e02;&#x80af;&#x5fb7;&#x57fa;&#x95e8;&#x5e97;&#x4fe1;&#x606f;","children":[{"content":"&#x76ee;&#x6807;&#x8bf4;&#x660e;","children":[{"content":"<pre data-lines=\"587,600\"><code class=\"language-python\">&#x3010;1&#x3011;&#x4e3b;&#x9875;URL&#x5730;&#x5740;\n    http://www.kfc.com.cn/kfccda/storelist/index.aspx\n\n&#x3010;2&#x3011;&#x6293;&#x53d6;&#x6240;&#x6709;&#x57ce;&#x5e02;&#x7684;&#x80af;&#x5fb7;&#x57fa;&#x95e8;&#x5e97;&#x4fe1;&#x606f;\n    2.1) &#x95e8;&#x5e97;&#x7f16;&#x53f7;\n    2.2) &#x95e8;&#x5e97;&#x540d;&#x79f0;\n    2.3) &#x95e8;&#x5e97;&#x5730;&#x5740;\n    2.4) &#x6240;&#x5c5e;&#x57ce;&#x5e02;\n    \n&#x3010;3&#x3011;&#x5c06;&#x6240;&#x6293;&#x6570;&#x636e;&#x5b58;&#x50a8;&#x5230;MySQL&#x6570;&#x636e;&#x5e93;&#x4e2d;\n&lt;a href=&quot;.*?rel=&quot;(.*?)&quot;&gt;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"587,600"}}],"payload":{"tag":"h4","lines":"585,586"}},{"content":"&#x6b65;&#x9aa4;1 - &#x521b;&#x5efa;&#x9879;&#x76ee;+&#x722c;&#x866b;&#x6587;&#x4ef6;","children":[{"content":"<pre data-lines=\"603,608\"><code class=\"language-python\">scrapy startproject Kfc\ncd Kfc\nscrapy genspider kfc www.kfc.com.cn\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"603,608"}}],"payload":{"tag":"h4","lines":"601,602"}},{"content":"&#x6b65;&#x9aa4;2 - &#x5b9a;&#x4e49;&#x8981;&#x6293;&#x53d6;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;(items.py)","children":[{"content":"<pre data-lines=\"611,621\"><code class=\"language-python\"><span class=\"hljs-keyword\">import</span> scrapy\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">KfcItem</span>(scrapy.Item):\n    <span class=\"hljs-comment\"># &#x95e8;&#x5e97;&#x7f16;&#x53f7; + &#x95e8;&#x5e97;&#x540d;&#x79f0; + &#x95e8;&#x5e97;&#x5730;&#x5740; + &#x6240;&#x5c5e;&#x57ce;&#x5e02;</span>\n    row_num = scrapy.Field()\n    store_name = scrapy.Field()\n    address_detail = scrapy.Field()\n    city_name = scrapy.Field()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"611,621"}}],"payload":{"tag":"h4","lines":"609,610"}},{"content":"&#x6b65;&#x9aa4;3 - &#x5199;&#x722c;&#x866b;&#x7a0b;&#x5e8f;(kfc.py)","children":[{"content":"<pre data-lines=\"624,692\"><code class=\"language-python\"><span class=\"hljs-comment\"># -*- coding: utf-8 -*-</span>\n<span class=\"hljs-keyword\">import</span> scrapy\n<span class=\"hljs-keyword\">import</span> requests\n<span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">import</span> re\n<span class=\"hljs-keyword\">from</span> ..items <span class=\"hljs-keyword\">import</span> KfcItem\n\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">KfcSpider</span>(scrapy.Spider):\n    name = <span class=\"hljs-string\">&apos;kfc&apos;</span>\n    allowed_domains = [<span class=\"hljs-string\">&apos;www.kfc.com.cn&apos;</span>]\n    index_url = <span class=\"hljs-string\">&apos;http://www.kfc.com.cn/kfccda/storelist/index.aspx&apos;</span>\n    post_url = <span class=\"hljs-string\">&apos;http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=cname&apos;</span>\n    headers = {<span class=\"hljs-string\">&apos;User-Agent&apos;</span>:<span class=\"hljs-string\">&apos;Mozilla/5.0&apos;</span>}\n\n    <span class=\"hljs-comment\"># &#x7ecf;&#x8fc7;&#x5206;&#x6790;&#x4e3a;POST&#x8bf7;&#x6c42;,&#x6545;&#x4f7f;&#x7528;start_requests()&#x65b9;&#x6cd5;</span>\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">start_requests</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x62fc;&#x63a5;&#x591a;&#x9875;&#x5730;&#x5740;,&#x8fdb;&#x884c;&#x6570;&#x636e;&#x6293;&#x53d6;&quot;&quot;&quot;</span>\n        <span class=\"hljs-comment\"># &#x83b7;&#x53d6;&#x6240;&#x6709;&#x7684;&#x57ce;&#x5e02;</span>\n        all_city = <span class=\"hljs-variable language_\">self</span>.get_all_city()\n        <span class=\"hljs-keyword\">for</span> city <span class=\"hljs-keyword\">in</span> all_city:\n            <span class=\"hljs-comment\"># &#x83b7;&#x53d6;&#x6bcf;&#x4e2a;&#x57ce;&#x5e02;&#x7684;&#x95e8;&#x5e97;&#x9875;&#x6570;</span>\n            total = <span class=\"hljs-variable language_\">self</span>.get_total_page(city)\n            <span class=\"hljs-keyword\">for</span> i <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">range</span>(<span class=\"hljs-number\">1</span>,total+<span class=\"hljs-number\">1</span>):\n                <span class=\"hljs-comment\"># &#x6b64;&#x4e3a;&#x6293;&#x5305;&#x6293;&#x5230;&#x7684;Form&#x8868;&#x5355;&#x6570;&#x636e;</span>\n                formdata = {\n                    <span class=\"hljs-string\">&quot;cname&quot;</span>: city,\n                    <span class=\"hljs-string\">&quot;pid&quot;</span>: <span class=\"hljs-string\">&quot;&quot;</span>,\n                    <span class=\"hljs-string\">&quot;pageIndex&quot;</span>: <span class=\"hljs-built_in\">str</span>(i),\n                    <span class=\"hljs-string\">&quot;pageSize&quot;</span>: <span class=\"hljs-string\">&quot;10&quot;</span>\n                }\n                <span class=\"hljs-keyword\">yield</span> scrapy.FormRequest(url=<span class=\"hljs-variable language_\">self</span>.post_url,formdata=formdata,callback=<span class=\"hljs-variable language_\">self</span>.parse)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_all_city</span>(<span class=\"hljs-params\">self</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x83b7;&#x53d6;&#x6240;&#x6709;&#x7684;&#x57ce;&#x5e02;&#x5217;&#x8868;&quot;&quot;&quot;</span>\n        html = requests.get(url=<span class=\"hljs-variable language_\">self</span>.index_url,headers=<span class=\"hljs-variable language_\">self</span>.headers).text\n        pattern = re.<span class=\"hljs-built_in\">compile</span>(<span class=\"hljs-string\">&apos;&lt;a href=&quot;.*?rel=&quot;(.*?)&quot;&gt;&apos;</span>,re.S)\n        all_city = pattern.findall(html)\n\n        <span class=\"hljs-keyword\">return</span> all_city\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_total_page</span>(<span class=\"hljs-params\">self,city</span>):\n        <span class=\"hljs-string\">&quot;&quot;&quot;&#x83b7;&#x53d6;&#x67d0;&#x4e2a;&#x57ce;&#x5e02;&#x7684;&#x80af;&#x5fb7;&#x57fa;&#x603b;&#x6570; - &#x5411;&#x7b2c;1&#x9875;&#x53d1;&#x8bf7;&#x6c42;&#x5373;&#x53ef;&#x83b7;&#x53d6;&quot;&quot;&quot;</span>\n        data = {\n            <span class=\"hljs-string\">&quot;cname&quot;</span>: city,\n            <span class=\"hljs-string\">&quot;pid&quot;</span>: <span class=\"hljs-string\">&quot;&quot;</span>,\n            <span class=\"hljs-string\">&quot;pageIndex&quot;</span>: <span class=\"hljs-string\">&quot;1&quot;</span>,\n            <span class=\"hljs-string\">&quot;pageSize&quot;</span>: <span class=\"hljs-string\">&quot;10&quot;</span>\n        }\n        html = requests.post(url=<span class=\"hljs-variable language_\">self</span>.post_url,data=data,headers=<span class=\"hljs-variable language_\">self</span>.headers).json()\n        kfc_count = html[<span class=\"hljs-string\">&apos;Table&apos;</span>][<span class=\"hljs-number\">0</span>][<span class=\"hljs-string\">&apos;rowcount&apos;</span>]\n        total = kfc_count//<span class=\"hljs-number\">10</span> <span class=\"hljs-keyword\">if</span> kfc_count%<span class=\"hljs-number\">10</span>==<span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">else</span> kfc_count//<span class=\"hljs-number\">10</span> + <span class=\"hljs-number\">1</span>\n\n        <span class=\"hljs-keyword\">return</span> total\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse</span>(<span class=\"hljs-params\">self, response</span>):\n        html = json.loads(response.text)\n        kfc_shop_list = html[<span class=\"hljs-string\">&apos;Table1&apos;</span>]\n        <span class=\"hljs-keyword\">for</span> kfc_shop <span class=\"hljs-keyword\">in</span> kfc_shop_list:\n            item = KfcItem()\n            item[<span class=\"hljs-string\">&apos;row_num&apos;</span>] = kfc_shop[<span class=\"hljs-string\">&apos;rownum&apos;</span>]\n            item[<span class=\"hljs-string\">&apos;store_name&apos;</span>] = kfc_shop[<span class=\"hljs-string\">&apos;storeName&apos;</span>]\n            item[<span class=\"hljs-string\">&apos;address_detail&apos;</span>] = kfc_shop[<span class=\"hljs-string\">&apos;addressDetail&apos;</span>]\n            item[<span class=\"hljs-string\">&apos;city_name&apos;</span>] = kfc_shop[<span class=\"hljs-string\">&apos;cityName&apos;</span>]\n\n            <span class=\"hljs-keyword\">yield</span> item\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"624,692"}}],"payload":{"tag":"h4","lines":"622,623"}},{"content":"&#x6b65;&#x9aa4;4 - &#x7ba1;&#x9053;&#x6587;&#x4ef6;&#x5b9e;&#x73b0;(pipelines.py)","children":[{"content":"<pre data-lines=\"695,732\"><code class=\"language-python\"><span class=\"hljs-comment\"># &#x5b58;&#x5165;MySQL&#x7ba1;&#x9053;</span>\n<span class=\"hljs-string\">&quot;&quot;&quot;\ncreate database kfcdb charset utf8;\nuse kfcdb;\ncreate table kfctab(\nrow_num int,\nstore_name varchar(100),\naddress_detail varchar(200),\ncity_name varchar(100)\n)charset=utf8;\n&quot;&quot;&quot;</span>\n<span class=\"hljs-keyword\">import</span> pymysql\n<span class=\"hljs-keyword\">from</span> .settings <span class=\"hljs-keyword\">import</span> *\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">KfcMysqlPipeline</span>(<span class=\"hljs-title class_ inherited__\">object</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">open_spider</span>(<span class=\"hljs-params\">self,spider</span>):\n        <span class=\"hljs-variable language_\">self</span>.db = pymysql.connect(MYSQL_HOST,MYSQL_USER,MYSQL_PWD,MYSQL_DB,charset=CHARSET)\n        <span class=\"hljs-variable language_\">self</span>.cursor = <span class=\"hljs-variable language_\">self</span>.db.cursor()\n        <span class=\"hljs-variable language_\">self</span>.ins = <span class=\"hljs-string\">&apos;insert into kfctab values(%s,%s,%s,%s)&apos;</span>\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">process_item</span>(<span class=\"hljs-params\">self, item, spider</span>):\n        shop_li = [\n            item[<span class=\"hljs-string\">&apos;row_num&apos;</span>],\n            item[<span class=\"hljs-string\">&apos;store_name&apos;</span>],\n            item[<span class=\"hljs-string\">&apos;address_detail&apos;</span>],\n            item[<span class=\"hljs-string\">&apos;city_name&apos;</span>]\n        ]\n        <span class=\"hljs-variable language_\">self</span>.cursor.execute(<span class=\"hljs-variable language_\">self</span>.ins,shop_li)\n        <span class=\"hljs-variable language_\">self</span>.db.commit()\n\n        <span class=\"hljs-keyword\">return</span> item\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">close_spider</span>(<span class=\"hljs-params\">self,spider</span>):\n        <span class=\"hljs-variable language_\">self</span>.cursor.close()\n        <span class=\"hljs-variable language_\">self</span>.db.close()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"695,732"}}],"payload":{"tag":"h4","lines":"693,694"}},{"content":"&#x6b65;&#x9aa4;5 - &#x5168;&#x5c40;&#x914d;&#x7f6e;(settings.py)","children":[{"content":"<pre data-lines=\"735,752\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;ROBOTSTXT_OBEY = <span class=\"hljs-literal\">False</span>\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;DOWNLOAD_DELAY = <span class=\"hljs-number\">0.1</span>\n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;DEFAULT_REQUEST_HEADERS = {\n  <span class=\"hljs-string\">&apos;Accept&apos;</span>: <span class=\"hljs-string\">&apos;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&apos;</span>,\n  <span class=\"hljs-string\">&apos;Accept-Language&apos;</span>: <span class=\"hljs-string\">&apos;en&apos;</span>,\n  <span class=\"hljs-string\">&apos;User-Agent&apos;</span>: <span class=\"hljs-string\">&apos;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36&apos;</span>,\n}\n&#x3010;<span class=\"hljs-number\">4</span>&#x3011;ITEM_PIPELINES = {\n   <span class=\"hljs-string\">&apos;Kfc.pipelines.KfcMysqlPipeline&apos;</span>: <span class=\"hljs-number\">300</span>,\n}\n&#x3010;<span class=\"hljs-number\">5</span>&#x3011;MYSQL_HOST = <span class=\"hljs-string\">&apos;localhost&apos;</span>\n&#x3010;<span class=\"hljs-number\">6</span>&#x3011;MYSQL_USER = <span class=\"hljs-string\">&apos;root&apos;</span>\n&#x3010;<span class=\"hljs-number\">7</span>&#x3011;MYSQL_PWD = <span class=\"hljs-string\">&apos;123456&apos;</span>\n&#x3010;<span class=\"hljs-number\">8</span>&#x3011;MYSQL_DB = <span class=\"hljs-string\">&apos;kfcdb&apos;</span>\n&#x3010;<span class=\"hljs-number\">9</span>&#x3011;CHARSET = <span class=\"hljs-string\">&apos;utf8&apos;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"735,752"}}],"payload":{"tag":"h4","lines":"733,734"}},{"content":"&#x6b65;&#x9aa4;6 - &#x8fd0;&#x884c;&#x722c;&#x866b;(run.py)","children":[{"content":"<pre data-lines=\"755,760\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> scrapy <span class=\"hljs-keyword\">import</span> cmdline\n\ncmdline.execute(<span class=\"hljs-string\">&apos;scrapy crawl kfc&apos;</span>.split())\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"755,760"}}],"payload":{"tag":"h4","lines":"753,754"}},{"content":"&#x7ec3;&#x4e60;","children":[{"content":"<pre data-lines=\"763,766\"><code class=\"language-python\">&#x8bf7;&#x4f7f;&#x7528;scrapy&#x6846;&#x67b6;&#x5b9e;&#x73b0;&#x6709;&#x9053;&#x7ffb;&#x8bd1;&#x6848;&#x4f8b;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"763,766"}}],"payload":{"tag":"h4","lines":"761,762"}}],"payload":{"tag":"h3","lines":"583,584"}},{"content":"&#x6709;&#x9053;&#x7ffb;&#x8bd1;&#x6848;&#x4f8b;&#x5b9e;&#x73b0;","children":[{"content":"&#x6b65;&#x9aa4;1 - &#x521b;&#x5efa;&#x9879;&#x76ee;+&#x722c;&#x866b;&#x6587;&#x4ef6;","children":[{"content":"<pre data-lines=\"771,776\"><code class=\"language-python\">scrapy startproject Youdao\ncd Youdao\nscrapy genspider youdao fanyi.youdao.com\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"771,776"}}],"payload":{"tag":"h4","lines":"769,770"}},{"content":"&#x6b65;&#x9aa4;2 - items.py","children":[{"content":"<pre data-lines=\"779,782\"><code class=\"language-python\">result = scrapy.Field()\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"779,782"}}],"payload":{"tag":"h4","lines":"777,778"}},{"content":"&#x6b65;&#x9aa4;3 - youdao.py","children":[{"content":"<pre data-lines=\"785,839\"><code class=\"language-python\"><span class=\"hljs-comment\"># -*- coding: utf-8 -*-</span>\n<span class=\"hljs-keyword\">import</span> scrapy\n<span class=\"hljs-keyword\">import</span> time\n<span class=\"hljs-keyword\">import</span> random\n<span class=\"hljs-keyword\">from</span> hashlib <span class=\"hljs-keyword\">import</span> md5\n<span class=\"hljs-keyword\">import</span> json\n<span class=\"hljs-keyword\">from</span> ..items <span class=\"hljs-keyword\">import</span> YoudaoItem\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">YoudaoSpider</span>(scrapy.Spider):\n    name = <span class=\"hljs-string\">&apos;youdao&apos;</span>\n    allowed_domains = [<span class=\"hljs-string\">&apos;fanyi.youdao.com&apos;</span>]\n    word = <span class=\"hljs-built_in\">input</span>(<span class=\"hljs-string\">&apos;&#x8bf7;&#x8f93;&#x5165;&#x8981;&#x7ffb;&#x8bd1;&#x7684;&#x5355;&#x8bcd;:&apos;</span>)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">start_requests</span>(<span class=\"hljs-params\">self</span>):\n        post_url = <span class=\"hljs-string\">&apos;http://fanyi.youdao.com/translate_o?smartresult=dict&amp;smartresult=rule&apos;</span>\n        salt, sign, ts = <span class=\"hljs-variable language_\">self</span>.get_salt_sign_ts(<span class=\"hljs-variable language_\">self</span>.word)\n        formdata = {\n                  <span class=\"hljs-string\">&apos;i&apos;</span>: <span class=\"hljs-variable language_\">self</span>.word,\n                  <span class=\"hljs-string\">&apos;from&apos;</span>: <span class=\"hljs-string\">&apos;AUTO&apos;</span>,\n                  <span class=\"hljs-string\">&apos;to&apos;</span>: <span class=\"hljs-string\">&apos;AUTO&apos;</span>,\n                  <span class=\"hljs-string\">&apos;smartresult&apos;</span>: <span class=\"hljs-string\">&apos;dict&apos;</span>,\n                  <span class=\"hljs-string\">&apos;client&apos;</span>: <span class=\"hljs-string\">&apos;fanyideskweb&apos;</span>,\n                  <span class=\"hljs-string\">&apos;salt&apos;</span>: salt,\n                  <span class=\"hljs-string\">&apos;sign&apos;</span>: sign,\n                  <span class=\"hljs-string\">&apos;ts&apos;</span>: ts,\n                  <span class=\"hljs-string\">&apos;bv&apos;</span>: <span class=\"hljs-string\">&apos;cf156b581152bd0b259b90070b1120e6&apos;</span>,\n                  <span class=\"hljs-string\">&apos;doctype&apos;</span>: <span class=\"hljs-string\">&apos;json&apos;</span>,\n                  <span class=\"hljs-string\">&apos;version&apos;</span>: <span class=\"hljs-string\">&apos;2.1&apos;</span>,\n                  <span class=\"hljs-string\">&apos;keyfrom&apos;</span>: <span class=\"hljs-string\">&apos;fanyi.web&apos;</span>,\n                  <span class=\"hljs-string\">&apos;action&apos;</span>: <span class=\"hljs-string\">&apos;FY_BY_REALTlME&apos;</span>\n            }\n\t   <span class=\"hljs-comment\"># &#x53d1;&#x9001;post&#x8bf7;&#x6c42;&#x7684;&#x65b9;&#x6cd5;</span>\n        <span class=\"hljs-keyword\">yield</span> scrapy.FormRequest(url=post_url,formdata=formdata)\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">get_salt_sign_ts</span>(<span class=\"hljs-params\">self, word</span>):\n        <span class=\"hljs-comment\"># salt</span>\n        salt = <span class=\"hljs-built_in\">str</span>(<span class=\"hljs-built_in\">int</span>(time.time() * <span class=\"hljs-number\">1000</span>)) + <span class=\"hljs-built_in\">str</span>(random.randint(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">9</span>))\n        <span class=\"hljs-comment\"># sign</span>\n        string = <span class=\"hljs-string\">&quot;fanyideskweb&quot;</span> + word + salt + <span class=\"hljs-string\">&quot;n%A-rKaT5fb[Gy?;N5@Tj&quot;</span>\n        s = md5()\n        s.update(string.encode())\n        sign = s.hexdigest()\n        <span class=\"hljs-comment\"># ts</span>\n        ts = <span class=\"hljs-built_in\">str</span>(<span class=\"hljs-built_in\">int</span>(time.time() * <span class=\"hljs-number\">1000</span>))\n        <span class=\"hljs-keyword\">return</span> salt, sign, ts\n\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">parse</span>(<span class=\"hljs-params\">self, response</span>):\n        item = YoudaoItem()\n        html = json.loads(response.text)\n        item[<span class=\"hljs-string\">&apos;result&apos;</span>] = html[<span class=\"hljs-string\">&apos;translateResult&apos;</span>][<span class=\"hljs-number\">0</span>][<span class=\"hljs-number\">0</span>][<span class=\"hljs-string\">&apos;tgt&apos;</span>]\n\n        <span class=\"hljs-keyword\">yield</span> item\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"785,839"}}],"payload":{"tag":"h4","lines":"783,784"}},{"content":"&#x6b65;&#x9aa4;4 - pipelines.py","children":[{"content":"<pre data-lines=\"842,848\"><code class=\"language-python\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">YoudaoPipeline</span>(<span class=\"hljs-title class_ inherited__\">object</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">process_item</span>(<span class=\"hljs-params\">self, item, spider</span>):\n        <span class=\"hljs-built_in\">print</span>(<span class=\"hljs-string\">&apos;&#x7ffb;&#x8bd1;&#x7ed3;&#x679c;:&apos;</span>,item[<span class=\"hljs-string\">&apos;result&apos;</span>])\n        <span class=\"hljs-keyword\">return</span> item\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"842,848"}}],"payload":{"tag":"h4","lines":"840,841"}},{"content":"&#x6b65;&#x9aa4;5 - settings.py","children":[{"content":"<pre data-lines=\"851,864\"><code class=\"language-python\">ROBOTSTXT_OBEY = <span class=\"hljs-literal\">False</span>\nLOG_LEVEL = <span class=\"hljs-string\">&apos;WARNING&apos;</span>\nCOOKIES_ENABLED = <span class=\"hljs-literal\">False</span>\nDEFAULT_REQUEST_HEADERS = {\n      <span class=\"hljs-string\">&quot;Cookie&quot;</span>: <span class=\"hljs-string\">&quot;OUTFOX_SEARCH_USER_ID=970246104@10.169.0.83; OUTFOX_SEARCH_USER_ID_NCOO=570559528.1224236; _ntes_nnid=96bc13a2f5ce64962adfd6a278467214,1551873108952; JSESSIONID=aaae9i7plXPlKaJH_gkYw; td_cookie=18446744072941336803; SESSION_FROM_COOKIE=unknown; ___rl__test__cookies=1565689460872&quot;</span>,\n      <span class=\"hljs-string\">&quot;Referer&quot;</span>: <span class=\"hljs-string\">&quot;http://fanyi.youdao.com/&quot;</span>,\n      <span class=\"hljs-string\">&quot;User-Agent&quot;</span>: <span class=\"hljs-string\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&quot;</span>,\n}\nITEM_PIPELINES = {\n   <span class=\"hljs-string\">&apos;Youdao.pipelines.YoudaoPipeline&apos;</span>: <span class=\"hljs-number\">300</span>,\n}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"851,864"}}],"payload":{"tag":"h4","lines":"849,850"}},{"content":"&#x6b65;&#x9aa4;6 - run.py","children":[{"content":"<pre data-lines=\"867,872\"><code class=\"language-python\"><span class=\"hljs-keyword\">from</span> scrapy <span class=\"hljs-keyword\">import</span> cmdline\n\ncmdline.execute(<span class=\"hljs-string\">&apos;scrapy crawl youdao&apos;</span>.split())\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"867,872"}}],"payload":{"tag":"h4","lines":"865,866"}}],"payload":{"tag":"h3","lines":"767,768"}},{"content":"scrapy&#x6dfb;&#x52a0;cookie&#x7684;&#x4e09;&#x79cd;&#x65b9;&#x5f0f;","children":[{"content":"<pre data-lines=\"875,892\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x4fee;&#x6539; settings.py &#x6587;&#x4ef6;\n    <span class=\"hljs-number\">1.1</span>) COOKIES_ENABLED = <span class=\"hljs-literal\">False</span>  -&gt; &#x53d6;&#x6d88;&#x6ce8;&#x91ca;,&#x5f00;&#x542f;cookie,&#x68c0;&#x67e5;headers&#x4e2d;&#x7684;cookie\n    <span class=\"hljs-number\">1.2</span>) DEFAULT_REQUEST_HEADERS = {}   &#x6dfb;&#x52a0;Cookie\n\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;&#x5229;&#x7528;cookies&#x53c2;&#x6570;\n    <span class=\"hljs-number\">1.1</span>) settings.py: COOKIES_ENABLED = <span class=\"hljs-literal\">True</span> <span class=\"hljs-comment\"># &#x4fee;&#x6539;&#x4e3a;TRUE&#x540e;&#xff0c;&#x68c0;&#x67e5; Request()&#x65b9;&#x6cd5;&#x4e2d;cookies</span>\n    <span class=\"hljs-number\">1.2</span>) <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">start_requests</span>(<span class=\"hljs-params\">self</span>):\n             <span class=\"hljs-keyword\">yield</span> scrapy.Request(url=url,cookies={},callback=xxx)\n             <span class=\"hljs-keyword\">yield</span> scrapy.FormRequest(url=url,formdata=formdata,cookies={},callback=xxx)\n    \n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;DownloadMiddleware&#x8bbe;&#x7f6e;&#x4e2d;&#x95f4;&#x4ef6;\n    <span class=\"hljs-number\">3.1</span>) settings.py: COOKIES_ENABLED = TRUE  <span class=\"hljs-comment\"># &#x627e;Request()&#x65b9;&#x6cd5;&#x4e2d;cookies&#x53c2;&#x6570;</span>\n    <span class=\"hljs-number\">3.2</span>) middlewares.py\n         <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">process_request</span>(<span class=\"hljs-params\">self,request,spider</span>):\n             request.cookies={}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"875,892"}}],"payload":{"tag":"h3","lines":"873,874"}}],"payload":{"tag":"h2","lines":"571,572"}},{"content":"scrapy shell&#x7684;&#x4f7f;&#x7528;","children":[{"content":"&#x5b9a;&#x4e49;","children":[{"content":"<pre data-lines=\"897,901\"><code class=\"language-python\">&#x3010;1&#x3011;&#x8c03;&#x8bd5;&#x8718;&#x86db;&#x7684;&#x5de5;&#x5177;\n&#x3010;2&#x3011;&#x4ea4;&#x4e92;&#x5f0f;shell&#xff0c;&#x53ef;&#x5728;&#x4e0d;&#x8fd0;&#x884c;spider&#x7684;&#x524d;&#x63d0;&#x4e0b;,&#x5feb;&#x901f;&#x8c03;&#x8bd5; scrapy &#x4ee3;&#x7801;(&#x4e3b;&#x8981;&#x6d4b;&#x8bd5;xpath&#x8868;&#x8fbe;&#x5f0f;)\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"897,901"}}],"payload":{"tag":"h3","lines":"895,896"}},{"content":"&#x57fa;&#x672c;&#x4f7f;&#x7528;","children":[{"content":"<pre data-lines=\"904,921\"><code class=\"language-python\"><span class=\"hljs-comment\"># scrapy shell URL&#x5730;&#x5740;</span>\n*<span class=\"hljs-number\">1</span>&#x3001;request.url     : &#x8bf7;&#x6c42;URL&#x5730;&#x5740;\n*<span class=\"hljs-number\">2</span>&#x3001;request.headers &#xff1a;&#x8bf7;&#x6c42;&#x5934;(&#x5b57;&#x5178;)\n*<span class=\"hljs-number\">3</span>&#x3001;request.meta    &#xff1a;item&#x6570;&#x636e;&#x4f20;&#x9012;&#xff0c;&#x5b9a;&#x4e49;&#x4ee3;&#x7406;(&#x5b57;&#x5178;)\n*<span class=\"hljs-number\">4</span>&#x3001;request.cookies : Cookie\n\n<span class=\"hljs-number\">4</span>&#x3001;response.text    &#xff1a;&#x5b57;&#x7b26;&#x4e32;\n<span class=\"hljs-number\">5</span>&#x3001;response.body    &#xff1a;<span class=\"hljs-built_in\">bytes</span>\n<span class=\"hljs-number\">6</span>&#x3001;response.xpath(<span class=\"hljs-string\">&apos;&apos;</span>)\n<span class=\"hljs-number\">7</span>&#x3001;response.status  : HTTP&#x54cd;&#x5e94;&#x7801;\n  \n<span class=\"hljs-comment\"># &#x53ef;&#x7528;&#x65b9;&#x6cd5;</span>\nshelp() : &#x5e2e;&#x52a9;\nfetch(request) : &#x4ece;&#x7ed9;&#x5b9a;&#x7684;&#x8bf7;&#x6c42;&#x4e2d;&#x83b7;&#x53d6;&#x65b0;&#x7684;&#x54cd;&#x5e94;&#xff0c;&#x5e76;&#x66f4;&#x65b0;&#x6240;&#x6709;&#x76f8;&#x5173;&#x5bf9;&#x8c61;\nview(response) : &#x5728;&#x672c;&#x5730;Web&#x6d4f;&#x89c8;&#x5668;&#x4e2d;&#x6253;&#x5f00;&#x7ed9;&#x5b9a;&#x7684;&#x54cd;&#x5e94;&#x4ee5;&#x8fdb;&#x884c;&#x68c0;&#x67e5;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"904,921"}}],"payload":{"tag":"h3","lines":"902,903"}},{"content":"scrapy.Request()&#x53c2;&#x6570;","children":[{"content":"<pre data-lines=\"924,933\"><code class=\"language-python\"><span class=\"hljs-number\">1</span>&#x3001;url\n<span class=\"hljs-number\">2</span>&#x3001;callback\n<span class=\"hljs-number\">3</span>&#x3001;headers\n<span class=\"hljs-number\">4</span>&#x3001;meta &#xff1a;&#x4f20;&#x9012;&#x6570;&#x636e;,&#x5b9a;&#x4e49;&#x4ee3;&#x7406;\n<span class=\"hljs-number\">5</span>&#x3001;dont_filter &#xff1a;&#x662f;&#x5426;&#x5ffd;&#x7565;&#x57df;&#x7ec4;&#x9650;&#x5236;\n   &#x9ed8;&#x8ba4;<span class=\"hljs-literal\">False</span>,&#x68c0;&#x67e5;allowed_domains[<span class=\"hljs-string\">&apos;&apos;</span>]\n<span class=\"hljs-number\">6</span>&#x3001;cookies\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"924,933"}}],"payload":{"tag":"h3","lines":"922,923"}}],"payload":{"tag":"h2","lines":"893,894"}},{"content":"&#x8bbe;&#x7f6e;&#x4e2d;&#x95f4;&#x4ef6;(&#x968f;&#x673a;User-Agent)","children":[{"content":"&#x5c11;&#x91cf;User-Agent&#x5207;&#x6362;","children":[{"content":"<pre data-lines=\"938,946\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x65b9;&#x6cd5;&#x4e00; : settings.py\n    <span class=\"hljs-number\">1.1</span>) USER_AGENT = <span class=\"hljs-string\">&apos;&apos;</span>\n    <span class=\"hljs-number\">1.2</span>) DEFAULT_REQUEST_HEADERS = {}\n    \n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;&#x65b9;&#x6cd5;&#x4e8c; : &#x722c;&#x866b;&#x6587;&#x4ef6;\n    <span class=\"hljs-keyword\">yield</span> scrapy.Request(url,callback=&#x51fd;&#x6570;&#x540d;,headers={})\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"938,946"}}],"payload":{"tag":"h3","lines":"936,937"}},{"content":"&#x5927;&#x91cf;User-Agent&#x5207;&#x6362;&#xff08;middlewares.py&#x8bbe;&#x7f6e;&#x4e2d;&#x95f4;&#x4ef6;&#xff09;","children":[{"content":"<pre data-lines=\"949,965\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;&#x83b7;&#x53d6;User-Agent&#x65b9;&#x5f0f;\n    <span class=\"hljs-number\">1.1</span>) &#x65b9;&#x6cd5;<span class=\"hljs-number\">1</span> &#xff1a;&#x65b0;&#x5efa;useragents.py,&#x5b58;&#x653e;&#x5927;&#x91cf;User-Agent&#xff0c;random&#x6a21;&#x5757;&#x968f;&#x673a;&#x5207;&#x6362;\n    <span class=\"hljs-number\">1.2</span>) &#x65b9;&#x6cd5;<span class=\"hljs-number\">2</span> &#xff1a;&#x5b89;&#x88c5;fake_useragent&#x6a21;&#x5757;(sudo pip3 install fack_useragent)\n        <span class=\"hljs-keyword\">from</span> fake_useragent <span class=\"hljs-keyword\">import</span> UserAgent\n        agent = UserAgent().random \n        \n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;middlewares.py&#x65b0;&#x5efa;&#x4e2d;&#x95f4;&#x4ef6;&#x7c7b;\n\t<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">RandomUseragentMiddleware</span>(<span class=\"hljs-title class_ inherited__\">object</span>):\n\t\t<span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">process_request</span>(<span class=\"hljs-params\">self,reuqest,spider</span>):\n    \t\tagent = UserAgent().random\n    \t\trequest.headers[<span class=\"hljs-string\">&apos;User-Agent&apos;</span>] = agent\n            \n&#x3010;<span class=\"hljs-number\">3</span>&#x3011;settings.py&#x6dfb;&#x52a0;&#x6b64;&#x4e0b;&#x8f7d;&#x5668;&#x4e2d;&#x95f4;&#x4ef6;\n\tDOWNLOADER_MIDDLEWARES = {<span class=\"hljs-string\">&apos;&apos;</span> : &#x4f18;&#x5148;&#x7ea7;}\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"949,965"}}],"payload":{"tag":"h3","lines":"947,948"}}],"payload":{"tag":"h2","lines":"934,935"}},{"content":"&#x8bbe;&#x7f6e;&#x4e2d;&#x95f4;&#x4ef6;(&#x968f;&#x673a;&#x4ee3;&#x7406;)","children":[{"content":"<pre data-lines=\"970,978\"><code class=\"language-python\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">RandomProxyDownloaderMiddleware</span>(<span class=\"hljs-title class_ inherited__\">object</span>):\n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">process_request</span>(<span class=\"hljs-params\">self,request,spider</span>):\n    \trequest.meta[<span class=\"hljs-string\">&apos;proxy&apos;</span>] = xxx\n        \n    <span class=\"hljs-keyword\">def</span> <span class=\"hljs-title function_\">process_exception</span>(<span class=\"hljs-params\">self,request,exception,spider</span>):\n        <span class=\"hljs-keyword\">return</span> request\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"970,978"}},{"content":"&#x7ec3;&#x4e60;","children":[{"content":"<pre data-lines=\"981,984\"><code class=\"language-python\">&#x6709;&#x9053;&#x7ffb;&#x8bd1;,&#x5c06;cookie&#x4ee5;&#x4e2d;&#x95f4;&#x4ef6;&#x7684;&#x65b9;&#x5f0f;&#x6dfb;&#x52a0;&#x7684;scrapy&#x9879;&#x76ee;&#x4e2d;\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"981,984"}}],"payload":{"tag":"h3","lines":"979,980"}}],"payload":{"tag":"h2","lines":"966,967"}},{"content":"&#x4eca;&#x65e5;&#x4f5c;&#x4e1a;","children":[{"content":"<pre data-lines=\"989,999\"><code class=\"language-python\">&#x3010;<span class=\"hljs-number\">1</span>&#x3011;URL&#x5730;&#x5740;&#xff1a;http://www<span class=\"hljs-number\">.1</span>ppt.com/xiazai/\n&#x3010;<span class=\"hljs-number\">2</span>&#x3011;&#x76ee;&#x6807;:\n    <span class=\"hljs-number\">2.1</span>) &#x722c;&#x53d6;&#x6240;&#x6709;&#x680f;&#x76ee;&#x5206;&#x7c7b;&#x4e0b;&#x7684;,&#x6240;&#x6709;&#x9875;&#x7684;PPT\n    <span class=\"hljs-number\">2.2</span>) &#x6570;&#x636e;&#x5b58;&#x653e;: /home/tarena/ppts/&#x5de5;&#x4f5c;&#x603b;&#x7ed3;PPT/xxx\n                  /home/tarena/ppts/&#x4e2a;&#x4eba;&#x7b80;&#x5386;PPT/xxx\n&#x3010;&#x63d0;&#x793a;&#x3011;: &#x4f7f;&#x7528; <span class=\"hljs-keyword\">from</span> scrapy.pipelines.files <span class=\"hljs-keyword\">import</span> FilesPipeline &#x7ba1;&#x9053;,&#x5e76;&#x91cd;&#x5199;&#x65b9;&#x6cd5;\n    \nsettings.py:  FILES_STORE = <span class=\"hljs-string\">&apos;&#x8def;&#x5f84;&apos;</span>\n</code></pre>","children":[],"payload":{"tag":"pre","lines":"989,999"}}],"payload":{"tag":"h2","lines":"987,988"}}],"payload":{"tag":"h1","lines":"268,269"}}]},{})</script>
</body>
</html>
